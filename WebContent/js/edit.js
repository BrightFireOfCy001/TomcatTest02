!function(){function e(){for(var e=navigator.userAgent,t={browser:!1,version:!1},i=1,n=[{name:"Chrome/Chromium",regExp:/(?:chrome|crios|chromium)\/(\d+)/i,minVersion:24},{name:"Firefox",regExp:/firefox\/(\d+)/i,minVersion:17},{name:"Microsoft Internet Explorer",regExp:/msie\s(\d+)/i,minVersion:11},{name:"Microsoft Internet Explorer",regExp:/Trident\/(\d+)/i,minVersion:7},{name:"Safari",regExp:/version\/(\d+).*?safari/i,minVersion:6}],o=0;o<n.length;o++){var r=n[o],s=e.match(r.regExp);if(s){t.browser=!0,t.version=s[i]>=r.minVersion,t.name=r.name;break}}return t}function t(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}function i(e){throw alert(e),new Error("unsupported browser")}var n=e();if(n.browser)n.version||i("Sorry, your browser version is not supported.\n\nTo use Orion, please upgrade to the latest version of "+n.name+".\n");else if(t()&&!localStorage.skipBrowserCheck){if(!confirm("Sorry, your browser is not supported. The latest version of Chrome, Firefox or Safari web browser is recommended.\nContinue anyway?"))throw"unsupported browser";localStorage.skipBrowserCheck=1}else t()||i("Sorry, your browser is not supported.\n\nTo use Orion, the latest version of the Chrome, Firefox, or Safari web browser is recommended.\n");return{isSupportedBrowser:e,supportsLocalStorage:t,throwBrowserAlert:i}}(),define("orion/browserCompatibility",function(){}),function(e,t){"function"==typeof define&&define.amd?define("orion/Deferred",t):"object"==typeof exports?module.exports=t():(e.orion=e.orion||{},e.orion.Deferred=t())}(this,function(){function e(){for(var e;e=r.shift();)e();s=!1}function t(e){r.push(e),s||(s=!0,a())}function i(e){return function(t){e(t)}}function n(e,t,n){try{var o=e(t),r=o&&("object"==typeof o||"function"==typeof o)&&o.then;if("function"==typeof r)if(o===n.promise)n.reject(new TypeError);else{var s=o.cancel;"function"==typeof s?n._parentCancel=s.bind(o):delete n._parentCancel,r.call(o,i(n.resolve),i(n.reject),i(n.progress))}else n.resolve(o)}catch(a){n.reject(a)}}function o(){function e(){for(var e;e=c.shift();){var t=e.deferred,i="fulfilled"===l?"resolve":"reject",o=e[i];"function"==typeof o?n(o,a,t):t[i](a)}}function i(i){delete d._parentCancel,l="rejected",a=i,c.length&&t(e)}function r(n){function s(e){return function(t){l&&"assumed"!==l||e(t)}}delete d._parentCancel;try{var h=n&&("object"==typeof n||"function"==typeof n)&&n.then;if("function"==typeof h)if(n===d)i(new TypeError);else{l="assumed";var u=n&&n.cancel;if("function"!=typeof u){var p=new o;n=p.promise;try{h(p.resolve,p.reject,p.progress)}catch(f){p.reject(f)}u=n.cancel,h=n.then}a=n,h.call(n,s(r),s(i)),d._parentCancel=u.bind(n)}else l="fulfilled",a=n,c.length&&t(e)}catch(g){s(i)(g)}}function s(){var e=d._parentCancel;if(e)delete d._parentCancel,e();else if(!l){var t=new Error("Cancel");t.name="Cancel",i(t)}}var a,l,c=[],d=this;this.resolve=function(e){return l||r(e),d},this.reject=function(e){return l||i(e),d},this.progress=function(e){return l||c.forEach(function(t){if(t.progress)try{t.progress(e)}catch(i){}}),d.promise},this.cancel=function(){return d._parentCancel?setTimeout(s,0):s(),d},this.then=function(i,n,r){var s=new o;return s._parentCancel=d.promise.cancel,c.push({resolve:i,reject:n,progress:r,deferred:s}),("fulfilled"===l||"rejected"===l)&&t(e),s.promise},this.promise={then:d.then,cancel:d.cancel}}var r=[],s=!1,a=function(){if("undefined"!=typeof process&&"function"==typeof process.nextTick){var t=process.nextTick;return function(){t(e)}}if("function"==typeof MutationObserver){var i=document.createElement("div"),n=new MutationObserver(e);return n.observe(i,{attributes:!0}),function(){i.setAttribute("class","_tick")}}return function(){setTimeout(e,0)}}();return o.all=function(e,t){function i(e,t){a||(s[e]=t,0===--r&&l.resolve(s))}function n(e,n){if(!a){if(t)try{return void i(e,t(n))}catch(o){n=o}l.reject(n)}}var r=e.length,s=[],a=!1,l=new o;return l.then(void 0,function(){a=!0,e.forEach(function(e){e.cancel&&e.cancel()})}),0===r?l.resolve(s):e.forEach(function(e,t){e.then(i.bind(void 0,t),n.bind(void 0,t))}),l.promise},o.when=function(e,t,i,n){var r,s;return e&&"function"==typeof e.then?r=e:(s=new o,s.resolve(e),r=s.promise),r.then(t,i,n)},o}),define("orion/EventTarget",[],function(){function e(){this._namedListeners={}}return e.prototype={dispatchEvent:function(e){if(!e.type)throw new Error("unspecified type");var t=this._namedListeners[e.type];return t&&t.forEach(function(t){try{"function"==typeof t?t(e):t.handleEvent(e)}catch(i){"undefined"!=typeof console&&console.log(i)}}),!e.defaultPrevented},addEventListener:function(e,t){("function"==typeof t||t.handleEvent)&&(this._namedListeners[e]=this._namedListeners[e]||[],this._namedListeners[e].push(t))},removeEventListener:function(e,t){var i=this._namedListeners[e];if(i)for(var n=0;n<i.length;n++)if(i[n]===t){1===i.length?delete this._namedListeners[e]:i.splice(n,1);break}}},e.prototype.constructor=e,e.attach=function(t){var i=new e;t.dispatchEvent=i.dispatchEvent.bind(i),t.addEventListener=i.addEventListener.bind(i),t.removeEventListener=i.removeEventListener.bind(i)},e}),define("orion/serviceregistry",["orion/Deferred","orion/EventTarget"],function(e,t){function i(e,t,i){this._properties=i||{},this._properties["service.id"]=e,this._properties.objectClass=t,this._properties["service.names"]=t}function n(e,t,i){this._serviceId=e,this._serviceReference=t,this._internalRegistry=i}function o(t,i){function n(n){return function(){var o;try{if(!i())throw new Error("Service was unregistered");var r=t[n].apply(t,Array.prototype.slice.call(arguments));if(r&&"function"==typeof r.then)return r;o=new e,o.resolve(r)}catch(s){o=new e,o.reject(s)}return o.promise}}var o;for(o in t)"function"==typeof t[o]&&(this[o]=n(o))}function r(e,t){this.type=e,this.serviceReference=t}function s(){this._entries=[],this._namedReferences={},this._serviceEventTarget=new t;var e=this;this._internalRegistry={isRegistered:function(t){return e._entries[t]?!0:!1},unregisterService:function(t){var i=e._entries[t];if(!i)throw new Error("Service has already been unregistered: "+t);var n=i.reference;e._serviceEventTarget.dispatchEvent(new r("unregistering",n)),e._entries[t]=null;var o=n.getProperty("objectClass");o.forEach(function(t){for(var i=e._namedReferences[t],o=0;o<i.length;o++)if(i[o]===n){1===i.length?delete e._namedReferences[t]:i.splice(o,1);break}})},modifyService:function(t){var i=e._entries[t];if(!i)throw new Error("Service not found while trying to send modified event: "+t);var n=i.reference;e._serviceEventTarget.dispatchEvent(new r("modified",n))}}}return i.prototype={getPropertyKeys:function(){var e,t=[];for(e in this._properties)this._properties.hasOwnProperty(e)&&t.push(e);return t},getProperty:function(e){return this._properties[e]}},i.prototype.constructor=i,n.prototype={unregister:function(){this._internalRegistry.unregisterService(this._serviceId)},getReference:function(){if(!this._internalRegistry.isRegistered(this._serviceId))throw new Error("Service has already been unregistered: "+this._serviceId);return this._serviceReference},setProperties:function(e){var t=this._serviceReference._properties;this._serviceReference._properties=e||{},e["service.id"]=this._serviceId,e.objectClass=t.objectClass,e["service.names"]=t["service.names"],this._internalRegistry.modifyService(this._serviceId)}},n.prototype.constructor=n,s.prototype={getService:function(e){var t;if("string"==typeof e){var i=this._namedReferences[e];i&&i.some(function(e){return t=this._entries[e.getProperty("service.id")].service,!!t},this)}else{var n=this._entries[e.getProperty("service.id")];n&&(t=n.service)}return t||null},getServiceReferences:function(e){if(e)return this._namedReferences[e]?this._namedReferences[e]:[];var t=[];return this._entries.forEach(function(e){e&&t.push(e.reference)}),t},registerService:function(e,t,s){if("undefined"==typeof t||null===t)throw new Error("invalid service");"string"==typeof e?e=[e]:Array.isArray(e)||(e=[]);var a=this._entries.length,l=new i(a,e,s),c=this._namedReferences;e.forEach(function(e){c[e]=c[e]||[],c[e].push(l)});var d=new o(t,this._internalRegistry.isRegistered.bind(null,a));this._entries.push({reference:l,service:d});var h=this._internalRegistry;return this._serviceEventTarget.dispatchEvent(new r("registered",l)),new n(a,l,h)},addEventListener:function(e,t){this._serviceEventTarget.addEventListener(e,t)},removeEventListener:function(e,t){this._serviceEventTarget.removeEventListener(e,t)}},s.prototype.constructor=s,{ServiceRegistry:s}}),define("orion/xsrfUtils",[],function(){function e(){if("undefined"==typeof document)return null;var e,t,i,o=document.cookie.split(";");for(e=0;e<o.length;e++)if(t=o[e].substr(0,o[e].indexOf("=")).trim(),i=o[e].substr(o[e].indexOf("=")+1).trim(),t==n)return i}function t(t){var i=e();i&&(t[n]=i)}function i(t){var i=e();i&&t.setRequestHeader(n,i)}var n="x-csrf-token";return{XSRF_TOKEN:n,getCSRFToken:e,setNonceHeader:t,addCSRFNonce:i}}),function(){function e(e){if("string"!=typeof e)throw new TypeError}function t(e){return e?e.split("&"):[]}function i(e){return 0===e.length?"":e.join("&")}function n(e){var t=/([^=]*)(?:=?)(.*)/.exec(e),i=t[1]?decodeURIComponent(t[1]):"",n=t[2]?decodeURIComponent(t[2]):"";return[i,n]}function o(e){var t=encodeURIComponent(e[0]);return e[1]&&(t+="="+encodeURIComponent(e[1])),t}function r(e,i){var o="",r=[],s=0;return{next:function(){if(o!==e.query&&(o=e.query,r=t(o)),s<r.length){var a=n(r[s++]);switch(i){case"keys":return a[0];case"values":return a[1];case"keys+values":return[a[0],a[1]];default:throw new TypeError}}throw N}}}function s(e){Object.defineProperty(this,"_url",{get:function(){return e._url}})}function a(e,t){if(!e.scheme&&t&&(e.scheme=t.scheme,!e.host&&t.host&&(e.userinfo=t.userinfo,e.host=t.host,e.port=t.port,e.pathRelative=!0)),e.pathRelative)if(e.path){if("/"!==e.path[0]){var i=/^(.*\/)[^\/]*$/.exec(t.path)[1]||"/";e.path=i+e.path}}else e.path=t.path}function l(e){return e.toLowerCase()}function c(e){return e?/[1-9]\d*$/.exec(e)[0]:""}function d(e){var t=[];return e.split("/").forEach(function(e){".."===e?t.length>1&&t.pop():"."!==e&&t.push(e)}),t.join("/")}function h(e){e.scheme&&(e.scheme=l(e.scheme)),e.port&&(e.port=c(e.port)),e.host&&e.path&&(e.path=d(e.path))}function u(e){return e.replace(/\s/g,function(e){return"%"+e.charCodeAt(0).toString(16)})}function p(e,t){if("string"!=typeof e)throw new TypeError;e=u(e);var i=_.exec(e);if(!i)return null;var n={};if(n.scheme=i[1]||"",n.scheme&&!w.test(n.scheme))return null;var o=i[2];if(o){var r=y.exec(o);if(n.userinfo=r[1],n.host=r[2],n.port=r[3],n.port&&!b.test(n.port))return null}return n.path=i[3],n.query=i[4],n.fragment=i[5],a(n,t),h(n),n}function f(e){var t=e.scheme?e.scheme+":":"";return e.host&&(t+="//",e.userinfo&&(t+=e.userinfo+"@"),t+=e.host,e.port&&(t+=":"+e.port)),t+=e.path,e.query&&(t+="?"+e.query),e.fragment&&(t+="#"+e.fragment),t}function g(e,t){var i;if(t){if(t=t.href||t,i=p(t),!i||!i.scheme)throw new SyntaxError;Object.defineProperty(this,"_baseURL",{value:i})}var n=p(e,i);if(!n)throw new SyntaxError;Object.defineProperty(this,"_input",{value:e,writable:!0}),Object.defineProperty(this,"_url",{value:n,writable:!0});var o=new s(this);Object.defineProperty(this,"query",{get:function(){return this._url?o:null},enumerable:!0})}try{var m;if("function"==typeof self.URL&&0!==self.URL.length&&"http:"===(m=new self.URL("http://www.w3.org?q")).protocol&&m.query)return}catch(v){}var _=/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/,y=/^(?:(.*)@)?(\[[^\]]*\]|[^:]*)(?::(.*))?$/,C=/^\S*$/,w=/^([a-zA-Z](?:[a-zA-Z0-9+-.])*)$/,b=/^\d*$/,S=/^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)$/,x=/^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)(?::(\d*))?$/,L=/^([^?#\s]*)$/,T=/^([^\s]*)$/,E=C,k=/([^:]*):?(.*)/,N="undefined"!=typeof StopIteration?StopIteration:new Error("Stop Iteration"),A={"ftp:":"21","gopher:":"70","http:":"80","https:":"443","ws:":"80","wss:":"443"};Object.defineProperties(s.prototype,{get:{value:function(i){e(i);var o,r=t(this._url.query);return r.some(function(e){var t=n(e);return t[0]===i?(o=t[1],!0):void 0}),o},enumerable:!0},set:{value:function(r,s){e(r),e(s);var a=t(this._url.query),l=a.some(function(e,t){var i=n(e);return i[0]===r?(i[1]=s,a[t]=o(i),!0):void 0});l||a.push(o([r,s])),this._url.query=i(a)},enumerable:!0},has:{value:function(i){e(i);var o=t(this._url.query);return o.some(function(e){var t=n(e);return t[0]===i?!0:void 0})},enumerable:!0},"delete":{value:function(o){e(o);var r=t(this._url.query),s=r.filter(function(e){var t=n(e);return t[0]!==o});return s.length!==r.length?(this._url.query=i(s),!0):!1},enumerable:!0},clear:{value:function(){this._url.query=""},enumerable:!0},forEach:{value:function(e,t){if("function"!=typeof e)throw new TypeError;var i=r(this._url,"keys+values");try{for(;;){var n=i.next();e.call(t,n[1],n[0],this)}}catch(o){if(o!==N)throw o}},enumerable:!0},keys:{value:function(){return r(this._url,"keys")},enumerable:!0},values:{value:function(){return r(this._url,"values")},enumerable:!0},items:{value:function(){return r(this._url,"keys+values")}},size:{get:function(){return t(this._url.query).length},enumerable:!0},getAll:{value:function(i){e(i);var o=[],r=t(this._url.query);return r.forEach(function(e){var t=n(e);t[0]===i&&o.push(t[1])}),o},enumerable:!0},append:{value:function(n,r){e(n),e(r);var s=t(this._url.query);s.push(o([n,r])),this._url.query=i(s)},enumerable:!0}}),Object.defineProperties(g.prototype,{toString:{value:function(){return this.href}},href:{get:function(){return this._url?f(this._url):this._input},set:function(t){e(t),this._input=t,this._url=p(this._input,this._baseURL)},enumerable:!0},origin:{get:function(){return this._url&&this._url.host?this.protocol+"//"+this.host:""},enumerable:!0},protocol:{get:function(){return this._url?this._url.scheme+":":":"},set:function(t){if(e(t),this._url){var i=":"===t.slice(-1)?t.substring(0,t.length-1):t;(""===i||w.test(i))&&(this._url.scheme=l(i))}},enumerable:!0},_userinfo:{get:function(){return this._url?this._url.userinfo:""},set:function(t){e(t),this._url&&(this._url.userinfo=t)}},username:{get:function(){if(!this._url)return"";var e=k.exec(this._userinfo),t=decodeURIComponent(e[1]||"");return t},set:function(t){if(e(t),this._url){var i=k.exec(this._userinfo),n=[encodeURIComponent(t||"")];i[2]&&n.push(i[2]),this._userinfo=n.join(":")}},enumerable:!0},password:{get:function(){if(!this._url)return"";var e=k.exec(this._userinfo),t=decodeURIComponent(e[2]||"");return t},set:function(t){if(e(t),this._url){var i=k.exec(this._userinfo),n=[i[1]||""];t&&n.push(encodeURIComponent(t)),this._userinfo=n.join(":")}},enumerable:!0},host:{get:function(){var e="";return this._url&&this._url.host&&(e+=this._url.host,this._url.port&&(e+=":"+this._url.port)),e},set:function(t){if(e(t),this._url){var i=x.exec(t);i&&(this._url.host=i[1],this._url.port=c(i[2]))}},enumerable:!0},hostname:{get:function(){return this._url?this._url.host:""},set:function(t){if(e(t),this._url){var i=S.exec(t);i&&(this._url.host=t)}},enumerable:!0},port:{get:function(){var e=this._url?this._url.port||"":"";return e&&e===A[this.protocol]&&(e=""),e},set:function(t){if(e(t),this._url){var i=b.exec(t);i&&(this._url.port=c(t))}},enumerable:!0},pathname:{get:function(){return this._url?this._url.path:""},set:function(t){if(e(t),this._url){var i=L.exec(t);i&&(this._url.host&&t&&"/"!==t[0]&&(t="/"+t),this._url.path=t?d(t):"")}},enumerable:!0},search:{get:function(){return this._url&&this._url.query?"?"+this._url.query:""},set:function(t){if(e(t),this._url){t&&"?"===t[0]&&(t=t.substring(1));var i=T.exec(t);i&&(this._url.query=t)}},enumerable:!0},hash:{get:function(){return this._url&&this._url.fragment?"#"+this._url.fragment:""},set:function(t){if(e(t),this._url){t&&"#"===t[0]&&(t=t.substring(1));var i=E.exec(t);i&&(this._url.fragment=t)}},enumerable:!0}});var R=self.URL||self.webkitURL;R&&R.createObjectURL&&(Object.defineProperty(g,"createObjectURL",{value:R.createObjectURL.bind(R),enumerable:!1}),Object.defineProperty(g,"revokeObjectURL",{value:R.revokeObjectURL.bind(R),enumerable:!1})),self.URL=g}(),define("orion/URL-shim",function(){}),define("orion/xhr",["orion/Deferred","orion/xsrfUtils","orion/URL-shim"],function(e,t){function i(e,t,i,n){var o,r="undefined"!=typeof i.response?i.response:i.responseText,s="string"==typeof r?r:null;try{o=i.status}catch(a){o=0}var l={args:t,response:r,responseText:s,status:o,url:e,xhr:i};return"undefined"!=typeof n&&(l.error=n),l}function n(e){return new URL(location.href).origin===new URL(e,location.href).origin}function o(o,r,s){s=s||{};var a=arguments.length>3&&arguments[3]?arguments[3]:new XMLHttpRequest,l=new e,c=s.headers||{};n(r)&&t.setNonceHeader(c);var d,h=s.log||!1;"undefined"==typeof c["X-Requested-With"]&&(c["X-Requested-With"]="XMLHttpRequest"),"undefined"==typeof s.data||"POST"!==o&&"PUT"!==o||(d=s.data);var u=!1,p=!1;l.promise.then(void 0,function(e){u=!0,!p&&e instanceof Error&&"Cancel"===e.name&&a.abort()}),a.onabort=function(){if(p=!0,!u){var e=new Error("Cancel");e.name="Cancel",l.reject(e)}},a.onload=function(){var e=i(r,s,a);200<=a.status&&a.status<400?l.resolve(e):(l.reject(e),h&&"undefined"!=typeof console&&console.log(new Error(a.statusText)))},a.onerror=function(){var e=i(r,s,a);l.reject(e),h&&"undefined"!=typeof console&&console.log(new Error(a.statusText))},a.onprogress=function(e){e.xhr=a,l.progress(e)};try{if(a.open(o,r,!0),"string"==typeof s.responseType&&(a.responseType=s.responseType),"number"==typeof s.timeout)if("number"==typeof a.timeout)a.timeout=s.timeout,a.addEventListener("timeout",function(){l.reject(i(r,s,a,"Timeout exceeded"))});else{var f=setTimeout(function(){l.reject(i(r,s,a,"Timeout exceeded"))},s.timeout);l.promise.then(clearTimeout.bind(null,f),clearTimeout.bind(null,f))}Object.keys(c).forEach(function(e){a.setRequestHeader(e,c[e])}),a.send(d||null)}catch(g){l.reject(i(r,s,a,g))}return l.promise}return o}),define("orion/preferences",["require","orion/Deferred","orion/EventTarget","orion/xhr"],function(e,t,i,n){function o(e){for(var t=Object.prototype.hasOwnProperty,i=1,n=arguments.length;n>i;i++){var o=arguments[i];for(var r in o)t.call(o,r)&&(e[r]=o[r])}return e}function r(e,t){return{get:function(i,n){if(0===t)return null;var o=localStorage.getItem(e+i);if(null===o)return null;var r=JSON.parse(o);return n||-1===t||r._expires&&r._expires>(new Date).getTime()?(delete r._expires,r):null},set:function(i,n){if(0!==t)if(-1!==t&&(n._expires=(new Date).getTime()+1e3*t),0===Object.keys(n).length)localStorage.removeItem(e+i);else{var o=JSON.stringify(n);localStorage.setItem(e+i,o),delete n._expires}},remove:function(t){localStorage.removeItem(e+t)}}}function s(e){this._currentPromises={},this._cache=new r("/orion/preferences/user",3600),this._service=null,this.available=function(){if(!this._service){var t=e.getServiceReferences("orion.core.preference.provider");t.length>0&&(this._service=e.getService(t[0]))}return!!this._service}}function a(t){t=t||"defaults.pref",-1===t.indexOf("://")&&(t=e.toUrl?e.toUrl(t):t),this._location=t,this._currentPromise=null,this._cache=new r("/orion/preferences/default",3600)}function l(){this._cache=new r("/orion/preferences/local",-1)}function c(e,t,i){this.type=e,this.namespace=t,this.scope=i}function d(e,t){t=t||{},this._changeListeners=[],this._userProvider=t.userProvider||new s(e),this._localProvider=t.localProvider||new l,this._defaultsProvider=t.defaultsProvider||new a(t.defaultPreferencesLocation),i.attach(this),window.addEventListener("storage",function(e){var t=e.key,i="/orion/preferences/";if(0===t.indexOf(i)){var n=t.indexOf("/",i.length),o=t.substring(n),r={"default":d.DEFAULT_SCOPE,local:d.LOCAL_SCOPE,user:d.USER_SCOPE}[t.substring(i.length,n)];this.dispatchEvent(new c("changed",o,r))}}.bind(this),!1),this._serviceRegistration=e.registerService("orion.core.preference",this)}return s.prototype={get:function(e,i){if(this._currentPromises[e])return this._currentPromises[e];var n=new t,o=null;if(i?this._cache.remove(e):o=this._cache.get(e),null!==o)n.resolve(o);else{this._currentPromises[e]=n;var r=this;this._service.get(e).then(function(t){r._cache.set(e,t),delete r._currentPromises[e],n.resolve(t)},function(t){if(404===t.status){var i={};r._cache.set(e,i),delete r._currentPromises[e],n.resolve(i)}else delete r._currentPromises[e],n.resolve(r._cache.get(e,!0)||{})})}return n},put:function(e,t){return this._cache.set(e,t),this._service.put(e,t)},remove:function(e,t){var i=this._cache.get(e);return delete i[t],this._cache.set(e,i),this._service.remove(e,t)}},a.prototype={get:function(e,i){var o=null,r=this;if(this._currentPromise)return this._currentPromise.then(function(){return o=r._cache.get(e),null===o&&(o={},r._cache.set(e,o)),o});var s=new t;return i?this._cache.remove(e):o=this._cache.get(e),null!==o?s.resolve(o):(this._currentPromise=s,n("GET",this._location,{headers:{"Orion-Version":"1"},timeout:15e3}).then(function(t){var i=JSON.parse(t.response);Object.keys(i).forEach(function(e){r._cache.set(e,i[e]||{})}),o=i[e],o||(o={},r._cache.set(e,o)),r._currentPromise=null,s.resolve(o)},function(t){if(401===t.xhr.status||404===t.xhr.status)r._cache.set(e,{}),r._currentPromise=null,s.resolve({});else{r._currentPromise=null;var i=r._cache.get(e,!0);s.resolve(null!==i?i[e]||{}:{})}})),s},put:function(){var e=new t;return e.resolve(),e},remove:function(e,t){var i=this._cache.get(e);delete i[t],this.put(e,i)}},l.prototype={get:function(e){var i=new t,n=this._cache.get(e);return i.resolve(null!==n?n:{}),i},put:function(e,i){var n=new t;return this._cache.set(e,i),n.resolve(),n},remove:function(e,t){var i=this._cache.get(e);delete i[t],this.put(e,i)}},d.DEFAULT_SCOPE=1,d.LOCAL_SCOPE=2,d.USER_SCOPE=4,d.prototype={addChangeListener:function(e){"function"==typeof e&&this._changeListeners.push(e)},get:function(e,i,n){n=n||{};var r=this._getProviders(n.scope),s=[];return r.reverse().forEach(function(t){s.push(t.get(e,n.noCache))}),t.all(s).then(function(e){var t={};return i&&"string"!=typeof i&&!Array.isArray(i)&&(t=o(t,i)),e.forEach(function(e){function n(i){i in e&&(t[i]=e[i])}e&&(i?"string"==typeof i?n(i):Array.isArray(i)?i.forEach(n):Object.keys(i).forEach(n):Object.keys(e).forEach(n))}),t})},put:function(e,t,i){var n=this;i=i||{};var r=this._getProviders(i.scope)[0];return r.get(e).then(function(s){var a=t;return i.clear||(a=o({},s,a)),JSON.stringify(s)!==JSON.stringify(a)?(n._valueChanged(e,t,s),r.put(e,a)):void 0})},remove:function(e,t,i){i=i||{};var n=this._getProviders(i.scope)[0];return n.get(e).then(function(i){function o(e){e in i&&delete i[e]}return t?"string"==typeof t?o(t):Array.isArray(t)?t.forEach(o):Object.keys(t).forEach(o):Object.keys(i).forEach(o),n.put(e,i)})},_getProviders:function(e){(!e||"number"!=typeof e||e>7||1>e)&&(e=d.DEFAULT_SCOPE,e|=this._userProvider.available()?d.USER_SCOPE:d.LOCAL_SCOPE);var t=[];return d.USER_SCOPE&e&&this._userProvider.available()&&t.push(this._userProvider),d.LOCAL_SCOPE&e&&t.push(this._localProvider),d.DEFAULT_SCOPE&e&&t.push(this._defaultsProvider),t},_valueChanged:function(e,t,i){function n(e,t){o._changeListeners.forEach(function(i){i(e,t)})}if(this._changeListeners.length){var o=this;for(var r in t){var s=e+"/"+r,a=t[r];if("string"==typeof a)n(s,a);else for(var l in a)if(!("pid"===l||i&&i[r]&&i[r][l]===a[l])){var c=String(a[l]);n(s+"/"+l,c)}}}},removeChangeListener:function(e){if("function"==typeof e)for(var t=0;t<this._changeListeners.length;t++)if(this._changeListeners[t]===e)return void this._changeListeners.splice(t,1)}},{PreferencesService:d}}),define("orion/pluginregistry",["orion/Deferred","orion/EventTarget","orion/URL-shim"],function(e,t){function i(e,t){var i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;i.sort(),n.sort();for(var o=0,r=i.length;r>o;o++){var s=i[o];if(s!==n[o])return!1;var a=e[s],l=t[s];if(a!==l&&JSON.stringify(a)!==JSON.stringify(l))return!1}return!0}function n(e){for(var t=Object.prototype.hasOwnProperty,i=1,n=arguments.length;n>i;i++){var o=arguments[i];for(var r in o)t.call(o,r)&&(e[r]=o[r])}return e}function o(e){if(-1===e.indexOf("://"))try{return new URL(e,location.href).href}catch(t){}return e}function r(e){function t(){return i=i||Object.keys(e)}var i=null,n={key:function(e){return t()[e]},getItem:function(t){return e[t]},setItem:function(t,n){e[t]=n,i=null},removeItem:function(t){delete e[t],i=null},clear:function(){t().forEach(function(t){delete e[t]}.bind(this)),i=null}};return Object.defineProperty(n,"length",{get:function(){return t().length}}),n}function s(e,t){if(t&&t instanceof XMLHttpRequest){var i,n;try{i=t.status,n=t.statusText}catch(o){i=0,n=""}return{status:i||0,statusText:n}}return t}function a(e){var t=e?JSON.parse(JSON.stringify(e,s)):e;return e instanceof Error&&(t.__isError=!0,t.message=t.message||e.message,t.name=t.name||e.name),t}function l(e,t){this.type=e,this.plugin=t}function c(e,t){this.__objectId=e,this.__methods=t}function d(n,o,r){function s(e){L&&r.postMessage(e,L)}function d(t){if(!L)return(new e).reject(new Error("plugin not connected"));t.id=String(j++);var i=new e;W[t.id]=i,i.then(null,function(e){"active"===B&&e instanceof Error&&"Cancel"===e.name&&s({requestId:t.id,method:"cancel",params:e.message?[e.message]:[]})});var n=Object.prototype.toString;return t.params.forEach(function(e,o){if("[object Object]"===n.call(e)&&!(e instanceof c)){var r,s;for(r in e)"[object Function]"===n.call(e[r])&&(s=s||[],s.push(r));if(s){var a=V++;z[a]=e;var l=function(){delete z[a]};i.then(l,l),t.params[o]=new c(a,s)}}}),r.postMessage(t,L),i.promise}function h(e,t){e||0===e?s({id:e,result:null,error:t}):console.log(t)}function u(e,t,i,n){n.forEach(function(e,t){if(e&&"undefined"!=typeof e.__objectId){var i={};e.__methods.forEach(function(t){i[t]=function(){return d({objectId:e.__objectId,method:t,params:Array.prototype.slice.call(arguments)})}}),n[t]=i}});var o="undefined"==typeof e?null:{id:e,result:null,error:null};try{var r=i.apply(t,n);if(!o)return;r&&"function"==typeof r.then?(U[e]=r,r.then(function(t){delete U[e],o.result=t,s(o)},function(t){U[e]&&(delete U[e],o.error=a(t),s(o))},function(){s({responseId:e,method:"progress",params:Array.prototype.slice.call(arguments)})})):(o.result=r,s(o))}catch(l){o&&(o.error=a(l),s(o))}}function p(e){try{if(e.method){var t=e.method,i=e.params||[];if("serviceId"in e){var n=E[e.serviceId];if(n)if(_(n)){var o=r.serviceRegistry;n=o.getService(n),t in n?u(e.id,n,n[t],i):h(e.id,"method not found")}else h(e.id,"not trusted");else h(e.id,"service not found")}else if("objectId"in e){var s=z[e.objectId];s?t in s?u(e.id,s,s[t],i):h(e.id,"method not found"):h(e.id,"object not found")}else if("requestId"in e){var a=U[e.requestId];a&&"cancel"===t&&a.cancel&&a.cancel.apply(a,i)}else if("responseId"in e){var l=W[e.responseId];l&&"progress"===t&&l.progress&&l.progress.apply(l,i)}else if("loading"===e.method)L.loading();else if("plugin"===e.method){L.connected();var c=e.params[0];k({headers:c.headers,services:c.services}).then(function(){x&&x.resolve(b)}),c.updateRegistry&&y()}else{if("timeout"!==e.method&&"error"!==e.method)throw new Error("Bad method: "+e.method);x&&x.reject(e.error)}}else if(e.id){var d=W[String(e.id)];if(d)if(delete W[String(e.id)],e.error){var p=r.handleServiceError(b,e.error);d.reject(p)}else d.resolve(e.result)}}catch(f){console.log("Plugin._messageHandler "+f)}}function f(e){var i={};if(e.methods&&(e.methods.forEach(function(t){i[t]=function(){var i={serviceId:e.serviceId,method:t,params:Array.prototype.slice.call(arguments)};return"active"===B?d(i):b.start({"transient":!0}).then(function(){return d(i)})}}),i.addEventListener&&i.removeEventListener)){var n=new t,o=V++;z[o]={handleEvent:n.dispatchEvent.bind(n)};var r=new c(o,["handleEvent"]),s=i.addEventListener;i.addEventListener=function(e,t){n._namedListeners[e]||s(e,r),n.addEventListener(e,t)};var a=i.removeEventListener;i.removeEventListener=function(e,t){n.removeEventListener(e,t),n._namedListeners[e]||a(e,r)}}return i}function g(e){var t=JSON.parse(JSON.stringify(e.properties));t.__plugin__=n;var i=e.names||e.type||[];return Array.isArray(i)||(i=[i]),t.objectClass=i,t}function m(e){var t=f(e),i=g(e),n=r.registerService(e.names||e.type,t,i);F[e.serviceId]={registration:n,proxy:t}}function v(){var e=[];return Object.keys(E).forEach(function(t){var i=E[t],n={};i.getPropertyKeys().forEach(function(e){n[e]=i.getProperty(e)}),["service.id","service.names","objectClass","__plugin__"].forEach(function(e){delete n[e]});var o=[],s=r.serviceRegistry,a=s.getService(i);for(var l in a)"function"==typeof a[l]&&o.push(l);e.push({serviceId:String(i.getProperty("service.id")),names:i.getProperty("service.names"),methods:o,properties:n})}),{services:e}}function _(e){var t=new URL(n);if(t.origin===location.origin)return!0;var i=e.getProperty("__plugin__");return t.origin===(i?new URL(i):location).origin}function y(){function e(e,t,i){var n=i.serviceReference,o=n.getProperty("service.id");!E[o]&&_(n)&&(e&&(E[o]=n),t&&delete E[o],y())}if(!E){E={};var t=r.serviceRegistry;t.getServiceReferences().forEach(function(e){_(e)&&(E[e.getProperty("service.id")]=e)}),t.addEventListener("registered",N=e.bind(null,!0,!1)),t.addEventListener("unregistered",A=e.bind(null,!1,!0)),t.addEventListener("modified",R=e.bind(null,!1,!1))}d({method:"plugin",params:[v()]})}function C(){var e=r.serviceRegistry;N&&e.removeEventListener("registered",N),A&&e.removeEventListener("unregistered",A),R&&e.removeEventListener("modified",R),N=A=R=null}function w(){r.persist(n,{created:I,headers:D,services:P,autostart:M,lastModified:O})}var b=this;o=o||{};var S,x,L,T,E,k,N,A,R,I=o.created||(new Date).getTime(),D=o.headers||{},P=o.services||[],M=o.autostart,O=o.lastModified||0,B="installed",F={},j=0,V=0,U={},W={},z={};this._default=!1,this._persist=w,this._resolve=function(){B="resolved",r.dispatchEvent(new l("resolved",b))},this._getAutostart=function(){return M},this._getCreated=function(){return I},this.getLocation=function(){return n},this.getHeaders=function(){return JSON.parse(JSON.stringify(D))},this.getName=function(){var e=this.getHeaders();return e?e.name||"":null},this.getVersion=function(){var e=this.getHeaders();return e?e.version||"0.0.0":null},this.getLastModified=function(){return O},this.getServiceReferences=function(){var e=[];return Object.keys(F).forEach(function(t){e.push(F[t].registration.getReference())}),e},this.setParent=function(t){return T!==t?(T=t,b.stop({"transient":!0}).then(function(){return"started"===M?b.start({"transient":!0}):"lazy"===M?b.start({lazy:!0,"transient":!0}):void 0})):(new e).resolve()},this.getState=function(){return B},this.getProblemLoading=function(){return b._problemLoading?!0:!1},this.start=function(t){if("uninstalled"===B)return(new e).reject(new Error("Plugin is uninstalled"));if(S)return S.promise.then(this.start.bind(this,t));if("active"===B)return(new e).resolve();if(!t||!t["transient"]){var i=t&&t.lazy?"lazy":"started";i!==M&&(M=i,w())}var o=r.getState();if("starting"!==o&&"active"!==o)return t["transient"]?(new e).reject(new Error("start transient error")):(new e).resolve();if("installed"===B)try{this._resolve()}catch(s){return(new e).reject(s)}if("resolved"===B&&P.forEach(function(e){m(e)}),t&&t.lazy){"starting"!==B&&(B="starting",r.dispatchEvent(new l("lazy activation",b)));var a=(new Date).getTime();return!this.getLastModified()||a>this.getLastModified()+864e5?this.update():(new e).resolve()}var c=new e;return S=c,B="starting",b._problemLoading=null,r.dispatchEvent(new l("starting",b)),x=new e,L=r.connect(n,p,T),x.then(function(){x=null,B="active",r.dispatchEvent(new l("started",b)),S=null,c.resolve()},function(e){x=null,B="stopping",r.dispatchEvent(new l("stopping",b)),Object.keys(F).forEach(function(e){F[e].registration.unregister(),delete F[e]}),r.disconnect(L),L=null,B="resolved",S=null,r.dispatchEvent(new l("stopped",b)),b._problemLoading=!0,c.reject(new Error("Failed to load plugin: "+n+(e&&e.message?"\n    Reason: "+e.message:""))),b._default&&(O=0,w())
}),c.promise},this.stop=function(t){if("uninstalled"===B)return(new e).reject(new Error("Plugin is uninstalled"));if(S)return S.promise.then(this.stop.bind(this,t));if(t&&t["transient"]||"stopped"!==M&&(M="stopped",w()),"active"!==B&&"starting"!==B)return(new e).resolve();var i=new e;return S=i,B="stopping",r.dispatchEvent(new l("stopping",b)),Object.keys(F).forEach(function(e){F[e].registration.unregister(),delete F[e]}),L&&(r.disconnect(L),L=null,C()),B="resolved",S=null,r.dispatchEvent(new l("stopped",b)),i.resolve(),i.promise},k=function(t){if(b.problemLoading=null,"uninstalled"===B)return(new e).reject(new Error("Plugin is uninstalled"));if(!t)return 0===O&&(O=(new Date).getTime(),w()),r.loadManifest(n).then(k,function(){b._problemLoading=!0,b._default&&(O=0,w()),console.log("Failed to load plugin: "+n)});var o=D,s=P,a=M;if(D=t.headers||{},P=t.services||[],M=t.autostart||M,t.lastModified?O=t.lastModified:(O=(new Date).getTime(),w()),i(D,o)&&i(P,s)&&M===a)return(new e).resolve();if("active"===B||"starting"===B){var c=[];Object.keys(P).forEach(function(e){var t=P[e];c.push(e);var n=F[e];if(n){if(i(t.methods,Object.keys(n.proxy))){var o=g(t),r=n.registration.getReference(),s={};return r.getPropertyKeys().forEach(function(e){s[e]=r.getProperty(e)}),void(i(o,s)||n.registration.setProperties(o))}n.registration.unregister(),delete F[e]}m(t)}),Object.keys(F).forEach(function(e){-1===c.indexOf(e)&&(F[e].registration.unregister(),delete F[e])})}return"active"===B&&(r.disconnect(L),x=new e,L=r.connect(n,p,T),x.then(function(){x=null},function(){x=null,B="stopping",r.dispatchEvent(new l("stopping"),b),Object.keys(F).forEach(function(e){F[e].registration.unregister(),delete F[e]}),r.disconnect(L),L=null,B="resolved",r.dispatchEvent(new l("stopped",b))})),(new e).resolve()},this.update=function(e){return k(e).then(function(){r.dispatchEvent(new l("updated",b))})},this.uninstall=function(){return"uninstalled"===B?(new e).reject(new Error("Plugin is uninstalled")):"active"===B||"starting"===B||"stopping"===B?this.stop().then(this.uninstall.bind(this),this.uninstall.bind(this)):(r.removePlugin(this),B="uninstalled",r.dispatchEvent(new l("uninstalled",b)),(new e).resolve())}}function h(i,s){function a(e,t){try{var i;if("undefined"==typeof e.useStructuredClone){var n="string"!=typeof t.data;i=n?t.data:JSON.parse(t.data),e.useStructuredClone=n}else i=e.useStructuredClone?t.data:JSON.parse(t.data);e.handler(i)}catch(o){}}function c(e){var t=e.source;w.some(function(i){return t===i.target?(a(i,e),!0):void 0})}s=s||{};var h=s.storage||localStorage;h.getItem||(h=r(h));var v,_=parseInt(h.getItem("pluginregistry.default.timeout"),10)||void 0,y="installed",C=[],w=[],b=new t,S={},x={serviceRegistry:i,registerService:i.registerService.bind(i),connect:function(e,t,i,n){function o(t){localStorage.pluginLogging&&console.log(t+"("+((new Date).getTime()-s._startTime)+"ms)="+e)}function r(e){o("timeout");var i=new Error(e);i.name="timeout",t({method:"timeout",error:i})}var s={handler:t,url:e};n=n||_,s._updateTimeout=function(){var t,i;if(!this._connected&&!this._closed)if(this._handshake){var o=0;w.forEach(function(e){e._connected||e._closed||(o+=1e3)}),t="Plugin handshake timeout for: "+e,i=this._loading?5e3:(n||6e4)+o}else t="Plugin load timeout for: "+e,i=n||15e3;this._loadTimeout&&clearTimeout(this._loadTimeout),this._loadTimeout=0,i&&(this._loadTimeout=setTimeout(r.bind(null,t),i))};var l=!(!e.match(p)||"undefined"==typeof Worker),c=!(!e.match(f)||"undefined"==typeof SharedWorker);if(localStorage.useSharedWorkers&&c||!e.match(f)||(e=e.replace(f,m),c=!1),localStorage.useWorkers&&l||!e.match(p)||(e=e.replace(p,g),l=c=!1),s.url=e,s._updateTimeout(),s._startTime=(new Date).getTime(),l){var d;c?(d=new SharedWorker(e),s.target=d.port,d.port.start(),s._close=function(){d.port.close()}):(d=new Worker(e),s.target=d,s._close=function(){d.terminate()}),s.postMessage=function(e){this.target.postMessage(this.useStructuredClone?e:JSON.stringify(e),[])},s.target.addEventListener("message",function(e){a(s,e)})}else{var h=document.createElement("iframe");h.name=e+"_"+s._startTime,h.src=e,h.onload=function(){o("handshake"),s._handshake=!0,s._updateTimeout()},h.sandbox="allow-scripts allow-same-origin allow-forms allow-popups",h.style.width=h.style.height="100%",h.frameBorder=0,(i||v).appendChild(h),s.target=h.contentWindow,s.postMessage=function(e){this.target.postMessage(this.useStructuredClone?e:JSON.stringify(e),this.url)},s._close=function(){if(h){var e=h.parentNode;e&&e.removeChild(h),h=null}}}return s.connected=function(){o("connected"),this._connected=!0,this._updateTimeout()},s.loading=function(){o("loading"),this._loading=!0,this._updateTimeout()},s.close=function(){o("closed"),this._closed=!0,this._updateTimeout(),this._close()},w.push(s),s},disconnect:function(e){for(var t=0;t<w.length;t++)if(e===w[t]){w.splice(t,1);try{e.close()}catch(i){}break}},removePlugin:function(e){for(var t=0;t<C.length;t++)if(e===C[t]){C.splice(t,1);break}h.removeItem("plugin."+e.getLocation())},getPersisted:function(e){var t="plugin."+e,i=h.getItem(t);return i&&(i=JSON.parse(i),i.created)?i:null},persist:function(e,t){h.setItem("plugin."+e,JSON.stringify(t))},postMessage:function(e,t){t.postMessage(e)},dispatchEvent:function(e){try{b.dispatchEvent(e)}catch(t){console&&console.log("PluginRegistry.dispatchEvent "+t)}},loadManifest:function(t){var i=new e,n=x.connect(t,function(e){if(n&&e.method)if("manifest"===e.method||"plugin"===e.method){var t=e.params[0];x.disconnect(n),n=null,i.resolve(t)}else"timeout"===e.method||"error"===e.method?(x.disconnect(n),n=null,i.reject(e.error)):"loading"===e.method&&n.loading()});return i.promise},getState:function(){return y},handleServiceError:function(e,t){if(t&&401===t.status){var i=e.getHeaders(),n=e.getName()||e.getLocation(),o=document.createElement("span");if(o.appendChild(document.createTextNode("Authentication required for: "+n+".")),i.login){o.appendChild(document.createTextNode(" "));var r=document.createElement("a");r.target="_blank",r.textContent="Login",r.href=i.login,u.test(r.href)?(o.appendChild(r),o.appendChild(document.createTextNode(" and re-try the request."))):console.log("Illegal Login URL: "+i.login)}var s=new XMLSerializer;return{Severity:"Error",HTML:!0,Message:s.serializeToString(o)}}if(t.__isError){var a=t;t=new Error(a.message),Object.keys(a).forEach(function(e){t[e]=a[e]}),delete t.__isError}return t}};this.getLocation=function(){return"System"},this.getHeaders=function(){return{}},this.getName=function(){return"System"},this.getVersion=function(){return"0.0.0"},this.getLastModified=function(){return 0},this.getState=x.getState,this.init=function(){"starting"!==y&&"active"!==y&&"stopping"!==y&&(addEventListener("message",c,!1),s.parent?v=s.parent:(v=document.createElement("div"),s.visible||(v.style.display="none",v.style.visibility="hidden"),document.body.appendChild(v)),s.plugins&&Object.keys(s.plugins).forEach(function(e){e=o(e);var t=this.getPlugin(e);if(t)t._default=!0;else{var i=s.plugins[e];"object"!=typeof i&&(i=x.getPersisted(e)||{}),i.autostart=i.autostart||s.defaultAutostart||"lazy",t=new d(e,i,x),t._default=!0,C.push(t)}}.bind(this)),C.sort(function(e,t){return e._getCreated()<t._getCreated()?-1:1}),y="starting")},this.start=function(){if("starting"!==y&&this.init(),"starting"!==y)return(new e).reject("Cannot start framework. Framework is already "+y+".");var t=[];return C.forEach(function(e){var i=e._getAutostart();"started"===i?t.push(e.start({"transient":!0})):"lazy"===i?t.push(e.start({lazy:!0,"transient":!0})):e._resolve()}),e.all(t,function(e){console.log("PluginRegistry.stop "+e)}).then(function(){y="active"})},this.stop=function(){if("starting"!==y&&"active"!==y)return(new e).reject("Cannot stop registry. Registry is already "+y+".");y="stopping";var t=[];return C.forEach(function(e){t.push(e.stop({"transient":!0}))}),e.all(t,function(e){console.log("PluginRegistry.stop "+e)}).then(function(){if(!s.parent){var e=v.parentNode;e&&e.removeChild(v)}v=null,removeEventListener("message",c),y="resolved"})},this.update=function(){this.stop().then(this.start.bind(this))},this.uninstall=function(){return(new e).reject("Cannot uninstall registry")},this.installPlugin=function(t,i){t=o(t);var r=this.getPlugin(t);if(r)return(new e).resolve(r);if(S[t])return S[t];if(i)return"lazy"===i.autostart&&(i=n({},x.getPersisted(t),i)),r=new d(t,i,x),C.push(r),r._persist(),x.dispatchEvent(new l("installed",r)),(new e).resolve(r);var s=x.loadManifest(t).then(function(e){return r=new d(t,e,x),C.push(r),r._persist(),delete S[t],x.dispatchEvent(new l("installed",r)),r},function(e){throw delete S[t],e});return S[t]=s,s},this.getPlugins=function(){return C.slice()},this.getPlugin=function(e){var t=null;return e=o(e),C.some(function(i){return e===i.getLocation()?(t=i,!0):void 0}),t},this.addEventListener=b.addEventListener.bind(b),this.removeEventListener=b.removeEventListener.bind(b),this.resolvePlugins=function(){var e=!0;return C.forEach(function(t){e=e&&t._resolve()}),e}}var u=new RegExp("^http[s]?","i"),p=/Worker\.js$/,f=/SharedWorker\.js$/,g="Plugin.html",m="Worker.js";return{Plugin:d,PluginRegistry:h}}),define("orion/objects",[],function(){function e(e){for(var t=Object.prototype.hasOwnProperty,i=1,n=arguments.length;n>i;i++){var o=arguments[i];for(var r in o)t.call(o,r)&&(e[r]=o[r])}return e}return{clone:function(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var i=Object.create(Object.getPrototypeOf(t));return e(i,t),i},mixin:e,toArray:function(e){return Array.isArray(e)?e:[e]}}}),define("orion/serviceTracker",[],function(){function e(e,n){function o(e){var t=e.getProperty("service.id"),i=this.addingService(e);i&&(c[t]=e,d[t]=i)}function r(e){var t=e.getProperty("service.id"),i=d[t];delete c[t],delete d[t],this.removedService(e,i)}function s(e){return-1!==e.getProperty("objectClass").indexOf(n)}this.serviceRegistry=e;var a,l,c={},d={},h=t;this.close=function(){if(h!==i)throw new Error("Already closed");h=t,e.removeEventListener("registered",a),e.removeEventListener("unregistering",l),a=null,l=null;var n=this;this.getServiceReferences().forEach(function(e){r.call(n,e)}),"function"==typeof this.onClose&&this.onClose()},this.getServiceReferences=function(){var e=Object.keys(c);return e.length?e.map(function(e){return c[e]}):null},this.open=function(c){if("undefined"==typeof c&&(c=!0),h!==t)throw new Error("Already open");h=i;var d=this;a=function(e){return s(e.serviceReference)&&(o.call(d,e.serviceReference),"function"==typeof d.onServiceAdded)?d.onServiceAdded(e.serviceReference,d.serviceRegistry.getService(e.serviceReference)):void 0},l=function(e){s(e.serviceReference)&&r.call(d,e.serviceReference)},e.addEventListener("registered",a),e.addEventListener("unregistering",l),c&&e.getServiceReferences(n).forEach(function(t){return o.call(d,t),"function"==typeof d.onServiceAdded?d.onServiceAdded(t,e.getService(t)):void 0}),"function"==typeof this.onOpen&&this.onOpen()}}var t=0,i=1;return e.prototype={addingService:function(e){return this.serviceRegistry.getService(e)},onOpen:null,onClose:null,onServiceAdded:null,removedService:function(){}},e}),define("orion/config",["orion/Deferred","orion/objects","orion/preferences","orion/serviceTracker"],function(e,t,i,n){var o,r,s,a,l,c=i.PreferencesService,d=c.DEFAULT_SCOPE,h="pid",u="orion.cm.managedservice",p="/cm/configurations";return o=function(t,i,o){function r(e,t,i){d[e]||(d[e]=[]),p[e]||(p[e]=[]),d[e].push(t),p[e].push(i)}function s(e,t,i){var n=d[e],o=p[e];n.length>1?n.splice(n.indexOf(t),1):delete d[e],o.length>1?o.splice(o.indexOf(i),1):delete p[e]}function a(e){return d[e]||[]}function l(e){return p[e]||[]}function c(e,t,n){t.forEach(function(o,r){try{var s=e[r].getProperty("__plugin__"),a=s&&i.getPlugin(s);(!s||a&&"active"===a.getState())&&t[r].updated(n)}catch(l){"undefined"!=typeof console&&console.log(l)}})}n.call(this,t,u);var d={},p={},f=function(i){var n=[];return i.plugin.getServiceReferences().forEach(function(e){if(-1!==e.getProperty("objectClass").indexOf(u)){var i=e.getProperty(h),r=t.getService(e);if(i&&r){var s=o._find(i),a=s&&s.getProperties();n.push(r.updated(a))}}}),e.all(n)};this.addingService=function(e){var i=e.getProperty(h),n=t.getService(e);return i&&n?(r(i,e,n),n):null},this.onServiceAdded=function(e,t){var i=e.getProperty(h),n=o._find(i);c([e],[t],n&&n.getProperties())},this.onOpen=function(){i.addEventListener("started",f)},this.onClose=function(){i.removeEventListener("started",f)},this.notifyUpdated=function(e){var t=e.getPid();c(a(t),l(t),e.getProperties())},this.notifyDeleted=function(e){var t=e.getPid();c(a(t),l(t),null)},this.removedService=function(e,t){var i=e.getProperty(h);s(i,e,t)}},r=function(){function e(e,t,i){this.store=new s(this,i),this.configAdmin=new a(this,this.store),this.tracker=new o(e,t,this.store)}return e.prototype={getConfigurationAdmin:function(){var e=this;return this.configAdmin._init().then(function(t){return e.tracker.open(),t})},notifyDeleted:function(e){this.tracker.notifyDeleted(e)},notifyUpdated:function(e){this.tracker.notifyUpdated(e)}},e}(),a=function(){function e(e,t){this.factory=e,this.store=t}return e.prototype={_prefName:p,_init:function(){var e=this;return this.store._init().then(function(){return e})},getConfiguration:function(e){return this.store.get(e)},getDefaultConfiguration:function(e){return this.store._find(e,d)},listConfigurations:function(){return this.store.list()}},e}(),s=function(){function t(t,i){this.factory=t,this.prefsService=i,this.configs=this.defaultConfigs=null,this.pref=null;var n=this;this.initPromise=e.all([this.prefsService.get(p,void 0,{scope:d}),this.prefsService.get(p)]).then(function(e){var t=e[0];n.pref=e[1],n.defaultConfigs=n._toConfigs(t,!0),n.configs=n._toConfigs(n.pref,!1,t)})}return t.prototype={_toConfigs:function(e,t,i){var n=Object.create(null),o=this;return Object.keys(e).forEach(function(r){if(!n[r]){var s=e[r],a=i&&i[r];"object"==typeof s&&null!==s&&Object.keys(s).length>0&&(s[h]=r,n[r]=new l(o.factory,o,s,t,a))}}),n},_init:function(){return this.initPromise},_find:function(e,t){return t===c.DEFAULT_SCOPE?this.defaultConfigs[e]||null:this.configs[e]||null},get:function(e){var t=this._find(e),i=this._find(e,d);if(!t){var n=i&&i.getProperties(!0);t=new l(this.factory,this,e,!1,n),this.configs[e]=t}return t},list:function(){var e=this,t=[];return Object.keys(this.pref).forEach(function(i){var n=e._find(i);n&&null!==n.getProperties()&&t.push(n)}),t},remove:function(e){return delete this.configs[e],delete this.pref[e],this.prefsService.remove(p,e)},save:function(e,t){var i=t.getProperties(!0)||{},n=this._find(e,d);if(n){var o=n.getProperties(!0);Object.keys(o).forEach(function(e){Object.prototype.hasOwnProperty.call(i,e)&&i[e]===o[e]&&delete i[e]})}var r={};return r[e]=i,this.pref[e]=i,this.prefsService.put(p,r)}},t}(),l=function(){function e(e,i){i=t.clone(i),delete i[h],e.properties=i}function i(t,i,n,o,r){if(this.factory=t,this.store=i,this.readOnly=o,null!==n&&"object"==typeof n)this.pid=n[h],e(this,n);else{if("string"!=typeof n)throw new Error("Invalid pid/properties "+n);this.pid=n,this.properties=null}if(r){this.properties=this.properties||Object.create(null);var s=this;Object.keys(r).forEach(function(e){e===h||Object.prototype.hasOwnProperty.call(s.properties,e)||(s.properties[e]=r[e])})}}return i.prototype={_checkReadOnly:function(){if(this.readOnly)throw new Error("Configuration is read only")},_checkRemoved:function(){if(this.removed)throw new Error("Configuration was removed")},getPid:function(){return this._checkRemoved(),this.pid},getProperties:function(e){this._checkRemoved();var i=null;return this.properties&&(i=t.clone(this.properties),e||(i[h]=this.pid)),i},remove:function(){return this._checkReadOnly(),this._checkRemoved(),this.store.remove(this.pid).then(function(){this.factory.notifyDeleted(this),this.removed=!0}.bind(this))},update:function(t){return this._checkReadOnly(),this._checkRemoved(),e(this,t),this.store.save(this.pid,this).then(function(){this.factory.notifyUpdated(this)}.bind(this))},toString:function(){return"[ConfigImpl pid: "+this.pid+", properties: "+JSON.stringify(this.properties)+"]"}},i}(),{ConfigurationAdminFactory:r}}),define("orion/bootstrap",["require","orion/Deferred","orion/serviceregistry","orion/preferences","orion/pluginregistry","orion/config"],function(e,t,i,n,o,r){function s(){if(a)return a;var s=e.specified("orion/splash")&&e("orion/splash");s&&s.nextStep(),a=new t;var l=new i.ServiceRegistry,c=new n.PreferencesService(l);return c.get("/plugins").then(function(i){var d={plugins:{}};Object.keys(i).forEach(function(t){var n=e.toUrl(t);d.plugins[n]=i[t]});var h=new o.PluginRegistry(l,d);return s&&s.setPluginRegistry(h),h.start().then(function(){return l.getServiceReferences("orion.core.preference.provider").length>0?c.get("/plugins",void 0,{scope:n.PreferencesService.USER_SCOPE}).then(function(i){var n=[];return Object.keys(i).forEach(function(t){var i=e.toUrl(t);h.getPlugin(i)||n.push(h.installPlugin(i,{autostart:"lazy"}).then(function(e){return e.start({lazy:!0})}))}),t.all(n,function(e){console.log(e)})}):void 0}).then(function(){return new r.ConfigurationAdminFactory(l,h,c).getConfigurationAdmin().then(l.registerService.bind(l,"orion.cm.configadmin"))}).then(function(){var e=l.getService("orion.core.auth");if(e){var t=e.getUser().then(function(t){return t?void localStorage.setItem("lastLogin",(new Date).getTime()):e.getAuthForm(window.location.href).then(function(e){setTimeout(function(){window.location=e},0)})}),i=localStorage.getItem("lastLogin");if(!i||i<(new Date).getTime()-9e5)return t}}).then(function(){var e={serviceRegistry:l,preferences:c,pluginRegistry:h};return s&&s.nextStep(),a.resolve(e),e})})}var a;return{startup:s}}),function(){"use strict";function e(e,t,i,n,o,r){t[e]&&(i.push(e),(t[e]===!0||1===t[e])&&n.push(o+e+"/"+r))}function t(e,t,i,n,o){var r=n+t+"/"+o;require._fileExists(e.toUrl(r+".js"))&&i.push(r)}function i(e,t,n){var o;for(o in t)!t.hasOwnProperty(o)||e.hasOwnProperty(o)&&!n?"object"==typeof t[o]&&(!e[o]&&t[o]&&(e[o]={}),i(e[o],t[o],n)):e[o]=t[o]}var n=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(o){var r=o.config?o.config():{};return{version:"2.0.4",load:function(o,s,a,l){l=l||{},l.locale&&(r.locale=l.locale);var c,d,h,u=n.exec(o),p=u[1],f=u[4],g=u[5],m=f.split("-"),v=[],_={},y="";if(u[5]?(p=u[1],c=p+g):(c=o,g=u[4],f=r.locale,f||(f=r.locale="undefined"==typeof navigator?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),m=f.split("-")),l.isBuild){for(v.push(c),t(s,"root",v,p,g),d=0;d<m.length;d++)h=m[d],y+=(y?"-":"")+h,t(s,y,v,p,g);if(l.locales){var C,w;for(C=0;C<l.locales.length;C++)for(f=l.locales[C],m=f.split("-"),y="",w=0;w<m.length;w++)h=m[w],y+=(y?"-":"")+h,t(s,y,v,p,g)}s(v,function(){a()})}else s([c],function(t){var n,o=[];for(e("root",t,o,v,p,g),d=0;d<m.length;d++)n=m[d],y+=(y?"-":"")+n,e(y,t,o,v,p,g);s(v,function(){var e,n,r;for(e=o.length-1;e>-1&&o[e];e--)r=o[e],n=t[r],(n===!0||1===n)&&(n=s(p+r+"/"+g)),i(_,n);a(_)})})}}})}(),define("orion/edit/nls/messages",{root:!0,de:!0,es:!0,fr:!0,it:!0,ja:!0,ko:!0,"pt-br":!0,zh:!0,"zh-hk":!0,"zh-tw":!0}),define("orion/edit/nls/root/messages",{Editor:"Editor",switchEditor:"Switch Editor",Fetching:"Fetching: ${0}",confirmUnsavedChanges:"There are unsaved changes. Do you still want to navigate away?",searchFilesCommand:"Quick Search...",searchFiles:"Quick Search in ${0}",searchTerm:"Enter search term:",unsavedChanges:"There are unsaved changes.",unsavedAutoSaveChanges:"Please stay on the page until Auto Save is complete.",Save:"Save",Saved:"Saved",Blame:"Blame",BlameTooltip:"Show blame annotations",Diff:"Diff",DiffTooltip:"Show diff annotations",saveOutOfSync:"Resource is out of sync with the server. Do you want to save it anyway?",loadOutOfSync:"Resource is out of sync with the server. Do you want to load it anyway? This will overwrite your local changes.",ReadingMetadata:"Reading metadata of ${0}",ReadingMetadataError:"Cannot get metadata of ${0}",Reading:"Reading ${0}",ReloadWith:"Reload With",readonly:"Read Only.",saveFile:"Save this file",toggleZoomRuler:"Toggle Zoom Ruler",gotoLine:"Go to Line...",gotoLineTooltip:"Go to specified line number",gotoLinePrompt:"Go to line:",Undo:"Undo",Redo:"Redo",Cut:"Cut",Copy:"Copy",Paste:"Paste",Find:"Find...",noResponse:"No response from server. Check your internet connection and try again.",savingFile:"Saving file ${0}",running:"Running ${0}","Saving...":"Saving...",View:"View",SplitSinglePage:"Single Page",SplitVertical:"Split Vertical",SplitHorizontal:"Split Horizontal",SplitPipInPip:"Picture in Picture",SplitModeTooltip:"Change split editor mode",SidePanel:"Side Panel",SidePanelTooltip:"Choose what to show in the side panel.",Slideout:"Slideout",Actions:"Actions",Navigator:"Navigator",FolderNavigator:"Folder Navigator",Project:"Project",New:"New",File:"File",Edit:"Edit",Tools:"Tools",Add:"Add",noActions:"There are no actions for the current selection.",NoFile:"Use the ${0} to create new files and folders. Click a file to start coding.",LocalEditorSettings:"Local Editor Settings",NoProject:"${0} is not a project. To convert it to a project use ${1}.",NoProjects:"There are no projects in your workspace. Use the ${0} menu to create projects.",Disconnected:"${0} (disconnected)",ChooseFS:"Choose Filesystem",ChooseFSTooltip:"Choose the filesystem you want to view.",FSTitle:"${0} (${1})",Deploy:"Deploy","Deploy As":"Deploy As",Import:"Import",Export:"Export",OpenWith:"Open With",OpenRelated:"Open Related",Dependency:"Dependency",UnnamedCommand:"Unnamed",searchInFolder:"Folder Search...","Global Search":"Global Search...",ClickEditLabel:"Click to edit",ProjectInfo:"Project Information",Name:"Name",Description:"Description",Site:"Site",projectsSectionTitle:"Projects",listingProjects:"Listing projects...",gettingWorkspaceInfo:"Getting workspace information...",showProblems:"Show Problems...",showTooltip:"Show Tooltip",showTooltipTooltip:"Shows the tooltip immediately based on the caret position",emptyDeploymentInfoMessage:"Use the Launch Configurations dropdown to deploy this project"}),define("orion/util",[],function(){function e(e){var t=arguments;return e.replace(/\$\{([^\}]+)\}/g,function(e,i){return t[(i<<0)+1]})}function t(e,t){return e.createElementNS?e.createElementNS(_,t):e.createElement(t)}var i=navigator.userAgent,n=-1!==i.indexOf("MSIE")||-1!==i.indexOf("Trident")?document.documentMode:void 0,o=parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0,r=-1!==i.indexOf("Opera")?parseFloat(i.split("Version/")[1]):void 0,s=parseFloat(i.split("Chrome/")[1])||void 0,a=-1!==i.indexOf("Safari")&&!s,l=parseFloat(i.split("WebKit/")[1])||void 0,c=-1!==i.indexOf("Android"),d=-1!==i.indexOf("iPad"),h=-1!==i.indexOf("iPhone"),u=d||h,p=-1!==navigator.platform.indexOf("Mac"),f=-1!==navigator.platform.indexOf("Win"),g=-1!==navigator.platform.indexOf("Linux"),m="undefined"!=typeof document&&"ontouchstart"in document.createElement("input"),v=f?"\r\n":"\n",_="http://www.w3.org/1999/xhtml";return{formatMessage:e,createElement:t,isIE:n,isFirefox:o,isOpera:r,isChrome:s,isSafari:a,isWebkit:l,isAndroid:c,isIPad:d,isIPhone:h,isIOS:u,isMac:p,isWindows:f,isLinux:g,isTouch:m,platformDelimiter:v}}),define("orion/webui/littlelib",["orion/util"],function(e){function t(e,t){return t||(t=document),t.querySelector(e)}function i(e,t){return t||(t=document),t.querySelectorAll(e)}function n(e,t){return Array.prototype.slice.call(i(e,t))}function o(e){var t=e;return"string"==typeof e&&(t=document.getElementById(e)),t}function r(e,t){if(!e||!t)return!1;if(e===t)return!0;var i=e.compareDocumentPosition(t);return Boolean(16&i)}function s(e){var t=e.getBoundingClientRect(),i=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),n=Math.max(document.documentElement.scrollTop,document.body.scrollTop);return{left:t.left+i,top:t.top+n,width:t.width,height:t.height}}function a(e){for(;e.hasChildNodes();){var t=e.firstChild;e.removeChild(t)}}function l(t){var i=t.tabIndex;if(0===i&&e.isIE){var n={a:!0,body:!0,button:!0,frame:!0,iframe:!0,img:!0,input:!0,isindex:!0,object:!0,select:!0,textarea:!0};n[t.nodeName.toLowerCase()]||t.attributes.tabIndex||(i=-1)}return i}function c(e){if(l(e)>=0)return e;if(e.hasChildNodes())for(var t=0;t<e.childNodes.length;t++){var i=c(e.childNodes[t]);if(i)return i}return null}function d(e){if(l(e)>=0)return e;if(e.hasChildNodes())for(var t=e.childNodes.length-1;t>=0;t--){var i=d(e.childNodes[t]);if(i)return i}return null}function h(e,t){if(3===e.nodeType){var i=b.exec(e.nodeValue);i&&i.length>1&&t(e,i)}if(e.hasChildNodes())for(var n=0;n<e.childNodes.length;n++)h(e.childNodes[n],t)}function u(e,t){if(!e||!t)return 0;var i=e.ownerDocument,n=i.defaultView||i.parentWindow;if(n.getComputedStyle){var o=n.getComputedStyle(e,null),r=o.getPropertyValue(t);if(r.length>2&&-1!==r.indexOf("px",r.length-2)){r=r.slice(0,-2);var s=parseInt(r,10);return s!==s?0:s}}return 0}function p(e,t){h(e,function(e,i){var n=t[i[1]]||i[1];e.parentNode.replaceChild(document.createTextNode(n),e)})}function f(e,t){h(e,function(e,i){var n=t[i[1]];if(n){var o=document.createRange(),r=i.index;o.setStart(e,r),o.setEnd(e,r+i[0].length),o.deleteContents(),o.insertNode(n)}})}function g(t,i){function n(e){S.forEach(function(t){var i=!1,n=t.excludeNodes.some(function(t){return document.body.contains(t)?(i=!0,t.contains(e.target)):!1});if(i&&!n)try{t.dismiss(e)}catch(o){"undefined"!=typeof console&&console&&console.error(o&&o.message)}}),S=S.filter(function(e){return e.excludeNodes.some(function(e){return document.body.contains(e)})})}null===S&&(S=[],document.addEventListener("click",n,!0),e.isIOS&&document.addEventListener("touchend",function(e){function t(){e.target.removeEventListener("click",t)}0===e.touches.length&&e.target.addEventListener("click",t)},!1)),S.push({excludeNodes:t,dismiss:i})}function m(e){S=S.filter(function(t){return e!==t.dismiss})}function v(e){for(var t=e.parentNode,i=document.documentElement;t&&t!==i;){var n=window.getComputedStyle(t,null);if(!n)break;var o=n.getPropertyValue("overflow-y");if("auto"===o||"scroll"===o)break;t=t.parentNode}return t}function _(e){window.document.all&&(e.keyCode=0),e.preventDefault&&(e.preventDefault(),e.stopPropagation())}function y(e){for(var t=document.getElementsByTagName("iframe"),i=0;i<t.length;i++)t[i].parentNode.style.pointerEvents=e?"":"none"}function C(e){return L[e]||null}function w(e,t){var i=t,n=null;return void 0===i&&(i=document.createElement("div")),i.innerHTML=e,n=i.children.length>1?i.children:i.firstChild}var b=/\$\{([^\}]+)\}/,S=null,x={BKSPC:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DEL:46,COMMAND:991},L=Object.create(null);return Object.keys(x).forEach(function(e){L[x[e]]=e}),{$:t,$$:i,$$array:n,node:o,contains:r,bounds:s,empty:a,firstTabbable:c,lastTabbable:d,pixelValueOf:u,stop:_,processTextNodes:p,processDOMNodes:f,addAutoDismiss:g,setFramesEnabled:y,getOffsetParent:v,removeAutoDismiss:m,keyName:C,KEY:x,createNodes:w}}),define("orion/commandsProxy",["orion/util","orion/webui/littlelib"],function(e,t){function i(t,i){function n(t){if(e.isMac){if(t.metaKey&&!t.altKey)return t.shiftKey||t.ctrlKey||65!==t.keyCode&&67!==t.keyCode&&86!==t.keyCode&&88!==t.keyCode&&90!==t.keyCode?!1:!0;if(t.ctrlKey)return!1}else{if(t.ctrlKey&&!t.altKey)return t.shiftKey||65!==t.keyCode&&67!==t.keyCode&&86!==t.keyCode&&88!==t.keyCode&&90!==t.keyCode?!1:!0;if(t.altKey&&!t.ctrlKey)return!1;if(t.ctrlKey&&t.altKey)return!1}if(t["char"])return t["char"].length>0;if(t.charCode||t.keyCode){var i=t.charCode||t.keyCode;switch(i){case 8:case 9:case 13:case 46:return!0;default:return i>=32&&112>i||i>123}}return!1}if(t=t||window.event,n(t)){if("true"===t.target.contentEditable)return;var o=t.target.nodeName.toLowerCase();if("input"===o){var r=t.target.type.toLowerCase();switch(r){case"text":case"password":case"search":case"color":case"date":case"datetime":case"datetime-local":case"email":case"month":case"number":case"range":case"tel":case"time":case"url":case"week":return}}else if("textarea"===o)return}i(t)}function n(){this._init()}return n.prototype={destroy:function(){this._listener&&(document.removeEventListener("keydown",this._listener),this._listener=null)},setProxy:function(e){this.proxy=e},setKeyBindings:function(e){this.bindings=e},_init:function(){var e=this;document.addEventListener("keydown",this._listener=function(n){return i(n,function(i){var n=e.proxy,o=e.bindings;if(o&&n)for(var r=0;r<o.length;r++)o[r].match(i)&&(n.processKey({type:i.type,keyCode:i.keyCode,altKey:i.altKey,ctrlKey:i.ctrlKey,metaKey:i.metaKey,shiftKey:i.shiftKey}),t.stop(i))})})}},{handleKeyEvent:i,CommandsProxy:n}}),define("orion/webui/dropdown",["orion/webui/littlelib","orion/EventTarget"],function(e,t){function i(e){t.attach(this),this._init(e)}function n(e,t){t=void 0===t?"span":t;var i=document.createElement(t);if(i.tabIndex=0,i.className="dropdownMenuItem",i.setAttribute("role","menuitem"),e){var n=document.createElement("span");n.appendChild(document.createTextNode(e)),n.classList.add("dropdownCommandName"),i.appendChild(n)}var o=document.createElement("li");return o.appendChild(i),o}function o(){var e=document.createElement("li");return e.classList.add("dropdownSeparator"),e}function r(e,t){var i=document.createElement("span");i.classList.add("dropdownKeyBinding"),i.appendChild(document.createTextNode(t)),e.appendChild(i)}return i.prototype={_init:function(t){if(this._dropdownNode=e.node(t.dropdown),!this._dropdownNode)throw"no dom node for dropdown found";if(this._populate=t.populate,this._selectionClass=t.selectionClass,this._parentDropdown=t.parentDropdown,this._positioningNode=t.positioningNode,!this._parentDropdown)for(var i=this._dropdownNode.parentNode;i&&document!==i;){if(i.classList&&i.classList.contains("dropdownMenu")){this._parentDropdown=i.dropdown;break}i=i.parentNode}if(this._dropdownNode.tabIndex=0,this._triggerNode=t.triggerNode?t.triggerNode:e.$(".dropdownTrigger",this._dropdownNode.parentNode),!this._triggerNode)throw"no dom node for dropdown trigger found";var n=function(t){var i=!1;i=this._triggerNode.classList.contains("dropdownMenuItem")?this.open(t):this.toggle(t),i&&e.stop(t)}.bind(this);t.skipTriggerEventListeners||(this._triggerNode.addEventListener("click",n,!1),"span"===this._triggerNode.tagName.toLowerCase()&&this._triggerNode.addEventListener("keydown",function(t){(t.keyCode===e.KEY.ENTER||t.keyCode===e.KEY.SPACE)&&n(t)}.bind(this),!1)),this._dropdownNode.addEventListener("keydown",this._dropdownKeyDown.bind(this),!1)},addTriggerNode:function(t){var i=this;t.addEventListener("click",function(t){i.toggle(t)&&e.stop(t)},!1)},toggle:function(e){return this.isVisible()?this.close():this.open(e)},isVisible:function(){return this._isVisible},open:function(t){var i=!1;if(!this.isVisible()){this.dispatchEvent({type:"triggered",dropdown:this,event:t}),this._populate&&(this.empty(),this._populate(this._dropdownNode));var n=this.getItems();if(n.length>0){e.setFramesEnabled(!1),this._boundAutoDismiss&&e.removeAutoDismiss(this._boundAutoDismiss),this._boundAutoDismiss=this._autoDismiss.bind(this);var o=e.$$array(".dropdownSubMenu",this._dropdownNode);e.addAutoDismiss([this._triggerNode].concat(o),this._boundAutoDismiss),this._triggerNode.classList.add("dropdownTriggerOpen"),this._selectionClass&&this._triggerNode.classList.add(this._selectionClass),this._dropdownNode.classList.add("dropdownMenuOpen"),this._isVisible=!0,this._positionDropdown(t),this._focusDropdownNode(),i=!0,this._parentDropdown&&this._parentDropdown.submenuOpen(this)}}return i},_focusDropdownNode:function(){this._dropdownNode.focus()},_autoDismiss:function(e){if(this.close(!1)&&this._dropdownNode.contains(e.target))for(var t=this._parentDropdown;t;)t.close(!1),t=t._parentDropdown},_positionDropdown:function(){if(this._dropdownNode.style.left="",this._dropdownNode.style.top="",this._positioningNode)return void(this._dropdownNode.style.left=this._positioningNode.offsetLeft+"px");
var t=e.bounds(this._dropdownNode),i=e.bounds(document.body);if(t.left+t.width>i.left+i.width)if(this._triggerNode.classList.contains("dropdownMenuItem"))this._dropdownNode.style.left=-t.width+"px";else{var n=e.bounds(this._boundingNode(this._triggerNode)),o=e.bounds(this._triggerNode);this._dropdownNode.style.left=o.left-n.left-t.width+o.width+"px"}var r=t.top+t.height-(i.top+i.height);r>0&&(this._dropdownNode.style.top=Math.floor(this._dropdownNode.style.top-r)+"px")},_boundingNode:function(e){var t=window.getComputedStyle(e,null);if(null===t)return e;var i=t.getPropertyValue("position");return"absolute"!==i&&e.parentNode&&e!==document.body?this._boundingNode(e.parentNode):e},close:function(t){var i=!1;return this.isVisible()&&(this._triggerNode.classList.remove("dropdownTriggerOpen"),this._selectionClass&&this._triggerNode.classList.remove(this._selectionClass),this._dropdownNode.classList.remove("dropdownMenuOpen"),e.setFramesEnabled(!0),t&&this._triggerNode.focus(),this._isVisible=!1,this._selectedItem&&(this._selectedItem.classList.remove("dropdownMenuItemSelected"),this._selectedItem=null),this._boundAutoDismiss&&(e.removeAutoDismiss(this._boundAutoDismiss),this._boundAutoDismiss=null),i=!0),i},getItems:function(){var t=e.$$array("li:not(.dropdownSeparator) > .dropdownMenuItem",this._dropdownNode,!0),i=[],n=this;return t.forEach(function(e){e.parentNode.parentNode===n._dropdownNode&&i.push(e)}),i.forEach(function(t){t._hasDropdownMouseover||(t.addEventListener("mouseover",function(i){t.dropdown?t.dropdown.open(i):(n._closeSelectedSubmenu(),e.stop(i)),n._selectItem(t)}),t._hasDropdownMouseover=!0)}),i},empty:function(){var t=e.$$array("li",this._dropdownNode),i=this;t.forEach(function(e){e.parentNode===i._dropdownNode&&e.parentNode.removeChild(e)})},_dropdownKeyDown:function(t){if(t.keyCode===e.KEY.UP||t.keyCode===e.KEY.DOWN||t.keyCode===e.KEY.RIGHT||t.keyCode===e.KEY.ENTER||t.keyCode===e.KEY.LEFT){var i=this.getItems();if(i.length&&i.length>0){if(this._selectedItem){var n=i.indexOf(this._selectedItem);0>n&&(n=i.indexOf(this._selectedItem.parentNode)),n>=0&&(t.keyCode===e.KEY.UP&&n>0?(n--,this._selectItem(i[n])):t.keyCode===e.KEY.DOWN&&n<i.length-1?(n++,this._selectItem(i[n])):t.keyCode===e.KEY.ENTER||t.keyCode===e.KEY.RIGHT?this._selectedItem.classList.contains("dropdownTrigger")&&this._selectedItem.dropdown?(this._selectedItem.dropdown.open(),this._selectedItem.dropdown._selectItem()):t.keyCode===e.KEY.ENTER&&this._selectedItem.click():t.keyCode===e.KEY.LEFT&&this._selectedItem.parentNode.parentNode.classList.contains("dropdownMenuOpen")&&(this.close(!0),this._parentDropdown&&this._parentDropdown._dropdownNode.focus()))}else this._selectItem(i[0]);e.stop(t)}}else t.keyCode===e.KEY.ESCAPE&&(this.close(!0),e.stop(t))},_selectItem:function(e){var t=e||this.getItems()[0];t&&(this._selectedItem&&this._selectedItem.classList.remove("dropdownMenuItemSelected"),this._selectedItem=t,this._selectedItem.classList.add("dropdownMenuItemSelected")),document.activeElement!==this._dropdownNode&&this._dropdownNode.focus()},submenuOpen:function(e){e!==this._selectedSubmenu&&(this._closeSelectedSubmenu(),this._selectedSubmenu=e)},_closeSelectedSubmenu:function(){for(var e=this._selectedSubmenu;e;)e.close(),e=e._selectedSubmenu},destroy:function(){this.empty(),this._boundAutoDismiss&&(e.removeAutoDismiss(this._boundAutoDismiss),this._boundAutoDismiss=null)},appendMenuItem:function(e,t){var i=n(e,t);return this._dropdownNode.appendChild(i),i},appendSeparator:function(){var e=o();return this._dropdownNode.appendChild(e),e}},i.prototype.constructor=i,{Dropdown:i,appendKeyBindingString:r,createMenuItem:n,createSeparator:o}}),define("text",["module"],function(e){"use strict";var t,i,n,o,r,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,d=c&&location.protocol&&location.protocol.replace(/\:/,""),h=c&&location.hostname,u=c&&(location.port||void 0),p={},f=e.config&&e.config()||{};return t={version:"2.0.12",strip:function(e){if(e){e=e.replace(a,"");var t=e.match(l);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:f.createXhr||function(){var e,t,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){i=s[t];try{e=new ActiveXObject(i)}catch(n){}if(e){s=[i];break}}return e},parseName:function(e){var t,i,n,o=!1,r=e.indexOf("."),s=0===e.indexOf("./")||0===e.indexOf("../");return-1!==r&&(!s||r>1)?(t=e.substring(0,r),i=e.substring(r+1,e.length)):t=e,n=i||t,r=n.indexOf("!"),-1!==r&&(o="strip"===n.substring(r+1),n=n.substring(0,r),i?i=n:t=n),{moduleName:t,ext:i,strip:o}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,i,n,o){var r,s,a,l=t.xdRegExp.exec(e);return l?(r=l[2],s=l[3],s=s.split(":"),a=s[1],s=s[0],!(r&&r!==i||s&&s.toLowerCase()!==n.toLowerCase()||(a||s)&&a!==o)):!0},finishLoad:function(e,i,n,o){n=i?t.strip(n):n,f.isBuild&&(p[e]=n),o(n)},load:function(e,i,n,o){if(o&&o.isBuild&&!o.inlineText)return void n();f.isBuild=o&&o.isBuild;var r=t.parseName(e),s=r.moduleName+(r.ext?"."+r.ext:""),a=i.toUrl(s),l=f.useXhr||t.useXhr;return 0===a.indexOf("empty:")?void n():void(!c||l(a,d,h,u)?t.get(a,function(i){t.finishLoad(e,r.strip,i,n)},function(e){n.error&&n.error(e)}):i([s],function(e){t.finishLoad(r.moduleName+"."+r.ext,r.strip,e,n)}))},write:function(e,i,n){if(p.hasOwnProperty(i)){var o=t.jsEscape(p[i]);n.asModule(e+"!"+i,"define(function () { return '"+o+"';});\n")}},writeFile:function(e,i,n,o,r){var s=t.parseName(i),a=s.ext?"."+s.ext:"",l=s.moduleName+a,c=n.toUrl(s.moduleName+a)+".js";t.load(l,n,function(){var i=function(e){return o(c,e)};i.asModule=function(e,t){return o.asModule(e,c,t)},t.write(e,l,i,r)},r)}},"node"===f.env||!f.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(i=require.nodeRequire("fs"),t.get=function(e,t,n){try{var o=i.readFileSync(e,"utf8");0===o.indexOf("﻿")&&(o=o.substring(1)),t(o)}catch(r){n&&n(r)}}):"xhr"===f.env||!f.env&&t.createXhr()?t.get=function(e,i,n,o){var r,s=t.createXhr();if(s.open("GET",e,!0),o)for(r in o)o.hasOwnProperty(r)&&s.setRequestHeader(r.toLowerCase(),o[r]);f.onXhr&&f.onXhr(s,e),s.onreadystatechange=function(){var t,o;4===s.readyState&&(t=s.status||0,t>399&&600>t?(o=new Error(e+" HTTP status: "+t),o.xhr=s,n&&n(o)):i(s.responseText),f.onXhrComplete&&f.onXhrComplete(s,e))},s.send(null)}:"rhino"===f.env||!f.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var i,n,o="utf-8",r=new java.io.File(e),s=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),o)),l="";try{for(i=new java.lang.StringBuffer,n=a.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&i.append(n);null!==(n=a.readLine());)i.append(s),i.append(n);l=String(i.toString())}finally{a.close()}t(l)}:("xpconnect"===f.env||!f.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,o=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),r="@mozilla.org/windows-registry-key;1"in n,t.get=function(e,t){var i,s,a,l={};r&&(e=e.replace(/\//g,"\\")),a=new FileUtils.File(e);try{i=n["@mozilla.org/network/file-input-stream;1"].createInstance(o.nsIFileInputStream),i.init(a,1,0,!1),s=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(o.nsIConverterInputStream),s.init(i,"utf-8",i.available(),o.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(i.available(),l),s.close(),i.close(),t(l.value)}catch(c){throw new Error((a&&a.path||"")+": "+c)}}),t}),define("text!orion/webui/dropdowntriggerbutton.html",[],function(){return'<button class="dropdownTrigger">${ButtonText}<!--span class="dropdownArrowDown core-sprite-openarrow"></span--></button><ul class="dropdownMenu"></ul>'}),define("text!orion/webui/dropdowntriggerbuttonwitharrow.html",[],function(){return'<button class="dropdownTrigger dropdownDefaultButton">${ButtonText}<span class="dropdownArrowDown core-sprite-openarrow"></span></button><ul class="dropdownMenu"></ul>'}),define("text!orion/webui/checkedmenuitem.html",[],function(){return'<li><label class="dropdownMenuItem"><input class="checkedMenuItem" role="menuitem" type="checkbox" />${ItemText}</label></li>'}),define("orion/webui/tooltip",["orion/webui/littlelib"],function(e){function t(e){this._init(e)}return t.prototype={_init:function(t){if(this._node=e.node(t.node),!this._node)throw"no dom node for tooltip found";this._position=t.position||["right","above","below","left"],this._text=t.text,this._hideDelay=void 0===t.hideDelay?200:t.hideDelay,this._tailSize=t.tailSize||10,this._trigger=t.trigger||"mouseover",this._afterShowing=t.afterShowing,this._afterHiding=t.afterHiding;var i=this;if("click"===this._trigger)this._showDelay=0,this._node.addEventListener("click",this._clickHandler=function(t){t.target===i._node&&(i.show(),e.stop(t))},!1);else if("mouseover"===this._trigger){this._showDelay=void 0===t.showDelay?500:t.showDelay;var n=["mouseout","click"];this._node.addEventListener("mouseover",this._mouseoverHandler=function(t){e.contains(i._node,t.target)&&(i.show(),e.stop(t))},!1),this._leaveHandler=function(t){e.contains(i._node,t.target)&&i.hide()};for(var o=0;o<n.length;o++)this._node.addEventListener(n[o],this._leaveHandler,!1)}else"focus"===this._trigger&&(this._showDelay=void 0===t.showDelay?0:t.showDelay,this._hideDelay=void 0===t.hideDelay?0:t.hideDelay,this._node.addEventListener("focus",this._focusHandler=function(t){e.contains(i._node,t.target)&&i.show()},!1),this._blurHandler=function(t){e.contains(i._node,t.target)&&i.hide()},this._node.addEventListener("blur",this._blurHandler,!1))},_makeTipNode:function(){if(!this._tip){if(this._tip=document.createElement("span"),this._tip.classList.add("tooltipContainer"),this._tipInner=document.createElement("div"),this._tipInner.classList.add("tooltip"),this._text){this._tipTextContent=document.createElement("div"),this._tipTextContent.classList.add("textContent"),this._tipInner.appendChild(this._tipTextContent);var t=document.createTextNode(this._text);this._tipTextContent.appendChild(t)}this._tip.appendChild(this._tipInner),document.body.appendChild(this._tip);var i=this;e.addAutoDismiss([this._tip,this._node],function(){i.hide()}),"mouseover"===this._trigger&&(this._tipInner.setAttribute("role","tooltip"),this._tipInner.id="tooltip"+(new Date).getTime().toString(),this._node.setAttribute("aria-describedby",this._tipInner.id),this._tip.addEventListener("mouseover",function(){i._timeout&&(window.clearTimeout(i._timeout),i._timeout=null),i._tip.addEventListener("mouseout",function(t){e.contains(i._tip,t.target)&&(i.hide(),e.stop(t))},!1)},!1))}return this._tip},_positionTip:function(t,i){this._makeTipNode(),this._tip.classList.add("tooltipShowing"),"left"===t?this._tipInner.classList.add("left"):this._tipInner.classList.remove("left");var n,o=this._node;for(n=e.bounds(o);o&&!n.width&&!n.height;o=o.parentNode)n=e.bounds(o);var r,s,a=e.bounds(this._tipInner);switch(t){case"above":r=n.top-a.height-this._tailSize-1,s=n.left-this._tailSize;break;case"below":r=n.top+n.height+this._tailSize+1,s=n.left-this._tailSize;break;case"left":r=n.top-this._tailSize/2,s=n.left-a.width-this._tailSize-1;break;default:r=n.top-this._tailSize/2,s=n.left+n.width+this._tailSize+1}var l=document.body,c=document.documentElement,d=Math.max(c.scrollLeft,l.scrollLeft),h=Math.max(c.scrollTop,l.scrollTop),u=d+c.clientWidth,p=h+c.clientHeight;if(r+a.height>p){if(!i)return!1;r=p-a.height-1}if(s+a.width>u){if(!i)return!1;s=u-a.width-1}if(d>s){if(!i)return!1;s=d+4}if(h>r){if(!i)return!1;r=h+4}return this._tail&&this._tail.previousPosition!==t&&(this._tip.removeChild(this._tail),this._tail=null),this._tail||(this._tail=document.createElement("span"),this._tail.classList.add("tooltipTailFrom"+t),"above"===t||"left"===t?this._tip.appendChild(this._tail):this._tip.insertBefore(this._tail,this._tipInner),this._tail.previousPosition=t),this._tip.style.top=r+"px",this._tip.style.left=s+"px",!0},contentContainer:function(){return this._makeTipNode(),this._tipInner},isShowing:function(){return this._tip&&this._tip.classList.contains("tooltipShowing")},show:function(){this.isShowing()||(this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null),this._showDelay?this._timeout=window.setTimeout(this._showImmediately.bind(this),this._showDelay):this._showImmediately())},_showImmediately:function(){for(var e=!1,t=0;!e&&t<this._position.length;)e=this._positionTip(this._position[t]),t++;e||this._positionTip(this._position[0],!0),this._afterShowing&&this._afterShowing()},hide:function(e){if(this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null),this.isShowing()){void 0===e&&(e=this._hideDelay);var t=this;this._timeout=window.setTimeout(function(){t._tip.classList.remove("tooltipShowing"),t._tip.removeAttribute("style"),t._afterHiding&&t._afterHiding()},e)}},destroy:function(){if(this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null),this._tip&&(document.body.removeChild(this._tip),this._tip=null,this._tipInner=null,this._tipTextContent=null,this._tail=null),this._node){this._node.removeEventListener("click",this._clickHandler,!1),this._node.removeEventListener("mouseover",this._mouseoverHandler,!1),this._node.removeEventListener("focus",this._focusHandler,!1),this._node.removeEventListener("blur",this._blurHandler,!1);for(var e=["mouseout","click"],t=0;t<e.length;t++)this._node.removeEventListener(e[t],this._leaveHandler,!1)}}},t.prototype.constructor=t,{Tooltip:t}}),define("orion/metrics",[],function(){function e(e,t){var i=window.location.protocol+"//"+window.location.hostname+window.location.pathname+window.location.search,n=window.location.pathname+window.location.search,o=document.title;r=e,r.forEach(function(e){e.pageLoad(i,n,o,t)})}function t(t,i){var n=t.getServiceReferences("orion.metrics"),o=[];n.forEach(function(e){o.push(t.getService(e))}),e(o,i)}function i(e,t,i,n){r.forEach(function(o){o.logEvent(e,t,i||"",n)})}function n(e,t){if(window.performance){if(window.performance.getEntriesByName&&window.performance.mark){if(window.performance.getEntriesByName(e).length)return;window.performance.mark(e)}else{if(s[e])return;s[e]=new Date}o("page",e,window.performance.now(),t)}}function o(e,t,i,n){r.forEach(function(o){o.logTiming(e,t,i,n)})}var r=[],s={};return{init:e,initFromRegistry:t,logEvent:i,logPageLoadTiming:n,logTiming:o}}),define("orion/commands",["orion/webui/littlelib","orion/commandsProxy","orion/webui/dropdown","text!orion/webui/dropdowntriggerbutton.html","text!orion/webui/dropdowntriggerbuttonwitharrow.html","text!orion/webui/checkedmenuitem.html","orion/webui/tooltip","orion/metrics"],function(e,t,i,n,o,r,s,a){function l(e){w=e}function c(e){var t=e.invocation;if(t){var i=e.command;if("function"==typeof i.hrefCallback){var n=i.hrefCallback.call(t.handler||window,t);return n.then?n.then(function(e){window.open(e)}):window.open(n),!0}if(t.commandRegistry)return t.commandRegistry._invoke(t),!0;if(i.onClick||i.callback)return window.setTimeout(function(){(i.onClick||i.callback).call(t.handler||window,t)},0),!0}return!1}function d(t,i){for(var n in i)if(i[n]&&i[n].keyBinding&&i[n].command&&i[n].keyBinding.match(t)){var o=i[n],r=o.keyBinding;if((!r.domScope||e.contains(e.node(r.domScope),t.target))&&c(o))return void e.stop(t)}}function h(){var e={};if(w){var t,i,n;for(i=Object.keys(b),t=0;t<i.length;t++)n=i[t],e[n]=b[n];var o=w();for(i=Object.keys(o),t=0;t<i.length;t++)n=i[t],e[n]=o[n]}else e=b;return e}function u(e){d(e,h())}function p(e,t,i){t.classList.add("commandImage");var n;return e.imageClass?e.addImageClassToElement?t.classList.add(e.imageClass):(n=document.createElement("span"),t.appendChild(n),n.classList.add(e.spriteClass),n.classList.add(e.imageClass)):(n=new Image,n.alt=e.name,n.name=i,n.id=i,n.src=e.image,t.appendChild(n)),n}function f(t,r,s,a,l,c,d,h,u,f){if(t=e.node(t),!t)throw"no parent node was specified";var g=document.createRange();g.selectNode(t);var m=g.createContextualFragment(u?o:n);e.processTextNodes(m,{ButtonText:r}),t.appendChild(m);var v,_,y=t.lastChild;return u?(v=y.previousSibling,_=v.lastChild):v=y.previousSibling,a?v.classList.add(a):(v.classList.add("orionButton"),v.classList.add("commandButton")),f&&f.split(" ").forEach(v.classList.add.bind(v.classList)),l&&(c||(v.textContent="",v.setAttribute("aria-label",r)),p({spriteClass:"commandSprite",imageClass:l},v,r),v.classList.add("orionButton")),v.dropdown=new i.Dropdown({dropdown:y,populate:s,selectionClass:d,skipTriggerEventListeners:!!_,positioningNode:h}),y.dropdown=v.dropdown,{menuButton:v,menu:y,dropdown:v.dropdown,dropdownArrow:_}}function g(t,i,n,o){if(t=e.node(t),!t)throw"no parent node was specified";var s=document.createRange();s.selectNode(t);var a=s.createContextualFragment(r);e.processTextNodes(a,{ItemText:i}),t.appendChild(a);var l=t.lastChild,c=e.$(".checkedMenuItem",l);return c.checked=n,c.addEventListener("change",o,!1),c}function m(t,i,n,o,r,a,l){var c,d;a=a||!i.name&&i.hasImage();var h=function(){if(a)i.hasImage()?(p(i,c,o),i.name&&c.setAttribute("aria-label",i.name)):(c.classList.add("commandButton"),c.classList.add("commandMissingImageButton"),c.appendChild(document.createTextNode(i.name)));else{c.classList.add("commandButton");var e=document.createTextNode(i.name);c.appendChild(e)}};if("function"==typeof i.hrefCallback){c=d=document.createElement("a"),c.id=o,a&&i.hasImage()?p(i,c,o):(c.className="commandLink",c.appendChild(document.createTextNode(i.name)));var u=i.hrefCallback.call(n.handler,n);u.then?u.then(function(e){c.href=e}):c.href=u?u:"#"}else{if("switch"===i.type){c=document.createElement("div"),c.tabIndex=0,c.className="orionSwitch";var f=d=document.createElement("input");f.type="checkbox",f.className="orionSwitchCheck",f.id="orionSwitchCheck"+i.id,t.id&&(f.id=f.id+t.id),c.appendChild(f);var g=document.createElement("label");g.className="orionSwitchLabel",g.setAttribute("for",f.id);var m=document.createElement("span");m.className="orionSwitchInner";var v=document.createElement("span");v.className="orionSwitchSwitch",g.appendChild(m),g.appendChild(v),c.appendChild(g),c.addEventListener("keydown",function(t){(t.keyCode===e.KEY.ENTER||t.keyCode===e.KEY.SPACE)&&f.click()},!1),f.checked=i.checked,m.classList.add(i.imageClass)}else"toggle"===i.type?(c=d=document.createElement("button"),c.className="orionButton",c.classList.add(i.checked?"orionToggleOn":"orionToggleOff"),i.extraClass&&c.classList.add(i.extraClass),c.id="orionToggle"+i.id,t.id&&(c.id=c.id+t.id),h()):(c=d=document.createElement("button"),c.className="orionButton",i.extraClass&&c.classList.add(i.extraClass),h());var _=l||i.callback;if(_){var y=function(){_.call(n.handler,n)};i.onClick=_,d.addEventListener("click",function(e){var t;t="switch"===i.type||"toggle"===i.type?function(e){"toggle"===i.type?(e&&(i.checked=!i.checked),i.checked?(c.classList.remove("orionToggleOff"),c.classList.add("orionToggleOn"),c.classList.add("orionToggleAnimate")):(c.classList.remove("orionToggleOn"),c.classList.add("orionToggleOff"),c.classList.add("orionToggleAnimate"))):e?i.checked=f.checked:f.checked=!f.checked,e&&window.setTimeout(y,250)}:function(e){e&&y()},i.preCallback?i.preCallback(n).then(function(e){t(e)}):t(!0),e.stopPropagation()},!1)}}if("ul"===t.nodeName.toLowerCase()){var C=document.createElement("li");t.appendChild(C),t=C}else c.classList.add("commandMargins");return t.appendChild(c),i.tooltip&&(c.commandTooltip=new s.Tooltip({node:c,text:i.tooltip,position:["above","below","right","left"]})),r&&(b[i.id]={keyBinding:r,command:i,invocation:n}),c}function v(t,n,o,r,a,l){var c,d,h=t.dropdown;if("function"==typeof n.hrefCallback){d=i.createMenuItem(n.name,"a"),c=d.firstElementChild;var u=n.hrefCallback.call(o.handler,o);u.then?u.then(function(e){c.href=e}):c.href=u?u:"#",c.addEventListener("keydown",function(t){(t.keyCode===e.KEY.ENTER||t.keyCode===e.KEY.SPACE)&&c.click()},!1)}else{d=i.createMenuItem(n.name),c=d.firstElementChild;var p=a||n.callback;p&&(n.onClick=p,c.addEventListener("click",function(){h&&h.close(!0),p.call(o.handler,o)},!1),c.addEventListener("keydown",function(t){(t.keyCode===e.KEY.ENTER||t.keyCode===e.KEY.SPACE)&&(t.preventDefault(),c.click())},!1))}return n.tooltip&&(c.commandTooltip=new s.Tooltip({node:c,text:n.tooltip,position:["right","above","below","left"]})),l&&i.appendKeyBindingString(c,l),t.appendChild(d),r&&(b[n.id]={keyBinding:r,command:n,invocation:o}),c}function _(e,t,i,n,o){this.commandRegistry=o,this.handler=e,this.items=t,this.userData=i,this.command=n,n.parameters&&(this.parameters=n.parameters.makeCopy()),this.id=n.id}function y(e){this._init(e)}var C="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAAtJREFUCNdjIBEAAAAwAAFletZ8AAAAAElFTkSuQmCC",w=null,b={};return window.document.addEventListener("keydown",function(e){return t.handleKeyEvent(e,u)},!1),_.prototype={collectsParameters:function(){return this.commandRegistry&&this.commandRegistry.collectsParameters()},makeCopy:function(e){var t=new _(this.handler,this.items,this.userData,this.command,this.commandRegistry);return t.domNode=this.domNode,t.domParent=this.domParent,e?t.parameters=e.makeCopy():this.parameters&&(t.parameters=this.parameters.makeCopy()),t}},_.prototype.constructor=_,y.prototype={_init:function(e){this.id=e.id,this.name=e.name,this.tooltip=e.tooltip,this.callback=e.callback,this.preCallback=e.preCallback,this.hrefCallback=e.hrefCallback,this.choiceCallback=e.choiceCallback,this.positioningNode=e.positioningNode,this.image=e.image||C,this.imageClass=e.imageClass,this.addImageClassToElement=e.addImageClassToElement,this.extraClass=e.extraClass,this.selectionClass=e.selectionClass,this.spriteClass=e.spriteClass||"commandSprite",this.visibleWhen=e.visibleWhen,this.parameters=e.parameters,this.isEditor=e.isEditor,this.type=e.type,this.checked=e.checked,this.track=e.track},populateChoicesMenu:function(t,i,n,o,r){var s=this.getChoices(i,n,o),l=s.some(function(e){return e.checked});s.forEach(function(n){if(n.name){var o=document.createElement("li");t.appendChild(o);var s=document.createElement("span");if(s.tabIndex=0,s.setAttribute("role","menuitem"),s.classList.add("dropdownMenuItem"),l){var c=document.createElement("span");c.classList.add("check"),c.appendChild(document.createTextNode(n.checked?"●":"")),s.appendChild(c)}if(n.imageClass){var d=document.createElement("span");d.classList.add(n.imageClass),s.appendChild(d)}var h=document.createElement("span"),u=document.createTextNode(n.name);h.appendChild(u),s.appendChild(h),o.appendChild(s),s.choice=n,s.addEventListener("click",function(){a.logEvent("command","invoke",this.id+">"+n.name),n.callback.call(n,i)}.bind(this),!1),s.addEventListener("keydown",function(t){(t.keyCode===e.KEY.ENTER||t.keyCode===e.KEY.SPACE)&&(a.logEvent("command","invoke",this.id+">"+n.name),n.callback.call(n,i))}.bind(this),!1)}else r._generateMenuSeparator(t)}.bind(this))},getChoices:function(e,t,i){return this.choiceCallback?this.choiceCallback.call(t,e,i):null},makeChoiceCallback:function(e,t){return function(i){e.callback&&e.callback.call(e,t,i)}},hasImage:function(){return this.imageClass||this.image!==C}},y.prototype.constructor=y,{Command:y,CommandInvocation:_,createDropdownMenu:f,createCheckedMenuItem:g,createCommandItem:m,createCommandMenuItem:v,executeBinding:c,setKeyBindingProvider:l,localKeyBindings:b,getKeyBindings:h,processKey:u,NO_IMAGE:C,_testMethodProcessKey:d}}),define("orion/nls/messages",{root:!0,de:!0,es:!0,fr:!0,it:!0,ja:!0,ko:!0,"pt-br":!0,zh:!0,"zh-hk":!0,"zh-tw":!0}),define("orion/nls/root/messages",{Navigator:"Navigator",Sites:"Sites",Shell:"Shell","Get Plugins":"Get Plug-ins",Global:"Global",Editor:"Editor",EditorRelatedLink:"Show Current Folder",EditorRelatedLinkParent:"Show Enclosing Folder",EditorLinkWorkspace:"Edit",EditorRelatedLinkProj:"Show Project",navigationBar:"Navigation Bar","Filter bindings":"Filter bindings",BindingPrompt:"Enter the new binding",NoBinding:"---",orionClientLabel:"Orion client repository","Orion Editor":"Orion Editor","Orion Image Viewer":"Orion Image Viewer","Orion Markdown Editor":"Orion Markdown Editor","Orion Markdown Viewer":"Orion Markdown Viewer","Orion JSON Editor":"Orion JSON Editor","View on Site":"View on Site","View this file or folder on a web site hosted by Orion":"View this file or folder on a web site hosted by Orion.",ShowAllKeyBindings:"Show a list of all the keybindings on this page","Show Keys":"Show Keys",HideShowBannerFooter:"Hide or show the page banner","Toggle banner and footer":"Toggle banner",ChooseFileOpenEditor:"Choose a file by name and open an editor on it",FindFile:"Open File...","System Configuration Details":"System Configuration Details","System Config Tooltip":"Go to the System Configuration Details page","Background Operations":"Background Operations","Background Operations Tooltip":"Go to the Background Operations page","Operation status is unknown":"Operation status is unknown","Unknown item":"Unknown item",NoSearchAvailableErr:"Can't search: no search service is available",Related:"Related",Options:"Options","LOG: ":"LOG: ",View:"View",SplashTitle:"Setting up Workspace",SplashTitleSettings:"Loading Settings",SplashTitleGit:"Loading Git Repositories",LoadingPage:"Loading Page",LoadingPlugins:"Loading Plugins",LoadingResources:"Loading Resources",plugin_started:'"${0}" started',"plugin_lazy activation":'"${0}" lazily activated',plugin_starting:'"${0}" starting',"no parent":"no parent","no tree model":"no tree model","no renderer":"no renderer","could not find table row ":"could not find table row ",Operations:"Operations","Operations running":"Operations running",SomeOpWarning:"Some operations finished with warning",SomeOpErr:"Some operations finished with error","no service registry":"no service registry",Tasks:"Tasks",Close:"Close","Expand all":"Expand all","Collapse all":"Collapse all",Search:"Search","Advanced search":"Advanced search",Submit:"Submit",More:"More","Recent searches":"Recent searches","Regular expression":"Regular expression","Search options":"Search options","Global search":"Global search","Orion Home":"Orion Home","Close notification":"Close notification",OpPressSpaceMsg:"Operations - Press spacebar to show current operations","Toggle side panel":"Toggle side panel","Open or close the side panel":"Open or close the side panel",Projects:"Projects","Toggle Sidebar":"Toggle Sidebar","Sample HTML5 Site":"Sample HTML5 Site","Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.":"Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.","Sample Orion Plugin":"Sample Orion Plug-in","Generate a sample plugin for integrating with Orion.":"Generate a sample plug-in for integrating with Orion.",Browser:"Web Browser",OutlineProgress:"Getting outline for ${0} from ${1}",outlineTimeout:"Outline service timed out. Try reloading the page and opening the outline again.",UnknownError:"An unknown error occurred.",Filter:"Filter (* = any string, ? = any character)",TemplateExplorerLabel:"Templates",OpenTemplateExplorer:"Open Template Explorer",Edit:"Edit",CentralNavTooltip:"Toggle Navigation Menu","Wrote: ${0}":"Wrote: ${0}",GenerateHTML:"Generate HTML file",GenerateHTMLTooltip:"Write an HTML file generated from the current Markdown editor content","alt text":"alt text",blockquote:"blockquote",code:"code","code (block)":"code (block)","code (span)":"code (span)",emphasis:"emphasis","fenced code (${0})":"fenced code (${0})","header (${0})":"header (${0})","horizontal rule":"horizontal rule",label:"label","link (auto)":"link (auto)","link (image)":"link (image)","link (inline)":"link (inline)","link label":"link label","link label (optional)":"link label (optional)","link (ref)":"link (ref)","list item (bullet)":"list item (bullet)","list item (numbered)":"list item (numbered)","strikethrough (${0})":"strikethrough (${0})",strong:"strong","table (${0})":"table (${0})",text:"text","title (optional)":"title (optional)",url:"url",workedProgress:"${0} (${1}/${2})",TogglePaneOrientationTooltip:"Toggle split pane orientation",WarningDuplicateLinkId:"Duplicate link ID: ${0} (link IDs are not case-sensitive)",WarningHeaderTooDeep:"Header level cannot exceed 6",WarningLinkHasNoText:"Link has no text",WarningLinkHasNoURL:"Link has no URL",WarningOrderedListItem:"Ordered list item within unordered list",WarningOrderedListShouldStartAt1:"The first item in an ordered list should have index 1",WarningUndefinedLinkId:"Undefined link ID: ${0}",WarningUnorderedListItem:"Unordered list item within ordered list",PageTitleFormat:"${0} - ${1}",KeyCTRL:"Ctrl",KeySHIFT:"Shift",KeyALT:"Alt",KeyBKSPC:"Backspace",KeyDEL:"Del",KeyEND:"End",KeyENTER:"Enter",KeyESCAPE:"Esc",KeyHOME:"Home",KeyINSERT:"Ins",KeyPAGEDOWN:"Page Down",KeyPAGEUP:"Page Up",KeySPACE:"Space",KeyTAB:"Tab","a year":"a year",years:"${0} years","a month":"a month",months:"${0} months","a day":"a day",days:"${0} days","an hour":"an hour",hours:"${0} hours","a minute":"a minute",minutes:"${0} minutes",timeAgo:"${0} ago",justNow:"just now"}),define("orion/i18nUtil",[],function(){function e(e){var t=/\$\{([^\}]+)\}/g,i=arguments;return 2===i.length&&i[1]&&"object"==typeof i[1]?e.replace(t,function(e,t){return i[1][t]}):e.replace(t,function(e,t){return i[(t<<0)+1]})}return{formatMessage:e}}),define("orion/uiUtils",["i18n!orion/nls/messages","orion/webui/littlelib","orion/i18nUtil"],function(e,t,i){function n(i){var n="";if(m)i.mod4&&(n+="⌃"),i.mod3&&(n+="⌥"),i.mod2&&(n+="⇧"),i.mod1&&(n+="⌘");else{var o="+";i.mod1&&(n+=e.KeyCTRL+o),i.mod2&&(n+=e.KeySHIFT+o),i.mod3&&(n+=e.KeyALT+o)}if(i.alphaKey)return n+i.alphaKey;if("keypress"===i.type)return n+i.keyCode;var r=i.keyCode,s=v[r];if(s)return n+s;var a=t.keyName(r);if(a)return a=e["Key"+a]||a,n+a;var l;switch(i.keyCode){case 59:l=i.mod2?":":";";break;case 61:l=i.mod2?"+":"=";break;case 188:l=i.mod2?"<":",";break;case 190:l=i.mod2?">":".";break;case 191:l=i.mod2?"?":"/";break;case 192:l=i.mod2?"~":"`";break;case 219:l=i.mod2?"{":"[";break;case 220:l=i.mod2?"|":"\\";break;case 221:l=i.mod2?"}":"]";break;case 222:l=i.mod2?'"':"'"}return l?n+l:i.keyCode>=112&&i.keyCode<=123?n+"F"+(i.keyCode-111):n+String.fromCharCode(i.keyCode)}function o(e){for(var t="",i=e.getKeys(),o=0;o<i.length;o++)0!==o&&(t+=" "),t+=n(i[o]);return t}function r(e){var i=e.id,n=e.refNode,o=e.hideRefNode,r=e.initialText,s=e.onComplete,a=e.onEditDestroy,l=e.selectTo,c=e.isInitialValid,d=e.insertAsChild,h=!1,u=function(e){return function(l){if(!h){var d=t.node(i),u=d.value;if(d)return e&&l.keyCode===t.KEY.ESCAPE?(o&&(n.style.display="inline"),h=!0,d.parentNode.removeChild(d),void(a&&a())):void(e&&l.keyCode!==t.KEY.ENTER||(0===u.length||!c&&u===r?(o&&(n.style.display="inline"),h=!0):(s(u),o&&n.parentNode&&(n.style.display="inline"),h=!0),d.parentNode&&d.parentNode.removeChild(d),a&&a()))}}},p=document.createElement("input");p.id=i,p.value=r||"",d?n.appendChild(p):n.parentNode.insertBefore(p,n.nextSibling),p.classList.add("userEditBoxPrompt"),o&&(n.style.display="none"),p.addEventListener("keydown",u(!0),!1),p.addEventListener("blur",u(!1),!1),window.setTimeout(function(){if(p.focus(),r){var e=t.node(i),n=l?r.indexOf(l):-1;if(n>0)if(e.createTextRange){var o=e.createTextRange();o.collapse(!0),o.moveStart("character",0),o.moveEnd("character",n),o.select()}else e.setSelectionRange?e.setSelectionRange(0,n):void 0!==e.selectionStart&&(e.selectionStart=0,e.selectionEnd=n);else e.select()
}},0)}function s(e){var t=-1!==window.navigator.platform.indexOf("Mac");return t&&e.metaKey||!t&&e.ctrlKey}function a(e,t){t&&s(t)?window.open(e):window.location=e}function l(e,i){var n=document.createElement("button");return n.className="orionButton commandButton commandMargins",n.addEventListener("click",function(e){i(),t.stop(e)},!1),e&&n.appendChild(document.createTextNode(e)),n}function c(){}function d(e,t){if(!e||!e.tagName)return!1;switch(e.tagName.toLowerCase()){case"button":case"fieldset":case"form":case"input":case"keygen":case"label":case"legend":case"meter":case"optgroup":case"output":case"progress":case"select":case"textarea":return!0}return e.parentNode===t?!1:e.parentNode&&d(e.parentNode,t)}function h(e,t,i){var n=i?0:1;return e.substring(0,e.length-encodeURIComponent(t).length-n)}function u(e){var t=new Date,i=new Date(e),n=t.getTime()-i.getTime(),o=Math.floor(n/1e3/60/60/24/365);n-=1e3*o*60*60*24*365;var r=Math.floor(n/1e3/60/60/24/30);n-=1e3*r*60*60*24*30;var s=Math.floor(n/1e3/60/60/24);n-=1e3*s*60*60*24;var a=Math.floor(n/1e3/60/60);n-=1e3*a*60*60;var l=Math.floor(n/1e3/60);n-=1e3*l*60;var c=Math.floor(n/1e3);return{year:o,month:r,day:s,hour:a,minute:l,second:c}}function p(t,n,o){return t>0?1===t?e[n]:i.formatMessage(e[o],t):""}function f(e){var t=u(e),i=p(t.year,"a year","years"),n=p(t.month,"a month","months"),o=p(t.day,"a day","days"),r=p(t.hour,"an hour","hours"),s=p(t.minute,"a minute","minutes"),a="";return i?a=t.year>0?i:i+n:n?a=t.month>0?n:n+o:o?a=t.day>0?o:o+r:r?a=t.hour>0?r:r+s:s&&(a=s),a}function g(t){var n=f(t);return n?i.formatMessage(e.timeAgo,n):e.justNow}var m=-1!==navigator.platform.indexOf("Mac"),v=Object.create(null);return v[t.KEY.DOWN]="↓",v[t.KEY.UP]="↑",v[t.KEY.RIGHT]="→",v[t.KEY.LEFT]="←",m&&(v[t.KEY.BKSPC]="⌫",v[t.KEY.DEL]="⌦",v[t.KEY.END]="⇲",v[t.KEY.ENTER]="⏎",v[t.KEY.ESCAPE]="⎋",v[t.KEY.HOME]="⇱",v[t.KEY.PAGEDOWN]="⇟",v[t.KEY.PAGEUP]="⇞",v[t.KEY.SPACE]="␣",v[t.KEY.TAB]="⇥"),{getUserKeyString:o,getUserText:r,openInNewWindow:s,followLink:a,createButton:l,createDropdownButton:c,isFormElement:d,path2FolderName:h,timeElapsed:f,displayableTimeElapsed:g}}),define("orion/webui/treetable",["i18n!orion/nls/messages","orion/webui/littlelib"],function(e,t){function i(e){this._init(e)}return i.prototype={_init:function(i){var n=i.parent,o=this;if(n=t.node(n),!n)throw e["no parent"];if(!i.model)throw e["no tree model"];if(!i.renderer)throw e["no renderer"];this._parent=n,this._treeModel=i.model,this._onComplete=i.onComplete,this._renderer=i.renderer,this._showRoot=void 0===i.showRoot?!1:i.showRoot,this._indent=void 0===i.indent?16:i.indent,this._preCollapse=i.preCollapse,this._onCollapse=i.onCollapse,this._labelColumnIndex=void 0===i.labelColumnIndex?0:i.labelColumnIndex,this._id=void 0===i.id?"treetable":i.id,this._tableStyle=i.tableStyle,this._tableElement=i.tableElement||"table",this._tableBodyElement=i.tableBodyElement||"tbody",this._tableRowElement=i.tableRowElement||"tr",this._treeModel.getRoot(function(e){o._root=e,o._showRoot?(e._depth=0,o._generate([e],0)):o._treeModel.getChildren(e,function(e){o.destroyed||o._generate(e,0)})})},destroy:function(){this.destroyed=!0,this._removeAllRows()},_generate:function(e,i){t.empty(this._parent);var n=document.createElement("div");this._renderer.wrapperCallback&&this._renderer.wrapperCallback(n);var o=document.createElement(this._tableElement);this._renderer.tableCallback&&this._renderer.tableCallback(o),o.id=this._id,this._tableStyle&&o.classList.add(this._tableStyle),this._renderer.initTable(o,this),this._bodyElement=document.createElement(this._tableBodyElement),this._renderer.bodyCallback&&this._renderer.bodyCallback(this._bodyElement),this._bodyElement.id=this._id+"tbody",0===e.length?this._renderer.emptyCallback&&this._renderer.emptyCallback(this._bodyElement):this._generateChildren(e,i),o.appendChild(this._bodyElement),n.appendChild(o),this._parent.appendChild(n),this._rowsChanged(),this._onComplete&&this._onComplete(this)},_generateChildren:function(e,t,i){for(var n=0;n<e.length;n++){var o=document.createElement(this._tableRowElement);this._renderer&&"function"==typeof this._renderer.initSelectableRow&&this._renderer.initSelectableRow(e[n],o),this._generateRow(e[n],o,t,i),i?(this._bodyElement.insertBefore(o,i.nextSibling),i=o):this._bodyElement.appendChild(o)}},_generateRow:function(e,t,i){t.id=this._treeModel.getId(e),t._depth=i,t._item=e,this._renderer.render(e,t);var n=this._indent*i;t.childNodes[Math.min(t.childNodes.length-1,this._labelColumnIndex)].style.paddingLeft=n+"px",this._renderer.updateExpandVisuals&&this._renderer.updateExpandVisuals(t,t._expanded),this._renderer.rowCallback&&this._renderer.rowCallback(t,e)},_rowsChanged:function(){this._renderer.rowsChanged&&this._renderer.rowsChanged()},getSelected:function(){return this._renderer.getSelected()},redraw:function(e){var i=this._treeModel.getId(e),n=t.node(i);n&&(t.empty(n),this._generateRow(e,n,n._depth))},refresh:function(i,n,o){var r,s=this._treeModel.getId(i);if(s===this._id)this._removeChildRows(s),this._generateChildren(n,0),this._rowsChanged();else if(s===this._treeModel.getId(this._root)&&i.removeAll)this._removeAllRows(),this._generateChildren(n,0),this._rowsChanged();else{var a=t.node(s);a?(a._item=i,a&&(o||a._expanded)?(this._removeChildRows(s),n?(a._expanded=!0,this._renderer.updateExpandVisuals&&this._renderer.updateExpandVisuals(a,!0),this._generateChildren(n,a._depth+1,a),this._rowsChanged()):(r=this,this._renderer.updateExpandVisuals&&this._renderer.updateExpandVisuals(a,"progress"),n=this._treeModel.getChildren(a._item,function(e){r.destroyed||(r._renderer.updateExpandVisuals&&r._renderer.updateExpandVisuals(a,!0),a._expanded||(a._expanded=!0,r._generateChildren(e,a._depth+1,a),r._rowsChanged()))}))):this._renderer.updateExpandVisuals&&this._renderer.updateExpandVisuals(a,!1)):console.log(e["could not find table row "]+s)}},getContentNode:function(){return this._bodyElement},getItem:function(e){var i=t.node(e);return i&&i._item?i._item:e},toggle:function(e){var i=t.node(e);i&&(i._expanded?this.collapse(e,!0):this.expand(e))},isExpanded:function(e){var i="string"==typeof e?e:this._treeModel.getId(e),n=t.node(i);return n?n._expanded:!1},expand:function(e,i,n){var o="string"==typeof e?e:this._treeModel.getId(e),r=t.node(o);if(r){var s=this;if(r._expanded)return void(i&&i.apply(s,n));this._renderer.updateExpandVisuals&&this._renderer.updateExpandVisuals(r,"progress"),this._treeModel.getChildren(r._item,function(e){s.destroyed||(s._renderer.updateExpandVisuals&&s._renderer.updateExpandVisuals(r,!0),r._expanded||(r._expanded=!0,s._generateChildren(e,r._depth+1,r),s._rowsChanged()),i&&i.apply(s,n))})}},_removeChildRows:function(e){for(var i,n=e===this._id,o=!1,r=-1,s=[],a=t.$$array(".treeTableRow",this._parent),l=0;l<a.length;l++){var c=a[l];if(o)break;n?i&&c.parentNode!==i.parentNode||(c._depth>r?s.push(c):o=!0):c.id===e&&(n=!0,r=c._depth,i=c)}for(var d=0;d<s.length;d++){var h=s[d];h&&h._item&&"function"==typeof h._item.destroy&&h._item.destroy(),h.parentNode.removeChild(h)}},_removeAllRows:function(){for(var e=t.$$array(".treeTableRow",this._parent),i=0;i<e.length;i++)e[i]&&e[i]._item&&"function"==typeof e[i]._item.destroy&&e[i]._item.destroy(),e[i].parentNode.removeChild(e[i])},_collapse:function(e,t){t._expanded=!1,this._renderer.updateExpandVisuals&&this._renderer.updateExpandVisuals(t,!1),this._removeChildRows(e),this._rowsChanged(),this._onCollapse&&this._onCollapse(t._item)},collapse:function(e,i){var n="string"==typeof e?e:this._treeModel.getId(e),o=t.node(n);if(o){if(!o._expanded)return;i&&this._preCollapse?this._preCollapse(o._item).then(function(e){e&&this._collapse(n,o)}.bind(this)):this._collapse(n,o)}},getIndent:function(){return this._indent}},i.prototype.constructor=i,{TableTree:i}}),define("orion/treeModelIterator",[],function(){var e={};return e.TreeModelIterator=function(){function e(e,t){this.firstLevelChildren=e,this.reset(),this._init(t)}return e.prototype={_init:function(e){e&&(this.isExpanded=e.isExpanded,this.isExpandable=e.isExpandable,this.forceExpandFunc=e.forceExpandFunc,this.getChildrenFunc=e.getChildrenFunc)},topLevel:function(e){return e.parent?e.parent===this.root:!0},_getChildren:function(e){return"function"==typeof this.getChildrenFunc?this.getChildrenFunc(e):e?e.children:null},_expanded:function(e){if(!e)return!0;var t=this._getChildren(e),i=t&&t.length>0;return this.isExpanded&&i&&(i=this.isExpanded(e)),i},_expandable:function(e){return e?this.isExpandable?this.isExpandable(e):!1:!0},_diveIn:function(e){if(this._expanded(e)){var t=this._getChildren(e);return this.setCursor(t[0]),this.cursor()}return null},_drillToLast:function(e){if(this._expanded(e)){var t=this._getChildren(e);return this._drillToLast(t[t.length-1])}return e},_forward:function(e){if(!this._cursor)return null;var t=this._diveIn(this._cursor);if(!t){if(e&&this._expandable(this._cursor)&&this.forceExpandFunc){var i=this;return this.forceExpandFunc(this._cursor,"first",function(e){e&&i.setCursor(e)})}t=this._findSibling(this._cursor,!0),t&&this.setCursor(t)}return t},_backward:function(e){if(!this._cursor)return null;var t=this._findSibling(this._cursor,!1);if(t&&t!==this._cursor.parent&&(t=this._drillToLast(t)),e&&t&&this._expandable(t)&&this.forceExpandFunc&&t!==this._cursor.parent){var i=this;return this.forceExpandFunc(t,"last",function(e){e&&i.setCursor(e)})}return t&&this.setCursor(t),t},_findSibling:function(e,t){for(var i=this.topLevel(e),n=this._getChildren(e.parent),o=i?this.firstLevelChildren:n,r=0;r<o.length;r++)if(o[r]===e)return 0!==r||t?r===o.length-1&&t?i?null:this._findSibling(e.parent,t):t?o[r+1]:o[r-1]:i?null:e.parent;return null},_inParentChain:function(e,t){for(var i=e.parent;i;){if(i===t)return!0;i=i.parent}return!1},_getTopLevelParent:function(e){if(this.topLevel(e))return e;for(var t=e.parent;t;){if(this.topLevel(t))return t;t=t.parent}return null},_onCollapse:function(e){return this._expanded(e.parent)?e:this._onCollapse(e.parent)},_scan:function(e,t,i){this.setCursor(t);var n=[];for(n.push(t);;){if(!this.iterate(e))break;if(n.push(this.cursor()),i===this.cursor())return n}return n=[],null},setCursor:function(e){this._prevCursor=this._cursor,this._cursor=e},setTree:function(e){this.firstLevelChildren=e,this.firstLevelChildren.length>0&&(this.root=this.firstLevelChildren[0].parent)},scan:function(e,t){var i=this.cursor(),n=this._scan(!0,e,t);return n||(n=this._scan(!1,e,t)),this.setCursor(i),n},iterate:function(e,t){return e?this._forward(t):this._backward(t)},iterateOnTop:function(e,t){var i=this._findSibling(this._getTopLevelParent(this.cursor()),e);i?this.setCursor(i):t&&this.firstLevelChildren.length>0&&this.setCursor(e?this.firstLevelChildren[0]:this.firstLevelChildren[this.firstLevelChildren.length-1])},collapse:function(e){return this._cursor&&this._inParentChain(this._cursor,e)?(this.setCursor(e),this._cursor):null},reset:function(){this._cursor=null,this._prevCursor=null,this.root=null,this.firstLevelChildren.length>0&&(this._cursor=this.firstLevelChildren[0],this.root=this.firstLevelChildren[0].parent)},cursorMoved:function(){return this._cursor!==this._prevCursor},cursor:function(){return this._cursor},prevCursor:function(){return this._prevCursor}},e}(),e}),define("orion/explorers/explorerNavHandler",["orion/webui/littlelib","orion/treeModelIterator","orion/uiUtils"],function(e,t,i){var n={},o=navigator.userAgent,r=-1!==o.indexOf("iPad"),s=-1!==window.navigator.platform.indexOf("Mac");return n.ExplorerNavHandler=function(){function n(n,o,r){this.explorer=n,this.model=this.explorer.model,this._navDict=o,this._listeners=[],this._selections=[],this._currentColumn=0;var s=this._getEventListeningDiv();s.tabIndex=0,s.classList.add("selectionModelContainer");var a=this;this._modelIterator=new t.TreeModelIterator([],{isExpanded:this.isExpanded.bind(this),getChildrenFunc:r.getChildrenFunc,isExpandable:this.explorer.renderer.isExpandable?function(e){return a.explorer.renderer.isExpandable(e)}:function(e){return a.isExpandable(e)},forceExpandFunc:this.explorer.forceExpandFunc?function(e,t,i){return a.explorer.forceExpandFunc(e,t,i)}:void 0}),this._init(r),r&&r.setFocus===!1||s.focus();var l=function(t){return i.isFormElement(t.target)?!0:a.explorer.preventDefaultFunc&&a.explorer.preventDefaultFunc(t,a._modelIterator.cursor())?!0:t.keyCode===e.KEY.DOWN?a.onDownArrow(t):t.keyCode===e.KEY.UP?a.onUpArrow(t):t.keyCode===e.KEY.RIGHT?a.onRightArrow(t):t.keyCode===e.KEY.LEFT?a.onLeftArrow(t):t.keyCode===e.KEY.SPACE?a.onSpace(t):t.keyCode===e.KEY.ENTER?a.onEnter(t):void 0};s.addEventListener("keydown",l,!1),this._listeners.push({type:"keydown",listener:l});var c=function(t){return i.isFormElement(t.target)?!0:void(t.shiftKey&&a._shiftSelectionAnchor&&e.stop(t))};s.addEventListener("mousedown",c,!1),this._listeners.push({type:"mousedown",listener:c});var d=function(){a.explorer.onFocus?a.explorer.onFocus(!1):a.toggleCursor(null,!1)};s.addEventListener("blur",d,!1),this._listeners.push({type:"blur",listener:d});var h=function(){a.explorer.onFocus?a.explorer.onFocus(!0):a.toggleCursor(null,!0)};s.addEventListener("focus",h,!1),this._listeners.push({type:"focus",listener:h}),this._parentDiv=s}return n.prototype={destroy:function(){this._parentDiv.classList.remove("selectionModelContainer"),this.removeListeners()},_init:function(e){this._linearGridMove=!1,e&&(this._selectionPolicy=e.selectionPolicy,this.gridClickSelectionPolicy=e.gridClickSelectionPolicy||"none",this.preventDefaultFunc=e.preventDefaultFunc,this.postDefaultFunc=e.postDefaultFunc)},_ctrlKeyOn:function(e){return s?e.metaKey:e.ctrlKey},removeListeners:function(){if(this._listeners)for(var e=0;e<this._listeners.length;e++)this._parentDiv.removeEventListener(this._listeners[e].type,this._listeners[e].listener,!1)},focus:function(){var e=this._getEventListeningDiv();e&&e.focus()},_getEventListeningDiv:function(t){return this.explorer.keyEventListeningDiv&&"function"==typeof this.explorer.keyEventListeningDiv?this.explorer.keyEventListeningDiv(t):e.node(this.explorer._parentId)},isExpandable:function(t){if(!t)return!1;var i=e.node(this.explorer.renderer.expandCollapseImageId(this.model.getId(t)));return i?!0:!1},isExpanded:function(e){return e?this.explorer.myTree.isExpanded(this.model.getId(e)):!1},refreshSelection:function(e,t){var i=this;this.explorer.selection&&this.explorer.selection.getSelections(function(n){i._clearSelection(t);for(var o=0;o<n.length;o++)i._selections.push(n[o]);i._selections.length>0?i.cursorOn(i._selections[0],!0,!1,e):i.cursorOn(null,!1,!1,e),i._shiftSelectionAnchor&&i._inSelection(i._shiftSelectionAnchor)>=0||(i._shiftSelectionAnchor=null)})},refreshModel:function(e,t,i,n){this._currentColumn=0,this.topIterationNodes=[],this.model=t,this._navDict=e,this.model.getTopIterationNodes?this.topIterationNodes=this.model.getTopIterationNodes():i&&(this.topIterationNodes=i),this._modelIterator.setTree(this.topIterationNodes),!n&&this.explorer.selection&&(this.toggleCursor(this._modelIterator.cursor(),!1),this._modelIterator.reset()),this.refreshSelection(!0)},getTopLevelNodes:function(){return this._modelIterator.firstLevelChildren},_inSelection:function(e){for(var t=this.model.getId(e),i=0;i<this._selections.length;i++)if(t===this.model.getId(this._selections[i]))return i;return-1},_clearSelection:function(e){if(e)for(var t=0;t<this._selections.length;t++)this._checkRow(this._selections[t],!0);this._selections=[]},getSelectionPolicy:function(){return this._selectionPolicy},setSelectionPolicy:function(e){this._selectionPolicy!==e&&(("readonlySelection"===this._selectionPolicy||"readonlySelection"===e)&&this._toggleSelectionClass("disabledRow","readonlySelection"===e),this._selectionPolicy=e,"cursorOnly"===this._selectionPolicy&&this._clearSelection(!0))},setSelection:function(e,t,i){if("readonlySelection"===this._selectionPolicy)return!1;if("cursorOnly"===this._selectionPolicy)return t&&this.explorer.renderer._useCheckboxSelection&&this._checkRow(e,!0),!1;if(!this._isRowSelectable(e))return!1;if(t&&"singleSelection"!==this._selectionPolicy){var n=this._inSelection(e);n>=0?(this._checkRow(e,!0),this._selections.splice(n,1)):(this._checkRow(e,!1),this._selections.push(e),this._lastSelection=e)}else this._clearSelection(!0),this._checkRow(e,!1),this._selections.push(e),this._lastSelection=e;return i&&(this._shiftSelectionAnchor=this._lastSelection),this.explorer.selection&&(this.explorer.renderer.storeSelections(),this.explorer.selection.setSelections(this._selections)),!0},moveColumn:function(e,t){e||(e=this.currentModel());var i=this._getGridChildren(e);if(i&&i.length>1||0===t&&i){0!==t&&this.toggleCursor(e,!1);var n=this._currentColumn,o=!0;return n+=t,0>n?(this._linearGridMove&&0!==t&&(this._modelIterator.iterate(!1)?e=this.currentModel():o=!1),n=o?i.length-1:this._currentColumn):n>=i.length&&(this._linearGridMove&&0!==t&&(this._modelIterator.iterate(!0)?e=this.currentModel():o=!1),n=o?0:this._currentColumn),this._currentColumn=n,0!==t&&this.toggleCursor(e,!0),!0}return!1},_getGridChildren:function(e){return this._navDict?this._navDict.getGridNavHolder(e):null},getCurrentGrid:function(e){e||(e=this.currentModel());var t=this._getGridChildren(e);return t&&t.length>0?t[this._currentColumn]:null},getAriaContainerElement:function(e){for(var t,i=this._parentDiv;e&&e!==i&&"grid"!==(t=e.getAttribute("role"))&&"tree"!==t&&"treegrid"!==t;)e=e.parentNode;return e===i?null:e},toggleCursor:function(e,t){var i=this.getRowDiv(e),n=this.getCurrentGrid(e);if(n){if(i&&(t?i.classList.add("treeIterationCursorRow"):i.classList.remove("treeIterationCursorRow")),n.domNode){var o=this.getAriaContainerElement(n.domNode);if(t){if(n.domNode.classList.add("treeIterationCursor"),o){var r=n.domNode.id;o.setAttribute("aria-activedescendant",r)}}else n.domNode.classList.remove("treeIterationCursor")}}else i&&(t?i.classList.add("treeIterationCursorRow_Dotted"):i.classList.remove("treeIterationCursorRow_Dotted"))},currentModel:function(){return this._modelIterator.cursor()},cursorOn:function(t,i,n,o){var r,s;if(t||i){if(s===this._modelIterator.cursor())return;r=this._modelIterator.cursor(),s=t,this._modelIterator.setCursor(s)}else r=this._modelIterator.prevCursor(),s=this._modelIterator.cursor();if((r!==s||i)&&(this.toggleCursor(r,!1),!i||s)){this.moveColumn(null,0),this.toggleCursor(s,!0);var a=this.getRowDiv();if(a&&!o){var l=e.getOffsetParent(a);if(l){var c=!0;a.offsetTop<=l.scrollTop?(c=!1,void 0===n&&(n=!1)):a.offsetTop+a.offsetHeight>=l.scrollTop+l.clientHeight&&(c=!1,void 0===n&&(n=!0)),c||(l.scrollTop=a.offsetTop-(n?3*l.clientHeight/4:l.clientHeight/4))}}this.explorer.onCursorChanged&&this.explorer.onCursorChanged(r,s)}},getSelection:function(){return this._selections},getSelectionIds:function(){for(var e=[],t=0;t<this._selections.length;t++)e.push(this.model.getId(this._selections[t]));return e},getRowDiv:function(t){var i=t?t:this._modelIterator.cursor();if(!i)return null;var n=this.model.getId(i),o=this._navDict.getValue(n);return o&&o.rowDomNode?o.rowDomNode:e.node(n)},iterate:function(e,t,i,n){var o=null;if(this.topIterationNodes&&0!==this.topIterationNodes.length)if(n){var r=this.currentModel();for(o=this._modelIterator.iterate(e,t),o&&this._setCursorOnItem(e,i);o&&o.isNotSelectable;)o=this._modelIterator.iterate(e,t),o&&this._setCursorOnItem(e,i);o||(this.cursorOn(r,!0,!1,!0),this._setCursorOnItem(e,i))}else o=this._modelIterator.iterate(e,t),o&&this._setCursorOnItem(e,i)},_toggleSelectionClass:function(e,t){this._selections.forEach(function(i){var n=this.getRowDiv(i);n&&(t?n.classList.add(e):n.classList.remove(e))}.bind(this))},_setCursorOnItem:function(e,t){if(this.cursorOn(null,!1,e),t){var i=this._inSelection(this._modelIterator.prevCursor()),n=this._inSelection(this._modelIterator.cursor());i>=0&&n>=0?this.setSelection(this._modelIterator.prevCursor(),!0):this.setSelection(this.currentModel(),!0)}},_checkRow:function(t,i){if(this.explorer.renderer._useCheckboxSelection&&"singleSelection"!==this._selectionPolicy){var n=this.getRowDiv(t);if(!n)return;var o=e.node(this.explorer.renderer.getCheckBoxId(n.id)),r=i?!o.checked:!0;r!==o.checked&&this.explorer.renderer.onCheck(n,o,r,!0)}else this._select(t,i)},_select:function(e){e||(e=this._modelIterator.cursor());var t=this.getRowDiv(e);t&&(this._inSelection(e)<0?t.classList.add("checkedRow"):t.classList.remove("checkedRow"))},_onModelGrid:function(e,t){var i=this._getGridChildren(e);if(i)for(var n=0;n<i.length;n++)if(t.target===i[n].domNode)return!0;return!1},onClick:function(t,n){if(n&&i.isFormElement(n.target))return!0;if("readonlySelection"===this._selectionPolicy||this.isDisabled(this.getRowDiv(t)))e.stop(n);else{var o=e.node(this.explorer.renderer.expandCollapseImageId(this.model.getId(t)));if(n.target===o)return;if("none"===this.gridClickSelectionPolicy&&this._onModelGrid(t,n))return;if(this.cursorOn(t,!0,!1,!0),r)this.setSelection(t,!0);else if(this._ctrlKeyOn(n))this.setSelection(t,!0,!0);else if(n.shiftKey&&this._shiftSelectionAnchor){var s=this._modelIterator.scan(this._shiftSelectionAnchor,t);if(s){this._clearSelection(!0);for(var a=0;a<s.length;a++)this.setSelection(s[a],!0)}}else this.setSelection(t,!1,!0)}},onCollapse:function(e){this._modelIterator.collapse(e)&&this.cursorOn()},onUpArrow:function(e){return this.iterate(!1,!1,e.shiftKey,!0),this._ctrlKeyOn(e)||e.shiftKey||this.setSelection(this.currentModel(),!1,!0),e.preventDefault(),!1},onDownArrow:function(e){return this.iterate(!0,!1,e.shiftKey,!0),this._ctrlKeyOn(e)||e.shiftKey||this.setSelection(this.currentModel(),!1,!0),e.preventDefault(),!1},_shouldMoveColumn:function(e){var t=this.currentModel(),i=this._getGridChildren(t);return i&&i.length>1?this.isExpandable(t)?this._ctrlKeyOn(e):!0:!1},onLeftArrow:function(e){if(this._shouldMoveColumn(e))return this.moveColumn(null,-1),e.preventDefault(),!0;var t=this._modelIterator.cursor();return t?this.isExpandable(t)&&this.isExpanded(t)?(this.explorer.myTree.collapse(t),e.preventDefault(),!0):void(this._modelIterator.topLevel(t)?this.explorer.scopeUp&&"function"==typeof this.explorer.scopeUp&&this.explorer.scopeUp():(this.cursorOn(t.parent),this.setSelection(t.parent,!1,!0))):!1},onRightArrow:function(e){if(this._shouldMoveColumn(e))return this.moveColumn(null,1),e.preventDefault(),!0;var t=this._modelIterator.cursor();return t?this.isExpandable(t)&&!this.isExpanded(t)?(this.explorer.myTree.expand(t),this.explorer.postUserExpand&&this.explorer.postUserExpand(this.model.getId(t)),e.preventDefault(),!1):void 0:!1},_isRowSelectable:function(e){return this.explorer.isRowSelectable?this.explorer.isRowSelectable(e):!0},onSpace:function(e){this.setSelection(this.currentModel(),!0,!0)&&e.preventDefault()},onEnter:function(e){var t=this.getCurrentGrid(this._modelIterator.cursor());if(t)if(t.widget)"function"==typeof t.onClick?t.onClick():"function"==typeof t.widget.focus&&t.widget.focus();else{var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,0,0,this._ctrlKeyOn(e),!1,!1,!1,0,null),t.domNode.dispatchEvent(i)}else{var n=this._modelIterator.cursor();if(n){if(this.explorer.renderer.getRowActionElement){var o=this.explorer.renderer.getRowActionElement(this.model.getId(n));o.href&&(this._ctrlKeyOn(e)?window.open(o.href):window.location.href=o.href)}return this.explorer.renderer.performRowAction?(this.explorer.renderer.performRowAction(e,n),e.preventDefault(),!1):void 0}}},setIsNotSelectable:function(e,t){e.isNotSelectable=t},disableItem:function(e){var t=this.getRowDiv(e);this.isExpandable(e)&&this.isExpanded(e)&&(this._modelIterator.collapse(e),this.explorer.myTree.toggle(t.id)),t.classList.remove("checkedRow"),t.classList.add("disabledNavRow"),this.setIsNotSelectable(e,!0)},isDisabled:function(e){return e.classList.contains("disabledNavRow")},enableItem:function(e){var t=this.getRowDiv(e);t&&(t.classList.remove("disabledNavRow"),this.setIsNotSelectable(e,!1))}},n}(),n.ExplorerNavDict=function(){function e(e){this._dict={},this._model=e}return e.prototype={addRow:function(e,t){var i=this._model.getId(e);this._dict[i]={model:e,rowDomNode:t}},getValue:function(e){return this._dict[e]},getGridNavHolder:function(e,t){if(!e)return null;var i=this._model.getId(e);return this._dict[i]?(!this._dict[i].gridChildren&&t&&(this._dict[i].gridChildren=[]),this._dict[i].gridChildren):null},initGridNavHolder:function(e){if(!e)return null;var t=this._model.getId(e);this._dict[t]&&(this._dict[t].gridChildren=null)}},e}(),n}),define("orion/explorers/explorer",["i18n!orion/nls/messages","orion/webui/littlelib","orion/webui/treetable","orion/explorers/explorerNavHandler","orion/uiUtils","orion/commands"],function(e,t,i,n,o,r){var s={};return s.Explorer=function(){function e(e,t,i,n){this.registry=e,this.selection=t,this.commandService=n,this.setRenderer(i),this.myTree=null}return e.prototype={setRenderer:function(e){this.renderer&&"function"==typeof this.renderer.destroy&&this.renderer.destroy(),this.renderer=e,this.renderer&&(this.renderer.explorer=this)},destroy:function(){this._navHandler&&this._navHandler.destroy(),this.model&&this.model.destroy(),this.myTree&&this.myTree.destroy(),this.destroyed=!0},changedItem:function(e,t){this.myTree&&this.myTree.refresh.bind(this.myTree)(e,t,!0)},updateCommands:function(e){this.myTree&&this.myTree._renderer.updateCommands.bind(this.myTree._renderer)(e)},makeNewItemPlaceholder:function(e,t,i){var n=null,o=document.createElement("tr");o.id=t+"placeHolderRow",o.classList.add("navRow");var r=document.createElement("td");r.id=t+"placeHolderCol",r.classList.add("navColumn"),o.appendChild(r),n={wrapperNode:o,refNode:r,destroyFunction:function(){try{o&&o.parentNode&&o.parentNode.removeChild(o)}catch(e){}}};var s,a=this.getRow(e);if(a){if(s=a.parentNode,i){var l=a.nextSibling;s.insertBefore(o,l)}else s.insertBefore(o,a);r.style.paddingLeft=a.firstChild.style.paddingLeft}else s=this.myTree.getContentNode(),s.appendChild(o);return n},getRow:function(e){var i=this.model.getId(e);return i?t.node(i):void 0},collapseAll:function(){for(var e=this._navHandler.getTopLevelNodes(),t=0;t<e.length;t++)this.myTree.collapse(e[t])},expandAll:function(e,t){if(e)this._expandRecursively(e,t);else{if(!this._navHandler)return;for(var i=this._navHandler.getTopLevelNodes(),n=0;n<i.length;n++)this._expandRecursively(i[n],t)}},_inExcludes:function(e,t){if(this.model&&this.model.getId&&Array.isArray(t)){var i=t.some(function(t){return t===this.model.getId(e)}.bind(this));return i}return!1},_expandRecursively:function(e,t){if(this._navHandler&&this._navHandler.isExpandable(e)&&!this._inExcludes(e,t)){var i=this;this.myTree.expand(e,function(){i.model.getChildren(e,function(e){if(void 0!==e&&null!==e)for(var n=e.length,o=0;n>o;o++)i._expandRecursively(e[o],t)})})}},createTree:function(e,o,r){e="string"==typeof e?e:e.id||e,this.selection&&this.selection.setSelections([]),this.getNavHandler()&&this.getNavHandler()._clearSelection();var s=e+"innerTree",a=t.node(s);a&&t.empty(a),o&&(o.rootId=s+"Root"),this.model=o,this._parentId=e,this._treeOptions=r;var l=!r||r&&!r.noSelection;l&&(this.selectionPolicy=r?r.selectionPolicy:"",this._navDict=new n.ExplorerNavDict(this.model)),this.myTree=new i.TableTree({id:s,model:o,parent:e,onComplete:r?r.onComplete:void 0,labelColumnIndex:this.renderer.getLabelColumnIndex(),renderer:this.renderer,showRoot:r?!!r.showRoot:!1,indent:r?r.indent:void 0,preCollapse:r?r.preCollapse:void 0,onCollapse:r?r.onCollapse:void 0,navHandlerFactory:r?r.navHandlerFactory:void 0,tableElement:r?r.tableElement:void 0,tableBodyElement:r?r.tableBodyElement:void 0,tableRowElement:r?r.tableRowElement:void 0}),this.renderer._initializeUIState(),"cursorOnly"===this.selectionPolicy&&this.initNavHandler()},getNavHandler:function(){return this._navHandler},getNavDict:function(){return this._navDict},select:function(e){var t=this.getNavHandler();t&&(t.cursorOn(e,!0),t.setSelection(e))},refreshSelection:function(){if(this.selection){var e=this.getNavHandler(),t=[];if(e&&this.getNavDict())for(var i=e.getSelection(),n=0;n<i.length;n++){var o=e.getRowDiv(i[n]);if(o&&o.parentNode){var r=this.getNavDict().getValue(this.model.getId(i[n]));r.model&&t.push(r.model)}}this.selection.setSelections(t)}},getRootPath:function(){return this.model&&this.model.root?this.model.root.Location:null},initNavHandler:function(){var e=this._treeOptions,t=!e||e&&!e.noSelection;if(t){if(!this.getNavHandler())if(e&&e.navHandlerFactory&&"function"==typeof e.navHandlerFactory.createNavHandler)this._navHandler=e.navHandlerFactory.createNavHandler(this,this._navDict,e);else{var i=e?e.getChildrenFunc:null;this._navHandler=new n.ExplorerNavHandler(this,this._navDict,{getChildrenFunc:i,setFocus:e&&e.setFocus,selectionPolicy:e?e.selectionPolicy:null})}var o=this;this.model.getRoot(function(t){t instanceof Array?o.getNavHandler().refreshModel(o.getNavDict(),o.model,t):t.children&&t.children instanceof Array&&o.getNavHandler().refreshModel(o.getNavDict(),o.model,t.children),e&&e.setFocus&&o.getNavHandler().cursorOn(null,!1,!1,!0)})}},_lastHash:null,checkbox:!1},e}(),s.createExplorerCommands=function(t,i,n,o){function s(e){return"function"==typeof e.getItemCount&&e.getItemCount()>0?i?i(e):!0:!1}var a=new r.Command({tooltip:e["Expand all"],imageClass:"core-sprite-expandAll",id:n?n:"orion.explorer.expandAll",groupId:"orion.explorerGroup",visibleWhen:function(e){return s(e)},callback:function(e){e.items.expandAll()}}),l=new r.Command({tooltip:e["Collapse all"],imageClass:"core-sprite-collapseAll",id:o?o:"orion.explorer.collapseAll",groupId:"orion.explorerGroup",visibleWhen:function(e){return s(e)},callback:function(e){"function"==typeof e.items.preCollapseAll?e.items.preCollapseAll().then(function(t){t&&e.items.collapseAll()}):e.items.collapseAll()}});t.addCommand(a),t.addCommand(l)},s.ExplorerModel=function(){function e(e,t,i){this.rootPath=e,this.fetchItems=t,this.idPrefix=i||""}return e.prototype={destroy:function(){this.destroyed=!0},getRoot:function(e){var t=this;this.fetchItems(this.rootPath).then(function(i){t.root=i,e(i)})},getChildren:function(e,t){e.Children?t(e.Children):e.ChildrenLocation?this.fetchItems(e.ChildrenLocation).then(function(i){e.Children=i,t(i)}):t([])},getId:function(e){if(e.Location===this.root.Location)return this.rootId;for(var t=e.Location.replace(/[\\\/]/g,""),i=this.idPrefix,n=0;n<t.length;n++)i+=t[n].match(/[^\.\:\-\_0-9A-Za-z]/g)?t.charCodeAt(n):t[n];return i}},e}(),s.ExplorerFlatModel=function(){function e(e,t,i){this.rootPath=e,this.fetchItems=t,this.root=i}return e.prototype=new s.ExplorerModel,e.prototype.getRoot=function(e){if(this.root)e(this.root);else{var t=this;this.fetchItems(this.rootPath).then(function(i){t.root=i,e(i)})}},e.prototype.getChildren=function(e,t){t(e===this.root?this.root:[])},e}(),s.ExplorerRenderer=function(){function e(e,t){this.explorer=t,this._init(e),this._expandImageClass="core-sprite-openarrow",this._collapseImageClass="core-sprite-closedarrow",this._progressImageClass="core-sprite-progress",this._twistieSpriteClass="modelDecorationSprite"}return e.prototype={_init:function(e){e&&(this._useCheckboxSelection=void 0===e.checkbox?!1:e.checkbox,this.selectionPolicy=e.singleSelection?"singleSelection":"",this._cachePrefix=e.cachePrefix,e.getCheckedFunc&&(this.getCheckedFunc=e.getCheckedFunc),e.onCheckedFunc&&(this.onCheckedFunc=e.onCheckedFunc),this._noRowHighlighting=e.noRowHighlighting,this._highlightSelection=!0,this._treeTableClass=e.treeTableClass||"treetable",e.highlightSelection===!1&&(this._highlightSelection=!1),this.actionScopeId||(this.actionScopeId=e.actionScopeId),this.commandService||(this.commandService=e.commandService))},getLabelColumnIndex:function(){return this.explorer.checkbox?1:0},initTable:function(e,i){this.tableTree=i,this.tableNode=e,t.empty(e),this._treeTableClass&&e.classList.add(this._treeTableClass),this.renderTableHeader(e);var n=this;e.onclick=function(i){for(var r=i.target,s=r;s&&s!==e&&!s._item;)s=s.parentNode;if(s){var a=t.node(n.expandCollapseImageId(s.id));
if(a){if(a!==r){var l=s._item;if((!n.explorer.isRowSelectable||n.explorer.isRowSelectable(l))&&(void 0===l.selectable||l.selectable))return;if(o.isFormElement(r,s))return}if(!n.explorer.getNavHandler().isDisabled(s)){n.tableTree.toggle(s.id);var c=n.tableTree.isExpanded(s.id);if(c)n._expanded.push(s.id),n.explorer.postUserExpand&&n.explorer.postUserExpand(s.id);else for(var d in n._expanded)if(n._expanded[d]===s.id){n._expanded.splice(d,1);break}var h=n._getUIStatePreferencePath();h&&window.sessionStorage&&n._storeExpansions(h)}}}}},getActionsColumn:function(e,t,i,n,o){i=i||"tool";var r=document.createElement("td");return r.id=t.id+"actionswrapper",n&&r.classList.add(n),this.actionScopeId&&this.commandService?this.commandService.renderCommands(this.actionScopeId,r,e,this.explorer,i,null,o&&this.explorer.getNavDict()?this.explorer.getNavDict().getGridNavHolder(e,!0):null):window.console.log("Warning, no command service or action scope was specified.  No commands rendered."),r},initCheckboxColumn:function(){if(this._useCheckboxSelection){var e=document.createElement("th");return e}},getCheckboxColumn:function(e,i){if(this._useCheckboxSelection){var n=document.createElement("td"),o=document.createElement("span");o.id=this.getCheckBoxId(i.id),o.classList.add("core-sprite-check"),o.classList.add("selectionCheckmarkSprite"),o.rowId=i.id,this.getCheckedFunc&&(o.checked=this.getCheckedFunc(e),o.checked?(this._highlightSelection&&i.classList.add("checkedRow"),o.classList.add("core-sprite-check_on")):(this._highlightSelection&&i.classList.remove("checkedRow"),o.classList.remove("core-sprite-check_on"))),n.appendChild(o);var r=this;return o.addEventListener("click",function(n){var o=n.target.checked?!1:!0;r.onCheck(i,n.target,o,!0,!1,e),t.stop(n)},!1),n}},getCheckBoxId:function(e){return e+"selectedState"},onCheck:function(e,t,i,n,o,r){t.checked=i,i?t.classList.add("core-sprite-check_on"):t.classList.remove("core-sprite-check_on"),this.onCheckedFunc&&this.onCheckedFunc(t.rowId,i,n,r),this.explorer.getNavHandler()&&o&&this.explorer.getNavHandler().setSelection(this.explorer.getNavDict().getValue(e.id).model,!0)},storeSelections:function(){if(this.explorer.getNavHandler()){var e=this.explorer.getNavHandler().getSelectionIds(),t=this._getUIStatePreferencePath();t&&window.sessionStorage&&(window.sessionStorage[t+"selection"]=JSON.stringify(e))}},_restoreSelections:function(e){var i=this.explorer.getNavDict(),n=this.explorer.getNavHandler();if(n&&i&&"cursorOnly"!==n.getSelectionPolicy()){var o=window.sessionStorage[e+"selection"];"string"==typeof o&&(o=o.length>0?JSON.parse(o):null);var r;if(o){var s=[];for(r=0;r<o.length;r++){var a=i.getValue(o[r]);if(a&&a.rowDomNode&&a.model){s.push(a.model),this._highlightSelection&&a.rowDomNode.classList.add("checkedRow");var l=t.node(this.getCheckBoxId(a.rowDomNode.id));l&&(l.checked=!0,l.classList.add("core-sprite-check_on"))}}this.explorer.selection&&(this.explorer.selection.setSelections(s),this.explorer.getNavHandler()&&this.explorer.getNavHandler().refreshSelection())}}},_storeExpansions:function(e){window.sessionStorage[e+"expanded"]=JSON.stringify(this._expanded)},_restoreExpansions:function(e){var i=!1,n=window.sessionStorage[e+"expanded"];"string"==typeof n&&(n=n.length>0?JSON.parse(n):null);var o;if(n)for(o=0;o<n.length;o++){var r=t.node(n[o]);if(r){this._expanded.push(n[o]);var s=this;this.tableTree.expand(n[o],function(){s._restoreSelections(e)}),i=!0}}return!i},_getUIStatePreferencePath:function(){if(this.explorer){var e=this.explorer.getRootPath();if(this._cachePrefix&&e){var t=e.replace(/[^\.\:\-\_0-9A-Za-z]/g,"");return"/"+this._cachePrefix+"/"+t+"/uiState"}}return null},expandCollapseImageId:function(e){return e+"__expand"},updateExpandVisuals:function(e,i){var n=t.node(this.expandCollapseImageId(e.id));n&&(n.classList.remove(this._expandImageClass),n.classList.remove(this._collapseImageClass),n.classList.remove(this._progressImageClass),n.classList.add("progress"===i?this._progressImageClass:i?this._expandImageClass:this._collapseImageClass))},getExpandImage:function(e,t,i,n){var o=document.createElement("span");if(o.id=this.expandCollapseImageId(e.id),t.appendChild(o),o.classList.add(this._twistieSpriteClass),o.classList.add(this._collapseImageClass),i){var r=document.createElement("span");t.appendChild(r),r.classList.add(n||"imageSprite"),r.classList.add(i)}return o},render:function(e,t){t.classList.add("navRow"),this.renderRow(e,t)},rowsChanged:function(){if("cursorOnly"!==this.explorer.selectionPolicy&&(this.explorer.refreshSelection(),this.explorer.initNavHandler()),!this._noRowHighlighting){var e="darkSectionTreeTableRow",i="lightSectionTreeTableRow";(t.$(".sectionTreeTable",this.tableNode.parentNode)||t.$(".treetable",this.tableNode.parentNode))&&t.$$array(".treeTableRow",this.tableNode).forEach(function(t,n){var o=n%2?e:i,r=o===i?e:i;t.classList.add(o),t.classList.remove(r)})}},updateCommands:function(){if(this.commandService)for(var e=t.$$array(".treeTableRow"),i=0;i<e.length;i++){var n=e[i],o=n.id+"actionswrapper",r=t.node(o);this.commandService.destroy(r),this.actionScopeId&&this.commandService.renderCommands(this.actionScopeId,r,n._item,this.explorer,"tool")}},_initializeUIState:function(){this._expanded=[];var e=this._getUIStatePreferencePath();e&&window.sessionStorage&&this._restoreExpansions(e)&&this._restoreSelections(e)}},e}(),s.SelectionRenderer=function(){function e(e,t){this._init(e),this.explorer=t}return e.prototype=new s.ExplorerRenderer,e.prototype.renderTableHeader=function(e){var t=document.createElement("thead"),i=document.createElement("tr");t.classList.add("navTableHeading"),this._useCheckboxSelection&&i.appendChild(this.initCheckboxColumn(e));for(var n=0,o=this.getCellHeaderElement(n);o;)o.innerHTML.length>0&&o.classList.add("navColumn"),i.appendChild(o),o=this.getCellHeaderElement(++n);t.appendChild(i),n>0&&e.appendChild(t)},e.prototype.initSelectableRow=function(e,t){var i=this;t.addEventListener("click",function(t){i.explorer.getNavHandler()&&i.explorer.getNavHandler().onClick(e,t)},!1)},e.prototype.renderRow=function(e,t){t.verticalAlign="baseline",t.classList.add("treeTableRow");var i=this.explorer.getNavDict();if(i&&("cursorOnly"!==this.explorer.selectionPolicy&&t.classList.add("selectableNavRow"),i.addRow(e,t)),void 0===e.selectable||e.selectable){var n=this.getCheckboxColumn(e,t);n&&(n.classList.add("checkColumn"),t.appendChild(n))}for(var o=0,r=this.getCellElement(o,e,t);r;)t.appendChild(r),r.classList.add(0===o?this.getPrimColumnStyle?this.getPrimColumnStyle(e):"navColumn":this.getSecondaryColumnStyle?this.getSecondaryColumnStyle(o):"secondaryColumn"),r=this.getCellElement(++o,e,t)},e.prototype.getCellHeaderElement=function(){},e.prototype.getCellElement=function(){},e}(),s.SimpleFlatModel=function(){function e(e,t,i){this.items=e,this.getKey=i,this.idPrefix=t,this.root={children:e}}return e.prototype=new s.ExplorerModel,e.prototype.getRoot=function(e){e(this.root)},e.prototype.getId=function(e){for(var t=this.getKey(e),i=t.replace(/[\\\/]/g,""),n="",o=0;o<i.length;o++)n+=i[o].match(/[^\.\:\-\_0-9A-Za-z]/g)?i.charCodeAt(o):i[o];return this.idPrefix+n},e.prototype.getChildren=function(e,t){t(e===this.root?this.items:[])},e}(),s}),define("orion/URITemplate",[],function(){function e(e){this._text=e}function t(e){return e.replace("%25","%")}function i(e,i){if("U"===i)return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()});if("U+R"===i)return encodeURI(e).replace(/%5B/g,"[").replace(/%5D/g,"]").replace(h,t);if("U+R-,"===i)return encodeURI(e).replace(/%5B/g,"[").replace(/%5D/g,"]").replace(/,/g,"%2C");throw new Error("Unknown allowed character set: "+i)}function n(e,t,n){for(var o=[],r=0;r<e.length;r++)"undefined"!=typeof e[r]&&o.push(i(e[r],t));return o.join(n)}function o(e,t,n,o){for(var r=Object.keys(e),s=[],a=0;a<r.length;a++)"undefined"!=typeof e[r[a]]&&s.push(i(r[a],t)+n+i(e[r[a]],t));return s.join(o)}function r(e){for(var t=[],i=e.split(","),n=0;n<i.length;n++){var o=i[n].match(d);if(null===o)throw new Error("Bad VarSpec: "+e);t.push({name:o[1],explode:!!o[2],prefix:o[3]?parseInt(o[3],10):-1})}return t}function s(e){if(0===e.length)throw new Error("Invalid Expression: 0 length expression");this._operator=c[e[0]],this._operator?e=e.substring(1):this._operator=c.NUL,this._varSpecList=r(e)}function a(t){for(var i=[],n=0,o=t.indexOf("{",n);-1!==o;){i.push(new e(t.substring(n,o)));var r=t.indexOf("}",o+1);if(-1===r)throw new Error("Invalid template: "+t);i.push(new s(t.substring(o+1,r))),n=r+1,o=t.indexOf("{",n)}return i.push(new e(t.substring(n))),i}function l(e){this._templateComponents=a(e)}var c={NUL:{first:"",sep:",",named:!1,ifemp:"",allow:"U"},"+":{first:"",sep:",",named:!1,ifemp:"",allow:"U+R"},".":{first:".",sep:",",named:!1,ifemp:"",allow:"U"},"/":{first:"/",sep:"/",named:!1,ifemp:"",allow:"U"},";":{first:";",sep:";",named:!0,ifemp:"",allow:"U"},"?":{first:"?",sep:"&",named:!0,ifemp:"=",allow:"U"},"&":{first:"&",sep:"&",named:!0,ifemp:"=",allow:"U"},"#":{first:"#",sep:",",named:!1,ifemp:"",allow:"U+R"},",":{first:"",sep:",",named:!1,ifemp:"",allow:"U+R-,"}},d=/^((?:(?:[a-zA-Z0-9_])|(?:%[0-9A-F][0-9A-F]))(?:(?:[a-zA-Z0-9_.])|(?:%[0-9A-F][0-9A-F]))*)(?:(\*)|:([0-9]+))?$/,h=/%25[0-9A-F][0-9A-F]/g;return e.prototype={expand:function(){return encodeURI(this._text)}},s.prototype={expand:function(e){for(var t=[],r=0;r<this._varSpecList.length;r++){var s=this._varSpecList[r],a=s.name,l=e[a],c=typeof l;if("undefined"!==c&&null!==l){var d=0===t.length?this._operator.first:this._operator.sep;if("string"===c)this._operator.named&&(d+=i(a,"U+R"),d+=0===l.length?this._operator.ifemp:"="),-1!==s.prefix&&s.prefix<l.length&&(l=l.substring(0,s.prefix)),d+=i(l,this._operator.allow);else if(Array.isArray(l)){if(0===l.length)continue;if(s.explode)d+=n(l,this._operator.allow,this._operator.sep);else{var h=n(l,this._operator.allow,",");this._operator.named&&(d+=i(a,"U+R"),d+=0===h.length?this._operator.ifemp:"="),d+=h}}else{if("object"!==c)throw new Error("bad param type: "+a+" : "+c);if(0===Object.keys(l).length)continue;if(s.explode)d+=o(l,this._operator.allow,"=",this._operator.sep);else{var u=o(l,this._operator.allow,",",",");this._operator.named&&(d+=i(a,"U+R"),d+=0===u.length?this._operator.ifemp:"="),d+=u}}t.push(d)}}return t.join("")}},l.prototype={expand:function(e){for(var t=[],i=0;i<this._templateComponents.length;i++)t.push(this._templateComponents[i].expand(e));return t.join("")}},l}),define("orion/keyBinding",["orion/util"],function(e){function t(e,t,i,n,o,r){this.type=r||"keydown",this.keyCode="string"==typeof e&&"keydown"===this.type?e.toUpperCase().charCodeAt(0):e,this.mod1=void 0!==t&&null!==t?t:!1,this.mod2=void 0!==i&&null!==i?i:!1,this.mod3=void 0!==n&&null!==n?n:!1,this.mod4=void 0!==o&&null!==o?o:!1}function i(e){this.keys=e}return t.prototype={getKeys:function(){return[this]},match:function(t,i){if(void 0!==i){if(0!==i)return!1}else if(t instanceof Array){if(t.length>1)return!1;t=t[0]}if(t.type!==this.type)return!1;if(this.keyCode===t.keyCode||this.keyCode===String.fromCharCode(e.isOpera?t.which:void 0!==t.charCode?t.charCode:t.keyCode)){var n=e.isMac?t.metaKey:t.ctrlKey;return this.mod1!==n?!1:"keydown"===this.type&&this.mod2!==t.shiftKey?!1:this.mod3!==t.altKey?!1:e.isMac&&this.mod4!==t.ctrlKey?!1:!0}return!1},equals:function(e){return e?this.keyCode!==e.keyCode?!1:this.mod1!==e.mod1?!1:this.mod2!==e.mod2?!1:this.mod3!==e.mod3?!1:this.mod4!==e.mod4?!1:this.type!==e.type?!1:!0:!1}},i.prototype={getKeys:function(){return this.keys.slice(0)},match:function(e,t){var i=this.keys;if(void 0!==t)return t>i.length?!1:i[t].match(e)?t===i.length-1?!0:t+1:!1;if(e instanceof Array||(e=[e]),e.length>i.length)return!1;var n;for(n=0;n<e.length;n++)if(!i[n].match(e[n]))return!1;return n===i.length?!0:n},equals:function(e){if(!e.keys)return!1;if(e.keys.length!==this.keys.length)return!1;for(var t=0;t<e.keys.length;t++)if(!e.keys[t].equals(this.keys[t]))return!1;return!0}},{KeyBinding:t,KeyStroke:t,KeySequence:i}}),define("text!orion/banner/CommandSlideout.html",[],function(){return'<div id="slideContainer" class="slideParameters slideContainer">\n	<span id="pageCommandParameters" class="layoutLeft parameters"></span>\n	<span id="pageCommandDismiss" class="layoutRight parametersDismiss"></span>\n</div>'}),define("orion/commonHTMLFragments",["orion/webui/littlelib","text!orion/banner/CommandSlideout.html"],function(e,t){function i(i){var n=document.createElement("div");n.innerHTML=t;var o=e.$("#slideContainer",n);return o.id=i+o.id,o=e.$("#pageCommandParameters",n),o.id=i+o.id,o=e.$("#pageCommandDismiss",n),o.id=i+o.id,n.innerHTML}return{slideoutHTMLFragment:i}}),define("orion/parameterCollectors",["i18n!orion/nls/messages","orion/webui/littlelib"],function(e,t){function i(e,t){this._activeContainer=null,this._getElementsFunction=e,this._toolbarLayoutFunction=t}return i.prototype={close:function(){this._activeElements&&(this._activeElements.parameterArea&&t.empty(this._activeElements.parameterArea),this._activeElements.slideContainer&&this._activeElements.slideContainer.classList.remove("slideContainerActive"),this._activeElements.dismissArea&&t.empty(this._activeElements.dismissArea),this._activeElements.commandNode&&this._activeElements.commandNode.classList.remove("activeCommand"),this._toolbarLayoutFunction(this._activeElements),this._activeElements.onClose&&this._activeElements.onClose(),this._oldFocusNode&&(this._oldFocusNode.focus(),this._oldFocusNode=null)),this._activeElements=null},open:function(i,n,o){if("string"==typeof i&&(i=t.node(i)),this._activeElements&&this._activeElements.slideContainer&&this._activeElements.commandNode===i)return this._activeElements.focusNode&&this._activeElements.focusNode.focus(),!0;if(this.close(),this._activeElements=null,this._activeElements=this._getElementsFunction(i),this._activeElements&&this._activeElements.parameterArea&&this._activeElements.slideContainer){this._activeElements.onClose=o;var r=n(this._activeElements.parameterArea,this._activeElements.dismissArea);if(!r)return!1;this._activeElements.focusNode=r;var s=t.$$array("#closebox",this._activeElements.dismissArea||this._activeElements.parameterArea);if(0===s.length){var a=this._activeElements.dismissArea||this._activeElements.parameterArea;s=document.createElement("button"),s.id="closebox",s.className="imageSprite core-sprite-close dismissButton",s.title=e.Close,a.appendChild(s);var l=this;s.addEventListener("click",function(){l.close()},!1)}return this._activeElements.slideContainer.classList.add("slideContainerActive"),this._toolbarLayoutFunction(this._activeElements),r&&(this._oldFocusNode=window.document.activeElement,window.setTimeout(function(){r.focus(),r.select&&r.select()},0)),this._activeElements.commandNode&&this._activeElements.commandNode.classList.add("activeCommand"),!0}return!1},_collectAndCall:function(e,i){var n=function(t,i,n){return e.parameters.validate(t,i)?(e.parameters.setValue(t,i),!0):(n.classList.add("parameterInvalid"),!1)},o=function(e){if("checkbox"===e.type){if(!n(e.parameterName,e.checked,e))return!0}else if("button"!==e.type){if(!n(e.parameterName,e.value.trim(),e))return!0}else if("textarea"!==e.type&&!n(e.parameterName,e.value.trim(),e))return!0;return!1};if(t.$$array("input",i).some(o))return!1;if(t.$$array("textArea",i).some(o))return!1;var r=e.parameters.getParameterElement;return r&&e.parameters.some(function(e){var t=r(e,i);return t?o(t):!1})?!1:(e.command.callback&&e.command.callback.call(e.handler,e),!0)},collectParameters:function(e,t){return e.parameters?(e.domNode&&e.domNode.classList.add("commandMarker"),this.open(e.domNode||e.domParent,this.getFillFunction(e,null,t))):!1},getFillFunction:function(i,n,o){var r=this;return function(s,a){var l=null,c=function(){n&&n(),r.close()},d=function(e){e.target.classList.remove("parameterInvalid"),e.keyCode===t.KEY.ENTER&&"TEXTAREA"!==e.target.tagName&&(r._collectAndCall(i,s),c(),t.stop(e)),e.keyCode===t.KEY.ESCAPE&&("function"==typeof o&&o(),c(),t.stop(e))},h=function(e,t){var i=document.createElement("button");return t.appendChild(i),e&&i.appendChild(document.createTextNode(e)),i.classList.add("dismissButton"),i},u=i.parameters;if(u.message){var p=document.createElement("div");p.classList.add("parameterMessage"),p.textContent="function"==typeof u.message?u.message(i):u.message,s.appendChild(p)}u.forEach(function(e){var t=u.getParameterElement?u.getParameterElement(e,s):null,n=null;!t&&e.label&&(n=document.createElement("label"),n.classList.add("parameterInput"),n.setAttribute("for",e.name+"parameterCollector"),n.textContent=e.label,s.appendChild(n));var o=e.type,r=e.name+"parameterCollector",a=n||s;"text"===o&&"number"==typeof e.lines&&e.lines>1?t||(t=document.createElement("textarea"),t.rows=e.lines,t.type="textarea",t.id=r,a.appendChild(t)):"boolean"===e.type?(t||(t=document.createElement("input"),t.type="checkbox",t.id=r,a.appendChild(t)),e.value&&(t.checked=!0)):"button"===e.type?t?e.value&&(t.value=e.value):(t=h(e.value||"",a),t.id=r):(t||(t=document.createElement("input"),t.type=e.type,t.id=r,a.appendChild(t)),e.value&&(t.value=e.value)),t.classList.add("parameterInput"),t.setAttribute("speech","speech"),t.setAttribute("x-webkit-speech","x-webkit-speech"),t.parameterName=e.name,l||(l=t),e.eventListeners.length>0&&e.eventListeners.forEach(function(e){t.addEventListener(e.event,function(t){return e.handler(t,i)},e.capture)}),t.addEventListener("keydown",d,!1)});var f=a;f||(f=document.createElement("span"),f.classList.add("layoutRight"),f.classList.add("parametersDismiss"),s.appendChild(f));var g=function(e){e._collectAndCall(i,s)&&c()};if(i.parameters.hasOptionalParameters()){i.parameters.optionsRequested=!1;var m=h(e.More,f);m.addEventListener("click",function(){i.parameters.optionsRequested=!0,g(r)},!1)}var v=h(u.getSubmitName?u.getSubmitName(i):e.Submit,f);v.addEventListener("click",function(){g(r)},!1);var _=u.getCancelName?u.getCancelName(i):null,y=h(_,f);return y.id="closebox",_||(y.classList.add("imageSprite"),y.classList.add("core-sprite-close")),y.title=e.Close,y.addEventListener("click",function(){c(),"function"==typeof o&&o()},!1),l}}},i.prototype.constructor=i,{CommandParameterCollector:i}}),define("orion/contentTypes",["orion/serviceTracker"],function(e){function t(e,t){return-1!==e.indexOf(t)}function i(e){switch(e&&e.id){case"image/jpeg":case"image/png":case"image/gif":case"image/ico":case"image/tiff":case"image/svg":return!0}return!1}function n(e){return e?"application/octet-stream"===e.id||"application/octet-stream"===e["extends"]:!1}function o(e,i){if("string"!=typeof e)return null;var n,o=null,r=e.indexOf(".");r++;for(var s=e.substring(r).toLowerCase(),a=0;a<i.length;a++){if(n=i[a],n.filename.indexOf(e)>=0){o=n;break}t(n.extension,s)&&(o=n)}if(!o)for(r=s.indexOf(".");!o&&r>=0;){for(r++,s=s.substring(r),a=0;a<i.length;a++)if(n=i[a],t(n.extension,s)){o=n;break}r=s.indexOf(".")}return o}function r(e){return null===e||"undefined"==typeof e?[]:Array.isArray(e)?e:[e]}function s(e){return r(e).map(function(e){return String.prototype.toLowerCase.call(e)})}function a(e){return{id:e.id,name:e.name,image:e.image,imageClass:e.imageClass,"extends":e["extends"],extension:s(e.extension),filename:r(e.filename)}}function l(e,t){t.map(a).forEach(function(t){Object.prototype.hasOwnProperty.call(e,t.id)||(e[t.id]=t)})}function c(e,t){t.map(a).forEach(function(t){Object.prototype.hasOwnProperty.call(e,t.id)&&delete e[t.id]})}function d(e,t){for(var i=r(e.getProperty("contentTypes")),n=0;n<i.length;n++)t.push(i[n])}function h(e){var t=Object.create(null);return l(t,e),t}function u(e){for(var t=e.getServiceReferences(g).concat(e.getServiceReferences(m)),i=[],n=0;n<t.length;n++){var o=t[n];d(o,i)}return h(i)}function p(t){if(t&&t.registerService){this.serviceRegistry=t;var i=new e(this.serviceRegistry,"orion.core.contenttype"),n=this;i.onServiceAdded=function(e){var t=[];d(e,t),l(n.map,t)},i.removedService=function(e){var t=[];d(e,t),c(n.map,t)},i.open(!1),this.map=u(t),t.registerService(f,this)}else{if(!Array.isArray(t))throw new Error("Invalid parameter");this.serviceRegistry=null,this.map=h(t)}}var f="orion.core.contentTypeRegistry",g="orion.core.contenttype",m="orion.file.contenttype";return p.prototype={getContentTypes:function(){var e=this.getContentTypesMap(),t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.push(e[i]);return t},getContentTypesMap:function(){return this.map},getFileContentType:function(e){return o(e.Name,this.getContentTypes())},getFilenameContentType:function(e){return o(e,this.getContentTypes())},getContentType:function(e){return this.map[e]||null},isExtensionOf:function(e,t){if(e="string"==typeof e?this.getContentType(e):e,t="string"==typeof t?this.getContentType(t):t,!e||!t)return!1;if(e.id===t.id)return!0;for(var i=e,n={};i&&(i=this.getContentType(i["extends"]));){if(i.id===t.id)return!0;if(n[i.id])throw new Error("Cycle: "+i.id);n[i.id]=!0}return!1},isSomeExtensionOf:function(e,t){for(var i=0;i<t.length;i++)if(this.isExtensionOf(e,t[i]))return!0;return!1}},{ContentTypeRegistry:p,isImage:i,isBinary:n,getFilenameContentType:o}}),define("orion/PageUtil",[],function(){function e(){var e=window.location.href.split("#")[1];return e=e?"#"+e:""}function t(e){e=e||window.location.toString();var t={resource:""},i=e.indexOf("#");if(-1!==i){var n=e.substring(i+1);if(0!==n.length){var o=n.split(",");t.resource=decodeURIComponent(o[0]);for(var r=1;r<o.length;r++){var s=o[r],a=/([^=]*)(=?)(.*)/.exec(s),l=decodeURIComponent(a[1]||""),c=decodeURIComponent(a[3]||"");""!==l&&"resource"!==l&&(t[l]=c)}}}return t}function i(e,t){var i=e;if(-1===e.indexOf("://")){var o=document.createElement("a");o.href=e,i=o.href}var r=!1;return r=t?t.some(function(e){return new RegExp("^"+e+":","i").test(i)}):n.test(i),r?e:(console.log("Illegal URL Scheme: '"+e+"'"),"")}var n=new RegExp("^http[s]?","i");return{hash:e,matchResourceParameters:t,validateURLScheme:i}}),define("orion/PageLinks",["require","orion/Deferred","orion/PageUtil","orion/URITemplate","orion/i18nUtil","orion/objects","orion/URL-shim"],function(e,t,i,n,o,r){function s(){if(e.toUrl){var t=new URL(e.toUrl("orion/"),self.location.href);return new URL("../",t).href.slice(0,-1)}return new URL("/",self.location.href).href.slice(0,-1)}function a(e,t){return c(e,t).then(function(e){return new u(e)})}function l(e){var t={};return e.getPropertyKeys().forEach(function(i){"objectClass"!==i&&"service.names"!==i&&"service.id"!==i&&"__plugin__"!==i&&(t[i]=e.getProperty(i))}),t}function c(e,o){o=o||"orion.page.link";var r=e.getServiceReferences(o),a=i.matchResourceParameters(window.location.href),c=s(),d={OrionHome:c,Location:a.resource},h=[];return r.forEach(function(e){var o=l(e);if(o.uriTemplate&&(o.nls||o.name)){var r=new n(o.uriTemplate),s=r.expand(d);s=i.validateURLScheme(s),o.href=s,o.textContent=o.name||o.nameKey,h.push((new t).resolve(o))}}),t.all(h)}function d(e){var i;if(!g){i=[];var n=e.getServiceReferences("orion.page.link.category");return n.forEach(function(n){var o=l(n);o.id&&(o.name||o.nameKey)&&(o.service=e.getService(n),o.textContent=o.name,i.push((new t).resolve(o)))}),t.all(i).then(function(e){return g=new h(e)})}return(new t).resolve(g)}function h(e){var t=this.categories=Object.create(null);e.forEach(function(e){t[e.id]=e})}function u(e){this.allPageLinks=e,this.allPageLinks.sort(p)}function p(e,t){var i=e.textContent&&e.textContent.toLowerCase(),n=t.textContent&&t.textContent.toLowerCase();return n>i?-1:i>n?1:0}function f(e,t,i){var n=document.createElement("a");return n.href=e,n.target=t,n.classList.add("targetSelector"),n.textContent=i,n}var g;return r.mixin(h.prototype,{getCategoryIDs:function(){return Object.keys(this.categories)},getCategory:function(e){return this.categories[e]||null}}),r.mixin(u.prototype,{createLinkElements:function(){return this.allPageLinks.map(function(e){return f(e.href,"_self",e.textContent)})},getAllLinks:function(){return this.allPageLinks}}),{getCategoriesInfo:d,getPageLinksInfo:a,getOrionHome:s}}),define("orion/extensionCommands",["orion/Deferred","orion/commands","orion/contentTypes","orion/URITemplate","orion/i18nUtil","orion/PageLinks","i18n!orion/edit/nls/messages","orion/URL-shim"],function(e,t,i,n,o,r,s){function a(e){var t={},i=e.getPropertyKeys();return i.forEach(function(i){t[i]=e.getProperty(i)}),t}function l(e){return e.id||e.name}var c={},d=r.getOrionHome();c._cloneItemWithoutChildren=function f(e){if(null===e||"object"!=typeof e)return e;var t=e.constructor();for(var i in e)"children"!==i&&"Children"!==i&&"parent"!==i&&"Project"!==i&&(t[i]=f(e[i]));return t},c._getOpenWithNavCommandExtensions=function(e){function t(){for(var t=e.getServiceReferences("orion.edit.editor"),i=[],n=0;n<t.length;n++){var o=t[n],r=o.getProperty("id");i.push({id:r,"default":o.getProperty("default")||!1,name:o.getProperty("name"),nameKey:o.getProperty("nameKey"),nls:o.getProperty("nls"),uriTemplate:o.getProperty("orionTemplate")||o.getProperty("uriTemplate"),validationProperties:o.getProperty("validationProperties")||[]})}return i}function i(e,t){for(var i=e.getServiceReferences("orion.navigate.openWith"),n=[],o=[],r=0;r<i.length;r++){var s=i[r];if(s.getProperty("editor")===t.id){var a=s.getProperty("contentType");a instanceof Array?n=n.concat(a):n.push(a||"*/*");var l=s.getProperty("excludedContentTypes");l instanceof Array?o=o.concat(l):null!==l&&"undefined"!=typeof l&&o.push(l)}}return 0===n.length&&(n=null),0===o.length&&(o=null),{contentTypes:n,excludedContentTypes:o}}for(var n,o=t(),r=[],s="orion.editor",a=0;a<o.length;a++){var l=o[a],c=i(e,l),d=c.contentTypes,h=c.excludedContentTypes,u={name:l.name||l.id,nameKey:l.nameKey,id:"eclipse.openWithCommand."+l.id,contentType:d,excludedContentTypes:h,uriTemplate:l.uriTemplate,nls:l.nls,forceSingleItem:!0,isEditor:l["default"]?"default":"editor",validationProperties:l.validationProperties},p={properties:u,service:{}};l.id===s?n=p:r.push(p)}return n&&r.push(n),r},c._makeValidator=function(e,t,o,r){function s(e,t,i,n,o){var r,s=!1;if("!"===t.charAt(0))return"undefined"==typeof e[t.substring(1)];if("undefined"!=typeof e[t]){if("undefined"==typeof i)r=e[t],s=!0;else if("string"==typeof i){if(!n.variableName)return new RegExp(i).test(e[t]);var a=new RegExp(i).exec(e[t]);if(a){var l=a[0];r="before"===n.variableMatchPosition?e[t].substring(0,a.index):"after"===n.variableMatchPosition?e[t].substring(a.index+l.length):"only"===n.variableMatchPosition?l:e[t],s=!0}}else e[t]===i&&(r=e[t],s=!0);var c=n.variableName,d=n.replacements;if(s&&c&&(o[c]=r,o.itemCached=e,d)){if("string"!=typeof r)return window.console.log("Cannot replace "+c+", value is not a string: "+r),s;for(var h=0;h<d.length;h++){var u=!1;if(d[h].pattern){var p=d[h].pattern,f=d[h].replacement||"";o[c]=o[c].replace(new RegExp(p),f).replace(new RegExp(p),f)}else u=!0;u&&window.console.log("Invalid replacements specified in validation property.  "+d[h])}}return s}return!1}function a(e,t,i,n){var o,r,l,c,d=i.match;if((l=t.indexOf("["))>=0){if((c=t.indexOf("]"))<0)return!1;var h,u,p=t.substring(0,l);if(!(h=e[p])||!Array.isArray(h))return!1;if(o=t.substring(l+1,c),u=parseInt(o,10),isNaN(u))return!1;0>u&&(u+=h.length),r=t.substring(c+1),t=p+":"+String(u)+r}return t.indexOf("|")>=0?(o=t.substring(0,t.indexOf("|")),r=t.substring(t.indexOf("|")+1),a(e,o,i,n)?!0:a(e,r,i,n)):t.indexOf(":")>=0?(o=t.substring(0,t.indexOf(":")),r=t.substring(t.indexOf(":")+1),e[o]?a(e[o],r,i,n):!1):s(e,t,d,i,n)}function l(t,n,o){if(o.info.validationProperties)for(var r=0;r<o.info.validationProperties.length;r++){var s=o.info.validationProperties[r];if("undefined"==typeof s.source)return window.console.log("Invalid validationProperties in "+e.id+".  No source property specified."),!1;var l=a(t,s.source,s,o);if(!l)return!1}if(!o.info.contentType&&!o.info.excludedContentTypes)return!0;if(t.Directory)return o.info.contentType&&o.info.contentType.indexOf("*/*")>=0?!0:!1;var c=!0,d=n?i.getFilenameContentType(t.Name,n):null;return d=d||{id:"application/octet-stream"},o.info.excludedContentTypes&&n&&(c=o.info.excludedContentTypes.every(function(e){var t=e.replace(/([*?])/g,".$1");return-1!==d.id.search(t)?!1:!0})),c&&o.info.contentType&&n&&(c=o.info.contentType.some(function(e){var t=e.replace(/([*?])/g,".$1");return-1!==d.id.search(t)?!0:!1})),c}var c={info:e};return c.validationFunction=function(e){if("function"==typeof r&&(e=r.call(this,e)),e){if(Array.isArray(e)){if((this.info.forceSingleItem||this.info.uriTemplate)&&1!==e.length)return!1;if(e.length<1)return!1}else e=[e];for(var t=0;t<e.length;t++)if(!l(e[t],o,this))return!1;return!0}return!1},c.generatesURI=function(){return!!this.info.uriTemplate},c.getURI=function(e){if(this.info.uriTemplate){var t={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);if(this.info.validationProperties)for(var o=0;o<this.info.validationProperties.length;o++){var r=this.info.validationProperties[o];if(r.source&&r.variableName){var s=this.itemCached===e&&this[r.variableName];s||a(e,r.source,r,this),e[r.variableName]?window.console.log("Variable name "+r.variableName+" in the extension "+this.info.id+" conflicts with an existing property in the item metadata."):t[r.variableName]=this[r.variableName]}}t.OrionHome=d;var l=new n(this.info.uriTemplate);return l.expand(t)}return null},c};var h=s.UnnamedCommand,u="";c._createCommandOptions=function(t,i,n,o,r,s){function a(e,a){var l=c._makeValidator(t,n,o,s);if(e.visibleWhen=l.validationFunction.bind(l),r)if(l.generatesURI.bind(l)())e.hrefCallback=function(e){var t=Array.isArray(e.items)?e.items[0]:e.items;return l.getURI.bind(l)(t)};else{var d=t;e.callback=function(t){var o;if(d.forceSingleItem){var r=Array.isArray(t.items)?t.items[0]:t.items;o=c._cloneItemWithoutChildren(r)}else if(Array.isArray(t.items)){o=[];for(var s=0;s<t.items.length;s++)o.push(c._cloneItemWithoutChildren(t.items[s]))}else o=c._cloneItemWithoutChildren(t.items);if(n)var a=n.getService("orion.page.progress");i.run?a?a.progress(i.run(o),"Running command: "+e.name):i.run(o):n&&(a?a.progress(n.getService(i).run(o),"Running command: "+e.name):n.getService(i).run(o))}}a.resolve(e)}var d=new e,p={name:t.name||t.nameKey||h,image:t.image,id:l(t),tooltip:t.tooltip||t.tooltipKey||u,isEditor:t.isEditor,showGlobally:t.showGlobally};return a(p,d),d},c.getOpenWithCommand=function(e,t,i){for(var n,o=i||c.getOpenWithCommands(e),r=0;r<o.length;r++)if(o[r].visibleWhen(t)){var s="default"===o[r].isEditor;if((!n||s)&&(n=o[r],s))break}return n},c.getOpenWithCommands=function(e){var t=[];for(var i in e._commandList){var n=e._commandList[i];n.isEditor&&t.push(n)}return t};var p;return c.createAndPlaceFileCommandsExtension=function(e,t,i,n,o,r){var a=r?"all":void 0,l=!!r;return c.createFileCommands(e,null,a,l,t).then(function(e){return o&&0<e.length&&(t.addCommandGroup(i,"eclipse.openWith",1e3,s.OpenWith,o,null,null,null,"dropdownSelection"),t.addCommandGroup(i,"eclipse.fileCommandExtensions",1e3,s.OpenRelated,o)),e.forEach(function(e){var r=null;o&&(r=e.isEditor?o+"/eclipse.openWith":o+"/eclipse.fileCommandExtensions"),t.registerCommandContribution(i,e.id,n,r)}),{}})},c.createFileCommands=function(i,n,o,r,s){function a(){var t=i.getService("orion.core.contentTypeRegistry")||n;return p||e.when(t.getContentTypes(),function(e){return p=e})}o=void 0===o?"global":o,r=void 0===r?!0:r;var d=[];return c._cachedFileCommands||c._createCachedFileCommands(i),("all"===o||"global"===o)&&c._cachedFileCommands.forEach(function(e){var t=e.properties;("all"===o||t.forceSingleItem&&t.showGlobally)&&d.push(e)}),e.when(a(),function(){r&&(c._cachedOpenWithExtensions||(c._cachedOpenWithExtensions=c._getOpenWithNavCommandExtensions(i,p)),d=d.concat(c._cachedOpenWithExtensions),s._addedOpenWithCommands=r);var n=d.map(function(n){var o=n.properties,r=n.service,a=s.findCommand(l(o));return a?(new e).resolve(a):c._createCommandOptions(o,r,i,p,!0).then(function(e){var i=new t.Command(e);
return s.addCommand(i),i})});return e.all(n,function(e){return{_error:e}}).then(function(e){return e})})},c._createCachedFileCommands=function(e){var t=e.getServiceReferences("orion.navigate.command");c._cachedFileCommands=[];for(var i=0;i<t.length;i++){var n=t[i].getProperty("id");if("orion.navigateFromMetadata"!==n){var o=e.getService(t[i]),r=a(t[i]);c._cachedFileCommands.push({properties:r,service:o})}}},c.getFileCommandIds=function(){var e=[];if(!c._cachedFileCommands)throw"extensionCommandUtils._cachedFileCommands is not initialized";return c._cachedFileCommands.length&&(e=c._cachedFileCommands.map(function(e){return e.properties.id})),e},c.createOpenWithCommands=function(t,i,n){return n&&n._addedOpenWithCommands?(new e).resolve(c.getOpenWithCommands(n)):c.createFileCommands(t,i,"none",!0,n)},c}),define("orion/breadcrumbs",["require","orion/webui/littlelib"],function(e,t){function i(e){this._init(e)}return i.prototype={_init:function(e){var i=t.node(e.container);if(!i)throw"no parent container";this._container=i,i.classList.remove("currentLocation"),this._id=e.id||"eclipse.breadcrumbs",this._resource=e.resource||null,this._rootSegmentName=e.rootSegmentName,this._workspaceRootSegmentName=e.workspaceRootSegmentName,this._workspaceRootURL=e.workspaceRootURL,this._makeHref=e.makeHref,this._makeFinalHref=e.makeFinalHref,this._maxLength=e.maxLength,this.path="",this.render(),this._resizeListener=this.fitSegments.bind(this),window.addEventListener("resize",this._resizeListener)},getNavigatorWorkspaceRootSegment:function(){if(this._workspaceRootSegmentName){var i;if(this._resource&&this._resource.Parents&&!this._resource.skip){i=document.createElement("a");var n=this._workspaceRootURL?this._workspaceRootURL:"";this._makeHref?this._makeHref(i,n):i.href=e.toUrl("edit/edit.html")+"#"+n}else i=document.createElement("span");return t.empty(i),i.appendChild(document.createTextNode(this._workspaceRootSegmentName)),i}return null},segments:[],buildSegment:function(e){var t=document.createElement("a");return t.classList.add("breadcrumb"),t.appendChild(document.createTextNode(e)),t},addSegmentHref:function(t,i){this._makeHref?this._makeHref(t,i.Location,i):t.href=e.toUrl("edit/edit.html")+"#"+i.ChildrenLocation},buildSegments:function(e,t){if(this.segments=[],this._resource.Parents){var i,n,o=this._resource.Parents.slice(0);if(o){var r=o.slice(0);"reverse"===t&&(r=r.reverse().slice(0)),r.forEach(function(t){t.skip||(e?(n=e,e=null):n=t.Name,i=this.buildSegment(n),this.path+=t.Name,this.addSegmentHref(i,t),this.segments.push(i))}.bind(this))}}},addDivider:function(){var e=document.createElement("span");e.appendChild(document.createTextNode(" / ")),this.path+="/",e.classList.add("breadcrumbSeparator"),this.append(e)},refresh:function(){this.crumbs=t.node(this._id),this.crumbs?t.empty(this.crumbs):(this.crumbs=document.createElement("span"),this.crumbs.id=this._id,this._container.appendChild(this.crumbs),this.dirty=document.createElement("span"),this.dirty.id="dirty",this.dirty.className="modifiedFileMarker"),this.crumbs.classList.add("breadcrumbContainer"),this.crumbs.style.visibility="visible",this.crumbs.parentNode.className="currentLocation",this.crumbs.parentNode.style.width="100%"},append:function(e){this.crumbs.appendChild(e)},addTitle:function(e,t){var i=t||document.title;0===this.crumbs.childNodes.length&&(e=document.createElement("span"),e.appendChild(document.createTextNode(i)),e.classList.add("breadcrumb"),e.classList.add("currentLocation"),this._finalSegment=e,this.append(e))},finalSegment:function(e,t){if(!this._resource.skip){var i;i=t?t:this._resource.Name,this._makeFinalHref?(e=this.buildSegment(i),this.addSegmentHref(e,this._resource)):(e=document.createElement("span"),e.appendChild(document.createTextNode(i))),e.classList.add("currentLocation"),this.path+=this._resource.Name,this.append(e),this._finalSegment=e,this._finalSegment.style.flexShrink="0",void 0!==this._finalSegment.style.webkitFlexShrink&&(this._finalSegment.style.webkitFlexShrink="0");for(var n=this.crumbs.childNodes,o=0;o<n.length-1;o++)if(n[o].classList.contains("breadcrumb")){var r=100*(n.length-1-o);n[o].style.flexShrink=""+r,void 0!==n[o].style.webkitFlexShrink&&(n[o].style.webkitFlexShrink=""+r)}this.crumbs.appendChild(this.dirty)}},firstSegment:function(e){if(e){if(this.append(e),!this._resource||!this._resource.Parents||this._resource.skip)return this._resource.skip||(e.href=""),e.classList.add("currentLocation"),void(this._finalSegment=e);e.classList.add("breadcrumb"),this.addDivider()}},drawSegments:function(){if(this._resource.Parents){var e=this.segments.slice(0);e.forEach(function(e){this.append(e),this.addDivider()}.bind(this))}},fitSegments:function(){this.crumbs.parentNode?this._finalSegment&&(this._finalSegment.style.flexShrink="0",void 0!==this._finalSegment.style.webkitFlexShrink&&(this._finalSegment.style.webkitFlexShrink="0"),this.crumbs.offsetWidth<this.crumbs.scrollWidth&&(this._finalSegment.style.flexShrink="1",void 0!==this._finalSegment.style.webkitFlexShrink&&(this._finalSegment.style.webkitFlexShrink="1"))):(window.removeEventListener("resize",this._resizeListener),this._resizeListener=null)},render:function(){this.refresh();var e=this.getNavigatorWorkspaceRootSegment(),t=this._rootSegmentName;t?this.addTitle(e,t):(this.firstSegment(e),this._resource&&this._resource.Parents&&(this.buildSegments(t,"reverse"),this.drawSegments(),this.finalSegment(e,t),this.fitSegments()))},destroy:function(){this.crumbs&&(t.empty(this._container),this.crumbs=this.dirty=null),this._resizeListener&&(window.removeEventListener("resize",this._resizeListener),this._resizeListener=null)}},i.prototype.constructor=i,{BreadCrumbs:i}}),define("orion/webui/splitter",["orion/EventTarget","orion/util","orion/metrics","orion/webui/littlelib"],function(e,t,i,n){function o(t){e.attach(this),this._init(t)}var r=1,s=2;return o.prototype={_init:function(e){if(this.$splitter=n.node(e.node),!this.$splitter)throw"no dom node for splitter found";if(this.$leading=n.node(e.sidePanel),!this.$leading)throw"no dom node for side panel found";if(this.$trailing=n.node(e.mainPanel),!this.$trailing)throw"no dom node for main panel found";this._tracking=!1,this._animationDelay=501,this._collapseTrailing=e.closeReversely||!1,this._proportional=e.proportional||!1,this._prefix="/orion/splitter/"+(this.$splitter.id||document.body.id||""),e.toggle&&(this._thumb=document.createElement("div"),this.$splitter.appendChild(this._thumb),this._thumb.classList.add("splitThumb"),this._thumb.classList.add(this._vertical?this._collapseTrailing?"splitVerticalThumbDownLayout":"splitVerticalThumbUpLayout":"rtl"==document.dir?this._collapseTrailing?"splitThumbLeftLayout":"splitThumbRightLayout":this._collapseTrailing?"splitThumbRightLayout":"splitThumbLeftLayout")),this.$splitter.classList.add("split");var i=localStorage.getItem(this._prefix+"/orientation");if(i)var o="vertical"===i?s:r;else o=e.vertical?s:r;this.setOrientation(o),t.isIOS||t.isAndroid?(this.$splitter.addEventListener("touchstart",this._touchStart.bind(this),!1),this._thumb&&this._thumb.addEventListener("touchstart",this._touchStart.bind(this),!1),this.$splitter.addEventListener("touchmove",this._touchMove.bind(this),!1),this.$splitter.addEventListener("touchend",this._touchEnd.bind(this),!1)):(this.$splitter.addEventListener("mousedown",this._mouseDown.bind(this),!1),window.addEventListener("mouseup",this._mouseUp.bind(this),!1)),window.addEventListener("resize",this._resize.bind(this),!1)},isClosed:function(){return this._closed},getOrientation:function(){return this._vertical?s:r},setOrientation:function(e,t){var i=e===s;if(i!==this._vertical||t){this._vertical=i;var n=this._vertical?"vertical":"horizontal";if(localStorage.setItem(this._prefix+"/orientation",n),this.$splitter.style.position="absolute",this.$trailing.style.position="absolute",this.$leading.style.position="absolute",this._offsetStorageLabel="/offset",this._vertical&&!this._proportional&&(this._offsetStorageLabel="/offsetY"),this._vertical?(this.$splitter.classList.remove("splitLayout"),this.$splitter.classList.add("splitVerticalLayout"),this._topLeft="top",this._bottomRight="bottom",this._widthHeight="height"):(this.$splitter.classList.remove("splitVerticalLayout"),this.$splitter.classList.add("splitLayout"),this._topLeft="left",this._bottomRight="right",this._widthHeight="width"),this._initializeFromStoredSettings(),this._setStyleConstants(),this._collapseTrailing?(this.$splitter.style[this._topLeft]="auto",this.$leading.style[this._topLeft]="0px",this.$leading.style[this._widthHeight]="auto",this.$trailing.style[this._topLeft]="auto",this.$trailing.style[this._bottomRight]="0px"):("rtl"==document.dir?(this.$splitter.style[this._topLeft]="auto",this.$leading.style[this._topLeft]="auto",this.$leading.style[this._bottomRight]="0px",this.$trailing.style[this._topLeft]="0px"):(this.$splitter.style[this._bottomRight]="auto",this.$leading.style[this._topLeft]="0px",this.$leading.style[this._bottomRight]="auto"),this.$trailing.style[this._widthHeight]="auto",this.$trailing.style[this._bottomRight]="0px"),this._thumb){var o=this._thumb.classList;this._vertical?(o.remove(this._collapseTrailing?"splitThumbRightLayout":"splitThumbLeftLayout"),o.add(this._collapseTrailing?"splitVerticalThumbDownLayout":"splitVerticalThumbUpLayout")):(o.remove(this._collapseTrailing?"splitVerticalThumbDownLayout":"splitVerticalThumbUpLayout"),o.add("rtl"==document.dir?this._collapseTrailing?"splitThumbLeftLayout":"splitThumbRightLayout":this._collapseTrailing?"splitThumbRightLayout":"splitThumbLeftLayout"))}this._closed?(this._closed=!1,this._thumbDown(!0,!0)):this._adjustToOffset(),this._resize(),this.$splitter.style.visibility="visible",this.$trailing.style.display="block",this.$leading.style.display="block"}},resize:function(){this._resize()},_setStyleConstants:function(){this._vertical?(this.$splitter.style.left="",this.$splitter.style.right="",this.$leading.style.left="auto",this.$leading.style.right="auto",this.$leading.style.width="100%",this.$trailing.style.left="auto",this.$trailing.style.right="auto",this.$trailing.style.width="100%"):(this.$splitter.style.top="",this.$splitter.style.bottom="",this.$leading.style.top="auto",this.$leading.style.bottom="auto",this.$leading.style.height="100%",this.$trailing.style.top="auto",this.$trailing.style.bottom="auto",this.$trailing.style.height="100%")},toggleSidePanel:function(){this._thumbDown()},openSidePanel:function(){this._closed||this._thumbDown()},addResizeListener:function(e){this.addEventListener("resize",function(t){e(t.node)})},_initializeFromStoredSettings:function(){var e=localStorage.getItem(this._prefix+"/toggleState");this._closed="string"==typeof e?"closed"===e:this._closeByDefault,this._adjustSplitterSize();var t=localStorage.getItem(this._prefix+this._offsetStorageLabel);if(t)this._offset=parseInt(t,10),this._proportional&&(this._offset=Math.max(0,Math.min(100-this._splitterSize,this._offset)));else{var i=n.bounds(this.$splitter);this._offset=this._adjustOffset(i[this._topLeft])}},_adjustSplitterSize:function(){var e=n.bounds(this.$splitter);if(this._splitterSize=e[this._widthHeight],this._proportional){var t=n.bounds(this.$splitter.parentNode);this._splitterSize=this._splitterSize/(t[this._widthHeight]/100)}},_adjustOffset:function(e){var t=n.bounds(this.$splitter.parentNode);if(this._collapseTrailing){var i=e+this._splitterSize;e=t[this._widthHeight]-(i-t[this._topLeft])}else if("rtl"==document.dir){var i=e+this._splitterSize;e=t[this._widthHeight]-(i-t[this._topLeft])}else e-=t[this._topLeft];return this._proportional&&(e/=t[this._widthHeight]/100),e},_adjustToOffset:function(){this._offset<0&&(this._offset=0);var e=this._proportional?"%":"px";this._collapseTrailing?(this.$splitter.style[this._bottomRight]=this._offset+e,this.$leading.style[this._bottomRight]=this._offset+this._splitterSize+e,this.$trailing.style[this._widthHeight]=this._offset+e,this.$trailing.style.visibility=0===this._offset?"hidden":"visible"):("rtl"==document.dir?(this.$splitter.style[this._bottomRight]=this._offset+e,this.$leading.style[this._widthHeight]=this._offset+e,this.$trailing.style[this._bottomRight]=this._offset+this._splitterSize+e):(this.$splitter.style[this._topLeft]=this._offset+e,this.$leading.style[this._widthHeight]=this._offset+e,this.$trailing.style[this._topLeft]=this._offset+this._splitterSize+e),this.$leading.style.visibility=0===this._offset?"hidden":"visible")},_resize:function(){"none"!==this.$splitter.style.display&&(this._proportional&&(this._adjustSplitterSize(),this._adjustToOffset()),this._notifyResizeListeners(this.$trailing),this._notifyResizeListeners(this.$leading))},_notifyResizeListeners:function(e){this.dispatchEvent({type:"resize",node:e})},_notifyToggleListeners:function(){this.dispatchEvent({type:"toggle",closed:this._closed})},_thumbDown:function(e,t){if(e||this._addAnimation(),this._closed){var n=localStorage.getItem(this._prefix+this._offsetStorageLabel);this._offset=n?parseInt(n,10):350,this._closed=!1}else localStorage.setItem(this._prefix+this._offsetStorageLabel,this._offset),this._offset=0,this._closed=!0;this._adjustToOffset(),e||this._removeAnimation(),t||(localStorage.setItem(this._prefix+"/toggleState",this._closed?"closed":null),i.logEvent("preferenceChange","splitterClosed",this._prefix,this._closed?0:1))},_removeAnimation:function(){var e=this;window.setTimeout(function(){e.$leading.classList.remove("generalAnimation"),e.$trailing.classList.remove("generalAnimation"),e.$splitter.classList.remove("generalAnimation"),e._resize()},this._animationDelay)},_addAnimation:function(){this.$leading.classList.add("generalAnimation"),this.$trailing.classList.add("generalAnimation"),this.$splitter.classList.add("generalAnimation")},_down:function(){this.$splitter.classList.add("splitTracking"),this.$trailing.classList.add("panelTracking"),this.$leading.classList.add("panelTracking")},_move:function(e,t){var i=this._vertical?t:e,o=n.bounds(this.$splitter),r=o[this._widthHeight]/2;this._offset=this._adjustOffset(this._collapseTrailing?i+r:i-r),this._adjustToOffset(),this._notifyResizeListeners(this.$trailing),this._notifyResizeListeners(this.$leading)},_up:function(){this.$splitter.classList.remove("splitTracking"),this.$trailing.classList.remove("panelTracking"),this.$leading.classList.remove("panelTracking");var e=this._closed;this._offset>0?(localStorage.setItem(this._prefix+this._offsetStorageLabel,this._offset),this._closed=!1):this._closed=!0,e!==this._closed&&(localStorage.setItem(this._prefix+"/toggleState",this._closed?"closed":null),i.logEvent("preferenceChange","splitterClosed",this._prefix,this._closed?0:1))},_mouseDown:function(e){return e.target===this._thumb?(n.stop(e),this._thumbDown()):void(this._tracking||(this._down(e),this._tracking=this._mouseMove.bind(this),window.addEventListener("mousemove",this._tracking),n.setFramesEnabled(!1),n.stop(e)))},_mouseMove:function(e){this._tracking&&(this._move(e.clientX,e.clientY),this._resize())},_mouseUp:function(e){this._tracking&&(n.setFramesEnabled(!0),window.removeEventListener("mousemove",this._tracking),this._tracking=null,this._up(),n.stop(e))},_touchStart:function(e){var t=e.touches;if(1===t.length){if(n.stop(e),e.target===this._thumb)return this._thumbDown();this._down(e),this._touching=!0}},_touchMove:function(e){if(this._touching){var t=e.touches;if(1===t.length){var i=t[0];this._move(i.clientX,i.clientY)}}},_touchEnd:function(e){var t=e.touches;0===t.length&&(this._touching=!1,this._up())}},o.prototype.constructor=o,{Splitter:o,ORIENTATION_HORIZONTAL:r,ORIENTATION_VERTICAL:s}}),define("orion/keyAssist",["i18n!orion/nls/messages","orion/webui/littlelib","orion/keyBinding","orion/metrics","orion/uiUtils","orion/util"],function(e,t,i,n,o,r){function s(e){this.commandRegistry=e.commandRegistry,this.create(),this._filterString="",this._providers=[]}return s.prototype={addProvider:function(e){-1===this._providers.indexOf(e)&&this._providers.push(e)},create:function(){var i=this._keyAssistDiv=document.createElement("div");i.id="keyAssist",i.style.display="none",i.classList.add("keyAssistFloat"),i.setAttribute("role","menu");var n=this._keyAssistInput=document.createElement("input");n.classList.add("keyAssistInput"),n.type="text",n.placeholder=e["Filter bindings"],n.setAttribute("aria-autocomplete","list"),i.appendChild(n);var o=this._keyAssistContents=document.createElement("div");o.classList.add("keyAssistContents"),(r.isIOS||r.isAndroid)&&(o.style.overflowY="auto"),i.appendChild(o);var s=this._keyAssistTable=document.createElement("table");s.tabIndex=0,s.classList.add("keyAssistList"),o.appendChild(s),document.body.appendChild(i),n.addEventListener("keydown",function(e){this._keyDown(e)}.bind(this)),s.addEventListener("keydown",function(e){this._keyDown(e)}.bind(this)),n.addEventListener("input",function(){this.filterChanged()}.bind(this)),o.addEventListener(r.isFirefox?"DOMMouseScroll":"mousewheel",function(e){this._scrollWheel(e)}.bind(this)),document.addEventListener("keydown",function(e){e.keyCode===t.KEY.ESCAPE&&this.hide()}.bind(this)),t.addAutoDismiss([i],function(){this.hide()}.bind(this)),this.commandRegistry&&this.commandRegistry.addEventListener("bindingChanged",function(e){this.handleBindingChange(e)}.bind(this))},handleBindingChange:function(e){if(this.isVisible())for(var t,i=this._keyAssistTable.querySelectorAll(".keyAssistItem"),n=0;n<i.length;n++){var t=i[n];if(t.cmdID===e.id&&JSON.stringify(e.prevBinding)===JSON.stringify(t.curBinding)){var r=e.newBinding?o.getUserKeyString(e.newBinding):"---";t.childNodes[2].firstChild.textContent=r,t.curBinding=e.newBinding}}},createContents:function(){var i=this._keyAssistTable;t.empty(i),this._selectedIndex=-1,this._selectedRow=null,this._keyAssistContents.scrollTop=0,this._idCount=0;for(var n=0;n<this._providers.length;n++)this._providers[n].showKeyBindings(this);this.createHeader(e.Global),this.commandRegistry.showKeyBindings(this)},createItem:function(i,n,r,s){var a=i?o.getUserKeyString(i):e.NoBinding;if(this._filterString){var l,c=this._filterString.toLowerCase();if(c!==this._filterString?(c=this._filterString,l=function(e){return e}):l=function(e){return e.toLowerCase()},-1===l(n).indexOf(c)&&-1===l(a).indexOf(c)&&-1===l(this._lastHeader).indexOf(c))return}var d=this._keyAssistTable.insertRow(-1);d.id="keyAssist-keyBinding-"+this._idCount++,d.setAttribute("role","menuitem"),d.cmdID=r,d._execute=s,d.curBinding=i,d.classList.add("keyAssistItem"),d.addEventListener("click",function(e){this._selectedRow=d,this.execute(),e.preventDefault()}.bind(this));var h=d.insertCell(-1);h.classList.add("keyAssistSpacer"),h.appendChild(document.createElement("div"));var h=d.insertCell(-1);h.classList.add("keyAssistName"),h.appendChild(document.createTextNode(n)),h=d.insertCell(-1),h.classList.add("keyAssistAccel");var u=document.createElement("span");u.textContent=a,h.appendChild(u),h=d.insertCell(-1),h.classList.add("keyAssistActions");var p=document.createElement("button");p.classList.add("keyAssistEditButton"),p.classList.add("core-sprite-edit"),p.setAttribute("aria-label",e.Edit),p.addEventListener("click",function(e){t.stop(e),this.editBinding(d)}.bind(this)),h.appendChild(p)},editBinding:function(r){var s=function(e){this._keyCode=e.keyCode,this._altDown=e.altKey,this._ctrlDown=e.ctrlKey,this._shiftDown=e.shiftKey,this._commandDown=e.metaKey;var t=new i.KeyStroke(this._keyCode,e.ctrlKey,e.shiftKey,e.altKey,e.metaKey),n=o.getUserKeyString(t);this.keyAssistKBEdit.value=n}.bind(this),a=function(){this.keyAssistKBEdit.value="",this.bindingField.removeChild(this.keyAssistKBEdit),this.bindingField.firstChild.style.display="block",delete this.keyAssistKBEdit,delete this.bindingField,delete this._keyCode,this._editingABinding=!1}.bind(this);this._editingABinding&&a();for(var l=this._keyAssistTable.querySelectorAll(".keyAssistItem"),c=0;c<l.length;c++)if(l[c]===r){this.selectRow(c,l);break}var d=this.keyAssistKBEdit=document.createElement("input");d.id="keyAssistInput",d.type="text",d.placeholder=e.BindingPrompt,d.classList.add("keyAssistBindingInput"),d.addEventListener("click",function(e){e.stopPropagation()}.bind(this)),d.addEventListener("keydown",function(e){if(e.keyCode===t.KEY.ALT||e.keyCode===t.KEY.SHIFT||e.keyCode===t.KEY.CONTROL||e.keyCode===t.KEY.COMMAND);else if(e.keyCode===t.KEY.ENTER){if(this._keyCode&&this._keyCode&&(this._altDown||this._ctrlDown||this._shiftDown||this._commandDown)){var o=new i.KeyStroke(this._keyCode,this._ctrlDown,this._shiftDown,this._altDown,this._commandDown);this.commandRegistry.createBindingOverride(r.cmdID,o,r.curBinding),n.logEvent("KeyBinding","Changed",r.cmdID,JSON.stringify(o)),a(),this._keyAssistTable.focus()}}else e.keyCode===t.KEY.ESCAPE?(a(),this._keyAssistInput.focus()):s(e);t.stop(e)}.bind(this));var h=this.bindingField=r.childNodes[2];h.firstChild.style.display="none";var u=t.pixelValueOf(h,"padding-left"),p=t.pixelValueOf(h,"padding-right"),f=t.pixelValueOf(h,"border-left"),g=t.pixelValueOf(h,"border-right"),m=t.bounds(h),v=m.width-(u+p+f+g);v=135>v?135:v,d.style.width=v+"px",h.appendChild(d),d.focus(),this._editingABinding=!0},createHeader:function(e){this._lastHeader=e;var t=this._keyAssistTable.insertRow(-1);t.classList.add("keyAssistSection");var i=t.insertCell(-1);i.colSpan=4;var n=document.createElement("h2");n.appendChild(document.createTextNode(e)),i.appendChild(n)},execute:function(){window.setTimeout(function(){this.hide();var e=this._selectedRow;this._selectedRow=null,e&&e._execute&&e._execute()}.bind(this),0)},filterChanged:function(){this._timeout&&window.clearTimeout(this._timeout),this._timeout=window.setTimeout(function(){this._timeout=null;var e=this._keyAssistInput.value;this._filterString!==e&&(this._filterString=e,this.createContents())}.bind(this),100)},hide:function(){if(this.isVisible()){var e=document.activeElement,t=this._keyAssistDiv,i=t===e||0!==(16&t.compareDocumentPosition(e));t.style.display="none",i&&1!==document.compareDocumentPosition(this._previousActiveElement)&&this._previousActiveElement.focus(),this._previousActiveElement=null}},isVisible:function(){return"block"===this._keyAssistDiv.style.display},removeProvider:function(e){var t=this._providers.indexOf(e);-1!==t&&this._providers.splice(t,1)},select:function(e){var t=this._keyAssistTable.querySelectorAll(".keyAssistItem");if(0===t.length)return void(this._selectedIndex=-1);var i=this._selectedIndex;i+=e?1:-1,i%=t.length,0>i&&(i=t.length-1),this.selectRow(i,t)},selectRow:function(e,t){if(-1!==this._selectedIndex&&(i=t[this._selectedIndex],i.classList.remove("selected"),i.childNodes[3].firstChild.classList.remove("keyAssistEditButtonVisible"),this._selectedRow=null),e>=0&&e<t.length){this._selectedIndex=e,this._selectedRow=t[this._selectedIndex];var i=this._selectedRow;i.classList.add("selected"),i.childNodes[3].firstChild.classList.add("keyAssistEditButtonVisible"),this._keyAssistTable.setAttribute("aria-activedescendant",i.id),this._keyAssistTable.focus();var n=i.getBoundingClientRect(),o=this._keyAssistContents,r=o.getBoundingClientRect();i.offsetTop<o.scrollTop?0===this._selectedIndex?o.scrollTop=0:i.scrollIntoView(!0):n.bottom>r.bottom&&i.scrollIntoView(!1)}},show:function(){this.isVisible()||(this._previousActiveElement=document.activeElement,this.createContents(),this._keyAssistContents.style.height=Math.floor(.75*this._keyAssistDiv.parentNode.clientHeight)+"px",this._keyAssistDiv.style.display="block",this._keyAssistInput.value=this._filterString,this._keyAssistInput.focus(),this._keyAssistInput.select(),n.logEvent("KeyBinding","Panel","Opened"))},_keyDown:function(e){if(40===e.keyCode)this.select(!0);else if(38===e.keyCode)this.select(!1);else if(13===e.keyCode)this.execute();else{if(e.keyCode!==t.KEY.SPACE)return;this._editingABinding||this.editBinding(this._selectedRow)}e.preventDefault()},_scrollWheel:function(e){var t=0;t=r.isIE||r.isOpera?-e.wheelDelta:r.isFirefox?40*e.detail:-e.wheelDeltaY;var i=this._keyAssistContents,n=i.scrollTop;return i.scrollTop+=t,n!==i.scrollTop?(e.preventDefault&&e.preventDefault(),!1):void 0}},{KeyAssistPanel:s}}),define("orion/widgets/themes/ThemePreferences",[],function(){function e(e,t){this._preferences=e,this._themeData=t;var i=t.getThemeStorageInfo();this._themeVersion=i.version;var n=this;e.addEventListener("changed",function(e){e.namespace===i.storage&&n.apply()})}return e.prototype={_initialize:function(e,t,i){var n,o,r=e.styleset+"Version",s=i[r],a=0;try{s=parseFloat(s),a=parseFloat(this._themeVersion)}catch(l){}s===a||s>a?(n=i[e.styleset],o=i.selected,o&&(o=this._parse(o)),this._themeVersion=s):(n=null,o=null),n||(n=t.getStyles(),i[e.styleset]=JSON.stringify(n)),o&&void 0!==o[e.selectedKey]||(o=o||{},o[e.selectedKey]=e.defaultTheme,i.selected=JSON.stringify(o)),i[r]=this._themeVersion},_convertThemeStylesToHierarchicalFormat:function(e){return{name:e.name,className:e.name,styles:{backgroundColor:e.background,color:e.text,fontFamily:e.fontFamily,fontSize:e.fontSize,textviewRightRuler:{borderLeft:"1px solid "+e.annotationRuler},textviewLeftRuler:{borderRight:"1px solid "+e.annotationRuler},split:{background:e.background},ruler:{backgroundColor:e.annotationRuler,overview:{backgroundColor:e.overviewRuler}},rulerLines:{even:{color:e.lineNumberEven},odd:{color:e.lineNumberOdd}},annotationLine:{currentLine:{backgroundColor:e.currentLine}},comment:{color:e.comment},constant:{color:"blue"},entity:{name:{color:"#98937B","function":{fontWeight:"bold",color:"#67BBB8"}},other:{"attribute-name":{color:e.attribute}}},keyword:{control:{color:e.keyword,fontWeight:"bold"},operator:{color:e.keyword,fontWeight:"bold"},other:{documentation:{color:"#7F9FBF"}}},markup:{bold:{fontWeight:"bold"},heading:{color:"blue"},italic:{fontStyle:"italic"},list:{color:"#CC4C07"},other:{separator:{color:"#00008F"},strikethrough:{textDecoration:"line-through"},table:{color:"#3C802C"}},quote:{color:"#446FBD"},raw:{fontFamily:"monospace"},underline:{link:{textDecoration:"underline"}}},meta:{documentation:{annotation:{color:"#7F9FBF"},tag:{color:"#7F7F9F"}},tag:{color:e.tag}},string:{color:e.string},support:{type:{propertyName:{color:"#7F0055"}}},variable:{language:{color:"#7F0055",fontWeight:"bold"},other:{color:"#E038AD"},parameter:{color:"#D1416F"}}}}},apply:function(){this.setTheme()},_findStyle:function(e,t){for(var i=0;i<e.length;i++)if(e[i].name===t)return e[i];return null},_getCurrentStyle:function(e,t){var i=this._themeData,n=i.getThemeStorageInfo();return this._findStyle(e,t)||this._findStyle(e,n.defaultTheme)||e[0]},_parse:function(e){return"string"==typeof e?JSON.parse(e):e},getTheme:function(e){var t=this._themeData,i=t.getThemeStorageInfo();return this._preferences.get(i.storage).then(function(n){this._initialize(i,t,n);var o,r=this._parse(n.selected),s=this._parse(n[i.styleset]);if(s){if(s.length&&s[0].keyword)for(var a=0;a<s.length;a++)s[a]=this._convertThemeStylesToHierarchicalFormat(s[a]);o=this._getCurrentStyle(s,r[i.selectedKey])}e({style:o,styles:s})}.bind(this))},setTheme:function(e,t){var i=this._themeData,n=i.getThemeStorageInfo();return this._preferences.get(n.storage).then(function(o){this._initialize(n,i,o);var r=this._parse(o.selected);e||(e=r[n.selectedKey]),r[n.selectedKey]=e,o.selected=JSON.stringify(r),t?o[n.styleset]=JSON.stringify(t):t=this._parse(o[n.styleset]),i.processSettings(this._getCurrentStyle(t,r[n.selectedKey]));var s=n.styleset+"Version";return o[s]=this._themeVersion,this._preferences.put(n.storage,o)}.bind(this))},setFontSize:function(e){var t=this._themeData,i=t.getThemeStorageInfo();return this._preferences.get(i.storage).then(function(n){this._initialize(i,t,n);var o,r=this._parse(n.selected),s=this._parse(n[i.styleset]);if(s){for(var a=0;a<s.length;a++)s[a].styles.fontSize=e;o=this._getCurrentStyle(s,r[i.selectedKey])}return n[i.styleset]=JSON.stringify(s),t.processSettings(o),this._preferences.put(i.storage,n)}.bind(this))}},{ThemePreferences:e}}),define("orion/settings/nls/messages",{root:!0,de:!0,es:!0,fr:!0,it:!0,ja:!0,ko:!0,"pt-br":!0,zh:!0,"zh-hk":!0,"zh-tw":!0}),define("orion/settings/nls/root/messages",{Globalization:"Globalization","Enable bidi support":"Enable bidi support","Base text direction":"Base text direction","Calendar type":"Calendar type","Left-To-Right":"Left-To-Right","Right-To-Left":"Right-To-Left","Auto direction":"Auto direction",Gregorian:"Gregorian",Hebrew:"Hebrew","Plugin Description":"Plug-in Description",Create:"Create","Loading...":"Loading...","Label:":"Label:",Title:"Title",Plugins:"Plug-ins","User Profile":"User Profile",Git:"Git","Git Settings":"Git Settings",JavascriptAssist:"Tern",Theme:"Editor Styles","Editor Theme":"Editor Styles:","Theme Settings":"Theme Settings",General:"General",Navigation:"Navigation",Font:"Font",Family:"Family","Sans Serif":"Sans Serif",Serif:"Serif",Size:"Size","8pt":"8pt","9pt":"9pt","10pt":"10pt","12pt":"12pt",Color:"Color",Background:"Background",blue:"blue",Weight:"Weight",Normal:"Normal",Bold:"Bold",green:"green",darkred:"darkred",Categories:"Categories","User Name":"User Name:","Full Name":"Full Name:","Email Address":"Email Address:","Email Confirmed":"Email Confirmed:",Account:"Account","Current Password":"Current Password:","New Password":"New Password:","Verify Password":"Verify Password:","UserSettings.PasswordsDoNotMatch":"New password, and retyped password do not match","UserSettings.TypeCurrentPassword":"You must type your current password in order to set a new one","UserSettings.InvalidPasswordLength":"Password must be at least 8 characters long","UserSettings.InvalidPasswordAlpha":"Password must contain at least one alpha character and one non alpha character","UserSettings.PasswordRules":"Password must be at least 8 characters long and contain at least one alpha character and one non alpha character",Password:"Password",Google:"Google",Unlink:"Unlink",Link:"Link",Unlinked:"Unlinked",Linked:"Linked","Linked Accounts":"Linked Accounts","Git Email Address":"Git Email Address:","Git Username":"Git Username:","Git Credentials Storage":"Git Credentials Storage",Update:"Update","Update Profile Settings":"Update Profile Settings","Update Git User Settings":"Update Git User Settings","Update Git Credentials":"Update Git Credentials",UsrProfileUpdateSuccess:"User profile data successfully updated.",GitUsrUpdateSuccess:"Git user data successfully updated.",GitCredsUpdateSuccess:"Git Credentials successfully updated.","Install Plugin":"Install Plug-in","Plugin Name:":"Plug-in Name:","Author Name:":"Author Name:","Licence:":"Licence:","Description:":"Description:",OrionPlugin:"A plug-in for Orion","Plugin Link":"Plug-in Link",Install:"Install",PlugInstallByURL:"Install a plug-in by specifying its URL","Plugin URL:":"Plug-in URL:",Disable:"Disable",Disabled:"Disabled ${0}",DisableTooltip:"Disable the plug-in",Enable:"Enable",Enabled:"Enabled ${0}",EnableTooltip:"Enable the plug-in","Reload all":"Reload all",ReloadAllPlugs:"Reload all installed plug-ins",CreatePlug:"Create a new Orion Plug-in",FindMorePlugs:"Find More Orion Plug-ins","Get Plugins":"Get Plug-ins",Reload:"Reload",ReloadPlug:"Reload the plug-in",ReloadingPlugin:"Realoading plug-in",ReloadingAllPlugins:"Realoading all plug-ins",Delete:"Delete",DeletePlugFromConfig:"Delete this plug-in from the configuration",DeleteUser:"Delete User Profile as well as workspaces and projects",DeleteUserComfirmation:"WARNING: This will permanently delete your user profile as well as all of your work!",TypePlugURL:"Type a plug-in url here ...","Already installed":"Already installed",Installed:"Installed ${0}",Installing:"Installing ${0}...",Uninstalled:"Uninstalled ${0}",UninstallCfrm:"Are you sure you want to uninstall '${0}'?",ReloadedPlug:"Reloaded ${0} plug-in.",ReloadedNPlugs:"Reloaded ${0} plug-ins.",Reloaded:"Reloaded ${0}",Services:"Services",Value:"Value","JavaScript Object":"JavaScript Object",CheckJsConsoleDrillDown:"click here, then check javascript console to drill down",Item:"Item","Git Config":"Git Config",GitWorkDir:"Git Working Directory",SelectUnstagedChanges:"Always select changed files","Clear Git Credentials":"Clear Git Credentials","Enable Storage":"Enable Storage:",BrowserCredStoreMsg:"Please be aware that your credentials will be stored persistently in the browser.",AskEnableKeyStorage:"Do you wish to enable the Key Storage?",general:"General",validation:"Validation",DeletedGitMsg:"Deleted git credentials for ${0}",Editor:"Editor Settings",editorSettings:"Editor Settings",EditorThemes:"Editor Styles",defaultImportedThemeName:"New Theme",nameImportedTheme:"Please enter a name for this new theme:",dndTheme:"Drag and drop here...",textTheme:"...or paste editor styles here",Import:"Import","Import a theme":"Import a theme",ImportThemeDialogMessage:"You can import a previously exported Orion theme here. If you would like to import a Sublime Text, Brackets or an Eclipse theme, please see this <a href='https://wiki.eclipse.org/Orion/How_Tos/Import_Theme' target='_blank' tabindex='-1'>page</a>.",ImportThemeError:"Ooops! The imported content does not appear to be a valid theme definition.",Export:"Export","Export a theme":"Export a theme","Theme name:":"Theme name:",yourTheme:"yourTheme",fileManagement:"File Management",typing:"Typing",autoSave:"Auto Save:",autoSaveTimeout:"Save interval (ms):",autoLoad:"Auto Load:",saveDiffs:"Save file as diffs:",trimTrailingWhiteSpace:"Trim Trailing Whitespace on Save:",Restore:"Restore Defaults",Default:"Default",keys:"Keys",tabs:"Tabs",tabSize:"Tab Size:",expandTab:"Insert spaces for tabs:",smoothScrolling:"Smooth Scrolling",scrollAnimation:"Scrolling Animation:",scrollAnimationTimeout:"Scrolling Duration (ms):",keyBindings:"Key Bindings:",rulers:"Rulers",annotationRuler:"Show Annotation Ruler:",lineNumberRuler:"Show Line Number Ruler:",foldingRuler:"Show Folding Ruler:",overviewRuler:"Show Overview Ruler:",zoomRuler:"Show Code Map Ruler:",whitespaces:"White Spaces",wrapping:"Wrapping",wordWrap:"Word Wrap:",showMargin:"Show Margin:",marginOffset:"Margin Column:",showWhitespaces:"Show Whitespace Characters:",autoSaveTimeoutInvalid:"Invalid save interval.",scrollAnimationTimeoutInvalid:"Invalid scrolling duration.",tabSizeInvalid:"Invalid tab size.",localSettingsTooltip:"Toggle whether this setting is shown in the local editor settings drop down.",editorSettingsInfo:"Use the ${0} and ${1} to toggle whether a given setting is shown in the local editor settings drop down ${2}.",autoPairParentheses:"Autopair (Parentheses):",autoPairBraces:"Autopair {Braces}:",autoPairSquareBrackets:"Autopair [Square] Brackets:",autoPairAngleBrackets:"Autopair <Angle> Brackets:",autoPairQuotations:'Autopair "Strings":',autoCompleteComments:"Autocomplete /** Block Comments */:",smartIndentation:"Smart Indentation:",sourceControl:"Source Control",showBlame:"Show Blame",languageTools:"Language Tools",showOccurrences:"Show Occurrences:",contentAssistAutoTrigger:"Show Content Assist automatically:","Editor preferences updated":"Editor preferences updated","Editor defaults restored":"Editor defaults restored","Font Size":"Font Size:","New Theme Name:":"New Theme Name:","Font Size:":"Font Size:","Navigation Bar":"Navigation Bar","Navigation Text":"Navigation Text","Search Box":"Search Box","Tool Panel":"Tool Panel","Selection Bar":"Selection Bar",Location:"Location",Content:"Content","Main Panel":"Main Panel",Button:"Button","Button Text":"Button Text","Section Text":"Section Text","Side Panel":"Side Panel","Line Color":"Line Color",Parameters:"Parameters",Foreground:"Foreground",Tags:"Tags","Annotation Ruler":"Annotation Ruler","Show Guide":"Show Guide","Check Guide":"Check Guide",Cancel:"Cancel","Save Theme":"Save Theme","Delete Theme":"Delete Theme","Revert Theme":"Revert Theme","Update Theme":"Update Theme",clickDiagram:"Select a theme, or click elements in the diagram to style them individually.","Property Names":"Property Names",HexNumber:"Numbers (Hex)",DecimalNumbers:"Numbers (Decimal)","CSS Text":"CSS Text","COLOR:":"Color:","NEW COLOR:":"New Color:",Ok:"Ok","OR HEX:":"Or Hex: ",pluginStatusNotLoaded:"This plug-in is not loaded.",pluginStatusNotRunning:"This plug-in is disabled.",pluginStatusBroken:"This plug-in could not be loaded.",Website:"Website",License:"License",Login:"Login","clearThemeAndEditorSettings.name":"Clear themes and editor settings","clearThemeAndEditorSettings.tooltip":"Clear all settings associated with editor themes and window themes",Settings:"Settings",SettingUpdateSuccess:"${0} settings successfully updated.",buttonSave:"Save",buttonRevert:" Revert",ConfirmRestore:"Restore these settings to their default values?","Theme: ":"Theme: ","Display Language: ":"Display Language: ",cannotDeleteMsg:" is a default theme that cannot be deleted",confirmDeleteMsg:"Are you sure you want to delete this theme?",cannotModifyMsg:"${0} is a default theme that cannot be modified. Please use another name.",settingsRestored:"Settings restored.","editorTheme font size":"Font size","editorTheme background":"Background","editorTheme font color":"Font color","editorTheme ruler background":"Ruler background","editorTheme ruler color":"Ruler color","editorTheme ruler border color":"Ruler border color","editorTheme current line background":"Current line background","editorTheme comment":"Comment","editorTheme language variable":"Language variable","editorTheme language constant":"Language constant","editorTheme number":"Number","editorTheme string":"String","editorTheme entity":"Entity","editorTheme keyword (control)":"Keyword (control)","editorTheme keyword (operator)":"Keyword (operator)","editorTheme function parameter":"Function parameter","editorTheme comparison and logical operators":"Comparison and logical operators","editorTheme write occurrence background":"Write occurrence background","editorTheme matching bracket background":"Matching bracket background","editorTheme matching search background":"Matching search background","editorTheme current search background":"Current search background","editorTheme documentation task color":"Documentation task color","editorTheme property name color":"Property name color","editorTheme tag":"Tag","editorTheme tag attribute":"Tag attribute","editorTheme selection background":"Selection background",customizeTheme:"Custom Style...",moreEditorSettings:"Editor Settings..."}),define("orion/editor/eventTarget",[],function(){function e(){}return e.addMixin=function(t){var i=e.prototype;
for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])},e.prototype={addEventListener:function(e,t,i){this._eventTypes||(this._eventTypes={});var n=this._eventTypes[e];n||(n=this._eventTypes[e]={level:0,listeners:[]});var o=n.listeners;o.push({listener:t,useCapture:i})},dispatchEvent:function(e){var t=e.type;this._dispatchEvent("pre"+t,e),this._dispatchEvent(t,e),this._dispatchEvent("post"+t,e)},_dispatchEvent:function(e,t){var i=this._eventTypes?this._eventTypes[e]:null;if(i){var n=i.listeners;try{if(i.level++,n)for(var o=0,r=n.length;r>o;o++)if(n[o]){var s=n[o].listener;"function"==typeof s?s.call(this,t):s.handleEvent&&"function"==typeof s.handleEvent&&s.handleEvent(t)}}finally{if(i.level--,i.compact&&0===i.level){for(var a=n.length-1;a>=0;a--)n[a]||n.splice(a,1);0===n.length&&delete this._eventTypes[e],i.compact=!1}}}},isListening:function(e){return this._eventTypes?void 0!==this._eventTypes[e]:!1},removeEventListener:function(e,t,i){if(this._eventTypes){var n=this._eventTypes[e];if(n){for(var o=n.listeners,r=0,s=o.length;s>r;r++){var a=o[r];if(a&&a.listener===t&&a.useCapture===i){0!==n.level?(o[r]=null,n.compact=!0):o.splice(r,1);break}}0===o.length&&delete this._eventTypes[e]}}}},{EventTarget:e}}),define("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(e,t,i){function n(e){e=e||{},this._document=e.document||document}var o="orion-theme-",r={};return n.getTheme=function(e){e=e||"default";var t=r[e];return t||(t=r[e]=new n),t},n.prototype={getThemeClass:function(){return this._themeClass},setThemeClass:function(e,t){var i=this,n=i._themeClass;i._themeClass=e,this._load(e,t,function(){i.onThemeChanged({type:"ThemeChanged",oldValue:n,newValue:i.getThemeClass()})})},onThemeChanged:function(e){return this.dispatchEvent(e)},buildStyleSheet:function(e,t){var i=function(e){return e.replace(this._capitalRegEx,function(e){return"-"+e}.bind(this)).toLowerCase()}.bind(this),n=function(e,t,o,r,s){var a=[],l=Object.keys(e);l.forEach(function(l){var c=e[l];"string"==typeof c?a.push("	"+i(l)+": "+c+";"):n(c,o===l?t:t+(r?" .":".")+l,o,!1,s)}),a.length&&(s.push(t+(r?".textview":"")+" {"),s.push.apply(s,a),s.push("}"))},o=[""];return n(t.styles,"."+e,t.className,!0,o),o.join("\n")},_createStyle:function(e,t,n,r){var s=this._document,a=o+e,l=s.getElementById(a);if(l){if(r||l.firstChild.data===t)return;l.removeChild(l.firstChild),l.appendChild(s.createTextNode(t))}else{r?(l=i.createElement(s,"link"),l.rel="stylesheet",l.type="text/css",l.href=t,l.addEventListener("load",function(){n()})):(l=i.createElement(s,"style"),l.appendChild(s.createTextNode(t))),l.id=a;var c=s.getElementsByTagName("head")[0]||s.documentElement;c.appendChild(l)}r||n()},_load:function(t,i,n){if(!t)return void n();if("string"==typeof i)return void this._createStyle(t,i,n);var o=i.href,r=".css";if(o.substring(o.length-r.length)!==r&&(o+=r),/^\//.test(o)||/[a-zA-Z0-9]+:\/\//i.test(o)||!e.toUrl)this._createStyle(t,o,n,!0);else{var s=this;e(["text!"+o],function(e){s._createStyle(t,e,n,!1)})}},_capitalRegEx:/[A-Z]/g},t.EventTarget.addMixin(n.prototype),{TextTheme:n}}),define("orion/widgets/themes/ThemeClass",[],function(){function e(e){this.attributes=[],this.element=document.createElement("div"),this.style=this.element.style,this.className=e,this.classString="."+e+"{ "}function t(){return this.classString=this.classString+this.style.cssText+this.closeString,this.classString}var i,n,o=null,r=" }\n";return e.prototype.className=o,e.prototype.classString=n,e.prototype.style=i,e.prototype.closeString=r,e.prototype.toString=t,{ThemeClass:e}}),define("orion/widgets/themes/container/ThemeSheetWriter",["orion/widgets/themes/ThemeClass"],function(e){function t(){}function i(){var t="",i=[],n=new e.ThemeClass("orionPage");n.style.backgroundColor="#fdfdfd",n.style.width="100%",n.style.height="100%",i.push(n);var o=new e.ThemeClass("a");o.style.textDecoration="none",o.style.color=this.content,i.push(o);var r=new e.ThemeClass("navlink");r.style.display="inline-block",r.style.padding="2px",r.style.color=this.content,r.style.verticalAlign="bottom",i.push(r);var s=new e.ThemeClass("primaryNav");s.style.color=this.navtext,s.style.fontSize="8pt",s.style.fontWeight="normal",s.style.paddingTop="0",s.style.verticalAlign="baseline",i.push(s);var a=new e.ThemeClass("primaryNav a");a.style.fontSize="8pt",a.style.color=this.navtext,a.style.marginRight="6px",a.style.marginLeft="6px",a.style.verticalAlign="baseline",a.style.textDecoration="none",i.push(a);var l=new e.ThemeClass("primaryNav a:hover");l.style.color="#bfbfbf",l.style.cursor="hand",l.style.color="white",l.style.fontWeight="normal",i.push(l);for(var c in i)t+=i[c].toString();return t}function n(){var t="",i=[],n=new e.ThemeClass("titleArea");n.style.margin="0",n.style.paddingTop="5px",n.style.border="0",n.style.background=this.location,n.style.background="-webkit-gradient(linear, left top, left bottom, color-stop(0%,"+this.location+"), color-stop(100%,"+this.location+"))",n.style.borderBottom="1px solid "+this.location,n.style.minHeight="20px",i.push(n);var o=new e.ThemeClass("breadcrumb");o.style.fontSize="8pt",o.style.textDecoration="none",o.style.color="#f1f1f2;",o.style.paddingTop="2px",i.push(o);var r=new e.ThemeClass("a.breadcrumb:hover");r.style.textDecoration="none",r.style.borderBottom="1px dotted",r.style.color="#00AED1",r.style.cursor="pointer",i.push(r);var s=new e.ThemeClass("breadcrumbSeparator");s.style.fontSize="8pt",s.style.textDecoration="none",s.style.color=this.separator,s.style.fontWeight="bold",i.push(s);var a=new e.ThemeClass("currentLocation");a.style.fontWeight="bold",a.style.fontSize="8pt",a.style.color=this.breadcrumb,a.style.textDecoration="none",a.style.textWrap="normal",a.style.lineHeight="10pt",i.push(a);var l=new e.ThemeClass("a.currentLocation:hover");l.style.fontWeight="bold",l.style.fontSize="10pt",l.style.color="#666666",l.style.textDecoration="none",l.style.borderBottom="0",i.push(l);var c=new e.ThemeClass("navlinkonpage");if(c.style.color=this.content,c.style.verticalAlign="middle",i.push(c),this.bannerProgress){var d=new e.ThemeClass(".progressPane_running");d.style.borderColor="#F47D64",i.push(d)}for(var h in i)t+=i[h].toString();return t}function o(){var t="",i=[],n=new e.ThemeClass("commandButton");n.style.color="#666",n.style.border="1px solid #dedede",n.style.backgroundColor="#ddd",n.style.textAlign="center",n.style.verticalAlign="middle",n.style.cursor="pointer",n.style.display="inline-block",n.style.padding="4px 6px",n.style.borderRadius="3px",n.style.lineHeight="12px",n.style.fontSize="9pt",n.style.userSelect="none",i.push(n);var o=new e.ThemeClass("commandButton:over");o.style.backgroundColor="#e6e6e6",o.style.border="1px solid #808080",i.push(o);var r=new e.ThemeClass("commandMenu");r.style.color="#222",r.style.display="inline-block",r.style.verticalAlign="baseline",r.style.margin="0",r.style.fontSize="8pt",r.style.fontWeight="normal",r.style.border="1px solid #dedede",r.style.backgroundColor="#efefef",r.style.cursor="pointer",r.style.borderRadius="1px",i.push(r);var s=new e.ThemeClass("commandMenuItem");s.style.border="0",s.style.padding="0",s.style.margin="0",i.push(s);for(var a in i)t+=i[a].toString();return t}function r(){var t="",i=[],n=new e.ThemeClass("searchbox");n.style.backgroundImage="url(../images/core_sprites.png)",n.style.backgroundRepeat="no-repeat",n.style.backgroundPosition="4px -297px",n.style.width="12px",n.style.height="12px",n.style.backgroundColor=this.search,n.style.border="1px solid "+this.search,n.style.fontSize="11px",n.style.width="15em",n.style.height="16px",n.style.borderRadius="10px",n.style.color="#999",n.style.padding="0",n.style.paddingLeft="20px",n.style.marginLeft="5px",n.style.marginTop="6px !important",n.style.font="7pt Lucida Sans Unicode,Lucida Grande,Verdana,Arial,Helvetica,Myriad,Tahoma,clean,sans-serif !important",i.push(n);var o=new e.ThemeClass("searchbox:focus");o.style.color="white",o.style.outline="none",i.push(o);var r=new e.ThemeClass("checkedRow");r.style.cssText="background-color:"+this.selection+" !important;",i.push(r);var s=new e.ThemeClass("navbar-item-selected");s.style.background=this.selection,s.style.color=this.content,i.push(s);var a=new e.ThemeClass("auxpane");a.style.border="0",a.style.background=this.sidepanel,i.push(a);var l=new e.ThemeClass("mainpane");l.style.background=this.mainpanel,l.style.border=0,i.push(l);var c=new e.ThemeClass("mainToolbar");c.style.background=this.toolpanel,i.push(c);for(var d in i)t+=i[d].toString();return t}function s(){console.log("theme sheet writer"),console.log(this.writeNavigationStyle()),console.log(this.writeLocationStyle()),console.log(this.writeMainStyle()),console.log(this.writeButtonStyle())}function a(e){return""}var l="white",c="#777777",d="#EFEFEF",h="#f47d64",u="#F7F7F7",p="white",f="#bfbfbf",g="#3087B3",m="#444",v="white";return t.prototype.navbar=l,t.prototype.button=c,t.prototype.location=d,t.prototype.selection=h,t.prototype.sidepanel=u,t.prototype.mainpanel=p,t.prototype.navtext=f,t.prototype.content=g,t.prototype.search=m,t.prototype.toolpanel=v,t.prototype.writeNavigationStyle=i,t.prototype.writeLocationStyle=n,t.prototype.writeButtonStyle=o,t.prototype.writeMainStyle=r,t.prototype.render=s,t.prototype.getSheet=a,{ThemeSheetWriter:t}}),define("orion/widgets/themes/ThemeVersion",[],function(){var e="6.85";return e}),define("orion/widgets/themes/container/ThemeData",["i18n!orion/settings/nls/messages","orion/editor/textTheme","orion/widgets/themes/container/ThemeSheetWriter","orion/widgets/themes/ThemeVersion"],function(e,t,i,n){function o(){}function r(){this.styles=[];var e=new o;e.name="Orion",e.navbar="white",e.button="#EFEFEF",e.location="#efefef",e.selection="FEC",e.sidepanel="#FBFBFB",e.mainpanel="white",e.toolpanel="white",e.navtext="#bfbfbf",e.content="#3087B3",e.search="#444",e.breadcrumb="#3087B3",e.separator="#333",e.bannerProgress="whitesmoke",this.styles.push(e);var t=new o;t.name="Orion2014",t.navbar="white",t.button="#EFEFEF",t.location="#EFEFEF",t.selection="FEC",t.sidepanel="#EEEEEE",t.mainpanel="#EEEEEE",t.toolpanel="#EEEEEE",t.navtext="#BFBFBF",t.content="#333333",t.search="#444444",t.breadcrumb="#333333",t.separator="#333333",t.bannerProgress="orange",this.styles.push(t);var i=new o;i.name="JazzHub",i.navbar="white",i.button="#EFEFEF",i.location="#EFEFEF",i.selection="#F47D64",i.sidepanel="#EEEEEE",i.mainpanel="#EEEEEE",i.toolpanel="#EEEEEE",i.navtext="#BFBFBF",i.content="#333333",i.search="#444444",i.breadcrumb="#798891",i.separator="#798891",i.bannerProgress="#F47D64",this.styles.push(i);var n=new o;n.name="Green Zone",n.navbar="seagreen",n.button="lavender",n.location="darkseagreen",n.selection="moccasin",n.sidepanel="aliceblue",n.mainpanel="white",n.toolpanel="white",n.navtext="#FBFBFB",n.content="darkgreen",n.search="darkgreen",n.breadcrumb="#3087B3",n.separator="seagreen",n.bannerProgress="#F2F2F2",this.styles.push(n);var r=new o;r.name="Pretty In Pink",r.navbar="plum",r.button="lavender",r.location="pink",r.selection="lavender",r.sidepanel="seashell",r.mainpanel="white",r.toolpanel="white",r.navtext="#FBFBFB",r.content="mediumorchid",r.search="violet",r.breadcrumb="#3087B3",r.separator="plum",r.bannerProgress="#F2F2F2",this.styles.push(r);var s=new o;s.name="Blue Monday",s.navbar="cornflowerblue",s.button="lavender",s.location="skyblue",s.selection="lavender",s.sidepanel="aliceblue",s.mainpanel="white",s.toolpanel="white",s.navtext="#FBFBFB",s.content="royalblue",s.search="royalblue",s.breadcrumb="#3087B3",s.separator="cornflowerblue",s.bannerProgress="#F2F2F2",this.styles.push(s);var a=new o;a.name="Vanilla Skies",a.navbar="sandybrown",a.button="lemmonchiffon",a.location="cornsilk",a.selection="lemonchiffon",a.sidepanel="white",a.mainpanel="white",a.toolpanel="white",a.navtext="lemonchiffon",a.content="chocolate",a.search="moccasin",a.breadcrumb="#3087B3",a.separator="sandybrown",a.bannerProgress="#F2F2F2",this.styles.push(a);var l=new o;l.name="Beetlejuice",l.navbar="indigo",l.button="slateblue",l.location="darkslateblue",l.selection="silver",l.sidepanel="lavender",l.mainpanel="white",l.toolpanel="white",l.navtext="#FBFBFB",l.content="mediumslateblue",l.search="#444",l.breadcrumb="#3087B3",l.separator="indigo",l.bannerProgress="#F2F2F2",this.styles.push(l);var c=new o;c.name="Red",c.navbar="#CD2127",c.button="#777777",c.location="#D85F56",c.selection="lightcoral",c.sidepanel="#EFDAB2",c.mainpanel="#FDFADD",c.toolpanel="#FDFADD",c.navtext="#FBFBFB",c.content="darkred",c.search="#D85F56",c.breadcrumb="darkred",c.separator="#CD2127",c.bannerProgress="#F2F2F2",this.styles.push(c)}function s(){return this.styles}function a(){return{storage:"/themes",styleset:"styles",defaultTheme:"JazzHub",selectedKey:"selected",version:n}}function l(){var t=10,i=10,n=350,o=32,r=29,s=t+o+r,a={};a.top=t,a.left=i,a.width=n,a.height=n,a.shapes=[{type:"RECTANGLE",name:e["Navigation Bar"],x:i,y:t,width:n,height:o,family:"navbar",fill:"#333",order:1},{type:"TEXT",name:e["Navigation Text"],label:"UserName",x:i+n-70,y:t+20,family:"navtext",fill:"#bfbfbf",font:"8pt sans-serif"},{type:"ROUNDRECTANGLE",name:e["Search Box"],x:i+n-145,y:t+10,width:70,height:12,family:"search",fill:"#444",order:3},{type:"RECTANGLE",name:e["Tool Panel"],x:i+.4*n,y:s,width:.6*n-1,height:30,family:"toolpanel",fill:"white",order:4},{type:"RECTANGLE",name:e["Selection Bar"],x:i+.4*n+5,y:s+62,width:.6*n-10,height:20,family:"selection",fill:"#FEC",order:7},{type:"RECTANGLE",name:e.Location,x:i,y:t+o,width:n,height:r,family:"location",fill:"#efefef",order:8},{type:"TEXT",name:e["Navigation Text"],label:"Navigator",x:i+50,y:t+20,family:"navtext",fill:"#bfbfbf",font:"8pt sans-serif",order:2},{type:"TEXT",name:e.Content,label:"Breadcrumb",x:i+5,y:t+o+18,family:"content",fill:"#3087B3",font:"8pt sans-serif"},{type:"TEXT",name:e.Content,label:"/",x:i+68,y:t+o+18,family:"content",fill:"#3087B3",font:"8pt sans-serif",order:9},{type:"TEXT",name:e.Content,label:"Location",x:i+74,y:t+o+18,family:"content",fill:"#3087B3",font:"8pt sans-serif"},{type:"RECTANGLE",name:e["Main Panel"],x:i+.4*n,y:s+30,width:.6*n-1,height:n-s+t-31,family:"mainpanel",fill:"white",order:6},{type:"ROUNDRECTANGLE",name:e.Button,x:i+.4*n+5,y:s+5,width:37,height:20,family:"button",fill:"#EFEFEF",order:11},{type:"TEXT",name:e["Button Text"],label:"Button",x:i+.4*n+8,y:s+19,family:"navbar",fill:"#333",font:"8pt sans-serif"},{type:"TRIANGLE",name:"userMenu",x1:i+n-7,y1:t+14,x2:i+n-13,y2:t+14,x3:i+n-10,y3:t+19,family:"userMenu",fill:"#BFBFBF"},{type:"TRIANGLE",name:"userMenu",x1:i+10,y1:s+17,x2:i+16,y2:s+17,x3:i+13,y3:s+22,family:"userMenu",fill:"#BFBFBF"},{type:"TEXT",name:e["Section Text"],label:"Section",x:i+20,y:s+23,family:"navbar",fill:"#333",font:"8pt sans-serif"},{type:"LINE",name:e["Line Color"],x1:i+.4*n,y1:s+30,x2:i+n,y2:s+30,linewidth:2,fill:"#DEDEDE"},{type:"LINE",name:e["Line Color"],x1:i+.4*n,y1:s,x2:i+.4*n,y2:t+n,linewidth:2,fill:"#DEDEDE"},{type:"LINE",name:e["Line Color"],x1:i+10,y1:s+29,x2:i+.4*n-10,y2:s+29,linewidth:2,fill:"#DEDEDE"},{type:"RECTANGLE",name:e["Side Panel"],x:i,y:s,width:.4*n,height:n-s+t,family:"sidepanel",fill:"#FBFBFB",order:12},{type:"TRIANGLE",name:"userMenu",x1:i+n-7,y1:t+14,x2:i+n-13,y2:t+14,x3:i+n-10,y3:t+19,family:"userMenu",fill:"#BFBFBF"},{type:"TRIANGLE",name:"userMenu",x1:i+10,y1:s+17,x2:i+16,y2:s+17,x3:i+13,y3:s+22,family:"userMenu",fill:"#BFBFBF"},{type:"TEXT",name:e["Navigation Text"],label:"Navigator",x:i+50,y:t+20,family:"navtext",fill:"#bfbfbf",font:"8pt sans-serif",order:2},{type:"TRIANGLE",name:"userMenu",x1:i+n-7,y1:t+14,x2:i+n-13,y2:t+14,x3:i+n-10,y3:t+19,family:"userMenu",fill:"#BFBFBF"},{type:"TRIANGLE",name:"userMenu",x1:i+10,y1:s+17,x2:i+16,y2:s+17,x3:i+13,y3:s+22,family:"userMenu",fill:"#BFBFBF"}];for(var l=0;3>l;l++)a.shapes.push({type:"TEXT",name:e.Content,label:"org.eclipse.orion.content",x:i+.4*n+20,y:s+56+20*l,fill:"#3087B3",family:"content"});for(var l=0;3>l;l++)a.shapes.push({type:"TEXT",name:e.Content,label:"Item",x:i+15,y:s+44+20*l,fill:"#3087B3",family:"content"});for(var c=0;3>c;c++)a.shapes.push({type:"TRIANGLE",name:"twisty",x1:i+.4*n+10,y1:s+50+20*c,x2:i+.4*n+15,y2:s+53+20*c,x3:i+.4*n+10,y3:s+56+20*c,family:"navbar",fill:"#333"});return a.shapes.push({type:"IMAGE",name:"logo",x:i+5,y:t+8,source:"../../images/orion-transparent.png",family:"logo"}),a}function c(e){var n=new i.ThemeSheetWriter,o="orionTheme",r=new t.TextTheme.getTheme(o);r.setThemeClass(o,n.getSheet(e))}return o.prototype.name="Orion",o.prototype.navbar="#404648",o.prototype.button="#EFEFEF",o.prototype.location="#333",o.prototype.breadcrumb="#3087B3",o.prototype.separator="#333",o.prototype.selection="FEC",o.prototype.sidepanel="#FBFBFB",o.prototype.mainpanel="white",o.prototype.toolpanel="white",o.prototype.navtext="#bfbfbf",o.prototype.content="#3087B3",o.prototype.search="#444",o.prototype.bannerProgress="white",r.prototype.styles=[],r.prototype.getStyles=s,r.prototype.getThemeStorageInfo=a,r.prototype.getViewData=l,r.prototype.processSettings=c,{ThemeData:r,getStyles:s}}),define("orion/widgets/nls/messages",{root:!0,de:!0,es:!0,fr:!0,it:!0,ja:!0,ko:!0,"pt-br":!0,zh:!0,"zh-hk":!0,"zh-tw":!0}),define("orion/widgets/nls/root/messages",{"Choose a Folder":"Choose a Folder",OK:"OK",Profile:"Profile","Sign out":"Sign out","N/A":"N/A","logged in since ":"logged in since ","Sign in":"Sign in","Authentication required!":"Authentication required!","Name:":"Name:","Plug-ins":"Plug-ins",Properties:"Properties",Services:"Services","SFTP Transfer":"SFTP Transfer","Remote host:":"Remote host:","Port:":"SFTP Port:","Remote path:":"Remote path:","User name:":"User name:","Password:":"Password:","Start Transfer":"Start Transfer","Location:":"Location:","orion.sftpConnections":"orion.sftpConnections","Drag a file here":"Drag a file here","unzip zips":"Unzip *.zip files","or if you prefer":"(or upload a file using the buttons below)",Upload:"Upload","Browse...":"Browse...","Import a file or zip":"Import a file or zip",MissingSearchRenderer:"Missing required argument: searchRenderer",FindFileNamed:"Find File in ${0}",FindFileGlobal:"Find File in any Project",Search:"Search","FileName FolderName":"FileName FolderName(Optional)","Searching...":"Searching...",SearchOccurences:'Searching for occurrences of: "${0}"',name:"name",test:"test","Type the name of a file to open (? = any character, * = any string):":"Type the name of a file to open (? = any character, * = any string):","Sign Out":"Sign Out","Sign In":"Sign In",Help:"Help","Report a Bug":"Report a Bug","Keyboard Shortcuts":"Keyboard Shortcuts",Settings:"Settings",userSettings:"User Profile","View profile of ":"View profile of ",Profiles:"Profiles","Information Needed":"Information Needed",Cancel:"Cancel","If the same file exists in both the source and destination:":"If the same file exists in both the source and destination:","Cancel the transfer":"Cancel the transfer","Always overwrite destination":"Always overwrite destination","Overwrite if source is newer":"Overwrite if source is newer",New:"New","Building file skeleton...":"Building file skeleton...",Add:"Add","Upload...":"Upload...",AvailableCmdsType:"For a list of available commands type '${0}'.","Main Pages":"Main Pages","Related Links":"Related Links",Yes:"Yes",No:"No",DeleteSearchTrmMsg:"Click or use delete key to delete the search term",Application:"Application",selectLaunchConfig:"Create new launch configuration",createNew:"Create New",Running:"Running",checkingStateMessage:"Checking status of ${0}",checkingStateShortMessage:"checking status",Status:"Status",appInfoStopped:"stopped",appInfoRunning:"running",appInfoUnknown:"unknown",appInfoError:"error",displayNameSeparator:" on ",openAppTooltip:"Open the Deployed App",openLogsTooltip:"Open the Logs",redeployConfirmationDialogTitle:"Stop and Redeploy?",redeployConfirmationDialogMessage:"Your application ${0} will be re-deployed.",redeployConfirmationDialogCheckboxMessage:"Don't ask me again.",createNewTooltip:"Create a new launch configuration",back:"< Back",next:"Next >"}),define("orion/widgets/UserMenu",["i18n!orion/widgets/nls/messages","orion/webui/littlelib","orion/PageLinks","orion/webui/dropdown"],function(e,t,i,n){function o(e){this._displaySignOut=!0,this._init(e)}return o.prototype={_init:function(e){if(this._dropdownNode=t.node(e.dropdownNode),!this._dropdownNode)throw"no dom node for dropdown found";this._dropdown=e.dropdown,this._serviceRegistry=e.serviceRegistry,this.authenticatedServices={},this.unauthenticatedServices={},this._noSeparator=e.noSeparator,this._dropDownItemClass=e.dropDownItemClass,this._keyAssistClass=e.keyAssistClass,void 0!==e.signOut&&(this._displaySignOut=e.signOut)},isSingleService:function(){return this.length(this.unauthenticatedServices)+this.length(this.authenticatedServices)===1},hasServices:function(){return this.length(this.unauthenticatedServices)+this.length(this.authenticatedServices)>0},length:function(e){var t=0;for(var i in e)e.hasOwnProperty(i)&&t++;return t},_makeMenuItem:function(e,i){var o=n.createMenuItem(e),r=o.firstElementChild;return"string"==typeof this._dropDownItemClass&&""!==this._dropDownItemClass&&r.classList.add(this._dropDownItemClass),r.addEventListener("click",i,!1),r.addEventListener("keydown",function(e){(e.keyCode===t.KEY.ENTER||e.keyCode===t.KEY.SPACE)&&i()},!1),r},_renderAuthenticatedService:function(t){var n=this,o=this.authenticatedServices[t].authService;if(o&&o.logout&&this._displaySignOut){var r=this._makeMenuItem(e["Sign Out"],function(){o.logout().then(function(){n.addUserItem(t,o,n.authenticatedServices[t].label),localStorage.removeItem(t),localStorage.removeItem("lastLogin");for(var e=localStorage.length-1;e>=0;e--){var r=localStorage.key(e);r&&0===r.indexOf("/orion/preferences/user")&&localStorage.removeItem(r)}o.getAuthForm(i.getOrionHome()).then(function(e){window.location=e})})});this._dropdownNode.appendChild(r.parentNode)}},renderServices:function(){function o(e){return s[e]||(s[e]=r.createDocumentFragment()),s[e]}var r=document,s=[],a=this._serviceRegistry;i.getPageLinksInfo(a,"orion.page.link.user").then(function(i){this._dropdown?this._dropdown.empty():this._dropdownNode&&t.empty(this._dropdownNode);var a=i.getAllLinks();if(a=a.sort(function(e,t){return e.order&&t.order?e.order-t.order:0}),a.forEach(function(e){var i,n;e.category&&(n=/user\.(\d+)/.exec(e.category))&&(i=parseInt(n[1],10)),("number"!=typeof i||isNaN(i))&&(i=1);var s=o(i),a=r.createElement("li"),l=r.createElement("a");l.setAttribute("role","menuitem"),"string"==typeof this._dropDownItemClass?""!==this._dropDownItemClass&&l.classList.add(this._dropDownItemClass):l.classList.add("dropdownMenuItem"),l.href=e.href,l.textContent=e.textContent,a.appendChild(l),s.appendChild(a),l.addEventListener("keydown",function(e){(e.keyCode===t.KEY.ENTER||e.keyCode===t.KEY.SPACE)&&l.click()},!1)}.bind(this)),this.keyAssistFunction){var l=this._makeMenuItem(e["Keyboard Shortcuts"],this.keyAssistFunction);"string"==typeof this._keyAssistClass?""!==this._keyAssistClass&&l.classList.add(this._keyAssistClass):l.classList.add("key-assist-menuitem");var c=l.parentNode;o(0).appendChild(c)}var d=this;if(s.sort(function(e,t){return e-t}).forEach(function(e,t){if(t<s.length-1&&!this._noSeparator){var i=n.createSeparator();e.appendChild(i)}d._dropdownNode.appendChild(e)}.bind(this)),this.isSingleService())for(var h in this.authenticatedServices)this.authenticatedServices.hasOwnProperty(h)&&this._renderAuthenticatedService(h,0)}.bind(this))},setKeyAssist:function(e){this.keyAssistFunction=e,this.renderServices()},addUserItem:function(e,t,i,n){n?(this.unauthenticatedServices[e]&&delete this.unauthenticatedServices[e],this.authenticatedServices[e]={authService:t,label:i,data:n}):(this.authenticatedServices[e]&&delete this.authenticatedServices[e],this.unauthenticatedServices[e]=this.unauthenticatedServices[e]?{authService:t,label:i,pending:this.unauthenticatedServices[e].pending}:{authService:t,label:i}),this.renderServices()}},o.prototype.constructor=o,{UserMenu:o}}),define("orion/search/nls/messages",{root:!0,de:!0,es:!0,fr:!0,it:!0,ja:!0,ko:!0,"pt-br":!0,zh:!0,"zh-hk":!0,"zh-tw":!0}),define("orion/search/nls/root/messages",{"Find:":"Find:","Find With":"Find With","ReplaceWith:":"ReplaceWith:","Replace With":"Replace with","Show all":"Show all","Wrap search":"Wrap search","Incremental search":"Incremental search","Whole Word":"Whole Word","Regular expression":"Regular expression","Find after replace":"Find after replace",Options:"Options","Find next match":"Find next match","Find previous match":"Find previous match",Next:"Next",Previous:"Previous",Replace:"Replace","Replace...":"Preview Replacement","Replace All":"Replace All","Show Replace":"Switch to Replace Mode","Hide Replace":"Switch to Search Mode","Search ${0}":"Search ${0}",TypeKeyOrWildCard:"Type a keyword or wild card to search in ","Search failed.":"Search failed.",NoMatchFound:"No matches found for ${0}","Searching...":"Searching...","ResourceChanged.":"Resource has been changed by others.","Failed to write file.":"Failed to write file.",Results:"Results",FilesAofBmatchingC:'Files ${0} of ${1} matching "${2}"',ReplaceAwithBforCofD:'Replace "${0}" with "${1}" for files ${2} of ${3}',Location:"Location","Click to compare":"Click to compare",'Search again in this folder with "${0}"':'Search again in this folder with "${0}"',"Files replaced":"Files replaced",Status:"Status",matchesReplacedMsg:"${0} out of ${1}  matches replaced.","Replace all matches with...":"Replace all matches with...","Apply Changes":"Replace Selected","Replace all selected matches":"Replace all selected matches","Hide Compare":"Hide Compare","Hide compare view of changes":"Hide compare view of changes","Show Compare":"Show Compare","Show compare view of changes":"Show compare view of changes","Show All":"Show All","Show all the results in one page":"Show all the results in one page","< Previous Page":"< Previous Page","Show previous page of search result":"Show previous page of search result","Next Page >":"Next Page >","Show next page of search result":"Show next page of search result","Next result":"Next result","Previous result":"Previous result","Expand all results":"Expand all results","Collapse all results":"Collapse all results","Writing files...":"Writing files...","Preparing preview...":"Preparing preview...","Replaced File (${0})":"Replaced File (${0})","Original File (${0})":"Original File (${0})","Sort by Name":"Sort by Name","Compare changes":"Compare changes","Search Results":"Search Results","Replace All Matches":"Replace All Matches","No matches":"No matches",Rename:"Rename",Search:"Search","All types":"All types","File type":"File type","All ${0} files":"All ${0} files","${0} is already saved":"${0} is already saved","Type a search term":"Type a search term","Type a replace term":"Type a replace term","Case sensitive":"Case sensitive","File name":"File name","Path name":"Path name",Save:"Save","Type filter text":"Type filter text","Scope Search":"Scoped Search","Open in Search page for this directory":"Open the Search page for this folder.","${0}. Try your search again.":"${0}. Try your search again.",DeleteSearchTrmMsg:"Click or use delete key to delete the search term","${0} matches":"${0} matches",regexOptionOff:"Regular expressions are off. Click here or use the options to turn them on for replacement",regexOptionOn:"Regular expressions are on. Click here or use the options to turn them off",Scope:"Scope","Show previous search terms":"Show previous search terms","Show previous replace terms":"Show previous replace terms","Show replacement preview":"Show replacement preview","File name patterns (comma-separated)":"File name patterns (comma-separated)","(* = any string, ? = any character)":"(* = any string, ? = any character)","(${0})":"(${0} matches)",singleMatch:"(1 match)","Choose a Folder":"Choose a Folder","Remove from search results":"Remove from search results","^ Edit Search":"^ Edit Search","Preview: ":"Preview: ",fullPath:"Show Full Path",switchFullPath:"Show/hide full path",refsInProject:"${0} references to '${1}' in ${2}",refsInWorkspace:"${0} references to '${1}' in the workspace",viewByTypes:"By types",viewByFiles:"By files",viewByTypesTooltip:"View references grouped by categories",viewByFilesTooltip:"View references grouped by files",hidePerfectMatch:"Hide perfect matches",showPerfectMatch:"Show perfect matches",hideNonMatch:"Hide non-matches",showNonMatch:"Show non-matches",hidePossibleMatch:"Hide possible matches",showPossibleMatch:"Show possible matches"}),define("orion/navigate/nls/messages",{root:!0,de:!0,es:!0,fr:!0,it:!0,ja:!0,ko:!0,"pt-br":!0,zh:!0,"zh-hk":!0,"zh-tw":!0}),define("orion/navigate/nls/root/messages",{Navigator:"Navigator","Strings Xtrnalizr":"Strings Xtrnalizr","Externalize strings":"Externalize strings from JavaScript files in this folder.",NotSupportFileSystem:"${0} is not supported in this file system",SrcNotSupportBinRead:"Source file service does not support binary read",TargetNotSupportBinWrite:"Target file service does not support binary write",NoFileSrv:"No matching file service for location: ${0}","Choose a Folder":"Choose a Folder","Copy of ${0}":"Copy of ${0}",EnterName:"Enter a new name for '${0}'",ChooseFolder:"Choose folder...",Rename:"Rename",RenameFilesFolders:"Rename the selected files or folders",CompareEach:"Compare with each other","Compare 2 files":"Compare the selected 2 files with each other","Compare with...":"Compare With...",CompareFolders:"Compare the selected folder with a specified folder",Delete:"Delete","Unknown item":"Unknown item","delete item msg":"Are you sure you want to delete these ${0} items?",DeleteTrg:"Are you sure you want to delete '${0}'?",Zip:"Zip",ZipDL:"Create a zip file of the folder contents and download it","New File":"File","Create a new file":"Create a new file",FailedToCreateProject:"Failed to create project: ${0}",FailedToCreateFile:"Failed to create file: ${0}",CopyFailed:"Copy operation failed",MoveFailed:"Move operation failed","Name:":"Name:","New Folder":"Folder","Folder name:":"Folder name:","Create a new folder":"Create a new folder","Creating folder":"Creating folder",Folder:"Folder","Create an empty folder":"Create an empty folder",CreateEmptyMsg:"Create an empty folder on the Orion server. You can import, upload, or create content in the editor.","Sample HTML5 Site":"Sample HTML5 Site","Generate a sample":"Generate a sample",'Generate an HTML5 "Hello World" website, including JavaScript, HTML, and CSS files.':'Generate an HTML5 "Hello World" website, including JavaScript, HTML, and CSS files.',"Creating a folder for ${0}":"Creating a folder for ${0}","SFTP Import":"SFTP Import","Import content from SFTP":"Import content from SFTP","Imported Content":"Imported Content","Upload a Zip":"Upload a Zip","Upload content from a local zip file":"Upload content from a local zip file","Uploaded Content":"Uploaded Content","Clone Git Repository":"Clone Git Repository","Clone a git repository":"Clone a git repository","Link to Server":"Link to Server",LinkContent:"Link to existing content on the server",CreateLinkedFolder:"Create a folder that links to an existing folder on the server.","Server path:":"Server path:",NameLocationNotClear:"The name and server location were not specified.","Go Up":"Go Up",GoUpToParent:"Move up to the parent folder","Go Into":"Go Into",GoSelectedFolder:"Move into the selected folder","File or zip archive":"File or Zip Archive",ImportLcFile:"Import a file or zip archive from your local file system","SFTP from...":"SFTP",CpyFrmSftp:"Copy files and folders from a specified SFTP connection","Importing from ${0}":"Importing from ${0}","SFTP to...":"SFTP",CpyToSftp:"Copy files and folders to a specified SFTP location",Exporting:"Exporting to ${0}","Pasting ${0}":"Pasting ${0}","Copy to":"Copy to","Move to":"Move to","Copying ${0}":"Copying ${0}","Moving ${0}":"Moving ${0}","Renaming ${0}":"Renaming ${0}","Deleting ${0}":"Deleting ${0}","Creating ${0}":"Creating ${0}","Linking to ${0}":"Linking to ${0}",MvToLocation:"Move files and folders to a new location",Cut:"Cut",Copy:"Copy","Fetching children of ":"Fetching children of ",Paste:"Paste","Open With":"Open With","Loading ":"Loading ",New:"New",File:"File",Actions:"Actions","Orion Content":"Orion Content","Create new content":"Create new content","Import from HTTP...":"HTTP","File URL:":"File URL:",ImportURL:"Import a file from a URL and optionally unzip it","Unzip *.zip files:":"Unzip *.zip files:","Extracted from:":"Extracted from:",FolderDropNotSupported:"Did not drop ${0}. Folder drop is not supported in this browser.",CreateFolderErr:"You cannot copy files directly into the workspace. Create a folder first.","Unzip ${0}?":"Unzip ${0}?","Upload progress: ":"Upload progress: ","Uploading ":"Uploading ","Cancel upload":"Cancel upload",UploadingFileErr:"Uploading the following file failed: ","Enter project name:":"Enter project name:","Create new project":"Create new project","Creating project ${0}":"Creating project ${0}",NoFile:"Use the ${0} menu to create new files and folders. Click a file to start coding.",Download:"Download",Download_tooltips:"Download the file contents as the displayed name","Downloading...":"Reading file contents...","Download not supported":"Contents download is not supported in this browser.",gettingContentFrom:"Getting content from ",confirmLaunchDelete:'Delete Launch Configuration "${0}" ?',deletingLaunchConfiguration:"Deleting launch configuration...",deployTo:"Deploy to ",deploy:"Deploy ",connect:"Connect",fetchContent:"Fetch content",fetchContentOf:"Fetch content of ",disconnectFromProject:"Disconnect from project",doNotTreatThisFolder:"Do not treat this folder as a part of the project",checkStatus:"Check status",checkApplicationStatus:"Check application status",checkApplicationState:"Check application state",stop:"Stop",start:"Start",stopApplication:"Stop the App",startApplication:"Start the application",manage:"Manage",manageThisApplicationOnRemote:"Manage this application on remote server",deleteLaunchConfiguration:"Delete this launch configuration",editLaunchConfiguration:"Edit this launch configuration",deployThisApplication:"Deploy the App from the Workspace",associatedFolder:"Associated Folder",associateAFolderFromThe:"Associate a folder from the workspace with this project.",convertToProject:"Convert to project",convertThisFolderIntoA:"Convert this folder into a project",thisFolderIsAProject:"This folder is a project already.",basic:"Basic","createAnEmptyProject.":"Create an empty project.",sFTP:"SFTP",createAProjectFromAn:"Create a project from an SFTP site.",readMeCommandName:"Readme File",readMeCommandTooltip:"Create a README.md file in this project",zipArchiveCommandName:"Zip Archive",zipArchiveCommandTooltip:"Create a project from a local zip archive.","Url:":"Url:",notZip:"The following files are not zip files: ${0}. Would you like to continue the import?",notZipMultiple:"There are multiple non-zip files being uploaded. Would you like to continue the import?",Cancel:"Cancel",Ok:"Ok",missingCredentials:"Enter the ${0} authentication credentials associated with ${1} to check its status.",deploying:"deploying",starting:"restarting",stopping:"stopping",checkingStateShortMessage:"checking status"}),define("orion/fileClient",["i18n!orion/navigate/nls/messages","orion/Deferred","orion/i18nUtil"],function(e,t,i){function n(t,n,o){if(!t[n])throw new Error(i.formatMessage(e.NotSupportFileSystem,n));
return t[n].apply(t,o)}function o(i,r,s,a){if(!i.readBlob)throw new Error(e.SrcNotSupportBinRead);if(!s.writeBlob)throw new Error(e.TargetNotSupportBinWrite);if("/"!==r[r.length-1])return n(i,"readBlob",[r]).then(function(e){return n(s,"writeBlob",[a,e])});var l=a.substring(0,a.length-1),c=decodeURIComponent(l.substring(l.lastIndexOf("/")+1)),d=l.substring(0,l.lastIndexOf("/")+1);return n(s,"createFolder",[d,c]).then(function(){},function(){}).then(function(){return n(i,"fetchChildren",[r]).then(function(e){for(var n=[],r=0;r<e.length;++r){var l=e[r].Location,c=l;e[r].Directory&&(c=l.substring(0,l.length-1));var d=decodeURIComponent(c.substring(c.lastIndexOf("/")+1)),h=a+encodeURIComponent(d);e[r].Directory&&(h+="/"),n[r]=o(i,l,s,h)}return t.all(n)})})}function r(n,o){function r(i){var n=new t;return n.reject(e["No Matching FileService for location:"]+i),n}function s(){if(!l){a=[],l=[],c=[];var e=n.getServiceReferences("orion.core.file"),t=e;if(o){t=[];for(var i=0;i<e.length;++i)o(e[i])&&t.push(e[i])}t.sort(function(e,t){var i=e.getProperty("ranking")||0,n=t.getProperty("ranking")||0;return i-n});for(var r=0;r<t.length;++r){d[r]={Directory:!0,Length:0,LocalTimeStamp:0,Location:t[r].getProperty("top"),ChildrenLocation:t[r].getProperty("top"),Name:t[r].getProperty("Name")||t[r].getProperty("NameKey")};var s=t[r].getProperty("top"),h=t[r].getProperty("pattern")||(s?s.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"):"");Array.isArray(h)||(h=[h]);for(var u=[],p=0;p<h.length;p++){var f=h[p];"^"!==f[0]&&(f="^"+f),u.push(new RegExp(f))}a[r]=u,l[r]=n.getService(t[r]),c[r]=t[r].getProperty("Name")||t[r].getProperty("NameKey")}}}var a,l,c,d=[],h={fetchChildren:function(){var e=new t;return e.resolve(d),e},createWorkspace:function(){var i=new t;return i.reject(e["no file service"]),i},loadWorkspaces:function(){var i=new t;return i.reject(e["no file service"]),i},loadWorkspace:function(){var i=new t;return window.setTimeout(function(){i.resolve({Directory:!0,Length:0,LocalTimeStamp:0,Name:e["File Servers"],Location:"/",Children:d,ChildrenLocation:"/"})},100),i},search:r,createProject:r,createFolder:r,createFile:r,deleteFile:r,moveFile:r,copyFile:r,read:r,write:r};this._getServiceIndex=function(t){if(s(),"/"===t)return-1;if(!t||t.length&&0===t.length)return l[0]?0:-1;for(var n=0;n<a.length;++n)for(var o=0;o<a[n].length;o++)if(a[n][o].test(t))return n;throw new Error(i.formatMessage(e.NoFileSrv,t))},this._getService=function(e){var t=this._getServiceIndex(e);return-1===t?h:l[t]},this._getServiceName=function(e){var t=this._getServiceIndex(e);return-1===t?h.Name:c[t]},this._getServiceRootURL=function(e){var t=this._getServiceIndex(e);return-1===t?h.Location:d[t].Location}}return r.prototype={getService:function(e){return this._getService(e)},fileServiceName:function(e){return this._getServiceName(e)},fileServiceRootURL:function(e){return this._getServiceRootURL(e)},fetchChildren:function(e){return n(this._getService(e),"fetchChildren",arguments)},createWorkspace:function(){return n(this._getService(),"createWorkspace",arguments)},loadWorkspaces:function(){return n(this._getService(),"loadWorkspaces",arguments)},loadWorkspace:function(e){return n(this._getService(e),"loadWorkspace",arguments)},createProject:function(e){return n(this._getService(e),"createProject",arguments)},createFolder:function(e){return n(this._getService(e),"createFolder",arguments)},createFile:function(e){return n(this._getService(e),"createFile",arguments)},deleteFile:function(e){return n(this._getService(e),"deleteFile",arguments)},moveFile:function(e,t,i){var r=this._getService(e),s=this._getService(t);if(r===s)return n(r,"moveFile",arguments);var a="/"===e[e.length-1],l=t;if("/"!==l[l.length-1]&&(l+="/"),i)l+=encodeURIComponent(i);else{var c=e;a&&(c=c.substring(0,c.length-1)),l+=c.substring(c.lastIndexOf("/")+1)}return a&&"/"!==l[l.length-1]&&(l+="/"),o(r,e,s,l).then(function(){return n(r,"deleteFile",[e])})},copyFile:function(e,t,i){var r=this._getService(e),s=this._getService(t);if(r===s)return n(r,"copyFile",arguments);var a="/"===e[e.length-1],l=t;if("/"!==l[l.length-1]&&(l+="/"),i)l+=encodeURIComponent(i);else{var c=e;a&&(c=c.substring(0,c.length-1)),l+=c.substring(c.lastIndexOf("/")+1)}return a&&"/"!==l[l.length-1]&&(l+="/"),o(r,e,s,l)},read:function(e){return n(this._getService(e),"read",arguments)},readBlob:function(e){return n(this._getService(e),"readBlob",arguments)},write:function(e){return n(this._getService(e),"write",arguments)},remoteImport:function(e){return n(this._getService(e),"remoteImport",arguments)},remoteExport:function(e){return n(this._getService(e),"remoteExport",arguments)},search:function(e){return n(this._getService(e.resource),"search",arguments)}},r.prototype.constructor=r,{FileClient:r}}),define("orion/crawler/nls/messages",{root:!0,de:!0,es:!0,fr:!0,it:!0,ja:!0,ko:!0,"pt-br":!0,zh:!0,"zh-hk":!0,"zh-tw":!0}),define("orion/crawler/nls/root/messages",{filesFound:"${0} files found out of ${1}",searchCancelled:"Search cancelled by user",Cancel:"Cancel"}),define("orion/regex",[],function(){function e(e){return e.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&")}function t(e){var t=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(e);return t?{pattern:t[1],flags:t[2]}:null}return{escape:e,parse:t}}),define("orion/editor/textModel",["orion/editor/eventTarget","orion/regex","orion/util"],function(e,t,i){function n(e,t){this._lastLineIndex=-1,this._text=[""],this._lineOffsets=[0],this.setText(e),this.setLineDelimiter(t)}return n.prototype={destroy:function(){},find:function(e){this._text.length>1&&(this._text=[this._text.join("")]);var i=e.string,n=e.regex,o=i,r="",s=e.caseInsensitive;if(o)if(n){var a=t.parse(o);a&&(o=a.pattern,r=a.flags)}else o=i.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&"),s&&(o=o.replace(/[iI\u0130\u0131]/g,"[Iiİı]"));var l,c=null;if(o){var d=e.reverse,h=e.wrap,u=e.wholeWord,p=e.start||0,f=e.end,g=null!==f&&void 0!==f;-1===r.indexOf("g")&&(r+="g"),-1===r.indexOf("m")&&(r+="m"),s&&-1===r.indexOf("i")&&(r+="i"),u&&(o="\\b"+o+"\\b");var m,v,_=this._text[0],y=0;if(g){var C=f>p?p:f,w=f>p?f:p;_=_.substring(C,w),y=C}var b=new RegExp(o,r);d?l=function(){var e=null;for(b.lastIndex=0;;){if(v=b.lastIndex,m=b.exec(_),v===b.lastIndex)return null;if(!m)break;if(m.index+y<p)e={start:m.index+y,end:b.lastIndex+y};else{if(!h||e)break;p=_.length+y,e={start:m.index+y,end:b.lastIndex+y}}}return e&&(p=e.start),e}:(g||(b.lastIndex=p),l=function(){for(;;){if(v=b.lastIndex,m=b.exec(_),v===b.lastIndex)return null;if(m)return{start:m.index+y,end:b.lastIndex+y};if(0===v||!h)break}return null}),c=l()}return{next:function(){var e=c;return e&&(c=l()),e},hasNext:function(){return null!==c}}},getCharCount:function(){for(var e=0,t=0;t<this._text.length;t++)e+=this._text[t].length;return e},getLine:function(e,t){var i=this.getLineCount();if(!(e>=0&&i>e))return null;var n=this._lineOffsets[e];if(i>e+1){var o=this.getText(n,this._lineOffsets[e+1]);if(t)return o;for(var r,s=o.length;10===(r=o.charCodeAt(s-1))||13===r;)s--;return o.substring(0,s)}return this.getText(n)},getLineAtOffset:function(e){var t=this.getCharCount();if(!(e>=0&&t>=e))return-1;var i=this.getLineCount();if(e===t)return i-1;var n,o,r=this._lastLineIndex;if(r>=0&&i>r&&(n=this._lineOffsets[r],o=i>r+1?this._lineOffsets[r+1]:t,e>=n&&o>e))return r;for(var s=i,a=-1;s-a>1;)if(r=Math.floor((s+a)/2),n=this._lineOffsets[r],o=i>r+1?this._lineOffsets[r+1]:t,n>=e)s=r;else{if(o>e){s=r;break}a=r}return this._lastLineIndex=s,s},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},getLineEnd:function(e,t){var i=this.getLineCount();if(!(e>=0&&i>e))return-1;if(i>e+1){var n=this._lineOffsets[e+1];if(t)return n;for(var o,r=this.getText(Math.max(this._lineOffsets[e],n-2),n),s=r.length;10===(o=r.charCodeAt(s-1))||13===o;)s--;return n-(r.length-s)}return this.getCharCount()},getLineStart:function(e){return e>=0&&e<this.getLineCount()?this._lineOffsets[e]:-1},getText:function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=this.getCharCount()),e===t)return"";for(var i,n=0,o=0;o<this._text.length&&(i=this._text[o].length,!(n+i>=e));)n+=i,o++;for(var r=n,s=o;o<this._text.length&&(i=this._text[o].length,!(n+i>=t));)n+=i,o++;var a=n,l=o;if(s>=this._text.length||l>=this._text.length||s>l)return"";if(s===l)return this._text[s].substring(e-r,t-a);var c=this._text[s].substring(e-r),d=this._text[l].substring(0,t-a);return c+this._text.slice(s+1,l).join("")+d},onChanging:function(e){return this.dispatchEvent(e)},onChanged:function(e){return this.dispatchEvent(e)},setLineDelimiter:function(e,t){if("auto"===e&&(e=void 0,this.getLineCount()>1&&(e=this.getText(this.getLineEnd(0),this.getLineEnd(0,!0)))),this._lineDelimiter=e?e:i.platformDelimiter,t){var n=this.getLineCount();if(n>1){for(var o=new Array(n),r=0;n>r;r++)o[r]=this.getLine(r);this.setText(o.join(this._lineDelimiter))}}},setText:function(e,t,i){if(void 0===e&&(e=""),void 0===t&&(t=0),void 0===i&&(i=this.getCharCount()),t!==i||""!==e){for(var n=this.getLineAtOffset(t),o=this.getLineAtOffset(i),r=t,s=i-t,a=o-n,l=e.length,c=0,d=this.getLineCount(),h=0,u=0,p=0,f=[];;){if(-1!==h&&p>=h&&(h=e.indexOf("\r",p)),-1!==u&&p>=u&&(u=e.indexOf("\n",p)),-1===u&&-1===h)break;p=-1!==h&&-1!==u?h+1===u?u+1:(u>h?h:u)+1:-1!==h?h+1:u+1,f.push(t+p),c++}var g={type:"Changing",text:e,start:r,removedCharCount:s,addedCharCount:l,removedLineCount:a,addedLineCount:c};if(this.onChanging(g),0===f.length){var m,v=this.getLineStart(n);m=d>o+1?this.getLineStart(o+1):this.getCharCount(),t!==v&&(e=this.getText(v,t)+e,t=v),i!==m&&(e+=this.getText(i,m),i=m)}for(var _=l-s,y=n+a+1;d>y;y++)this._lineOffsets[y]+=_;var C,w=5e4,b=w;if(f.length<b)C=[n+1,a].concat(f),Array.prototype.splice.apply(this._lineOffsets,C);else{p=n+1,this._lineOffsets.splice(p,a);for(var S=0;S<f.length;S+=b)C=[p,0].concat(f.slice(S,Math.min(f.length,S+b))),Array.prototype.splice.apply(this._lineOffsets,C),p+=b}for(var x,L=0,T=0;T<this._text.length&&(x=this._text[T].length,!(L+x>=t));)L+=x,T++;for(var E=L,k=T;T<this._text.length&&(x=this._text[T].length,!(L+x>=i));)L+=x,T++;var N=L,A=T,R=this._text[k],I=this._text[A],D=R.substring(0,t-E),P=I.substring(i-N),M=[k,A-k+1];D&&M.push(D),e&&M.push(e),P&&M.push(P),Array.prototype.splice.apply(this._text,M),0===this._text.length&&(this._text=[""]);var O={type:"Changed",start:r,removedCharCount:s,addedCharCount:l,removedLineCount:a,addedLineCount:c};this.onChanged(O)}}},e.EventTarget.addMixin(n.prototype),{TextModel:n}}),define("orion/searchUtils",["i18n!orion/nls/messages","orion/regex","orion/editor/textModel","orion/URITemplate"],function(e,t,i,n){function o(e,i,n){var o="";n&&(o="^");var r=i.wholeWord?"\\b"+e.searchStr+"\\b":e.searchStr,s=t.parse("/"+o+r+"/");if(s){var a=s.pattern,l=s.flags;-1!==l.indexOf("i")||i.caseSensitive||(l+="i"),e.regExp={pattern:a,flags:l},e.wildCard=!0}}var r={};return r.ALL_FILE_TYPE="*.*",r.getSearchParams=function(t,i,n){if(t){var o=i,s=!0;if("*"===o&&(o=""),""===o&&(s=n&&n.type!==r.ALL_FILE_TYPE),s){var a=t.createSearchParams(o,!1,!1,n);return a}}else window.alert(e.NoSearchAvailableErr);return null},r.generateSearchHelper=function(e,t){var i=e.keyword,n=i,s={};if(e.fileType&&e.fileType!==r.ALL_FILE_TYPE&&""===i&&(n="*."+e.fileType),e.regEx)s.searchStr=i,o(s,e,t);else{var a=i.indexOf("*")>-1,l=i.indexOf("?")>-1;a&&(i=i.split("*").join(".*")),l&&(i=i.split("?").join(".")),e.wholeWord&&(i=a||l?i.replace(/[-[\]{}()+,\\^$|#\s]/g,"\\$&"):i.replace(/[-[\]{}()+.,\\^$|#\s]/g,"\\$&")),a||l||e.nameSearch||e.wholeWord?(s.searchStr=e.caseSensitive?i:i.toLowerCase(),o(s,e,t),s.wildCard=!0):(s.searchStr=e.caseSensitive?i.split("\\").join(""):i.split("\\").join("").toLowerCase(),s.wildCard=!1)}return s.searchStrLength=s.searchStr.length,{params:e,inFileQuery:s,displayedSearchTerm:n}},r.convertSearchParams=function(e){void 0!==e.rows&&(e.rows=parseInt(e.rows,10)),void 0!==e.start&&(e.start=parseInt(e.start,10)),"string"==typeof e.regEx&&(e.regEx="true"===e.regEx.toLowerCase()),"string"==typeof e.caseSensitive&&(e.caseSensitive="true"===e.caseSensitive.toLowerCase()),"string"==typeof e.nameSearch&&(e.nameSearch="true"===e.nameSearch.toLowerCase()),void 0!==e.fileNamePatterns&&(e.fileNamePatterns=r.getFileNamePatternsArray(e.fileNamePatterns))},r.getFileNamePatternsArray=function(e){var t=void 0;if(e){var i=e.trim();i=i.replace(/^(\s*,\s*)+/g,""),i=i.replace(/([^\\]),(\s*,\s*)*/g,"$1/"),i=i.replace(/(\s*\/\s*)/g,"/"),i=i.replace(/\/\/+/g,"/"),i=i.replace(/\/+$/g,""),t=i.split("/")}return t},r.copySearchParams=function(e,t){var i={};for(var n in e)if(void 0!==e[n]&&null!==e[n]){if(!t&&"replace"===n)continue;i[n]=e[n]}return i},r.generateFindURLBinding=function(e,t,i,o,r){var s={find:t.searchStr,regEx:t.wildCard?!0:void 0,caseSensitive:e.caseSensitive?!0:void 0,wholeWord:e.wholeWord?!0:void 0,replaceWith:"string"==typeof o?o:void 0,atLine:"number"==typeof i?i:void 0};if(r)return s;var a=new n("{,params*}").expand({params:s});return","+a},r.convertFindURLBinding=function(e){"string"==typeof e.regEx&&(e.regEx="true"===e.regEx.toLowerCase()),"string"==typeof e.caseSensitive&&(e.caseSensitive="true"===e.caseSensitive.toLowerCase()),"string"==typeof e.wholeWord&&(e.wholeWord="true"===e.wholeWord.toLowerCase()),"string"==typeof e.atLine&&(e.atLine=parseInt(e.atLine,10))},r.replaceRegEx=function(e,t,i){var n=new RegExp(t.pattern,t.flags);return e.replace(n,i)},r.replaceStringLiteral=function(e,i,n){var o=t.parse("/"+i+"/gim");return r.replaceRegEx(e,o,n)},r.searchOnelineLiteral=function(e,t,i,n,o){for(var r,s=0,a=!1,l=[];;){if(r=t.indexOf(e.searchStr,s),0>r)break;if(n){var c=n.getLineStart(o)+r;l.push({startIndex:r,length:e.searchStrLength,start:c,end:c+e.searchStrLength})}else l.push({startIndex:r,length:e.searchStrLength});if(a=!0,i)break;s=r+e.searchStrLength}return a?l:null},r.findRegExp=function(e,t,i,n){if(!t)return null;i=i||"",i+=(-1===i.indexOf("g")?"g":"")+(-1===i.indexOf("m")?"m":"");var o=new RegExp(t,i),r=null;return r=o.exec(e.substring(n)),r&&{startIndex:r.index+n,length:r[0].length}},r.searchOnelineRegEx=function(e,t,i,n,o){for(var s=0,a=!1,l=[];;){var c=r.findRegExp(t,e.regExp.pattern,e.regExp.flags,s);if(!c)break;if(n){var d=n.getLineStart(o)+c.startIndex;c.start=d,c.end=d+c.length}if(l.push(c),a=!0,i)break;s=c.startIndex+c.length}return a?l:null},r.generateNewContents=function(e,t,i,n,o,s){if(n&&t){e||(i.contents=[]);for(var a=0;a<t.length;a++){for(var l,c,d=t[a],h=!1,u=!1,p=[],f=0,g=0;g<n.children.length;g++){var m=n.children[g].lineNumber-1;if(m===a){for(f=g,c=0;c<n.children[g].matches.length;c++)n.children[g+c].checked!==!1&&p.push(c);u=p.length>0,l=n.children[g].matches,h=!0;break}}if(h){var v;if(u){var _=r.replaceCheckedMatches(d,o,l,p,s);for(v=_.replacedStr,c=0;c<n.children[f].matches.length;c++)n.children[f+c].newMatches=_.newMatches}else for(v=d,c=0;c<n.children[f].matches.length;c++)n.children[f+c].newMatches=n.children[f+c].matches;e?i.contents[a]=v:i.contents.push(v)}else e||i.contents.push(d)}}},r.generateMatchContext=function(e,t,i){var n,o,r=[],s=2*e+1;t.length<=s?(n=0,o=t.length-1):(n=i-e,0>n?(n=0,o=n+s-1):(o=i+e,o>t.length-1&&(o=t.length-1,n=o-s+1)));for(var a=n;o>=a;a++)r.push({context:t[a],current:a===i});return r},r.splitFile=function(e){for(var t=0,i=0,n=0,o=0,r=[];;){if(-1!==t&&n>=t&&(t=e.indexOf("\r",n)),-1!==i&&n>=i&&(i=e.indexOf("\n",n)),-1===i&&-1===t){r.push(e.substring(o));break}var s=1;-1!==t&&-1!==i?t+1===i?(s=2,n=i+1):n=(i>t?t:i)+1:n=-1!==t?t+1:i+1,r.push(e.substring(o,n)),o=n}return r},r.searchWithinFile=function(e,t,n,o,s,a){var l;a&&(l=new i.TextModel(n));var c=r.splitFile(n);if((o||a)&&(t.contents=c),t){t.children=[];for(var d=0,h=0;h<c.length;h++){var u=c[h];if(u&&u.length>0){var p,f=s?u:u.toLowerCase();if(p=e.wildCard?r.searchOnelineRegEx(e,f,!1,l,h):r.searchOnelineLiteral(e,f,!1,l,h)){var g,m=h+1;if(o)for(var v=0;v<p.length;v++){var _=v+1;g={parent:t,checked:t.checked,type:"detail",matches:p,lineNumber:m,matchNumber:_,name:u,location:t.location},t.children.push(g)}else g=a?{lineNumber:m,matches:p,name:u}:{parent:t,context:r.generateMatchContext(2,c,h),checked:t.checked,type:"detail",matches:p,lineNumber:m,name:u,location:t.location},t.children.push(g);d+=p.length}}}t.totalMatches=d}},r.replaceCheckedMatches=function(e,t,i,n,o){for(var r=o,s=0,a="",l=[],c=0;c<i.length;c++){s!==i[c].startIndex&&(a+=e.substring(s,i[c].startIndex)),i[c].length&&(r=i[c].length);for(var d=!1,h=0;h<n.length;h++)if(n[h]===c){d=!0;break}d?(l.push({startIndex:a.length,length:t.length}),a+=t):(l.push({startIndex:a.length,length:r}),a+=e.substring(i[c].startIndex,i[c].startIndex+r)),s=i[c].startIndex+r}return s<e.length&&(a+=e.substring(s)),{replacedStr:a,newMatches:l}},r.fullPathNameByMeta=function(e){var t=e.length,i="";if(t>0)for(var n=t-1;n>-1;n--){var o=""===i?"":"/";i=i+o+e[n].Name}return i},r}),define("orion/crawler/searchCrawler",["i18n!orion/crawler/nls/messages","orion/i18nUtil","orion/searchUtils","orion/contentTypes","orion/uiUtils","orion/Deferred"],function(e,t,i,n,o,r){function s(t,n,o,r){this.registry=t,this.fileClient=n,this.fileLocations=[],this.fileSkeleton=[],this._hitCounter=0,this._totalCounter=0,this._searchOnName=r&&r.searchOnName,this._buildSkeletonOnly=r&&r.buildSkeletonOnly,this._fetchChildrenCallBack=r&&r.fetchChildrenCallBack,this._searchParams=o,this.searchHelper=this._searchOnName||this._buildSkeletonOnly||!this._searchParams?null:i.generateSearchHelper(o),this._location=o?o.resource:r&&r.location,this._childrenLocation=r&&r.childrenLocation?r.childrenLocation:this._location,this._reportOnCancel=r&&r.reportOnCancel,this._visitSingleFile=r&&r.visitSingleFile,this._visitSingleFile||(this._visitSingleFile=this._searchSingleFile),this._cancelMessage=r&&r.cancelMessage,this._cancelMessage||(this._cancelMessage=e.searchCancelled),this._cancelled=!1,this._statusService=this.registry.getService("orion.page.message"),this._progressService=this.registry.getService("orion.page.progress"),this._statusService&&this._statusService.setCancelFunction(function(){this._cancelFileVisit()}.bind(this))}var a=!1,l=[".git"];return s.prototype.search=function(e){this.contentTypeService=this.registry.getService("orion.core.contentTypeRegistry"),this._onSearchComplete=e,this._cancelled=!1,this._deferredArray=[];var t;return this.contentTypeService.getContentTypes().then(function(e){this.contentTypesCache=e;var i=this;return this._visitRecursively(this._childrenLocation).then(function(){return(!i._cancelled||i._reportOnCancel)&&(t=i._reportResult()),i._cancelled&&i._HandleStatus({name:"Cancel"}),(new r).resolve(t)}.bind(i),function(e){return t=i._reportResult(),i._HandleStatus(e),(new r).resolve(t)}.bind(i))}.bind(this))},s.prototype.searchName=function(e){e&&(this._searchParams=e,this.searchHelper=i.generateSearchHelper(e,!0));var t=[];if(this._cancelled=!1,this._deferredArray=[],this._sort(this.fileSkeleton),this.fileSkeleton.length>0){for(var n=0;n<this.fileSkeleton.length;n++){var o,s=this.fileSkeleton[n].Name.toLowerCase();if(o=this.searchHelper.inFileQuery.wildCard?i.searchOnelineRegEx(this.searchHelper.inFileQuery,s,!0):i.searchOnelineLiteral(this.searchHelper.inFileQuery,s,!0),o&&(t.push(this.fileSkeleton[n]),t.length>=this.searchHelper.params.rows))break}var a={numFound:t.length,docs:t};return(new r).resolve({response:a})}return(new r).resolve({response:{numFound:0,docs:[]}})},s.prototype.buildSkeleton=function(e,t){this._buildingSkeleton=!0,this.contentTypeService=this.registry.getService("orion.core.contentTypeRegistry"),this._cancelled=!1,this._deferredArray=[];var i=this;e(),this.contentTypeService.getContentTypes().then(function(e){i.contentTypesCache=e,i._visitRecursively(i._childrenLocation).then(function(){i._buildingSkeleton=!1,t()})})},s.prototype.incrementalReport=function(i,n){if(!this._cancelled){i.LastModified=i.LocalTimeStamp,this.fileLocations.push(i),this._hitCounter++,n&&this._sort(this.fileLocations);var o={numFound:this.fileLocations.length,docs:this.fileLocations};this._onSearchComplete({response:o},!0),this._statusService&&this._statusService.setProgressResult({Message:t.formatMessage(e.filesFound,this._hitCounter,this._totalCounter)},e.Cancel)}},s.prototype.addTotalCounter=function(e){e||(e=1),this._totalCounter=this._totalCounter+e},s.prototype.isCancelled=function(){return this._cancelled},s.prototype._contains=function(e,t){return-1!==(e||[]).indexOf(t)},s.prototype._sort=function(e){e.sort(function(e,t){var i,n;if(this._searchParams&&"Path asc"===this._searchParams.sort){var r=e.Location&&e.Location.toLowerCase();i=o.path2FolderName(r,e.Name&&e.Name.toLowerCase(),!0);var s=t.Location&&t.Location.toLowerCase();return n=o.path2FolderName(s,t.Name&&t.Name.toLowerCase(),!0),n>i?-1:i>n?1:this._sortOnNameSingle(e,t)}return this._sortOnNameSingle(e,t)}.bind(this))},s.prototype._HandleStatus=function(e){this._statusService&&"Cancel"===e.name&&(a&&console.log("Crawling search cancelled. Deferred array length : "+this._deferredArray.length),this._statusService.setProgressResult({Message:this._cancelMessage,Severity:"Warning"}))},s.prototype._reportResult=function(){this._sort(this.fileLocations);var e={numFound:this.fileLocations.length,docs:this.fileLocations},t={response:e};return this._onSearchComplete(t),t},s.prototype._sortOnNameSingle=function(e,t){var i=e.Name&&e.Name.toLowerCase(),n=t.Name&&t.Name.toLowerCase();return n>i?-1:i>n?1:0},s.prototype._fileNameMatches=function(e){var t=!0;return this.searchHelper&&this.searchHelper.params.fileNamePatterns&&(t=this.searchHelper.params.fileNamePatterns.some(function(t){var i="^"+t.replace(/([*?])/g,".$1")+"$";return e.match(i)})),t},s.prototype._visitRecursively=function(e){var t=[],i=this;return this._fetchChildrenCallBack&&this._fetchChildrenCallBack(e),(i._progressService?this._progressService.progress(i.fileClient.fetchChildren(e),"Crawling search for children of "+e):i.fileClient.fetchChildren(e)).then(function(e){for(var o=0;o<e.length;o++)if(void 0!==e[o].Directory&&e[o].Directory===!1){if(i._searchOnName)t.push(i._buildSingleSkeleton(e[o]));else if(i._buildSkeletonOnly)t.push(i._buildSingleSkeleton(e[o]));else if(!i._cancelled){var s=n.getFilenameContentType(e[o].Name,i.contentTypesCache),a=n.isImage(s)||n.isBinary(s);if(!a&&i._fileNameMatches(e[o].Name)){var c=i._visitSingleFile(i,e[o],s);t.push(c),i._deferredArray.push(c)}}}else if(e[o].Location){if(i._cancelled)break;if(i._contains(l,e[o].Name))continue;var d=i._visitRecursively(e[o].ChildrenLocation);t.push(d),i._deferredArray.push(d)}return r.all(t)})},s.prototype._hitOnceWithinFile=function(e){var t,n=this._searchParams.caseSensitive?e:e.toLowerCase();return t=this.searchHelper.inFileQuery.wildCard?i.searchOnelineRegEx(this.searchHelper.inFileQuery,n,!0):i.searchOnelineLiteral(this.searchHelper.inFileQuery,n,!0)},s.prototype._cancelFileVisit=function(){this._cancelled=!0,this._cancelled&&this._deferredArray.forEach(function(e){e.cancel()})},s.prototype._searchSingleFile=function(e,t){this.addTotalCounter();var i=this;if(!this._cancelled)return""!==this.searchHelper.params.keyword?(i._progressService?i._progressService.progress(i.fileClient.read(t.Location),"Reading file "+t.Location):i.fileClient.read(t.Location)).then(function(e){i._hitOnceWithinFile(e)&&i.incrementalReport(t,!0)},function(e){e&&e.message&&"cancel"!==e.message.toLowerCase()&&console.error("Error loading file content: "+e.message)}):void this.incrementalReport(t,!0)},s.prototype._buildSingleSkeleton=function(e){this.addTotalCounter(),this.fileSkeleton.push(e);var t=new r;return t.resolve(this._totalCounter),t},s.prototype.constructor=s,{SearchCrawler:s}}),define("orion/gSearchClient",["orion/fileClient","orion/Deferred","orion/crawler/searchCrawler","orion/searchUtils"],function(e,t,i,n){function o(t){this._registry=t.serviceRegistry,this._fileClient=t.fileClient,this._fileClient||(this._fileClient=new e.FileClient(this._registry))}return o.prototype={search:function(e,i,n){var o=new t;try{this._searchDeferred=this._fileClient.search(e),this._searchDeferred.then(function(t){this._searchDeferred=null;var r=this.convert(t,e);this._generateMatches(e,r,i).then(function(){this._generateMeta(r,n).then(function(){o.resolve(r)})}.bind(this))}.bind(this),function(e){this._searchDeferred=null,o.reject(e)}.bind(this))}catch(r){var s=r.message||r;if(!("string"==typeof s&&s.toLowerCase().indexOf("search")>-1))throw s;this._crawler||(this._crawler=this._createCrawler(e)),e.nameSearch?this._crawler.searchName(e).then(function(t){this._searchDeferred=null,o.resolve(this.convert(t,e))}.bind(this)):this._crawler.search(function(){o.progress(arguments[0],arguments[1])}).then(function(t){this._searchDeferred=null,o.resolve(this.convert(t,e))}.bind(this))}return o},_generateSingle:function(e,t){return this._fileClient.read(e.location).then(function(i){return n.searchWithinFile(t.inFileQuery,e,i,!1,t.params.caseSensitive,!0),e}.bind(this),function(e){var t=this._registry.getService("orion.page.message");t&&t.setProgressResult({Message:e.message,Severity:"Error"})}.bind(this))},_generateMatches:function(e,i,o){if(!o||0===i.length)return(new t).resolve(i);var r=n.generateSearchHelper(e),s=[];return i.forEach(function(e){s.push(this._generateSingle(e,r))}.bind(this)),t.all(s,function(e){return{_error:e}})},_generateSingleMeta:function(e){return this._fileClient.read(e.location,!0).then(function(t){return e.metadata=t,e}.bind(this),function(e){var t=this._registry.getService("orion.page.message");t&&t.setProgressResult({Message:e.message,Severity:"Error"})}.bind(this))},_generateMeta:function(e,i){if(!i||0===e.length)return(new t).resolve(e);var n=[];return e.forEach(function(e){n.push(this._generateSingleMeta(e))}.bind(this)),t.all(n,function(e){return{_error:e}})},convert:function(e,t){var i=[],n=this._fileClient.fileServiceRootURL(t.resource);if(e.response.numFound>0)for(var o=0;o<e.response.docs.length;o++){var r=e.response.docs[o];if(!r.Directory){var s=r.Location,a=r.Path;a||(a=s.substring(n?n.length:0)),i.push({location:s,path:a,name:r.Name})}}return i},cancel:function(){return this._searchDeferred?this._searchDeferred.cancel():(new t).resolve()},_createCrawler:function(e,t){return this._crawler=new i.SearchCrawler(this._registry,this._fileClient,e,t),this._crawler}},o.prototype.constructor=o,{GSearchClient:o}}),define("orion/explorers/navigationUtils",[],function(){function e(e,t){o||e&&(e.push({domNode:t}),t.style.outline="none")}function t(t,i,n){if(t){var o=t.getGridNavHolder(i,!0);o&&e(o,n)}}function i(e,t){if(e)for(var i=0;i<e.length;i++)if(e[i].domNode===t)return void e.splice(i,1)}var n=navigator.userAgent,o=-1!==n.indexOf("iPad");return{addNavGrid:t,generateNavGrid:e,removeNavGrid:i}}),define("orion/bidiUtils",[],function(){function e(){var e;window.dojoConfig&&(e=window.dojoConfig.locale),e||(e=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage);var t=-1!="ar iw he".indexOf(e.substring(0,2));if(t){var i=document.getElementsByTagName("html")[0];i&&i.setAttribute("dir","rtl")}}function t(){var e=localStorage.getItem(s);return e&&"true"==e?!0:!1}function i(){var e=localStorage.getItem(a);return!e||"rtl"!=e&&"ltr"!=e&&"auto"!=e?"ltr":e}function n(e){return"auto"==h?r(e):h}function o(e){if(e.trim()){var t="auto"==h?r(e):h;return("ltr"==t?l:d)+e+c}return e}function r(e){var t=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(e);return t?t[0]<="z"?"ltr":"rtl":"ltr"}e();var s="/orion/preferences/bidi/bidiEnabled",a="/orion/preferences/bidi/bidiLayout",l="‪",c="‬",d="‫",t=t(),h=i();return{isBidiEnabled:t,getTextDirection:n,enforceTextDirWithUcc:o}}),define("orion/explorers/navigatorRenderer",["i18n!orion/navigate/nls/messages","orion/Deferred","orion/explorers/explorer","orion/explorers/navigationUtils","orion/extensionCommands","orion/objects","orion/URITemplate","orion/contentTypes","orion/webui/littlelib","orion/bidiUtils"],function(e,t,i,n,o,r,s,a,l,c){function d(e,t,i,n){var o;if(e){var r=e.imageClass,s=e.image;r?(o=document.createElement("span"),o.className+=r,o.classList.add("thumbnail")):s&&(o=document.createElement("img"),o.src=s,o.classList.add("thumbnail")),o&&t.replaceChild(o,n)}return o?o:n}function h(){return f}function u(e,i,n,l,h,u,p,g,v){i=r.clone(i);var _,y=i.Name||"";if(c.isBidiEnabled&&(y=c.enforceTextDirWithUcc(y)),i.Directory){_=document.createElement("a"),_.className="navlinkonpage";var C=e?new s(e+"#{,resource,params*}"):m;_.href=C.expand({resource:i.ChildrenLocation}),i.Name&&_.appendChild(document.createTextNode(y))}else{h||(h=o.getOpenWithCommands(n)),_=document.createElement("a"),_.className="navlink targetSelector",u&&"object"==typeof u&&Object.keys(u).forEach(function(e){_[e]=u[e]});var w=null,b=null;w=g?g.holderDom:_,w&&(b=document.createElement("span"),b.className="core-sprite-file modelDecorationSprite thumbnail",w.appendChild(b)),i.Name&&_.appendChild(document.createTextNode(y));var S=i.Location;p&&"object"==typeof p&&(i.params={},r.mixin(i.params,p));var x=o.getOpenWithCommand(n,i,h);x&&"function"==typeof x.hrefCallback&&(S=x.hrefCallback({items:i})),t.when(l.getFileContentType(i),function(e){var t;w&&(t=d(e,w,i.Location,b)),_.href=S,v&&"function"==typeof v.updateFileNode&&v.updateFileNode(i,_,a.isImage(e),t)})}return _.addEventListener("click",function(){f=i}.bind(this),!1),_}function p(e,t,i,n){this.explorer=t,this.commandService=i,this.contentTypeService=n,this.openWithCommands=null,this.actionScopeId=e.actionScopeId,this._init(e)}var f,g=60,m=new s("#{,resource,params*}");return p.prototype=new i.SelectionRenderer,p.prototype.wrapperCallback=function(e){e.setAttribute("role","tree")},p.prototype.tableCallback=function(t){t.setAttribute("aria-label",e.Navigator),t.setAttribute("role","presentation")},p.prototype.rowCallback=function(e){e.setAttribute("role","treeitem")},p.prototype.emptyCallback=function(t){var i=document.createElement("tr"),n=document.createElement("td");n.colSpan=this.oneColumn?1:3;var o=document.createElement("div");o.classList.add("noFile"),o.textContent=e.NoFile;var r=document.createElement("span");r.appendChild(document.createTextNode(e.File)),l.processDOMNodes(o,[r]),n.appendChild(o),i.appendChild(n),t.appendChild(i)},p.prototype.getDisplayTime=function(e){return new Date(e).toLocaleString()},p.prototype.getCommitRenderer=function(){return null},p.prototype.getCellHeaderElement=function(e){if(this.oneColumn&&0!==e)return null;switch(e){case 0:case 1:case 2:var t=document.createElement("th");t.style.height="8px"}},p.prototype.getFolderImage=function(){if(!this.showFolderImage)return null;var e=document.createElement("span");return e.className="core-sprite-folder modelDecorationSprite",e},p.prototype.createFolderNode=function(e){var t;if(this.showFolderLinks){t=u(this.folderLink||"",e,this.commandService,this.contentTypeService);var i=this.getFolderImage(e);i&&t.insertBefore(i,t.firstChild)}else t=document.createElement("span"),t.textContent=e.Name;return t},p.prototype.updateFileNode=function(){},p.prototype.showFolderLinks=!0,p.prototype.getCellElement=function(e,t,i){var r=t.LastCommit?2:1,s=t.LastCommit?3:2,a=t.LastCommit?1:-1;switch(e){case 0:var l=document.createElement("td"),c=document.createElement("span");c.id=i.id+"MainCol",c.setAttribute("role","presentation"),l.appendChild(c),l.setAttribute("role","presentation"),c.className="mainNavColumn";var d;return t.Directory?(this.getExpandImage(i,c),d=this.createFolderNode(t),c.appendChild(d),this.explorer._makeDropTarget(t,d),this.explorer._makeDropTarget(t,i)):(this.openWithCommands||(this.openWithCommands=o.getOpenWithCommands(this.commandService)),d=u("",t,this.commandService,this.contentTypeService,this.openWithCommands,null,null,null,this),c.appendChild(d)),d&&(d.id=i.id+"NameLink",1===d.nodeType&&(n.addNavGrid(this.explorer.getNavDict(),t,d),d.setAttribute("role","link"),d.setAttribute("tabindex","-1"))),this.actionScopeId&&this.commandService.renderCommands(this.actionScopeId,c,t,this.explorer,"tool",null,!0),l;
case r:if(this.oneColumn)return null;var h=document.createElement("td");return t.LocalTimeStamp&&(h.textContent=this.getDisplayTime(t.LocalTimeStamp)),h;case s:if(this.oneColumn)return null;var p=document.createElement("td");if(!t.Directory&&"number"==typeof t.Length){var f=parseInt(t.Length,10),m=f/1024;p.textContent=Math.ceil(m).toLocaleString()+" KB"}return p.style.textAlign="right",p;case a:if(this.oneColumn||!t.LastCommit)return null;var v=document.createElement("td"),_=this.getCommitRenderer(v,t.LastCommit);return _&&_.renderSimple(g),v}},p.prototype.constructor=p,{NavigatorRenderer:p,getClickedItem:h,createLink:u}}),define("orion/webui/dialog",["orion/webui/littlelib","orion/uiUtils"],function(e,t){function i(){}var n={dialog:null};return i.prototype={DISABLED:"disabled",CONTAINERTEMPLATE:'<div class="dialog" role="dialog"><div class="dialogTitle"><span id="title" class="dialogTitleText layoutLeft"></span><button aria-label="Close" class="dismissButton layoutRight core-sprite-close imageSprite" id="closeDialog"></button></div><div id="dialogContent" class="dialogContent layoutBlock"></div><div id="buttons" class="dialogButtons"></div></div>',_initialize:function(){var t=document.body;this.$frameParent=t,this.$$modalExclusions=this.$$modalExclusions||[];var i=document.createRange();i.selectNode(t);var n=i.createContextualFragment(this.CONTAINERTEMPLATE);t.appendChild(n),this.$frame=t.lastChild,this.title&&e.$("#title",this.$frame).appendChild(document.createTextNode(this.title)),this.$close=e.$("#closeDialog",this.$frame);var o=this;this.$close.addEventListener("click",function(){o.hide()},!1),this.$parent=e.$(".dialogContent",this.$frame),i=document.createRange(),i.selectNode(this.$parent);var r=i.createContextualFragment(this.TEMPLATE);this.messages&&e.processTextNodes(r,this.messages),this.$parent.appendChild(r),this.$buttonContainer=e.$(".dialogButtons",this.$frame),this._makeButtons(),this.$frame.addEventListener("keydown",function(t){t.keyCode===e.KEY.ESCAPE?o.hide():t.keyCode===e.KEY.ENTER&&"function"==typeof o._defaultCallback&&o._defaultCallback()},!1),this._bindElements(this.$parent),"function"==typeof this._bindToDom&&this._bindToDom(this.$parent)},_makeButtons:function(){if(this.$buttonContainer&&Array.isArray(this.buttons)){var e=this;this.buttons.forEach(function(i){var n=t.createButton(i.text,i.callback);i.id&&(n.id=i.id,e["$"+n.id]=n),i.isDefault&&(e._defaultCallback=i.callback,e._defaultButton=n,n.classList.add("primaryButton")),e.$buttonContainer.appendChild(n)})}},_makeModal:function(){var t=this;this.$frame.addEventListener("blur",function(e){t.$lastFocusedElement=e.target},!0),this._modalListener=function(i){var n=!e.contains(t.$frame,i.target);if(n)for(var o=0;o<t.$$modalExclusions.length;o++)if(e.contains(t.$$modalExclusions[o],i.target)){n=!1;break}n&&(window.setTimeout(function(){(t.$lastFocusedElement||t.$parent).focus()},0),e.stop(i))},this.$frameParent.addEventListener("focus",this._modalListener,!0),this.$frameParent.addEventListener("click",this._modalListener,!0);var i=this.$frameParent.childNodes,n=!1;this._addedBackdrop=[];for(var o=0;o<i.length;o++){for(var r=0;r<this.$$modalExclusions.length;r++)if(e.contains(this.$$modalExclusions[r],i[o])){n=!0;break}if(!n&&i[o]!==t.$frame&&i[o].classList&&!i[o].classList.contains("tooltipContainer")){var s=i[o];s.classList.contains("modalBackdrop")||(s.classList.add("modalBackdrop"),this._addedBackdrop.push(s))}}var a=e.lastTabbable(this.$buttonContainer)||e.lastTabbable(this.$parent);a&&a.addEventListener("keydown",function(i){if(i.keyCode===e.KEY.TAB){var n=t._getFirstFocusField();n&&n!==i.target&&n.focus(),e.stop(i)}},!1)},_addChildDialog:function(e){this.$$modalExclusions.push(e.$frame||e.$parent)},_inModalExclusion:function(e){return this.$$modalExclusions.some(function(t){return e.$frame===t||e.$parent===t})},_bindElements:function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];i.id&&(this["$"+i.id]=i),this._bindElements(i)}},hide:function(t){var i=document.activeElement,o=this.$frameParent===i||0!==(16&this.$frameParent.compareDocumentPosition(i)),r=this.$originalFocus;t||n.dialog!==this||(n.dialog=null),"function"==typeof this._beforeHiding&&this._beforeHiding(),this._modalListener&&(this.$frameParent.removeEventListener("focus",this._modalListener,!0),this.$frameParent.removeEventListener("click",this._modalListener,!0)),this.$frame.classList.remove("dialogShowing"),e.setFramesEnabled(!0),"function"==typeof this._afterHiding&&this._afterHiding(),o&&r&&1!==document.compareDocumentPosition(r)&&r.focus();var s=this;this.keepAlive||window.setTimeout(function(){s.destroy()},0)},show:function(t){if(this.modal)if(this._makeModal(),n.dialog){if(!n.dialog._inModalExclusion(this))return void this.hide(!0)}else n.dialog=this;"function"==typeof this._beforeShowing&&this._beforeShowing(),e.setFramesEnabled(!1);var i,o,r=e.bounds(this.$frame),s=e.bounds(document.documentElement);if(t){var a=e.bounds(t);o=a.top+a.height+4,i=a.left+4,o+r.height>s.height&&(o=Math.max(0,s.height-r.height-4)),i+r.width>s.width&&(i=Math.max(0,s.width-r.width-4))}else i=Math.max(0,(s.width-r.width)/2),o=Math.max(0,(s.height-r.height)/2);if(this.$lastFocusedElement=this.$originalFocus=document.activeElement,this.$frame.style.top=o+"px",this.$frame.style.left=i+"px",this.$frame.classList.add("dialogShowing"),"function"==typeof this._afterShowing&&this._afterShowing(),!this.customFocus){var l=this._getFirstFocusField();l.focus()}},_getFirstFocusField:function(){return e.firstTabbable(this.$parent)||this._defaultButton||e.firstTabbable(this.$buttonContainer)||this.$close},destroy:function(){this.$frame&&(n.dialog===this&&(n.dialog=null),e.setFramesEnabled(!0),this._addedBackdrop&&this._addedBackdrop.length>0&&this._addedBackdrop.forEach(function(e){e.classList.remove("modalBackdrop")}),this.$frameParent.removeEventListener("focus",this._modalListener,!0),this.$frameParent.removeEventListener("click",this._modalListener,!0),this.$frameParent.removeChild(this.$frame),this.$frame=void 0,this.$parent=void 0)}},i.prototype.constructor=i,{Dialog:i}}),define("orion/webui/dialogs/OpenResourceDialog",["i18n!orion/widgets/nls/messages","i18n!orion/search/nls/messages","orion/extensionCommands","orion/gSearchClient","orion/i18nUtil","orion/searchUtils","orion/explorers/navigatorRenderer","orion/contentTypes","require","orion/webui/littlelib","orion/util","orion/webui/dialog","orion/metrics","orion/Deferred"],function(e,t,i,n,o,r,s,a,l,c,d,h,u,p){function f(e,t){this.serviceRegistry=e,this.commandRegistry=t,this.openWithCommands=null}function g(e){this._init(e)}return f.prototype.makeRenderFunction=function(e,n,a,d,h){function u(i,u,f,v){return p.when(m.openWithCommands,function(p){if(f){c.empty(n);var m=document.createElement("div");return m.appendChild(document.createTextNode(t["Search failed."])),n.appendChild(m),void("function"==typeof d&&d(n))}var _=function(){function e(e,t){var i=t.folderName?t.folderName:t.path,n=document.createElement("span");n.id=i.replace(/[^a-zA-Z0-9_\.:\-]/g,""),n.appendChild(document.createTextNode(" - "+i+" ")),e.appendChild(n)}function t(t,n){var o=n.name;if(i.hasOwnProperty(o)){e(t,n);var r=i[o];"function"==typeof r&&(i[o]=null,r())}else i[o]=function(){e(t,n)}}var i={};return t}(),y=!1;if(c.empty(n),i&&i.length>0){var C=document.createElement("table");C.setAttribute("role","presentation");for(var w=0;w<i.length;w++){var b,S=i[w];if(!y&&(y=!0,a)){var x=C.insertRow(0);b=x.insertCell(0),b.textContent=a}var L=C.insertRow(-1);b=L.insertCell(0),b.colspan=2,h&&h(b);var T={Name:S.name,Location:S.location},E=null;if("number"==typeof S.LineNumber&&(E={},E.line=S.LineNumber),v&&v.keyword&&!v.nameSearch){var k=r.generateSearchHelper(v);E=E||{},E.find=k.inFileQuery.searchStr,E.regEx=k.inFileQuery.wildCard?!0:void 0}var N=s.createLink(l.toUrl("edit/edit.html"),T,g,e,p,{"aria-describedby":(S.folderName?S.folderName:S.path).replace(/[^a-zA-Z0-9_\.:\-]/g,""),style:{verticalAlign:"middle"}},E);S.LineNumber&&N.appendChild(document.createTextNode(" (Line "+S.LineNumber+")")),b.appendChild(N),_(b,S)}n.appendChild(C),"function"==typeof d&&d(n)}if(!y&&u){var A=o.formatMessage(t.NoMatchFound,u);c.empty(n),n.appendChild(document.createTextNode(A)),"function"==typeof d&&d(n)}})}var f=this.serviceRegistry,g=this.commandRegistry;this.openWithCommands=this.openWithCommands||i.createOpenWithCommands(f,e,g);var m=this;return u},g.prototype=new h.Dialog,g.prototype.TEMPLATE='<div role="search"><div><label id="fileNameMessage" for="fileName">${Type the name of a file to open (? = any character, * = any string):}</label></div><div><input id="fileName" type="text" class="openResourceDialogInput" style="min-width: 25em; width:90%;"/></div><div><label for="searchScope"><input id="searchScope" type="checkbox" style="width: auto" class="openResourceDialogInput"/>${Search all Projects}</label></input></div><div id="progress" style="padding: 2px 0 0; width: 100%;"><img src="'+l.toUrl("../../../images/progress_running.gif")+'" class="progressPane_running_dialog" id="crawlingProgress"></img></div><div id="results" style="max-height:250px; height:auto; overflow-y:auto;" aria-live="off"></div><div id="statusbar"></div></div>',g.prototype._init=function(t){if(this.title=t.title||e.FindFileNamed,this.modal=!0,this.messages=e,this.serviceRegistry=t.serviceRegistry,this.commandRegistry=t.commandRegistry,this._searcher=t.searcher,this._progress=t.progress,this._onHide=t.onHide,this._contentTypeService=new a.ContentTypeRegistry(this.serviceRegistry),!this._searcher)throw new Error("Missing required argument: searcher");if(this._searchDelay=t.searchDelay||500,this._time=0,this._forceUseCrawler=!1,this._initialText=t.initialText,this._message=t.message,this._nameSearch=!0,void 0!==t.nameSearch&&(this._nameSearch=t.nameSearch),this._searchOnRoot=!1,this._fileClient=this._searcher.getFileService(),!this._fileClient)throw new Error(e["Missing required argument: fileService"]);this._gSearchClient=new n.GSearchClient({serviceRegistry:this.serviceRegistry,fileClient:this._fileClient}),this._searchRenderer=new f(this.serviceRegistry,this.commandRegistry),this._initialize()},g.prototype._bindToDom=function(t){var i=this,n=this.getSearchPref();this.$searchScope.checked=n,this.updateTitle(),this.$searchScope.addEventListener("click",function(){u.logEvent("preferenceChange","searchScope",null,this.$searchScope.checked?0:1),localStorage.setItem("/searchScope",this.$searchScope.checked),this.updateTitle(),this.doSearch()}.bind(this)),i.$crawlingProgress.style.display="none",this._nameSearch?this.$fileName.setAttribute("placeholder",e["FileName FolderName"]):this.$fileName.setAttribute("placeholder",e.Search),this.$fileName.addEventListener("input",function(){i._time=+new Date,i._timeoutId&&clearTimeout(i._timeoutId),i._timeoutId=setTimeout(i.checkSearch.bind(i),0)},!1),this.$fileName.addEventListener("keydown",function(e){if(e.keyCode===c.KEY.ENTER){var t=c.$("a",i.$results);t&&(c.stop(e),(d.isMac?e.metaKey:e.ctrlKey)?window.open(t.href):(window.location.href=t.href,i.hide()))}},!1),t.addEventListener("keydown",function(e){var t,n,o,r,s,a=function(e,t,i){return t<e.length-1?e[t+1]:i},l=function(e,t,i){return t>0?e[t-1]:i};(e.keyCode===c.KEY.DOWN||e.keyCode===c.KEY.UP)&&(t=c.$$array("a",i.$results),o=document.activeElement,r=t.indexOf(o),e.keyCode===c.KEY.DOWN?r>=0?(o.classList.remove("treeIterationCursor"),s=a(t,r,t[0]),s.focus(),s.classList.add("treeIterationCursor")):t.length>0&&(s=a(t,-1,t[0]),s.focus(),s.classList.add("treeIterationCursor")):r>=0?(o.classList.remove("treeIterationCursor"),n=i.$fileName,s=l(t,r,n),s.focus(),r>0&&s.classList.add("treeIterationCursor")):t.length>0&&(t[t.length-1].focus(),t[t.length-1].classList.add("treeIterationCursor")),c.stop(e))}),t.addEventListener("mouseup",function(e){e.target.focus()},!1),setTimeout(function(){if(i._forceUseCrawler||!i._fileClient.getService(i._searcher.getSearchLocation()).search){var t=i._searchOnRoot?i._searcher.getSearchRootLocation():i._searcher.getChildrenLocation();i._crawler=i._gSearchClient._createCrawler({resource:t},{searchOnName:!0}),i._crawler.buildSkeleton(function(){i.$crawlingProgress.style.display="inline",i.$progress.appendChild(document.createTextNode(e["Building file skeleton..."]))},function(){i.$crawlingProgress.style.display="none",i.$progress.removeChild(i.$progress.lastChild)})}},0),this._message&&(this.$fileNameMessage.removeChild(this.$fileNameMessage.firstChild),this.$fileNameMessage.appendChild(document.createTextNode(this._message))),this._initialText&&(this.$fileName.value=this._initialText,this.doSearch())},g.prototype.updateTitle=function(){var t,i,n=this.$searchScope.checked;n?(i=e.FileFileGlobal,t=e.FindFileGlobal):(i="'"+this._searcher.getSearchLocationName()+"'",t=d.formatMessage(this.title,i));var o=c.$("span",this.$frame);o.textContent=t,this.forcedGlobalSearch()&&(this.$searchScope.parentNode.style.display="none")},g.prototype.checkSearch=function(){clearTimeout(this._timeoutId);var e=(new Date).getTime();e-this._time>this._searchDelay?(this._time=e,this.doSearch()):this._timeoutId=setTimeout(this.checkSearch.bind(this),50)},g.prototype.forcedGlobalSearch=function(){var e=this._searcher.getSearchLocation(),t=this._searcher.getSearchRootLocation();return e===t},g.prototype.getSearchPref=function(){if(this.forcedGlobalSearch())return!0;var e="true"===localStorage.getItem("/searchScope");return e},g.prototype._detectFolderKeyword=function(e){var t,i,n=e,o=null;return this._nameSearch&&(t=/(\S+)\s*(.*)/,i=t.exec(e),i&&3===i.length&&(i[1]&&(n=i[1]),i[2]&&(o=i[2]))),{keyword:n,folderKeyword:o}},g.prototype.doSearch=function(){var t=this.$fileName.value;if(t){var i=this._detectFolderKeyword(t);this._searchOnRoot=this.$searchScope.checked;var n=this._searcher.createSearchParams(i.keyword,this._nameSearch,this._searchOnRoot),o=this._searchRenderer.makeRenderFunction(this._contentTypeService,this.$results,!1,this.decorateResult.bind(this));this.currentSearch=o;var r=document.createElement("div");r.appendChild(document.createTextNode(this._nameSearch?e["Searching..."]:d.formatMessage(e.SearchOccurences,t))),c.empty(this.$results),this.$results.appendChild(r);var s;this._searchPending?(s=this._gSearchClient.cancel(),this.cancelled=!0):s=(new p).resolve(),s.then(function(){this._searchPending=!0,this._gSearchClient.search(n).then(function(e){if(this._searchPending=!1,o===this.currentSearch||this.cancelled){this.cancelled=!1;var t=e.filter(function(e){return i.folderKeyword?e.path.indexOf(i.folderKeyword)>=0:!0});o(t,n.keyword,null,n)}}.bind(this),function(e){o(null,null,e,null)}.bind(this))}.bind(this))}},g.prototype.decorateResult=function(e){function t(e){0!==e.button||e.ctrlKey||e.metaKey||i.hide()}for(var i=this,n=c.$$array("a",e),o=0;o<n.length;o++){var r=n[o];r.addEventListener("click",t,!1)}},g.prototype._beforeHiding=function(){clearTimeout(this._timeoutId)},g.prototype._afterHiding=function(){this._onHide&&this._onHide()},g.prototype.constructor=g,{OpenResourceDialog:g}}),define("text!orion/banner/banner.html",[],function(){return'<header id="banner" role="banner" class="headerLayout">\n	<nav id=\'navbar\'></nav>\n	<div id="notificationArea" class="notificationHide">\n		<div class="notifications" id="notifications" aria-live="assertive" aria-atomic="true"></div>\n		<div class="layoutRight"><button type="button" aria-label="Close" class="dismissButton layoutRight core-sprite-close imageSprite" id="closeNotifications"></span></div>\n	</div>\n</header>\n'}),define("orion/banner/banner",["i18n!orion/nls/messages","orion/webui/littlelib","text!orion/banner/banner.html","text!jconfig/jazzhuburl"],function(e,t,i,n){function o(){}return o.prototype.create=function(o){if(!document.getElementById("banner")){var r=document.createRange();r.selectNode(o);var s=r.createContextualFragment(i);t.processTextNodes(s,e),o.firstChild?o.insertBefore(s,o.firstChild):o.appendChild(s)}if(!document.getElementById("navbar.js")&&!document.getElementById("navbar.css")){var a=new URL("/api/v1/composition/js/header/navbar.js",n),l=new URL("/api/v1/composition/css/header/navbar.css",n),c=document.createElement("link");c.id="navbar.css",c.setAttribute("rel","stylesheet"),c.setAttribute("type","text/css"),c.setAttribute("href",l.href),c.onload=function(){var e=document.createElement("script");e.id="navbar.js",e.type="text/javascript",e.src=a.href,document.getElementsByTagName("head")[0].appendChild(e)},document.getElementsByTagName("head")[0].appendChild(c)}},o}),define("text!orion/banner/toolbar.html",[],function(){return'<div class="layoutLeft runBar"></div>\n<ul class="layoutLeft commandList pageActions" id="globalActions"></ul>\n<ul class="layoutLeft commandList pageActions" id="pageActions"></ul>\n<ul class="layoutLeft commandList pageActions" id="selectionTools"></ul>\n<ul class="layoutLeft commandList pageActions" id="navActions"></ul>\n<div class="layoutLeft" style="padding-left:7px;padding-right:7px;margin-top:2px;" id="filterBox" style="visibility: hidden;"></div>\n<div class="layoutFlexStretch"></div>\n<div class="layoutRight status" id="statusPane" role="status" aria-live="off"></div>\n<div class="layoutRight progressWatch" id="progressPane" tabindex="0" role="progressbar">\n	<div id="watchButton" class="watchButton"></div>\n	<div id="watchBody" class="watchBody">\n		<span class="hand longMinute">\n			<span class="darkSide"></span>\n		</span>\n		<span class="hand longHour">\n			<span class="darkSide"></span>\n		</span>\n	</div>\n</div>\n<ul class="layoutRight commandList pageActions" id="pageNavigationActions"></ul>\n<ul class="layoutRight commandList pageActions" id="settingsActions"></ul>\n<ul class="layoutRight commandList pageActions userMenu" id="userMenu">\n	<li>\n		<button id="userTrigger" class="dropdownTrigger commandImage">\n			<span class="commandSprite core-sprite-silhouette"></span>\n		</button>\n		<ul id="userDropdown" class="dropdownMenu" role="menu"></ul>\n	</li>\n</ul>\n'}),define("orion/widgets/input/DropDownMenu",["orion/objects","orion/webui/littlelib"],function(e,t){function i(e,i,n){var o=t.node(e);if(!o)throw new Error("Parent node of dropdown menu not found");this._parent=o,n=n||{},this.options=n,this.navDropDownId=this._parent.id+"_navdropdown",this.selectionClass=n.selectionClass;var r=document.createElement("div");if(r.classList.add("dropdownMenu"),r.classList.add("dropdownMenuOpen"),r.id=this.navDropDownId,r.style.display="none",this._parent.appendChild(r),this._dropdownMenu=r,i=t.node(i),!i)throw"Trigger node of dropdown menu not found";this._triggerNode=i,"hidden"===this._triggerNode.style.visibility&&(this._triggerNode.style.visibility="visible"),n.noClick||(this._triggerNode.onclick=this.click.bind(this)),this._dropdownMenu.addEventListener("keydown",function(e){e.keyCode===t.KEY.ESCAPE&&this.clearPanel()}.bind(this))}return e.mixin(i.prototype,{click:function(){"none"===this._dropdownMenu.style.display?this.updateContent(this.getContentNode(),function(){t.setFramesEnabled(!1),this._dropdownMenu.style.display="",this._positionDropdown(),this.selectionClass&&this._triggerNode.classList.add(this.selectionClass),this.handle=t.addAutoDismiss([this._triggerNode,this._dropdownMenu],this.clearPanel.bind(this)),this.options.onShow&&this.options.onShow()}.bind(this)):this.clearPanel()},clearPanel:function(){this.isVisible()&&(this._dropdownMenu.style.display="none",t.setFramesEnabled(!0),this.selectionClass&&this._triggerNode.classList.remove(this.selectionClass),this.options.onHide&&this.options.onHide())},addContent:function(e){this._dropdownMenu.innerHTML=e},getContentNode:function(){return this._dropdownMenu},updateContent:function(e,t){t()},_positionDropdown:function(){this._dropdownMenu.style.right="";var e=t.bounds(this._dropdownMenu),i=t.bounds(document.body);if(e.left+e.width>i.left+i.width){var n=t.bounds(this._boundingNode(this._triggerNode)),o=t.bounds(this._triggerNode);this._dropdownMenu.style.right=n.width-(o.left-n.left+o.width)+"px"}},_boundingNode:function(e){var t=window.getComputedStyle(e,null);if(null===t)return e;var i=t.getPropertyValue("position");return"absolute"!==i&&e.parentNode&&e!==document.body?this._boundingNode(e.parentNode):e},isDestroyed:function(){return!this._dropdownMenu.parentNode},isVisible:function(){return"none"!==this._dropdownMenu.style.display&&!this.isDestroyed()},focus:function(){this._dropdownMenu.focus()},destroy:function(){this._parent&&(t.setFramesEnabled(!0),t.empty(this._parent),this._parent=this.select=null)}}),i}),define("orion/jazzui/widgets/input/CaretDropDownMenu",["orion/webui/littlelib","orion/widgets/input/DropDownMenu"],function(e,t){function i(e,i,n){if(this.caretClass=n.caret,this.label=n.label,t.apply(this,Array.prototype.slice.call(arguments)),this.label){var o=document.createElement("div");o.id=this._parent.id+"_navigationLabel",o.className="navigationLabel dropdownTrigger",o.innerHTML=this.label,this._triggerNode.appendChild(o)}if(this.caretClass){var r=document.createElement("span");r.classList.add("navdropdown"),r.classList.add(this.caretClass),this._triggerNode.appendChild(r)}}return i.prototype=Object.create(t.prototype),i}),define("orion/widgets/input/ActivityContent",["orion/objects"],function(e){function t(){}return e.mixin(t.prototype,{templateString:'<div style="float:left;"><section><nav><ul id="relatedlinks"></ul></nav></section></div>',getContentPane:function(){return this.templateString}}),t}),define("orion/widgets/input/ToolsContent",["orion/objects"],function(e){function t(){}return e.mixin(t.prototype,{templateString:'<div class="toolsNav" style="float:right;"><section><nav><ul id="navigationlinks"></ul></nav></section><ul><li class="dropdownSeparator"><span class="dropdownSeparator"></span></li></ul><section><nav><ul id="additionalLinks"></ul></nav></section></div>',getContentPane:function(){return this.templateString}}),t}),define("text!orion/webui/submenutriggerbutton.html",[],function(){return'<li class="dropdownSubMenu"><span class="dropdownTrigger dropdownMenuItem" role="menuitem" tabindex="0"><span class="dropdownCommandName">${ButtonText}</span><span class="dropdownArrowRight core-sprite-closedarrow"></span></span><ul class="dropdownMenu"></ul></li>'}),define("orion/commandRegistry",["orion/commands","orion/keyBinding","orion/explorers/navigationUtils","orion/PageUtil","orion/uiUtils","orion/webui/littlelib","orion/webui/dropdown","orion/webui/tooltip","text!orion/webui/submenutriggerbutton.html","orion/metrics","orion/Deferred","orion/EventTarget"],function(e,t,i,n,o,r,s,a,l,c,d,h){function u(e){this._commandList={},this._contributionsByScopeId={},this._activeBindings={},this._urlBindings={},this._pendingBindings={},this._parameterCollector=null,this._init(e||{})}function p(e,t){this.token=e,this.parameterName=t}function f(e,t,i){this.event=e,this.handler=t,this.capture=i||!1}function g(e,t,i,n,o,r,s){this.name=e,this.type=t,this.label=i,this.value=n,this.lines=o||1,this.validator=s,this.eventListeners=Array.isArray(r)?r:r?[r]:[]}function m(e,t,i){this._storeParameters(e),this._hasOptionalParameters=t&&t.hasOptionalParameters,this._options=t,this.optionsRequested=!1,this.getParameters=i,this.clientCollect=t&&t.clientCollect,this.getParameterElement=t&&t.getParameterElement,this.getSubmitName=t&&t.getSubmitName,this.getCancelName=t&&t.getCancelName,this.message=t&&t.message}return u.prototype={_init:function(t){this._selectionService=t.selection;var i=this;e.setKeyBindingProvider(function(){return i._activeBindings}),h.attach(u.prototype),this.addEventListener("bindingChanged",function(e){this._handleBindingChanges(e)}.bind(this)),this.addEventListener=function(e,t){this._bindingOverrides&&"bindingChanged"===e&&this._updateBindingOverrides(t),u.prototype.addEventListener.call(this,e,t)}},processURL:function(e){for(var t in this._urlBindings)if(this._urlBindings[t]&&this._urlBindings[t].urlBinding&&this._urlBindings[t].command){var i=this._urlBindings[t].urlBinding.match(e);if(i){var n=this._urlBindings[t],o=n.command,r=n.invocation;if(r&&r.parameters&&o.callback){r.parameters.setValue(i.parameterName,i.parameterValue);var s=this;return void window.setTimeout(function(){s._invoke(r)},0)}}}},findCommand:function(e){return this._commandList[e]},runCommand:function(t,i,n,o,r,s){var a=this;if(i){var l=this._commandList[t],c=l&&(l.visibleWhen?l.visibleWhen(i):!0);if(c&&l.callback){var d=new e.CommandInvocation(n,i,r,l,a);return d.domParent=s,a._invoke(d,o)}}else{var h=this._urlBindings[t];if(h&&h.command&&h.command.callback)return a._invoke(h.invocation,o)}},getSelectionService:function(){return this._selectionService},setParameterCollector:function(e){this._parameterCollector=e},openParameterCollector:function(e,t,i){this._parameterCollector&&(this._parameterCollector.close(),this._parameterCollector.open(e,t,i))},confirm:function(e,t,i,n,o,r){var s=!1;if(!this._parameterCollector||o)s=window.confirm(t),r(s);else{var l=this,c=function(){r(s)},d=function(){l._parameterCollector.close()},h=function(e,o){var r=document.createElement("span");r.classList.add("parameterPrompt"),r.textContent=t,e.appendChild(r);var a=document.createElement("button");a.addEventListener("click",function(){s=!0,c(),d()},!1),o.appendChild(a),a.appendChild(document.createTextNode(i)),a.className="dismissButton";var l=document.createElement("button");return l.addEventListener("click",function(){s=!1,d()},!1),o.appendChild(l),l.appendChild(document.createTextNode(n)),l.className="dismissButton",a};this._parameterCollector.close();var u=this._parameterCollector.open(e,h,function(){});if(!u){var p=new a.Tooltip({node:e,afterHiding:function(){this.destroy()},trigger:"click",position:["below","right","above","left"]}),f=p.contentContainer();f.classList.add("parameterPopup");var g=window.document.activeElement;d=function(){g&&g.focus(),p.destroy()};var m=document.createElement("div");m.classList.add("parameterMessage"),f.appendChild(m);var v=document.createElement("div");f.appendChild(v),v.classList.add("layoutRight"),v.classList.add("parametersDismiss");var _=h(m,v);p.show(),_&&window.setTimeout(function(){_.focus(),_.select&&_.select()},0)}}},closeParameterCollector:function(){this._parameterCollector&&this._parameterCollector.close()},collectsParameters:function(){return this._parameterCollector},_invoke:function(e,t){return this._collectAndInvoke(e.makeCopy(t),!1)},_collectAndInvoke:function(e,t,i){if(e){if(!(this._parameterCollector&&e.parameters&&e.parameters.hasParameters()&&(t||e.parameters.shouldCollectParameters())))return c.logEvent("command","invoke",e.command.id),e.command.callback.call(e.handler||window,e);var n=!1;if(e.parameters.updateParameters(e),e.parameters.shouldCollectParameters()&&(n=this._parameterCollector.collectParameters(e,i),!n)){var o=new a.Tooltip({node:e.domNode||e.domParent,afterHiding:function(){this.destroy(),e.domParent&&e.domParent.classList.remove("parameterPopupOpen")},trigger:"click",position:["below","right","above","left"]}),r=o.contentContainer();r.classList.add("parameterPopup");var s=window.document.activeElement,l=this._parameterCollector.getFillFunction(e,function(){s&&s.focus(),o.destroy(),e.domParent&&e.domParent.classList.remove("parameterPopupOpen")},i)(r);o.show(),e.domParent&&e.domParent.classList.add("parameterPopupOpen"),l&&window.setTimeout(function(){l.focus(),l.select&&l.select()},0),n=!0}if(!n)return c.logEvent("command","invoke",e.command.id),e.command.callback.call(e.handler||window,e)}else window.console.log("Client attempted to invoke command without an available (rendered) command invocation")},collectParameters:function(e,t){this._collectAndInvoke(e,!0,t)},showKeyBindings:function(t){function i(t){return function(){e.executeBinding(t)}}var n,o={},r=[];for(var s in this._activeBindings)n=this._activeBindings[s],n&&n.keyBinding&&n.command&&(n.command.name||n.command.tooltip)&&r.push(n);r.sort(function(e,t){var i=e.command.name||e.command.tooltip,n=t.command.name||t.command.tooltip;return i.localeCompare(n)});for(var a=0;a<r.length;a++)n=r[a],n.keyBinding.scopeName?(o[n.keyBinding.scopeName]||(o[n.keyBinding.scopeName]=[]),o[n.keyBinding.scopeName].push(n)):t.createItem(n.keyBinding,n.command.name||n.command.tooltip,n.command.id,i(n));for(var l in o)o[l].length&&o[l].length>0&&(t.createHeader(l),o[l].forEach(function(e){t.createItem(e.keyBinding,e.command.name||e.command.tooltip,e.command.id,i(e))}))},_handleBindingChanges:function(t){var i=this.findCommand(t.id);if(i){var n=this._activeBindings[t.id];n?n.keyBinding=t.newBinding:this._addBinding(i,"key",t.newBinding)}if(this._renderedCommands&&this._renderedCommands[t.id])for(var r=this._renderedCommands[t.id],s=Object.keys(r),a=0;a<s.length;a++){var l=r[s[a]],c=o.getUserKeyString(t.newBinding),d=e.createCommandMenuItem(l.domParent,l.command,l,null,l.onClick,c);l.domNode.parentNode.replaceChild(d,l.domNode),l.domNode=d}},createBindingOverride:function(e,t,i){if(this._bindingOverrides||(this._bindingOverrides=[]),this._bindingOverrides.push({id:e,newBinding:t,prevBinding:i}),this._prefService){var n=JSON.stringify(this._bindingOverrides);this._prefService.put("/KeyBindings",{overridesJSON:n})}var o={type:"bindingChanged",id:e,newBinding:t,prevBinding:i};this.dispatchEvent(o)},_registerRenderedCommand:function(e,t,i){this._renderedCommands||(this._renderedCommands={});var n=this._renderedCommands[e];n||(n=this._renderedCommands[e]={}),n[t]=i},_getBindingOverrides:function(){return this._prefService.get("/KeyBindings").then(function(e){var i=[],n=e.overridesJSON;n&&(i="string"==typeof n?JSON.parse(n):n);for(var o=0;o<i.length;o++){var r=i[o];if(r.newBinding){var s=r.newBinding;i[o].newBinding=new t.KeyStroke(s.keyCode,s.mod1,s.mod2,s.mod3,s.mod4,s.type)}if(r.prevBinding){var a=r.prevBinding;i[o].prevBinding=new t.KeyStroke(a.keyCode,a.mod1,a.mod2,a.mod3,a.mod4,a.type)}}return(new d).resolve(i)}.bind(this))},getBindingOverride:function(e){if(!this._bindingOverrides)return null;for(var t=this._bindingOverrides.length-1;t>=0;t--){var i=this._bindingOverrides[t];if(i.id===e)return i.newBinding}return null},addCommand:function(e){this._commandList[e.id]=e;var t=this._pendingBindings[e.id];if(t){var i=this;t.forEach(function(t){i._addBinding(e,t.type,t.binding,t.bindingOnly)}),delete this._pendingBindings[e.id]}},addCommandGroup:function(e,t,i,n,o,r,s,a,l,c,d){this._contributionsByScopeId[e]||(this._contributionsByScopeId[e]={});var h=this._contributionsByScopeId[e];o&&(h=this._createEntryForPath(h,o)),h[t]?(n&&(h[t].title=n),i&&(h[t].position=i),s&&(h[t].imageClass=s),a&&(h[t].tooltip=a),l&&(h[t].selectionClass=l),d&&(h[t].extraClass=d),c===!0?h[t].pretendDefaultActionId=!0:h[t].defaultActionId=c,h[t].emptyGroupMessage=r):(h[t]={title:n,position:i,emptyGroupMessage:r,imageClass:s,tooltip:a,selectionClass:l,defaultActionId:c===!0?null:c,pretendDefaultActionId:c===!0,children:{},extraClasses:d},h.sortedContributions=null)},_createEntryForPath:function(e,t){if(t){var i=t.split("/");i.forEach(function(t){t.length>1&&(e[t]||(e[t]={position:0,children:{}},e.sortedContributions=null),e=e[t].children)})}return e},registerSelectionService:function(e,t){this._contributionsByScopeId[e]||(this._contributionsByScopeId[e]={}),this._contributionsByScopeId[e].localSelectionService=t},setServiceRegistry:function(e){this._serviceRegistry=e,this._prefService=e.getService("orion.core.preference"),this._prefService&&(this._getBindingOverrides().then(function(e){this._bindingOverrides=e,this._updateBindingOverrides()}.bind(this)),this._prefService.addEventListener("changed",function(e){"/KeyBindings"===e.namespace&&this._getBindingOverrides().then(function(e){if(e.length>this._bindingOverrides.length)for(var t=this._bindingOverrides.length;t<e.length;t++){var i=e[t],n={type:"bindingChanged",id:i.id,newBinding:i.newBinding,prevBinding:i.prevBinding};this.dispatchEvent(n)}this._bindingOverrides=e}.bind(this))}.bind(this)))},_updateBindingOverrides:function(e){for(var t=0;t<this._bindingOverrides.length;t++){var i=this._bindingOverrides[t],n={type:"bindingChanged",id:i.id,newBinding:i.newBinding,prevBinding:i.prevBinding};
e?e(n):this.dispatchEvent(n)}},registerCommandContribution:function(e,t,i,n,o,r,s,a){this._contributionsByScopeId[e]||(this._contributionsByScopeId[e]={});var l=this._contributionsByScopeId[e];n&&(l=this._createEntryForPath(l,n)),l[t]={position:i,handler:a};var c;if(this._bindingOverrides){var d=this.getBindingOverride(t,r);d&&(r=d)}r&&(c=this._commandList[t],c?this._addBinding(c,"key",r,o):this._addPendingBinding(t,"key",r,o)),s&&(c=this._commandList[t],c?this._addBinding(c,"url",s,o):this._addPendingBinding(t,"url",s,o)),l.sortedContributions=null},unregisterCommandContribution:function(e,t,i){if(this._contributionsByScopeId[e]){delete this._commandList[t],delete this._activeBindings[t],delete this._urlBindings[t],delete this._pendingBindings[t];var n=this._contributionsByScopeId[e];if(i){var o=i.split("/");o.forEach(function(e){if(e.length>1){if(!n[e])return;n=n[e].children}})}delete n[t],n.sortedContributions=null}},_addBinding:function(e,t,i,n){if(!e.id)throw new Error("No command id: "+e);"key"===t?this._activeBindings[e.id]={command:e,keyBinding:i,bindingOnly:n}:"url"===t&&(this._urlBindings[e.id]={command:e,urlBinding:i,bindingOnly:n})},_addPendingBinding:function(e,t,i,n){this._pendingBindings[e]=this._pendingBindings[e]||[],this._pendingBindings[e].push({type:t,binding:i,bindingOnly:n})},_checkForTrailingSeparator:function(e,t,i){var n;if(("tool"===t||"button"===t)&&(n=e.childNodes.length>0?e.childNodes[e.childNodes.length-1]:null,n&&n.classList.contains("commandSeparator")))return i?(e.removeChild(n),!1):!0;if("menu"===t){var o=r.$$array("li > *",e);if(o.length>0&&o[o.length-1].classList.contains("dropdownSeparator"))return n=o[o.length-1],i?(n.parentNode.parentNode.removeChild(n.parentNode),!1):!0}return!1},renderCommands:function(e,t,i,n,o,s,a){if("string"!=typeof e)throw"a scope id for rendering must be specified";if(t=r.node(t),!t)throw"no parent";var l=this._contributionsByScopeId[e];if(!i&&l){var c=l.localSelectionService||this._selectionService,d=this;return void(c&&c.getSelections(function(i){d.renderCommands(e,t,i,n,o,s)}))}l&&(this._render(e,l,t,i,n,o||"button",s,a),this._checkForTrailingSeparator(t,o,!0))},destroy:function(e){if(e=r.node(e),!e)throw"no parent";for(;e.hasChildNodes();){var t=e.firstChild;t.commandTooltip&&t.commandTooltip.destroy(),t.emptyGroupTooltip&&t.emptyGroupTooltip.destroy(),this.destroy(t),e.removeChild(t)}},_render:function(t,n,r,s,l,c,d,h){var u=n.sortedContributions;if(!u){u=[];var p=!1;for(var f in n)if(Object.prototype.hasOwnProperty.call(n,f)){var g=n[f];g&&"number"==typeof g.position&&(g.id=f,u.push(g),p=!0)}p&&(u.sort(function(e,t){return e.position-t.position}),n.sortedContributions=u)}var m=0,v=this;u.forEach(function(n){function u(e){e&&e.parentNode&&e.parentNode.removeChild(e)}var p,f;if(n.imageClass||(n.imageClass=null),n.children&&Object.getOwnPropertyNames(n.children).length>0){var g,_=n.children;if("tool"===c||"button"===c)if(n.title){var y;if(n.defaultActionId){n.pretendDefaultActionId=n.defaultActionId===!0;var C=v._commandList[n.defaultActionId];C&&(C.visibleWhen?C.visibleWhen(s):!0)?(y=new e.CommandInvocation(l,s,d,C,v),y.domParent=r):n.pretendDefaultActionId=!0}g=v._createDropdownMenu(r,n.title,null,null,n.imageClass,n.tooltip,n.selectionClass,null,y,n.pretendDefaultActionId,n.extraClasses),h&&i.generateNavGrid(h,g.menuButton),g&&(v._render(t,n.children,g.menu,s,l,"menu",d,h),v._checkForTrailingSeparator(g.menu,"menu",!0),0===g.menu.childNodes.length?n.emptyGroupMessage?g.menuButton.emptyGroupTooltip||(g.menuButton.emptyGroupTooltip=new a.Tooltip({node:g.menuButton,text:n.emptyGroupMessage,trigger:"click",position:["below","right","above","left"]})):(h&&i.removeNavGrid(h,g.menuButton),u(g.menu),u(g.menuButton),u(g.destroyButton)):g.menuButton.style.visibility="visible")}else{var w;if(r.childNodes.length>0&&!v._checkForTrailingSeparator(r,c)&&(w=v.generateSeparatorImage(r)),v._render(t,_,r,s,l,c,d,h),r.childNodes.length>0){var b=r.childNodes[r.childNodes.length-1];b!==w&&(w=v.generateSeparatorImage(r))}}else if(n.title){var S=v._createDropdownMenu(r,n.title,!0,null,null,n.imageClass);S&&(v._render(t,_,S.menu,s,l,"menu",d,h),v._checkForTrailingSeparator(S.menu,"menu",!0),0===S.menu.childNodes.length&&S.destroyButton&&r.removeChild(S.destroyButton))}else r.childNodes.length>0&&v._generateMenuSeparator(r),v._render(t,_,r,s,l,c,d,h),r.childNodes.length>0&&v._generateMenuSeparator(r)}else{var x=v._commandList[n.id],L=x?!0:!1,T=null,E=null;if(x){f=new e.CommandInvocation(n.handler||l,s,d,x,v),f.domParent=r;var k=!1;try{k=L&&(x.visibleWhen?x.visibleWhen(s,f):!0)}catch(N){throw console.log(N),N}v._activeBindings[x.id]&&v._activeBindings[x.id].keyBinding&&(T=v._activeBindings[x.id],T.invocation=k?f:null,T.bindingOnly&&(L=!1)),v._urlBindings[x.id]&&v._urlBindings[x.id].urlBinding&&(E=v._urlBindings[x.id],E.invocation=k?f:null,E.bindingOnly&&(L=!1)),L=L&&k}if(L)if(x.choiceCallback){var A,R;"tool"===c||"button"===c?(A=r,R=!1,"ul"===r.nodeName.toLowerCase()&&(A=document.createElement("li"),r.appendChild(A))):(A=r,R=!0);var I=function(e){x.populateChoicesMenu(e,s,l,d,v)};v._createDropdownMenu(A,x.name,R,I.bind(x),x.imageClass,x.tooltip||x.title,x.selectionClass,x.positioningNode)}else{f.handler=f.handler||this,f.domParent=r;var D,P=function(){v._invoke(f)};if("menu"===c){var M=null;T&&T.keyBinding&&(M=o.getUserKeyString(T.keyBinding)),D=e.createCommandMenuItem(r,x,f,null,P,M),f.onClick=P,v._registerRenderedCommand(x.id,t,f)}else if("quickfix"===c){p=c+x.id+m;var O=document.createElement("div");r.appendChild(O),D=e.createCommandItem(O,x,f,p,null,"button"===c,P)}else p=c+x.id+m,D=e.createCommandItem(r,x,f,p,null,"tool"===c,P);i.generateNavGrid(h,D),f.domNode=D,m++}}})},_createDropdownMenu:function(t,i,n,o,c,d,h,u,p,f,g){if(t=r.node(t),!t||!r.contains(document.body,t))return null;var m,v,_,y,C=t;if(n){var w=document.createRange();w.selectNode(t);var b=w.createContextualFragment(l);r.processTextNodes(b,{ButtonText:i}),t.appendChild(b),y=t.lastChild,v=y.lastChild,m=v.previousSibling,m.dropdown=new s.Dropdown({dropdown:v,populate:o,parentDropdown:t.dropdown}),v.dropdown=m.dropdown}else{"ul"===t.nodeName.toLowerCase()&&(C=document.createElement("li"),t.appendChild(C),y=C);var S=null;c&&(S="dropdownButtonWithIcon",d=d||i),d=c?d||i:d;var x=e.createDropdownMenu(C,i,o,S,c,!1,h,u,p||f,g);if(_=x.dropdownArrow,m=x.menuButton,_){p&&(p.domNode=x.menuButton);var L=this;m.onclick=function(e){var t=r.bounds(_);(e.clientX>=t.left||f===!0)&&x.dropdown?x.dropdown.toggle(e):L._invoke(p)},x.dropdown&&(m.onkeydown=function(e){r.KEY.DOWN===e.keyCode&&(x.dropdown.toggle(e),r.stop(e))})}v=x.menu;var T,E=p&&p.command&&(p.command.tooltip||p.command.name);T=E?p.command.tooltip||p.command.name:d,T&&(m.commandTooltip=new a.Tooltip({node:m,text:T,position:["above","below","right","left"]}))}return{menuButton:m,menu:v,dropdown:m.dropdown,destroyButton:y,dropdownArrow:_}},_generateMenuSeparator:function(e){if(!this._checkForTrailingSeparator(e,"menu")){var t=document.createElement("li");t.classList.add("dropdownSeparator");var i=document.createElement("span");i.classList.add("dropdownSeparator"),t.appendChild(i),e.appendChild(t)}},generateSeparatorImage:function(e){var t;return"ul"===e.nodeName.toLowerCase()?(t=document.createElement("li"),e.appendChild(t)):(t=document.createElement("span"),e.appendChild(t)),t.classList.add("core-sprite-sep"),t.classList.add("imageSprite"),t.classList.add("commandSeparator"),t}},u.prototype.constructor=u,p.prototype={match:function(e){var t=n.matchResourceParameters(e);return"undefined"!=typeof t[this.token]?(this.parameterValue=t[this.token],this):null}},p.prototype.constructor=p,f.prototype.constructor=f,g.prototype={optionsRequested:function(){return this.optionsRequested}},g.prototype.constructor=g,m.prototype={_storeParameters:function(e){if(this.parameterTable=null,e){var t=this.parameterTable={};e.forEach(function(e){t[e.name]=e})}},updateParameters:function(e){"function"==typeof this.getParameters&&this._storeParameters(this.getParameters(e))},hasParameters:function(){return null!==this.parameterTable},shouldCollectParameters:function(){return!this.clientCollect&&this.hasParameters()},parameterNamed:function(e){return this.parameterTable[e]},valueFor:function(e){var t=this.parameterTable[e];return t?t.value:null},setValue:function(e,t){var i=this.parameterTable[e];i&&(i.value=t)},forEach:function(e){for(var t in this.parameterTable)this.parameterTable[t].type&&this.parameterTable[t].name&&e(this.parameterTable[t])},validate:function(e,t){var i=this.parameterTable[e];return i&&i.validator?i.validator(t):!0},makeCopy:function(){var e=[];this.forEach(function(t){var i=new g(t.name,t.type,t.label,t.value,t.lines,t.eventListeners,t.validator);e.push(i)});var t=new m(e,this._options,this.getParameters);return t.clientCollect=this.clientCollect,t.message=this.message,t},hasOptionalParameters:function(){return this._hasOptionalParameters}},m.prototype.constructor=m,{CommandRegistry:u,URLBinding:p,ParametersDescription:m,CommandParameter:g,CommandEventListener:f}}),define("orion/editor/nls/messages",{root:!0,de:!0,es:!0,fr:!0,it:!0,ja:!0,ko:!0,"pt-br":!0,zh:!0,"zh-hk":!0,"zh-tw":!0}),define("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",diffAdded:"Diff Added Lines",diffDeleted:"Diff Deleted Lines",diffModified:"Diff Modified Lines",lineUp:"Line Up",lineDown:"Line Down",lineStart:"Line Start",lineEnd:"Line End",charPrevious:"Previous Character",charNext:"Next Character",pageUp:"Page Up",pageDown:"Page Down",scrollPageUp:"Scroll Page Up",scrollPageDown:"Scroll Page Down",scrollLineUp:"Scroll Line Up",scrollLineDown:"Scroll Line Down",wordPrevious:"Previous Word",wordNext:"Next Word",textStart:"Document Start",textEnd:"Document End",scrollTextStart:"Scroll Document Start",scrollTextEnd:"Scroll Document End",centerLine:"Center Line",selectLineUp:"Select Line Up",selectLineDown:"Select Line Down",selectWholeLineUp:" Select Whole Line Up",selectWholeLineDown:"Select Whole Line Down",selectLineStart:"Select Line Start",selectLineEnd:"Select Line End",selectCharPrevious:"Select Previous Character",selectCharNext:"Select Next Character",selectPageUp:"Select Page Up",selectPageDown:"Select Page Down",selectWordPrevious:"Select Previous Word",selectWordNext:"Select Next Word",selectTextStart:"Select Document Start",selectTextEnd:"Select Document End",deletePrevious:"Delete Previous Character",deleteNext:"Delete Next Character",deleteWordPrevious:"Delete Previous Word",deleteWordNext:"Delete Next Word",deleteLineStart:"Delete Line Start",deleteLineEnd:"Delete Line End",tab:"Insert Tab",enter:"Insert Line Delimiter",enterNoCursor:"Insert Line Delimiter",escape:"Escape",selectAll:"Select All",copy:"Copy",cut:"Cut",paste:"Paste",uppercase:"To Upper Case",lowercase:"To Lower Case",capitalize:"Capitalize",reversecase:"Reverse Case",toggleWrapMode:"Toggle Wrap Mode",toggleTabMode:"Toggle Tab Mode",toggleOverwriteMode:"Toggle Overwrite Mode",committerOnTime:"${0} on ${1}",emacs:"Emacs",exchangeMarkPoint:"Exchange Mark and Point",setMarkCommand:"Set Mark",clearMark:"Clear Mark",digitArgument:"Digit Argument ${0}",negativeArgument:"Negative Argument",Comment:"Comment","Flat outline":"Flat outline",incrementalFindStr:"Incremental find: ${0}",incrementalFindStrNotFound:"Incremental find: ${0} (not found)",incrementalFindReverseStr:"Reverse Incremental find: ${0}",incrementalFindReverseStrNotFound:"Reverse Incremental find: ${0} (not found)",find:"Find...",undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",findPrevious:"Find Previous Occurrence",incrementalFind:"Incremental Find",incrementalFindReverse:"Incremental Find Reverse",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",collapse:"Collapse",expandAll:"Expand All",collapseAll:"Collapse All",lastEdit:"Last Edit Location",trimTrailingWhitespaces:"Trim Trailing Whitespaces",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode: Enter or ESC to exit",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",noProposals:"No proposals found",computingProposals:"Computing content assist proposals...",lineColumn:"Line ${0} : Column ${1}",lineColumnOffset:"Line ${0} : Column ${1} : Offset ${2}",multiSelections:"${0} selection regions",vi:"vi",vimove:"(Move)",viyank:"(Yank)",videlete:"(Delete)",vichange:"(Change)",viLeft:"${0} Left",viRight:"${0} Right",viUp:"${0} Up",viDown:"${0} Down",viw:"${0} Next Word",vib:"${0} Beginning of Word",viW:"${0} Next Word (ws stop)",viB:"${0} Beginning of Word (ws stop)",vie:"${0} End of Word",viE:"${0} End of Word (ws stop)",vi$:"${0} End of the line","vi^_":"${0} First non-blank Char Current Line","vi+":"${0} First Char Next Line","vi-":"${0} First Char Previous Line","vi|":"${0} nth Column in Line",viH:"${0} Top of Page",viM:"${0} Middle of Page",viL:"${0} Bottom of Page","vi/":"${0} Search Forward","vi?":"${0} Search Backward",vin:"${0} Next Search",viN:"${0} Previous Search",vif:"${0} Search Char Fwd",viF:"${0} Search Char Bckwd",vit:"${0} Search Before Char Fwd",viT:"${0} Search Before Char Bckwd","vi,":"${0} Repeat Reverse Char Search","vi;":"${0} Repeat Char Search",viG:"${0} Go to Line",viycd:"${0} Current Line",via:"Append After Cursor",viA:"Append to End of Line",vii:"Insert Before Cursor",viI:"Insert at Beginning of Line",viO:"Insert Line Above",vio:"Insert Line Below",viR:"Begin Overwriting Text",vis:"Substitute a Character",viS:"Substitute Entire Line",viC:"Change Text Until Line End",vip:"Paste After Char or Line",viP:"Paste Before Char or Line",viStar:"Search Word Under Cursor",next:"Next",previous:"Previous",replace:"Replace",replaceAll:"Replace All",findWith:"Find With",replaceWith:"Replace With",caseInsensitive:"Aa",regex:"/.*/",wholeWord:"\\b",caseInsensitiveTooltip:"Toggle Case Insensitive",regexTooltip:"Toggle Regex",wholeWordTooltip:"Toggle Whole Word",closeTooltip:"Close",replacingAll:"Replacing all...",replacedMatches:"Replaced ${0} matches",nothingReplaced:"Nothing replaced",notFound:"Not found"}),define("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(e,t){function i(){}function n(e,t,i){this.start=e,this.end=t,this._projectionModel=i,this.html=this._expandedHTML,this.style=this._expandedStyle,this.expanded=!0}function o(t,n){var o=t.lastIndexOf("."),r=t.substring(o+1),s={title:e[r],style:{styleClass:"annotation "+r},html:"<div class='annotationHTML "+r+"'></div>",overviewStyle:{styleClass:"annotationOverview "+r}};n?s.lineStyle={styleClass:"annotationLine "+r}:s.rangeStyle={styleClass:"annotationRange "+r},i.registerType(t,s)}function r(){}function s(e,t,i,n,o){var r;for(void 0===n&&(n=-1),void 0===o&&(o=e.length);o-n>1;)if(r=Math.floor((o+n)/2),t<=e[r].start)o=r;else{if(i&&t<e[r].end){o=r;break}n=r}return o}function a(e){this._annotations=[];var t=this;this._listener={onChanged:function(e){t._onChanged(e)}},this.setTextModel(e)}function l(e,t){this._view=e,this._annotationModel=t;var i=this;this._listener={onDestroy:function(e){i._onDestroy(e)},onLineStyle:function(e){i._onLineStyle(e)},onChanged:function(e){i._onAnnotationModelChanged(e)}},e.addEventListener("Destroy",this._listener.onDestroy),e.addEventListener("postLineStyle",this._listener.onLineStyle),t.addEventListener("Changed",this._listener.onChanged)}n.prototype={_expandedHTML:"<div class='annotationHTML expanded'></div>",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"<div class='annotationHTML collapsed'></div>",_collapsedStyle:{styleClass:"annotation collapsed"},_collapse:function(){return this.expanded?(this.expanded=!1,this.html=this._collapsedHTML,this.style=this._collapsedStyle,this._annotationModel&&this._annotationModel.modifyAnnotation(this),!0):!1},_expand:function(){return this.expanded?!1:(this.expanded=!0,this.html=this._expandedHTML,this.style=this._expandedStyle,this._annotationModel&&this._annotationModel.modifyAnnotation(this),!0)},_collapseImpl:function(e){if(this._collapse()){e&&this._forEachOverlaping(function(e){e.expanded||(e._expandImpl(!1),e._recollapse=!0)});var t=this._projectionModel,i=t.getBaseModel();this._projection={annotation:this,start:i.getLineStart(i.getLineAtOffset(this.start)+1),end:i.getLineEnd(i.getLineAtOffset(this.end),!0)},t.addProjection(this._projection)}},_expandImpl:function(e){this._expand()&&(this._projectionModel._removeProjection(this._projection,!this._annotationModel),e&&this._forEachOverlaping(function(e){e._recollapse&&(e._collapseImpl(!1),e._recollapse=!1)}))},_forEachOverlaping:function(e){if(this._annotationModel)for(var t=this._annotationModel.getAnnotations(this.start,this.end);t.hasNext();){var n=t.next();n!==this&&n.type===i.ANNOTATION_FOLDING&&e.call(this,n)}},collapse:function(){this._recollapse=!1,this._collapseImpl(!0)},expand:function(){this._recollapse=!1,this._expandImpl(!0)}},i.ANNOTATION_ERROR="orion.annotation.error",i.ANNOTATION_WARNING="orion.annotation.warning",i.ANNOTATION_TASK="orion.annotation.task",i.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint",i.ANNOTATION_BOOKMARK="orion.annotation.bookmark",i.ANNOTATION_FOLDING="orion.annotation.folding",i.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket",i.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket",i.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine",i.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch",i.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch",i.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence",i.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence",i.ANNOTATION_SELECTED_LINKED_GROUP="orion.annotation.selectedLinkedGroup",i.ANNOTATION_CURRENT_LINKED_GROUP="orion.annotation.currentLinkedGroup",i.ANNOTATION_LINKED_GROUP="orion.annotation.linkedGroup",i.ANNOTATION_BLAME="orion.annotation.blame",i.ANNOTATION_CURRENT_BLAME="orion.annotation.currentBlame",i.ANNOTATION_DIFF_ADDED="orion.annotation.diffAdded",i.ANNOTATION_DIFF_DELETED="orion.annotation.diffDeleted",i.ANNOTATION_DIFF_MODIFIED="orion.annotation.diffModified";var c={};return i.registerType=function(e,t){var i=t;return"function"!=typeof i&&(i=function(e,t,i){this.start=e,this.end=t,void 0!==i&&(this.title=i)},i.prototype=t),i.prototype.type=e,c[e]=i,e},i.createAnnotation=function(e,t,i,n){return new(this.getType(e))(t,i,n)},i.getType=function(e){return c[e]},o(i.ANNOTATION_ERROR),o(i.ANNOTATION_WARNING),o(i.ANNOTATION_TASK),o(i.ANNOTATION_BREAKPOINT),o(i.ANNOTATION_BOOKMARK),o(i.ANNOTATION_CURRENT_BRACKET),o(i.ANNOTATION_MATCHING_BRACKET),o(i.ANNOTATION_CURRENT_SEARCH),o(i.ANNOTATION_MATCHING_SEARCH),o(i.ANNOTATION_READ_OCCURRENCE),o(i.ANNOTATION_WRITE_OCCURRENCE),o(i.ANNOTATION_SELECTED_LINKED_GROUP),o(i.ANNOTATION_CURRENT_LINKED_GROUP),o(i.ANNOTATION_LINKED_GROUP),o(i.ANNOTATION_CURRENT_LINE,!0),o(i.ANNOTATION_BLAME,!0),o(i.ANNOTATION_CURRENT_BLAME,!0),o(i.ANNOTATION_DIFF_ADDED),o(i.ANNOTATION_DIFF_DELETED),o(i.ANNOTATION_DIFF_MODIFIED),i.registerType(i.ANNOTATION_FOLDING,n),r.addMixin=function(e){var t=r.prototype;for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},r.prototype={addAnnotationType:function(e,t){this._annotationTypes||(this._annotationTypes=[]);var i=t-1;void 0!=t&&i>=0&&i<this._annotationTypes.length?this._annotationTypes.splice(i,0,e):this._annotationTypes.push(e)},getAnnotationTypePriority:function(e){if(this._annotationTypes)for(var t=0;t<this._annotationTypes.length;t++)if(this._annotationTypes[t]===e)return t+1;return 0},getAnnotationsByType:function(e,t,i){for(var n,o=e.getAnnotations(t,i),r=[];o.hasNext();){n=o.next();var s=this.getAnnotationTypePriority(n.type);0!==s&&r.push(n)}var a=this;return r.sort(function(e,t){return a.getAnnotationTypePriority(e.type)-a.getAnnotationTypePriority(t.type)}),r},isAnnotationTypeVisible:function(e){return 0!==this.getAnnotationTypePriority(e)},removeAnnotationType:function(e){if(this._annotationTypes)for(var t=0;t<this._annotationTypes.length;t++)if(this._annotationTypes[t]===e){this._annotationTypes.splice(t,1);break}}},a.prototype={addAnnotation:function(e){if(e){var t=this._annotations,i=s(t,e.start);t.splice(i,0,e),e._annotationModel=this;var n={type:"Changed",added:[e],removed:[],changed:[]};this.onChanged(n)}},getTextModel:function(){return this._model},getAnnotations:function(e,t){var i,n,o=this._annotations,r=0;return n=void 0===e&&void 0===t?function(){return r<o.length?o[r++]:null}:function(){for(;r<o.length;){var i=o[r++];if(e===i.start||(e>i.start?e<i.end:i.start<t))return i;if(i.start>=t)break}return null},i=n(),{next:function(){var e=i;return e&&(i=n()),e},hasNext:function(){return null!==i}}},modifyAnnotation:function(e){if(e){var t=this._getAnnotationIndex(e);if(!(0>t)){var i={type:"Changed",added:[],removed:[],changed:[e]};this.onChanged(i)}}},onChanged:function(e){return this.dispatchEvent(e)},removeAnnotations:function(e){var t,i,n=this._annotations;if(e)for(t=[],i=n.length-1;i>=0;i--){var o=n[i];o.type===e&&(n.splice(i,1),t.splice(0,0,o),o._annotationModel=null)}else t=n,n=[];var r={type:"Changed",removed:t,added:[],changed:[]};this.onChanged(r)},removeAnnotation:function(e){if(e){var t=this._getAnnotationIndex(e);if(!(0>t)){e._annotationModel=null;var i={type:"Changed",removed:this._annotations.splice(t,1),added:[],changed:[]};this.onChanged(i)}}},replaceAnnotations:function(e,t){var i,n,o,r=this._annotations,a=[];if(e)for(i=e.length-1;i>=0;i--)o=e[i],n=this._getAnnotationIndex(o),0>n||(o._annotationModel=null,r.splice(n,1),a.splice(0,0,o));for(t||(t=[]),i=0;i<t.length;i++)o=t[i],n=s(r,o.start),o._annotationModel=this,r.splice(n,0,o);var l={type:"Changed",removed:a,added:t,changed:[]};this.onChanged(l)},setTextModel:function(e){this._model&&this._model.removeEventListener("Changed",this._listener.onChanged),this._model=e,this._model&&this._model.addEventListener("Changed",this._listener.onChanged)},_getAnnotationIndex:function(e){for(var t=this._annotations,i=s(t,e.start);i<t.length&&t[i].start===e.start;){if(t[i]===e)return i;i++}return-1},_onChanged:function(e){var t=e.start,i=e.addedCharCount,n=e.removedCharCount,o=this._annotations,r=t+n,s=0;if(s>=0&&s<o.length){var a,l={type:"Changed",added:[],removed:[],changed:[],textModelChangedEvent:e},c=i-n;for(a=s;a<o.length;a++){var d=o[a];d.start>=r?(d._oldStart=d.start,d._oldEnd=d.end,d.start+=c,d.end+=c,l.changed.push(d)):d.end<=t||(d.start<t&&r<d.end?(d._oldStart=d.start,d._oldEnd=d.end,d.end+=c,l.changed.push(d)):(o.splice(a,1),l.removed.push(d),d._annotationModel=null,d.expand&&d.expand(),a--))}(l.added.length>0||l.removed.length>0||l.changed.length>0)&&this.onChanged(l)}}},t.EventTarget.addMixin(a.prototype),l.prototype={destroy:function(){var e=this._view;e&&(e.removeEventListener("Destroy",this._listener.onDestroy),e.removeEventListener("LineStyle",this._listener.onLineStyle),this.view=null);var t=this._annotationModel;t&&(t.removeEventListener("Changed",this._listener.onChanged),t=null)},_mergeStyle:function(e,t){if(t){e||(e={}),e.styleClass&&t.styleClass&&e.styleClass!==t.styleClass?e.styleClass+=" "+t.styleClass:e.styleClass=t.styleClass;var i;if(t.tagName&&(e.tagName||(e.tagName=t.tagName)),t.style){e.style||(e.style={});for(i in t.style)e.style[i]||(e.style[i]=t.style[i])}if(t.attributes){e.attributes||(e.attributes={});for(i in t.attributes)e.attributes[i]||(e.attributes[i]=t.attributes[i])}}return e},_mergeStyleRanges:function(e,t){e||(e=[]);for(var i,n=s(e,t.start,!0);n<e.length&&t;n++){var o=e[n];if(t.end<=o.start)break;if(!(t.start>=o.end)){i=this._mergeStyle({},o.style),i=this._mergeStyle(i,t.style);var r=[];r.push(n,1),t.start<o.start&&r.push({start:t.start,end:o.start,style:t.style}),t.start>o.start&&r.push({start:o.start,end:t.start,style:o.style}),r.push({start:Math.max(o.start,t.start),end:Math.min(o.end,t.end),style:i}),t.end<o.end&&r.push({start:t.end,end:o.end,style:o.style}),t=t.end>o.end?{start:o.end,end:t.end,style:t.style}:null,Array.prototype.splice.apply(e,r)}}return t&&(i=this._mergeStyle({},t.style),e.splice(n,0,{start:t.start,end:t.end,style:i})),e},_onAnnotationModelChanged:function(e){function t(e,t){r.getBaseModel&&(e=r.mapOffset(e,!0),t=r.mapOffset(t,!0)),-1!==e&&-1!==t&&n.redrawRange(e,t)}function i(e,i){for(var n=0;n<e.length;n++)if(o.isAnnotationTypeVisible(e[n].type)){var r=e[n];t(r.start,r.end),i&&void 0!==r._oldStart&&r._oldEnd&&t(r._oldStart,r._oldEnd)}}var n=this._view;if(n){var o=this,r=n.getModel();i(e.added),i(e.removed),i(e.changed,!0)}},_onDestroy:function(){this.destroy()},_onLineStyle:function(e){var t=this._annotationModel,i=e.textView.getModel(),n=t.getTextModel(),o=e.lineStart,r=e.lineStart+e.lineText.length;n!==i&&(o=i.mapOffset(o),r=i.mapOffset(r));for(var s=t.getAnnotations(o,r);s.hasNext();){var a=s.next();if(this.isAnnotationTypeVisible(a.type)){if(a.rangeStyle){var l=a.start,c=a.end;n!==i&&(l=i.mapOffset(l,!0),c=i.mapOffset(c,!0)),e.ranges=this._mergeStyleRanges(e.ranges,{start:l,end:c,style:a.rangeStyle})}a.lineStyle&&(e.style=this._mergeStyle({},e.style),e.style=this._mergeStyle(e.style,a.lineStyle))}}}},r.addMixin(l.prototype),{FoldingAnnotation:n,AnnotationType:i,AnnotationTypeList:r,AnnotationModel:a,AnnotationStyler:l}}),define("orion/editorCommands",["i18n!orion/edit/nls/messages","orion/i18nUtil","orion/webui/littlelib","orion/widgets/input/DropDownMenu","orion/Deferred","orion/URITemplate","orion/commands","orion/keyBinding","orion/commandRegistry","orion/extensionCommands","orion/contentTypes","orion/searchUtils","orion/objects","orion/PageUtil","orion/PageLinks","orion/editor/annotations","orion/regex","orion/PageUtil","orion/uiUtils","orion/util"],function(e,t,i,n,o,r,s,a,l,c,d,h,u,p,f,g,m,v,_,y){function C(e){var t=new r(e.uriTemplate),i=e.params||{};i.OrionHome=i.OrionHome||f.getOrionHome();var n=t.expand(i),o=document.createElement("div"),s=document.createElement("iframe");return s.id=e.id,s.name=e.id,s.type="text/html",s.sandbox="allow-scripts allow-same-origin allow-forms allow-popups",s.frameborder=void 0!==e.border?e.border:1,s.src=n,s.className="delegatedUI",e.width&&(o.style.width=e.width,s.style.width=e.width),e.height&&(o.style.height=e.height,s.style.height=e.height),s.style.visibility="hidden",null!==e.parent&&(e.parent||window.document.body).appendChild(o),o.appendChild(s),s.style.left=e.left||(window.innerWidth-parseInt(s.clientWidth,10))/2+"px",s.style.top=e.top||(window.innerHeight-parseInt(s.clientHeight,10))/2+"px",s.style.visibility="",window.addEventListener("message",function a(t){if(t.source===s.contentWindow&&"string"==typeof t.data){var i=JSON.parse(t.data);"orion.page.delegatedUI"===i.pageService&&i.source===e.id&&(i.cancelled?e.cancelled&&e.cancelled():i.result?e.done&&e.done(i.result):(i.Status||i.status)&&e.status&&e.status(i.Status||i.status),window.removeEventListener("message",a,!1),o.parentNode&&o.parentNode.removeChild(o))}},!1),o}function w(e,t){t&&"undefined"!=typeof t.HTML&&delete t.HTML;var i=e.getService("orion.page.message");return i?i.setProgressResult(t).then(null,function(e){throw console.log(e),e}):(console.log(t),(new o).resolve(t))}function b(e){return{_error:e}}function S(e){this.serviceRegistry=e.serviceRegistry,this.commandService=e.commandRegistry,this.fileClient=e.fileClient,this.inputManager=e.inputManager,this.renderToolbars=e.renderToolbars,this.toolbarId=e.toolbarId,this.saveToolbarId=e.saveToolbarId,this.editToolbarId=e.editToolbarId,this.pageNavId=e.navToolbarId,this.editorContextMenuId=e.editorContextMenuId,this.isReadOnly=e.readonly,this.textSearcher=e.textSearcher,this.searcher=e.searcher,this.localSettings=e.localSettings,this.editorPreferences=e.editorPreferences,this.differ=e.differ,this.blamer=e.blamer;var t=this;this.listener={onServiceAdded:function(e){t._onServiceAdded(e.serviceReference)},onServiceRemoved:function(e){t._onServiceRemoved(e.serviceReference)}},this.serviceRegistry.addEventListener("registered",this.listener.onServiceAdded),this.serviceRegistry.addEventListener("unregistering",this.listener.onServiceRemoved)}var x={},L=null;return x.createDelegatedUI=C,S.prototype={createCommands:function(){return this._createSettingsCommand(),this._createGotoLineCommnand(),this._createFindCommnand(),this._createBlameCommand(),this._createDiffCommand(),this._createShowTooltipCommand(),this._createUndoStackCommands(),this._createClipboardCommands(),this._createEncodingCommand(),this._createSaveCommand(),this._createEditCommands()},setSideBar:function(e){this.sideBar=e},getEditCommands:function(){var e=[],t=this.commandService;for(var i in t._commandList){var n=t._commandList[i];n.editInfo&&e.push(n)}return e},updateCommands:function(e){e=e||{},this.editor=e.editor,this.inputManager=e.inputManager,this.localSettings=e.localSettings,this.differ=e.differ,this.blamer=e.blamer,this.textSearcher=e.textSearcher,this._recreateEditCommands&&this._createEditCommands().then(function(){this.registerCommands(),this.registerContextMenuCommands(),this.renderToolbars&&this.renderToolbars()}.bind(this))},_registerCommandGroups:function(e,t){var i,n=this.commandService,o=this.serviceRegistry,r=o.getServiceReferences("orion.edit.command.category");r.forEach(function(o){for(var r={},s=o.getPropertyKeys(),a=0;a<s.length;a++)r[s[a]]=o.getProperty(s[a]);i=t,r.parentPath&&(i+="/"+r.parentPath),n.addCommandGroup(e,r.id,r.position||101,r.name,i,null,r.imageClass)}.bind(this))},registerCommands:function(){function e(e){if(!e)return null;var t=new a.KeyBinding;return a.KeyBinding.apply(t,e),t}var t=this.commandService;t.registerCommandContribution("settingsActions","orion.edit.settings",1,null,!1,new a.KeyBinding("s",!0,!0),null,this),t.registerCommandContribution(this.editToolbarId||this.toolbarId,"orion.edit.undo",400,this.editToolbarId?"orion.menuBarEditGroup/orion.edit.undoGroup":null,!this.editToolbarId,new a.KeyBinding("z",!0),null,this),t.registerCommandContribution(this.editToolbarId||this.toolbarId,"orion.edit.redo",401,this.editToolbarId?"orion.menuBarEditGroup/orion.edit.undoGroup":null,!this.editToolbarId,y.isMac?new a.KeyBinding("z",!0,!0):new a.KeyBinding("y",!0),null,this),t.registerCommandContribution(this.saveToolbarId||this.toolbarId,"orion.openResource",1,this.saveToolbarId?"orion.menuBarFileGroup/orion.edit.saveGroup":null,!1,new a.KeyBinding("f",!0,!0)),t.registerCommandContribution(this.saveToolbarId||this.toolbarId,"orion.edit.save",2,this.saveToolbarId?"orion.menuBarFileGroup/orion.edit.saveGroup":null,!1,new a.KeyBinding("s",!0),null,this),t.registerCommandContribution(this.editToolbarId||this.pageNavId,"orion.edit.gotoLine",3,this.editToolbarId?"orion.menuBarEditGroup/orion.findGroup":null,!this.editToolbarId,new a.KeyBinding("l",!y.isMac,!1,!1,y.isMac),new l.URLBinding("gotoLine","line"),this),t.registerCommandContribution(this.editToolbarId||this.pageNavId,"orion.edit.find",0,this.editToolbarId?"orion.menuBarEditGroup/orion.findGroup":null,!this.editToolbarId,new a.KeyBinding("f",!0),new l.URLBinding("find","find"),this),t.registerCommandContribution(this.toolbarId,"orion.keyAssist",0,"orion.menuBarToolsGroup",!1,new a.KeyBinding(191,!1,!0,!0)),t.registerCommandContribution(this.toolbarId,"orion.edit.showTooltip",1,"orion.menuBarToolsGroup",!1,new a.KeyBinding(113),null,this),t.registerCommandContribution(this.toolbarId,"orion.edit.blame",2,"orion.menuBarToolsGroup",!1,new a.KeyBinding("b",!0,!0),new l.URLBinding("blame","blame"),this),t.registerCommandContribution(this.toolbarId,"orion.edit.diff",3,"orion.menuBarToolsGroup",!1,new a.KeyBinding("d",!0,!0),new l.URLBinding("diff","diff"),this),t.registerCommandContribution(this.toolbarId,"orion.edit.reloadWithEncoding",1e3,"orion.menuBarToolsGroup"),this._registerCommandGroups(this.toolbarId,"orion.menuBarToolsGroup");
for(var i=this.getEditCommands(),n=0,o=100;n<i.length;n++,o++){var r=i[n],s=r.editInfo;if(s.scopeId)t.registerCommandContribution(s.scopeId,r.id,o,s.scopeId+"Group",s.bindingOnly,e(s.key),null,this);else{var c="orion.menuBarToolsGroup";s.parentPath&&(c+="/"+s.parentPath),t.registerCommandContribution(this.toolbarId,r.id,o,c,s.bindingOnly,e(s.key),null,this)}}},registerContextMenuCommands:function(){var t=this.commandService;t.addCommandGroup(this.editorContextMenuId,"orion.editorContextMenuGroup",100,null,null,null,null,null,"dropdownSelection");var i=1;t.registerCommandContribution(this.editorContextMenuId,"orion.edit.copy",i++,"orion.editorContextMenuGroup/orion.edit.copyGroup",!1,new a.KeyBinding("c",!0)),t.registerCommandContribution(this.editorContextMenuId,"orion.edit.cut",i++,"orion.editorContextMenuGroup/orion.edit.copyGroup",!1,new a.KeyBinding("x",!0)),t.registerCommandContribution(this.editorContextMenuId,"orion.edit.paste",i++,"orion.editorContextMenuGroup/orion.edit.copyGroup",!1,new a.KeyBinding("v",!0)),t.registerCommandContribution(this.editorContextMenuId,"orion.edit.undo",i++,"orion.editorContextMenuGroup/orion.edit.undoGroup",!1),t.registerCommandContribution(this.editorContextMenuId,"orion.edit.redo",i++,"orion.editorContextMenuGroup/orion.edit.undoGroup",!1),t.registerCommandContribution(this.editorContextMenuId,"orion.edit.find",i++,"orion.editorContextMenuGroup/orion.findGroup",!1),t.registerCommandContribution(this.editorContextMenuId,"orion.edit.gotoLine",i++,"orion.editorContextMenuGroup/orion.findGroup",!1),t.registerCommandContribution(this.editorContextMenuId,"orion.quickSearch",i++,"orion.editorContextMenuGroup/orion.findGroup",!1),t.registerCommandContribution(this.editorContextMenuId,"orion.openSearch",i++,"orion.editorContextMenuGroup/orion.findGroup",!1),t.addCommandGroup(this.editorContextMenuId,"orion.editorContextMenuToolsGroup",400,e.Tools,"orion.editorContextMenuGroup"),t.registerCommandContribution(this.editorContextMenuId,"orion.edit.reloadWithEncoding",1e3,"orion.editorContextMenuGroup/orion.editorContextMenuToolsGroup"),t.registerCommandContribution(this.editorContextMenuId,"orion.edit.blame",1,"orion.editorContextMenuGroup/orion.editorContextMenuToolsGroup",!1),t.registerCommandContribution(this.editorContextMenuId,"orion.edit.diff",2,"orion.editorContextMenuGroup/orion.editorContextMenuToolsGroup",!1),this._registerCommandGroups(this.editorContextMenuId,"orion.editorContextMenuGroup/orion.editorContextMenuToolsGroup");for(var n=this.getEditCommands(),o=0,r=100;o<n.length;o++,r++){var s=n[o],l=s.editInfo,c="orion.editorContextMenuGroup/orion.editorContextMenuToolsGroup";l.parentPath&&(c+="/"+l.parentPath),this.commandService.registerCommandContribution(this.editorContextMenuId,s.id,r,c)}},overwriteKeyBindings:function(e){var t=this;if(this.editor=e,e.getTextView&&e.getTextView()){var i=e.getTextView();i.setKeyBinding(new a.KeyBinding("s",!0),"save");var n=t.commandService.findCommand("orion.edit.save");i.setAction("save",function(){return n.callback.call({inputManager:t.inputManager}),!0},n),i.setAction("gotoLine",function(i){return i?(e.onGotoLine(i.line-1,0,void 0,i.callback),!0):(t.commandService.runCommand("orion.edit.gotoLine"),!0)},t.commandService.findCommand("orion.edit.gotoLine")),this.textSearcher&&i.setAction("find",function(e){return e?(t.textSearcher.show(e),!0):(t.commandService.runCommand("orion.edit.find"),!0)},t.commandService.findCommand("orion.edit.find"));var o=t.commandService.findCommand("orion.keyAssist");o&&(i.setKeyBinding(new a.KeyStroke(191,!1,!0,!y.isMac,y.isMac),o.id),i.setAction(o.id,o.callback,o)),this.bindingChangeListener=function(e){this._handleBindingChanges(i,e)}.bind(this),this.commandService.addEventListener("bindingChanged",this.bindingChangeListener)}},_handleBindingChanges:function(e,t){var i=e.getActions(!0);-1!==i.indexOf(t.id)&&(t.prevBinding&&e.setKeyBinding(t.prevBinding,null),e.setKeyBinding(t.newBinding,t.id))},showKeyBindings:function(t){var i=this.editor;if(i&&i.getTextView&&i.getTextView()){var n=i.getTextView(),o=n.getActions(!0).filter(function(e){var t=n.getActionDescription(e);return t&&t.name});o.sort(function(e,t){return n.getActionDescription(e).name.localeCompare(n.getActionDescription(t).name)}),t.createHeader(e.Editor);for(var r,s=function(e){return function(){return n.focus(),n.invokeAction(e)}},a={},l=0;l<o.length;l++){var c=o[l],d=n.getActionDescription(c),h=n.getKeyBindings(c);if(h.length>0)for(var u=0;u<h.length;u++){r=h[u];var p=_.getUserKeyString(r);r.scopeName?(a[r.scopeName]||(a[r.scopeName]=[]),a[r.scopeName].push({bindingString:p,name:d.name,execute:s(c)})):t.createItem(r,d.name,c,s(c))}else t.createItem(null,d.name,c,s(c))}for(var f in a)if(a[f].length){t.createHeader(f);for(var g=0;g<a[f].length;g++)r=a[f][g],t.createItem(r,r.name,r.name,r.execute)}}},_createSettingsCommand:function(){var t=this,i=new s.Command({imageClass:"core-sprite-wrench",tooltip:e.LocalEditorSettings,id:"orion.edit.settings",visibleWhen:function(e,i){var n=i.handler.editor||t.editor;return n&&n.installed&&i.handler.localSettings},callback:function(e){var o=this.localSettings||t.localSettings,r=i.settingsDropDown;if(!r||r.isDestroyed()){r=i.settingsDropDown=new n(e.domNode.parentNode,e.domNode,{noClick:!0,selectionClass:"dropdownSelection",onShow:function(){r.focus()},onHide:function(){t.editor.focus()}}),r.updateContent=o.show.bind(o);var s=r.getContentNode();s.tabIndex=s.style.marginTop=0}r.click()}});this.commandService.addCommand(i)},_createClipboardCommands:function(){if(y.isIE){var t=this,i=new s.Command({name:e.Copy,id:"orion.edit.copy",visibleWhen:function(e,i){var n=i.handler.editor||t.editor;return n&&n.installed},callback:function(){var e=this.editor||t.editor;if(e&&e.getTextView&&e.getTextView()){var i=e.getTextView();i.copy(),e.focus()}}});this.commandService.addCommand(i);var n=new s.Command({name:e.Cut,id:"orion.edit.cut",visibleWhen:function(e,i){var n=i.handler.editor||t.editor;return n&&n.installed},callback:function(){var e=this.editor||t.editor;if(e&&e.getTextView&&e.getTextView()){var i=e.getTextView();i.cut(),e.focus()}}});this.commandService.addCommand(n);var o=new s.Command({name:e.Paste,id:"orion.edit.paste",visibleWhen:function(e,i){var n=i.handler.editor||t.editor;return n&&n.installed},callback:function(){var e=this.editor||t.editor;if(e&&e.getTextView&&e.getTextView()){var i=e.getTextView();i.paste(),e.focus()}}});this.commandService.addCommand(o)}},_createUndoStackCommands:function(){var t=this,i=new s.Command({name:e.Undo,id:"orion.edit.undo",visibleWhen:function(e,i){var n=i.handler.editor||t.editor;return n&&n.installed},callback:function(){var e=this.editor||t.editor;e.getUndoStack().undo()}});this.commandService.addCommand(i);var n=new s.Command({name:e.Redo,id:"orion.edit.redo",visibleWhen:function(e,i){var n=i.handler.editor||t.editor;return n&&n.installed},callback:function(){var e=this.editor||t.editor;e.getUndoStack().redo()}});this.commandService.addCommand(n)},_createSaveCommand:function(){var t=this,i=new s.Command({name:e.Save,tooltip:e.saveFile,imageClass:"core-sprite-save",id:"orion.edit.save",visibleWhen:function(e,i){var n=i.handler.inputManager||t.inputManager,o=i.handler.editor||t.editor||n&&n.getEditor();return o&&o.installed&&n&&n.isSaveEnabled()?!0:!1},callback:function(){var e=this.inputManager||t.inputManager;e.save()}});this.commandService.addCommand(i)},_createEncodingCommand:function(){var t=this,i=["UTF-8","UTF-16LE","iso-8859-1","iso-8859-2","iso-8859-3","iso-8859-4","iso-8859-5","iso-8859-6","iso-8859-7","iso-8859-8","iso-8859-9","iso-8859-10","iso-8859-11","iso-8859-12","iso-8859-13","iso-8859-14","iso-8859-15","iso-8859-16","windows-1250","windows-1251","windows-1252","windows-1253","windows-1254","windows-1255","windows-1256","windows-1258","gb18030","gb2312","gbk","Big5","Big5-HKSCS","koi8-r","koi8-u","euc-jp","euc-tw","shift-jis","iso-2022-jp","iso-2022-kr","iso-2022-cn","hz","MacRoman"],n=new r("#{,resource,params*}"),o=new s.Command({name:e.ReloadWith,selectionClass:"dropdownSelection",id:"orion.edit.reloadWithEncoding",visibleWhen:function(){var e=t.editor;return e&&e.installed},choiceCallback:function(){return i.map(function(e){return{name:e,callback:function(){var e=v.matchResourceParameters(),t=e.resource;delete e.resource,delete e.encoding,"UTF-8"!==this.name&&(e.encoding=this.name),window.location.href=n.expand({resource:t,params:e})}}})}});this.commandService.addCommand(o)},_createGotoLineCommnand:function(){var t=this,i=new l.ParametersDescription([new l.CommandParameter("line","number",e.gotoLinePrompt)],{hasOptionalParameters:!1},function(i){var n=i.handler.editor||t.editor,o=n.getModel().getLineAtOffset(n.getCaretOffset())+1;return[new l.CommandParameter("line","number",e.gotoLinePrompt,o.toString())]}),n=new s.Command({name:e.gotoLine,tooltip:e.gotoLineTooltip,id:"orion.edit.gotoLine",visibleWhen:function(e,i){var n=i.handler.editor||t.editor;return n&&n.installed},parameters:i,callback:function(i){var n,o=this.editor||t.editor,r=o.getModel();i.parameters&&i.parameters.valueFor("line")?n=i.parameters.valueFor("line"):(n=r.getLineAtOffset(o.getCaretOffset()),n=prompt(e.gotoLinePrompt,n+1),n&&(n=parseInt(n,10))),n&&o.onGotoLine(n-1,0)}});this.commandService.addCommand(n)},_createFindCommnand:function(){var t=this,n=new l.ParametersDescription([new l.CommandParameter("find","text","Find:")],{clientCollect:!0},function(e){var i=e.handler.editor||t.editor,n=e.handler.textSearcher||t.textSearcher,o=i.getSelection(),r="";if(o.end>o.start){var s=i.getModel();r=s.getText(o.start,o.end),n&&n.getOptions().regex&&(r=m.escape(r))}return[new l.CommandParameter("find","text","Find:",r)]}),o=new s.Command({name:e.Find,tooltip:e.Find,id:"orion.edit.find",visibleWhen:function(e,i){var n=i.handler.editor||t.editor,o=i.handler.textSearcher||t.textSearcher;return n&&n.installed&&o},parameters:n,callback:function(e){var n=i.node("replaceCompareDiv");if(n&&n.classList.contains("replaceCompareDivVisible"))return!1;var r=this.editor||t.editor,s=this.textSearcher||t.textSearcher;o.textSearcher&&o.textSearcher!==s&&o.textSearcher.hide(),o.textSearcher=s;var a="",l=null,c=r.getSelection();if(e.parameters&&e.parameters.valueFor("find"))a=e.parameters.valueFor("find"),l=p.matchResourceParameters(),h.convertFindURLBinding(l);else if(c.end>c.start){var d=r.getModel();a=d.getText(c.start,c.end),s.getOptions().regex&&(a=m.escape(a))}if(l){s.setOptions({regex:l.regEx,caseInsensitive:!l.caseSensitive,wholeWord:l.wholeWord});var u={};l.atLine&&(u.start=r.getModel().getLineStart(l.atLine-1)),s.show({findString:a,replaceString:l.replaceWith}),s.find(!0,u),t.commandService.closeParameterCollector()}else s.show({findString:a})}});this.commandService.addCommand(o)},_createBlameCommand:function(){var t=this,i=new s.Command({name:e.Blame,tooltip:e.BlameTooltip,id:"orion.edit.blame",parameters:new l.ParametersDescription([new l.CommandParameter("blame","boolean")],{clientCollect:!0}),visibleWhen:function(e,i){var n=i.handler.editor||t.editor,o=i.handler.blamer||t.blamer;return n&&n.installed&&o&&o.isVisible()},callback:function(e){for(var i=!1,n=this.editor||t.editor,o=this.blamer||t.blamer,r=n.getAnnotationModel().getAnnotations();r.hasNext();){var s=r.next();if(s.type===g.AnnotationType.ANNOTATION_BLAME){i=!0;break}}i=!i,e.parameters&&e.parameters.valueFor("blame")&&(i="true"===e.parameters.valueFor("blame")),i?o.doBlame():n.showBlame([]),n.focus()}});this.commandService.addCommand(i)},_createDiffCommand:function(){var t=this,i=new s.Command({name:e.Diff,tooltip:e.DiffTooltip,id:"orion.edit.diff",visibleWhen:function(e,i){var n=i.handler.editor||t.editor,o=i.handler.differ||t.differ;return n&&n.installed&&o&&o.isVisible()},callback:function(){var e=this.editor||t.editor,i=this.differ||t.differ;i.toggleEnabled();var n=this.editorPreferences;n.getPrefs(function(e){e.diffService=i.isEnabled(),n.setPrefs(e)}),e.focus()}});this.commandService.addCommand(i)},_createShowTooltipCommand:function(){var t=this,i=new s.Command({name:e.showTooltip,tooltip:e.showTooltipTooltip,id:"orion.edit.showTooltip",visibleWhen:function(e,i){var n=i.handler.editor||t.editor;return n&&n.installed},callback:function(){var e=this.editor||t.editor,i=e.getTooltip(),n=e.getTextView(),o=n.getCaretOffset(),r=n.getLocationAtOffset(o);i.show({x:r.x,y:r.y,getTooltipInfo:function(){return e._getTooltipInfo(this.x,this.y)}},!1,!0)}});this.commandService.addCommand(i)},_onServiceRemoved:function(e){-1!==e.getProperty("objectClass").indexOf("orion.edit.command")&&(this._recreateEditCommands=!0),-1!==e.getProperty("objectClass").indexOf("orion.core.contenttype")&&(L=null)},_onServiceAdded:function(e){-1!==e.getProperty("objectClass").indexOf("orion.edit.command")&&(this._recreateEditCommands=!0),-1!==e.getProperty("objectClass").indexOf("orion.core.contenttype")&&(L=null)},_createEditCommands:function(){function i(e){if(L)return L;var t=e.getService("orion.core.contentTypeRegistry");return t||(t=new d.ContentTypeRegistry(e),t=e.getService("orion.core.contentTypeRegistry")),t.getContentTypes().then(function(e){return L=e})}var n=this;this._recreateEditCommands=!1;var r=this.serviceRegistry,a=this.commandService,l=r.getServiceReferences("orion.edit.command"),h=r.getService("orion.page.progress"),p=r.getService("orion.page.message"),f=w.bind(null,r),g=function(i,o,r){var a=r.visibleWhen;return r.visibleWhen=function(e,t){var o=t.handler.editor||n.editor,r=t.handler.inputManager||n.inputManager;return o&&o.installed&&r?i.editor&&o.id&&i.editor!==o.id?!1:n.inputManager.getReadOnly()?!1:!a||a(e):!1},r.callback=function(s){var a,l,c=this.editor||n.editor,d=this.inputManager||n.inputManager,g=c.getSelection?c.getSelection():{start:0,end:0},m=c.getModel(),v=function(e){"object"==typeof e&&e?(e.text&&c.setText(e.text),e.selection&&(c.setSelection&&c.setSelection(e.selection.start,e.selection.end,!0),c.focus())):"string"==typeof e&&(c.setText(e,g.start,g.end,!0),c.setSelection&&c.setSelection(g.start,g.start+e.length),c.focus())};if(o.execute){var _={contentType:d.getContentType(),input:d.getInput(),offset:c.getCaretOffset()};"orion.edit.quickfix"===i.scopeId&&(_.annotation={start:s.userData.start,end:s.userData.end,title:s.userData.title,id:s.userData.id,data:s.userData.data});var y=c.getEditorContext();y.openDelegatedUI=function(){var e=arguments[0];e=e||{},e.done=v,e.status=f,e.params=e.params||{},u.mixin(e.params,d.getFileMetadata()),C.apply(null,Array.prototype.slice.call(arguments))},y.setStatus=f,c.focus(),a=o.execute(y,_)}else a=o.run(m.getText(g.start,g.end),m.getText(),g,d.getInput());l=function(e){if(e&&e.uriTemplate){var t={};t.uriTemplate=e.uriTemplate,t.params=d.getFileMetadata(),t.id=i.id,t.width=e.width,t.height=e.height,t.done=v,t.status=f,C(t)}else e&&e.searchParams&&e.refResult?n.sideBar&&n.sideBar.fillSearchPane(e.searchParams.keyword,{Location:e.searchParams.resource},e):e&&(e.Status||e.status)?f(e.Status||e.status):v(e)};var w=t.formatMessage(e.running,r.name);return p&&p.createProgressMonitor(a,w),h.showWhile(a,w).then(l),!0},new s.Command(r)};return o.when(i(this.serviceRegistry),function(){var e=[];return l.forEach(function(t){for(var i=n.serviceRegistry.getService(t),o={},r=t.getPropertyKeys(),s=0;s<r.length;s++)o[r[s]]=t.getProperty(r[s]);o.forceSingleItem=!0;var l=c._createCommandOptions(o,t,n.serviceRegistry,L,!1,function(){return n.inputManager.getFileMetadata()}).then(function(e){var t=g(o,i,e);return t.editInfo=o,a.addCommand(t),t});e.push(l)}),o.all(e,b)})}},x.EditorCommandFactory=S,x.handleStatusMessage=w,x}),define("jazzui/oslc/oslc",[],function(){var e={};return e.OslcUiConsumer=function(){function e(){this.listeners=[]}return e.prototype={addListener:function(e){this.listeners.push(e)},handlePostMessage:function(e){var t=e;try{var t=JSON.parse(e)}catch(i){}for(var n=0;n<this.listeners.length;n++)"function"==typeof this.listeners[n]&&this.listeners[n](t)},isPostMessageSupported:function(){return"function"==typeof window.postMessage},createUI:function(e,t){var i=this;if(!this.isPostMessageSupported())return void console.warn("postMessage not supported");var n=function(e){var t="oslc-response:",r="com.ibm.team.jazzhub.SimpleCreateProject:";"string"==typeof e.data&&(0===e.data.indexOf("fork-dialog-new-height")?o.parentNode.style.height=e.data.split(":")[1].trim():0===e.data.indexOf(t)?(window.removeEventListener("message",n,!1),i.handlePostMessage(e.data.substr(t.length))):0===e.data.indexOf(r)&&(window.removeEventListener("message",n,!1),i.handlePostMessage(e.data.substr(r.length))))};window.addEventListener("message",n,!1);var o=document.createElement("iframe");e+="#oslc-postMessage-1.0",o.src=e,o.style.width="100%",o.style.height="100%",o.style.border="0px",o.style.overflow="auto",t.appendChild(o)}},e}(),e}),define("orion/selection",["orion/EventTarget"],function(e){function t(t,i){i||(i="orion.page.selection"),this._serviceRegistry=t,e.attach(this),this._serviceRegistration=t.registerService(i,this),this._selections=null}return t.prototype={getSelection:function(e){var t=this._getSingleSelection();return"function"==typeof e&&e(t),t},getSelections:function(e){var t=Array.isArray(this._selections)?this._selections.slice():[];return"function"==typeof e&&e(t),t},_getSingleSelection:function(){return this._selections&&this._selections.length>0?this._selections[0]:null},setSelections:function(e){var t=this._selections;this._selections=Array.isArray(e)?e.length>0?e.slice():null:e?[e]:null,t!==this._selections&&this.dispatchEvent({type:"selectionChanged",selection:this._getSingleSelection(),selections:this._selections})}},t.prototype.constructor=t,{Selection:t}}),define("orion/jazzui/widgets/DirectoryPrompterDialog",["orion/uiUtils","orion/explorers/explorer","orion/webui/dialog","orion/selection"],function(e,t,i,n){function o(e,t){this.explorer=t,this._init(e)}function r(e){this._init(e)}return o.prototype=new t.SelectionRenderer,o.prototype.constructor=o,o.prototype.getLabelColumnIndex=function(){return 0},o.prototype.getCellElement=function(e,t,i){var n=document.createElement("td");i.appendChild(n);var o=document.createElement("span");if(o.id=i.id+"navSpan",n.appendChild(o),o.className="mainNavColumn singleNavColumn",t.folders)this.getExpandImage(i,o),o.appendChild(document.createTextNode("Your Jazz Sandbox"));else{var r=document.createElement("span");r.className="fileItem",o.appendChild(r),o.appendChild(document.createTextNode(t.name))}},r.prototype=new i.Dialog,r.prototype.TEMPLATE='<div id="message" style="width: 25em; padding-bottom: 5px;"></div><div id="directoryTree" class="explorerTreeClass" style="width:25em; min-height: 25em; max-height:30em; height: auto; overflow-y: auto;"></div>',r.prototype._init=function(e){this.title=e.title||"Choose a Folder",this._serviceRegistry=e.serviceRegistry,this.modal=!0,this.buttons=[{id:"okbutton",text:"OK",callback:this.done.bind(this)}],this._func=e.func,this.folders=e.folders,this._initialize()},r.prototype._bindToDom=function(){this.loadFolderList({Children:[this.folders]}),this._message?this.$message.appendChild(document.createTextNode(this._message)):this.$message.style.display="none",this.$directoryTree.focus()},r.prototype.loadFolderList=function(e){var i=new t.ExplorerModel;i.root=e,i.getRoot=function(e){e(this.root)},i.getId=function(e){var t;return e.name?(t=e.name,t.replace(/[^\.\:\-\_0-9A-Za-z]/g,"")):"root"},i.mayHaveChildren=function(e){return e.folders||e.Children?!0:!1},i.getChildren=function(e,t){e.folders&&t(e.folders),e.Children&&t(e.Children)},this.createExplorer(i)},r.prototype.createExplorer=function(e){var i=this;this.selection=new n.Selection(this._serviceRegistry,"jazzui.directoryPrompter.selection"),this.selection.addEventListener("selectionChanged",i.validate.bind(i)),this.explorer=new t.Explorer(this._serviceRegistry,this.selection),this.explorer.renderer=new o({checkbox:!1,singleSelection:!0,treeTableClass:"directoryPrompter"},this.explorer),this.explorer.createTree(this.$directoryTree.id,e,{setFocus:!0,selectionPolicy:this.explorer.renderer.selectionPolicy,onCollapse:function(e){i.getNavHandler()&&i.getNavHandler().onCollapse(e)}})},r.prototype.validate=function(){var e=this;this.selection.getSelection(function(t){return null===t||t.folders?(e.$okbutton.classList.add(e.DISABLED),void(e.$okbutton.disabled=!0)):(e.$okbutton.classList.remove(e.DISABLED),void(e.$okbutton.disabled=!1))})},r.prototype.done=function(){this.selection.getSelection(function(e){this.hide(),this._func(e)}.bind(this))},r.prototype.constructor=r,{DirectoryPrompterDialog:r}}),define("orion/jazzui/widgets/JazzLoginDialog",["orion/webui/dialog"],function(e){function t(e){this._init(e)}return t.prototype=new e.Dialog,t.prototype.TEMPLATE='<div style="padding: 5px;" id="repositoryUrlRow"><div style="float: left; width: 150px;"><label id="repositoryUrlLabel" for="repositoryUrl"></label></div><input id="repositoryUrl" style="width: 300px;" value=""></div><div style="padding: 5px;" id="userIdRow"><div style="float: left; width: 150px;"><label id="userIdLabel" for="userId"></label></div><input id="userId" style="width: 200px;" value=""></div><div style="padding: 5px;" id="passwordRow"><div style="float: left; width: 150px;"><label id="passwordLabel" for="password"></label></div><input type="password" id="password" style="width: 200px;" value=""></div><div style="padding: 5px" id="jazzSaveCredentialsRow"><div style="float: left; width: 150px;"><label id="jazzSaveCredentialsLabel" for="jazzSaveCredentials"></label></div><input id="jazzSaveCredentials" type="checkbox" name="jazzSaveCredentials"></div>',t.prototype._init=function(e){this.options=e||{},this.title=this.options.title||"Jazz Login",this.modal=!0,this.buttons=[{text:"OK",isDefault:!0,callback:this.done.bind(this)}],this._func=e.func,this._initialize()},t.prototype._bindToDom=function(){this.$repositoryUrlLabel.appendChild(document.createTextNode("Repository URL:")),this.$userIdLabel.appendChild(document.createTextNode("User Id:")),this.$passwordLabel.appendChild(document.createTextNode("Password:")),this.$jazzSaveCredentialsLabel.appendChild(document.createTextNode("Don't prompt me again:")),this.options.repositoryUrl&&(this.$repositoryUrl.value=this.options.repositoryUrl),this.options.repositoryUser&&(this.$userId.value=this.options.repositoryUser)},t.prototype.done=function(){var e=document.createElement("a");e.href=this.$repositoryUrl.value,this.options.func(this.$repositoryUrl.value,e.host,this.$userId.value,this.$password.value,this.$jazzSaveCredentials.checked),this.hide()},t.prototype.constructor=t,{JazzLoginDialog:t}}),define("orion/jazzui/widgets/DelegatedUIDialog",["orion/webui/dialog","orion/webui/littlelib"],function(e,t){function i(e){this._init(e);var t=this,i=this.$frame;setTimeout(function(){var e=t.$frame.firstChild;e.addEventListener("mousedown",function(i){t._dragging=!0,e.setCapture&&e.setCapture(),t.start={screenX:i.screenX,screenY:i.screenY}}),e.addEventListener("mousemove",function(e){if(t._dragging){var n=e.screenX-t.start.screenX,o=e.screenY-t.start.screenY;t.start.screenX=e.screenX,t.start.screenY=e.screenY;var r=parseInt(i.style.left)+n,s=parseInt(i.style.top)+o;i.style.left=r+"px",i.style.top=s+"px"}}),e.addEventListener("mouseup",function(){t._dragging=!1,e.releaseCapture&&e.releaseCapture()})})}return i.prototype=new e.Dialog,i.prototype.TEMPLATE='<style>div.dialogStatusBarBox {width: 70%;display: inline-block;background-color: #C2E0FF;padding: 5px;margin-top: 2px;margin-right: 5px;text-align: center;border-radius: 8px;-moz-border-radius: 8px;}span.dialogStatusBarBoxProgress {text-decoration: blink;}</style><div id="delegatedUIContainer"></div>',i.prototype.setStatus=function(e){t.empty(this.$delegatedUIContainer);var i=document.createElement("center"),n=document.createElement("div");n.className="dialogStatusBarBox",n.appendChild(document.createTextNode(e));var o=document.createElement("span");o.className="dialogStatusBarBoxProgress",o.appendChild(document.createTextNode("...")),n.appendChild(o),i.appendChild(n),this.$delegatedUIContainer.appendChild(i)},i.prototype._init=function(e){this.options=e||{},this.title=this.options.title||"",this.width=this.options.width||"400px",this.height=this.options.height||"400px",this.modal=!0,this._initialize()},i.prototype._bindToDom=function(){this.$delegatedUIContainer.style.width=this.width,this.$delegatedUIContainer.style.height=this.height},i.prototype.constructor=i,{DelegatedUIDialog:i}}),define("orion/jazzui/jazzPreferenceStorage",["orion/Deferred"],function(e){function t(e){this._prefix="/jazz/credentials",this._preferenceService=e.getService("orion.core.preference")}return t.prototype={put:function(t,i){var n=this,o={jazzPassword:i},r=new e;return this._preferenceService.get(this._prefix,void 0,{scope:2}).then(function(e){n.isEnabled().then(function(i){i?(-1===t.indexOf("/",t.length-1)&&(t+="/"),e[t]=o,this._preferenceService.put(this._prefix,e,{scope:2}).then(r.resolve,r.reject)):r.reject()})}),r},get:function(t){var i=this,n={jazzPassword:""},o=new e;return this._preferenceService.get(this._prefix,void 0,{scope:2}).then(function(e){i.isEnabled().then(function(i){if(i){-1===t.indexOf("/",t.length-1)&&(t+="/");var r=e[t];o.resolve(void 0!==r?r:n)}else o.reject()})}),o},isEnabled:function(){var t=new e;return t.resolve(!0),t},remove:function(e){return-1===e.indexOf("/",e.length-1)&&(e+="/"),this._preferenceService.remove(this._prefix,e,{scope:2})},getRepositories:function(){var t=new e;return this._preferenceService.get(this._prefix,void 0,{scope:2}).then(function(e){for(var i=[],n=Object.keys(e),o=0;o<n.length;++o)"settings"!==n[o]&&i.push(n[o]);t.resolve(i)}),t}},t.prototype.constructor=t,t}),define("orion/compare/compareUtils",["orion/URITemplate"],function(e){var t=t||{};return t.compareUtils=t.compareUtils||{},t.compareUtils.lookUpMapper=function(e,t,i){for(var n=0,o=0;o<e.length;o++){var r=e[o][t];if(0===r&&(r=1),i>=n&&n+r>i)return{mapperIndex:o,startFrom:n};if(o===e.length-1)break;n+=e[o][t]}return{mapperIndex:e.length-1,startFrom:n}},t.compareUtils.lookUpLineIndex=function(e,t,i){if(0===i)return 0;for(var n=0,o=0;i>o;o++)n+=e[o][t];return n},t.compareUtils.updateMapper=function(e,i,n,o,r){if(o!==r&&(o>0||r>0)){var s=t.compareUtils.lookUpMapper(e,i,n);if(s.mapperIndex<0)return;if(o>0)for(var a=o,l=n-s.startFrom,c=s.mapperIndex;c<e.length;c++){var d=e[c][i]-l;if(d>=a){e[c][i]-=a;break}e[c][i]-=d,a-=d,l=0}r>0&&(e[s.mapperIndex][i]+=r)}},t.compareUtils.overlapMapper=function(e,t,i,n,o){var r=i+e[t]-1;return i>r&&(r=i),n>o&&(o=n),n>r||i>o?!1:!0},t.compareUtils.findFirstDiff=function(e,i,n,o){for(var r=0,s=null,a=0;a<e.length&&!(r>o)&&(!t.compareUtils.overlapMapper(e[a],i,r,n,o)||(s={mapperIndex:a,startFrom:r},0===e[a][2]));a++)r+=e[a][i];return s},t.compareUtils.matchMapper=function(e,i,n,o){if(0===e.length)return n;var r=n+Math.round((o-n)/3),s=t.compareUtils.findFirstDiff(e,i,n,o),a=0===e[s.mapperIndex][i]?s.startFrom:s.startFrom+e[s.mapperIndex][i]-1,l=t.compareUtils.lookUpLineIndex(e,1-i,s.mapperIndex),c=s.startFrom-n;if(0===e[s.mapperIndex][2])return l-c;if(r>=s.startFrom&&a>=r)return l-Math.round((o-n)/3);if(r<s.startFrom)return l-c;var d=0===e[s.mapperIndex][1-i]?l:l+e[s.mapperIndex][1-i]-1;return d-(a-n)},t.compareUtils.getMapperLineCount=function(e){for(var t=0,i=0;i<e.length;i++)t+=Math.max(e[i][0],e[i][1]);return t},t.compareUtils.getAnnotationIndex=function(e,t){for(var i=0;i<e.length;i++)if(e[i][0]===t)return i;return-1},t.compareUtils.getAnnotationMapperIndex=function(e,t){return e[t][1]},t.compareUtils.getAnnotationIndexByMapper=function(e,t){for(var i=0;i<e.length;i++)if(e[i][1]===t)return{current:i,prev:i-1,next:i+1};return{current:-1,prev:-1,next:-1}},t.compareUtils.isMapperConflict=function(e,t){return 0>t?!1:e[t][3]?1===e[t][3]:!1},t.compareUtils.mergeDiffBlocks=function(e,t,i,n,o,r){for(var s=0;s<t.length;s++){var a=t[s][0],l=t[s][1],c=i[l];if(c[0]>0){for(var d="",h=0;h<c[0];h++){var u=n[c[2]-1+h];u?d=d+u.substring(o)+r:d+=r}var p=e.getLineCount();if(a>=p){var f=e.getLineEnd(p-1),g=e.getLineEnd(p-1,!0);f===g?(e.setText(r,f,f),a=p):a=p-1}var m=e.getLineStart(a);e.setText(d,m,m)}}},t.compareUtils.convertMergedLineNumber=function(e,i,n){var o=t.compareUtils.lookUpMapper(e,n?1:0,i),r=i;if(n||0===e[o.mapperIndex][2]||(r+=e[o.mapperIndex][1]),o.mapperIndex<0)return r;for(var s=0;s<o.mapperIndex;s++)0!==e[s][2]&&(r+=e[s][n?0:1]);return r},t.compareUtils.generateCompareHref=function(t,i){var n="../compare/compare.html";i.conflict||(i.conflict=void 0),i.readonly||(i.readonly=void 0);var o=new e(n+"#{,resource,params*}").expand({resource:t,params:i});return o},t.compareUtils.generateCompareTreeHref=function(t,i){var n="../compare-tree/compare-tree.html",o=new e(n+"#{,resource,params*}").expand({resource:t,params:i});return o},t.compareUtils.fullNameByMeta=function(e){var t,i=e.Parents,n=i.length,o="";if(n>0)for(var r=n-1;r>-1;r--)t=""===o?"":"/",o=o+t+i[r].Name;return t=""===o?"":"/",o=o+t+e.Name},t.compareUtils}),define("orion/jazzui/widgets/ChangeSetPrompterDialog",["orion/uiUtils","orion/explorers/explorer","orion/webui/dialog","orion/selection"],function(e,t,i,n){function o(e,t){this.explorer=t,this._init(e)}function r(e){this._init(e)}return o.prototype=new t.SelectionRenderer,o.prototype.constructor=o,o.prototype.getLabelColumnIndex=function(){return 0},o.prototype.getCellElement=function(e,t,i){var n=document.createElement("td");i.appendChild(n);var o=document.createElement("span");o.id=i.id+"navSpan",n.appendChild(o),o.className="mainNavColumn singleNavColumn";var r=document.createElement("span");r.className="jazz-decor-icon jazzImageSprite "+(t.isCurrent?"jazz-sprite-currentchangeset":"jazz-sprite-changeset"),o.appendChild(r);var s=document.createElement("span");s.textContent=t.workItems?t.Workitems[0].Summary+(t.Comment?" - "+t.Comment.substring(0,60)+"...":""):t.Comment,o.appendChild(s)},r.prototype=new i.Dialog,r.prototype.TEMPLATE='<div id="message" style="width: 25em; padding-bottom: 5px;"></div><div id="directoryTree" class="explorerTreeClass" style="width:25em; min-height: 25em; max-height:30em; height: auto; overflow-y: auto;"></div>',r.prototype._init=function(e){this.title=e.title||"Choose Change Set",this._serviceRegistry=e.serviceRegistry,this.modal=!0,this.buttons=[{id:"okbutton",text:"OK",callback:this.done.bind(this)}],this._func=e.func,this.changeSets=e.changeSets,this._initialize()},r.prototype._bindToDom=function(){this.loadFolderList(this.changeSets),this._message?this.$message.appendChild(document.createTextNode(this._message)):this.$message.style.display="none",this.$okbutton.classList.add(self.DISABLED),this.$okbutton.disabled=!0,this.$directoryTree.focus()},r.prototype.loadFolderList=function(e){var i=new t.ExplorerModel;i.root=e,i.getRoot=function(e){e(this.root)},i.getId=function(e){return e.ItemId?e.ItemId.replace(/[^\.\:\-\_0-9A-Za-z]/g,""):"root"},i.mayHaveChildren=function(e){return Array.isArray(e)?!0:!1},i.getChildren=function(e,t){return Array.isArray(e)?void t(e):void 0},this.createExplorer(i)},r.prototype.createExplorer=function(e){var i=this;this.selection=new n.Selection(this._serviceRegistry,"jazzui.ChangeSetPrompter.selection"),this.selection.addEventListener("selectionChanged",i.validate.bind(i)),this.explorer=new t.Explorer(this._serviceRegistry,this.selection),this.explorer.renderer=new o({checkbox:!1,singleSelection:!0,treeTableClass:"DirectoryPrompter"},this.explorer),this.explorer.createTree(this.$directoryTree.id,e,{setFocus:!0,selectionPolicy:this.explorer.renderer.selectionPolicy,onCollapse:function(e){i.getNavHandler()&&i.getNavHandler().onCollapse(e)}})},r.prototype.validate=function(){var e=this;this.selection.getSelection(function(t){return t?(e.$okbutton.classList.remove(e.DISABLED),void(e.$okbutton.disabled=!1)):(e.$okbutton.classList.add(e.DISABLED),void(e.$okbutton.disabled=!0))})},r.prototype.done=function(){this.selection.getSelection(function(e){this.hide(),this._func(e)
}.bind(this))},r.prototype.constructor=r,{ChangeSetPrompterDialog:r}}),define("orion/jazzui/jazzCommands",["require","orion/Deferred","orion/webui/littlelib","orion/commands","orion/commandRegistry","jazzui/oslc/oslc","orion/jazzui/pageUtil","orion/URITemplate","orion/jazzui/widgets/DirectoryPrompterDialog","orion/jazzui/widgets/JazzLoginDialog","orion/jazzui/widgets/DelegatedUIDialog","orion/jazzui/jazzPreferenceStorage","orion/compare/compareUtils","text!jconfig/jazzhuburl","orion/jazzui/widgets/ChangeSetPrompterDialog","orion/URL-shim"],function(e,t,i,n,o,r,s,a,l,c,d,h,u,p,f){var g={};return function(){function s(e,i,n){var o=new t,r=new h(n);return r.isEnabled().then(function(t){if(t){var n=e+"@"+i;r.get(n).then(function(e){o.resolve(e)},function(){o.resolve({jazzPassword:""})})}else o.resolve({jazzPassword:""})}),o}var l,u=!1;g.createDelegatedUIDialog=function(e){return l=new d.DelegatedUIDialog({title:e,width:"500px",height:"490px"}),l.show(),l.$delegatedUIContainer},g.checkJazzError=function(e,t){if(e&&e.errorCode){var i=[];return i.Severity="Error",i.HTML=!1,i.Message=e.errorMessage||"Unknown error from jazz server: "+e.errorCode,t.setProgressResult(i),!0}if(e&&e["soapenv:Body"]&&e["soapenv:Body"].response&&e["soapenv:Body"].response.returnValue&&e["soapenv:Body"].response.returnValue.value&&e["soapenv:Body"].response.returnValue.value.errors&&e["soapenv:Body"].response.returnValue.value.errors.length>0){var i=[];return i.Severity="Error",i.HTML=!1,i.Message=e["soapenv:Body"].response.returnValue.value.errors[0].message||"An error occurred in Jazz",t.setProgressResult(i),!0}return!1},g.asyncLoginToJazz=function(e,i,n,r){var a=new t,l={callback:function(e){e?a.reject(e):a.resolve()}};return s(r,n,i).then(function(t){if(""!==t.jazzPassword){var i=new o.ParametersDescription([new o.CommandParameter("password","password","password",t.jazzPassword)],{clientCollect:!0});e.runCommand("orion.jazz.command.loginCommand",{user:r,repositoryUrl:n},l,i)}else{var s=[];if(r){var a=n.indexOf(p)>-1?"Provide your JazzHub password to access the source code repository:":"Provide password for "+r+" to access the source code repository @ "+n+":";s=[new o.CommandParameter("password","password",a),new o.CommandParameter("saveCredentials","boolean","Don't prompt me again:")]}else{var c=n.indexOf(p)>-1?"To access the source code repository, provide your JazzHub login:":"To access the source code repository @ "+n+", provide login:";s=[new o.CommandParameter("user","user",c),new o.CommandParameter("password","password","and password:"),new o.CommandParameter("saveCredentials","boolean","Don't prompt me again:")]}var i=new o.ParametersDescription(s);e.runCommand("orion.jazz.command.loginCommand",{user:r,repositoryUrl:n},l,i)}}),a},g.loginToJazz=function(e,t,i,n){s(n,i,t).then(function(t){if(""!==t.jazzPassword){var r=new o.ParametersDescription([new o.CommandParameter("password","password","password",t.jazzPassword)],{clientCollect:!0});e.runCommand("orion.jazz.command.loginCommand",{user:n,repositoryUrl:i},null,r)}else{var s=[];if(n){var a=i.indexOf(p)>-1?"Provide your JazzHub password to access the source code repository:":"Provide password for "+n+" to access the source code repository @ "+i+":";s=[new o.CommandParameter("password","password",a),new o.CommandParameter("saveCredentials","boolean","Don't prompt me again:")]}else{var l=i.indexOf(p)>-1?"To access the source code repository, provide your JazzHub login:":"To access the source code repository @ "+i+", provide login:";s=[new o.CommandParameter("user","user",l),new o.CommandParameter("password","password","and password:"),new o.CommandParameter("saveCredentials","boolean","Don't prompt me again:")]}var r=new o.ParametersDescription(s);e.runCommand("orion.jazz.command.loginCommand",{user:n,repositoryUrl:i},null,r)}})};var m=["com.ibm.team.repository.common.transport.ServiceMethodInvocationError"];g.handleError=function(e,t){var i={};i.Severity="Error",i.HTML=!1;var n;try{n=JSON.parse(e.responseText)}catch(o){n=e.responseText||e}if(n.errorClass){for(var r=!1,s=0;s<m.length;++s){var a=m[s];if(a===n.errorClass){r=!0;break}}if(r)return i.Message="Sorry, something went wrong! Please try refreshing in a moment. If the problem still occurs, contact the administrator!",void t.setProgressResult(i)}i.Message=n.DetailedMessage&&n.DetailedMessage.length>300?n.Message:n.DetailedMessage||n.Message||n.errorMessage||n,t.setProgressResult(i)},g.loadComponents=function(e,i,n,o,r){return null==r&&(r=new t),o.length>0?e.loadWorkspace(i,n,o[0].ItemId).then(function(){g.loadComponents(e,i,n,o.slice(1),r)},function(e){r.reject(e)},function(e){r.progress(e)}):r.resolve(),r},g.unloadComponents=function(e,i,n,o,r){return r=r||new t,o.length>0?e.unloadWorkspace(i,n,o[0].ItemId).then(function(){g.unloadComponents(e,i,n,o.slice(1),r)},function(e){r.reject(e)},function(e){r.progress(e)}):r.resolve(),r},g.updateNavTools=function(e,t,n,o,r,s,a){var l=i.node(o);if(!l)throw"could not find toolbar "+o;if(i.empty(l),t.renderCommands(o,l,s,n,"button"),a){var c=i.node(a);c&&(t.destroy(c),t.renderCommands(a,c,s,n,"button"))}if(r){var d=i.node(r);d&&(i.empty(d),t.renderCommands(r,d,null,n,"button"))}u||(u=!0,e.getService("orion.page.selection").addEventListener("selectionChanged",function(e,o){var s=i.node(r);s&&(i.empty(s),t.renderCommands(r,s,o,n,"button"))}))},g.createJazzCommands=function(i,s,d){function u(e,n,o){var r=Array.isArray(e.items)?e.items:[e.items],a=[],l=i.getService("orion.jazz.service"),c=i.getService("orion.page.progress");s.confirm(e.domNode,n,"Yes","No",!1,function(e){e&&(r.forEach(function(e){var i=new t;c.progress(l.deleteWorkspace(e.Project.Location,e.ItemId),o).then(i.resolve,function(e){g.handleError(e,c),i.reject(e)})}),t.all(a).then(function(){d.changedItem()}.bind(this)))})}var p=new o.ParametersDescription([new o.CommandParameter("changeSetComment","text","Change Set Comment:")]),m=new n.Command({name:"Create Change Set",tooltip:"Create a new empty change set",id:"orion.jazz.command.createChangeSetCommand",imageClass:"jazz-sprite-add",parameters:p,callback:function(e){var t=e.items,n=t.parent,o=t.Project,r=i.getService("orion.jazz.service"),s=i.getService("orion.page.progress"),a=e.parameters.valueFor("changeSetComment");s.showWhile(r.createChangeSet(o.Location,n.ItemId,t.ItemId,a),"Creating change set...").then(function(){d.changedItem()},function(e){g.handleError(e,s)})},visibleWhen:function(e){return Array.isArray(e)||(e=[e]),e.every(function(e){return"Component"===e.Type||"ChangeSet"===e.Type&&"Outgoing"===e.Kind})}});s.addCommand(m);var v=new n.Command({name:"Check-in",tooltip:"Check-in all files and folders",id:"orion.jazz.command.checkinCommand",callback:function(e){var t=e.items,n=i.getService("orion.jazz.service"),o=i.getService("orion.page.progress"),r=t,s=r.parent,a=s.Project;o.showWhile(n.checkIn(a.Location,s.ItemId,r.ItemId,null,null,!0),"Checking-in...").then(function(){d.changedItem()},function(e){g.handleError(e,o)})},visibleWhen:function(e){return"Component"===e.Type&&(e.Unresolved||e.Unshared)?!0:!1}});s.addCommand(v);var _=new n.Command({name:"Check-in",tooltip:"Check-in selected files and folders",id:"orion.jazz.command.checkInFileCommand",callback:function(e){var n=Array.isArray(e.items)?e.items:[e.items],o=i.getService("orion.jazz.service"),r=i.getService("orion.page.progress");if(n.length){var s=n[0].parent,a=s.parent,l=a.Project,c=[];n.forEach(function(e){"LocalChange"===e.Type&&c.push(e.Path)}),n.forEach(function(e){"UnsharedChange"===e.Type&&c.push(e.name)});var h=new t;c.length?h=o.checkIn(l.Location,a.ItemId,s.ItemId,null,c,!0):h.resolve(null),r.showWhile(h,"Checking-in...").then(function(){d.changedItem()},function(e){g.handleError(e,r)})}},visibleWhen:function(e){return Array.isArray(e)||(e=[e]),e.every(function(e){return"LocalChange"===e.Type||"UnsharedChange"===e.Type})}});s.addCommand(_);var y=new n.Command({name:"Deliver",tooltip:"Deliver change set(s) to the stream",id:"orion.jazz.command.deliverCommand",callback:function(e){function n(e){var i=new t,n=e,o=n.ItemId,a=n.parent,l=a.Project;return s.showWhile(r.deliver(l.Location,a.ItemId,a.TargetItemId,o),"Delivering...").then(i.resolve,function(e){g.handleError(e,s),i.reject(e)}),i}var o=Array.isArray(e.items)?e.items:[e.items],r=i.getService("orion.jazz.service"),s=i.getService("orion.page.progress"),a=[],l=[];if(o.forEach(function(e){"Component"===e.Type?a.push(n(e)):"ChangeSet"===e.Type&&e.Outgoing&&l.push(e.ItemId)}),l.length>0){var c=o[0].parent,h=c.parent,u=h.Project,p=new t;a.push(p),s.showWhile(r.deliver(u.Location,h.ItemId,h.TargetItemId,null,l),"Delivering...").then(p.resolve,function(e){g.handleError(e,s),p.reject(e)})}t.all(a).then(function(){d.changedItem()}.bind(this))},visibleWhen:function(e){function t(e){return"ChangeSet"===e.Type&&"Outgoing"===e.Kind||"Component"===e.Type&&(e.LocalAdded||e.LocalRemoved||e.Outgoing)?!0:void 0}return e.length>0?e.every(t):t(e)}});s.addCommand(y);var C=new n.Command({name:"Accept",tooltip:"Accept incoming change set(s) from the stream",id:"orion.jazz.command.acceptCommand",callback:function(e){function n(e){var i=new t,n=e,o=n.ItemId,a=n.parent,l=a.Project;return s.showWhile(r.accept(l.Location,a.TargetItemId,a.ItemId,o),"Accepting...").then(i.resolve,function(e){g.handleError(e,s),i.reject(e)}),i}var o=Array.isArray(e.items)?e.items:[e.items],r=i.getService("orion.jazz.service"),s=i.getService("orion.page.progress"),a=[],l=[];if(o.forEach(function(e){"Component"===e.Type?a.push(n(e)):"ChangeSet"===e.Type&&e.Incoming&&l.push(e.ItemId)}),l.length>0){var c=new t;a.push(c);var h=o[0].parent,u=h.parent,p=u.Project;s.showWhile(r.accept(p.Location,u.TargetItemId,u.ItemId,null,l),"Accepting...").then(c.resolve,function(e){g.handleError(e,s)})}t.all(a).then(function(){d.changedItem()}.bind(this))},visibleWhen:function(e){function t(e){return"ChangeSet"===e.Type&&e.Incoming||"Component"===e.Type&&(e.TargetAdded||e.TargetRemoved||e.Incoming)}return e.length>0?e.every(t):t(e)}});s.addCommand(C);var w=new n.Command({name:"Add Repository...",tooltip:"Log in to a Jazz repository",id:"orion.jazz.command.loginCommand",callback:function(e){var t=this,n=e.items,o=i.getService("orion.jazz.service"),r=i.getService("orion.page.progress"),a=function(e,t){var n=new h(i);n.isEnabled().then(function(o){if(o){var r=e+"@"+t;n.remove(r).then(function(){g.loginToJazz(s,i,t,e)})}else g.loginToJazz(s,i,t,e)})},l=function(e,n,s,l,c){r.showWhile(o.login(e,n,s,l),"Logging in to "+e).then(function(n){if(g.checkJazzError(n,r))return void a(s,e);if(c&&confirm("Please be aware that your credentials will be stored persistently in the browser. Do you wish to save them anyway?")){var o=new h(i);o.isEnabled().then(function(t){if(t){var i=s+"@"+e;o.put(i,l)}})}return t.callback?t.callback():d.changedItem()},function(){a(s,e)})},u=e.parameters&&e.parameters.valueFor("saveCredentials")?e.parameters.valueFor("saveCredentials"):!1;if(n.repositoryUrl&&n.user&&e.parameters.valueFor("password"))l(n.repositoryUrl,n.repositoryUrl,n.user,e.parameters.valueFor("password"),u);else if(n.repositoryUrl&&e.parameters.valueFor("user")&&e.parameters.valueFor("password"))l(n.repositoryUrl,n.repositoryUrl,e.parameters.valueFor("user"),e.parameters.valueFor("password"),u);else if(n.repositoryUrl&&n.User&&e.parameters.getParameters())l(n.repositoryUrl,n.repositoryUrl,n.user,e.parameters.getParameters().password,u);else{var p=new c.JazzLoginDialog({serviceRegistry:i,repositoryUrl:n.repositoryUrl,repositoryUser:n.user||e.parameters&&e.parameters.valueFor("user"),func:function(e,t,i,n,o){l(e,t,i,n,o)}});p.show()}},visibleWhen:function(){return!0}});s.addCommand(w);var b=new n.Command({name:"Log Out",tooltip:"Log out from the Jazz server",id:"orion.jazz.command.logoutCommand",callback:function(e){var n=Array.isArray(e.items)?e.items:[e.items],o=[],r=i.getService("orion.jazz.service"),s=i.getService("orion.page.progress");n.forEach(function(e){var i=new t;o.push(i),s.showWhile(r.logout(e.Url),"Logging out from "+e.Url).then(i.resolve,function(e){g.handleError(e,s),i.reject(e)})}),t.all(o).then(function(){d.changedItem()}.bind(this))},visibleWhen:function(e){return e=Array.isArray(e)?e:[e],e.every(function(e){return"Repository"===e.Type})}});s.addCommand(b);var S=new n.Command({name:"Log Out All",tooltip:"Log Out from all Jazz servers",id:"orion.jazz.command.logoutAllCommand",callback:function(e){var t=(e.items,i.getService("orion.jazz.service")),n=i.getService("orion.page.progress");n.showWhile(t.logoutAll(),"Logging out from repositories").then(function(e){g.checkJazzError(e,n)||d.changedItem()})},visibleWhen:function(e){return"repositories"===e.type}});s.addCommand(S);var x=new o.ParametersDescription([new o.CommandParameter("name","text","Name:"),new o.CommandParameter("desc","text","Description:")]),L=new n.Command({name:"Create Stream",id:"orion.jazz.command.createStreamCommand",parameters:x,callback:function(e){var t=e.items,n=i.getService("orion.jazz.service"),o=i.getService("orion.page.progress");e.parameters.valueFor("name")&&o.showWhile(n.createStream(t.Location,e.parameters.valueFor("name"),e.parameters.valueFor("desc")),"Creating stream "+e.parameters.valueFor("name")).then(function(){d.changedItem()},function(e){g.handleError(e,o)})},visibleWhen:function(e){return"project"===e.type}});s.addCommand(L);var T=new n.Command({name:"Remove",tooltip:"Remove stream(s)",id:"orion.jazz.command.removeStreamCommand",callback:function(e){u(e,"Are you sure you want to delete selected streams?","Removing stream")},visibleWhen:function(e){return e=Array.isArray(e)?e:[e],e.every(function(e){return"Stream"===e.Type||"Workspace"===e.Type&&"Stream"===e.Kind})}});s.addCommand(T);var E=new o.ParametersDescription([new o.CommandParameter("name","text","Name:")]),k=new n.Command({name:"Create Workspace",tooltip:"Create workspace based on the project stream",id:"orion.jazz.command.createWSCommand",parameters:E,callback:function(e){var t=e.items,n=i.getService("orion.jazz.service"),o=i.getService("orion.page.progress"),r=e.parameters.valueFor("name");r&&o.showWhile(n.createWorkspace(t.Project.Location,t.ItemId,r),"Adding workspace "+r).then(function(){d.changedItem()},function(e){g.handleError(e,o)})},visibleWhen:function(e){return"Workspace"===e.Type&&"Stream"===e.Kind}});s.addCommand(k);var N=new n.Command({name:"Remove",tooltip:"Remove workspace(s)",id:"orion.jazz.command.removeWSCommand",callback:function(e){u(e,"Are you sure you want to delete selected workspaces?","Removing workspace")},visibleWhen:function(e){return e=Array.isArray(e)?e:[e],e.every(function(e){return"Workspace"===e.Type&&"Workspace"===e.Kind})}});s.addCommand(N);var A=new n.Command({id:"orion.jazz.command.loadWSCommand",callback:function(e){var t=e.items,n=i.getService("orion.jazz.service"),o=i.getService("orion.page.progress");if("Component"===t.Type){var r=t,s=r.parentItem,a=s.Project;return void o.showWhile(g.loadComponents(n,a.Location,s.ItemId,[r]),"Loading component "+r.Name).then(function(){d.changedItem()})}var s=t,a=s.Project;o.showWhile(n.loadWorkspace(a.Location,s.ItemId),"Loading workspace "+s.Name).then(function(){o.showWhile(n.activateWorkspace(a.Location,s.ItemId),"Activating workspace "+s.Name).then(function(){d.changedItem()})})},visibleWhen:function(e){return Array.isArray(e)&&e.length>0&&(e=e[0]),e.Loaded?(this.name="Reload","Workspace"===e.Type?this.tooltip="Reload workspace and related resources in your filesystem":"Component"===e.Type&&(this.tooltip="Reload component and related resources in your filesystem")):(this.name="Load","Workspace"===e.Type?this.tooltip="Load workspace and add related resources to your filesystem":"Component"===e.Type&&(this.tooltip="Load component and add related resources to your filesystem")),"Workspace"===e.Type&&"Workspace"===e.Kind||"Component"===e.Type&&!(e.TargetAdded||e.LocalRemoved)}});s.addCommand(A);var R=new n.Command({name:"Unload",tooltip:"Unload workspace/component and remove related resources from your filesystem",id:"orion.jazz.command.unloadWSCommand",callback:function(e){var t,n=e.items;t=n.componentName?n.Name:n.Name,s.confirm(e.domNode,"Are you sure you want to unload "+t+"?","Yes","No",!1,function(e){if(e){var t,o,r,s=i.getService("orion.jazz.service"),a=i.getService("orion.page.progress");"Workspace"===n.Type?(t=n.Project,o=n,a.showWhile(s.unloadWorkspace(t.Location,o.ItemId),"Unloading "+o.Name).then(function(){a.showWhile(s.deactivateWorkspace(t.Location,o.ItemId),"Deactivating workspace "+o.Name).then(function(){d.changedItem()})},function(e){g.handleError(e,a)})):(o=n.parent,t=o.Project,r=n,a.showWhile(g.unloadComponents(s,t.Location,o.ItemId,[r]),"Unloading "+r.Name).then(function(){d.changedItem()}))}})},visibleWhen:function(e){return"Workspace"===e.Type?this.tooltip="Unload workspace and remove related resources from your filesystem":"Component"===e.Type&&(this.tooltip="Unload component and remove related resources from your filesystem"),"Workspace"===e.Type&&"Workspace"===e.Kind&&e.Loaded||"Component"===e.Type&&e.Loaded}});s.addCommand(R);var I=new n.Command({name:"Remove",tooltip:"Remove the component from the workspace",id:"orion.jazz.command.removeComponentCommand",callback:function(e){var t=e.items;t.length&&(t=t[0]);var n=i.getService("orion.jazz.service"),o=i.getService("orion.page.progress");s.confirm(e.domNode,"Are you sure you want to remove the component?","Yes","No",!1,function(e){if(e){var i=t,r=t.parent,s=r.Project;o.showWhile(n.removeComponent(s.Location,r.ItemId,i.ItemId),"Removing component "+t.Name).then(function(){d.changedItem()},function(e){g.handleError(e,o)})}})},visibleWhen:function(e){return e.length&&1===e.length&&(e=e[0]),"Component"===e.Type}});s.addCommand(I);var D=new n.Command({name:"Set Flow Target",tooltip:"Set the flow target of your repository workspace to this stream.",id:"orion.jazz.command.changeFlowTargetCommand",callback:function(e){var t=e.items;t.length&&(t=t[0]);var n=i.getService("orion.jazz.service"),o=i.getService("orion.page.progress"),r=t,s=t.parentItem,a=s.Project;o.showWhile(n.setFlowTarget(a.Location,s.ItemId,r.ItemId),"Setting flow target to "+r.Name).then(function(){d.changedItem()},function(e){g.handleError(e,o)})},visibleWhen:function(e){return e.length&&1===e.length&&(e=e[0]),"Stream"===e.Type&&e.parentItem&&"Workspace"===e.parentItem.Type&&e.parentItem.CurrentFlowTarget.ItemId!==e.ItemId}});s.addCommand(D);var P=new o.ParametersDescription([new o.CommandParameter("name","text","Name:")]),M=new n.Command({name:"New Component",tooltip:"Add a new component to the workspace",id:"orion.jazz.command.addComponentCommand",parameters:P,callback:function(e){var t=e.items,n=i.getService("orion.jazz.service"),o=i.getService("orion.page.progress"),r=e.parameters.valueFor("name"),s=t,a=s.Project;o.showWhile(n.addComponent(a.Location,s.ItemId,r),"Adding component "+r).then(function(){d.changedItem()},function(e){g.handleError(e,o)})},visibleWhen:function(e){return"Workspace"===e.Type}});s.addCommand(M);var O=new o.ParametersDescription([new o.CommandParameter("name","text","Name:")]),B=new n.Command({name:"New Stream",tooltip:"Add a new stream to this project from your repository workspace.",id:"orion.jazz.command.addStreamCommand",parameters:O,callback:function(e){var t=e.items,n=i.getService("orion.jazz.service"),o=i.getService("orion.page.progress"),r=e.parameters.valueFor("name"),s=t,a=s.Project;if(s.Unshared)return void g.handleError("You have unshared changes. Check them in first before creating a new stream.",o);for(var l,c=0;c<s.Components.length;c++){if(l=s.Components[c],l.Conflicts)return void g.handleError("You have conflicts to resolve before creating a new stream.",o);if(l.Unresolved)return void g.handleError("You have un-checked in changes. Check them in first before creating a new stream.",o)}o.showWhile(n.addStream(a.Location,s.ItemId,r),"Adding stream "+r).then(function(){d.changedItem()},function(e){g.handleError(e,o)})},visibleWhen:function(e){return"Workspace"===e.Type}});s.addCommand(B);var F=new n.Command({name:"History",tooltip:"Show the component's history",id:"orion.jazz.command.showHistoryCommand",hrefCallback:function(n){var o=new t,r=n.items,s=r,l=s.parentItem,c=l.Project;return i.getService("orion.jazz.service").getHistoryLocation(c.Location,l.ItemId,s.ItemId).then(function(t){o.resolve(e.toUrl(new a("jazzui/history.html#{,resource,params*}").expand({resource:t})))}),o.promise},visibleWhen:function(e){return"Component"===e.Type}});s.addCommand(F);var j=new n.Command({name:"Changes",tooltip:"Show workspace changes",id:"orion.jazz.command.showChangesCommand",hrefCallback:function(n){var o=new t,r=n.items,s=r.Project.Location,l=r.ItemId;return i.getService("orion.jazz.service").getChangesLocation(s,l).then(function(t){o.resolve(e.toUrl(new a("jazzui/changes.html#{,resource,params*}").expand({resource:t})))}),o.promise},visibleWhen:function(e){return"Workspace"===e.Type&&"Workspace"===e.Kind&&e.Loaded}});s.addCommand(j);var V=new o.ParametersDescription([new o.CommandParameter("changeSetComment","text","Change Set Comment:")]),U=new n.Command({name:"Edit Comment",tooltip:"Edit comment",id:"orion.jazz.command.setChangeSetCommentCommand",parameters:V,callback:function(e){var t=e.items;t.length&&(t=t[0]);var n,o;if("Component"===t.Type&&t.Outgoing)for(n=0;n<t.Outgoing.length;n++)if(o=t.Outgoing[n],!o.Comment||""===o.Comment){t=o;break}var r=i.getService("orion.jazz.service"),s=i.getService("orion.page.progress"),a=t,l=a.Project,c=e.parameters.valueFor("changeSetComment");s.showWhile(r.setChangeSetComment(l.Location,a.ItemId,c),"Changing comment...").then(function(){d.changedItem()},function(e){g.handleError(e,s)})},visibleWhen:function(e){e.length&&1===e.length&&(e=e[0]);var t,i;if("Component"===e.Type&&e.Outgoing)for(t=0;t<e.Outgoing.length;t++)if(i=e.Outgoing[t],!i.Comment||""===i.Comment)return!0;return"ChangeSet"!==e.Type||"Outgoing"!==e.Kind&&"Suspended"!==e.Kind?!1:!0}});s.addCommand(U);var W=new n.Command({name:"Set Current",imageClass:"jazz-sprite-current",tooltip:"Set the change set as current",id:"orion.jazz.command.setCurrentChangeSetCommand",callback:function(e){var t=e.items;t.length&&(t=t[0]);var n=i.getService("orion.jazz.service"),o=i.getService("orion.page.progress"),r=t,s=t.parent.parent,a=s.Project;o.showWhile(n.setCurrentChangeSet(a.Location,s.ItemId,r.ItemId),"Setting current change set...").then(function(){d.changedItem()},function(e){g.handleError(e,o)})},visibleWhen:function(e){return e.length&&1===e.length&&(e=e[0]),"ChangeSet"!==e.Type||"Outgoing"!==e.Kind||e.isCurrent||e.Complete?!1:!0}});s.addCommand(W);var z=new n.Command({name:"Associate Work Item",tooltip:"Associate a work item with the change set",id:"orion.jazz.command.associateWorkItemCommand",callback:function(e){var n=e.items,o=n;n.length?n=n[0]:o=[n];var s=i.getService("orion.jazz.service"),a=i.getService("orion.page.progress"),c=n,h=n.parent.parent,u=c.Project,p=new r.OslcUiConsumer,f=g.createDelegatedUIDialog("Select Workitem");p.createUI(u.repositoryUrl+"_ajax-modules/com.ibm.team.workitem.WIPicker?projectAreaId="+u.uuid+"&showLoginLink=true&dc%3Atype=defect",f),p.addListener(function(e){if(l&&(l.destroy(),l=null),e["oslc_cm:results"].length>0){var i=e["oslc_cm:results"][0]["oslc_cm:label"].split(":",1)[0];if(i&&""!==i){for(var n=[],r=0;r<o.length;r++)n.push(s.associateWorkItem(u.Location,h.ItemId,o[r].ItemId,i));a.showWhile(t.all(n),"Associating work item...").then(function(){d.changedItem()},function(e){g.handleError(e,a)})}}})},visibleWhen:function(e){function t(e){return"ChangeSet"===e.Type&&"Incoming"!==e.Kind?!0:!1}return e.length>0?e.every(t):t(e)}});s.addCommand(z);var H=new n.Command({name:"Disassociate Work Item...",tooltip:"Disassociate the work item and the change set",id:"orion.jazz.command.disassociateWorkItemCommand",callback:function(e){var n=Array.isArray(e.items)?e.items:[e.items],o=[],r=i.getService("orion.jazz.service"),a=i.getService("orion.page.progress");s.confirm(e.domNode,"Are you sure you want to disassociate the work item?","Yes","No",!1,function(e){e&&(n.forEach(function(e){var i=new t;o.push(i);var n=e,s=e.parent,l=s.Project;a.showWhile(r.disassociateWorkItem(l.Location,s.ItemId,n.WorkitemNumber),"Disassociating work item...").then(i.resolve,function(e){g.handleError(e,a),i.reject(e)})}),t.all(o).then(function(){d.changedItem()}.bind(this)))})},visibleWhen:function(e){function t(e){return"Workitem"===e.Type?!0:!1}return e.length>0?e.every(t):t(e)}});s.addCommand(H);var G=new n.Command({name:"Discard",tooltip:"Discard the change set",id:"orion.jazz.command.discardCommand",callback:function(e){var n=Array.isArray(e.items)?e.items:[e.items],o=i.getService("orion.jazz.service"),r=i.getService("orion.page.progress"),a=(n[0].parent,function(e,i){var n=o.discardChangeSets;"Suspended"===i.Kind&&(n=o.removeSuspendedChangeSets);var s=i,a=i.parent,l=a.parent,c=l.Project,d=new t;return r.showWhile(n(c.Location,l.ItemId,s.ItemId,e),"Discarding change set...").then(d.resolve,function(e){g.handleError(e,r),d.reject(e)}),d});s.confirm(e.domNode,"Are you sure you want to discard the change set?","Yes","No",!1,function(e){if(e){var i=[];n.forEach(function(e){i.push(a("Fail",e))}),t.all(i).then(function(){d.changedItem()})}})},visibleWhen:function(e){function t(e){return"ChangeSet"===e.Type&&"Incoming"!==e.Kind?!0:!1}return e.length>0?e.every(t):t(e)}});s.addCommand(G);var $=new n.Command({name:"Complete",imageClass:"jazz-sprite-complete",tooltip:"Mark the change set as complete. No more changes can be added to it.",id:"orion.jazz.command.completeChangeSetsCommand",callback:function(e){var n=Array.isArray(e.items)?e.items:[e.items],o=i.getService("orion.jazz.service"),r=i.getService("orion.page.progress"),s=[];n.forEach(function(e){var i=e,n=e.parent.parent,a=n.Project,l=new t;s.push(l),r.showWhile(o.completeChangeSets(a.Location,n.ItemId,i.ItemId),"Completing...").then(l.resolve,function(e){g.handleError(e,r),l.reject(e)})}.bind(this)),t.all(s).then(function(){d.changedItem()})},visibleWhen:function(e){function t(e){return"ChangeSet"!==e.Type||"Outgoing"!==e.Kind||e.Complete?!1:!0}return e.length>0?e.every(t):t(e)}});s.addCommand($);var K=new n.Command({name:"Suspend",tooltip:"Suspend the change set and remove related changes from your filesystem",id:"orion.jazz.command.suspendChangeSetsCommand",callback:function(e){var n=Array.isArray(e.items)?e.items:[e.items],o=i.getService("orion.jazz.service"),r=i.getService("orion.page.progress"),s=[];n.forEach(function(e){var i=e,n=e.parent.parent,a=n.Project,l=new t;s.push(l),r.showWhile(o.suspendChangeSets(a.Location,n.ItemId,i.ItemId),"Suspending...").then(l.resolve,function(e){g.handleError(e,r),l.reject(e)})}.bind(this)),t.all(s).then(function(){d.changedItem()})},visibleWhen:function(e){function t(e){return"ChangeSet"===e.Type&&"Outgoing"===e.Kind?!0:!1}return e.length>0?e.every(t):t(e)}});s.addCommand(K);var Y=new n.Command({name:"Resume",tooltip:"Resume the change set and add related changes back to your filesystem",id:"orion.jazz.command.resumeChangeSetsCommand",callback:function(e){var n=Array.isArray(e.items)?e.items:[e.items];"Component"===n[0].Type&&(n=n[0].Suspended);var o=i.getService("orion.jazz.service"),r=i.getService("orion.page.progress"),s=[];n.forEach(function(e){var i=e,n=e.parent.parent,a=n.Project,l=new t;s.push(l),r.showWhile(o.resumeChangeSets(a.Location,n.ItemId,i.ItemId),"Resuming...").then(l.resolve,function(e){g.handleError(e,r),l.reject(e)})}.bind(this)),t.all(s).then(function(){d.changedItem()})},visibleWhen:function(e){function t(e){return"ChangeSet"===e.Type&&"Suspended"===e.Kind||"Component"===e.Type&&e.Suspended}return e.length>0?e.every(t):t(e)}});s.addCommand(Y);var q=new n.Command({name:"Relocate",tooltip:"Relocate file to a different change set",id:"orion.jazz.command.relocateFileCommand",callback:function(e){var n=Array.isArray(e.items)?e.items:[e.items],o=[],r=i.getService("orion.jazz.service"),s=i.getService("orion.page.progress"),a=n[0].parent.parent,l=new f.ChangeSetPrompterDialog({title:"Select Change Set",serviceRegistry:i,changeSets:a.Outgoing,func:function(e){n.forEach(function(i){var n=i.parent,l=a.parent,c=l.Project,d=new t;o.push(d),s.showWhile(r.relocateChanges(c.Location,l.ItemId,n.ItemId,e.ItemId,i.ItemId),"Relocating "+i.Path+" to "+e.Comment).then(d.resolve,function(e){g.handleError(e,s),d.reject(e)})}),t.all(o).then(function(){d.changedItem()})}});l.show()},visibleWhen:function(e){function t(e){var t=e.parent;return"Change"===e.Type&&"Outgoing"===t.Kind&&!t.Complete}return e.length>0?e.every(t):t(e)}});s.addCommand(q);var J=new n.Command({name:"Undo",tooltip:"Undo changes in this file",id:"orion.jazz.command.undoFileCommand",callback:function(e){var t=Array.isArray(e.items)?e.items:[e.items];0!==t.length&&s.confirm(e.domNode,"Are you sure you want to undo changes in "+(1===t.length?t[0].name:t.length+" files")+"? All your chanches will be lost.","Yes","No",!1,function(e){if(e){var n=t[0].parent,o=n.parent,r=o.Project,s=[];t.forEach(function(e){s.push(e.ItemId)});var a=i.getService("orion.jazz.service"),l=i.getService("orion.page.progress");l.showWhile(a.undoLocalChanges(r.Location,o.ItemId,n.ItemId,s),1===t.length?"Resetting file "+t[0].Path:"Resetting "+t.length+" files").then(function(){d.changedItem()},function(e){g.handleError(e,l)})}})},visibleWhen:function(e){return Array.isArray(e)?e.every(function(e){return"LocalChange"===e.Type}):"LocalChange"===e.Type}});s.addCommand(J);var X=new n.Command({name:"Resolve Current",tooltip:"Mark this conflict as resolved",id:"orion.jazz.command.resolveCommand",callback:function(e){var n=Array.isArray(e.items)?e.items:[e.items],o=[],r=i.getService("orion.jazz.service"),a=i.getService("orion.page.progress");s.confirm(e.domNode,"Are you sure you want to mark "+(1===n.length?n[0].Path:n.length+" files")+' as resolved? All incoming changes that have not been included in local file will be overwritten. Use "Resolve in Compare View" command to resolve conflicting changes.',"Yes","No",!1,function(e){e&&(n.forEach(function(e){var i=new t;o.push(i);var n=e.parent,s=n.parent,l=s.Project;a.progress(r.resolveAsMerged(l.Location,s.ItemId,n.ItemId,e.ItemId),"Marking file as resolved "+e.Path).then(i.resolve,function(e){g.handleError(e,a),i.reject(e)})}.bind(this)),t.all(o).then(function(){d.changedItem()}.bind(this)))})},visibleWhen:function(e){return Array.isArray(e)||(e=[e]),e.every(function(e){return"Conflict"===e.Type&&"Conflicted"===e.Kind})}});s.addCommand(X);var Z=new n.Command({name:"Resolve Proposed",tooltip:"Use the proposed version, replacing the current changes",id:"orion.jazz.command.resolveWithProposedCommand",callback:function(e){var t=e.items;s.confirm(e.domNode,"Are you sure you want to use proposed state of "+t.Path+" to resolve conflicts? Your changes will be be overwritten.","Yes","No",!1,function(e){if(e){var n=t.parent,o=n.parent,r=o.Project,s=i.getService("orion.jazz.service"),a=i.getService("orion.page.progress");a.progress(s.resolveWithProposed(r.Location,o.ItemId,n.ItemId,t.ItemId),"Resolving "+t.name+" with proposed").then(function(){d.changedItem()},function(e){g.handleError(e,a)})}})},visibleWhen:function(e){return Array.isArray(e)||(e=[e]),e.every(function(e){return"Conflict"===e.Type&&"Conflicted"===e.Kind})}});s.addCommand(Z);var Q=new n.Command({name:"Merge",tooltip:"Merge my changes with the proposed changes",id:"orion.jazz.command.mergeChangesCommand",hrefCallback:function(e){var t=e.items;t.length&&(t=t[0]);var i=document.location.pathname,n=i.split("/");return n.pop(),n.pop(),i=n.join("/"),i+"/compare/compare.html#"+t.ContentLocation+",compareTo="+i+"/jazz/Versionable/"+t.ItemId+"%25252F"+t.BeforeStateItemId+t.Project.ContentLocation+",block=1,change=0"},visibleWhen:function(e){return e.length&&1===e.length&&(e=e[0]),"Conflict"===e.Type&&"Conflicted"===e.Kind}});s.addCommand(Q);var et=new n.Command({name:"Autoresolve",tooltip:"Let Jazz resolve conflicts for you",id:"orion.jazz.command.autoresolveCommand",callback:function(){},visibleWhen:function(e){return Array.isArray(e)||(e=[e]),e.every(function(e){return"Conflict"===e.Type&&"Automerge"===e.Kind
})}});s.addCommand(et);var tt=new n.Command({name:"Summary",tooltip:"Show artifacts summary",id:"orion.jazz.command.showSummaryCommand",href:!0,hrefCallback:function(){return e.toUrl("jazzui/projects.html")+"#"},visibleWhen:function(){return!0}});s.addCommand(tt);var it=new n.Command({name:"< Previous Page",tooltip:"Show previous page of jazz history",id:"eclipse.orion.jazz.command.previousHistoryPage",hrefCallback:function(t){return e.toUrl(new a("jazzui/history.html#{,resource,params*}").expand({resource:t.items.prevLocation}))},visibleWhen:function(e){return void 0!==e.prevLocation}});s.addCommand(it);var nt=new n.Command({name:"Next Page >",tooltip:"Show next page of jazz history",id:"eclipse.orion.jazz.command.nextHistoryPage",hrefCallback:function(t){return e.toUrl(new a("jazzui/history.html#{,resource,params*}").expand({resource:t.items.nextLocation}))},visibleWhen:function(e){return void 0!==e.nextLocation}});s.addCommand(nt);var ot=new n.Command({name:"Repository Connnections",tooltip:"Show repository connections",id:"orion.jazz.command.showRepositoryConnectionCommand",href:!0,hrefCallback:function(){return e.toUrl("jazzui/projects.html#/artifacts/repositoryconnection")},visibleWhen:function(){return!0}});s.addCommand(ot);var rt=new n.Command({name:"Projects",tooltip:"Show projects",id:"orion.jazz.command.showProjectAreaCommand",href:!0,hrefCallback:function(){return e.toUrl("jazzui/projects.html#/artifacts/projectarea")},visibleWhen:function(){return!0}});s.addCommand(rt);var st=new n.Command({name:"Workspaces",tooltip:"Show workspaces",id:"orion.jazz.command.showWorkspaceCommand",href:!0,hrefCallback:function(){return e.toUrl("jazzui/projects.html#/artifacts/workspace")},visibleWhen:function(){return!0}});s.addCommand(st)}}(),g}),define("orion/operation",["orion/xhr","orion/Deferred"],function(e,t){function i(e){return e?"loadstart"===e||"progress"===e?!0:!1:!0}function n(t){e("DELETE",t,{headers:{"Orion-Version":"1"},timeout:15e3})}function o(t){e("PUT",t,{headers:{"Orion-Version":"1"},data:JSON.stringify({abort:!0}),timeout:15e3})}function r(t,o,s,a){e("GET",t.location,{headers:{"Orion-Version":"1"},timeout:15e3}).then(function(e){var l=e.response?JSON.parse(e.response):null;return o.progress(l),i(l.type)?(setTimeout(function(){r(t,o,s,a)},t.timeout),void(t.timeout=Math.min(2*t.timeout,2e3))):("error"===l.type||"abort"===l.type?o.reject(a?a(l):l.Result):o.resolve(s?s(l):l.Result.JsonData),void(l.Location||n(t.location)))},function(e){var t=e;if(void 0!==e.responseText){t=e.responseText;try{t=JSON.parse(e.responseText)}catch(i){}}void 0!==t.Message?(t.HttpCode=void 0===t.HttpCode?e.status:t.HttpCode,t.Severity=void 0===t.Severity?"Error":t.Severity,o.reject(t)):o.reject({Severity:"Error",Message:t,HttpCode:e.status})})}function s(e,t){t.then(null,function(t){t instanceof Error&&"Cancel"===t.name&&o(e)})}function a(e,i,n){var o=new t;return s(e,o),r({location:e,timeout:100},o,i,n),o}return{handle:a}}),define("orion/jazzui/jazzDecorator",["require","orion/xhr","orion/Deferred","orion/operation","orion/URL-shim"],function(e,t,i,n){function o(){this._repoChanges={},this._pendingChanges={},this._disabled=!1}return o.prototype={_getServiceResponse:function(e,t){var i=t.response?JSON.parse(t.response):null;if(t.xhr&&202===t.xhr.status){var o=n.handle(i.Location);return o.then(function(t){try{e.resolve(JSON.parse(t))}catch(i){e.resolve(t)}},function(t){t.failedOperation=i.Location,e.reject(t)},e.progress),void e.then(null,function(e){o.reject(e)})}e.resolve(i)},_handleServiceResponseError:function(e,t){e.reject(t)},_xhrV2:function(e,n,o){var r=this,s=new i,a=[],l=JSON.stringify(o,function(e,t){if("object"==typeof t){if(-1!==a.indexOf(t))return void console.log("Duplicate value in key "+e);a.push(t)}return t});return t(e,n,{headers:{"Jazz-Version":"2","Content-Type":"application/json; charset=UTF-8"},timeout:15e3,data:l}).then(function(e){r._getServiceResponse(s,e)},function(e){r._handleServiceResponseError(s,e)}),s},getNotifications:function(e){if(this._disabled)return(new i).resolve([]);var t=this,n=e.indexOf("/file/");if(-1===n)return(new i).resolve([]);var o=e.substring(n+1),r=o.split("/");if(r.length<3)return(new i).resolve({});var s="/file/"+r[1]+"/"+r[2];if(t._repoChanges[s]&&t._repoChanges[s].invalidAfter&&Date.now()<t._repoChanges[s].invalidAfter)return this._computeNotifications(s);var a=null;t._repoChanges[s]?(a=t._repoChanges[s].previousState,t._repoChanges[s].invalidAfter=Date.now()+6e5):t._repoChanges[s]={invalidAfter:Date.now()+6e5};var l=t._getRepoChanges(s,a).then(function(e){e.forceDisable&&(t._disabled=!0),e.unchanged||(t._repoChanges[s]=e),t._repoChanges[s].invalidAfter=Date.now()+15e3});return i.all([l]).then(function(){return t._computeNotifications(s)})},_getRepoChanges:function(t,n){var o=t.substring(t.indexOf("/file/")+1),r=o.split("/");if(r.length<3)return(new i).reject("Need at least three segments");var s=e.toUrl("jazz/OrionProjectSyncState/"+r[0]+"/"+r[1]+"/"+r[2]);return n&&(s+="?previousState="+encodeURIComponent(n)),this._xhrV2("GET",s)},_computeNotifications:function(e){if(this._disabled)return(new i).resolve([]);var t=this._repoChanges[e],n=0,o=0,r=0;if(t.componentChanges)for(var s=0;s<t.componentChanges.length;s++)n+=t.componentChanges[s].incomingCount,o+=t.componentChanges[s].outgoingCount,r+=t.componentChanges[s].conflictCount;var a="";return n>0&&(a="info"),r>0&&(a="error"),(new i).resolve([{level:a,count:n}])},resetNotificationTimers:function(){for(var e in this._repoChanges)this._repoChanges.hasOwnProperty(e)&&(this._repoChanges[e].invalidAfter=0);return(new i).resolve(null)}},{JazzDecorator:o}}),define("orion/jazzui/jazzClient",["require","orion/xhr","orion/Deferred","orion/operation","orion/jazzui/jazzDecorator","orion/URL-shim"],function(e,t,i,n){var o=o||{};return o.JazzService=function(){function o(e){this._serviceRegistry=e,this._serviceRegistration=e.registerService("orion.jazz.service",this),this._decorator=e.getService("rtcscm.decorator")}function r(e){var t=new URL(e,window.location.href),i=t.href;return t.host?i.substring(i.indexOf(t.host)+t.host.length):i}var s="application/json; charset=UTF-8";return o.prototype={_getServiceResponse:function(e,t){var i=t.response?JSON.parse(t.response):null;if(t.xhr&&202===t.xhr.status){var o=n.handle(i.Location);return o.then(function(t){try{e.resolve(JSON.parse(t))}catch(i){e.resolve(t)}},function(t){t.failedOperation=i.Location,e.reject(t)},e.progress),void e.then(null,function(e){o.reject(e)})}e.resolve(i)},_handleServiceResponseError:function(e,t){e.reject(t)},_xhr:function(e,n){var o=this,r=new i;return t(e,n,{headers:{"Orion-Version":"1","Content-Type":s},timeout:15e3}).then(function(e){o._getServiceResponse(r,e)},function(e){o._handleServiceResponseError(r,e)}),r},_xhrV1:function(e,n,o){var r=this,a=new i;return t(e,n,{headers:{"Jazz-Version":"1","Content-Type":s},timeout:15e3,data:JSON.stringify(o)}).then(function(e){r._getServiceResponse(a,e)},function(e){r._handleServiceResponseError(a,e)}),a},_xhrV2:function(e,n,o){var r=this,a=new i,l=[],c=JSON.stringify(o,function(e,t){if("object"==typeof t){if(-1!==l.indexOf(t))return void console.log("Duplicate value in key "+e);l.push(t)}return t});return t(e,n,{headers:{"Jazz-Version":"2","Content-Type":s},timeout:15e3,data:c}).then(function(e){r._getServiceResponse(a,e)},function(e){r._handleServiceResponseError(a,e)}),a},_clearSyncCache:function(){this._decorator&&this._decorator.resetNotificationTimers()},getWorkspaceLocation:function(t,n){if(!t){var o=new i;return o.reject("Project location cannot be null"),o}var s=t.substring(t.indexOf("/file/")),a=e.toUrl("jazz/Workspace")+"/"+(n?n:"_")+s;return r(a)},getWorkitemLocation:function(t,n){if(!t){var o=new i;return o.reject("Project location cannot be null"),o}var s=t.substring(t.indexOf("/file/")),a=e.toUrl("jazz/Workitem")+"/"+(n?n:"_")+s;return r(a)},getChangeSetLocation:function(t,n){if(!t){var o=new i;return o.reject("Project location cannot be null"),o}var s=t.substring(t.indexOf("/file/")),a=e.toUrl("jazz/ChangeSet")+"/"+(n?n:"_")+s;return r(a)},getChangesLocation:function(t,n){if(!t||!n){var o=new i;return o.reject((t?"Workspace id":"Project location")+" cannot be null"),o}var s=t.substring(t.indexOf("/file/")),a=e.toUrl("jazz/Changes")+"/"+n+s;return r(a)},getHistoryLocation:function(t,n,o,s,a){if(!t){var l=new i;return l.reject("Project location cannot be null"),l}var c=t.substring(t.indexOf("/file/")),d=e.toUrl("jazz/History")+"/"+encodeURIComponent(encodeURIComponent(n+"/"+o))+c;return s&&(d+="&page="+s),a&&(d+="&pageSize="+a),r(d)},getVersionableLocation:function(t,n,o,s){if(!t){var a=new i;return a.reject("Project location cannot be null"),a}var l=t.substring(t.indexOf("/file/"));s=s?s:"";var c=e.toUrl("jazz/Versionable")+"/"+encodeURIComponent(encodeURIComponent(o+"/"+s))+l;return r(c)},getRepositories:function(){return this._xhrV2("GET",e.toUrl("jazz/Repository"))},findRepositoryProjects:function(t,i){return this._xhrV2("GET",e.toUrl("jazz/RepositoryProject")+(i?"?JazzUrl=":"?RepositoryUrl=")+t)},createRepositoryProject:function(t,i,n,o,r,s,a){"undefined"==typeof r&&(r=!0);var l={RepositoryUrl:t,isPublic:r};return o&&(l.GitRepo=o),n&&(l.Description=n),i&&(l.ProjectName=i),s&&(l.CreateGitRepository=s),a&&(l.BlueMixProject=a),this._xhrV2("POST",e.toUrl("jazz/RepositoryProject"),l)},getProjects:function(){return this._xhrV2("GET",e.toUrl("jazz/Project"))},getProject:function(e,t){return this._xhrV2("GET",t?e+"?advancedInfo=true":e)},findProject:function(t){return this._xhrV2("GET",e.toUrl("jazz/Project")+"?Name="+t)},updateProject:function(e,t){return this._xhrV2("PUT",e,t)},checkInProject:function(e,t,i){var n={CheckIn:!0,Current:t,Comment:i};return this._xhrV2("POST",e,n)},initBasicGitProject:function(t,i,n,o,r,s,a,l,c){var d=e.toUrl("jazz/Project"),h={repositoryUrl:t,projectName:i,cloneGit:!0,projectDescription:n};return o&&(h.GitSshUsername=o),r&&(h.GitSshPassword=r),s&&(h.GitSshKnownHost=s),a&&(h.GitSshPrivateKey=a),l&&(h.GitSshPassphrase=l),c&&(c.GitMail&&(h.GitMail=c.GitMail),c.GitName&&(h.GitName=c.GitName)),this._xhrV2("POST",d,h)},initBasicProjectFromFiles:function(t,i,n,o,r,s,a,l){var c=e.toUrl("jazz/Project"),d={Init:!0,ScmType:"Jazz",repositoryUrl:t,projectName:i,uuid:n,user:o,ItemToShare:r,deleteSource:s,initProject:a,initReadme:l};return this._xhrV2("POST",c,d)},initBasicGitProjectFromFiles:function(t,i,n,o,r,s,a,l,c){var d=e.toUrl("jazz/Project"),h={Init:!0,ScmType:"Git",repositoryUrl:t,projectName:i,GitUrl:n,ItemToShare:s,deleteSource:a,initProject:l,initReadme:c};return o&&o.gitSshUsername&&(h.GitSshUsername=o.gitSshUsername),o&&o.gitSshPassword&&(h.GitSshPassword=o.gitSshPassword),o&&o.gitSshKnownHost&&(h.GitSshKnownHost=o.gitSshKnownHost),o&&o.privateKey&&(h.GitSshPrivateKey=o.privateKey),o&&o.passphrase&&(h.GitSshPassphrase=o.passphrase),r&&(r.GitMail&&(h.GitMail=r.GitMail),r.GitName&&(h.GitName=r.GitName)),this._xhrV2("POST",d,h)},initBasicProject:function(t,i,n,o,r,s){var a=e.toUrl("jazz/Project"),l={Init:!0,repositoryUrl:t,projectName:i,uuid:n,user:o,deleteSource:!0,initProject:r,initReadme:s};return this._xhrV2("POST",a,l)},deleteProject:function(e){return this._xhrV2("DELETE",e)},getChangeSet:function(e){return this._xhrV2("GET",e)},createChangeSet:function(e,t,i,n){var o=this.getChangeSetLocation(e),r={WorkspaceItemId:t,ComponentItemId:i,Comment:n};return this._xhrV2("POST",o,r)},associateWorkItem:function(e,t,i,n,o){var r=this.getChangeSetLocation(e,i),s={Associate:!0,WorkspaceItemId:t,WorkitemNumber:n,Disassociate:1==o};return this._xhrV2("POST",r,s)},disassociateWorkItem:function(e,t,i){var n=this.getChangeSetLocation(e,t),o={Disassociate:!0,WorkitemNumber:i};return this._xhrV2("POST",n,o)},setChangeSetComment:function(e,t,i){var n=this.getChangeSetLocation(e,t),o={Comment:i};return this._xhrV2("POST",n,o)},suspendChangeSets:function(e,t,i){var n=this.getWorkspaceLocation(e,t),o={Suspend:!0,ChangeSetItemId:i};return this._xhrV2("POST",n,o)},resumeChangeSets:function(e,t,i){var n=this.getWorkspaceLocation(e,t),o={Resume:!0,ChangeSetItemId:i};return this._xhrV2("POST",n,o)},setCurrentChangeSet:function(e,t,i){var n=this.getWorkspaceLocation(e,t),o={Current:!0,ChangeSetItemId:i};return this._xhrV2("POST",n,o)},discardChangeSets:function(e,t,i,n){var o=this.getWorkspaceLocation(e,t),r={Discard:!0,ChangeSetItemId:i};return n&&(r.DilemmaHandlers={UncheckedInChanges:n}),this._xhrV2("POST",o,r)},completeChangeSets:function(e,t,i){var n=this.getWorkspaceLocation(e,t),o={Complete:!0,ChangeSetItemId:i};return this._xhrV2("POST",n,o)},removeSuspendedChangeSets:function(e,t,i){var n=this.getWorkspaceLocation(e,t),o={RemoveSuspended:!0,ChangeSetItemId:i};return this._xhrV2("POST",n,o)},relocateChanges:function(e,t,i,n,o){var r=this.getWorkspaceLocation(e,t),s={RelocateChanges:!0,ChangeSetItemId:i,TargetChangeSetItemId:n,VersionableItemId:o};return this._xhrV2("POST",r,s)},getHistory:function(e){return this._xhrV2("GET",e)},findWorkitems:function(e,t){var i=this.getWorkitemLocation(e);return this._xhrV2("GET",i+"?Search="+encodeURIComponent(t))},getWorkspaces:function(e){var t=this.getWorkspaceLocation(e);return this._xhrV2("GET",t)},deliver:function(e,t,i,n,o){var r=this.getWorkspaceLocation(e,t),s={Deliver:!0,TargetWorkspaceItemId:i};return n?s.ComponentItemId=n:o&&(s.ChangeSetItemIds=o),this._xhrV2("POST",r,s)},share:function(e,t,i,n,o){var r=this.getWorkspaceLocation(e,t),s={Share:!0,ComponentItemId:i,ChangeSetItemId:n,ItemToShare:o};return this._xhrV2("POST",r,s)},checkIn:function(e,t,i,n,o,r){var s=this.getWorkspaceLocation(e,t),a={CheckIn:!0,ComponentItemId:i,ItemsToCheckIn:o,CommitShares:r};return n&&(a.ChangeSetItemId=n),this._xhrV2("POST",s,a)},accept:function(e,t,i,n,o){var r=this.getWorkspaceLocation(e,i),s={Accept:!0,SourceWorkspaceItemId:t};return n?s.ComponentItemId=n:o&&(s.ChangeSetItemIds=o),this._xhrV2("POST",r,s).then(function(e){return this._clearSyncCache(),e}.bind(this))},addComponent:function(e,t,i){var n=this.getWorkspaceLocation(e,t),o={AddComponent:!0,Name:i};return this._xhrV2("POST",n,o)},removeComponent:function(e,t,i){var n=this.getWorkspaceLocation(e,t),o={RemoveComponent:!0,ComponentItemId:i};return this._xhrV2("POST",n,o)},setFlowTarget:function(e,t,i){var n=this.getWorkspaceLocation(e,t),o={SetFlowTarget:!0,WorkspaceItemId:t,StreamItemId:i};return this._xhrV2("POST",n,o)},addStream:function(e,t,i){var n=this.getWorkspaceLocation(e,t),o={AddStream:!0,WorkspaceItemId:t,Name:i};return this._xhrV2("POST",n,o)},removeStream:function(e,t,i){var n=this.getWorkspaceLocation(e,t),o={RemoveStream:!0,WorkspaceItemId:t,Name:i};return this._xhrV2("POST",n,o)},loadWorkspace:function(e,t,i){var n=this.getWorkspaceLocation(e,t),o={Load:!0,ComponentItemId:i};return this._xhrV2("POST",n,o)},activateWorkspace:function(e,t){var i=this.getWorkspaceLocation(e,t),n={Activate:!0};return this._xhrV2("POST",i,n)},deactivateWorkspace:function(e,t){var i=this.getWorkspaceLocation(e,t),n={Deactivate:!0};return this._xhrV2("POST",i,n)},unloadWorkspace:function(e,t,i){var n=this.getWorkspaceLocation(e,t),o={Unload:!0};return i&&(o.ComponentItemId=i),this._xhrV2("POST",n,o)},deleteWorkspace:function(e,t){var i=this.getWorkspaceLocation(e,t);return this._xhrV2("DELETE",i)},createStream:function(e,t,i){var n=this.getWorkspaceLocation(e),o={Kind:"Stream",Name:t,Description:i};return this._xhrV2("POST",n,o)},createWorkspace:function(e,t,i){var n=this.getWorkspaceLocation(e),o={Name:i,SourceWorkspaceItemId:t};return this._xhrV2("POST",n,o)},undoLocalChanges:function(e,t,i,n){var o=this.getWorkspaceLocation(e,t),r={Undo:!0,ComponentItemId:i,VersionableItemIds:n};return this._xhrV2("POST",o,r)},resolveAsMerged:function(e,t,i,n){var o=this.getWorkspaceLocation(e,t),r={ResolveAsMerged:!0,ComponentItemId:i,VersionableItemId:n};return this._xhrV2("POST",o,r)},resolveWithProposed:function(e,t,i,n){var o=this.getWorkspaceLocation(e,t),r={ResolveWithProposed:!0,ComponentItemId:i,VersionableItemId:n};return this._xhrV2("POST",o,r)},autoResolve:function(e,t,i,n){var o=this.getWorkspaceLocation(e,t),r={AutoResolve:!0,ComponentItemId:i,VersionableItemId:n};return this._xhrV2("POST",o,r)},getChanges:function(e){return this._xhrV2("GET",e)},getRepoChanges:function(t,n){var o=t.substring(t.indexOf("/file/")+1),r=o.split("/");if(r.length<3)return(new i).reject("Need at least three segments");var s=e.toUrl("jazz/OrionProjectSyncState/"+r[0]+"/"+r[1]+"/"+r[2]);return n&&(s+="?previousState="+encodeURIComponent(n)),this._xhrV2("GET",s)},login:function(n,o,r,a){var l=this,c=new i,d=e.toUrl("jazz/Login")+"?repositoryUrl="+encodeURIComponent(n)+"&name="+encodeURIComponent(o)+"&userId="+encodeURIComponent(r)+"&password="+encodeURIComponent(a);return t("POST",d,{headers:{"Orion-Version":"1","Content-Type":s},timeout:15e3}).then(function(e){l._getServiceResponse(c,e)},function(e){l._handleServiceResponseError(c,e)}),c},logout:function(n){var o=this,r=new i,a=e.toUrl("jazz/Logout")+"?repositoryUrl="+encodeURIComponent(n);return t("POST",a,{headers:{"Orion-Version":"1","Content-Type":s},timeout:15e3}).then(function(e){o._getServiceResponse(r,e)},function(e){o._handleServiceResponseError(r,e)}),r},logoutAll:function(){var n=this,o=new i,r=e.toUrl("jazz/Logout")+"?all=true";return t("POST",r,{headers:{"Orion-Version":"1","Content-Type":s},timeout:15e3}).then(function(e){n._getServiceResponse(o,e)},function(e){n._handleServiceResponseError(o,e)}),o}},o}(),o}),define("orion/jazzui/widgets/SaveInJazzHubPasswordDialog",["orion/webui/dialog","orion/webui/littlelib"],function(e,t){function i(e){this._init(e)}return i.prototype=new e.Dialog,i.prototype.TEMPLATE='<style>div.dialogStatusBarBox {width: 70%;display: inline-block;background-color: #C2E0FF;padding: 5px;margin-top: 2px;margin-right: 5px;text-align: center;border-radius: 8px;-moz-border-radius: 8px;}span.dialogStatusBarBoxProgress {text-decoration: blink;}</style><div id="saveInJazzHubPasswordDialogContainer"><div style="padding: 5px;" id="passwordRow"><div style="float: left; width: 200px;"><label id="passwordLabel" for="password"></label></div><input type="password" id="password" style="width: 200px;" value=""></div></div>',i.prototype.setStatus=function(e){t.empty(this.$saveInJazzHubPasswordDialogContainer);var i=document.createElement("center"),n=document.createElement("div");n.className="dialogStatusBarBox",n.appendChild(document.createTextNode(e));var o=document.createElement("span");o.className="dialogStatusBarBoxProgress",o.appendChild(document.createTextNode("...")),n.appendChild(o),i.appendChild(n),this.$saveInJazzHubPasswordDialogContainer.appendChild(i)},i.prototype._init=function(e){this.options=e||{},this.title=this.options.title||"Jazz Login",this.modal=!0,this.buttons=[{text:"OK",isDefault:!0,callback:this.done.bind(this)}],this._func=e.func,this._passwordLabel=this.options.passwordLabel||"Password:",this.width=this.options.width||"400px",this.height=this.options.height||"400px",this._initialize()},i.prototype._bindToDom=function(){this.$passwordLabel.appendChild(document.createTextNode(this._passwordLabel)),this.$saveInJazzHubPasswordDialogContainer.style.width=this.width,this.$saveInJazzHubPasswordDialogContainer.style.height=this.height},i.prototype.done=function(){this.passwordPassed?this.hide():(t.empty(document.getElementById("buttons")),this.options.func(this.$password.value),this.passwordPassed=!0)},i.prototype.constructor=i,{SaveInJazzHubPasswordDialog:i}}),define("orion/jazzui/jazzUtil",["orion/xhr","orion/jazzui/jazzClient","orion/Deferred","orion/URITemplate","text!jconfig/jazzhuburl","jazzui/oslc/oslc","orion/jazzui/widgets/DelegatedUIDialog","orion/jazzui/widgets/SaveInJazzHubPasswordDialog","orion/jazzui/jazzCommands"],function(e,t,i,n,o,r,s,a,l){function c(t){var n=new i;if(!t)return n.resolve(null),n;var r=o+"manage/service/com.ibm.team.jazzhub.common.service.IProjectService/projectByName?projectName="+encodeURIComponent(t)+"&includeMembers=true";return e("GET",r,{timeout:15e3}).then(function(e){var t=e.response?JSON.parse(e.response):null;n.resolve(t)},function(){n.resolve(null)}),n}function d(e,t,n,a){var l=new i,c=o,d=new r.OslcUiConsumer,h=new s.DelegatedUIDialog({title:t,width:"450px",height:"250px"});h.show();var u=c+"manage/manager/com.ibm.team.jazzhub.SimpleCreateProject",p="?";return n&&(u+="?usage="+n,p="&"),a&&a.scmSelection&&("GitSCM"===a.scmSelection||"GitAtJazzHubSCM"===a.scmSelection)?(u+=p,p="&",u+="scmSelection=GitAtJazzHubSCM"):(u+=p,p="&",u+="&scmSelection=JazzSCM"),a&&a.publicProject&&(u+=p,p="&",u+="publicProject="+a.publicProject),a&&a.isBlueMixProject&&(u+=p,p="&",u+="isBlueMixProject="+a.isBlueMixProject),d.createUI(u,h.$delegatedUIContainer),d.addListener(function(e){var t=function(){h&&(h.destroy(),h=null)};t(),"canceled"===e?l.reject(e):l.resolve(e)}),l}function h(e,i,n,o,r){var s=e.getService("orion.jazz.service");s||(s=new t.JazzService(e));var a=e.getService("orion.page.progress");c(i.JazzHub?i.JazzHub.Project:null).then(function(t){d(e,o||"Save at JazzHub",r,t).then(function(t){var o;i&&(o=i.Parents&&0!==i.Parents.length?i.Parents[i.Parents.length-1].Name:i.Name),"JazzSCM"===t.scmSelection?u(s,a,o,n,t):"GitAtJazzHubSCM"===t.scmSelection?p(e,s,a,o,n,t):u(s,a,o,n,t)},function(e){l.handleError(e,a)})},function(e){l.handleError(e,a)})}function u(e,t,i,o,r){var s=r.ccmBaseUrl,a=r.creator.userId,c=r.itemId,d=r.name;t.showWhile(e.initBasicProjectFromFiles(s,d,c,a,i,o,!0),"Your project is being set up. This might take a minute...").then(function(e){var t=e.project.ContentLocation;"/"!==t.slice(-1)&&(t+="/");var i=require.toUrl(new n("edit/edit.html#{,resource,params*}").expand({resource:t}));setTimeout(function(){window.location=i},1e3)},function(e){l.handleError(e,t)})}function p(e,t,i,o,r,s){var a=s.ccmBaseUrl,c=s.name,d=s.gitRepo;require(["orion/git/gitCommands","orion/git/gitConfigPreference"],function(s,h){s.getDefaultSshOptions(e,{GitUrl:d}).then(function(s){var u=(arguments.callee,new h(e));u.getConfig().then(function(e){i.showWhile(t.initBasicGitProjectFromFiles(a,c,d,s,e,o,r,!0),"Your project is being set up. This might take a minute...").then(function(e){var t=e.project.ContentLocation;"/"!==t.slice(-1)&&(t+="/");var i=require.toUrl(new n("edit/edit.html#{,resource,params*}").expand({resource:t}));setTimeout(function(){window.location=i},1e3)},function(e){l.handleError(e,i)})})})})}return{createJazzProject:d,createAndCheckInProject:h}}),define("orion/jazzui/checkinCommands",["require","orion/commands","orion/commandRegistry","orion/editorCommands","orion/jazzui/jazzCommands","orion/jazzui/jazzClient","orion/webui/littlelib","orion/Deferred","text!jconfig/jazzhuburl","jazzui/oslc/oslc","orion/jazzui/widgets/DelegatedUIDialog","orion/jazzui/widgets/SaveInJazzHubPasswordDialog","orion/URITemplate","orion/jazzui/jazzUtil"],function(e,t,i,n,o,r,s,a,l,c,d,h,u,p){function f(e,i,n){function r(e){return"Project"!==e.type?e:e.fileMetadata}if(n){o.createJazzCommands(e,n,g,"pageActions","selectionTools");var s=new t.Command({name:"Check in",tooltip:"Create a project in DevOps Services and check in changes",id:"orion.checkincreate.jazzhub",callback:function(t){if(this.isDirty&&this.isDirty()){if(!window.confirm("The current file is being edited, do you wish to save it before checking in?"))return;this.getTextView().invokeAction("save")}p.createAndCheckInProject(e,t.items,!0,"Save the code into a new DevOps Services project")},visibleWhen:function(e){return!e.Git&&e.Location&&!e.Jazz&&!e.Projects&&!e.CloneLocation}});n.addCommand(s);var a=new t.Command({name:"Fork",tooltip:"Fork into a new DevOps Services project",id:"com.ibm.team.scm.orion.command.forkProject",callback:function(t){if(t.items=r(t.items),this.isDirty&&this.isDirty()){if(!window.confirm("The current file is being edited, do you wish to save it before checking in?"))return;this.getTextView().invokeAction("save")}p.createAndCheckInProject(e,t.items,!1,"Save a copy of the code into a new project","Save")},visibleWhen:function(e){return e=r(e),e.JazzHub}});n.addCommand(a);var l="orion.menuBarToolsGroup";n.registerCommandContribution(i,"orion.checkincreate.jazzhub",1500,l),n.registerCommandContribution(i,"com.ibm.team.scm.orion.command.forkProject",1500,l)}}var g={};return{createCheckinCommands:f}}),define("orion/jazzui/widgets/SelectProjectAreaDialog",["orion/uiUtils","orion/explorers/explorer","orion/webui/dialog","orion/selection","orion/commands","orion/commandRegistry","orion/jazzui/jazzUtil"],function(e,t,i,n,o,r,s){function a(e,t){this.explorer=t,this._init(e)}function l(e){this._init(e)}return a.prototype=new t.SelectionRenderer,a.prototype.constructor=a,a.prototype.getLabelColumnIndex=function(){return 0},a.prototype.getCellElement=function(e,t,i){var n=document.createElement("td");i.appendChild(n);var o=document.createElement("span");o.id=i.id+"navSpan",n.appendChild(o),o.className="mainNavColumn singleNavColumn",t instanceof Array?(this.getExpandImage(i,o),o.appendChild(document.createTextNode("Root"))):"Repository"===t.Type?(this.getExpandImage(i,o),o.appendChild(t.Url?document.createTextNode(t.Url):document.createTextNode(t.JazzUrl))):o.appendChild(document.createTextNode(t.Name))},l.prototype=new i.Dialog,l.prototype.TEMPLATE='<div id="message" style="width: 25em; padding-bottom: 5px;"></div><div id="createArea" style="width: 25em; padding-bottom: 5px;"></div><div id="projectAreasTree" class="explorerTreeClass" style="width:30em; min-height: 25em; max-height:30em; height: auto; overflow-y: auto;"></div>',l.prototype._init=function(e){this.title=e.title||"Select Project to Add",this._serviceRegistry=e.serviceRegistry,this.canCreate=e.canCreate,this.jazzClient=e.jazzClient,this.commandService=e.commandRegistry,this.modal=!0,this.buttons=[{id:"okbutton",text:"OK",callback:this.done.bind(this)}],this._func=e.func,this.projectAreas=e.projectAreas,this.canCreate&&this.createActions(),this._initialize()},l.prototype.createActions=function(){var e=this,t=new o.Command({name:"Create New Project on JazzHub",tooltip:"Create new project on JazzHub",id:"orion.jazz.command.createProjectOnJazzHub",callback:function(){this.hide(),s.createJazzProject(e.serviceRegistry,"Create New Project on JazzHub").then(function(t){t.name&&e._func({Url:t.ccmBaseUrl,Name:t.name,ItemId:t.itemId,UserId:t.creator.userId})})}});this.commandService.addCommand(t),this.commandService.registerCommandContribution("createArea","orion.jazz.command.createProjectOnJazzHub",1)},l.prototype._bindToDom=function(){this.loadProjectAreas(this.projectAreas),this._message?this.$message.appendChild(document.createTextNode(this._message)):this.$message.style.display="none",this.$projectAreasTree.focus()},l.prototype.loadProjectAreas=function(e){var i=this._serviceRegistry.getService("orion.page.progress"),n=new t.ExplorerModel;n.jazzClient=this.jazzClient,n.root=e,n.getRoot=function(e){e(this.root)},n.getId=function(e){var t;if(e.ItemId)t=e.ItemId,t=t.replace(/[^\.\:\-\_0-9A-Za-z]/g,"");else if(e.Url)t=e.Url,t=t.replace(/[^\.\:\-\_0-9A-Za-z]/g,"");else{if(!e.JazzUrl)return"root";t=e.JazzUrl,t=t.replace(/[^\.\:\-\_0-9A-Za-z]/g,"")}return t},n.mayHaveChildren=function(e){return e instanceof Array&&e.length>0?!0:"Repository"===e.Type?!0:!1},n.getChildren=function(e,t){e instanceof Array?t(e):e.children?t(e.children):"Repository"===e.Type?i.showWhile(this.jazzClient.findRepositoryProjects(e.Url||e.JazzUrl,e.JazzUrl),"Getting projects from "+(e.Url||e.JazzUrl)).then(function(i){var n=i.Children;e.children=n.sort(function(e,t){return e.Name>t.Name});for(var o=0;o<e.children.length;o++)e.children[o].parent=e;t(e.children)}):t([])},this.createExplorer(n)},l.prototype.createExplorer=function(e){var i=this;this.canCreate&&this.commandService.renderCommands(this.$createArea.id,this.$createArea,{},this,"tool"),this.selection=new n.Selection(this._serviceRegistry,"jazzui.selectProjectArea.selection"),this.selection.addEventListener("selectionChanged",i.validate.bind(i)),this.explorer=new t.Explorer(this._serviceRegistry,this.selection),this.explorer.renderer=new a({checkbox:!1,singleSelection:!0,treeTableClass:"directoryPrompter"},this.explorer),this.explorer.createTree(this.$projectAreasTree.id,e,{setFocus:!0,selectionPolicy:this.explorer.renderer.selectionPolicy,onCollapse:function(e){i.getNavHandler()&&i.getNavHandler().onCollapse(e)}})},l.prototype.validate=function(){var e=this;this.selection.getSelection(function(t){return null===t?void e.$okbutton.classList.add(this.DISABLED):void e.$okbutton.classList.remove(this.DISABLED)})},l.prototype.done=function(){this.selection.getSelection(function(e){this.hide(),this._func(e)}.bind(this))},l.prototype.constructor=l,{SelectProjectAreaDialog:l}}),define("orion/git/gitConfigPreference",["orion/Deferred"],function(e){function t(e){this._prefix="/git/config",this._preferenceService=e.getService("orion.core.preference")}return t.prototype={getConfig:function(){var t=new e;return this._preferenceService.get(this._prefix).then(function(e){var i=e.userInfo;t.resolve(i)}),t},setConfig:function(e){return this._preferenceService.put(this._prefix,{userInfo:e})}},t.prototype.constructor=t,t}),define("orion/git/gitClient",["require","orion/xhr","orion/Deferred","orion/operation"],function(e,t,i,n){var o=o||{};return o.GitService=function(){function o(e){e&&(this._serviceRegistry=e,this._serviceRegistration=e.registerService("orion.git.provider",this))}var r="application/json; charset=UTF-8",s=6e4;return o.prototype={checkGitService:function(){},cloneGitRepository:function(n,o,a,l,c,d,h,u,p,f,g,m){var v=this,_={};n&&(_.Name=n),a&&(_.Path=a),o&&(_.GitUrl=o),_.Location=l,c&&(_.GitSshUsername=c),d&&(_.GitSshPassword=d),h&&(_.GitSshKnownHost=h),u&&(_.GitSshPrivateKey=u),p&&(_.GitSshPassphrase=p),f&&(f.GitMail&&(_.GitMail=f.GitMail),f.GitName&&(_.GitName=f.GitName)),g&&(_.initProject=g),"undefined"!=typeof m&&(_.cloneSubmodules=m);var y=e.toUrl("gitapi/clone/._");y=y.substring(0,y.length-2);var C=new i;return t("POST",y,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify(_)}).then(function(e){v._getGitServiceResponse(C,e)},function(e){v._handleGitServiceResponseError(C,e)}),C},removeGitRepository:function(e){var n=this,o=new i;return t("DELETE",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){n._getGitServiceResponse(o,e)},function(e){n._handleGitServiceResponseError(o,e)}),o},getGitStatus:function(e){var n=this,o=new i;return t("GET",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){n._getGitServiceResponse(o,e)},function(e){n._handleGitServiceResponseError(o,e)}),o},getGitBlame:function(e){var n=this,o=new i;return t("GET",e,{headers:{"Orion-Version":"1","Content-Type":"application/json; charset=UTF-8"},timeout:15e3}).then(function(e){n._getGitServiceResponse(o,e)},function(e){n._handleGitServiceResponseError(o,e)}),o},stage:function(e){var n=this,o=new i;return t("PUT",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){n._getGitServiceResponse(o,e)},function(e){n._handleGitServiceResponseError(o,e)}),o},stageMultipleFiles:function(e,n){var o=this,a=new i;return t("PUT",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({Path:n})}).then(function(e){o._getGitServiceResponse(a,e)},function(e){o._handleGitServiceResponseError(a,e)}),a},unstageAll:function(e,n){var o=this,a=new i;return t("POST",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({Reset:n})}).then(function(e){o._getGitServiceResponse(a,e)},function(e){o._handleGitServiceResponseError(a,e)}),a},unstage:function(e,n){var o=this,a=new i;return t("POST",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({Path:n})}).then(function(e){o._getGitServiceResponse(a,e)},function(e){o._handleGitServiceResponseError(a,e)}),a},checkoutPath:function(e,n){var o=this,a=new i;return t("PUT",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({Path:n,RemoveUntracked:"true"})}).then(function(e){o._getGitServiceResponse(a,e)
},function(e){o._handleGitServiceResponseError(a,e)}),a},ignorePath:function(e,n){var o=this,a=new i;return t("PUT",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({Path:n})}).then(function(e){o._getGitServiceResponse(a,e)},function(e){o._handleGitServiceResponseError(a,e)}),a},commitAll:function(e,n,o){var a=this,l=new i;return t("POST",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:o}).then(function(e){a._getGitServiceResponse(l,e)},function(e){a._handleGitServiceResponseError(l,e)}),l},getGitClone:function(e){var n=this,o=new i;return t("GET",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){n._getGitServiceResponse(o,e)},function(e){n._handleGitServiceResponseError(o,e)}),o},getGitCloneConfig:function(e){var n=this,o=new i;return t("GET",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){n._getGitServiceResponse(o,e)},function(e){n._handleGitServiceResponseError(o,e)}),o},getGitBranch:function(e){var n=this,o=new i;return t("GET",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){n._getGitServiceResponse(o,e)},function(e){n._handleGitServiceResponseError(o,e)}),o},getGitRemote:function(e){var n=this,o=new i;return t("GET",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){n._getGitServiceResponse(o,e)},function(e){n._handleGitServiceResponseError(o,e)}),o},checkoutBranch:function(e,n){var o=this,a=new i;return t("PUT",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({Branch:n})}).then(function(e){o._getGitServiceResponse(a,e)},function(e){o._handleGitServiceResponseError(a,e)}),a},resetIndex:function(e,n,o){var a=this,l=new i;return t("POST",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({Commit:n,Reset:o?o:"HARD"})}).then(function(e){a._getGitServiceResponse(l,e)},function(e){a._handleGitServiceResponseError(l,e)}),l},addBranch:function(e,n,o){var a=this,l={};n&&(l.Name=n),o&&(l.Branch=o);var c=new i;return t("POST",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify(l)}).then(function(e){a._getGitServiceResponse(c,e)},function(e){a._handleGitServiceResponseError(c,e)}),c},removeBranch:function(e){var n=this,o=new i;return t("DELETE",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){n._getGitServiceResponse(o,e)},function(e){n._handleGitServiceResponseError(o,e)}),o},addRemote:function(e,n,o,a){var l=this,c=new i;return t("POST",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({Remote:n,RemoteURI:o,IsGerrit:a})}).then(function(e){l._getGitServiceResponse(c,e)},function(e){l._handleGitServiceResponseError(c,e)}),c},removeRemote:function(e){var n=this,o=new i;return t("DELETE",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){n._getGitServiceResponse(o,e)},function(e){n._handleGitServiceResponseError(o,e)}),o},doGitLog:function(e){var n=this,o=new i;return t("GET",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){n._getGitServiceResponse(o,e)},function(e){n._handleGitServiceResponseError(o,e)}),o},getDiff:function(e,n){var o=this,a=new i;return t("POST",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({New:n})}).then(function(e){o._getGitServiceResponse(a,e)},function(e){o._handleGitServiceResponseError(a,e)}),a},doGitDiff:function(e){var n=this,o=new i;return t("GET",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){n._getGitServiceResponse(o,e)},function(e){n._handleGitServiceResponseError(o,e)}),o},doFetch:function(e,n,o,a,l,c,d){var h=this,u=new i;return t("POST",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({Fetch:"true",Force:n,GitSshUsername:o,GitSshPassword:a,GitSshKnownHost:l,GitSshPrivateKey:c,GitSshPassphrase:d})}).then(function(e){h._getGitServiceResponse(u,e)},function(e){h._handleGitServiceResponseError(u,e)}),u},doPull:function(e,n,o,a,l,c,d){var h=this,u=new i;return t("POST",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({Pull:"true",Force:n,GitSshUsername:o,GitSshPassword:a,GitSshKnownHost:l,GitSshPrivateKey:c,GitSshPassphrase:d})}).then(function(e){h._getGitServiceResponse(u,e)},function(e){h._handleGitServiceResponseError(u,e)}),u},doMerge:function(e,n,o){var a=this,l=new i;return t("POST",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({Merge:n,Squash:o})}).then(function(e){a._getGitServiceResponse(l,e)},function(e){a._handleGitServiceResponseError(l,e)}),l},doCherryPick:function(e,n){var o=this,a=new i;return t("POST",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({"Cherry-Pick":n})}).then(function(e){o._getGitServiceResponse(a,e)},function(e){o._handleGitServiceResponseError(a,e)}),a},doRevert:function(e,n){var o=this,a=new i;return t("POST",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({Revert:n})}).then(function(e){o._getGitServiceResponse(a,e)},function(e){o._handleGitServiceResponseError(a,e)}),a},doRebase:function(e,n,o){var a=this,l={};l.Rebase=n,o&&(l.Operation=o);var c=new i;return t("POST",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify(l)}).then(function(e){a._getGitServiceResponse(c,e)},function(e){a._handleGitServiceResponseError(c,e)}),c},doPush:function(e,n,o,a,l,c,d,h,u){var p=this,f=new i;return t("POST",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({PushSrcRef:n,PushTags:o,Force:a,GitSshUsername:l,GitSshPassword:c,GitSshKnownHost:d,GitSshPrivateKey:h,GitSshPassphrase:u})}).then(function(e){p._getGitServiceResponse(f,e)},function(e){p._handleGitServiceResponseError(f,e)}),f},getLog:function(e,n){var o=this,a=new i,l=new i;return t("POST",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({New:n})}).then(function(e){var t=null;if(e.response&&"string"==typeof e.response){var i=JSON.parse(e.response);i.Location&&(t=i.Location)}t||(t=e.xhr.getResponseHeader("Location")),l.resolve(t)},function(e){o._handleGitServiceResponseError(a,e)}),l.then(function(e){t("GET",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){o._getGitServiceResponse(a,e)},function(e){o._handleGitServiceResponseError(a,e)})}),a},getDefaultRemoteBranch:function(e){var n=this,o=new i,a=new i;return t("GET",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){n._getGitServiceResponse(a,e)},function(e){n._handleGitServiceResponseError(o,e)}),a.then(function(e){t("GET",e.Children[0].Location,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){n._getGitServiceResponse(o,e)},function(e){n._handleGitServiceResponseError(o,e)})}),o},doAddTag:function(e,n){var o=this,a=new i;return t("PUT",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({Name:n})}).then(function(e){o._getGitServiceResponse(a,e)},function(e){o._handleGitServiceResponseError(a,e)}),a},doRemoveTag:function(e){var n=this,o=new i;return t("DELETE",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){n._getGitServiceResponse(o,e)},function(e){n._handleGitServiceResponseError(o,e)}),o},checkoutTag:function(e,n,o){var a=this,l=new i;return t("PUT",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({Tag:n,Branch:o})}).then(function(e){a._getGitServiceResponse(l,e)},function(e){a._handleGitServiceResponseError(l,e)}),l},doStashCreate:function(e,n,o,a){var l=this,c={};null!=n&&(c.IndexMessage=n),null!=o&&(c.WorkingDirectoryMessage=o),a===!0&&(c.IncludeUntracked=!0);var d=new i;return t("POST",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify(c)}).then(function(e){l._getGitServiceResponse(d,e)},function(e){l._handleGitServiceResponseError(d,e)}),d},doStashPop:function(e){var n=this,o=new i;return t("PUT",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){n._getGitServiceResponse(o,e)},function(e){n._handleGitServiceResponseError(o,e)}),o},doStashApply:function(e){var n=this,o=new i;return t("PUT",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){n._getGitServiceResponse(o,e)},function(e){n._handleGitServiceResponseError(o,e)}),o},doStashList:function(e){var n=this,o=new i;return t("GET",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){n._getGitServiceResponse(o,e)},function(e){n._handleGitServiceResponseError(o,e)}),o},doStashDrop:function(e){var n=this,o=new i;return t("DELETE",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){n._getGitServiceResponse(o,e)},function(e){n._handleGitServiceResponseError(o,e)}),o},addCloneConfigurationProperty:function(e,n,o){var a=this,l=new i;return t("POST",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({Key:n,Value:o})}).then(function(e){a._getGitServiceResponse(l,e)},function(e){a._handleGitServiceResponseError(l,e)}),l},editCloneConfigurationProperty:function(e,n){var o=this,a=new i;return t("PUT",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({Value:n})}).then(function(e){o._getGitServiceResponse(a,e)},function(e){o._handleGitServiceResponseError(a,e)}),a},deleteCloneConfigurationProperty:function(e){var n=this,o=new i;return t("DELETE",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){n._getGitServiceResponse(o,e)},function(e){n._handleGitServiceResponseError(o,e)}),o},sendCommitReviewRequest:function(e,n,o,a,l,c){var d=this,h=new i;return t("POST",n,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify({ReviewReqCommit:e,ReviewReqUrl:a,ReviewReqNotifyLogin:o,ReviewReqAuthorName:l,ReviewMessage:c})}).then(function(e){d._getGitServiceResponse(h,e)},function(e){d._handleGitServiceResponseError(h,e)}),h},updateSubmodules:function(e){var n=this,o={};o.Operation="update";var a=new i;return t("PUT",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify(o)}).then(function(e){n._getGitServiceResponse(a,e)},function(e){n._handleGitServiceResponseError(a,e)}),a},syncSubmodules:function(e){var n=this,o={};o.Operation="sync";var a=new i;return t("PUT",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify(o)}).then(function(e){n._getGitServiceResponse(a,e)},function(e){n._handleGitServiceResponseError(a,e)}),a},addSubmodule:function(e,n,o,a,l){var c=this,d={};e&&(d.Name=e),o&&(d.Path=o),a&&(d.GitUrl=a),d.Location=l;var h=new i;return t("POST",n,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify(d)}).then(function(e){c._getGitServiceResponse(h,e)},function(e){c._handleGitServiceResponseError(h,e)}),h},deleteSubmodule:function(e){var n=this,o=new i;return t("DELETE",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s}).then(function(e){n._getGitServiceResponse(o,e)},function(e){n._handleGitServiceResponseError(o,e)}),o},doPullRequestList:function(e,n,o,a,l,c,d){var h=this,u={};n&&(u.GitUrl=n),o&&(u.GitSshUsername=o),a&&(u.GitSshPassword=a),l&&(u.GitSshKnownHost=l),c&&(u.GitSshPrivateKey=c),d&&(u.GitSshPassphrase=d);var p=new i;return t("POST",e,{headers:{"Orion-Version":"1","Content-Type":r},timeout:s,data:JSON.stringify(u)}).then(function(e){h._getGitServiceResponse(p,e)},function(e){h._handleGitServiceResponseError(p,e)}),p},_getGitServiceResponse:function(e,t){var i=t.response?JSON.parse(t.response):null;if(t.xhr&&202===t.xhr.status){var o=n.handle(i.Location);return o.then(e.resolve,function(t){t.failedOperation=i.Location,e.reject(t)},e.progress),void e.then(null,function(e){o.reject(e)})}e.resolve(i)},_handleGitServiceResponseError:function(e,t){e.reject(t)}},o}(),o}),define("orion/ssh/sshTools",["orion/Deferred","orion/xhr"],function(e,t){var i=i||{};return i.SshService=function(){function i(i){if(i&&(this._serviceRegistry=i,this._authService=i.getService("orion.core.auth"),this._serviceRegistration=i.registerService("orion.net.ssh",this),!this._authService)){var n;this._authService={getUser:function(){if(n){var i=new e;return i.resolve(n),i}return t("POST","../../login",{headers:{"Orion-Version":"1"},timeout:15e3}).then(function(e){return n=e.response?JSON.parse(e.response):null},function(e){return n=null,e instanceof Error&&"Cancel"===e.name?"_cancel":e.response?JSON.parse(e.response):null})}}}}return i.prototype={KNOWN_HOSTS:"knownHosts",addKnownHost:function(t){t=t||{};var i=new e,n=this,o=t.host,r=t.keyType,s=t.hostKey,a=t.port||22;return o&&r&&s&&a?(this._authService.getUser().then(function(e){var t=localStorage.getItem(e.login+"/"+n.KNOWN_HOSTS);t=t?JSON.parse(t):[];for(var l=0;l<t.length;++l){var c=t[l];if(c.host===o&&c.port===a)return void i.resolve(c.host+" "+c.keyType+" "+c.hostKey)}var c={host:o,port:a,keyType:r,hostKey:s};t.push(c),localStorage.setItem(e.login+"/"+n.KNOWN_HOSTS,JSON.stringify(t)),i.resolve(c.host+" "+c.keyType+" "+c.hostKey)},function(e){i.reject(e)}),i):(i.reject(),i)},clearKnownHosts:function(){var t=new e,i=this;return this._authService.getUser().then(function(e){var n=localStorage.getItem(e.login+"/"+i.KNOWN_HOSTS);n=n?JSON.parse(n):[],localStorage.removeItem(e.login+"/"+i.KNOWN_HOSTS),t.resolve(n)},function(e){t.reject(e)}),t},getKnownHostCredentials:function(t,i){var n=new e,o=this;return i=i||22,t&&i?(this._authService.getUser().then(function(e){var r=localStorage.getItem(e.login+"/"+o.KNOWN_HOSTS);r=r?JSON.parse(r):[];for(var s=0;s<r.length;++s){var a=r[s];if(a.host===t&&a.port===i)return void n.resolve(a.host+" "+a.keyType+" "+a.hostKey)}n.resolve("")},function(e){n.reject(e)}),n):(n.reject(),n)}},i}(),i}),define("orion/fileUtils",["require","orion/URL-shim"],function(e){function t(e){var t=document.createElement("a");if(t.href=e,e=t.href,r)try{if(window.location.host===parent.location.host&&window.location.protocol===parent.location.protocol)return e.substring(parent.location.href.indexOf(parent.location.host)+parent.location.host.length);r=!1}catch(i){r=!1}return e}function i(e){if(!e)return e;var t=window.location.protocol+"//"+window.location.host;return 0===e.indexOf(t)?e.substring(t.length):e}function n(e){if(!e)return!1;if("/workspace"===e)return!0;var t=new URL(e,window.location.href);return 0===t.href.indexOf(o)}var o,r=!0;return o=e.toUrl?new URL(e.toUrl("workspace"),window.location.href).href:new URL("/",window.location.href).href,{makeParentRelative:t,makeRelative:i,isAtRoot:n}}),define("orion/fileDownloader",["i18n!orion/navigate/nls/messages","orion/i18nUtil","orion/Deferred","orion/URL-shim"],function(e,t,i){function n(){return"undefined"!=typeof a.download||"undefined"!=typeof window.navigator&&window.navigator.msSaveBlob}function o(t){var i={Severity:"Error",Message:e.noResponse};if(0===t.status)return i;if(t.responseText){var n=t.responseText;try{var o=JSON.parse(n);i.Severity=o.Severity||i.Severity,i.Message=o.Message||i.Message}catch(r){i.Message=n}}else try{i.Message=JSON.stringify(t)}catch(r){}return i}function r(e,t){return e?(t.Severity||(t=o(t)),void e.setProgressResult(t)):void window.console.log(t)}function s(e,t,i){this.fileClient=e,this.statusService=t,this.progressService=i}var a=document.createElementNS("http://www.w3.org/1999/xhtml","a");return s.prototype={_isSupported:function(t){return t||n()?!0:(this.statusService&&this.statusService.setProgressResult&&this.statusService.setProgressResult({Message:e["Download not supported"],Severity:"Error"}),!1)},downloadFromLocation:function(n,o,s){if(!this._isSupported(s))return(new i).resolve();var a=this.progressService,l=function(e,i,n){return a?a.progress(e,t.formatMessage(i,n)):e},c=function(e){var t=null;this.serviceRegistry?t=this.serviceRegistry.getService("orion.page.message"):this.statusService&&(t=this.statusService),r(t,e),this._setNoInput()}.bind(this);return this.statusService&&this.statusService.setProgressResult&&this.statusService.setProgressResult({Message:e["Downloading..."]}),l(this.fileClient.readBlob(n.Location),e["Downloading..."],n.Location).then(function(e){return this.statusService&&this.statusService.setProgressMessage&&this.statusService.setProgressMessage(""),this.downloadFromBlob(e,n.Name,o,s),(new i).resolve()}.bind(this),c)},downloadFromBlob:function(e,t,i,n,o){if(this._isSupported(n)){var r=i&&i.id?i.id:"application/octet-stream",s=new Blob([e],{type:r}),a=o?document.createElementNS("http://www.w3.org/1999/xhtml","a"):document.createElement("a");if("undefined"!=typeof a.download){var l=URL.createObjectURL(s);if(a.href=l,a.download=t,o)return a;var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(c)}else if("undefined"!=typeof window.navigator&&window.navigator.msSaveOrOpenBlob){if(o)return a.href="javascript:void(0)",a.addEventListener("click",function(){window.navigator.msSaveBlob(s,t)}),a;window.navigator.msSaveBlob(s,t)}}}},{FileDownloader:s,downloadSupported:n}}),define("orion/explorers/explorer-table",["i18n!orion/navigate/nls/messages","orion/Deferred","orion/webui/littlelib","orion/i18nUtil","orion/fileUtils","orion/explorers/explorer","orion/EventTarget","orion/objects","orion/util"],function(e,t,i,n,o,r,s,a,l){function c(e,t,i,n,o,r){this.registry=e,this.root=t,this.fileClient=i,this.idPrefix=n||"",this.excludeFiles=!!o,this.excludeFolders=!!r}function d(e){s.attach(this),this.registry=e.serviceRegistry,this.treeRoot=e.treeRoot,this.selection=e.selection,this.fileClient=e.fileClient,this.excludeFiles=e.excludeFiles,this.excludeFolders=e.excludeFolders,this.navHandlerFactory=e.navHandlerFactory,this.parentId=e.parentId,this.renderer=e.rendererFactory(this),this.dragAndDrop=e.dragAndDrop,this.setFocus=e.setFocus,this.model=null,this.myTree=null,this.checkbox=!1,this._hookedDrag=!1;var t=e.modelEventDispatcher?e.modelEventDispatcher:new s;this.modelEventDispatcher=t;var n=this;this._modelListeners={},["copy","copyMultiple","create","delete","deleteMultiple","import","move","moveMultiple"].forEach(function(e){t.addEventListener(e,n._modelListeners[e]=n.modelHandler[e].bind(n))});var o=i.node(this.parentId);this._clickListener=function(e){if(!(e.metaKey||e.altKey||e.shiftKey||e.ctrlKey)){var t=n.getNavHandler();if(t&&"cursorOnly"!==t.getSelectionPolicy()){for(var r=e.target;r&&r!==o&&!r._item;)r=r.parentNode;if(r&&r._item){var s=i.$("a",e.target);if(s)return window.location.href=s.href,void n._clickLink(s)}}}n._clickLink(e.target)},o&&o.addEventListener("click",this._clickListener)}c.prototype=new r.ExplorerModel,a.mixin(c.prototype,{getRoot:function(e){e(this.root)},processParent:function(e,t){var i=e.Projects?[]:[e].concat(e.Parents||[]);if(this.excludeFiles||this.excludeFolders){var n=[];for(var o in t){var r=t[o].Directory?this.excludeFolders:this.excludeFiles;r||(n.push(t[o]),t[o].parent=e,t[o].Parents||(t[o].Parents=i))}t=n}else for(var s in t)t[s].parent=e,t[s].Parents||(t[s].Parents=i);return e.children=t,e.children.sort(this.sortChildren),t},sortChildren:function(e,t){var i=e.Directory,n=t.Directory;if(i!==n)return i?-1:1;var o=e.Name&&e.Name.toLowerCase(),r=t.Name&&t.Name.toLowerCase();return r>o?-1:o>r?1:0},getChildren:function(t,i){var n=this;if(t.children)i(t.children);else if(void 0!==t.Directory&&t.Directory===!1)i([]);else if(t.Children)i(n.processParent(t,t.Children));else if(t.Location){var o=null;this.registry&&(o=this.registry.getService("orion.page.progress")),(o?o.progress(this.fileClient.fetchChildren(t.ChildrenLocation),e["Fetching children of "]+t.Name):this.fileClient.fetchChildren(t.ChildrenLocation)).then(function(e){n.destroyed||i(n.processParent(t,e))},function(){i([])})}else i([])},hasChildren:function(){var e=!1;return this.root.Children&&(e=this.root.Children.length>0),e}}),c.prototype.constructor=c;var h,u;return d.prototype=Object.create(r.Explorer.prototype),a.mixin(d.prototype,{destroy:function(){var e=this;Object.keys(this._modelListeners).forEach(function(t){e.modelEventDispatcher.removeEventListener(t,e._modelListeners[t])});var t=i.node(this.parentId);t&&t.removeEventListener("click",this._clickListener),r.Explorer.prototype.destroy.call(this)},_clickLink:function(e){if("A"===e.tagName){for(var t=e;t&&!t._item;)t=t.parentNode;t&&t._item&&this.onLinkClick({type:"linkClick",item:t._item})}},onLinkClick:function(e){this.dispatchEvent(e)},onModelCreate:function(e){return this.changedItem(e.parent,!0)},onModelCopy:function(e){var i=this,n={};return(e.items||[e]).forEach(function(e){var t=e.parent;t=t||i.treeRoot,n[t.Location]=t}),t.all(Object.keys(n).map(function(e){return i.changedItem(n[e],!0)}))},onModelMove:function(e){var i=this,n={};return(e.items||[e]).forEach(function(e){var o=i.treeRoot;if((o.Location||o.ContentLocation)===e.oldValue.Location){var r=i.treeRoot,s=e.newValue,a=s.ChildrenLocation?s:this.fileClient.read(s.ContentLocation,!0);return t.when(a,function(e){i.dispatchEvent({type:"rootMoved",oldValue:r,newValue:e}),i.loadResourceList(e)})}var l=e.oldValue.parent;l=l||i.treeRoot,n[l.Location]=l,l=e.parent,l=l||i.treeRoot,n[l.Location]=l,e.oldValue.Directory&&e.newValue&&i.isExpanded(e.oldValue)&&(n[e.newValue.Location]=e.newValue)}),t.all(Object.keys(n).map(function(e){return i.changedItem(n[e],!0)}))},onModelDelete:function(e){var i,n=e.items||[e],o=this,r=o.treeRoot,s=n.some(function(e){return e.oldValue.Location===(r.Location||r.ContentLocation)?(e.oldValue.Location!==(e.parent.Location||e.parent.ContentLocation)&&(i=e.parent),!0):!1});if(s)return this.loadResourceList(i);var a={};return n.forEach(function(e){var t=e.parent;a[t.Location]=t}),t.all(Object.keys(a).map(function(e){return o.changedItem(a[e],!0)}))},modelHandler:{copy:function(e){return e.count?void 0:this.onModelCopy(e)},copyMultiple:function(e){return this.onModelCopy(e)},create:function(e){return this.onModelCreate(e)},"delete":function(e){return e.count?void 0:this.onModelDelete(e)},deleteMultiple:function(e){return this.onModelDelete(e)},"import":function(e){var t=e.target;return this.changedItem(t,!0)},move:function(e){return e.count?void 0:this.onModelMove(e)},moveMultiple:function(e){return this.onModelMove(e)}},makeNewChildItemPlaceholder:function(e,i,n){var o=new t;return this.model.getChildren(e,function(t){var r=null,s=!1;if(t){t.push(i),t.sort(this.model.sortChildren);var a=t.indexOf(i),l=a+1;if(t.length>l)r=t[l];else{var c=a-1;r=c>=0?t[c]:e,s=!0}}else r=e;var d=this.makeNewItemPlaceholder(r,n,s);o.resolve(d)}.bind(this)),o},_makeDropTarget:function(r,s,a){function c(i,s,a,l,d,h){var u=!1,p=o.isAtRoot(s.Location);h?(u=!0,h.entryCount++):i.isDirectory&&(u=!0,h={entryCount:1,deferred:new t},a._makeUploadNode(s,i.name,!0).then(function(e){var t=function(){e.destroyFunction(),p?a.loadResourceList(a.treeRoot.Path,!0):a.changedItem(s)};h.deferred.then(t,t)}));var f=function(){h&&(h.entryCount--,0===h.entryCount&&h.deferred.resolve())},g=function(e){if(C){var t=null;t="string"==typeof e?{Severity:"Error",Message:e}:e&&e.error?{Severity:"Error",Message:e.error}:e,C.setProgressResult(t)}else window.console.log(e);f()};if(!s.Location&&s.fileMetadata&&(s=s.fileMetadata),i.isFile)p?g(e.CreateFolderErr):i.file(function(t){if(h){var i=t.name.indexOf(".zip")===t.name.length-4&&window.confirm(n.formatMessage(e["Unzip ${0}?"],t.name)),o={error:function(){var i=e.UploadingFileErr+t.name;C?C.setProgressResult({Severity:"Error",Message:i}):window.console.log(i)},loadend:f};l(s,t,a,i,!1,o,!0)}else a._uploadFile(r,t,!0)}.bind(this));else if(i.isDirectory){var m=i.createReader(),v=function(e){m.readEntries(function(t){for(var i=0;i<t.length;i++)c(t[i],e,a,l,d,h);f()})};p?(y?y.progress(d.createProject(s.ChildrenLocation,i.name),n.formatMessage(e["Creating ${0}"],i.name)):d.createProject(s.ChildrenLocation,i.name)).then(function(t){(y?y.progress(d.read(t.ContentLocation,!0),e["Loading "]+t.name):d.read(t.ContentLocation,!0)).then(function(e){v(e)},g)},g):(y?y.progress(d.createFolder(s.Location,i.name),n.formatMessage(e["Creating ${0}"],i.name)):d.createFolder(s.Location,i.name)).then(function(e){var t=a.modelEventDispatcher;u||t.dispatchEvent({type:"create",parent:r,newValue:e}),v(e)},g)}}if(this.dragAndDrop){var d=this,p=this.dragAndDrop,f=function(e){h=e.target};a&&(this._oldDragStart&&s.removeEventListener("dragstart",this._oldDragStart,!1),this._oldDragStart=f),s.addEventListener("dragstart",f,!1);var g=function(){h=null};a&&(this._oldDragEnd&&s.removeEventListener("dragend",this._oldDragEnd,!1),this._oldDragEnd=g),s.addEventListener("dragend",g,!1);var m=function(e){s.classList.remove("dragOver"),e.preventDefault(),e.stopPropagation()};a&&(this._oldDragLeave&&s.removeEventListener("dragleave",this._oldDragLeave,!1),this._oldDragLeave=m),s.addEventListener("dragleave",m,!1);var v=function(e){if(h){var t=l.isMac?e.altKey:e.ctrlKey;u=e.dataTransfer.dropEffect=t?"copy":"move"}else!l.isIE&&("all"===e.dataTransfer.effectAllowed||"uninitialized"===e.dataTransfer.effectAllowed||e.dataTransfer.effectAllowed.indexOf("copy")>=0)&&(e.dataTransfer.dropEffect="copy");s.classList.add("dragOver"),i.stop(e)};a&&(this._oldDragEnter&&s.removeEventListener("dragenter",this._oldDragEnter,!1),this._oldDragEnter=v),s.addEventListener("dragenter",v,!1);var _=function(e){if(h){var t=l.isMac?e.altKey:e.ctrlKey;u=e.dataTransfer.dropEffect=t?"copy":"move"}else!l.isIE&&("all"===e.dataTransfer.effectAllowed||"uninitialized"===e.dataTransfer.effectAllowed||e.dataTransfer.effectAllowed.indexOf("copy")>=0)&&(e.dataTransfer.dropEffect="copy");i.stop(e)};a&&!this._oldDragOver&&(s.addEventListener("dragover",_,!1),this._oldDragOver=_);var y=null,C=null;d.registry&&(y=d.registry.getService("orion.page.progress"),C=d.registry.getService("orion.page.message"));var w=function(e){if(C){var t=null;t="string"==typeof e?{Severity:"Error",Message:e}:e&&e.error?{Severity:"Error",Message:e.error}:e,C.setProgressResult(t)}else window.console.log(e)},b=function(t){var a,l;if(s.classList.remove("dragOver"),h){for(var f,g=d.fileClient,m=h;m;){if(m._item){f=m._item;break}m=m.parentNode}if(!f)return;var v="copy"===u,_=v?g.copyFile:g.moveFile;if(l=_.apply(g,[f.Location,r.Location,f.Name]),y){var C=n.formatMessage(e[v?"Copying ${0}":"Moving ${0}"],f.Location);l=y.showWhile(l,C)}l.then(function(e){var t=d.modelEventDispatcher;t.dispatchEvent({type:v?"copy":"move",oldValue:f,newValue:e,parent:r})},function(t){if(400===t.status||412===t.status){var i=t.responseText;if("string"==typeof i)try{i=JSON.parse(i),i.Message=e[v?"CopyFailed":"MoveFailed"],t=i}catch(t){}}w(t)})}else if(t.dataTransfer.items&&t.dataTransfer.items.length>0)for(a=0;a<t.dataTransfer.items.length;a++){var b=null;"function"==typeof t.dataTransfer.items[a].getAsEntry?b=t.dataTransfer.items[a].getAsEntry():"function"==typeof t.dataTransfer.items[a].webkitGetAsEntry&&(b=t.dataTransfer.items[a].webkitGetAsEntry()),b&&c(b,r,d,p,d.fileClient)}else if(t.dataTransfer.files&&t.dataTransfer.files.length>0)for(a=0;a<t.dataTransfer.files.length;a++){var S=t.dataTransfer.files[a];S.size||S.type?o.isAtRoot(r.Location)?w(e.CreateFolderErr):d._uploadFile(r,S,!0):w(n.formatMessage(e.FolderDropNotSupported,S.name))}i.stop(t)};a&&(this._oldDrop&&s.removeEventListener("drop",this._oldDrop,!1),this._oldDrop=b),s.addEventListener("drop",b,!1)}},_uploadFile:function(t,i,o){var r=t;!r.Location&&r.fileMetadata&&(r=r.fileMetadata);var s=function(){this._makeUploadNode(r,i.name,!1).then(function(t){var o=t.refNode,s=t.progressBar,a=t.cancelButton,l=t.destroyFunction,c=this.registry.getService("orion.page.message"),d={progress:function(t){var i="";if(t.lengthComputable){i=Math.floor(t.loaded/t.total*100)+"%",s.style.width=i;var n=Math.round(t.loaded/1024),r=Math.round(t.total/1024);s.title=e["Upload progress: "]+i+",  "+n+"/"+r+" KB",o.title=s.title}},loadend:function(){l(),this.changedItem(r,!0)}.bind(this),error:function(){var t=e.UploadingFileErr+i.name;c?c.setProgressResult({Severity:"Error",Message:t}):window.console.log(t)}},h=i.name.indexOf(".zip")===i.name.length-4&&window.confirm(n.formatMessage(e["Unzip ${0}?"],i.name)),u=this.dragAndDrop(r,i,this,h,!1,d,!0);a.addEventListener("click",function(){u.abort()})}.bind(this))}.bind(this);o?this.expandItem(r,!1).then(s):s()},_makeUploadNode:function(t,i,n){var o=this.getRow(t)?this.getRow(t).id:this.parentId,r={Name:i,Directory:n};return this.makeNewChildItemPlaceholder(t,r,o).then(function(t){var o,r,s=null;if(t){s={},o=t.refNode,r=t.wrapperNode,o.classList.add("uploadNode"),s.refNode=o,s.wrapperNode=r;var a=document.createElement("span");a.classList.add("uploadNodeText"),a.appendChild(document.createTextNode(i)),o.appendChild(a);var l=document.createElement("span");l.classList.add("progressBarWrapper");var c=document.createElement("span");if(c.classList.add("progressBar"),l.appendChild(c),o.appendChild(l),s.progressBar=c,n)c.classList.add("continuous"),o.title=e["Uploading "]+i,c.title=o.title;else{var d=document.createElement("button");d.classList.add("imageSprite"),d.classList.add("core-sprite-delete"),d.classList.add("uploadCancelButton"),d.title=e["Cancel upload"],o.appendChild(d),s.cancelButton=d}s.destroyFunction=t.destroyFunction}return s}.bind(this))},createModel:function(){return new c(this.registry,this.treeRoot,this.fileClient,this.parentId,this.excludeFiles,this.excludeFolders)},changedItem:function(e,i){if(this.treeRoot&&this.treeRoot.Location===e.Location)return this.loadResourceList(this.treeRoot,i);var n=this,o=new t;return e.children=e.Children=null,this.model.getChildren(e,function(t){n.getNavHandler(),n.myTree.refresh.bind(n.myTree)(e,t,i),o.resolve(t)}),o},showItem:function(e,i){var n=new t;if(!e||!this.model||!this.myTree)return n.reject();if(!this.myTree.showRoot&&e.Location===this.treeRoot.Location)return n.resolve(this.treeRoot);var o=this.getRow(e);return o?(n.resolve(o._item||e),n):e.Parents&&e.Parents.length>0?(e.Parents[0].Parents=e.Parents.slice(1),this.expandItem(e.Parents[0],i).then(function(i){var n=this.getRow(e);return n?n._item||e:this.changedItem(i,!0).then(function(){var n=this.getRow(e);return n||(i.children.unshift(e),this.myTree.refresh(i,i.children,!1),n=this.getRow(e)),n?n._item:(new t).reject()}.bind(this))}.bind(this))):void 0===i||i?this.reroot(e):n.reject()},expandItem:function(e,i){var n=new t;return this.showItem(e,i).then(function(t){e.Children&&!t.Children&&(t.Children=e.Children),this.myTree.isExpanded(t)?n.resolve(t):this.myTree.expand(this.model.getId(t),function(){n.resolve(t)})}.bind(this),n.reject),n},insertMissingItem:function(){return null},reveal:function(e,t){return this.showItem(e,t).then(function(e){this.select(e)}.bind(this))},reroot:function(){return(new t).reject()},isExpanded:function(e){var t=this.model.getId(e);return this.renderer.tableTree.isExpanded(t)},getNameNode:function(e){var t=this.model.getId(e);return t?i.node(t+"NameLink"):void 0},scopeUp:function(){},scopeDown:function(){},loadResourceList:function(i,n,r){if(i&&"object"==typeof i&&(i=i.ChildrenLocation||i.ContentLocation),i=o.makeRelative(i),!n&&i===this._lastPath)return(new t).resolve(this.treeRoot);this._lastPath=i;var s=this;return n||i!==this.treeRoot.Path?this.load(this.fileClient.loadWorkspace(i),e["Loading "]+i,r).then(function(){return s.treeRoot.Path=i,(new t).resolve(s.treeRoot)},function(e){return s.treeRoot.Path=null,(new t).reject(e)}):(new t).resolve(s.treeRoot)},load:function(e,n,o){var r=i.node(this.parentId),s=i.node("progress");s||(s=document.createElement("div"),s.id="progress",s.classList.add("fileExplorerProgressDiv"),i.empty(r),r.appendChild(s)),i.empty(s);var a=setTimeout(function(){i.empty(s),s.appendChild(document.createTextNode(n))},500),l=this;return t.when(e,function(e){if(clearTimeout(a),!l.destroyed){l.treeRoot={};for(var i in e)l.treeRoot[i]=e[i];if(l.model=l.createModel(),l.dragAndDrop)if(l._hookedDrag)l._makeDropTarget(l.treeRoot,r,!0);
else{var n=r&&("draggable"in r||"ondragstart"in r&&"ondrop"in r);n=n&&!!(window.File&&window.FileList&&window.FileReader),l._hookedDrag=!0,n?l._makeDropTarget(l.treeRoot,r,!0):(l.dragAndDrop=null,window.console.log("Local file drag and drop is not supported in this browser."))}var s=new t;return l.createTree(l.parentId,l.model,{onComplete:function(e){s.resolve(e)},navHandlerFactory:l.navHandlerFactory,showRoot:l.showRoot,setFocus:"undefined"==typeof l.setFocus?!0:l.setFocus,selectionPolicy:l.renderer.selectionPolicy,onCollapse:function(e){l.getNavHandler()&&l.getNavHandler().onCollapse(e)}}),s.then(function(){if("function"==typeof o)try{o()}catch(e){l.registry&&l.registry.getService("orion.page.message").setErrorMessage(e)}return"function"==typeof l.onchange&&l.onchange(l.treeRoot),l.dispatchEvent({type:"rootChanged",root:l.treeRoot}),l.treeRoot})}},function(e){return clearTimeout(a),l.registry&&l.registry.getService("orion.page.message").setProgressResult(e),l.dispatchEvent({type:"rootChanged",root:l.treeRoot}),(new t).reject(e)})},onchange:function(){}}),d.prototype.constructor=d,{FileExplorer:d,FileModel:c}}),define("orion/webui/dialogs/DirectoryPrompterDialog",["i18n!orion/widgets/nls/messages","orion/webui/dialog","orion/fileUtils","orion/selection","orion/explorers/explorer","orion/explorers/explorer-table","orion/bidiUtils"],function(e,t,i,n,o,r,s){function a(e,t){this.explorer=t,this._init(e)}function l(e){this._init(e)}return a.prototype=new o.SelectionRenderer,a.prototype.constructor=a,a.prototype.getLabelColumnIndex=function(){return 0},a.prototype.getCellElement=function(e,t,i){var n=document.createElement("td");i.appendChild(n);var o=document.createElement("span");o.id=i.id+"navSpan",n.appendChild(o),o.className="mainNavColumn singleNavColumn",this.getExpandImage(i,o);var r=t.Name;s.isBidiEnabled&&(r=s.enforceTextDirWithUcc(r)),o.appendChild(document.createTextNode(r))},l.prototype=new t.Dialog,l.prototype.TEMPLATE='<div id="message" style="width: 25em; padding-bottom: 5px;"></div><div id="directoryTree" class="explorerTreeClass" style="width:25em; min-height: 25em; max-height:30em; height: auto; overflow-y: auto;"></div>',l.prototype._init=function(t){this.title=t.title||e["Choose a Folder"],this.modal=!0,this.buttons=[{text:e.OK,isDefault:!0,callback:this.done.bind(this)}],this.customFocus=!0,this.root=t.root||"/",this._fileClient=t.fileClient,this._serviceRegistry=t.serviceRegistry,this._message=t.message||"",this._func=t.func,this._initialize()},l.prototype._bindToDom=function(){this.loadFolderList(this.root),this._message?this.$message.appendChild(document.createTextNode(this._message)):this.$message.style.display="none",this.$directoryTree.focus()},l.prototype.loadFolderList=function(e){e=i.makeRelative(e),this.selection=new n.Selection(this._serviceRegistry,"orion.directoryPrompter.selection"),this.explorer=new r.FileExplorer({treeRoot:{children:[]},selection:this.selection,serviceRegistry:this._serviceRegistry,fileClient:this._fileClient,parentId:"directoryTree",excludeFiles:!0,rendererFactory:function(e){return new a({checkbox:!1,singleSelection:!0,treeTableClass:"directoryPrompter"},e)}}),this.explorer.loadResourceList(e,!0,null)},l.prototype.done=function(){this.selection.getSelection(function(e){this.hide(),this._func(e)}.bind(this))},l.prototype.constructor=l,{DirectoryPrompterDialog:l}}),define("orion/webui/popupdialog",["i18n!orion/widgets/nls/messages","orion/webui/littlelib","orion/webui/tooltip"],function(e,t,i){function n(){}return n.prototype={_initialize:function(n,o,r,s,a){this._tooltip=new i.Tooltip({node:n,hideDelay:a||0,afterShowing:this._afterShowingFunction(o).bind(this),afterHiding:r,trigger:s?s:"click"}),this.$parent=this._tooltip.contentContainer(),this.$parent.setAttribute("role","dialog");var l=document.createRange();l.selectNode(this.$parent);var c=l.createContextualFragment(this.TEMPLATE);t.processTextNodes(c,this.messages||e),this.$parent.appendChild(c);var d=this._tooltip;this.$parent.addEventListener("keydown",function(e){e.keyCode===t.KEY.ESCAPE&&d.hide()},!1),this._bindElements(this.$parent),"function"==typeof this._bindToDom&&this._bindToDom(this.$parent)},_bindElements:function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];i.id&&(this["$"+i.id]=i),this._bindElements(i)}},_afterShowingFunction:function(e){return function(){if(e&&e.bind(this)(),!this.customFocus){var i=t.firstTabbable(this.$parent);i&&i.focus()}}},hide:function(){this._tooltip.hide()},show:function(){this._tooltip.show()},isShowing:function(){return this._tooltip.isShowing()}},n.prototype.constructor=n,{PopupDialog:n}}),define("orion/webui/dialogs/SFTPConnectionDialog",["i18n!orion/widgets/nls/messages","orion/webui/littlelib","orion/webui/popupdialog","orion/webui/dialog"],function(e,t,i,n){function o(t,i){this.messages=e,this._initialize(t),this._notify=i}function r(e){this._init(e)}if(!localStorage.getItem("orion.sftpConnections")){var s={identifier:"name",label:e.name,items:[]};localStorage.setItem("orion.sftpConnections",JSON.stringify(s))}return o.prototype=new i.PopupDialog,o.prototype.TEMPLATE='<div><label for="sftpHost">${Remote host:}</label><input id="sftpHost" /></div><div><label for="sftpPort">${Port:}</label><input id="sftpPort" /></div><div><label for="sftpPath">${Remote path:}</label><input id="sftpPath" /></div><div><label for="sftpUser">${User name:}</label><input id="sftpUser" /></div><div class="layoutBlock layoutRight"><button id="addSftpConnection" class="dropdownTrigger orionButton commandButton">${Add}</button></div>',o.prototype._bindToDom=function(){var e=this,t=function(){var e=this.$sftpUser.value+"@"+this.$sftpHost.value+":"+this.$sftpPort.value+this.$sftpPath.value;this._notify({name:e}),this.hide()};this.$addSftpConnection.addEventListener("click",t.bind(e),!1)},o.prototype.constructor=o,r.prototype=new n.Dialog,r.prototype.TEMPLATE='<div><div><label for="sftpPath">${Location:}</label></div><div><select id="sftpConnectionList" name="sftpConnectionList"></select><button id="newSftpConnection" style="margin-left: 16px;" class="dropdownTrigger orionButton commandButton">${New}<span class="dropdownArrowDown core-sprite-openarrow"></span></button></div><div><label for="sftpPassword">${Password:}</label></div><div><input id="sftpPassword" type="password" /></div><p>${If the same file exists in both the source and destination:}</p><input type="radio" name="overwriteOption" id="overwriteCancel" checked value="overwriteCancel" /><label for="overwriteCancel">${Cancel the transfer}</label><br /><input type="radio" name="overwriteOption" id="overwriteAll" value="overwriteAll" /><label for="overwriteAll">${Always overwrite destination}</label><br /><input type="radio" name="overwriteOption" id="overwriteOlder" value="overWriteOlder" /><label for="overwriteOlder">${Overwrite if source is newer}</label></div>',r.prototype._init=function(t){this.title=e["SFTP Transfer"],this.messages=e,this.modal=!0,this.buttons=[{text:e["Start Transfer"],callback:this.done.bind(this)}],this.sftpConnectionStoreData=JSON.parse(localStorage.getItem("orion.sftpConnections")),this._func=t.func,this._initialize()},r.prototype._bindToDom=function(){this.$sftpConnectionList.style.minWidth="220px",this._popupDialog=new o(this.$newSftpConnection,this.onAddConnection.bind(this)),this._addChildDialog(this._popupDialog),this._populateSelect()},r.prototype._afterHiding=function(){this._popupDialog.hide()},r.prototype.done=function(){var e,t,i,n,o,r=this.$sftpConnectionList.value,s=r.split("@");if(2===s.length)n=s[0],o=s[1];else{if(3!==s.length)return void this.hide();n=s[0]+"@"+s[1],o=s[2]}var a=o.indexOf(":");0>=a&&(t=22);var l=o.indexOf("/");return 0>=l?void this.hide():(t?(e=o.substring(0,l),i=o.substring(l)):(e=o.substring(0,a),t=o.substring(a+1,l),i=o.substring(l)),this._func(e,t,i,n,this.$sftpPassword.value,this._computeOverwriteValue()),void this.hide())},r.prototype._computeOverwriteValue=function(){return this.$overwriteCancel.checked?"no-overwrite":this.$overwriteOlder.checked?"overwrite-older":""},r.prototype._populateSelect=function(){t.empty(this.$sftpConnectionList);for(var e=0;e<this.sftpConnectionStoreData.items.length;e++){var i=this.sftpConnectionStoreData.items[e].name,n=document.createElement("option");n.appendChild(document.createTextNode(i)),n.value=i,this.$sftpConnectionList.appendChild(n)}},r.prototype.onAddConnection=function(e){for(var t=!1,i=0;i<this.sftpConnectionStoreData.items.length;i++)if(this.sftpConnectionStoreData.items[i].name===e.name){t=!0;break}t||(this.sftpConnectionStoreData.items.unshift(e),localStorage.setItem("orion.sftpConnections",JSON.stringify(this.sftpConnectionStoreData)),this._populateSelect(),this.$sftpConnectionList.value=e.name)},r.prototype.constructor=r,{SFTPConnectionDialog:r}}),define("orion/form",[],function(){function e(e){return encodeURIComponent(e).replace(/[!'()*]/g,escape).replace("%20","+")}return{encodeFormData:function(t){t=t||{};for(var i=Object.keys(t),n=[],o=0;o<i.length;o++){var r=i[o],s=t[r];n.push(e(r)+"="+e(s))}return n.join("&")},encodeSlug:function(e){return e.replace(/([^\u0020-\u007e]|%)+/g,encodeURIComponent)}}}),define("orion/fileCommands",["i18n!orion/navigate/nls/messages","orion/webui/littlelib","orion/i18nUtil","orion/uiUtils","orion/fileUtils","orion/commands","orion/fileDownloader","orion/commandRegistry","orion/contentTypes","orion/compare/compareUtils","orion/Deferred","orion/webui/dialogs/DirectoryPrompterDialog","orion/webui/dialogs/SFTPConnectionDialog","orion/EventTarget","orion/form","orion/xsrfUtils","orion/bidiUtils"],function(e,t,i,n,o,r,s,a,l,c,d,h,u,p,f,g,m){function v(e){var t=E;t&&"function"==typeof t.dispatchEvent&&t.dispatchEvent(e)}function _(e){L?L.setProgressResult(e):window.console.log(e)}function y(e,i,o,r,s){var a,l,c=!0,d=!1,h=e.makeNewItemPlaceholder(i,o,!0);if(h?(a=h.refNode,c=!1,d=!0):a=t.node(o),a){var u=function(e){e&&s(e)};n.getUserText({id:o+"EditBox",refNode:a,hideRefNode:c,initialText:r,onComplete:u,onEditDestroy:h.destroyFunction,isInitialValid:!0,insertAsChild:d})}else l=window.prompt(r),l&&s(l)}function C(e){return e?(Array.isArray(e)&&(e=1===e.length?e[0]:{}),e):{}}function w(t,n,r,s,a,l){if(L=r,s){var c;c=o.isAtRoot(t.treeRoot.ChildrenLocation)?t.treeRoot:L.progress(n.loadWorkspace(t.treeRoot.Location),"Loading workspace"),d.when(c,function(t){var o=n.createProject(t.ChildrenLocation,s);l&&(o=r.showWhile(o,l)),o.then(function(e){r.progress(n.read(e.ContentLocation,!0),"Reading metadata of newly created project "+s).then(function(e){a&&a(e),v({type:"create",parent:c,newValue:e})},_)},function(t){if(400===t.status||412===t.status){var n=t.responseText;if("string"==typeof n)try{n=JSON.parse(n),n.Message=i.formatMessage(e.FailedToCreateProject,s),t=n}catch(t){}}_(t)})},_)}}var b,S={},x=!1,L=null,T={Location:null};S.setExplorer=function(e){b=e};var E;S.getModelEventDispatcher=function(){return E||(E=new p),E},S.uploadFile=function(e,t,i,n,o,r,s){var a=new XMLHttpRequest;r&&(r.progress&&a.upload.addEventListener("progress",r.progress,!1),r.load&&a.upload.addEventListener("load",r.load,!1),r.error&&a.upload.addEventListener("error",r.error,!1),r.abort&&a.upload.addEventListener("abort",r.abort,!1),r.loadend&&a.addEventListener("loadend",r.loadend,!1)),a.open("post",e.ImportLocation,!0),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("Slug",f.encodeSlug(t.name)),g.addCSRFNonce(a);var l=o?"overwrite-older":"no-overwrite";return n||(l+=",raw"),a.setRequestHeader("X-Xfer-Options",l),a.setRequestHeader("Content-Type","application/octet-stream"),a.onreadystatechange=function(){if(4===a.readyState){if(400===a.status){var o={};try{o=JSON.parse(a.responseText)}catch(l){}if(o.JsonData&&o.JsonData.ExistingFiles){var c=i&&i.serviceRegistry?i.serviceRegistry.getService("orion.page.dialog").confirm:confirm;if(c(o.Message+"\nWould you like to retry the import with force overwriting?"))return void S.uploadFile(e,t,i,n,!0,r)}}s||v({type:"create",parent:e,newValue:null})}}.bind(this),a.send(t),a},S.updateNavTools=function(e,i,n,o,r,s,a){function l(e,n){var o=Array.isArray(r)?r:[r];o.forEach(function(o){var r=t.node(o);if(r){var s=i._contributionsByScopeId[o];e=e||s&&s.localSelectionService||i.getSelectionService(),s&&e&&e.getSelections(function(e){i.destroy(r);var t=!e||Array.isArray(e)&&!e.length;a&&t?i.renderCommands(r.id,r,n,b,"button"):i.renderCommands(r.id,r,null,b,"button")})}})}if(b=n,o){var c=t.node(o);if(!c)throw new Error("could not find toolbar "+o);i.destroy(c),T.Location&&s.Location!==T.Location&&(i.closeParameterCollector(),T.Location=s.Location),i.renderCommands(c.id,c,s,b,"button")}if(r&&l(null,b?b.getTreeRoot():null),!x){x=!0;var d=e.getService("orion.page.selection");d.addEventListener("selectionChanged",function(){l(d,b?b.getTreeRoot():null)})}};var k=[],N=!1;return S.getCutBuffer=function(){return N?k:null},S.isEqualToOrChildOf=function(e,t){return e.Location===t.Location?!0:-1!==e.Location.indexOf(t.Location)?e.parent===t.parent?!1:!0:!1},S.createFileCommands=function(p,f,g){function x(e,t){return-1!==e.indexOf(t)}function T(e){e=o.makeRelative(e);var t=e.split("#"),i=t[t.length-1],n=i.indexOf("/?");return n>0&&(i=i.substring(0,n+1)),i}function E(e){return b&&b.isCommandsVisible()?(e=C(e),e.Location&&o.isAtRoot(e.Location)):!1}function A(t,n,o){t=Array.isArray(t)?t:[t];for(var r=function(e){Array.isArray(e)||(e=[e]);var t=[],i=[],n=this;e.forEach(function(r){var s=o?g.copyFile:g.moveFile;t.push(s.apply(g,[r.Location,n.path,r.Name]).then(function(t){i.push({oldValue:r,newValue:t,parent:n.item}),B({type:o?"copy":"move",oldValue:r,newValue:t,parent:n.item,count:e.length})},_))}),d.all(t).then(function(){B({type:o?"copyMultiple":"moveMultiple",items:i})})},s=function(t){var n=new h.DirectoryPrompterDialog({title:e["Choose a Folder"],serviceRegistry:p,fileClient:g,func:function(n){if(n&&n.Location){Array.isArray(t)||(t=[t]);var r=[],s=[];t.forEach(function(a){var l=n.Location,c=a.Name||null,d=o?g.copyFile:g.moveFile,h=i.formatMessage(o?e["Copying ${0}"]:e["Moving ${0}"],a.Location);if(o&&a.parent&&a.parent.Location===l&&(c=window.prompt(i.formatMessage(e.EnterName,a.Name),i.formatMessage(e["Copy of ${0}"],a.Name)),c||(l=null)),l){var u=d.apply(g,[a.Location,n.Location,c]);r.push(L.showWhile(u,h).then(function(e){s.push({oldValue:a,newValue:e,parent:n}),B({type:o?"copy":"move",oldValue:a,newValue:e,parent:n,count:t.length})},_))}}),d.all(r).then(function(){B({type:o?"copyMultiple":"moveMultiple",items:s})})}}});n.show()},a=[],l=0;l<t.length;l++)t[l].parent&&t[l].parent.Location&&(t[l].parent.stripped=t[l].parent.stripped||T(t[l].parent.Location),x(a,t[l].parent.stripped)||a.push(t[l].parent.stripped)),t[l].Directory&&!o&&(t[l].stripped=t[l].stripped||T(t[l].Location),a.push(t[l].stripped));var c=[],u=[],f=b.treeRoot.Children||(b.treeRoot.Workspace?b.treeRoot.Workspace.Children:{});for(l=0;l<f.length;l++){var m=f[l];m.stripped=m.stripped||(m.Directory?T(m.Location):null),m.stripped&&!x(a,m.stripped)&&u.push(m)}for(u.sort(function(e,t){return e.stripped<t.stripped?-1:e.stripped>t.stripped?1:0}),l=0;l<u.length;l++){for(var v=u[l],y=v.Name,C=v.stripped.split("/").length+1,w=0;C-2>w;w++)y="  "+y;c.push({name:y,path:v.stripped,item:v,callback:r})}return u.length>0&&c.push({}),c.push({name:e.ChooseFolder,callback:s}),c}function R(e){return e.parent?{item:e,parent:e.parent}:e.Parents&&e.Parents[0]?{item:e,parent:e.Parents[0]}:g.loadWorkspace(g.fileServiceRootURL(e.Location)).then(function(t){return d.when(t.Children||g.fetchChildren(t)).then(function(i){t.Children=i;var n=t.Children.some(function(t){return t.Location===e.Location?(e=t,!0):!1});return{item:e,parent:n?t:null}})})}function I(e){var t;return Array.isArray(e)||(e=[e]),e.some(function(e){var i;return i=e.Directory?e:e.parent,i?(t=i,!0):!1}),t&&o.isAtRoot(t.Location)?null:t}function D(e){return b&&b.isCommandsVisible()?I(e):!1}function P(t,n){var o=t.Location;d.when(R(t),function(r){t=r.item;var s=r.parent;s&&s.Projects&&s.Projects.some(function(e){return e.Id===t.Id?(o=e.Location,!0):!1});var a=s.Location||s.WorkspaceLocation,l=g.moveFile(o,a,n);L.showWhile(l,i.formatMessage(e["Renaming ${0}"],o)).then(function(e){t.parent||(t.parent=s),B({type:"move",oldValue:t,newValue:e,parent:s})},_)})}function M(t,i,n){var o=function(e){for(var t=0,n=i,o=e.filter(function(e){return 0===e.Name.indexOf(i)}).map(function(e){return e.Name});-1!==o.indexOf(n);)t++,n=i.concat(" (").concat(t).concat(")");return n};if(t.children){var r=o(t.children);n(r)}else{var s=t.ChildrenLocation;L.progress(g.fetchChildren(s),e["Fetching children of "]+t.Name).then(function(e){var t=o(e);n(t)},_)}}function O(t,n,o){var r=function(t){if(t){var r=n.Location,s=o?"createFolder":"createFile",a=g[s](r,t);L.showWhile(a,i.formatMessage(e["Creating ${0}"],t)).then(function(e){B({type:"create",parent:n,newValue:e})},function(n){if(400===n.status||412===n.status){var o=n.responseText;if("string"==typeof o)try{o=JSON.parse(o),o.Message=i.formatMessage(e.FailedToCreateFile,t),n=o}catch(n){}}_(n)})}};M(n,t,function(e){y(b,n,b.getRow(n),e,function(e){r(e)})})}L=p.getService("orion.page.progress");var B=v.bind(null),F=function(e){if(!b||!b.isCommandsVisible())return!1;var t=Array.isArray(e)?e:[e];if(0===t.length)return!1;for(var i=0;i<t.length;i++)if(e=t[i],!e.Location||e.Projects)return!1;return!0},j=function(e,i){var o=b.getNameNode(e);if(!o){if(!i)return;o=i.domParent||i.domNode}var r=o.id+"EditBox";t.node(r)||n.getUserText({id:r,refNode:o,hideRefNode:!0,initialText:e.Name,onComplete:P.bind(null,e),selectTo:e.Directory?"":"."})},V=new r.Command({name:e.Rename,tooltip:e.RenameFilesFolders,imageClass:"core-sprite-rename",id:"eclipse.renameResource",visibleWhen:function(e){return b&&b.isCommandsVisible()?Array.isArray(e)?1===e.length&&e[0].Name:e.Location&&!e.Projects:!1},parameters:new a.ParametersDescription(null,{},function(t){var i=Array.isArray(t.items)?t.items:[t.items],n=b.treeRoot;return i.some(function(e){return e===n})?[new a.CommandParameter("name","text",e["Name:"],n.Name)]:null}),callback:function(e){var t,i=C(e.items);e.parameters.hasParameters()&&null!==(t=e.parameters.valueFor("name"))?P(i,t):j(i,e)}});f.addCommand(V);var U=new l.ContentTypeRegistry(p),W=new r.Command({name:e.CompareEach,tooltip:e["Compare 2 files"],id:"eclipse.compareWithEachOther",visibleWhen:function(e){if(!b||!b.isCommandsVisible())return!1;if(Array.isArray(e)){if(2===e.length&&!e[0].Directory&&!e[1].Directory)return!0;if(2===e.length&&e[0].Directory&&e[1].Directory)return!0}return!1},hrefCallback:function(e){return e.items[0].Directory&&e.items[1].Directory?c.generateCompareTreeHref(e.items[0].Location,{compareTo:e.items[1].Location,readonly:!0}):c.generateCompareHref(e.items[0].Location,{compareTo:e.items[1].Location,readonly:!1,readonlyRight:!1})}});f.addCommand(W);var z=new r.Command({name:e["Compare with..."],tooltip:e.CompareFolders,id:"eclipse.compareWith",visibleWhen:function(e){return b&&b.isCommandsVisible()&&Array.isArray(e)&&1===e.length&&e[0].Directory?!0:!1},callback:function(t){var i=new h.DirectoryPrompterDialog({title:e["Choose a Folder"],serviceRegistry:p,fileClient:g,func:function(e){if(e&&e.Location){var i=c.generateCompareTreeHref(t.items[0].Location,{compareTo:e.Location,readonly:!0});window.open(i)}}});i.show()}});f.addCommand(z);var H=new r.Command({name:e.Download,tooltip:e.Download_tooltips,id:"eclipse.downloadSingleFile",visibleWhen:function(e){return b&&b.isCommandsVisible()&&Array.isArray(e)&&1===e.length&&!e[0].Directory?!0:!1},callback:function(e){var t=p.getService("orion.page.message"),i=new s.FileDownloader(g,t,L),n=Array.isArray(e.items)?e.items:[e.items],o=U.getFilenameContentType(n[0].Name);i.downloadFromLocation(n[0],o)}});f.addCommand(H);var G=new r.Command({name:e.Delete,imageClass:"core-sprite-delete",id:"eclipse.deleteFile",visibleWhen:F,callback:function(t){var n=Array.isArray(t.items)?t.items:[t.items],o=1===n.length?n[0].Name:"";m.isBidiEnabled&&(o=m.enforceTextDirWithUcc(o));var r=1===n.length?i.formatMessage(e.DeleteTrg,o):i.formatMessage(e["delete item msg"],n.length);p.getService("orion.page.dialog").confirm(r,function(t){if(t){var o=[],r=n.map(function(t){var r=t.Location;return d.when(R(t),function(s){t=s.item;var a=s.parent;if(a&&a.Projects&&(r=null,a.Projects.some(function(e){return e.Id===t.Id?(r=e.Location,!0):!1})),"ProjectRoot"===t.type&&a.ProjectLocation&&(r=a.ProjectLocation),!r)return(new d).resolve();var l=g.deleteFile(r);return L.showWhile(l,i.formatMessage(e["Deleting ${0}"],r)).then(function(){o.push({oldValue:t,newValue:null,parent:a}),k=k.filter(function(e){return!S.isEqualToOrChildOf(e,t)}),B({type:"delete",oldValue:t,newValue:null,parent:a,count:n.length})},_)})});d.all(r).then(function(){B({type:"deleteMultiple",items:o})},_)}})}});f.addCommand(G);var $=new r.Command({name:e.Zip,tooltip:e.ZipDL,imageClass:"core-sprite-exportzip",id:"eclipse.downloadFile",visibleWhen:function(e){return b&&b.isCommandsVisible()?(e=C(e),e.ExportLocation&&e.Directory):!1},hrefCallback:function(e){return C(e.items).ExportLocation}});f.addCommand($);var K=function(e){var t=I(e);return t&&t.Location||(t=b.treeRoot,t.Project&&(t=t.children[0])),t},Y=new r.Command({name:e["New File"],tooltip:e["Create a new file"],imageClass:"core-sprite-new_file",id:"eclipse.newFile",callback:function(t){var i=K(t.items);O(e["New File"],i,!1)},visibleWhen:D});f.addCommand(Y);var q=new r.Command({name:e["New Folder"],tooltip:e["Create a new folder"],imageClass:"core-sprite-new_folder",id:"eclipse.newFolder",callback:function(t){var i=K(t.items);O(e["New Folder"],i,!0)},visibleWhen:function(e){return D(e)&&!o.isAtRoot(e.Location)}});f.addCommand(q);var J=new a.ParametersDescription([new a.CommandParameter("url","url",e["File URL:"],"URL"),new a.CommandParameter("unzip","boolean",e["Unzip *.zip files:"],!0)]),X=new r.Command({name:e["Import from HTTP..."],tooltip:e.ImportURL,id:"orion.importZipURL",parameters:J,callback:function(t){var n=I(t.items),o=t.parameters&&t.parameters.valueFor("url");if(n&&o){var r=n.ImportLocation+(-1===n.ImportLocation.indexOf("?")?"?":"&")+"source="+o,s=t.parameters&&t.parameters.valueFor("unzip")&&o.indexOf(".zip")===o.length-4,a=s?"":"raw",l=g.remoteImport(r,{OptionHeader:a});L.showWhile(l,i.formatMessage(e["Importing from ${0}"],o)).then(function(){B({type:"import",target:n})})}},visibleWhen:D});f.addCommand(X);var Z=new r.Command({name:e["New Folder"],imageClass:"core-sprite-new_folder",tooltip:e["Create an empty folder"],description:e.CreateEmptyMsg,id:"orion.new.project",callback:function(t){var i;if(I(t.items))q.callback(t);else{i=C(t.items);var n=e["New Folder"];M(i,n,function(e){y(b,i,b.getRow(i),e,function(e){w(b,g,L,e)})})}},visibleWhen:E});f.addCommand(Z);var Q=new r.Command({name:e["Link to Server"],tooltip:e.LinkContent,description:e.CreateLinkedFolder,imageClass:"core-sprite-link",id:"orion.new.linkProject",parameters:new a.ParametersDescription([new a.CommandParameter("name","text",e["Name:"],e["New Folder"]),new a.CommandParameter("url","url",e["Server path:"],"")]),callback:function(t){var n=function(t,n){if(t&&n){var o=g.createProject(b.treeRoot.ChildrenLocation,t,n,!0);L.showWhile(o,i.formatMessage(e["Linking to ${0}"],n)).then(function(e){v({type:"create",parent:b.treeRoot,newValue:e})},_)}};t.parameters&&t.parameters.valueFor("name")&&t.parameters.valueFor("url")?n(t.parameters.valueFor("name"),t.parameters.valueFor("url")):_(e.NameLocationNotClear)},visibleWhen:E});f.addCommand(Q);var et=new r.Command({name:e["Go Up"],tooltip:e.GoUpToParent,imageClass:"core-sprite-go-up",id:"eclipse.upFolder",callback:function(){"function"==typeof b.scopeUp&&b.scopeUp()},visibleWhen:function(e){return b&&b.isCommandsVisible()?(e=b.treeRoot,e.Parents||"Project"===e.type):!1}});f.addCommand(et);var tt=new r.Command({name:e["Go Into"],tooltip:e.GoSelectedFolder,imageClass:"core-sprite-go-down",id:"eclipse.downFolder",callback:function(e){"function"==typeof b.scopeDown&&b.scopeDown(e.items[0])},visibleWhen:function(e){return b&&b.isCommandsVisible()?"function"!=typeof b.scopeDown?!1:(e=C(e),e.Directory&&e.Location!==b.treeRoot.Location):!1}});f.addCommand(tt);var it=new r.Command({name:e["File or zip archive"],tooltip:e.ImportLcFile,imageClass:"core-sprite-importzip",id:"orion.import",callback:function(e){var i=I(e.items),n=t.node("fileSelectorInput"),o=n.cloneNode(),r=b.treeRoot.ChildrenLocation===i.ChildrenLocation?!1:!0,s=function(){if(n.files&&n.files.length>0)for(var e=0;e<n.files.length;e++)b._uploadFile(i,n.files.item(e),r);n.removeEventListener("change",s)};n.addEventListener("change",s),n.click(),n.parentNode.replaceChild(o,n)},visibleWhen:D});f.addCommand(it);var nt=new r.Command({name:e["SFTP from..."],tooltip:e.CpyFrmSftp,imageClass:"core-sprite-transferin",id:"orion.importSFTP",callback:function(t){var n=I(t.items),o=new u.SFTPConnectionDialog({func:function(t,o,r,s,a,l){var c=l?"sftp,"+l:"sftp",d={OptionHeader:c,Host:t,Port:o,Path:r,UserName:s,Passphrase:a},h=g.remoteImport(n.ImportLocation,d);L.showWhile(h,i.formatMessage(e["Importing from ${0}"],t)).then(function(e){B({type:"import",target:n}),_(e)},_)}});o.show()},visibleWhen:D});f.addCommand(nt);var ot=new r.Command({name:e["SFTP to..."],tooltip:e.CpyToSftp,imageClass:"core-sprite-transferout",id:"eclipse.exportSFTPCommand",callback:function(t){var n=C(t.items),o=new u.SFTPConnectionDialog({func:function(t,o,r,s,a,l){var c=l?"sftp,"+l:"sftp",d={OptionHeader:c,Host:t,Port:o,Path:r,UserName:s,Passphrase:a},h=g.remoteExport(n.ExportLocation,d);L.showWhile(h,i.formatMessage(e.Exporting,t)).then(_,_)}});o.show()},visibleWhen:function(e){return b&&b.isCommandsVisible()?(e=C(e),e.ExportLocation&&e.Directory):!1}});f.addCommand(ot);var rt=new r.Command({name:e["Copy to"],tooltip:"Copy files and folders to a specified location",id:"eclipse.copyFile",choiceCallback:function(e,t){return A(e,t,!0)},visibleWhen:F});f.addCommand(rt);var st=new r.Command({name:e["Move to"],tooltip:e.MvToLocation,id:"eclipse.moveFile",choiceCallback:function(e,t){return A(e,t,!1)},visibleWhen:F});f.addCommand(st);var at=function(e){var t=b.getNavHandler();N&&k.forEach(function(e){t.enableItem(e)}),N=!1,k=e.items},lt=new r.Command({name:e.Cut,id:"eclipse.cut",callback:function(e){var t=b.getNavHandler();at(e),k.length&&(N=!0,k.forEach(function(e){t.disableItem(e)}))},visibleWhen:F});f.addCommand(lt);var ct=new r.Command({name:e.Copy,id:"eclipse.copySelections",callback:at,visibleWhen:F});f.addCommand(ct);var dt=function(e){return b&&b.isCommandsVisible()?D(e):!1},ht=new r.Command({name:e.Paste,id:"eclipse.pasteSelections",visibleWhen:dt,callback:function(t){var n=I(t.items);if(k.length>0&&n){if(o.isAtRoot(n.Location))return void _(e["Cannot paste into the root"]);var r=N?g.moveFile:g.copyFile,s=[],a=[];k.forEach(function(t){var o=t.Location,l=t.Name||null;if(o){var c=n.Location||n.ContentLocation,d=!1;if(t.parent&&t.parent.Location===c)d=!0;else{var h=n.Children||n.children;h&&(d=h.some(function(e){return e.Name===t.Name}))}if(d&&(l=window.prompt(i.formatMessage(e.EnterName,t.Name),i.formatMessage(e["Copy of ${0}"],t.Name)),l||(o=null)),o){var u=r.apply(g,[o,c,l]),p=N?"Moving ${0}":"Pasting ${0}",f=N?"move":"copy";a.push(L.showWhile(u,i.formatMessage(e[p],o)).then(function(e){s.push({oldValue:t,newValue:e,parent:n}),B({type:f,oldValue:t,newValue:e,parent:n,count:k.length})},_))}}}),d.all(a).then(function(){if(B({type:N?"moveMultiple":"copyMultiple",items:s}),N){var e=b.getNavHandler();k.forEach(function(t){e.enableItem(t)}),k=[],N=!1}})}}});return f.addCommand(ht),(new d).resolve()},S.createNewContentCommand=function(t,i,n,s,l,c,d){var h=n?[]:[new a.CommandParameter("folderName","text",e["Folder name:"],i),new a.CommandParameter("url","url",e["Extracted from:"],s),new a.CommandParameter("unzip","boolean",e["Unzip *.zip files:"],!0)],u=null;h.length>0&&(u=new a.ParametersDescription(h));var p=new r.Command({name:i,parameters:u,id:t,callback:function(e){if(n)window.open(n);else if(e.parameters&&e.parameters.valueFor("folderName")){var t=e.parameters.valueFor("folderName");w(l,c,d,t,function(t){e.parameters.clientCollect=!0,e.commandRegistry.runCommand("orion.importZipURL",t,l,e.parameters)})}else y(l,e.items,e.domNode.id,i,function(t){w(l,c,d,t,function(t){e.commandRegistry.runCommand("orion.importZipURL",t,l,e.parameters)})})},visibleWhen:function(e){return l&&l.isCommandsVisible()?(e=C(e),e.Location&&o.isAtRoot(e.Location)):!1}});return p},S}),define("orion/jazzui/jazzHubProjectService",["require","orion/Deferred","orion/jazzui/jazzClient","orion/jazzui/widgets/SelectProjectAreaDialog","orion/git/gitConfigPreference","orion/git/gitClient","orion/ssh/sshTools","text!jconfig/jazzhuburl","orion/fileCommands"],function(e,t,i,n,o,r,s,a,l){function c(e){return e.indexOf("@")>0&&e.indexOf("ssh://")>=0?e.substring(0,e.indexOf("ssh://")+6)+e.substring(e.indexOf("@")+1):e}function d(t,i,o){function r(i){if(!i||0===i.length){var r=[];return r.Severity="Error",r.HTML=!0,r.Message='You are not logged in to any repository. Use the <a href="'+e.toUrl("jazzui/projects.html")+'">All Jazz SCM Repositories</a> page to add a repository.',void t.setProgressResult(r)}var a=new n.SelectProjectAreaDialog({title:"Select Project to Add",jazzClient:s.jazzClient,canCreate:!0,serviceRegistry:s._serviceRegistry,commandRegistry:s._commandRegistry,projectAreas:i,func:o});a.show()}var s=this;if(a){var l=[{Type:"Repository",JazzUrl:a}];r(l)}else t.showWhile(this.jazzClient.getRepositories(),"Getting repositories list").then(function(e){var t=e.Children;r(t)})}function h(e,t){if(e){this._serviceRegistry=e,this._commandRegistry=t,this._serviceRegistration=e.registerService("orion.project.handler",this,{id:"orion.jazzhub.projecthandler",type:"jazz",addDependencyName:"JazzHub Project",addDependencyTooltip:"Associate a JazzHub project with this project.",addProjectName:"JazzHub",addProjectTooltip:"Create a project in JazzHub.",actionComment:"Your project is being set up, this might take a minute",validationProperties:[{source:"JazzHub"}]});{new r.GitService(e),new s.SshService(e)}}this.jazzClient=e.getService("orion.jazz.service"),this.jazzClient||(this.jazzClient=new i.JazzService(e))}return h.prototype={paramsToDependencyDescription:function(){return{}},getDependencyDescription:function(e){var i=new t;if(e.Jazz)this.jazzClient.getProject(e.Jazz.ProjectLocation).then(function(e){i.resolve({Type:"jazz",Location:e.uuid+" @@ "+e.projectName+" @@ "+e.repositoryUrl,Name:e.projectName})},i.reject,i.progress);else{if(!e.JazzHub||!e.Git)return null;this._serviceRegistry.getService("orion.git.provider").getGitClone(e.Git.CloneLocation).then(function(t){t.Children&&(t=t.Children[0]),t.GitUrl&&(e.JazzHub.repositoryUrl?i.resolve({Type:"jazz",Location:"Git @@ "+e.JazzHub.Project+" @@ "+e.JazzHub.repositoryUrl+" @@ "+c(t.GitUrl),Name:e.JazzHub.Project}):e.JazzHub.ProjectLocation&&this.jazzClient.getProject(e.JazzHub.ProjectLocation).then(function(n){i.resolve({Type:"jazz",Location:"Git @@ "+n.JazzHub.Project+" @@ "+n.JazzHub.repositoryUrl+" @@ "+c(t.GitUrl),Name:e.JazzHub.Project})},i.reject,i.progress))}.bind(this),i.reject,i.progress)}return i},_cloneProject:function(t,i,n,r){var s=this,a=s._serviceRegistry.getService("orion.git.provider"),l=s._serviceRegistry.getService("orion.page.progress"),d=s._serviceRegistry.getService("orion.core.file"),h=function(h,u,p){e(["orion/git/gitCommands"],function(e){e.getDefaultSshOptions(s._serviceRegistry,{GitUrl:h}).then(function(f){var g=arguments.callee,m=new o(s._serviceRegistry);s._serviceRegistry.getService("orion.page.message").setProgressMessage("Your project is being set up. This might take a minute..."),m.getConfig().then(function(o){l.progress(a.cloneGitRepository(p,h,u,n.WorkspaceLocation,f.gitSshUsername,f.gitSshPassword,f.knownHosts,f.gitPrivateKey,f.gitPassphrase,o,!0),"Cloning repository "+p).then(function(n){e.handleProgressServiceResponse(n,f,s._serviceRegistry,function(e){a.getGitClone(e.Location).then(function(e){var n="name="+i.Name+"\njazzhub.url="+i.Url+"\n";
d.write(e.Children[0].ContentLocation+".git/.projectInfo",n).then(function(){t.resolve(r?{ContentLocation:e.Children[0].ContentLocation}:{Type:"jazz",Location:"Git @@ "+i.Name+" @@ "+i.Url+" @@ "+c(i.GitUrl),Name:i.Name})},t.reject)})},g,"Clone Git Repository")},function(t){e.handleProgressServiceResponse(t,f,s._serviceRegistry,function(){},g,"Clone Git Repository")})})})})};s._serviceRegistry.getService("orion.page.message").setProgressMessage("Looking for project "+i.Name),d.loadWorkspace(n.WorkspaceLocation).then(function(e){for(var n=0;n<e.Children.length;++n){var o=e.Children[n];if(o.Name===i.Name)return void(o.Git?a.getGitClone(o.Git.CloneLocation).then(function(e){c(e.Children[0].GitUrl)===c(i.GitUrl)?t.resolve(r?{ContentLocation:e.Children[0].ContentLocation}:{Type:"jazz",Location:"Git @@ "+i.Name+" @@ "+i.Url+" @@ "+c(i.GitUrl),Name:i.Name}):t.reject("Folder "+i.Name+" is used")}):t.reject("Folder "+i.Name+" is used"))}h(i.GitUrl,null,i.Name)})},_initJazzProject:function(e){var i=this._serviceRegistry.getService("orion.page.progress"),n=this,o=new t;return i.showWhile(n.jazzClient.findProject(e.Name),"Initializing Jazz project...").then(function(t){function r(){var t=[];t.Severity="Warning",t.HTML=!1,t.Message="Project "+e.Name+" already exists in your workspace.",o.reject(t)}return t.Children&&0!==t.Children.length?void n._serviceRegistry.getService("orion.project.client").initProject(t.Children[0].ContentLocation).then(r,r):void i.showWhile(n.jazzClient.initBasicProject(e.Url,e.Name,e.ItemId,e.UserId,!0),"Your project is being set up. This might take a minute...").then(function(e){o.resolve(e.project?e.project:e)},o.reject,o.progress)},o.reject,o.progress),o},initProject:function(e,i){var n=this._serviceRegistry.getService("orion.page.progress"),o=(this._serviceRegistry.getService("orion.project.client"),this),r=new t;return d.call(this,n,r,function(e){return e.GitUrl&&""!==e.GitUrl?void this._cloneProject.call(o,r,e,i,!0):void this._initJazzProject(e,i).then(r.resolve,r.reject)}.bind(this)),r},initDependency:function(i,n,o){var r=this._serviceRegistry.getService("orion.page.progress"),s=this,a=new t;if(i&&i.Location){var l=i.Location.split(" @@ ");if("Git"==l[0]){var c={Name:l[1],Url:l[2],GitUrl:l[3]};return this._cloneProject.call(s,a,c,o,!1),a}var h=l[0],u=l[1],p=l[2];r.progress(s.jazzClient.getRepositories(),"Listing repositories").then(function(t){if(t&&t.Children&&t.Children.length>0)for(var i=0;i<t.Children.length;i++)if(t.Children[i].Url===p)return r.showWhile(s.jazzClient.initBasicProject(p,u,h,t.Children[i].UserId,!0),"Your project is being set up. This might take a minute...").then(function(e){a.resolve(e.project?{Type:"jazz",Location:e.project.uuid+" @@ "+e.project.projectName+" @@ "+e.project.repositoryUrl,Name:e.project.projectName}:{Type:"jazz",Location:e.uuid+" @@ "+e.projectName+" @@ "+e.repositoryUrl,Name:e.projectName})},a.reject,a.progress),a;var n=[];return n.Severity="Error",n.HTML=!0,n.Message="You are not logged in to "+p+'. Use the <a href="'+e.toUrl("jazzui/projects.html")+'">All Jazz SCM Repositories</a> page to add the repository.',a.reject(n),a},a.reject,a.progress)}else d.call(this,r,a,function(e){return e.GitUrl&&""!==e.GitUrl?void s._cloneProject.call(s,a,e,o,!1):void r.showWhile(s.jazzClient.findProject(e.Name),"Initializing Jazz project...").then(function(t){if(t.Children&&0!==t.Children.length){var i=t.Children[0];a.resolve({Type:"jazz",Location:i.uuid+" @@ "+i.projectName+" @@ "+i.repositoryUrl,Name:i.projectName})}else r.showWhile(s.jazzClient.initBasicProject(e.Url,e.Name,e.ItemId,e.UserId,!0),"Your project is being set up. This might take a minute...").then(function(e){a.resolve(e.project?{Type:"jazz",Location:e.project.uuid+" @@ "+e.project.projectName+" @@ "+e.project.repositoryUrl,Name:e.project.projectName}:{Type:"jazz",Location:e.uuid+" @@ "+e.projectName+" @@ "+e.repositoryUrl,Name:e.projectName})},a.reject,a.progress)},a.reject,a.progress)});return a},getAdditionalProjectProperties:function(e){if(!e.JazzHub)return null;var i=this._serviceRegistry.getService("orion.page.progress");if(e.JazzHub.deleted){i.setProgressResult({id:"projectDeleted",Severity:"Warning",Message:'This project has been deleted by the owner, would you like to delete this project from you workspace? <a id="delete'+e.JazzHub.Project+'Yes">Yes</a>  <a id="delete'+e.JazzHub.Project+'No">No</a> ',HTML:!0});var n=document.getElementById("delete"+e.JazzHub.Project+"Yes");n&&(n.onclick=function(){if(window.confirm("Are you sure you want to remove "+e.Name)){var t=this._serviceRegistry.getService("orion.core.file");t.loadWorkspace().then(function(n){var o=e.Location;n&&n.Projects&&(o=null,n.Projects.some(function(t){return t.Id===e.Name?(o=t.Location,!0):!1})),t.deleteFile(o).then(function(){l.getModelEventDispatcher().dispatchEvent({type:"delete",oldValue:e})},i.setProgressResult)}.bind(this),i.setProgressResult)}}.bind(this))}var o=document.getElementById("delete"+e.JazzHub.Project+"No");if(o&&(o.onclick=function(){this.jazzClient.updateProject(e.JazzHub.ProjectLocation,{JazzHub:{deleted:""}}).then(function(){this._serviceRegistry.getService("orion.page.message").setProgressMessage("")}.bind(this))}.bind(this)),e.JazzHub.oldName){i.setProgressResult({id:"projectRenamed",Severity:"Warning",Message:"This project has been renamed by the owner from <b>"+e.JazzHub.oldName+'</b>. If you wish to continue work under the old name please use the Fork option. <a id="'+e.JazzHub.oldName+"_CloseRename\">Don't show this again</a>",HTML:!0});var r=document.getElementById(e.JazzHub.oldName+"_CloseRename");r&&(r.onclick=function(){this.jazzClient.updateProject(e.JazzHub.ProjectLocation,{JazzHub:{oldName:""}}).then(function(){this._serviceRegistry.getService("orion.page.message").setProgressMessage("")}.bind(this))}.bind(this))}var s=new t;return e.Jazz?(this.jazzClient.getProject(e.Jazz.ProjectLocation).then(function(e){s.resolve([{Name:"Jazz SCM",Children:[{Name:"Project",Value:e.projectName},{Name:"Jazz SCM Changes",Value:"Jazz Changes",Href:"{+OrionHome}/jazzui/changes.html#"+e.ChangesLocation}]}])},s.reject,s.progress),s):(s.resolve([]),s)}},{JazzHubProjectService:h}}),define("orion/jazzui/pageUtil",["require","orion/webui/littlelib","orion/jazzui/checkinCommands","orion/jazzui/jazzHubProjectService"],function(e,t,i,n){function o(e,o){var r=t.node("pageToolbar");if(r&&(new n.JazzHubProjectService(e,o),i.createCheckinCommands(e,"toolsActions",o),o)){var s=o.findCommand("orion.sidebar.viewmode");if(s&&s.getChoices){var a=s.getChoices();a.length>0&&a[0].callback()}}}return{addPageLinks:o}}),define("text!orion/webui/dialogs/promptdialog.html",[],function(){return'<div>\r\n	<div class="promptDialogMessage" id="promptDialogMessage">${PromptMessage}</div>\r\n	<input type="text" id="promptDialogInput" class="promptDialogInput" />\r\n</div>'}),define("orion/webui/dialogs/PromptDialog",["i18n!orion/widgets/nls/messages","orion/webui/littlelib","orion/webui/dialog","text!orion/webui/dialogs/promptdialog.html","orion/EventTarget"],function(e,t,i,n,o){function r(e){o.attach(this),this._init(e)}return r.prototype=Object.create(i.Dialog.prototype),r.prototype.constructor=r,r.prototype.TEMPLATE=n,r.prototype._init=function(t){this.title=t.title,t.promptMessage&&(this.messages={PromptMessage:t.promptMessage}),this.modal=!0,this._boundOkPressed=this._okPressed.bind(this),this.buttons=[{id:"okButton",text:e.OK,callback:this._boundOkPressed},{id:"cancelButton",text:e.Cancel,callback:this._cancelPressed.bind(this)}],this._initialize(),t.promptMessage||(this.$promptDialogMessage.style.display="none")},r.prototype._bindToDom=function(){this.$promptDialogInput.addEventListener("keydown",function(e){e.keyCode===t.KEY.ENTER?(this._boundOkPressed(),t.stop(e)):e.keyCode===t.KEY.ESCAPE&&(this.$cancelButton.focus(),t.stop(e))}.bind(this),!1)},r.prototype._okPressed=function(){this.dispatchEvent({type:"ok",value:this.$promptDialogInput.value}),this.hide()},r.prototype._cancelPressed=function(){this.dispatchEvent({type:"cancel"}),this.hide()},{PromptDialog:r}}),define("orion/widgets/projects/ProjectOptionalParametersDialog",["i18n!orion/widgets/nls/messages","orion/webui/littlelib","orion/webui/dialog"],function(e,t,i){function n(e){this._init(e)}return n.prototype=new i.Dialog,n.prototype.TEMPLATE='<div id="message" style="width: 25em; padding-bottom: 5px;"></div><div id="paramsArea"><table id="paramsTable"></table></div>',n.prototype._init=function(t){this.title=t.title,this._data=t.data,this._idPrefix="ParamInput_",this.modal=!0,this.buttons=[{text:e.OK,isDefault:!0,callback:this.done.bind(this)}],this.customFocus=!0,this._func=t.func,this._initialize()},n.prototype._bindToDom=function(){this._message?this.$message.appendChild(document.createTextNode(this._message)):this.$message.style.display="none";var e=!0;if(this._data.parameters)for(var t in this._data.parameters.parameterTable){var i=this._data.parameters.parameterNamed(t),n=document.createElement("tr"),o=document.createElement("td"),r=document.createElement("label");r["for"]=t,r.appendChild(document.createTextNode(i.label)),o.appendChild(r),n.appendChild(o),o=document.createElement("td");var s;"textarea"===i.type?s=document.createElement("textarea"):(s=document.createElement("input"),s.type=i.type),s.value=this._data.parameters.valueFor(t),s.id=this._idPrefix+t,o.appendChild(s),n.appendChild(o),this.$paramsTable.appendChild(n),e&&(s.focus(),e=!1)}if(this._data.parameters._options.optionalParams)for(var a=0;a<this._data.parameters._options.optionalParams.length;a++){var i=this._data.parameters._options.optionalParams[a],n=document.createElement("tr"),o=document.createElement("td"),r=document.createElement("label");r["for"]=this._idPrefix+i.id,r.appendChild(document.createTextNode(i.name)),o.appendChild(r),n.appendChild(o),o=document.createElement("td");var s;"textarea"===i.type?s=document.createElement("textarea"):(s=document.createElement("input"),s.type=i.type),i.value&&(s.value=i.value),s.id=this._idPrefix+i.id,o.appendChild(s),n.appendChild(o),this.$paramsTable.appendChild(n)}},n.prototype.done=function(){if(this._data.parameters)for(var e in this._data.parameters.parameterTable)this._data.parameters.setValue(e,t.node(this._idPrefix+e).value);if(this._data.parameters._options.optionalParams)for(var i=0;i<this._data.parameters._options.optionalParams.length;i++){var n=this._data.parameters._options.optionalParams[i];n.value=t.node(this._idPrefix+n.id).value}this.hide(),t.empty(this.$paramsTable),this._func()},n.prototype.constructor=n,{ProjectOptionalParametersDialog:n}}),define("orion/projectCommands",["require","i18n!orion/navigate/nls/messages","orion/webui/littlelib","orion/commands","orion/Deferred","orion/webui/dialogs/DirectoryPrompterDialog","orion/commandRegistry","orion/i18nUtil","orion/webui/dialogs/PromptDialog","orion/widgets/projects/ProjectOptionalParametersDialog","orion/fileCommands","orion/editorCommands","orion/EventTarget","orion/URITemplate","orion/PageLinks","orion/objects","orion/preferences","orion/metrics"],function(e,t,i,n,o,r,s,a,l,c,d,h,u,p,f,g,m,v){function _(e){return e?(Array.isArray(e)&&(e=1===e.length?e[0]:{}),e):{}}function y(e,t,i){if(!e)return null;for(var n=[],o=0;o<e.length;o++)e[o].hidden?i&&(i[e[o].id]=e[o].value):n.push(new s.CommandParameter(e[o].id,e[o].type,e[o].name));return new s.ParametersDescription(n,t)}function C(e,t,i){if(t.parameters&&t.parameters.optionsRequested){var n=new c.ProjectOptionalParametersDialog({title:i,data:t,func:function(){t.parameters.optionsRequested=!1,e(t)}.bind(this)});return void n.show()}var o,r=t.oldParams||{};if(t.parameters)for(o in t.parameters.parameterTable)r[o]=t.parameters.valueFor(o);if(t.parameters&&t.parameters._options.optionalParams)for(var s=0;s<t.parameters._options.optionalParams.length;s++)o=t.parameters._options.optionalParams[s],r[o.id]=o.value;return r}function w(e,t,i){if(!t&&e&&"undefined"!=typeof e.HTML&&delete e.HTML,e.Retry&&e.Retry.parameters){e.forceShowMessage&&E.setProgressResult(e);var n={hasOptionalParameters:!!e.Retry.optionalParameters,optionalParams:e.Retry.optionalParameters};i.data.parameters=y(e.Retry.parameters,n,i.oldParams),i.data.oldParams=i.oldParams,i.commandService.collectParameters(i.data)}else b(i.project.Name,i.deployService,i.launchConfiguration),("Error"===e.Severity||"Warning"===e.Severity)&&E.setProgressResult(e);e.ToSave&&i.projectClient.saveProjectLaunchConfiguration(i.project,e.ToSave.ConfigurationName,i.deployService.id,e.ToSave.Parameters,e.ToSave.Url,e.ToSave.ManageUrl,e.ToSave.Path,e.ToSave.Type,e.AdditionalConfiguration).then(function(e){b(i.project.Name,i.deployService,e),A&&A.dispatchEvent({type:"create",newValue:e}),e.File.parent.parent&&I.dispatchEvent({type:"create",parent:e.File.parent.parent,newValue:e.File.parent,ignoreRedirect:!0}),I.dispatchEvent({type:"create",parent:e.File.parent,newValue:e.File,ignoreRedirect:!0})},i.errorHandler)}function b(e,t,i){var n;N&&(n=i?"orion.launchConfiguration.deploy."+i.ServiceId+i.Name:"orion.project.deploy."+t.id,N[e]=n,k.put("/deploy/project",N)),A&&A.dispatchEvent({type:"changedDefault",newValue:n})}function S(e,n){function o(i){A&&n.launchConfiguration&&(n.launchConfiguration.status={State:"PROGRESS",Message:i,ShortMessage:t.deploying,Info:"Deploying"},A.dispatchEvent({type:"changeState",newValue:n.launchConfiguration})),n.projectClient.formPluginLaunchConfiguration(e).then(function(t){n.deployService.deploy(n.project,t).then(function(i){var o=Date.now()-l;if(v.logTiming("deployment","deploy",o,t.Type+(a?" (live edit on)":"")),i){if(i.UriTemplate){var r={};return r.uriTemplate=i.UriTemplate,r.width=i.Width,r.height=i.Height,r.id=i.UriTemplateId||n.deployService.id,n.oldParams=e.Params,r.done=function(e){w(e,null,n)},r.status=function(e){w(e,null,n)},void h.createDelegatedUI(r)}n.launchConfiguration&&(i.State||i.CheckState)&&(n.launchConfiguration.status=i,A&&A.dispatchEvent({type:"changeState",newValue:n.launchConfiguration})),i.ToSave?n.projectClient.saveProjectLaunchConfiguration(n.project,i.ToSave.ConfigurationName,n.deployService.id,i.ToSave.Parameters,i.ToSave.Url,i.ToSave.ManageUrl,i.ToSave.Path,i.ToSave.Type,i.AdditionalConfiguration).then(function(e){b(n.project.Name,n.deployService,e),A&&A.dispatchEvent({type:"create",newValue:e}),e.File.parent.parent&&I.dispatchEvent({type:"create",parent:e.File.parent.parent,newValue:e.File.parent,ignoreRedirect:!0}),I.dispatchEvent({type:"create",parent:e.File.parent,newValue:e.File,ignoreRedirect:!0})},n.errorHandler):b(n.project.Name,n.deployService,n.launchConfiguration)}},function(i){var o=Date.now()-l;if(v.logTiming("deployment","deploy (error)",o,t.Type+(a?" (live edit on)":"")),i.Retry&&i.Retry.parameters){i.forceShowMessage&&n.errorHandler(i),n.data.oldParams=e.Params;var r={hasOptionalParameters:!!i.Retry.optionalParameters,optionalParams:i.Retry.optionalParameters};n.data.parameters=y(i.Retry.parameters,r,n.data.oldParams),n.commandService.collectParameters(n.data)}else n.errorHandler(i),b(n.project.Name,n.deployService,n.launchConfiguration),n.launchConfiguration.status=i.State||i.CheckState?i:{error:i},A&&A.dispatchEvent({type:"changeState",newValue:n.launchConfiguration})})}.bind(this))}var r=i.$("#liveEditSwitchWrapper");if(r)var s=i.$(".orionSwitchCheck",r),a=s&&s.checked;var l=Date.now();n.deployService.getDeployProgressMessage?n.projectClient.formPluginLaunchConfiguration(e).then(function(e){n.deployService.getDeployProgressMessage(n.project,e).then(function(e){o(e)}.bind(this),function(){o(n.deployService.name+" in progress")}.bind(this))}.bind(this)):o(n.deployService.name+" in progress")}function x(e,t){t.projectClient.formPluginLaunchConfiguration(e).then(function(i){t.deployService.edit(t.project,i).then(function(i){if(i){if(i.UriTemplate){var n={};return n.uriTemplate=i.UriTemplate,n.width=i.Width,n.height=i.Height,n.id=i.UriTemplateId||t.deployService.id,t.oldParams=e.Params,n.done=function(e){w(e,null,t)},n.status=function(e){w(e,null,t)},void h.createDelegatedUI(n)}t.launchConfiguration&&(i.State||i.CheckState)&&(t.launchConfiguration.status=i,A&&A.dispatchEvent({type:"changeState",newValue:t.launchConfiguration})),i.ToSave&&t.projectClient.saveProjectLaunchConfiguration(t.project,i.ToSave.ConfigurationName,t.deployService.id,i.ToSave.Parameters,i.ToSave.Url,i.ToSave.ManageUrl,i.ToSave.Path,i.ToSave.Type,i.AdditionalConfiguration).then(function(e){b(t.project.Name,t.deployService,e),A&&A.dispatchEvent({type:"create",newValue:e}),e.File.parent.parent&&I.dispatchEvent({type:"create",parent:e.File.parent.parent,newValue:e.File.parent,ignoreRedirect:!0}),I.dispatchEvent({type:"create",parent:e.File.parent,newValue:e.File,ignoreRedirect:!0})},t.errorHandler)}},function(i){if(i.Retry&&i.Retry.parameters){i.forceShowMessage&&t.errorHandler(i),t.data.oldParams=e.Params;var n={hasOptionalParameters:!!i.Retry.optionalParameters,optionalParams:i.Retry.optionalParameters};t.data.parameters=y(i.Retry.parameters,n,t.data.oldParams),t.commandService.collectParameters(t.data)}else t.errorHandler(i),b(t.project.Name,t.deployService,t.launchConfiguration),i.State||i.CheckState?t.launchConfiguration.status=i:delete t.launchConfiguration.status,A&&A.dispatchEvent({type:"changeState",newValue:t.launchConfiguration})})}.bind(this))}function L(e,i){var n=a.formatMessage(t.confirmLaunchDelete,e.Name);i.commandService.confirm(null,n,t.OK,t.Cancel,!0,function(n){if(n){var r=[];r.push(i.projectClient.deleteProjectLaunchConfiguration(e)),E.showWhile(o.all(r),t.deletingLaunchConfiguration,!0).then(function(){I.dispatchEvent({type:"delete",oldValue:e.File,parent:e.File.parent})},i.errorHandler)}})}function T(e,i,n,o,r,s,a,l){var c;c=o.actionComment?l?o.actionComment.replace(/\$\{([^\}]+)\}/g,function(e,t){return l[t]}):o.actionComment:t.gettingContentFrom+o.type,E.showWhile(o.initDependency(r,l,s),c).then(function(t){e.addProjectDependency(s,t).then(function(){D&&D.dispatchEvent({type:"create",newValue:t,project:s})},n)},function(e){if(e.Retry&&e.Retry.addParameters){a.oldParams=l||{};var t={hasOptionalParameters:!!e.Retry.optionalParameters,optionalParams:e.Retry.optionalParameters};a.parameters=y(e.Retry.addParameters,t,a.oldParams),i.collectParameters(a)}n(e)})}var E,k,N,A,R={};R.getLaunchConfigurationDispatcher=function(){return A||(A=new u),A};var I=d.getModelEventDispatcher();I.addEventListener("delete",function(e){A&&(e.parent&&"launchConfigurations"===e.parent.Name?A.dispatchEvent({type:"delete",oldValue:{File:e.oldValue}}):e.oldValue&&"launchConfigurations"===e.oldValue.Name&&A.dispatchEvent({type:"deleteAll"}))}),R.getDefaultLaunchCommand=function(e){return N?N[e]:void 0};var D;R.getDependencyDispatcher=function(){return D||(D=new u),D},R.createDependencyCommands=function(e,i,o,r,s){function l(e){E?E.setProgressResult(e):window.console.log(e)}function c(e){var o=new n.Command({name:e?t.start:t.stop,tooltip:e?t.startApplication:t.stopApplication,id:e?"orion.launchConfiguration.startApp":"orion.launchConfiguration.stopApp",imageClass:e?"core-sprite-play":"core-sprite-stop",callback:function(n){var o=_(n.items);n.oldParams=o.Params;var s=arguments.callee,a=C(s,n,e?t.startApplication:t.stopApplication);if(a){var c=g.clone(o);c.Params=a;var d=Date.now();r.getProjectDeployService(o.ServiceId,o.Type).then(function(s){var h=e?t.starting:t.stopping;s&&(e?s.start:s.stop)&&(A&&(o.status={State:"PROGRESS",ShortMessage:h},A.dispatchEvent({type:"changeState",newValue:o})),(e?s.start:s.stop)(c).then(function(t){var i=Date.now()-d;v.logTiming("deployment",e?"restart":"stop",i,c.Type),o.status=t,A&&A.dispatchEvent({type:"changeState",newValue:o}),t.ToSave&&r.saveProjectLaunchConfiguration(o.project,t.ToSave.ConfigurationName,s.id,t.ToSave.Parameters,t.ToSave.Url,t.ToSave.ManageUrl,t.ToSave.Path,t.ToSave.Type,t.ToSave.AdditionalConfiguration).then(function(e){b(o.project.Name,s,e),A&&A.dispatchEvent({type:"create",newValue:e}),e.File.parent.parent&&I.dispatchEvent({type:"create",parent:e.File.parent.parent,newValue:e.File.parent,ignoreRedirect:!0}),I.dispatchEvent({type:"create",parent:e.File.parent,newValue:e.File,ignoreRedirect:!0})},l)},function(e){if(e.Retry){var o={hasOptionalParameters:!!e.Retry.optionalParameters,optionalParams:e.Retry.optionalParameters,getCancelName:function(){return t.Cancel},getSubmitName:function(){return t.Ok}};n.parameters=y(e.Retry.parameters,o,a),n.oldParams=a,i.collectParameters(n)}else l(e)}))})}},visibleWhen:function(t){var i=_(t);return i.ServiceId&&i.Name&&i.status&&(e?!0:"STARTED"===i.status.State)}});i.addCommand(o)}E=e.getService("orion.page.progress");var d=e.getService("orion.page.message"),h=new n.Command({name:t.connect,tooltip:t.fetchContent,id:"orion.project.dependency.connect",callback:function(e){var n=_(e.items),o=arguments.callee,s=C(o,e,t.fetchContentOf+n.Dependency.Name);if(s){var a=r.getProjectHandler(n.Dependency.Type);a.then?a.then(function(t){T(r,i,l,t,n.Dependency,n.Project,e,s)}):T(r,i,l,a,n.Dependency,n.Project,e,s)}},visibleWhen:function(e){if(!(e.Dependency&&e.Project&&e.disconnected))return!1;if(s)for(var t=0;t<s.length;t++)if(s[t]===e.Dependency.Type)return!0;return!1}});i.addCommand(h);var u=new n.Command({name:t.disconnectFromProject,tooltip:t.doNotTreatThisFolder,imageClass:"core-sprite-delete",id:"orion.project.dependency.disconnect",callback:function(e){var t=_(e.items);E.progress(r.removeProjectDependency(t.Project,t.Dependency),a.formatMessage("Removing ${0} from project ${1}",t.Dependency.Name,t.Project.Name)).then(function(){D&&D.dispatchEvent({type:"delete",oldValue:t.Dependency,project:t.Project})})},visibleWhen:function(e){return e.Dependency&&e.Project?!0:!1}});i.addCommand(u);var m=new n.Command({name:t.checkStatus,tooltip:t.checkApplicationStatus,id:"orion.launchConfiguration.checkStatus",callback:function(e){var n=_(e.items),o=a.formatMessage(t.missingCredentials,n.Type,n.Url),s={getCancelName:function(){return t.Cancel},getSubmitName:function(){return t.Ok}};if(d.close(),!e.parameters){d.setProgressResult({Message:o,Severity:"Info"});var c=g.mixin({},s,{hasOptionalParameters:!!n.optionalParameters,optionalParams:n.optionalParameters});return e.parameters=y(n.parametersRequested,c,n.Params),e.oldParams=n.Params,void i.collectParameters(e)}var h=arguments.callee,u=C(h,e,t.checkApplicationState);if(u){var p=g.clone(n);p.Params=u,r.getProjectDeployService(n.ServiceId,n.Type).then(function(r){A&&(n.status={State:"PROGRESS",ShortMessage:t.checkingStateShortMessage},A.dispatchEvent({type:"changeState",newValue:n})),r&&r.getState&&r.getState(p).then(function(e){n.status=e,A&&A.dispatchEvent({type:"changeState",newValue:n}),n.project&&n.project.children&&n.project.children.forEach(function(e){n.ServiceId&&n.Name&&n.parametersRequested&&e.ServiceId===n.ServiceId&&e.Name!==n.Name&&A&&(e.status={CheckState:!0},A.dispatchEvent({type:"changeState",newValue:e}))})},function(t){if(t.Retry){var r=g.mixin({},s,{hasOptionalParameters:!!t.Retry.optionalParameters,optionalParams:t.Retry.optionalParameters});d.setProgressResult({Message:t.Message||o,Severity:t.Severity||"Error"}),e.parameters=y(t.Retry.parameters,r,u),e.oldParams=u,i.collectParameters(e)}else l(t),n.status={error:t},A&&A.dispatchEvent({type:"changeState",newValue:n})})})}},visibleWhen:function(e){var t=_(e);return t.ServiceId&&t.Name&&t.parametersRequested}});i.addCommand(m),c(!0),c(!1);var w=new n.Command({name:t.manage,tooltip:t.manageThisApplicationOnRemote,id:"orion.launchConfiguration.manage",hrefCallback:function(e){var t=_(e.items);if(t.ManageUrl){var i=new p(t.ManageUrl),n=g.clone(t.Params);n.OrionHome=f.getOrionHome();var o=i.expand(n);return o.indexOf("://")||(o="http://"+o),o}},visibleWhen:function(e){var t=_(e);return t.ManageUrl}});i.addCommand(w);var k=new n.Command({name:t.deploy,tooltip:t.deployThisApplication,id:"orion.launchConfiguration.deploy",imageClass:"core-sprite-deploy",callback:function(e){var n=_(e.items);e.oldParams||(e.oldParams=n.Params);var s=arguments.callee,a=C(s,e,t.deploy+n.Name);if(a){var c=g.clone(n);c.Params=a,r.getProjectDeployService(n.ServiceId,n.Type).then(function(t){t&&t.deploy&&o.loadWorkspace(n.project.ContentLocation).then(function(){S(c,{project:n.project,deployService:t,data:e,errorHandler:l,projectClient:r,commandService:i,launchConfiguration:n})})})}},visibleWhen:function(e){var t=_(e);return t.ServiceId&&t.Name}});i.addCommand(k);var N=new n.Command({name:t.deleteLaunchConfiguration,tooltip:t.deleteLaunchConfiguration,id:"orion.launchConfiguration.delete",imageClass:"core-sprite-trashcan",callback:function(e){var t=_(e.items);o.loadWorkspace(t.project.ContentLocation).then(function(){r.getProjectDeployService(t.ServiceId,t.Type).then(function(e){e&&L(t,{project:t.project,deployService:e,errorHandler:l,projectClient:r,commandService:i})})})},visibleWhen:function(e){var t=_(e);return t.ServiceId&&t.Name&&t.Params}});i.addCommand(N);var R=new n.Command({name:t.editLaunchConfiguration,tooltip:t.editLaunchConfiguration,id:"orion.launchConfiguration.edit",imageClass:"core-sprite-edit",callback:function(e){var n=_(e.items);e.oldParams||(e.oldParams=n.Params);var s=arguments.callee,a=C(s,e,t.deploy+n.Name);if(a){var c=g.clone(n);c.Params=a,r.getProjectDeployService(n.ServiceId,n.Type).then(function(t){t&&t.deploy&&o.loadWorkspace(n.project.ContentLocation).then(function(){x(c,{project:n.project,deployService:t,data:e,errorHandler:l,projectClient:r,commandService:i,launchConfiguration:n})})})}},visibleWhen:function(e){var t=_(e);return t.ServiceId&&t.Name}});i.addCommand(R)},R.getAddDependencyCommands=function(e){var t=[];for(var i in e._commandList){var n=e._commandList[i];n.isAddDependency&&t.push(n)}return t},R.getCreateProjectCommands=function(e){var t=[];for(var i in e._commandList){var n=e._commandList[i];n.isCreateProject&&t.push(n)}return t},R.getDeployProjectCommands=function(e){var t=[];for(var i in e._commandList){var n=e._commandList[i];n.isDeployProject&&t.push(n)}return t},R.getLaunchProjectCommands=function(e){var t=[];for(var i in e._commandList){var n=e._commandList[i];n.isLaunchProject&&t.push(n)}return t};var P;return R.setExplorer=function(e){P=e},R.getExplorer=function(){return P},R.createProjectCommands=function(e,c,h,u,p,f){function g(e){E?E.setProgressResult(e):window.console.log(e)}function m(e,t){var i=d.getModelEventDispatcher();t.ContentLocation?h.read(t.ContentLocation,!0).then(function(t){i.dispatchEvent({type:"create",parent:e,newValue:t})},function(){i.dispatchEvent({type:"create",parent:e,newValue:null})}):i.dispatchEvent({type:"create",parent:e,newValue:null})}function v(e){return u.getProjectHandler(e).then(function(t){if(t.initDependency){var i={name:t.addDependencyName,id:"orion.project.adddependency."+e,tooltip:t.addDependencyTooltip,callback:function(e){var i=_(e.items).Project,n=arguments.callee,r=C(n,e,t.addDependencyTooltip);if(r){var s=new o;t.paramsToDependencyDescription(r).then(function(e){e&&e.Location?h.loadWorkspace(i.WorkspaceLocation).then(function(i){for(var n=[],r=!1,a=0;a<i.Children.length&&r!==!0;a++){var l=t.getDependencyDescription(i.Children[a]);n.push(l),function(t){t.then(function(t){t&&t.Location===e.Location&&(r=!0,s.resolve(t))})}(l)}o.all(n).then(function(){r||s.resolve()})},s.reject):s.resolve()},g),E.showWhile(s,"Searching your workspace for matching content").then(function(n){n?u.addProjectDependency(i,n).then(function(){D&&D.dispatchEvent({type:"create",newValue:n,project:i})},g):T(u,c,g,t,{},i,e,r)})}},visibleWhen:function(e){return P&&P.isCommandsVisible()?"Project"===e.type||"Project"===P.treeRoot.type:!1}},r={hasOptionalParameters:!!t.optionalParameters,optionalParams:t.optionalParameters};i.parameters=y(t.addParameters,r);var s=new n.Command(i);s.isAddDependency=!0,c.addCommand(s)}})}function w(e){return u.getProjectHandler(e).then(function(i){if(i.initProject){var o={name:i.addProjectName,id:"orion.project.createproject."+e,tooltip:i.addProjectTooltip,callback:function(e){var n=arguments.callee,o=_(e.items),r=C(n,e,i.addProjectTooltip);if(r){var s;s=i.actionComment?r?i.actionComment.replace(/\$\{([^\}]+)\}/g,function(e,t){return r[t]}):i.actionComment:t.gettingContentFrom+i.type,E.showWhile(i.initProject(r,{WorkspaceLocation:o.Location}),s).then(function(e){m(o,e)},function(t){if(t.Retry&&t.Retry.addParameters){var i={hasOptionalParameters:!!t.Retry.optionalParameters,optionalParams:t.Retry.optionalParameters};e.parameters=y(t.Retry.addParameters,i,r),e.oldParams=r,c.collectParameters(e)}g(t)})}},visibleWhen:function(e){return P&&P.isCommandsVisible()?(e=_(e),e.Location):!1}},r={hasOptionalParameters:!!i.optionalParameters,optionalParams:i.optionalParameters};o.parameters=y(i.addParameters,r);var s=new n.Command(o);s.isCreateProject=!0,c.addCommand(s)}})}function b(e){var t,i={name:e.name,tootlip:e.tooltip,id:"orion.project.deploy."+e.id,callback:function(t){var i=t.items,n=arguments.callee,o=C(n,t,e.tooltip);o&&S({Params:o,Path:""},{project:i,deployService:e,data:t,errorHandler:g,projectClient:u,commandService:c})},visibleWhen:function(i){return void 0==t.showCommand||t.showCommand?u.matchesDeployService(i,e):!1}},o={hasOptionalParameters:!!e.optionalParameters,optionalParams:e.optionalParameters};i.parameters=y(e.parameters,o),t=new n.Command(i),t.isDeployProject=!0,c.addCommand(t)}N||(k=e.getService("orion.core.preference"),k.get("/deploy/project").then(function(e){N=e})),E=e.getService("orion.page.progress"),p=p||[];var x=new n.Command({name:t.associatedFolder,tooltip:t.associateAFolderFromThe,id:"orion.project.addFolder",callback:function(i){var n=_(i.items).Project,s=new r.DirectoryPrompterDialog({title:t["Choose a Folder"],serviceRegistry:e,fileClient:h,func:function(e){h.read(e.Location,!0).then(function(e){function t(){var t="",i=e.Name;if(e.Parents&&e.Parents.length>0){for(var o=e.Parents.length-1;o>=0;o--)t+=e.Parents[o].Name,t+="/";i+=" ("+e.Parents[e.Parents.length-1].Name+")"}t+=e.Name;var r={Name:i,Type:"file",Location:t};u.addProjectDependency(n,{Name:i,Type:"file",Location:t}).then(function(){D&&D.dispatchEvent({type:"create",newValue:r,project:n})},g)}if(!e.Parents||0===e.Parents.length){for(var i=[],r=!1,s=0;s<p.length;s++){if(r)return;var a=u.getProjectHandler(p[s]).then(function(t){return t.getDependencyDescription(e)});i.push(a),a.then(function(e){e&&(r=!0,u.addProjectDependency(n,e).then(function(){D&&D.dispatchEvent({type:"create",newValue:e,project:n})},g))})}return void o.all(i).then(function(){r||t()})}t()},g)}});s.show()},visibleWhen:function(e){return P&&P.isCommandsVisible()?"Project"===e.type||"Project"===P.treeRoot.type:!1}});x.isAddDependency=!0,c.addCommand(x);for(var L=[],A=0;A<p.length;A++){var I=p[A];L.push(v(I)),L.push(w(I))}var M="README.md",O=new n.Command({name:t.readMeCommandName,tooltip:t.readMeCommandTooltip,id:"orion.project.create.readme",callback:function(e){var t=_(e.items);E.progress(h.createFile(t.Project.ContentLocation,M),a.formatMessage("Creating ${0}",M)).then(function(e){function i(){var i=d.getModelEventDispatcher();i.dispatchEvent({type:"create",parent:t.Project.fileMetadata,newValue:e})}t.Project?E.progress(h.write(e.Location,"# "+t.Project.Name),"Writing sample readme").then(function(){i()}):i()},g)},visibleWhen:function(e){if(!P||!P.isCommandsVisible())return!1;if(e=_(e),!(e.Project&&e.Project.fileMetadata&&e.Project.fileMetadata.children&&e.Project.ContentLocation))return!1;var t=e.Project.fileMetadata.children,i=t.some(function(e){return e.Name&&e.Name.toLowerCase()===M.toLowerCase()?!0:!1});return!i}});c.addCommand(O);var B=new n.Command({name:t.basic,tooltip:t["createAnEmptyProject."],id:"orion.project.create.basic",parameters:new s.ParametersDescription([new s.CommandParameter("name","text",t["Name:"])]),callback:function(e){var i=e.parameters.valueFor("name");if(i){var n=_(e.items);h.loadWorkspace(h.fileServiceRootURL(n.Location)).then(function(e){E.progress(u.createProject(e.ChildrenLocation,{Name:i}),a.formatMessage(t["Creating project ${0}"],i)).then(function(t){m(e,t)
},g)})}},visibleWhen:function(e){return P&&P.isCommandsVisible()?(e=_(e),!!e.Location):!1}});B.isCreateProject=!0,c.addCommand(B);var F=new n.Command({name:t.zipArchiveCommandName,tooltip:t.zipArchiveCommandTooltip,id:"orion.project.create.fromfile",callback:function(e){var n=_(e.items),o=i.node("fileSelectorInput"),r=o.cloneNode(),s=new l.PromptDialog({title:t["Create new project"],promptMessage:t["Enter project name:"]}),c=function(e){var i=e.value,r=function(e){if(i==e.item.Name&&o.files&&o.files.length>0){for(var t=0;t<o.files.length;t++)P._uploadFile(e.item,o.files.item(t),!1);P.sidebarNavInputManager.removeEventListener("projectOpened",r)}};h.loadWorkspace(h.fileServiceRootURL(n.Location)).then(function(e){E.progress(u.createProject(e.ChildrenLocation,{Name:i}),a.formatMessage(t["Creating project ${0}"],i)).then(function(t){P.sidebarNavInputManager.addEventListener("projectOpened",r),m(e,t)},function(e){var i=JSON.parse(e.response),n=new l.PromptDialog({title:i.Message,promptMessage:t["Enter project name:"]});n.addEventListener("ok",c),n.show()})})};s.addEventListener("ok",c);var d=function(){if(o.files&&o.files.length>0){for(var e=[],i=["application/octet-stream","multipart/x-zip","application/zip","application/zip-compressed","application/x-zip-compressed"],n=0;n<o.files.length;n++)-1==i.indexOf(o.files[n].type)&&e.push('"'+o.files[n].name+'"');var r;e.length>5?r=t.notZipMultiple:e.length>0&&(r=a.formatMessage(t.notZip,e.join(", "))),(0==e.length||window.confirm(r))&&s.show()}o.removeEventListener("change",d)};o.addEventListener("change",d),o.click(),o.parentNode.replaceChild(r,o)},visibleWhen:function(e){return P&&P.isCommandsVisible()?(e=_(e),!!e.Location):!1}});F.isCreateProject=!0,c.addCommand(F);var j=new n.Command({name:t.sFTP,tooltip:t.createAProjectFromAn,id:"orion.project.create.sftp",parameters:new s.ParametersDescription([new s.CommandParameter("name","text",t["Name:"]),new s.CommandParameter("url","url",t["Url:"])]),callback:function(e){var i=e.parameters.valueFor("name");if(i){var n=e.parameters.valueFor("url");if(n){var o=_(e.items);h.loadWorkspace(h.fileServiceRootURL(o.Location)).then(function(e){E.progress(u.createProject(e.ChildrenLocation,{Name:i,ContentLocation:n}),a.formatMessage(t["Creating project ${0}"],i)).then(function(t){m(e,t)})})}}},visibleWhen:function(e){return P&&P.isCommandsVisible()?(e=_(e),!!e.Location):!1}});if(j.isCreateProject=!0,c.addCommand(j),R.createDependencyCommands(e,c,h,u,p),f)for(var V=0;V<f.length;V++){var U=f[V],W=new o;L.push(W),function(e){u.getProjectDeployService(U).then(function(t){b(t),e.resolve()})}(W)}return o.all(L)},R}),define("git/nls/gitmessages",{root:!0,de:!0,es:!0,fr:!0,it:!0,ja:!0,ko:!0,"pt-br":!0,zh:!0,"zh-hk":!0,"zh-tw":!0}),define("git/nls/root/gitmessages",{Compare:"Compare",GitFileSysName:"Git File System","View the side-by-side compare":"View the side-by-side compare",WorkingDirVer:"Open Working Directory","Working Directory":"Working Directory",ViewWorkingDirVer:"View the working directory version of the file","Loading...":"Loading...",Repositories:"Git",Repo:"Repositories","0 on 1 - Git":"${0} on ${1} - Git",Git:"Git","Show in eclipse.org":"Show in eclipse.org","Show in GitHub":"Show in GitHub","Show this repository in GitHub":"Show this repository in GitHub","Commit Details":"Commit Details","No Commits":"No Commits","commit: 0":"commit: ${0}","parent: 0":"parent: ${0}","authored by 0 (1) on 2":"authored by ${0} <${1}> on ${2}",committedby:"committed by ",on:" on ",nameEmail:"${0} <${1}>","Tags:":"Tags:","No Tags":"No Tags",Diffs:"Changes",WorkingDirChanges:"Working Directory Changes",CommitChanges:"Commit Changes",CommitChangesDialog:"Commit Changes",more:"more ...",less:"less ...",More:"More",MoreFiles:"More Files",MoreFilesProgress:"Loading more files...",MoreCommits:'More commits for "${0}"',MoreCommitsProgress:'Loading more commits for "${0}"...',MoreBranches:'More branches for "${0}"',MoreBranchesProgress:'Loading more branches for "${0}"...',MoreTags:"More tags",MoreTagsProgress:"Loading more tags...",MoreStashes:"More stashes",MoreStashesProgress:"Loading more stashes...","Loading git log...":"Loading git log...",local:"local",remote:"remote","View All":"View All","Error ${0}: ":"Error ${0}: ","Loading ":"Loading ",Message:"Message",Author:"Author",Date:"Date","fromDate:":"Start Date:","toDate:":"End Date:",Actions:"Actions",Branches:"Branches",Tags:"Tags",Stage:"Stage","Unstaged removal":"Unstaged removal",Unstage:"Unstage","Staged removal":"Staged removal","Unstaged change":"Unstaged change","Staged change":"Staged change","Unstaged add":"Unstaged add","Staged add":"Staged add",Addition:"Addition",Deletion:"Deletion","Resolve Conflict":"Resolve Conflict",Conflicting:"Conflicting","Commit message":"Commit message",Commit:"Commit",CommitTooltip:"Commit the selected files with the given message.",AuthMsgLink:'Authentication required for: ${0}. <a target="_blank" href="${1}">${2}</a> and re-try the request. </span>',SmartCommit:"Enter the commit message",SmartCountCommit:"Commit ${0} file(s)","Amend last commit":"Amend last commit"," Amend":" Amend","Rebase in progress. Choose action:":"Rebase in progress. Choose action:",RebaseProgress:"Rebase in progress",RebaseTip:'Rebase your commits by removing them from the active branch, starting the active branch again based on the latest state of "${0}" and applying each commit again to the updated active branch.',RebasingRepo:"Rebasing git repository",AddingConfig:"Adding git configuration property: key=${0} value=${1}",EditingConfig:"Editing git configuration property: key=${0}",DeletingConfig:"Deleting git configuration property: key=${0}",AddClone:"Cloning repository: ${0}",RebaseProgressDetails:"Rebasing branch.\n\n	Use Continue after merging the conflicts and selecting all files;\n	Skip to bypass the current patch;\n	Abort to end the rebase at any time.","Committer name:":"Committer name:","Name:":"Name:","email:":"email:","Email:":"Email:","Author name: ":"Author name: ",Unstaged:"Unstaged",Staged:"Staged",ChangedFiles:"Changed Files","Recent commits on":"Recent commits on","Git Status":"Git Status","Go to Git Status":"Open the Git Status page for the repository containing this file or folder.",GetGitIncomingMsg:"Getting git incoming changes...",Checkout:"Checkout","Checking out...":"Checking out...","Stage the change":"Stage the change","Staging...":"Staging...",CheckoutSelectedFiles:"Checkout all the selected files, discarding all changes",AddFilesToGitignore:"Add all the selected files to .gitignore file(s)","Writing .gitignore rules":"Writing .gitignore rules","Save Patch":"Save Patch","Unstage the change":"Unstage the change",EmptyUnstageWarning:"Please select at least one file to unstage","Unstaging...":"Unstaging...",Undo:"Undo",UndoTooltip:"Revert this commit, keeping all changed files and not making any changes to the working directory.",UndoConfirm:'The content of your active branch will be replaced with commit "${0}". All changes in the commit and working directory will be kept. Are you sure?',Reset:"Reset",ResetConfirm:"All unstaged and staged changes in the working directory and index will be discarded and cannot be recovered.\n\nAre you sure you want to continue?",CheckoutConfirm:"Your changes to the selected files will be discarded and cannot be recovered.\n\nAre you sure you want to continue?",ResetBranchDiscardChanges:"Reset the branch, discarding all staged and unstaged changes",ChangesIndexDiscardedMsg:"All unstaged and staged changes in the working directory and index will be discarded and cannot be recovered.",ContinueMsg:"Are you sure you want to continue?",KeepWorkDir:"Keep Working Directory","Resetting local changes...":"Resetting local changes...","Continue rebase...":"Continue rebase...","Skipping patch...":"Skipping patch...","Aborting rebase...":"Aborting rebase...","Complete log":"Complete log","local VS index":"local VS index","index VS HEAD":"index VS HEAD","Compare(${0} : ${1})":"Compare(${0} : ${1})","Loading status...":"Loading status...","Committing...":"Committing...","The author name is required.":"The author name is required.","The author mail is required.":"The author mail is required.",RepoConflict:". Repository still contains conflicts.",RepoUnmergedPathResolveConflict:". Repository contains unmerged paths. Resolve conflicts first.","Rendering ${0}":"Rendering ${0}",Configuration:"Configuration","Getting configuration of":"Getting configuration of ${0}","Getting git repository details":"Getting git repository details","Getting changes":"Getting changes"," - Git":" - Git","Repositories - Git":"Repositories - Git",Repository:"Repository","Repository Not Found":"Repository Not Found","No Repositories":"No Repositories","Loading repository":"Loading repository","Loading repositories":"Loading repositories","(no remote)":"(no remote)","location: ":"location: ",NumFilesStageAndCommit:"${0} file(s) to stage and ${1} file(s) to commit.","Nothing to commit.":"Nothing to commit.","Nothing to push.":"Nothing to push.",NCommitsToPush:"${0} commit(s) to push.","You have no changes to commit.":"You have no changes to commit.","Rebase in progress!":"Rebase in progress!","View all local and remote tracking branches":"View all local and remote tracking branches",tracksNoBranch:"tracks no branch",tracks:"tracks ${0}","last modified ${0} by ${1}":"last modified ${0} by ${1}","No Remote Branches":"No Remote Branches","Rendering branches":"Rendering branches",Commits:"Commits",GettingCurrentBranch:"Getting current branch for ${0}","See Full Log":"See Full Log","See the full log":"See the full log",'Getting commits for "${0}" branch':'Getting commits for "${0}" branch',"Rendering commits":"Rendering commits","Getting outgoing commits":"Getting outgoing commits","The branch is up to date.":"The branch is up to date.",NoOutgoingIncomingCommits:"You have no outgoing or incoming commits.",") by ":") by "," (SHA ":" (SHA ","Getting tags":"Getting tags","View all tags":"View all tags"," on ":" on "," by ":" by ",Remotes:"Remotes","Rendering remotes":"Rendering remotes","No Remotes":"No Remotes","Unstaged addition":"Unstaged addition","Staged addition":"Staged addition"," (Rebase in Progress)":" (Rebase in Progress)",Status:"Status","Log (0)":"Log (${0})","Log (0) - 1":"Log (${0}) - ${1}","Status for ${0} - Git ":"Status for ${0} - Git ","No Unstaged Changes":"No Unstaged Changes","No Staged Changes":"No Staged Changes",'Changes for "${0}" branch':"Changes for ${0}",'Commits for "${0}" branch':"Commits for ${0}",'Commits for "${0}" branch against':'Commits for "${0}" branch against',"Add Remote":"Add Remote","Are you sure you want to delete submodule ${0}?":"Are you sure you want to delete submodule ${0}?","Delete submodule from its parent":"Delete submodule from its parent","Delete Submodule":"Delete Submodule","Deleting submodule":"Deleting submodule","Submodule deleted":"Submodule deleted","Sync submodules for the repository":"Sync submodules for the repository","Sync Submodules":"Sync Submodules","Submodules Synced":"Submodules Synced","Syncing submodules":"Syncing submodules","Update submodules for the repository":"Update submodules for the repository","Update Submodules":"Update Submodules","Updating submodules":"Updating submodules","Submodules updated":"Submodules updated","Add git submodule":"Add git submodule",AddSubmodule:"Adding submodule: ${0} to repository: ${1}","Adding submodule: ":"Adding submodule: ","Add Submodule":"Add Submodule","Add a submodule to this Git repository":"Add a submodule to this Git repository","Missing submodule":"Missing submodule","Added submodule":"Added submodule","Missing Submodule Message":"Missing submodule, it is either removed or uninitialized","Added Submodule Message":"Added submodule files that are not yet committed, to view the actual files please open its own repository","Remote Name:":"Remote Name:","Remote URI:":"Remote URI:","Apply Patch":"Apply Patch",ApplyPatchDialog:"Apply Patch","Git Repository":"Git Repository","Go to the git repository":"Open the Git Repository page for this file or folder.","Clone Git Repository":"Clone Git Repository",CloneGitRepositoryDialog:"Clone Git Repository","Repository URL:":"Repository URL: ","Existing directory:":"Existing folder:","New folder:":"New folder:",ChooseFolderDialog:"Choose a Folder","Message:":"Message:","Amend:":"Amend:",SmartAmend:"Amend previous commit",SmartSignedOffById:"Add Signed-off-by to message","ChangeId:":"ChangeId:",SmartChangeId:"Add Change-ID to message","Committer Name:":"Committer Name:","Committer Email:":"Committer Email:",AuthorNamePlaceholder:"Enter author name",AuthorEmailPlaceholder:"Enter author email",CommitterNamePlaceholder:"Enter committer name",CommitterEmailPlaceholder:"Enter committer email","Author Name:":"Author Name:","Author Email:":"Author Email:","The commit message is required.":"The commit message is required.","Git Credentials":"Git Credentials","Username:":"Username:","Private key:":"Private key:",AuthorizeWithGitHub:"Authorize with GitHub","Passphrase (optional):":"Passphrase (optional):","commit:":"commit: ","parent:":"parent: ","branches: ":"branches: ","tags: ":"tags: ",tags:"tags"," authored by ${0} {${1}) on ${2}":" authored by ${0} (${1}) on ${2}",Content:"Content","Go to ${0} section":"Go to ${0} section","Type the commit name (sha1):":"Type the commit name (sha1):",Search:"Search","Searching...":"Searching...",SelectAll:"Select All","Looking for the commit":"Looking for the commit","New Branch:":"New Branch:","No remote selected":"No remote selected","Enter a name...":"Enter a name...",OK:"OK",Cancel:"Cancel",Clear:"Clear",Filter:"Filter",FilterCommits:"Filter Commits",FilterCommitsTip:"Toggles the filter commits panel",MaximizeCmd:"Maximize",MaximizeTip:"Toggles the maximize state of the editor"," [New branch]":" [New branch]",AddKeyToHostContinueOp:"Would you like to add ${0} key for host ${1} to continue operation? Key fingerpt is ${2}.","Link Repository":"Link Repository","Folder name:":"Folder name:","Repository was linked to ":"Repository was linked to ",CheckoutCommitTooltip:"Checkout this commit, creating a local branch based on its contents.",CheckoutTagTooltip:"Checkout this tag, creating a local branch based on its contents.","Checking out ${0}":"Checking out ${0}",CheckoutBranchMsg:"Checkout the branch or corresponding local branch and make it active. If the remote tracking branch does not have a corresponding local branch, the local branch will be created first.","Checking out branch...":"Checking out branch","Adding branch ${0}...":"Adding branch ${0}","Removing branch ${0}...":"Removing branch ${0}","Adding remote ${0}...":"Adding remote ${0}","Removing remote ${0}...":"Removing remote ${0}","Removing repository ${0}":"Removing repository ${0}","Adding tag {$0}":"Adding tag {$0}","Removing tag {$0}":"Removing tag {$0}","Merging ${0}":"Merging ${0}","Merging${0}Succeeded":"Merging ${0} succeeded","Unstaging changes":"Unstaging changes","Checking out branch ${0}...":"Checking out branch ${0}","Branch checked out.":"Branch checked out.","New Branch":"New Branch","Add a new local branch to the repository":"Add a new local branch to the repository","Branch name":"Branch name",Delete:"Delete","Delete the local branch from the repository":"Delete the local branch from the repository",DelBrConfirm:"Are you sure you want to delete branch ${0}?","Delete the remote tracking branch from the repository":"Delete the remote tracking branch from the repository","Are you sure?":"Are you sure?",RemoveRemoteBranchConfirm:'You\'re going to delete remote branch "${0}" and push the change.\n\nAre you sure?',"Removing remote branch: ":"Removing remote branch: ","Delete Remote Branch":"Delete Remote Branch","New Remote":"New Remote",Gerrit:"Gerrit","Git Remote":"Git Remote","Go to Git Remote":"Open the remote Git Log page for this file or folder.","Add a new remote to the repository":"Add a new remote to the repository","Delete the remote from the repository":"Delete the remote from the repository","Are you sure you want to delete remote ${0}?":"Are you sure you want to delete remote ${0}?",Pull:"Pull","Pull from the repository":"Pull from the repository","Pulling: ":"Pulling: ","Pull Git Repository":"Pull Git Repository","Git Log":"Git Log","Go to Git Log":"Open the local Git Log page for this file or folder.","Open the log for the branch":"Open the log for the branch","Open the log for the repository":"Open the log for the repository","Open the status for the repository":"Open the status for the repository",ShowInEditor:"Show in Editor",ShowInEditorTooltip:"Show the repository folder in the editor",CompareEach:"Compare With Each Other","Compare With Working Tree":"Compare With Working Tree",Open:"Open",OpenGitCommitTip:"View the tree for this commit",OpenCommitVersion:"Open Commit",ViewCommitVersionTip:"View the committed version of the file",Fetch:"Fetch","Fetch from the remote":"Fetch from the remote","Password:":"Password:","User Name:":"User Name:","Fetching remote: ":"Fetching remote: ","Force Fetch":"Force Fetch",FetchRemoteBranch:"Fetch from the remote branch into your remote tracking branch overriding its current content",OverrideContentRemoteTrackingBr:"You're going to override content of the remote tracking branch. This can cause the branch to lose commits.",Merge:"Merge",MergeContentFrmBr:"Merge the content from the branch to your active branch",". Go to ${0}.":". Go to ${0}.","Git Status page":"Git Status page",Rebase:"Rebase",RebaseOK:"Rebase succeeded",RebaseAborted:"Rebase aborted",RebaseSucceeded:"${0} succeeded",RebaseCommitsMsg:"Rebase your commits by removing them from the active branch, starting the active branch again based on the latest state of the selected branch ","Rebase on top of ":"Rebase on top of ",RebaseSTOPPED:"Some conflicts occurred. Please resolve them and continue, skip patch or abort rebasing.",RebaseFAILED_WRONG_REPOSITORY_STATE:"Repository state is invalid (i.e. already during rebasing).",RebaseFAILED_UNMERGED_PATHS:"Repository contains unmerged paths.",RebaseFAILED_PENDING_CHANGES:"Repository contains pending changes. Please commit or stash them before performing the rebase again.",RebaseUNCOMMITTED_CHANGES:"There are uncommitted changes. Please commit or stash them before performing the rebase again.",RebaseCommitsByRmvingThem:"Rebase your commits by removing them from the active branch, ",StartActiveBranch:"starting the active branch again based on the latest state of '",ApplyEachCommitAgain:"and applying each commit again to the updated active branch.","Push All":"Push All",PushCommitsTagsFrmLocal:"Push commits and tags from your local branch into the remote branch","Push Branch":"Push Branch",PushResult:"Push Result:",PushCommitsWithoutTags:"Push commits without tags from your local branch into the remote branch","Push for Review":"Push for Review","Push commits to Gerrit Code Review":"Push commits to Gerrit Code Review","Force Push Branch":"Force Push Branch",PushCommitsWithoutTagsOverridingCurrentContent:"Push commits without tags from your local branch into the remote branch overriding its current content","Pushing remote: ":"Pushing remote: ",PushingRemoteSucceeded:"Pushing to remote: ${0} succeeded",PushingGerritChangeSucceeded:"Pushing to gerrit ${0} succeeded: ${1}",ChooseBranchDialog:"Choose Branch","Choose the remote branch.":"Choose the remote branch.","Force Push All":"Force Push All",PushCommitsTagsFrmLocalBr:"Push commits and tags from your local branch into the remote branch overriding its current content",OverrideContentOfRemoteBr:"You're going to override content of the remote branch. This can cause the remote repository to lose commits.","< Previous Page":"< Previous Page","Show previous page of git log":"Show previous page of git log","Show previous page of git tags":"Show previous page of git tags","Next Page >":"Next Page >","Show next page of git log":"Show next page of git log","Show next page of git tags":"Show next page of git tags","Push from your local branch into the selected remote branch":"Push from your local branch into the selected remote branch",ResetActiveBr:"Reset your active branch to the state of this reference. Discard all staged and unstaged changes.",GitResetIndexConfirm:'The content of your active branch will be replaced with commit "${0}". All unstaged and staged changes will be discarded and cannot be recovered if "${1}" is not checked. Are you sure?',"Resetting index...":"Resetting index...","Resetting git index for ${0}":"Resetting git index for ${0}",Tag:"Tag","Create a tag for the commit":"Create a tag for the commit",ProjectSetup:"Your project is being set up. This might take a minute...",LookingForProject:"Looking for project: ${0}","Tag name":"Tag name","Delete the tag from the repository":"Delete the tag from the repository","Are you sure you want to delete tag ${0}?":"Are you sure you want to delete tag ${0}?","Cherry-Pick":"Cherry-Pick",CherryPicking:"Cherry Picking commit: ${0}",RevertingCommit:"Reverting commit: ${0}","Apply the change introduced by the commit to your active branch":"Apply the change introduced by the commit to your active branch","Nothing changed.":"Nothing changed.",". Some conflicts occurred":". Some conflicts occurred.","Fetch from the remote branch into your remote tracking branch":"Fetch from the remote branch into your remote tracking branch","Fetch Git Repository":"Fetch Git Repository",Push:"Push","Push from your local branch into the remote branch":"Push from your local branch into the remote branch","Push Git Repository":"Push Git Repository","Key:":"Key:","Value:":"Value:","New Configuration Entry":"New Configuration Entry",Edit:"Edit","Edit the configuration entry":"Edit the configuration entry","Delete the configuration entry":"Delete the configuration entry","Are you sure you want to delete ${0}?":"Are you sure you want to delete ${0}?","Clone Repository":"Clone Repository","Clone an existing Git repository to a folder":"Clone an existing Git repository to a folder","Cloning repository: ":"Cloning repository: ","Init Repository":"Init Repository","Create a new Git repository in a new folder":"Create a new Git repository in a new folder","Initializing repository: ":"Initializing repository: ","Init Git Repository":"Init Git Repository","Delete the repository":"Delete the repository","Are you sure you want do delete ${0} repositories?":"Are you sure you want do delete ${0} repositories?","Apply a patch on the selected repository":"Apply a patch on the selected repository","Show content":"Show content","Commit name:":"Commit name:","Open Commit":"Open Commit",OpenCommitDialog:"Open Commit","Open the commit with the given name":"Open the commit with the given name","No commits found":"No commits found","Staging changes":"Staging changes","Commit message:":"Commit message:","Committing changes":"Committing changes","Fetching previous commit message":"Fetching previous commit message","Resetting local changes":"Resetting local changes","Checkout files, discarding all changes":"Checkout files, discarding all changes","Show Patch":"Show Patch","Loading default workspace":"Loading default workspace","Show workspace changes as a patch":"Show workspace changes as a patch","Show checked changes as a patch":"Show checked changes as a patch",EmptyPatchWarning:"Please select at least one file to be included in the patch",ShowCommitPatchTip:"Show patch for changes in this commit",Continue:"Continue","Continue Rebase":"Continue Rebase","Skip Patch":"Skip Patch",Abort:"Abort","Abort Rebase":"Abort Rebase",Discard:"Discard",Ignore:"Ignore",ChangesSelectedFilesDiscard:"Your changes to the selected files will be discarded and cannot be recovered.","Getting git log":"Getting git log","Getting stashed changes...":"Getting stashed changes...","Active Branch (${0})":"Active Branch (${0})","Branch (${0})":"Branch (${0})","Tag (${0})":"Tag (${0})","Commit (${0})":"Commit (${0})","StashCommit (${0})":"Stash (${0})",WIPStash:"WIP on ${0}: ${1}",IndexStash:"index on ${0}: ${1}","RemoteTrackingBranch (${0})":"Remote Branch (${0})","Active Branch Log":"Git Log (Active Branch)","Show the log for the active local branch":"Show the log for the active local branch","Remote Branch Log":"Git Log (Remote Branch)","Show the log for the corresponding remote tracking branch":"Show the log for the corresponding remote tracking branch","See Full Status":"See Full Status","See the status":"See the status","Choose target location":"Choose target location","Default target location":"Default target location","Change...":"Change...","Merge Squash":"Merge Squash","Squash the content of the branch to the index":"Squash the content of the branch to the index","Local Branch Name:":"Local Branch Name:",Local:"local","Filter items":"Filter items","Filter filter":"Filter message","Filter author":"Filter author","Filter committer":"Filter commiter","Filter sha1":"Filter sha1","Filter fromDate":"Filter from date YYYY-MM-DD or 1(h d w m y)","Filter toDate":"Filter to date YYYY-MM-DD or 1(h d w m y)","Filter path":"Filter path","Filter remote branches":"Filter remote branches","Getting remote branches":"Getting remote branches ${0}","Getting remote details":"Getting remote details: ${0}",PatchApplied:"Patch applied successfully",PatchFailed:"Apply patch failed. ${0}","Getting branches":"Getting branches ${0}","Paste link in email or IM":"Paste link in email or IM","Show Commit in GitHub":"Show Commit in GitHub","Show Repository in GitHub":"Show Repository in GitHub","Show this commit in GitHub":"Show this commit in GitHub","Show Commit in eclipse.org":"Show Commit in eclipse.org","Show this commit in eclipse.org":"Show this commit in eclipse.org","Show Repository in eclipse.org":"Show Repository in eclipse.org","Show this repository in eclipse.org":"Show this repository in eclipse.org","Ask for review":"Ask for review","Ask for review tooltip":"Send email with request for commit review","Reviewer name":"Reviewer name","Contribution Review Request":"Contribution Review Request","Send the link to the reviewer":"Send the link to the reviewer","Private key file (optional):":"Private key file (optional):","Don't prompt me again:":"Don't prompt me again:","Your private key will be saved in the browser for further use":"Your private key will be saved in the browser for further use","Loading Contribution Review Request...":"Loading Contribution Review Request...","The commit can be found in the following repositories":"The commit can be found in the following repositories","Try to update your repositories":"Try to update your repositories","Create new repository":"Create new repository","Attach the remote to one of your existing repositories":"Attach the remote to one of your existing repositories","You are reviewing contribution ${0} from ${1}":"You are reviewing contribution ${0} from ${1}",CommitNotFoundInWorkspace:"Unfortunately the commit can not be found in your workspace. To see it try one of the following: ","To review the commit you can also:":"To review the commit you can also:","Contribution Review Request for ${0} on ${1}":"Contribution Review Request for ${0} on ${1}","Failing paths: ${0}":"Failing paths: ${0}","Problem while performing the action":"Problem while performing the action","Go to the Orion repositories page to provide a git repository URL. Once the repository is created, it will appear in the Navigator.":"Go to the Orion repositories page to provide a git repository URL. Once the repository is created, it will appear in the Navigator.","URL:":"URL:","File:":"File:",Submit:"Submit","git url:":"git url: ",Revert:"Revert","Revert changes introduced by the commit into your active branch":"Revert changes introduced by the commit into your active branch",". Could not revert into active branch":". Could not revert into active branch.",Login:"Login","Authentication required for: ${0}. ${1} and re-try the request.":"Authentication required for: ${0}. ${1} and re-try the request.",Save:"Save","Remember my committer name and email:":"Remember my committer name and email:","Successfully edited ${0} to have value ${1}":"Successfully edited ${0} to have value ${1}","Successfully added ${0} with value ${1}":"Successfully added ${0} with value ${1}","Signed-off-by: ":"Signed-off-by: ","Change-Id: ":"Change-Id: ",Push_REJECTED_NONFASTFORWARD:"Push is non-fastforward and was rejected. Use Fetch to see new commits that must be merged.","Commit and Push":"Commit and Push",Sync:"Sync",SyncTooltip:"Fetch from the remote branch. Rebase your commits by removing them from the local branch, starting the local branch again based on the latest state of the remote branch and applying each commit to the updated local branch. Push commits and tags from your local branch into the remote branch.",NoCommits:"No Changes",NoContent:"No Content",Incoming:"Incoming",Outgoing:"Outgoing",IncomingWithCount:"Incoming (${0})",OutgoingWithCount:"Outgoing (${0})",Synchronized:"History",Uncommited:"Uncommited","Repository:":"Repository:","Reference:":"Reference:","Author:":"Author:","Committer:":"Committer:","SHA1:":"SHA1:",ShowActiveBranchCmd:"Show Active Branch",ShowReferenceCmd:"Show Reference",ShowReferenceTip:'View the history of ${1} "${2}"',ShowActiveBranchTip:'View the history of "${0}" relative to ${1} "${2}"',CommitType:"commit",BranchType:"branch",RemoteTrackingBranchType:"remote branch",TagType:"tag",StashCommitType:"stash","Path:":"Path:",LocalChanges:"Working Directory Changes",LocalChangesDetails:"Working Directory Details",CompareChanges:"Compare (${0} => ${1})",NoBranch:"No Branch",NoActiveBranch:"No Active Branch",NoRef:"No Selected Reference",None:"None",FileSelected:"${0} file selected",FilesSelected:"${0} files selected",FileChanged:"${0} file changed",FilesChanged:"${0} files changed",file:"file",files:"files",EmptyCommitConfirm:"You have no files selected. If you continue, you will end up with an empty commit. Do you want to continue?",AlwaysSelectFiles:"Always select changed files (see Git Settings)",EmptyCommitWarning:"The commit is empty",FilesChangedVsReadyToCommit:"${0} ${1} changed. ${2} ${3} ready to commit.",CommitPush:"Commit and Push","Commits and pushes files to the default remote":"Commits and pushes files to the default remote",Stash:"Stash",stashIndex:"stash@{${0}}: ${1}","Stash all current changes away":"Stash all current changes away",Drop:"Drop","Drop the commit from the stash list":"Drop the commit from the stash list",Apply:"Apply","Pop Stash":"Pop Stash","Apply the most recently stashed change to your active branch and drop it from the stashes":"Apply the most recently stashed change to your active branch and drop it from the stashes",stashes:"stashes",addDependencyName:"Git Repository",addDependencyTooltip:"Associate a git repository with this project.",addProjectName:"Git Repository",addProjectTooltip:"Create a project from a git repository.",fetchGroup:"Fetch",pushGroup:"Push","Url:":"Url:","Ssh Private Key:":"Ssh Private Key:","Ssh Passphrase:":"Ssh Passphrase:",confirmUnsavedChanges:"There are unsaved changes. Do you want to save them?",NewConfigurationEntryTooltip:"Add a new entry to the repository configuration",Configurations:"Configurations","DetachedHead ${0}":"Detached HEAD@${0}",SingleSubmodule:"${0} (${1} submodule)",PluralSubmodule:"${0} (${1} submodules)",UninitializedSubmodule:" ( Uninitialized Submodule )","Detach Head:":"Detach Head:","Filter repositories":"Filter repositories","Filter references":"Filter references","Filter configuration entries":"Filter configuration entries",ContinueTooltip:"Use after merging the conflicts and selecting all files",SkipTooltip:"Bypass the current patch",AbortTooltip:"Abort to end the rebase at any time",CreatePullRequestRemoteConfirm:"In order to check out this pull request, a remote branch named ${0} with url ${1} will be created if it does not exist, are you sure?","pull requests":"pull requests",CheckoutPullRequest:"Checkout Pull Request",CheckoutPullRequestMsg:"Checkout the pull request and make it active.","Checking out pull request ${0}...":"Checking out pull request ${0}","Checking out pull request...":"Checking out pull request","Pull Request checked out.":"Pull Request checked out.","Getting pull requests...":"Getting pull requests...",PullRequestTreeItem:"${0}/${1} => ${2}/${3}",PullRequestDescription:"#${0} ${1}",MorePullRequests:'More pull requests for "${0}"',MorePullRequestsProgress:'Loading more pull requests for "${0}"...',"Authorize to get pull requests":"Authorize to get pull requests",CherryPickProgress:"Cherry Pick in progress",MergeProgress:"Merge in progress",OpenGithubPullRequest:"Open Github Page",OpenGithubPullRequestMsg:"Open the Github page for this Pull Request.",AllowPopUpMsg:"Please allow popups for this site.",ToggleGraph:"Toggles the graphical representation of the commit history"}),define("orion/git/util",["i18n!git/nls/gitmessages","orion/i18nUtil","orion/URL-shim"],function(e,t){function i(e){for(var t=0;t<L.length;t++)if(e.type===L[t])return!0;
return!1}function n(e){for(var t=0;t<x.length;t++)if(e.type===x[t])return!0;return!1}function o(e){return i(e)||n(e)}function r(e){for(var t=0;t<L.length;t++)if(e[L[t]].length>0)return!0;return!1}function s(e){for(var t=0;t<x.length;t++)if(e[x[t]].length>0)return!0;return!1}function a(e){try{var t=new URL(e);return{host:t.hostname,port:t.port}}catch(i){try{var n=e.split(":"),o=n[0].split("@"),r=o.length>1?o[1]:o[0];return{host:r,port:22}}catch(s){return{host:"",port:""}}}}function l(e){for(var t=e.split(/\r\n|\n/),i=0;t.length>0&&/^\s*$/.test(t[i]);)i++;var n=100;return t[i].length>n?t[i].substring(0,n):t[i]}function c(e,t,i,n){var o=d(e,t);return o?n?i+o:i.replace(o,""):i}function d(e,t){return e&&t?"\n\nSigned-off-by: "+e+" <"+t+">":void 0}function h(e){for(var t=e.split(/\r\n|\n/),i={},n=0,o=!1,r=t.length-1;r>=0;--r){var s="Change-Id: ",a="Signed-off-by: ";if(0===t[r].indexOf(s)){if(i.changeId=t[r].substring(s.length,t[r].length),++n>1){i={};break}}else o||0!==t[r].indexOf(a)||(i.signedOffBy=t[r].substring(a.length,t[r].length),a=!0)}return i}function u(i){if(i.Detached)return t.formatMessage(e["DetachedHead ${0}"],p(i.HeadSHA));var n=i.Name;return"StashCommit"===i.Type&&(n=t.formatMessage(e.stashIndex,i.parent.children.indexOf(i),p(n))),"Commit"===i.Type&&(n=p(n)),"RemoteTrackingBranch"!==i.Type||i.Id||(n+=e[" [New branch]"]),n}function p(e){return e.substring(0,6)}function f(e,t){return e&&t?e===t?!0:e.Name===t.Name&&e.Type===t.Type:!1}function g(e){var t=e.split("/").slice(-3);return t=t.join("/"),t.length<e.length?"..."+t:e}function m(e){var t="";if("string"==typeof e)t=e;else if(e){var i=e.Parents;i.length>1&&(t=e.Location.substring(i[i.length-2].Location.length))}return t}function v(e){var t=e.filter(function(e){return e}).join("&");return t.length&&(t="?"+t),t}function _(e){return e&&"RemoteTrackingBranch"===e.Type&&!e.Id}function y(e){return e&&e.RemoteLocation&&e.RemoteLocation[0]&&!_(e.RemoteLocation[0].Children[0])}function C(e){if(!e)return!1;var t=e.status&&e.status.RepositoryState||e.RepositoryState;return t&&"SAFE"===t}function w(e){if(!e)return!1;var t=e.status&&e.status.RepositoryState||e.RepositoryState;return t&&0===t.indexOf("MERGING")}function b(e){if(!e)return!1;var t=e.status&&e.status.RepositoryState||e.RepositoryState;return t&&0===t.indexOf("REBASING")}function S(e){if(!e)return!1;var t=e.status&&e.status.RepositoryState||e.RepositoryState;return t&&0===t.indexOf("CHERRY_PICKING")}var x=["Missing","Modified","Untracked","Conflicting"],L=["Added","Changed","Removed"];return{isSafe:C,isRebasing:b,isMerging:w,isCherryPicking:S,isStaged:i,isUnstaged:n,isChange:o,isNewBranch:_,tracksRemoteBranch:y,generateQuery:v,hasStagedChanges:r,hasUnstagedChanges:s,parseSshGitUrl:a,trimCommitMessage:l,changeSignedOffByCommitMessage:c,sameRef:f,shortenRefName:u,shortenPath:g,shortenString:p,relativePath:m,getGerritFooter:h}}),define("orion/git/gitPreferenceStorage",["orion/Deferred"],function(e){function t(e){this._prefix="/git/credentials",this._preferenceService=e.getService("orion.core.preference")}return t.prototype={put:function(t,i){var n={gitSshUsername:"",gitSshPassword:"",gitPrivateKey:"",gitPassphrase:""};void 0!==i&&(void 0!==i.gitSshUsername&&null!==i.gitSshUsername&&(n.gitSshUsername=i.gitSshUsername),void 0!==i.gitSshPassword&&null!==i.gitSshPassword&&(n.gitSshPassword=i.gitSshPassword),void 0!==i.gitPrivateKey&&null!==i.gitPrivateKey&&(n.gitPrivateKey=i.gitPrivateKey),void 0!==i.gitPassphrase&&null!==i.gitPassphrase&&(n.gitPassphrase=i.gitPassphrase));var o=new e;return this._preferenceService.get(this._prefix,void 0,{scope:2}).then(function(e){var i=e.settings;if(void 0===i)return void o.reject();if(i.enabled){var r={};r[t]=n,this._preferenceService.put(this._prefix,r,{scope:2}).then(o.resolve,o.reject)}else o.reject()}.bind(this)),o},get:function(t){var i={gitSshUsername:"",gitSshPassword:"",gitPrivateKey:"",gitPassphrase:""},n=new e;return this._preferenceService.get(this._prefix,void 0,{scope:2}).then(function(e){var o=e.settings;if(void 0===o)return void n.reject();if(o.enabled){var r=e[t];n.resolve(void 0!==r?r:i)}else n.reject()}),n},isEnabled:function(){var t=new e;return this._preferenceService.get(this._prefix,void 0,{scope:2}).then(function(e){var i=e.settings;return void 0===i?void t.resolve(!1):void t.resolve(i.enabled)}),t},enable:function(){return this._preferenceService.put(this._prefix,{settings:{enabled:!0}},{scope:2})},disable:function(){return this._preferenceService.put(this._prefix,{settings:{enabled:!1}},{scope:2})},remove:function(e){return this._preferenceService.remove(this._prefix,e,{scope:2})},getRepositories:function(){var t=new e;return this._preferenceService.get(this._prefix,void 0,{scope:2}).then(function(e){for(var i=[],n=Object.keys(e),o=0;o<n.length;++o)"settings"!==n[o]&&i.push(n[o]);t.resolve(i)}),t}},t.prototype.constructor=t,t}),define("orion/git/widgets/GitCredentialsDialog",["i18n!git/nls/gitmessages","orion/git/gitPreferenceStorage","orion/webui/dialog","orion/git/util"],function(e,t,i,n){function o(e){this._init(e)}return o.prototype=new i.Dialog,o.prototype.TEMPLATE='<table><tbody><tr><td align="right" id="gitCredentialsLabel">${Repository URL:}</td><td><strong id="url"></strong></td></tr><tr id="gitHubAuthRow"><td></td><td><span class="githubCloneAuth"><input type="button" class="dismissButton" id="authButton"></span></td></tr><tr id="gitSshUsernameRow"><td align="right"><label style="line-height: 1;" id="gitSshUsernameLabel" for="gitSshUsername">${Username:}</label></td><td><input id="gitSshUsername" type="text" value="" style="margin: 0;"></td></tr><tr id="gitSshPasswordRow"><td align="right"><input style="margin: 0;" id="isSshPassword" type="radio" name="isSshPassword" checked value="password"/><label style="line-height: 1; margin-left: 5px; vertical-align: text-top;" id="gitSshPasswordLabel" for="gitSshPassword">${Password:}</label></td><td><input type="password" id="gitSshPassword" value="" style="margin: 0;"></td></tr><tr id="gitPrivateKeyRow"><td align="right" valign="top"><input style="margin: 0;" id="isPrivateKey" type="radio" name="isSshPassword" value="privateKey"/><label style="line-height: 1; margin-left: 5px; vertical-align: text-top;" id="gitPrivateKeyLabel" for="gitPrivateKey">${Private key:}</label></td><td><textarea id="gitPrivateKey" value=""></textarea></td></tr><tr id="gitPrivateKeyFileRow"><td align="right"><label id="gitPrivateKeyFileLabel" for="gitPrivateKeyFile">${Private key file (optional):}</label></td><td><input style="margin: 0; padding: 0;" id="gitPrivateKeyFile" multiple="false" type="file" size="53" label="Browse..."></td></tr><tr id="gitPassphraseRow"><td align="right"><label id="gitPassphraseLabel" for="gitPassphrase">${Passphrase (optional):}</label></td><td><input type="password" id="gitPassphrase" value="" style="margin: 0;"></td></tr><tr id="gitSaveCredentialsRow"><td align="right"><img id="gitSaveCredentialsInfo" src="../images/info.gif""><input id="gitSaveCredentials" type="checkbox" name="gitSaveCredentials"></td><td><label id="gitSaveCredentialsLabel" for="gitSaveCredentials">${Don\'t prompt me again}</label></td></tr></tbody></table>',o.prototype._init=function(t){var i=this;this.title=t.title||e["Git Credentials"],this.modal=!0,this.messages=e,this.options=t,this._afterHiding=t.closeCallback,this.options.username||this.options.password||this.options.privatekey||this.options.passphrase||(this.options.username=!0,this.options.password=!0,this.options.privatekey=!0,this.options.passphrase=!0),t.serviceRegistry&&(this._sshService=t.serviceRegistry.getService("orion.net.ssh"),this._progressService=t.serviceRegistry.getService("orion.page.progress")),this.buttons=[],this.buttons.push({callback:function(){i.destroy(),i._execute()},text:"OK",isDefault:!0}),this._initialize()},o.prototype._bindToDom=function(){var i=this;this.options.username||(this.$gitSshUsernameRow.style.display="none"),this.options.password||(this.$gitSshPasswordRow.style.display="none"),this.options.privatekey||(this.$gitPrivateKeyRow.style.display="none",this.$gitPrivateKeyFileRow.style.display="none"),this.options.passphrase||(this.$gitPassphraseRow.style.display="none"),this.options.errordata&&this.options.errordata.Url&&(this.$gitCredentialsLabel.style.display="block",this.$url.textContent=this.options.errordata.Url),this.options.errordata&&this.options.errordata.GitHubAuth?(this.$authButton.value=e.AuthorizeWithGitHub,function(e){this.$authButton.addEventListener("click",function(){window.location.href=e})}.bind(this)(this.options.errordata.GitHubAuth+"?ref="+encodeURIComponent(window.location.href)+",cloneGitRepository="+encodeURIComponent(this.options.errordata.Url))):this.$gitHubAuthRow.style.display="none",this.options.errordata&&this.options.errordata.User&&""!==this.options.errordata.User&&(this.$gitSshUsername.value=this.options.errordata.User,this.$gitSshUsernameRow.style.display="none",setTimeout(function(){i.$gitSshPassword.focus()},400));var n=new t(this.options.serviceRegistry);n.isEnabled().then(function(e){e||(i.$gitSaveCredentials.style.display="none",i.$gitSaveCredentialsLabel.style.display="none",i.$gitSaveCredentialsInfo.style.display="none")}),this.$gitSshPassword.addEventListener("focus",function(){i.$isSshPassword.checked=!0}),this.$gitPrivateKey.addEventListener("focus",function(){i.$isPrivateKey.checked=!0}),this.$gitPrivateKeyFile.addEventListener("focus",function(){i.$isPrivateKey.checked=!0}),this.$gitPassphrase.addEventListener("focus",function(){i.$isPrivateKey.checked=!0}),this.$gitPrivateKeyFile.addEventListener("change",function(e){var t=e.target.files[0];i.privateKeyFile=t})},o.prototype._execute=function(){var e=this,i=this.$gitPrivateKey.value,o=this.$url.textContent,r=function(t){if(e._sshService){var i=n.parseSshGitUrl(o);e._sshService.getKnownHostCredentials(i.host,i.port).then(function(i){if(e.options.func){var n="undefined"==typeof e.options.failedOperation?e.options.errordata.failedOperation:e.options.failedOperation;"undefined"!==n&&e._progressService.removeOperation(n),e.options.func({gitSshUsername:e.$gitSshUsername.value,gitSshPassword:e.$isSshPassword.checked?e.$gitSshPassword.value:"",gitPrivateKey:e.$isPrivateKey.checked?t:"",gitPassphrase:e.$isPrivateKey.checked?e.$gitPassphrase.value:"",knownHosts:i})}})}else if(e.options.func){var r="undefined"==typeof e.options.failedOperation?e.options.errordata.failedOperation:e.options.failedOperation;"undefined"!==r&&e._progressService.removeOperation(r),e.options.func({gitSshUsername:e.$gitSshUsername.value,gitSshPassword:e.$gitSshPassword.value,gitPrivateKey:t,gitPassphrase:e.$gitPassphrase.value,knownHosts:e.$gitSshKnownHosts.value})}};if(this.privateKeyFile){var s=new FileReader;s.onload=function(){return function(n){i=n.target.result;var s=new t(e.options.serviceRegistry);e.$gitSaveCredentials.checked?s.put(o,{gitSshUsername:e.$gitSshUsername.value,gitPrivateKey:i,gitPassphrase:e.$gitPassphrase.value}).then(function(){r(i)}):r(i)}}(this.privateKeyFile),s.readAsText(this.privateKeyFile)}else if(i.length>0){var a=new t(e.options.serviceRegistry);e.$gitSaveCredentials.checked?a.put(o,{gitPrivateKey:i,gitPassphrase:e.$gitPassphrase.value}).then(function(){r(i)}):r(i)}else{var a=new t(e.options.serviceRegistry);e.$gitSaveCredentials.checked?a.put(o,{gitSshUsername:e.$gitSshUsername.value,gitSshPassword:e.$gitSshPassword.value}).then(function(){r(i)}):r(i)}},o.prototype.constructor=o,{GitCredentialsDialog:o}}),define("jazzui/nls/messages",{root:!0}),define("jazzui/nls/root/messages",{setupJazzProject:"Setting up your workspace...",setupGitProject:"Setting up your workspace (cloning the repository)..."}),define("orion/jazzui/projectCommands",["require","orion/Deferred","orion/commands","orion/i18nUtil","orion/git/util","orion/jazzui/jazzCommands","orion/git/gitConfigPreference","orion/jazzui/pageUtil","orion/URITemplate","orion/jazzui/widgets/SelectProjectAreaDialog","orion/git/gitPreferenceStorage","orion/git/widgets/GitCredentialsDialog","i18n!jazzui/nls/messages"],function(e,t,i,n,o,r,s,a,l,c,d,h,u){function p(e){var t;try{t=JSON.parse(e.responseText)}catch(i){t={Message:"Problem while performing the action"}}return t.HttpCode=e.status,t}var f={};return f.checkJazzError=function(e,t){if(e.errorCode){var i=[];return i.Severity="Error",i.HTML=!1,i.Message=e.errorMessage||"Unknown error from jazz server: "+e.errorCode,t.setProgressResult(i),!0}return!1},f.handleError=function(e,t){var i=[];i.Severity="Error",i.HTML=!1;try{var n=JSON.parse(e.responseText);i.Message=n.DetailedMessage?n.DetailedMessage:n.Message}catch(o){i.Message=e.message}t.setProgressResult(i)},f.handleKnownHostsError=function(e,t,i,r){if(confirm(n.formatMessage("Would you like to add ${0} key for host ${1} to continue operation? Key fingerpt is ${2}.",t.KeyType,t.Host,t.HostFingerprint))){var s=o.parseSshGitUrl(t.Url),a={host:t.Host,keyType:t.KeyType,hostKey:t.HostKey,port:s.port},l=e.getService("orion.net.ssh");l.addKnownHost(a).then(function(t){if(i.knownHosts=t,"undefined"!=typeof i.failedOperation){var n=e.getService("orion.page.progress");n.removeOperation(i.failedOperation)}r(i)})}},f.handleSshAuthenticationError=function(e,t,i,n,o){var r=t?t.Url:void 0,s=function(){var t=new h.GitCredentialsDialog({title:o,serviceRegistry:e,func:n,errordata:i.errordata,failedOperation:i.failedOperation});t.show()};if(i.gitSshUsername&&""!==i.gitSshUsername||i.gitSshPassword&&""!==i.gitSshPassword||i.gitPrivateKey&&""!==i.gitPrivateKey)s();else{var a=new d(e);a.get(r).then(function(t){if(""!==t.gitPrivateKey||""!==t.gitSshUsername||""!==t.gitSshPassword){if("undefined"!=typeof i.failedOperation){var o=e.getService("orion.page.progress");o.removeOperation(i.failedOperation)}return void n({knownHosts:i.knownHosts,gitSshUsername:t.gitSshUsername,gitSshPassword:t.gitSshPassword,gitPrivateKey:t.gitPrivateKey,gitPassphrase:t.gitPassphrase})}s()},s)}},f.getDefaultSshOptions=function(e,i,n){var r,s=new t,a=e.getService("orion.net.ssh"),l=n&&!n.optionsRequested?n.valueFor("sshuser"):"",c=n&&!n.optionsRequested?n.valueFor("sshpassword"):"";if(void 0!==i.GitUrl?r=i.GitUrl:void 0!==i.errorData?r=i.errorData.Url:void 0!==i.toRef?r=i.toRef.RemoteLocation[0].GitUrl:void 0!==i.RemoteLocation&&(r=i.RemoteLocation[0].GitUrl),!r)return s.resolve({knownHosts:"",gitSshUsername:l,gitSshPassword:c,gitPrivateKey:"",gitPassphrase:""}),s;var d=o.parseSshGitUrl(r);return a.getKnownHostCredentials(d.host,d.port).then(function(e){s.resolve({knownHosts:e,gitSshUsername:l,gitSshPassword:c,gitPrivateKey:"",gitPassphrase:""})}),s},f.handleProgressServiceResponse=function(e,t,i,n,o,r){if(e&&void 0!==e.status&&(e=p(e)),!e||void 0===e.HttpCode)return void(n&&n(e));switch(e.HttpCode){case 401:return e.JsonData&&(t.errordata=e.JsonData),e.failedOperation&&(t.failedOperation=e.failedOperation),void f.handleSshAuthenticationError(i,e.JsonData,t,o,r);case 400:if(e.JsonData&&e.JsonData.HostKey)return e.failedOperation&&(t.failedOperation=e.failedOperation),void f.handleKnownHostsError(i,e.JsonData,t,o);if(e.JsonData&&e.JsonData.Host)return e.JsonData&&(t.errordata=e.JsonData),e.failedOperation&&(t.failedOperation=e.failedOperation),void f.handleSshAuthenticationError(i,e.JsonData,t,o,r);default:var s=[];s.Severity="Error",s.HTML=!1,s.Message=e.DetailedMessage?e.DetailedMessage:e.Message,i.getService("orion.page.message").setProgressResult(s),n&&n(e)}},f.gatherSshCredentials=function(e,i,r){var s,a=new t;void 0!==i.items.RemoteLocation?s=i.items.RemoteLocation[0].GitUrl:void 0!==i.items.GitUrl?s=i.items.GitUrl:void 0!==i.items.errorData?s=i.items.errorData.Url:void 0!==i.items.toRef&&(s=i.items.toRef.RemoteLocation[0].GitUrl);var l=e.getService("orion.net.ssh"),c=o.parseSshGitUrl(s),u=function(t){e.getService("orion.net.ssh").getKnownHostCredentials(c.host,c.port).then(function(e){i.sshObject=t,a.resolve({knownHosts:e,gitSshUsername:t.gitSshUsername,gitSshPassword:t.gitSshPassword,gitPrivateKey:t.gitPrivateKey,gitPassphrase:t.gitPassphrase})})},p=i.errorData;if(p&&p.HostKey){if(confirm(n.formatMessage("Would you like to add ${0} key for host ${1} to continue operation? Key fingerpt is ${2}.",p.KeyType,p.Host,p.HostFingerprint))){var f=o.parseSshGitUrl(p.Url),g={host:p.Host,keyType:p.KeyType,hostKey:p.HostKey,port:f.port};l.addKnownHost(g).then(function(){if(!i.sshObject||""===i.sshObject.gitSshUsername&&""===i.sshObject.gitSshPassword&&""===i.sshObject.gitPrivateKey){var t=new d(e);t.get(s).then(function(e){u(e)},function(){u({gitSshUsername:"",gitSshPassword:"",gitPrivateKey:"",gitPassphrase:""})})}else u({gitSshUsername:"",gitSshPassword:"",gitPrivateKey:"",gitPassphrase:""})})}return a}var m=function(){if(!i.parameters&&!i.optionsRequested)return void u({gitSshUsername:"",gitSshPassword:"",gitPrivateKey:"",gitPassphrase:""});if(i.parameters&&!i.optionsRequested){var t=i.parameters?i.parameters.valueFor("sshuser"):"",n=i.parameters?i.parameters.valueFor("sshpassword"):"",o=i.parameters&&i.parameters.valueFor("saveCredentials")?i.parameters.valueFor("saveCredentials"):!1,a=new d(e);return o?void a.put(s,{gitSshUsername:t,gitSshPassword:n}).then(function(){u({gitSshUsername:t,gitSshPassword:n,gitPrivateKey:"",gitPassphrase:""})}):void u({gitSshUsername:t,gitSshPassword:n,gitPrivateKey:"",gitPassphrase:""})}var l=new h.GitCredentialsDialog({title:r,serviceRegistry:e,func:u,errordata:p});l.show()};if(!i.sshObject||""===i.sshObject.gitSshUsername&&""===i.sshObject.gitSshPassword&&""===i.sshObject.gitPrivateKey){var v=new d(e);v.get(s).then(function(e){return""!==e.gitPrivateKey||""!==e.gitSshUsername||""!==e.gitSshPassword?void u(e):void m()},m)}else m();return a},f.handleGitServiceResponse=function(e,t,i,n){if(e&&void 0!==e.status&&(e=p(e)),!e||!e.HttpCode)return void(i&&i(e));switch(e.HttpCode){case 401:return void n(e);case 400:if(e.JsonData&&e.JsonData.HostKey)return void n(e);default:var o=[];o.Severity="Error",o.HTML=!1,o.Message=e.DetailedMessage?e.DetailedMessage:e.Message,t.getService("orion.page.message").setProgressResult(o),i&&i(e)}},f.createProjectCommands=function(o,a,d,h){function p(t){var i,o=a.getService("orion.jazz.service"),r=a.getService("orion.git.provider"),l=a.getService("orion.page.progress"),c=a.getService("orion.page.message"),d=new s(a),h=e.specified("orion/splash")&&e("orion/splash");return h&&(i=h.getStep(),i.message="Cloning Repository",h.update(),h.stopFillerProgress()),f.getDefaultSshOptions(a,t).then(function(e){var s=arguments.callee;return l.showWhile(o.initBasicGitProject(t.url,t.projectDescription.name,t.projectDescription,e.gitSshUsername,e.gitSshPassword,e.knownHosts,e.gitPrivateKey,e.gitPassphrase),u.setupGitProject).then(function(e){return h&&h.startFillerProgress(),d._preferenceService.get(d._prefix,void 0,{noCache:!0}).then(function(){return r.getGitClone(e.Location).then(function(e){return m(e.Children[0].ContentLocation)})},function(e){f.handleError(e,c)})},function(t){f.handleProgressServiceResponse(t,e,a,function(){},s,"Clone Git Repository")},function(e){h&&e.message&&(i.detailedMessage=n.formatMessage("${0}: ${1}%  (${2} / ${3})",e.message,Math.round(100*e.loaded/e.total),e.loaded,e.total),h.update())})})}function g(e){var t=a.getService("orion.jazz.service"),i=a.getService("orion.page.progress");return i.showWhile(t.initBasicProject(e.url,e.name,e.uuid,e.user,!0,"true"===e.initReadme),u.setupJazzProject).then(function(t){return"true"===e.initReadme&&t.ReadmeLocation?m(t.ReadmeLocation):v(t.project)},function(e){if(e.JsonData&&e.JsonData.project&&_(e.JsonData.project),e.JsonData&&e.JsonData.advanced){var t=[];t.Severity="Warning",t.HTML=!1,t.Message="Automatic initialization could not be completed: "+e.Message,i.setProgressResult(t)}else r.handleError(e,i)})}function m(i){var n=new t,o=e.toUrl(new l("edit/edit.html#{,resource,params*}").expand({resource:i}));return setTimeout(function(){window.location.replace(o),n.resolve()},0),n}function v(i){var n=new t,o=i.ContentLocation;"/"!==o.slice(-1)&&(o+="/");var r=e.toUrl(new l("edit/edit.html#{,resource,params*}").expand({resource:o}));return setTimeout(function(){window.location.replace(r),n.resolve()},0),n}function _(t){var i=e.toUrl(new l("jazzui/project.html#{,resource,params*}").expand({resource:t.Location}));setTimeout(function(){window.location.replace(i)},0)}var y=new i.Command({name:"Load Project...",tooltip:"Add Project",id:"com.ibm.team.scm.orion.command.addProject",callback:function(t){var i=t.items,n=a.getService("orion.jazz.service"),o=a.getService("orion.page.progress");o.showWhile(n.findRepositoryProjects(i.Url),"Loading...").then(function(t){var r=t.Children,s=new c.SelectProjectAreaDialog({title:"Select Project to Add",jazzClient:n,serviceRegistry:a,projectAreas:r.sort(function(e,t){return e.Name>t.Name}),func:function(t){function n(e){var t=document.createElement("a");return t.href=e,t.href}if(t.Url&&t.Name){var r={"createProject.name":t.Name,"createProject.url":i.Url,"createProject.user":i.UserId,"createProject.uuid":t.ItemId},s=new l(n(e.toUrl("jazzui/project.html"))+"#{,resource,params*}").expand({resource:"",params:r});document.location=s}else f.handleError({message:"Repository did not provide enough information to load project"},o)}});s.show()})},visibleWhen:function(e){return"Repository"===e.Type&&e.UserId}});d.addCommand(y);var C=new i.Command({name:"Remove Project(s)",tooltip:"Remove Project(s) from workspace",id:"com.ibm.team.scm.orion.command.removeProject",callback:function(e){var i=Array.isArray(e.items)?e.items:[e.items],n=a.getService("orion.jazz.service"),o=a.getService("orion.page.progress");d.confirm(e.domNode,"Are you sure you want to remove the projects from your workspace?","Yes","No",!1,function(e){if(e){var r=[];i.forEach(function(e){var i=new t;r.push(i),o.progress(n.deleteProject(e.Location),"Removing project").then(i.resolve,function(e){f.handleError(e,o),i.reject(e)})}),t.all(r).then(function(){h.changedItem()}.bind(this))}})},visibleWhen:function(e){return Array.isArray(e)||(e=[e]),e.every(function(e){return!!e.projectName})}});d.addCommand(C);var w=new i.Command({name:"Create Project",id:"com.ibm.team.scm.orion.command.createProject",callback:function(e){var t=e.items,i=a.getService("orion.jazz.service"),n=a.getService("orion.page.progress"),r=i.findProject(t.name);return n.showWhile(r,"Loading...").then(function(e){return e.Children&&0!==e.Children.length?"true"===t.initReadme?o.fetchChildren(e.Children[0].ContentLocation).then(function(t){for(var i=0;i<t.length;i++)if(t[i].Name&&"readme.md"===t[i].Name.toLowerCase())return m(t[i].Location);return o.createFile(e.Children[0].ContentLocation,"README.md").then(function(e){return m(e.Location)},function(e){f.handleError(e,n)})},function(e){f.handleError(e,n)}):v(e.Children[0]):g(t)})},visibleWhen:function(){return!0}}),b=new i.Command({name:"Create Git Project",id:"com.ibm.team.scm.orion.command.createGitProject",callback:function(e){var i=e.items,n=a.getService("orion.git.provider"),r=a.getService("orion.page.message");return i.url&&i.projectDescription.name?(r.setProgressMessage("Looking for project "+i.projectDescription.name),o.loadWorkspace().then(function(e){for(var o=0;o<e.Children.length;++o){var s=e.Children[o];if(s.Name===i.projectDescription.name)return s.Git?n.getGitClone(s.Git.CloneLocation).then(function(e){return r.close(),m(e.Children[0].GitUrl===i.url?e.Children[0].ContentLocation:e.Children[0].ContentLocation)}):(f.handleError({message:"Project "+i.projectDescription.name+" already exists but is missing the git configuration folder. To recover, delete this project folder and click edit code again."},r),(new t).resolve())}return i.GitUrl=i.url,p(i)})):void 0},visibleWhen:function(){return!0}});d.addCommand(b),d.addCommand(w)},f}),define("text!orion/widgets/projects/RunBar.html",[],function(){return'<div class="runBarWrapper">\r\n	<div class="launchConfigurationsWrapper">\r\n		<span class="dropdownTriggerButtonLabel">\r\n			<span class="statusLight"></span>\r\n			<span class="appName"></span>\r\n			<span class="appInfoSpan"></span>\r\n		</span>\r\n	</div>\r\n	<button id="runBarPlayButton" class="runBarButton playButton core-sprite-play"></button>\r\n	<button id="runBarStopButton" class="runBarButton stopButton core-sprite-stop"></button>\r\n	<a id="runBarAppLink" class="runBarLink appLink core-sprite-open" target="_blank"></a>\r\n	<a id="runBarLogsLink" class="runBarLink logsLink core-sprite-runlogs" target="_blank"></a>\r\n</div>'}),define("text!orion/webui/RichDropdown.html",[],function(){return'<div>\r\n	<button class="dropdownTrigger dropdownDefaultButton orionButton commandButton">\r\n		<span class="dropdownTriggerButtonLabel"></span>\r\n		<span class="dropdownArrowDown core-sprite-openarrow"></span>\r\n	</button>\r\n	<ul class="dropdownMenu" tabindex="0"></ul>\r\n</div>'}),define("orion/webui/RichDropdown",["orion/objects","orion/webui/littlelib","text!orion/webui/RichDropdown.html","orion/webui/dropdown"],function(e,t,i,n){function o(e){this._parentNode=e.parentNode,this._buttonName=e.buttonName,this._buttonDecorator=e.buttonDecorator,this._populateFunction=e.populateFunction,this._noDropdownArrow=e.noDropdownArrow,this._initialize()}return e.mixin(o.prototype,{_initialize:function(){var e=t.createNodes(i);this._dropdownTriggerButton=t.$("button.dropdownTrigger",e),this._dropdownTriggerButtonLabel=t.$(".dropdownTriggerButtonLabel",this._dropdownTriggerButton),this._dropdownNode=t.$("ul.dropdownMenu",e),this._buttonName&&this.setDropdownTriggerButtonName(this._buttonName,this._buttonDecorator);var o=t.$(".dropdownArrowDown",this._dropdownTriggerButton);this._noDropdownArrow?this._dropdownTriggerButton.removeChild(o):this._dropdownButtonArrow=o,this._parentNode.appendChild(this._dropdownTriggerButton),this._parentNode.appendChild(this._dropdownNode),this._dropdownTriggerButton.dropdown=new n.Dropdown({dropdown:this._dropdownNode,populate:this._populateFunction})},getDropdownTriggerButton:function(){return this._dropdownTriggerButton},setDropdownTriggerButtonName:function(e,i,n){var o=n||"";t.empty(this._dropdownTriggerButtonLabel),i&&this._dropdownTriggerButtonLabel.appendChild(i);var r=document.createTextNode(e);this._dropdownTriggerButtonLabel.appendChild(r),this._dropdownTriggerButton.title=o},setCustomTriggerButtonLabelNode:function(e){this._dropdownTriggerButton.replaceChild(e,this._dropdownTriggerButtonLabel),this._dropdownTriggerButtonLabel=e},getDropdown:function(){return this._dropdownTriggerButton.dropdown},destroy:function(){this._dropdownTriggerButton&&(this._dropdownTriggerButton.dropdown&&(this._dropdownTriggerButton.dropdown.destroy(),this._dropdownTriggerButton.dropdown=null),this._dropdownTriggerButton=null)}}),{RichDropdown:o}}),define("text!orion/webui/dialogs/confirmdialog.html",[],function(){return'<div>\r\n	<div class="promptDialogMessage" id="confirmDialogMessage">${ConfirmMessage}</div>\r\n	<div class="checkboxWrapper">\r\n		<label class="checkboxMessage">\r\n			<input type="checkbox" class="confirmDialogCheckbox"/>\r\n			${CheckboxMessage}\r\n		</label>\r\n	</div>\r\n</div>'}),define("orion/webui/dialogs/ConfirmDialog",["i18n!orion/widgets/nls/messages","orion/webui/dialog","text!orion/webui/dialogs/confirmdialog.html","orion/EventTarget","orion/webui/littlelib"],function(e,t,i,n,o){function r(e){n.attach(this),this._init(e)}var s=t.Dialog;return r.prototype=Object.create(s.prototype),r.prototype.constructor=r,r.prototype.TEMPLATE=i,r.prototype._init=function(t){this.title=t.title||document.title,this.messages={ConfirmMessage:t.confirmMessage},t.checkboxMessage&&(this.messages.CheckboxMessage=t.checkboxMessage),this.modal=!0,this.buttons=t.yesNoDialog?[{id:"yesButton",text:e.Yes,callback:this._dismiss.bind(this,!0),isDefault:!0},{id:"noButton",text:e.No,callback:this._dismiss.bind(this,!1)}]:[{id:"okButton",text:e.OK,callback:this._dismiss.bind(this,!0),isDefault:!0},{id:"cancelButton",text:e.Cancel,callback:this._dismiss.bind(this,!1)}],this._initialize(),this.$frame.classList.add("confirmDialog");var i=o.$(".checkboxWrapper",this.$frame);t.checkboxMessage?this._checkbox=o.$("input.confirmDialogCheckbox",i):i.parentNode.removeChild(i)},r.prototype._bindToDom=function(){var e=this._dismiss.bind(this,!1);this.$close.addEventListener("click",e),this.escListener=function(t){t.keyCode===o.KEY.ESCAPE&&e()},this.$frameParent.addEventListener("keydown",this.escListener)},r.prototype.destroy=function(){this.$frameParent.removeEventListener("keydown",this.escListener),s.prototype.destroy.apply(this,arguments)},r.prototype._dismiss=function(e){var t={type:"dismiss",value:e};this._checkbox&&(t.checkboxValue=this._checkbox.checked),this.hide(),this.dispatchEvent(t)},{ConfirmDialog:r}}),define("orion/widgets/projects/RunBar",["orion/objects","i18n!orion/widgets/nls/messages","text!orion/widgets/projects/RunBar.html","orion/webui/littlelib","orion/i18nUtil","orion/webui/RichDropdown","orion/webui/tooltip","orion/metrics","orion/webui/dialogs/ConfirmDialog","orion/URITemplate","orion/PageLinks"],function(e,t,i,n,o,r,s,a,l,c,d){function h(e){this._project=null,this._parentNode=e.parentNode,this._serviceRegistry=e.serviceRegistry,this._commandRegistry=e.commandRegistry,this._fileClient=e.fileClient,this._progressService=e.progressService,this._preferencesService=e.preferencesService,this.statusService=e.statusService,this.actionScopeId=e.actionScopeId,this._projectCommands=e.projectCommands,this._projectClient=e.projectClient,this._preferences=e.preferences,this._editorInputManager=e.editorInputManager,this._initialize(),this._disableAllControls()}var u="RunBar",p="doNotConfirmRedeployRunningApp",f=3e4;return e.mixin(h.prototype,{_initialize:function(){if(this._domNode=n.createNodes(i),!this._domNode)throw new Error("this._domNode is null");this._parentNode.appendChild(this._domNode),this._undestroyedTooltips=[],this._playButton=n.$("button.playButton",this._domNode),this._boundPlayButtonListener=this._runBarButtonListener.bind(this,this._playButtonCommand),this._playButton.addEventListener("click",this._boundPlayButtonListener),this._stopButton=n.$("button.stopButton",this._domNode),this._boundStopButtonListener=this._runBarButtonListener.bind(this,"orion.launchConfiguration.stopApp"),this._stopButton.addEventListener("click",this._boundStopButtonListener);var e=this._commandRegistry.findCommand("orion.launchConfiguration.deploy");e.tooltip&&this._setNodeTooltip(this._playButton,e.tooltip);var o=this._commandRegistry.findCommand("orion.launchConfiguration.stopApp");o.tooltip&&this._setNodeTooltip(this._stopButton,o.tooltip),this._launchConfigurationDispatcher=this._projectCommands.getLaunchConfigurationDispatcher(),this._launchConfigurationEventTypes=["create","delete","changeState","deleteAll"],this._boundLaunchConfigurationListener=this._launchConfigurationListener.bind(this),this._launchConfigurationEventTypes.forEach(function(e){this._launchConfigurationDispatcher.addEventListener(e,this._boundLaunchConfigurationListener)},this),this._createLaunchConfigurationsDropdown(),this._boundLinkClickListener=this._linkClickListener.bind(this),this._appLink=n.$(".appLink",this._domNode),this._appLink.addEventListener("click",this._boundLinkClickListener),this._setNodeTooltip(this._appLink,t.openAppTooltip),this._disableLink(this._appLink),this._logsLink=n.$(".logsLink",this._domNode),this._logsLink.addEventListener("click",this._boundLinkClickListener),this._setNodeTooltip(this._logsLink,t.openLogsTooltip),this._disableLink(this._logsLink),this._editorInputManager.addEventListener("InputChanged",function(e){this._projectClient.getProject(e.metadata).then(function(e){this.setProject(e)}.bind(this))}.bind(this))},getProject:function(){return this._project},setProject:function(e){this._project!==e&&(this._project||e)&&(this._project&&e&&this._project.Location===e.Location||this.loadLaunchConfigurations(this._project=e))},_createLaunchConfigurationsDropdown:function(){this._launchConfigurationsWrapper=n.$(".launchConfigurationsWrapper",this._domNode),this._cachedLaunchConfigurations={};
var e,i=function(i){if(this._menuItemsCache&&this._menuItemsCache.length>0)this._menuItemsCache.forEach(function(e){i.appendChild(e)});else{this._menuItemsCache=[];var o,r,s,a=this._launchConfigurationsDropdown.getDropdown(),l=Object.keys(this._cachedLaunchConfigurations);l.sort(function(e,t){return this._cachedLaunchConfigurations[e].Name.localeCompare(this._cachedLaunchConfigurations[t].Name)}.bind(this)),l.forEach(function(t){this._cachedLaunchConfigurations.hasOwnProperty(t)&&(o=this._cachedLaunchConfigurations[t],r=a.appendMenuItem(this._getDisplayName(o)),r.classList.add("launchConfigurationMenuItem"),r.id=o.Name+"_RunBarMenuItem",o===this.getSelectedLaunchConfiguration()&&r.classList.add("dropdownMenuItemActive"),r.addEventListener("click",function(e){var t=this._cachedLaunchConfigurations[e],i=!0;t.status&&"PROGRESS"===t.status.State&&(i=!1),this.selectLaunchConfiguration(t,i)}.bind(this,t)),this._commandRegistry.registerCommandContribution(r.id,"orion.launchConfiguration.edit",1),this._commandRegistry.registerCommandContribution(r.id,"orion.launchConfiguration.delete",2),s=[],this._commandRegistry.renderCommands(r.id,r.firstChild,o,this,"tool",null,s),s.length>0&&(s[0].domNode.classList.add("launchConfigurationEditButton"),s.length>1&&(s[1].domNode.classList.remove("commandMargins"),s[1].domNode.classList.add("launchConfigurationDeleteButton"))),this._menuItemsCache.push(r),e=a.appendSeparator(),this._menuItemsCache.push(e))}.bind(this)),e=a.appendSeparator(),this._menuItemsCache.push(e);var c=a.appendMenuItem();c.id="CreateNew_RunBarMenuItem",this._menuItemsCache.push(c);var d=n.$(".dropdownMenuItem",c);d.classList.add("addNewMenuItem");var h=this._projectCommands.getDeployProjectCommands(this._commandRegistry)[0];h&&(this._commandRegistry.registerCommandContribution(c.id,h.id,1),s=[],this._commandRegistry.renderCommands(c.id,d,this._project,this,"button",null,s),s[0].domNode.textContent="+",this._setNodeTooltip(s[0].domNode,t.createNewTooltip))}}.bind(this);this._launchConfigurationsDropdown=new r.RichDropdown({parentNode:this._launchConfigurationsWrapper,populateFunction:i}),this._launchConfigurationsDropdownTriggerButton=this._launchConfigurationsDropdown.getDropdownTriggerButton(),this._launchConfigurationsDropdownTriggerButton.classList.remove("dropdownDefaultButton"),this._launchConfigurationsDropdownTriggerButton.classList.add("launchConfigurationsButton"),this._disableLaunchConfigurationsDropdown(),this._launchConfigurationsLabel=n.$(".dropdownTriggerButtonLabel",this._launchConfigurationsWrapper),this._appName=n.$(".appName",this._launchConfigurationsLabel),this._statusLight=n.$(".statusLight",this._launchConfigurationsLabel),this._appInfoSpan=n.$(".appInfoSpan",this._launchConfigurationsLabel),this._launchConfigurationsWrapper.removeChild(this._launchConfigurationsLabel),this._launchConfigurationsDropdown.setCustomTriggerButtonLabelNode(this._launchConfigurationsLabel),this._boundTriggerButtonEventListener=function(e){a.logEvent("ui","invoke",u+".launchConfigurationsDropdownTriggerButton.clicked",e.which)}.bind(this),this._launchConfigurationsDropdownTriggerButton.addEventListener("click",this._boundTriggerButtonEventListener)},destroy:function(){this._stopStatusPolling(),this._parentNode&&this._domNode&&(this._parentNode.removeChild(this._domNode),this._domNode=null,this._parentNode=null),this._undestroyedTooltips&&(this._undestroyedTooltips.forEach(function(e){e.destroy()},this),this._undestroyedTooltips=null),this._launchConfigurationEventTypes&&this._launchConfigurationEventTypes.forEach(function(e){this._launchConfigurationDispatcher.removeEventListener(e,this._boundLaunchConfigurationListener)},this),this._playButton&&(this._playButton.removeEventListener("click",this._boundPlayButtonListener),this._playButton=null),this._stopButton&&(this._stopButton.removeEventListener("click",this._boundStopButtonListener),this._stopButton=null),this._launchConfigurationsDropdown&&(this._launchConfigurationsDropdownTriggerButton&&this._boundTriggerButtonEventListener&&(this._launchConfigurationsDropdownTriggerButton.removeEventListener("click",this._boundTriggerButtonEventListener),this._launchConfigurationsDropdownTriggerButton=null),this._launchConfigurationsDropdown.destroy(),this._launchConfigurationsDropdown=null),this._appLink&&(this._appLink.removeEventListener("click",this._boundLinkClickListener),this._appLink=null),this._logsLink&&(this._logsLink.removeEventListener("click",this._boundLinkClickListener),this._logsLink=null)},_launchConfigurationListener:function(e){var t=e.newValue;if("changeState"===e.type&&t)this._updateLaunchConfiguration(t);else if(this._menuItemsCache=[],"create"===e.type&&t)this._putInLaunchConfigurationsCache(t),this.selectLaunchConfiguration(t,!0);else if("delete"===e.type){var i=e.oldValue.File;for(var n in this._cachedLaunchConfigurations)if(this._cachedLaunchConfigurations.hasOwnProperty(n)){var o=this._cachedLaunchConfigurations[n];if(o.File.Location===i.Location){o===this._selectedLaunchConfiguration&&this.selectLaunchConfiguration(null);var r=document.getElementById(o.Name+"_RunBarMenuItem");if(r){var s=r.parentNode,a=r.previousSibling;a&&"dropdownSeparator"===a.className&&s.removeChild(a),s.removeChild(r)}this._removeFromLaunchConfigurationsCache(o);break}}}else"deleteAll"===e.type&&(this._cacheLaunchConfigurations([]),this.selectLaunchConfiguration(null))},selectLaunchConfiguration:function(e,t){var i=function(e){this.setStatus({error:e||!0})}.bind(this);if(e)if(this._selectedLaunchConfiguration=e,this._setLaunchConfigurationsLabel(e),t){this._displayStatusCheck(e);var n=Date.now();this._checkLaunchConfigurationStatus(e).then(function(t){var i=Date.now()-n;a.logTiming("deployment","check status (launch config)",i,e.Type),e.status=t,this._updateLaunchConfiguration(e)}.bind(this),i)}else e.status&&this.setStatus(e.status);else this._stopStatusPolling(),this._selectedLaunchConfiguration=null,this._setLaunchConfigurationsLabel(null),this.setStatus({});this._menuItemsCache=[]},_displayStatusCheck:function(e){var i=this._getDisplayName(e),n=o.formatMessage(t.checkingStateMessage,i);this.setStatus({State:"PROGRESS",Message:n,ShortMessage:t.checkingStateShortMessage,Url:e.status&&e.status.Url?e.status.Url:null})},_updateLaunchConfiguration:function(e){var t=this._getHash(e),i=this._getHash(this._selectedLaunchConfiguration);if(t===i){var n=e.status&&e.status.CheckState;this.selectLaunchConfiguration(e,n)}this._putInLaunchConfigurationsCache(e)},_checkLaunchConfigurationStatus:function(e){return this._projectClient.getProjectDeployService(e.ServiceId,e.Type).then(function(t){return t&&t.getState?t.getState(e).then(function(e){return e}.bind(this),function(t){e.status={error:t},t.Retry?(e.parametersRequested=e.status.error.Retry.parameters,e.optionalParameters=e.status.error.Retry.optionalParameters,this._commandRegistry.runCommand("orion.launchConfiguration.checkStatus",e,this,null,null,this._statusLight)):(t.Alert&&t.Alert===!0&&this._progressService.setProgressResult(t.Message),this._launchConfigurationDispatcher.dispatchEvent({type:"changeState",newValue:e}))}.bind(this)):void 0}.bind(this))},setStatus:function(e){var t=null,i="",n=null,o=null,r=null,s=this._getDisplayName(this._selectedLaunchConfiguration),a=this._getAppInfoText(e);if(r=e&&e.logLocationTemplate||this._selectedLaunchConfiguration&&this._selectedLaunchConfiguration.Params&&this._selectedLaunchConfiguration.Params.LogLocationTemplate,this._statusLight.classList.remove("statusLightGreen"),this._statusLight.classList.remove("statusLightRed"),this._statusLight.classList.remove("statusLightProgress"),this._setText(this._appInfoSpan,null),e.Info&&"Deploying"===e.Info?(this._disableControl(this._playButton),this._disableControl(this._stopButton)):this._disableAllControls(),e){if(e.error)this._enableControl(this._playButton),e.error.Retry||e.error.Message&&(t=e.error.Message);else{switch(e.State){case"PROGRESS":this._statusLight.classList.add("statusLightProgress"),this._stopStatusPolling();break;case"STARTED":this._enableControl(this._playButton),this._enableControl(this._stopButton),this._statusLight.classList.add("statusLightGreen");break;case"STOPPED":this._enableControl(this._playButton),this._statusLight.classList.add("statusLightRed")}t=e.Message}e.error||"PROGRESS"===e.State||this._startStatusPolling()}if(s&&(i=s,a&&(i+=" ("+a+")"),a!==t&&t&&(i+=" : "+t)),this._setNodeTooltip(this._launchConfigurationsDropdownTriggerButton,i),a?this._setText(this._appInfoSpan,"("+a+")"):this._setText(this._appInfoSpan,null),this._project)if(e&&e.Url&&this._enableLink(this._appLink,e.Url),r)n=new c(r),o={OrionHome:d.getOrionHome(),Name:"",Target:{launchConfLocation:this._selectedLaunchConfiguration.File.Location}},this._enableLink(this._logsLink,n.expand(o));else{var l=this._serviceRegistry.getService("orion.project.deploy");l.getLogLocationTemplate&&l.getLogLocationTemplate(this._selectedLaunchConfiguration).then(function(e){n=new c(e);var t=this._selectedLaunchConfiguration?this._selectedLaunchConfiguration.File.Location:"";o={OrionHome:d.getOrionHome(),Name:"",Target:{launchConfLocation:t}},this._enableLink(this._logsLink,n.expand(o))}.bind(this))}},_getAppInfoText:function(e){var i="";if(e)if(e.error)i=e.error.Retry?e.ShortMessage||t.appInfoUnknown:e.ShortMessage||e.error.Message||t.appInfoError;else switch(e.State){case"PROGRESS":(e.ShortMessage||e.Message)&&(i=e.ShortMessage||e.Message);break;case"STARTED":i=t.appInfoRunning;break;case"STOPPED":i=t.appInfoStopped}return i},loadLaunchConfigurations:function(e){e?this._projectClient.getProjectLaunchConfigurations(e).then(function(t){e===this._project&&this._setLaunchConfigurations(t)}.bind(this)):this._setLaunchConfigurations(null)},_setLaunchConfigurations:function(e){if(e?(this._enableLaunchConfigurationsDropdown(),e.sort(function(e,t){return e.Name.localeCompare(t.Name)})):this._disableLaunchConfigurationsDropdown(),this._cacheLaunchConfigurations(e),e&&e[0]){var t=this._getHash(e[0]),i=this._cachedLaunchConfigurations[t];this.selectLaunchConfiguration(i,!0)}else this.selectLaunchConfiguration(null)},_cacheLaunchConfigurations:function(e){this._cachedLaunchConfigurations={},e&&e.forEach(function(e){this._putInLaunchConfigurationsCache(e)},this)},_getHash:function(e){var t=null;return e&&(t=e.Name+":"+e.ServiceId),t},_putInLaunchConfigurationsCache:function(e){var t=this._getHash(e);e.project||(e.project=this._project),this._cachedLaunchConfigurations[t]=e},_removeFromLaunchConfigurationsCache:function(e){var t=this._getHash(e);delete this._cachedLaunchConfigurations[t]},_runBarButtonListener:function(e,t){var i=t.target,n=i.id,o=this._isEnabled(i),r=o?"":".disabled";a.logEvent("ui","invoke",u+"."+n+".clicked"+r,t.which),o&&("function"==typeof e?e.call(this,i):this._commandRegistry.runCommand(e,this._selectedLaunchConfiguration,this,null,null,i))},getSelectedLaunchConfiguration:function(){return this._selectedLaunchConfiguration},_disableAllControls:function(){this._disableControl(this._playButton),this._disableControl(this._stopButton),this._disableLink(this._appLink),this._disableLink(this._logsLink)},_enableControl:function(e){e.classList.remove("disabled")},_disableControl:function(e){e.classList.add("disabled")},_isEnabled:function(e){return!e.classList.contains("disabled")},_enableLink:function(e,t){e.href=t,this._enableControl(e)},_disableLink:function(e){e.removeAttribute("href"),this._disableControl(e)},_isLinkDisabled:function(e){return!e.hasAttribute("href")||!e.href},_linkClickListener:function(e){var t=e.target,i=t.id,n=this._isLinkDisabled(t)?".disabled":"";a.logEvent("ui","invoke",u+"."+i+".clicked"+n,e.which)},_setNodeTooltip:function(e,t){var i=-1;e.tooltip&&(e.tooltip.destroy(),i=this._undestroyedTooltips.indexOf(e.tooltip),-1!==i&&this._undestroyedTooltips.splice(i,1)),t&&(e.tooltip=new s.Tooltip({node:e,text:t,trigger:"mouseover",position:["above","below","right","left"]}),this._undestroyedTooltips.push(e.tooltip))},_setText:function(e,t){if(n.empty(e),t){var i=document.createTextNode(t);e.appendChild(i)}},_getDisplayName:function(e){if(!e)return null;var i=e.Name;return i&&"default"!==i||(i=e.Params.Name,e.Params.Target&&e.Params.Target.Space&&(i+=t.displayNameSeparator+e.Params.Target.Space,e.Params.Target.Org&&(i+=" / "+e.Params.Target.Org))),i},_setLaunchConfigurationsLabel:function(e){if(e){var i=this._getDisplayName(e);n.empty(this._launchConfigurationsLabel),this._setText(this._appName,i),this._setText(this._appInfoSpan,null),this._launchConfigurationsLabel.appendChild(this._statusLight),this._launchConfigurationsLabel.appendChild(this._appName),this._launchConfigurationsLabel.appendChild(this._appInfoSpan)}else this._setText(this._launchConfigurationsLabel,this._project?t.selectLaunchConfig:null)},_playButtonCommand:function(e){var i=this._selectedLaunchConfiguration,n=function(){this._commandRegistry.runCommand("orion.launchConfiguration.deploy",i,this,null,null,e)}.bind(this),r=function(){this._updateLaunchConfiguration(i)}.bind(this);this._preferences.get("/RunBar").then(function(e){var s=e[p];if(s)n();else{this._displayStatusCheck(i);var l=Date.now();this._checkLaunchConfigurationStatus(i).then(function(e){var s=Date.now()-l;a.logTiming("deployment","check status (deploy)",s,i.Type);var c=t.redeployConfirmationDialogTitle,d=this._getDisplayName(i),h=o.formatMessage(t.redeployConfirmationDialogMessage,d);i.status=e,e&&"STARTED"===e.State?this._confirmBeforeRedeploy(c,h,p,n,r):n()}.bind(this),n)}}.bind(this))},_confirmBeforeRedeploy:function(e,i,n,o,r){var s=new l.ConfirmDialog({title:e,confirmMessage:i,checkboxMessage:t.redeployConfirmationDialogCheckboxMessage}),a=function(e){var t=e.value,i=e.checkboxValue;if(i){var s={};s[n]=!0,this._preferences.put("/RunBar",s)}t?o():r()}.bind(this);s.addEventListener("dismiss",a),s.show()},_enableLaunchConfigurationsDropdown:function(){this._enableControl(this._launchConfigurationsWrapper),this._launchConfigurationsDropdownTriggerButton.disabled=!1},_disableLaunchConfigurationsDropdown:function(){this._disableControl(this._launchConfigurationsWrapper),this._launchConfigurationsDropdownTriggerButton.disabled=!0},_startStatusPolling:function(){this._statusPollingIntervalID||(this._statusPollingIntervalID=window.setInterval(function(){var e=this._selectedLaunchConfiguration;if(!e)return void this._stopStatusPolling();var t=Date.now();this._checkLaunchConfigurationStatus(e).then(function(i){var n=Date.now()-t;a.logTiming("deployment","check status (poll)",n,e.Type),e.status=i,this._updateLaunchConfiguration(e)}.bind(this))}.bind(this),f))},_stopStatusPolling:function(){this._statusPollingIntervalID&&(window.clearInterval(this._statusPollingIntervalID),this._statusPollingIntervalID=null)}}),{RunBar:h,METRICS_LABEL_PREFIX:u}}),define("orion/widgets/projects/nls/messages",{root:!0,de:!0,es:!0,fr:!0,it:!0,ja:!0,ko:!0,"pt-br":!0,zh:!0,"zh-hk":!0,"zh-tw":!0}),define("orion/widgets/projects/nls/root/messages",{"Live Edit":"Live Edit:",restartAppTooltip:"Restart the App Without Redeploying",deployAppTooltip:"Deploy the application in live edit mode",appInfoProd:"running: normal",appInfoDebug:"running: live edit",appInfoDebugStopped:"stopped: live edit",liveEditOnTooltip:"Turn On Live Edit and Redeploy the App.",liveEditOffTooltip:"Turn Live Edit mode OFF and redeploy your application.",debugLinkTooltip:"Open the Debug Tools",dashboardLinkTooltip:"Open the App Overview in Bluemix",liveEditConfirmationDialogTitle:"Redeploy?",liveEditOnConfirmationMessage:"Your application ${0} will be re-deployed to enable Live Edit mode. This may take a couple of minutes.",liveEditOffConfirmationMessage:"Your application ${0} will be re-deployed to disable Live Edit mode. This may take a couple of minutes.",notSynchronizedTooltip:"Press the Play button to resynchronize the application and continue in Live Edit mode.",cannotEditManifest:"You cannot edit ${0} becasue it's a configuration file. If you wish to edit the file please turn off Live Edit and redploy the app with newly edited configuration file.",cannotEditLaunchConf:"You cannot edit ${0}.launch becasue it's a configuration file. If you wish to edit the file please turn off Live Edit and redploy the app with newly edited configuration file."}),define("text!orion/widgets/projects/LiveUpdateBar.html",[],function(){return'<a id="liveEditBarDashboardLink" class="runBarLink dashboardLink core-sprite-dashboard" target="_blank"></a>\n<div class="liveUpdateBarWrapper">\n	<span class="runBarSeparator"></span>\n	<span class="liveUpdateLabel"></span>\n	<div id="liveEditSwitchWrapper" class="liveEditSwitchWrapper"></div>\n	<button id="liveEditBarRestartButton" class="runBarButton core-sprite-restart restartButton"></button>\n	<a id="liveEditBarDebugLink" class="runBarLink debugLink core-sprite-debug" target="_blank"></a>\n</div>'}),define("orion/widgets/projects/LiveUpdateBar",["orion/objects","orion/widgets/projects/RunBar","i18n!orion/widgets/projects/nls/messages","text!orion/widgets/projects/LiveUpdateBar.html","orion/webui/littlelib","orion/commands","orion/metrics","orion/i18nUtil"],function(e,t,i,n,o,r,s,a){function l(e){t.RunBar.call(this,e)}var c="doNotConfirmRedeployLiveEdit";return l.prototype=Object.create(t.RunBar.prototype),l.prototype.constructor=l,e.mixin(l.prototype,{_initialize:function(){t.RunBar.prototype._initialize.call(this);var e=o.createNodes(n);if(!e||2!==e.length){var s=new Error("top level nodes did not get created properly");throw console.error(s),s}this._dashboardLink=e[0],this._liveUpdateBarWrapper=e[1],this._domNode.appendChild(this._dashboardLink),this._liveUpdateLabel=o.$(".liveUpdateLabel",this._liveUpdateBarWrapper),this._liveUpdateLabel.appendChild(document.createTextNode(i["Live Edit"])),this._liveUpdateSwitchNode=o.$(".liveEditSwitchWrapper",this._liveUpdateBarWrapper),this._restartButton=o.$("button.restartButton",this._liveUpdateBarWrapper),this._debugLink=o.$(".debugLink",this._liveUpdateBarWrapper),this.switchLiveEditCommand=new r.Command({name:"switchLiveEditCommand",imageClass:"sprite-switch-liveUpdate",id:"orion.projects.switchLiveEdit",groupId:"orion.projectsGroup",type:"switch",visibleWhen:function(){return!0},callback:function(e){var t=e.items;this.switchLiveEdit(t)}.bind(this)}),this._commandRegistry.addCommand(this.switchLiveEditCommand),this._commandRegistry.registerCommandContribution(this._liveUpdateSwitchNode.id,this.switchLiveEditCommand.id,1),this._boundRestartButtonListener=this._runBarButtonListener.bind(this,"orion.launchConfiguration.startApp"),this._restartButton.addEventListener("click",this._boundRestartButtonListener),this._setNodeTooltip(this._restartButton,i.restartAppTooltip),this._disableControl(this._restartButton),this._debugLink.addEventListener("click",this._boundLinkClickListener),this._setNodeTooltip(this._debugLink,i.debugLinkTooltip),this._disableLink(this._debugLink),this._dashboardLink.addEventListener("click",this._boundLinkClickListener),this._setNodeTooltip(this._dashboardLink,i.dashboardLinkTooltip),this._disableLink(this._dashboardLink)},destroy:function(){t.RunBar.prototype.destroy.call(this),this._debugLink&&(this._boundLinkClickListener&&this._debugLink.removeEventListener("click",this._boundLinkClickListener),this._debugLink=null),this._dashboardLink&&(this._boundLinkClickListener&&this._dashboardLink.removeEventListener("click",this._boundLinkClickListener),this._dashboardLink=null),this._restartButton&&(this._boundRestartButtonListener&&this._restartButton.removeEventListener("click",this._boundRestartButtonListener),this._restartButton=null),this._liveUpdateSwitchNode&&this._commandRegistry.unregisterCommandContribution(this._liveUpdateSwitchNode.id,"orion.projects.switchLiveEdit")},setStatus:function(e){t.RunBar.prototype.setStatus.call(this,e),this._statusLight.classList.remove("statusLightAmber");var n=this.getSelectedLaunchConfiguration();if(e.Info&&"Deploying"==e.Info&&(this._disableLink(this._debugLink),this._disableControl(this._restartButton),this._disableControl(this._liveUpdateLabel),this._disableSwitch(this._liveUpdateSwitchNode)),e&&!e.error){var o=null;switch(e.State){case"STARTED":this._isInDevMode(n)&&(this._isRunningInDevMode(n)||(this._statusLight.classList.remove("statusLightGreen"),this._statusLight.classList.add("statusLightAmber"),"not synchronized"===e.DevMode.state&&this._setNodeTooltip(this._launchConfigurationsDropdownTriggerButton,i.notSynchronizedTooltip)),this._enableControl(this._restartButton),e.Url&&(o=e.Url+"/bluemix-debug/manage/",this._enableLink(this._debugLink,o))),this._enableControl(this._liveUpdateLabel),this._enableSwitch(this._liveUpdateSwitchNode);break;case"STOPPED":this._enableControl(this._liveUpdateLabel),this._enableSwitch(this._liveUpdateSwitchNode)}}if(e.ManageUrl?this._enableLink(this._dashboardLink,e.ManageUrl):this._selectedLaunchConfiguration&&this._selectedLaunchConfiguration.status&&this._selectedLaunchConfiguration.status.ManageUrl&&this._enableLink(this._dashboardLink,this._selectedLaunchConfiguration.status.ManageUrl),e&&(!e.State||"PROGRESS"!==e.State)&&(this._domNode.contains(this._liveUpdateBarWrapper)&&(this._domNode.removeChild(this._liveUpdateBarWrapper),this._domNode.classList.remove("hideRightBorder")),this._commandRegistry.destroy(this._liveUpdateSwitchNode),n&&this._supportsDevMode(n))){var r=this._isInDevMode(n);this.switchLiveEditCommand.checked=r,this.switchLiveEditCommand.tooltip=r?i.liveEditOffTooltip:i.liveEditOnTooltip,this._commandRegistry.renderCommands(this._liveUpdateSwitchNode.id,this._liveUpdateSwitchNode,n,this,"button"),this._domNode.appendChild(this._liveUpdateBarWrapper),this._domNode.classList.add("hideRightBorder");var s=document.getElementById("editor");this.enableReadOnly=function(){var e,t=this._projectExplorer.editorInputManager.inputManager.getLocation(),n=this.getSelectedLaunchConfiguration(),o=this._projectExplorer.editorInputManager.inputManager,r=o.editor;r.getTextView&&(e=r.getTextView(),null!=n&&this._supportsDevMode(n)&&this._isInDevMode(n)?(""==n.Path&&(n.Path="manifest.yml"),-1!==t.indexOf(n.Path)?(e._readonly=!0,this._progressService.setProgressResult(a.formatMessage(i.cannotEditManifest,n.Path))):-1!==t.indexOf(n.Name+".launch")&&(e._readonly=!0,this._progressService.setProgressResult(a.formatMessage(i.cannotEditLaunchConf,n.Name)))):e._readonly=!1)}.bind(this);var l=function(e){var t=this.getSelectedLaunchConfiguration();null!=t&&this._supportsDevMode(t)&&this._isInDevMode(t)&&(nodeArray=[].slice.call(e.currentTarget.nextSibling.childNodes),nodeArray.forEach(function(e){if(-1!==e.id.indexOf(t.Name+"_RunBarMenuItem")){var i=e.getElementsByTagName("button");i[0].children[0]&&i[0].removeChild(i[0].children[0]),i[1].children[0]&&i[1].removeChild(i[1].children[0])}}.bind(this)))}.bind(this);this.editorEvent||(this.editorEvent=!0,s.addEventListener("keydown",this.enableReadOnly,!1),this._launchConfigurationsDropdownTriggerButton.addEventListener("click",function(e){l(e)}.bind(this)))}},_getAppInfoText:function(e){var n="",o=this.getSelectedLaunchConfiguration();if(e&&e.State&&"STARTED"===e.State)if(this._isInDevMode(o))if(this._isRunningInDevMode(o))n=i.appInfoDebug;else{var r=o.status.DevMode.state;n="stop"===r?i.appInfoDebugStopped:r}else n=i.appInfoProd;else n=t.RunBar.prototype._getAppInfoText.call(this,e);return n},_disableAllControls:function(){t.RunBar.prototype._disableAllControls.call(this),this._disableLink(this._debugLink),this._disableLink(this._dashboardLink),this._disableControl(this._restartButton),this._disableControl(this._liveUpdateLabel),this._disableSwitch(this._liveUpdateSwitchNode)},_disableSwitch:function(e){this._disableControl(e);var t=o.$("input.orionSwitchCheck",e);t&&t.setAttribute("disabled","true")},_enableSwitch:function(e){this._enableControl(e);var t=o.$("input.orionSwitchCheck",e);t&&t.removeAttribute("disabled")},_supportsDevMode:function(e){return e.Type&&"Cloud Foundry"===e.Type&&e.Params.DevMode},_isInDevMode:function(e){return this._supportsDevMode(e)&&e.status&&e.status.DevMode},_isRunningInDevMode:function(e){return this._isInDevMode(e)&&"start"===e.status.DevMode.state},switchLiveEdit:function(e){e.Params.DevMode.On=this._isInDevMode(e)?!1:!0;var i=e.Params.DevMode.On?"on":"off";s.logEvent("ui","invoke",t.METRICS_LABEL_PREFIX+".liveEditSwitch.clicked."+i),this._redeploy(e)},_redeploy:function(e){var t=function(){this._commandRegistry.runCommand("orion.launchConfiguration.deploy",e,this,null,null,this._liveUpdateSwitchNode)}.bind(this),n=function(){e.Params.DevMode.On=!e.Params.DevMode.On,this._updateLaunchConfiguration(e)}.bind(this);this._preferences.get("/RunBar").then(function(o){var r=c,s=i.liveEditConfirmationDialogTitle,l=this._getDisplayName(e),d=e.Params.DevMode.On?i.liveEditOnConfirmationMessage:i.liveEditOffConfirmationMessage;d=a.formatMessage(d,l);var h=o[r];h?t():this._confirmBeforeRedeploy(s,d,r,t,n)}.bind(this))}}),{LiveUpdateBar:l}}),define("orion/customGlobalCommands",["orion/webui/littlelib","orion/widgets/UserMenu","orion/webui/dropdown","orion/commands","orion/Deferred","orion/xhr","orion/jazzui/widgets/input/CaretDropDownMenu","orion/widgets/input/ActivityContent","orion/widgets/input/ToolsContent","orion/PageUtil","orion/jazzui/pageUtil","orion/projectCommands","orion/jazzui/projectCommands","orion/URITemplate","orion/URL-shim","require","orion/widgets/projects/RunBar","orion/widgets/projects/LiveUpdateBar","text!jconfig/jazzhuburl"],function(e,t,i,n,o,r,s,a,l,c,d,h,u,p,f,g,m,v,_){function y(e,t){var i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",e.href),t&&i.setAttribute("id",t),document.getElementsByTagName("head")[0].appendChild(i)}function C(e,t){var i=new o,n=document.createElement("script");return t&&(n.id=t),n.type="text/javascript",n.onload=i.resolve,n.onerror=i.reject,n.src=e.href,n.async=!0,document.getElementsByTagName("head")[0].appendChild(n),i.promise}function w(){function e(){var t=document.querySelector("#sideMenu .sideMenuHome");return t?(t.innerHTML="",void t.appendChild(i)):void setTimeout(e,100)}var t=document.querySelector(".jh-togglecontainer .togglebutton-selected");if(t&&(t.parentElement.onclick=function(){return!1}),t=document.querySelector(".mainToolbar .-jazzhub-project-secondary-navbar .project-icon-link")){var i=document.createElement("div");i.classList.add("-jazzhub-project-secondary-navbar"),i.classList.add("corner-project-icon-link"),i.appendChild(t),e()}}function b(e,t,i){var o=[];return i.userId&&i.projectName&&t.forEach(function(t){var r=t.command;t.relatedLink.jazzProjectContext&&(t.invocation=new n.CommandInvocation(i,i,null,r,e),o.push(t))}),o}function S(e,t){N=t}function x(e,t,i,n){function o(e){s.setRelatedLinks(t.concat(e||[]),n)}var s=this.sideMenu;if(!s)return void O.resolve();var a=this.jazzProjectContext;if(!a)return o(null),void O.resolve();var l=a.projectName;if(a.JazzHubURL=_,!l)return o(null),void O.resolve();var c=P.expand({params:{projectName:l,includeMembers:!1,refresh:!0}});r("GET",c).then(null,function(){return null}).then(function(t){t=t||{};var n;try{var r=JSON.parse(t.response);r.isBlueMixProject?(a.baseProjectName=r.projectName,n=b(e,i,a),O.resolve()):O.reject()}catch(s){O.resolve()}finally{o(n)}})}function L(e){var t="",i=e.target||e.breadcrumbTarget;if(i)if(i.JazzHub&&i.JazzHub.Project)t=i.JazzHub.Project;else if(i.Jazz&&i.Jazz.Project)t=i.Jazz.Project;else if(i.SandboxLocation&&i.Name)t=i.Name;else if(i.projectName)t=i.projectName;else{var n=new URL(window.location.href);t=n.query.get("debug_projectName")||""}if(t!==M){M=t;var o=document.getElementById("secondary-nav");if(""===t)o&&(o.innerHTML=""),w();else{if(!o){var r=document.getElementById("pageToolbar");o=document.createElement("div"),o.id="secondary-nav",o.classList.add("seconday-nav"),r.appendChild(o)}I.query.set("name",t.replace(" | ","/")),I.query.set("no-cache",String(+new Date)),C(I).then(w)}}this.jazzProjectContext={projectName:t,userId:t.match(/\w*/)[0]}}function T(e,t,i){u.createProjectCommands(i,e,t,null,"pageActions","selectionTools");var n=c.matchResourceParameters(),o={};for(var r in n)-1!=r.indexOf("createProject")&&(o[r.replace("createProject.","")]=n[r]);if("undefined"!=typeof n["createProject.name"]){if(localStorage.sidebarActiveViewModeId="projectNav","undefined"==typeof n.cloneGit)return t.runCommand("com.ibm.team.scm.orion.command.createProject",o,null,null);var s={url:n.cloneGit,projectDescription:o};return t.runCommand("com.ibm.team.scm.orion.command.createGitProject",s,null,null)}t.processURL(window.location.href)}function E(e,t,i,n,o,r,s,a,l){var c=!document.getElementById("navbar.js");return c&&y(R,"navbar.css"),y(D),c&&C(A,"navbar.js"),d.addPageLinks(t,i),w(),"orion-editor"===e?T(t,i,l):void 0}function k(e){return(new o).resolve().then(function(){return new v.LiveUpdateBar(e)})}var N,A=new URL("/api/v1/composition/js/header/navbar.js",_),R=new URL("/api/v1/composition/css/header/navbar.css",_),I=new URL("/embed/js/project-secondary-navbar?name=&e=secondary-nav&icon=&context=orion&projectnamelink=",_),D=new URL("/embed/css/project-secondary-navbar-orion",_),P=new p(_+"manage/service/com.ibm.team.jazzhub.common.service.IProjectService/projectByName{?params*}"),M="",O=new o;return{createMenuGenerator:S,addRelatedLinkCommands:x,afterSetPageTarget:L,afterGenerateBanner:E,createRunBar:k}}),define("orion/webui/SideMenu",["i18n!orion/nls/messages","orion/webui/littlelib","orion/PageUtil","orion/URL-shim"],function(e,t,i){function n(e,i){if(this._parentNode=t.node(e),!this._parentNode)throw new Error("Missing parentNode");this._contentNode=t.node(i),this._categoryInfos=[],this._categorizedPageLinks={},this._categorizedRelatedLinks={},this._categorizedAnchors=null,this._state=localStorage.getItem(o)||a,this._currentCategory="",this._notificationTimeout=null,this._renderTimeout=null}var o="sideMenuNavigation",r="open",s="closed",a=r,l=301;return n.prototype={constructor:n.prototype.constructor,setCategories:function(e){this._categoryInfos=e.getCategoryIDs().map(function(t){return e.getCategory(t)}).sort(function(e,t){var i=e.order||100,n=t.order||100;return n>i?-1:i>n?1:e.textContent.localeCompare(t.textContent)})},setPageLinks:function(e){this._categorizedPageLinks={},e.getAllLinks().forEach(function(e){var t=e.category;this._categorizedPageLinks[t]=this._categorizedPageLinks[t]||[],this._categorizedPageLinks[t].push({title:e.textContent,order:e.order||100,href:e.href})},this)},setRelatedLinks:function(e,t){this._categorizedRelatedLinks={},e.forEach(function(e){var i=e.relatedLink,n=e.command,o=e.invocation;if(!t||-1===t.indexOf(i.id)){var r=i.category;this._categorizedRelatedLinks[r]=this._categorizedRelatedLinks[r]||[],this._categorizedRelatedLinks[r].push({title:n.name,order:i.order||100,href:n.hrefCallback.call(o.handler,o)})}},this),this._updateCategoryAnchors(),this._updateCategoryNotifications()},render:function(){if(null===this._categorizedAnchors){this._categorizedAnchors={};var i=new URL(window.location.href);i.hash="",this._currentCategory="",Object.keys(this._categorizedPageLinks).some(function(e){var t=this._categorizedPageLinks[e];return t.some(function(e){var t=new URL(e.href);return e.hash="",i.href===t.href})?(this._currentCategory=e,!0):void 0},this);var o=document.createElement("div");o.classList.add("sideMenuHome"),this._sideMenuHome=o;var r=document.createElement("ul");r.classList.add("sideMenuList"),r.setAttribute("role","navigation"),r.setAttribute("aria-label",e.navigationBar),this._sideMenuList=r,this._categoryInfos.forEach(function(e){var t=document.createElement("li");t.classList.add("sideMenuItem"),t.classList.add("sideMenu-notification"),this._currentCategory===e.id&&t.classList.add("sideMenuItemActive"),t.categoryId=e.id,t.categoryName=e.textContent||e.id;var i=document.createElement("a");if(i.classList.add("submenu-trigger"),"string"==typeof e.imageDataURI&&0===e.imageDataURI.indexOf("data:image")){var n=document.createElement("img");
n.width="16",n.height="16",n.src=e.imageDataURI,i.appendChild(n)}else{var o=e.imageClass||"core-sprite-blank-menu-item";i.classList.add(o)}t.appendChild(i),r.appendChild(t),this._categorizedAnchors[e.id]=i},this),this._topScrollButton=document.createElement("button"),this._topScrollButton.classList.add("sideMenuScrollButton"),this._topScrollButton.classList.add("sideMenuTopScrollButton"),this._topScrollButton.classList.add("core-sprite-openarrow"),this._topScrollButton.addEventListener("mousedown",function(){this._activeScrollInterval&&window.clearInterval(this._activeScrollInterval),this._activeScrollInterval=window.setInterval(this._scrollUp.bind(this),10)}.bind(this)),this._topScrollButton.addEventListener("mouseup",function(){this._activeScrollInterval&&(window.clearInterval(this._activeScrollInterval),this._activeScrollInterval=null)}.bind(this)),this._bottomScrollButton=document.createElement("button"),this._bottomScrollButton.classList.add("sideMenuScrollButton"),this._bottomScrollButton.classList.add("sideMenuBottomScrollButton"),this._bottomScrollButton.classList.add("core-sprite-openarrow"),this._bottomScrollButton.addEventListener("mousedown",function(){this._activeScrollInterval&&window.clearInterval(this._activeScrollInterval),this._activeScrollInterval=window.setInterval(this._scrollDown.bind(this),10)}.bind(this)),this._bottomScrollButton.addEventListener("mouseup",function(){this._activeScrollInterval&&(window.clearInterval(this._activeScrollInterval),this._activeScrollInterval=null)}.bind(this)),window.addEventListener("resize",function(){this._updateScrollButtonVisibility()}.bind(this)),this._updateCategoryAnchors(),this._show=function(){this._parentNode.appendChild(o),this._parentNode.appendChild(this._topScrollButton),this._parentNode.appendChild(r),this._parentNode.appendChild(this._bottomScrollButton);var e=t.$(".sideMenuItemActive",this._parentNode);e&&e.scrollIntoView&&e.scrollIntoView(),this._updateScrollButtonVisibility(),this._show=n.prototype._show},window.setTimeout(function(){this._show()}.bind(this),1e3)}this._state===s?(this._contentNode.classList.add("content-sideMenu-closed"),this._renderTimeout&&(window.clearTimeout(this._renderTimeout),this._renderTimeout=null),this._renderTimeout=window.setTimeout(function(){this._parentNode.classList.add("sideMenu-closed"),this._renderTimeout=null}.bind(this),l),this._parentNode.classList.add("animating")):(this._renderTimeout&&(window.clearTimeout(this._renderTimeout),this._renderTimeout=null),this._parentNode.classList.remove("animating"),this._parentNode.classList.remove("sideMenu-closed"),this._contentNode.classList.remove("content-sideMenu-closed"))},_updateScrollButtonVisibility:function(){this._sideMenuList.scrollHeight>this._sideMenuList.offsetHeight?(0<this._sideMenuList.scrollTop?this._topScrollButton.classList.add("visible"):this._topScrollButton.classList.remove("visible"),this._sideMenuList.scrollHeight>this._sideMenuList.scrollTop+this._sideMenuList.offsetHeight?this._bottomScrollButton.classList.add("visible"):this._bottomScrollButton.classList.remove("visible")):(this._topScrollButton.classList.remove("visible"),this._bottomScrollButton.classList.remove("visible"))},_scrollDown:function(){this._sideMenuList.scrollTop=this._sideMenuList.scrollTop+1,this._updateScrollButtonVisibility()},_scrollUp:function(){this._sideMenuList.scrollTop=this._sideMenuList.scrollTop-1,this._updateScrollButtonVisibility()},hide:function(){localStorage.setItem(o,s),this._parentNode.classList.add("sideMenu-closed"),this._contentNode.classList.add("content-sideMenu-closed")},toggle:function(){var e=this._contentNode;e&&e.classList.add("content-fixedHeight-animation"),this._state=this._state===r?s:r,this._state===a?localStorage.removeItem(o):localStorage.setItem(o,this._state),this.render()},_updateCategoryAnchors:function(){var e=[];Object.keys(this._categorizedRelatedLinks).forEach(function(t){("git"===t||t.match(/-scm$/))&&e.push(t)}),Object.keys(this._categorizedAnchors).forEach(function(t){var i=this._categorizedAnchors[t],n=[];if(t===this._currentCategory)return i.parentElement.style.display="",i.href="",i.onclick=function(){return!1},void(i.title=i.parentElement.categoryName);if(this._categorizedPageLinks[t]&&n.push.apply(n,this._categorizedPageLinks[t]),this._categorizedRelatedLinks[t]&&n.push.apply(n,this._categorizedRelatedLinks[t]),0===n.length||0!==e.length&&("git"===t||t.match(/-scm$/))&&-1===e.indexOf(t))i.href="",i.title=i.parentElement.categoryName,i.parentElement.style.display="none";else{i.parentElement.style.display="",n.sort(function(e,t){return e.order<t.order?-1:t.order<e.order?1:e.title.localeCompare(t.title)});var o=n.shift();i.href=o.href,i.title=o.title}},this),this._show()},_updateCategoryNotifications:function(){clearTimeout(this._notificationTimeout),this._notificationTimeout=setTimeout(this._updateCategoryNotifications.bind(this),3e5);var e=i.matchResourceParameters().resource,t=new URL(e,window.location.href).href;this._categoryInfos.forEach(function(n){if(n.service&&n.service.getNotifications){var o=this._categorizedAnchors[n.id].parentElement;n.service.getNotifications(t).then(function(t){if(e===i.matchResourceParameters().resource){var n="";t.forEach(function(e){"info"!==e.level||n?"warn"!==e.level||n&&"info"!==n?"error"===e.level&&"error"!==n&&(n="error"):n="warn":n="info"}),n?o.setAttribute("level",n):o.removeAttribute("level")}},function(e){window.console.log(e)})}},this)},_show:function(){}},n}),define("orion/globalCommands",["i18n!orion/nls/messages","require","orion/commonHTMLFragments","orion/keyBinding","orion/EventTarget","orion/commands","orion/parameterCollectors","orion/extensionCommands","orion/breadcrumbs","orion/webui/littlelib","orion/i18nUtil","orion/webui/splitter","orion/webui/dropdown","orion/webui/tooltip","orion/contentTypes","orion/keyAssist","orion/widgets/themes/ThemePreferences","orion/widgets/themes/container/ThemeData","orion/Deferred","orion/widgets/UserMenu","orion/PageLinks","orion/webui/dialogs/OpenResourceDialog","!orion/banner/banner","text!orion/banner/toolbar.html","orion/util","orion/customGlobalCommands","orion/fileClient","orion/webui/SideMenu","orion/objects","orion/metrics","orion/bidiUtils"],function(e,t,i,n,o,r,s,a,l,c,d,h,u,p,f,g,m,v,_,y,C,w,b,S,x,L,T,E,k,N){function A(e,t){return e.getLabel?e.getLabel():(new _).resolve(t.properties.name)}function R(t){var i=c.node("progressPane");i.setAttribute("aria-label",e.OpPressSpaceMsg);var n=t.getService("orion.page.progress");n&&n.init.bind(n)("progressPane")}function I(e){var t=e.getServiceReferences("orion.core.auth");q=[];var i=Y.createMenuGenerator.apply(this,arguments);if(i)for(var n=0;n<t.length;n++){var o=t[n],r=e.getService(o);A(r,o).then(function(e){r.getKey().then(function(t){q.push(t),r.getUser().then(function(n){i.addUserItem(t,r,e,n)},function(n,o){i.addUserItem(t,r,e,o)}),window.addEventListener("storage",function(){J[t]!==localStorage.getItem(t)&&(J[t]=localStorage.getItem(t),r.getUser().then(function(n){i.addUserItem(t,r,e,n)},function(){i.addUserItem(t,r,e)}))},!1)})})}}function D(e,t,i,n,o){function s(){if(u)return u;var t=e.getService("orion.core.contentTypeRegistry");return t||(t=new f.ContentTypeRegistry(e),t=e.getService("orion.core.contentTypeRegistry")),t.getContentTypes().then(function(e){return u=e})}function l(e){for(var t,i={},n=e.getPropertyKeys(),o=0;o<n.length;o++)t=n[o],i[t]=e.getProperty(t);return i}function c(e,t){var i=null;return e.some(function(e){return t===e.getProperty("id")?!!(i=e):!1}),i}function d(e){var i=e.command;return!i.visibleWhen||i.visibleWhen(t)?(e.invocation=new r.CommandInvocation(t,t,null,i,n),(new _).resolve(e)):"function"==typeof o?(p||(p=o()),_.when(p,function(o){return!o||t!==G||i.visibleWhen&&!i.visibleWhen(o)?void 0:(e.invocation=new r.CommandInvocation(o,o,null,i,n),e)})):(new _).resolve()}function h(e,t,i){return i?(new _).resolve({relatedLink:e,command:i}):t.then(function(t){return{relatedLink:e,command:new r.Command(t)}})}var u,p,g=arguments,m=e&&e.getServiceReferences("orion.page.link.related");if(m&&0!==m.length){var v=this;_.when(s(),function(){function t(e){return e}if(Y.beforeGenerateRelatedLinks.apply(v,g)){var o=e.getServiceReferences("orion.navigate.command"),r=[];m.forEach(function(t){var i=l(t);if(i.id){var s;if((i.nls&&i.nameKey||i.name)&&i.uriTemplate)return s=a._createCommandOptions(i,t,e,u,!0),void r.push(h(i,s,null));var d=c(o,i.id);if(d){var p=l(d),f={};k.mixin(f,p,i);var g;(g=n.findCommand(i.id))?r.push(h(f,null,g)):(s=a._createCommandOptions(p,d,e,u,!0),r.push(h(f,s,null)))}}}),_.all(r,t).then(function(e){return e.sort(function(e,t){return e.command.name.localeCompare(t.command.name)}),_.all(e.map(d),t).then(function(t){var o=[];t=t.filter(function(t,i){return t?!0:(o.push(e[i]),!1)}),Y.addRelatedLinkCommands.call(v,n,t,o,i),Y.afterGenerateRelatedLinks.apply(v,g)})})}})}}function P(e){var t=c.node("globalActions");t&&(e.destroy(t),e.renderCommands(t.id,t,{},{},"tool"))}function M(e){X=e}function O(e){$&&("*"!==$.charAt(0)||e||($=$.substring(1)),e&&"*"!==$.charAt(0)&&($="*"+$),window.document.title=$);var t=c.node("dirty");t&&(t.textContent=e?"*":"")}function B(t){var i,n,o=t.breadcrumbRootName,r=t.serviceRegistry;t.target?(t.searchService&&t.searchService.setLocationByMetaData(t.target,{index:"last"}),!t.fileService||t.breadcrumbTarget||t.staticBreadcrumb||(n=o?o+" ":"",n+=t.fileService.fileServiceName(t.target.Location),o=null),i=t.name||t.target.Name,G=t.target,D.call(this,r,t.target,X,t.commandService,t.makeAlternate)):(t.breadcrumbTarget||(o=o||t.task||t.name),i=t.name,D.call(this,r,{NoTarget:""},X,t.commandService,t.makeAlternate)),$=t.title,$||($=i?d.formatMessage(e.PageTitleFormat,i,t.task):t.task),window.document.title=$,Y.afterSetPageTarget.apply(this,arguments);var s=c.node(t.breadCrumbContainer?t.breadCrumbContainer:"location"),a=t.fileService||r&&new T.FileClient(r),h=t.breadcrumbTarget||t.target,u=a&&h&&h.Location?a.fileServiceRootURL(h.Location):null,p={container:s,resource:h,rootSegmentName:o,workspaceRootSegmentName:n,workspaceRootURL:u,makeFinalHref:t.makeBreadcrumFinalLink,makeHref:t.makeBreadcrumbLink};s&&(c.empty(s),Z&&Z.destroy(),Z=new l.BreadCrumbs(t.staticBreadcrumb?{container:s,rootSegmentName:o}:p));var f=t.viewer;f&&f.localBreadcrumbNode&&(f.currentBreadcrumb&&f.currentBreadcrumb.destroy(),p.id="headerBreadcrumb"+f.id,p.container=f.localBreadcrumbNode,f.currentBreadcrumb=new l.BreadCrumbs(p))}function F(e){var t=window.getComputedStyle(e,null);if(null===t)return e;var i=t.getPropertyValue("position");return"absolute"!==i&&e.parentNode&&e!==document.body?F(e.parentNode):e}function j(e){var t={},i=null;"string"==typeof e&&(e=c.node(e)),e||(e=c.node("pageActions"));for(var n=e;n&&n.classList;){if(n.classList.contains("toolComposite")){i=n;break}n=n.parentNode}if(e.classList.contains("commandMarker")&&(t.commandNode=e),i||(i=c.node("pageToolbar")),i&&(t.slideContainer=c.$(".slideParameters",i),t.parameterArea=c.$(".parameters",i),t.dismissArea=c.$(".parametersDismiss",i),t.notifications=c.$("#notificationArea",i),i.parentNode&&(t.toolbarTarget=c.$(".toolbarTarget",i.parentNode),t.toolbarTarget))){var o=c.bounds(t.toolbarTarget),r=c.bounds(F(t.toolbarTarget.parentNode));t.toolbarTargetY=o.top-r.top,t.toolbar=i}return t}function V(e){var t=e.slideContainer;if(t&&(t.style.left="",t.style.top="",t.classList.contains("slideContainerActive"))){var i=c.bounds(t),n=c.bounds(t.parentNode);t.style.left=(n.width-i.width)/2+"px",t.style.top="0"}}function U(){return Q}function W(){return et}function z(){return tt}function H(o,a,l,u,p,f,y,L){var T=t.specified("orion/splash")&&t("orion/splash");a.registerService("orion.metrics",{logEvent:function(){},logTiming:function(e,t,i,n){"page"===e&&"complete"===t&&T&&T.takeDown(),localStorage.consoleMetrics&&window.console.log(e+" "+t+" "+i+" "+n)},pageLoad:function(){}},{}),N.initFromRegistry(a),u.addChangeListener(function(e,t){t.length<K&&e.indexOf("/git/credentials/")&&N.logEvent("preferenceChange",e,t)}),window.addEventListener("error",function(e){var t=e.filename.lastIndexOf("/"),i=e.filename.substring(t+1);if(i){var n=e.message+" ("+i+": "+e.lineno+(e.colno?", "+e.colno:"")+")";N.logEvent("runtime","uncaughtError",n)}else n=e.message+" ("+e.filename+": "+e.lineno+(e.colno?", "+e.colno:"")+")",N.logEvent("runtime","uncaughtErrorUnknownFile",n);if(e.error){var o=e.error.stack.replace(new RegExp(window.location.origin,"g"),"");N.logEvent("runtime","uncaughtErrorStack",o)}}),l.setServiceRegistry(a),new m.ThemePreferences(u,new v.ThemeData).apply();var E=c.node(o);if(!E)throw d.formatMessage("could not find banner parent, id was ${0}",o);(new b).create(E);var k=c.node("home");k&&(k.href=t.toUrl("edit/edit.html"),k.setAttribute("aria-label",e["Orion Home"]));var A=c.node("pageToolbar");A&&(A.classList.add("toolbarLayout"),A.innerHTML=S+i.slideoutHTMLFragment("mainToolbar"));var D=c.node("closeNotifications");if(D&&D.setAttribute("aria-label",e["Close notification"]),x.isFirefox<=17){var M=c.node("staticBanner");M&&(M.style.width="100%",M.style.MozBoxSizing="border-box")}l.setParameterCollector(new s.CommandParameterCollector(j,V)),document.addEventListener("keydown",function(e){if(e.keyCode===c.KEY.ESCAPE){var t=a.getService("orion.page.message");t&&t.setProgressMessage("")}},!1),Y.generateNavigationMenu.apply(this,arguments),Y.afterGenerateNavigationMenu.apply(this,arguments);var O=C.getCategoriesInfo(a),B=C.getPageLinksInfo(a,"orion.page.link");_.all([O,B]).then(function(e){if(this.sideMenu){var t=e[0],i=e[1];this.sideMenu.setCategories(t),this.sideMenu.setPageLinks(i),this.sideMenu.render()}}.bind(this));var F=c.$(".split");if(F){var U=c.$(".sidePanelLayout"),W=c.$(".mainPanelLayout");if(U&&W){Q={side:U,main:W},Q.splitter=new h.Splitter({node:F,sidePanel:U,mainPanel:W,toggle:!0,closeByDefault:L});var H=new r.Command({name:e["Toggle side panel"],tooltip:e["Open or close the side panel"],id:"orion.toggleSidePane",callback:function(){Q.splitter.toggleSidePanel()}});l.addCommand(H),l.registerCommandContribution("pageActions","orion.toggleSidePane",1,null,!0,new n.KeyBinding("l",x.isMac?!1:!0,!0,!1,x.isMac?!0:!1))}}var G=!1,$=function(e,t,i){if(!G){var n=t.getService("orion.page.progress"),o=t.getService("orion.core.preference"),r=new w.OpenResourceDialog({searcher:e,progress:n,prefService:o,serviceRegistry:t,commandRegistry:i,searchRenderer:e.defaultRenderer,onHide:function(){G=!1}});window.setTimeout(function(){G=!0,r.show()},0)}},q=new r.Command({name:e.FindFile,tooltip:e.ChooseFileOpenEditor,id:"orion.openResource",callback:function(){$(p,a,l)}});l.addCommand(q),l.registerCommandContribution("globalActions","orion.openResource",100,null,!0,new n.KeyBinding("f",!0,!0));var J=!1,X=function(){if(J)return!1;var e=c.node("banner"),t=c.node("footer"),i=c.node("sideMenu"),n=c.$(".content-fixedHeight"),o="hidden"===e.style.visibility;return o?(e.style.visibility="visible",t.style.visibility="visible",n.classList.remove("content-fixedHeight-maximized"),i&&i.classList.remove("sideMenu-maximized")):(e.style.visibility="hidden",t.style.visibility="hidden",n.classList.add("content-fixedHeight-maximized"),i&&i.classList.add("sideMenu-maximized")),z().dispatchEvent({type:"toggleTrim",maximized:!o}),!0},Z=window.orionNoTrim||!1;if(Z)X(),J=!0,this.sideMenu.hide();else{var tt=new r.Command({name:e["Toggle banner and footer"],tooltip:e.HideShowBannerFooter,id:"orion.toggleTrim",callback:X});l.addCommand(tt),l.registerCommandContribution("globalActions","orion.toggleTrim",100,null,!0,new n.KeyBinding("m",!0,!0));var it=new r.Command({name:e["System Configuration Details"],tooltip:e["System Config Tooltip"],id:"orion.configDetailsPage",hrefCallback:function(){return t.toUrl("about/about.html")}});l.addCommand(it),l.registerCommandContribution("globalActions","orion.configDetailsPage",100,null,!0,new n.KeyBinding(112,!0,!0));var nt=new r.Command({name:e["Background Operations"],tooltip:e["Background Operations Tooltip"],id:"orion.backgroundOperations",hrefCallback:function(){return t.toUrl("operations/list.html")}});l.addCommand(nt),l.registerCommandContribution("globalActions","orion.backgroundOperations",100,null,!0,new n.KeyBinding("o",!0,!0)),et=new g.KeyAssistPanel({commandRegistry:l});var ot=new r.Command({name:e["Show Keys"],tooltip:e.ShowAllKeyBindings,id:"orion.keyAssist",callback:function(){return et.isVisible()?et.hide():et.show(),!0}});l.addCommand(ot),l.registerCommandContribution("globalActions","orion.keyAssist",100,null,!0,new n.KeyBinding(191,!1,!0)),P(l),I(a,ot.callback)}return R(a),window.addEventListener("hashchange",function(){l.processURL(window.location.href)},!1),Y.afterGenerateBanner.apply(this,arguments)}var G,$,K=256,Y={createMenuGenerator:L.createMenuGenerator||function(t,i){var n=c.node("userMenu");if(n){var o=c.node("userDropdown"),r=new u.Dropdown({dropdown:o,selectionClass:"dropdownSelection"}),s=new y.UserMenu({dropdownNode:o,dropdown:r,serviceRegistry:t}),a=e.Options,l=c.node("userTrigger");return l.setAttribute("aria-label",a),new p.Tooltip({node:l,text:a,position:["below","left"]}),s.setKeyAssist(i),s}},beforeGenerateRelatedLinks:L.beforeGenerateRelatedLinks||function(){return!0},addRelatedLinkCommands:L.addRelatedLinkCommands||function(e,t,i,n){this.sideMenu&&this.sideMenu.setRelatedLinks(t,n)},afterGenerateRelatedLinks:L.afterGenerateRelatedLinks||function(){},afterSetPageTarget:L.afterSetPageTarget||function(){},generateNavigationMenu:L.generateNavigationMenu||function(){var t=c.node("sideMenu");if(t){this.sideMenu=new E(t,c.node("pageContent"));var i=c.node("centralNavigation");i&&(new p.Tooltip({node:i,text:e.CentralNavTooltip,position:["right"]}),i.addEventListener("click",this.sideMenu.toggle.bind(this.sideMenu)));var n=c.node("sideMenuToggle");n&&n.addEventListener("click",this.sideMenu.toggle.bind(this.sideMenu))}},afterGenerateNavigationMenu:L.afterGenerateNavigationMenu||function(){},afterGenerateBanner:L.afterGenerateBanner||function(){}},q=[],J={},X=[],Z=null,Q=null,et=null,tt=new o;return{generateBanner:H,getToolbarElements:j,getMainSplitter:U,getKeyAssist:W,getGlobalEventTarget:z,layoutToolbarElements:V,setPageTarget:B,setDirtyIndicator:O,setPageCommandExclusions:M}}),define("text!orion/webui/Slideout.html",[],function(){return'<div class="slideoutWrapper">\r\n	<button class="imageSprite core-sprite-close dismissButton slideoutDismissButton"></button>\r\n	<div class="slideoutContent">\r\n	</div>\r\n</div>'}),define("orion/webui/Slideout",["orion/objects","orion/webui/littlelib","text!orion/webui/Slideout.html"],function(e,t,i){function n(e){this._parentNode=e,this._initialize()}function o(e){this._slideout=e,this._parentNode=e.getContentNode()}var r=200;return e.mixin(n.prototype,{_initialize:function(){var e=document.createRange();e.selectNode(this._parentNode);var n=e.createContextualFragment(i);this._parentNode.appendChild(n),this._wrapperNode=t.$(".slideoutWrapper",this._parentNode),this._contentNode=t.$(".slideoutContent",this._wrapperNode),this._dismissButton=t.$(".dismissButton",this._wrapperNode),this._dismissButton.addEventListener("click",function(){this._currentViewMode?this._currentViewMode.hide():this.hide()}.bind(this)),this.hide()},getContentNode:function(){return this._contentNode},getPreviousActiveElement:function(){return this._previousActiveElement},getCurrentViewMode:function(){return this._currentViewMode},isVisible:function(){return this._wrapperNode.classList.contains("slideoutWrapperVisible")},show:function(e){this._previousActiveElement=document.activeElement,this._currentViewMode!==e&&(t.empty(this._contentNode),this._contentNode.appendChild(e.getWrapperNode()),this._currentViewMode=e),this._visibilityTransitionTimeout&&(window.clearTimeout(this._visibilityTransitionTimeout),this._visibilityTransitionTimeout=null),this._wrapperNode.classList.remove("slideoutNoVisibility"),this._wrapperNode.classList.add("slideoutWrapperVisible")},hide:function(){for(var e=document.activeElement;e;)this._wrapperNode===e&&document.activeElement.blur(),e=e.parentNode;this._previousActiveElement=null,this._wrapperNode.classList.remove("slideoutWrapperVisible"),this._visibilityTransitionTimeout=window.setTimeout(function(){this._wrapperNode.classList.add("slideoutNoVisibility")}.bind(this),r)}}),e.mixin(o.prototype,{show:function(){this._slideout.show(this)},hide:function(){this._slideout.hide()},getWrapperNode:function(){throw new Error("this function must be overriden")}}),{Slideout:n,SlideoutViewMode:o}}),define("orion/outliner",["orion/objects","i18n!orion/nls/messages","orion/Deferred","orion/webui/littlelib","orion/uiUtils","orion/explorers/explorer","orion/commands","orion/URITemplate","orion/EventTarget","orion/i18nUtil","orion/keyBinding","orion/globalCommands","orion/webui/Slideout"],function(e,t,i,n,o,r,s,a,l,c,d,h,u){function p(e,t,i,n){this.explorer=t,this._init(e),this.title=i,this.inputManager=n}function f(e,t,i){this.registry=e,this.renderer=new p({checkbox:!1,treeTableClass:"outlineExplorer"},this,i,t)}function g(e,t){this.items=e,this.root={children:e},this.root.outlinerId=t,this.idItemMap={}}function m(e,t){u.SlideoutViewMode.call(this,e),this._init(t)}function v(e){this._serviceRegistry=e.serviceRegistry,this._preferences=e.preferences,l.attach(this),this._serviceRegistration=this._serviceRegistry.registerService("orion.edit.outline",this),this._provider=new i,this._providerResolved=!1,this.filteredProviders=[]}var _=12e4;return p.prototype=new r.SelectionRenderer,p.prototype.constructor=p,p.prototype.getLabelColumnIndex=function(){return 0},p.prototype.getCellElement=function(e,t,i){if(t){var n=document.createElement("span"),o=document.createElement("span"),r=document.createElement("span");i.appendChild(n),n.appendChild(o),n.appendChild(r),t.className&&(r.className+=t.className),t.children?this.getExpandImage(i,o):o.classList.add("outlineLeafIndent");var s=document.createElement("span");if(t.labelPre||t.classNamePre){var l=document.createElement("span");s.appendChild(l),t.labelPre&&l.appendChild(document.createTextNode(t.labelPre)),t.classNamePre&&(l.className+=t.classNamePre)}if(t.label&&s.appendChild(document.createTextNode(t.label)),t.labelPost||t.classNamePost){var c=document.createElement("span");s.appendChild(c),t.labelPost&&c.appendChild(document.createTextNode(t.labelPost)),t.classNamePost&&(c.className+=t.classNamePost)}if(t.href)this._createLink(s,t.href,r);else if(t.line||t.column||t.start){var d=new a("#{,resource,params*}").expand({resource:this.title,params:t});this._createLink(s,d,r),t.outlineLink=d}else r.appendChild(s)}},p.prototype.getSelectionService=function(){return this.inputManager.selection},p.prototype._createLink=function(e,t,i){var n=document.createElement("a");i.appendChild(n),n.classList.add("navlinkonpage"),n.appendChild(e);var o=this.getSelectionService();return o?(n.style.cursor="pointer",n.addEventListener("click",function(e){this._followLink(e,t)}.bind(this),!1)):n.href=t,n},p.prototype.performRowAction=function(e,t){this._followLink(e,t.outlineLink)},p.prototype._followLink=function(e,t){var i=this.getSelectionService();i&&(o.openInNewWindow(e)?o.followLink(t,e):i.setSelections(t))},f.prototype=new r.Explorer,f.prototype.constructor=f,f.prototype.filterChanged=function(e){var t=this.getNavHandler(),i=null;if(e){var n="i";i=e.replace(/([.+^=!:${}()|\[\]\/\\])/g,"\\$1"),i=i.replace(/([*?])/g,".$1"),/[A-Z]/.test(i)&&(n=""),i=new RegExp(i,n),this._currentModifiedFilter=i,this._previousUnmodifiedFilter?0!==e.indexOf(this._previousUnmodifiedFilter)&&this.expandAll():this.expandAll()}else this.expandAll(),this._currentModifiedFilter=null;for(var o=t.getTopLevelNodes(),r=0;r<o.length;r++)this._filterRecursively(o[r],i);this._previousUnmodifiedFilter=e},f.prototype._filterRecursively=function(e,t){var i=this.getNavHandler(),n=this,o=i.getRowDiv(e),r=-1!==e.label.search(t);if(e.children&&i.isExpanded(e)){var s=!1;e.children.forEach(function(e){n._filterRecursively(e,t)&&(s=!0)}),s||this.myTree.collapse(e)}var a=!t||s||r;return t?(a?o.classList.remove("outlineRowHidden"):o.classList.add("outlineRowHidden"),r?o.classList.add("outlineRowMatchesFilter"):o.classList.remove("outlineRowMatchesFilter"),i.setIsNotSelectable(e,!r)):(o.classList.remove("outlineRowHidden"),o.classList.remove("outlineRowMatchesFilter"),i.setIsNotSelectable(e,!1)),a},f.prototype.postUserExpand=function(e){if(this._currentModifiedFilter){var t=this.getNavDict().getValue(e).model;this._expandRecursively(t),this._filterRecursively(t,this._currentModifiedFilter)}},g.prototype.constructor=g,g.prototype.getRoot=function(e){e(this.root)},g.prototype.destroy=function(){},g.prototype.getId=function(e){if(e.outlinerId)return e.outlinerId;for(var t=e.label.replace(/[\\\/\.\:\-\_\s]/g,""),i=t,o=0;this.idItemMap[i]&&this.idItemMap[i]!==e||n.node(i);)i=t+"["+o+"]",o+=1;return this.idItemMap[i]=e,e.outlinerId=i,i},g.prototype.getIdItemMap=function(){return this.idItemMap},g.prototype.getChildren=function(e,t){if(e.children){for(var i=0;i<e.children.length;i++)e.children[i].parent=e;t(e.children)}else t([])},g.prototype.doExpansions=function(e){for(var t=0;t<this.root.children.length;t++)this.root.children[t].children&&e.expand(this.root.children[t])},m.prototype=Object.create(u.SlideoutViewMode.prototype),m.prototype.constructor=m,e.mixin(m.prototype,{_init:function(e){this._commandIds={};var t=n.node(e.toolbar);if(!e.outlineService)throw new Error("no outline service");this._wrapperNode=document.createElement("div"),this._wrapperNode.classList.add("outlinerWrapper"),this._createFilterInput(),this._outlineNode=document.createElement("div"),this._outlineNode.classList.add("outlineNodeWrapper"),this._outlineNode.addEventListener("keydown",function(e){(e.keyCode===n.KEY.ESCAPE||e.keyCode===n.KEY.ENTER)&&this._slideout.getPreviousActiveElement()&&this.hide()}.bind(this),!1),this._wrapperNode.appendChild(this._outlineNode),this._toolbar=t,this._serviceRegistry=e.serviceRegistry,this._contentTypeRegistry=e.contentTypeRegistry,this._outlineService=e.outlineService,this._commandService=e.commandService,this._inputManager=e.inputManager,this._sidebar=e.sidebar,this._switcherNode=e.switcherNode;var o=this;this._inputManager.addEventListener("InputChanged",function(e){o.setContentType(e.contentType,e.location),o._editor!==e.editor&&(o._editor&&o._editor.removeEventListener("InputChanged",o._editorListener),o._editor=e.editor,o._editor&&o._editor.addEventListener("InputChanged",o._editorListener=o.generateOutline.bind(o)))}),i.when(o._outlineService,function(e){e.addEventListener("outline",function(e){o.providerId=e.providerId,o._renderOutline(e.outline,e.title)})})},getWrapperNode:function(){return this._wrapperNode},generateOutline:function(){if(this._isActive()){this._filterInput.value="",n.empty(this._outlineNode);var e=document.createElement("span");e.classList.add("modelDecorationSprite"),e.classList.add("core-sprite-progress"),this._outlineNode.appendChild(e),this._outlineTimeout&&window.clearTimeout(this._outlineTimeout),this._outlineTimeout=window.setTimeout(function(){n.empty(this._outlineNode);var e=document.createElement("span");e.appendChild(document.createTextNode(t.outlineTimeout)),e.classList.add("outlineTimeoutSpan"),this._outlineNode.appendChild(e)}.bind(this),_),this._providerLookup||this._outlineService.emitOutline(this._inputManager)}},setSelectedProvider:function(e){this.providerId=e.getProperty("id"),this.providerName=e.getProperty("name"),this._outlineService.setProvider(e)},setOutlineProviders:function(e){var t=this.outlineProviders,i=this._isActive();this.outlineProviders=e,this._updateViewModes(t,this.outlineProviders),i&&this._selectNewProvider()},_renderOutline:function(e,t){if(this._outlineTimeout&&(window.clearTimeout(this._outlineTimeout),this._outlineTimeout=null),n.empty(this._outlineNode),e){e=e instanceof Array?e:[e];var i=new g(e);this.explorer&&this.explorer.destroy(),this.explorer=new f(this._serviceRegistry,this._inputManager,t),this.explorer.createTree(this._outlineNode,i,{selectionPolicy:"cursorOnly",setFocus:!1}),i.doExpansions(this.explorer.myTree)}},_selectNewProvider:function(){var e=this.outlineProviders,t=e.every(function(e){return this.providerId!==e.getProperty("id")}.bind(this));if(t){var i=e[0];i&&this.createViewMode(i)}},_viewModeId:function(e){return"outline."+e.getProperty("id")},_updateViewModes:function(e,t){if(e&&e.forEach(function(e){var t=this._viewModeId(e);this._commandService.unregisterCommandContribution(this._switcherNode.id,t,"orion.menuBarViewGroup/orion.slideoutMenuGroup")},this),t){var i=!1;t.forEach(function(e){if(e){var t=this._viewModeId(e),n=new s.Command({name:e.displayName||e.getProperty("name"),id:t,callback:this._openOutlineCallback.bind(this,e)});this._commandService.addCommand(n);var o=null;i||(o=new d.KeyBinding("o",!0),i=!0),this._commandService.registerCommandContribution(this._switcherNode.id,t,1,"orion.menuBarViewGroup/orion.slideoutMenuGroup",!1,o)}},this)}this._sidebar.renderViewModeMenu()},_openOutlineCallback:function(e){if(this._isActive(e))document.activeElement===this._filterInput?this._slideout.hide():this._filterInput.select();else{var t=h.getMainSplitter();t.splitter.isClosed()&&t.splitter.toggleSidePanel(),this.createViewMode(e),this._filterInput.select()}},_isActive:function(e){var t=this._slideout.isVisible()&&this===this._slideout.getCurrentViewMode();return t&&e&&(t=e.getProperty("id")===this.providerId,t&&(t=e.getProperty("name")===this.providerName)),t},createViewMode:function(e){this.setSelectedProvider(e),this.show(),this.generateOutline()},_createFilterInput:function(){var e=document.createElement("input");e.classList.add("outlineFilter"),e.placeholder=t.Filter,e.type="text",e.addEventListener("input",function(){this._filterInputTimeout&&window.clearTimeout(this._filterInputTimeout);var t=this;this._filterInputTimeout=window.setTimeout(function(){t.explorer&&t.explorer.filterChanged(e.value),t._filterInputTimeout=null},200)}.bind(this)),e.addEventListener("keydown",function(t){var i=null,o=null;t.keyCode===n.KEY.DOWN?(i=this.explorer.getNavHandler(),o=i.getTopLevelNodes(),o&&(e.blur(),i.focus(),i.cursorOn(o[0],!1,!0),o[0].isNotSelectable&&i.iterate(!0,!1,!1,!0)),t.preventDefault&&t.preventDefault()):t.keyCode===n.KEY.ESCAPE?this._slideout.getPreviousActiveElement()&&(this._slideout.getPreviousActiveElement()===e?e.blur():this._slideout.getPreviousActiveElement().focus(),this.hide()):t.keyCode===n.KEY.ENTER&&(i=this.explorer.getNavHandler(),o=i.getTopLevelNodes(),o&&(e.blur(),i.focus(),i.cursorOn(o[0],!1,!0),o[0].isNotSelectable&&i.iterate(!0,!1,!1,!0)))}.bind(this),!1),this._wrapperNode.appendChild(e),this._filterInput=e},setContentType:function(e,t){var i=this._serviceRegistry.getServiceReferences("orion.edit.outliner"),n=this,o=this.filteredProviders=i.filter(function(i){var o=i.getProperty("contentType"),r=i.getProperty("pattern");return o?o.some(function(t){return n._contentTypeRegistry.isExtensionOf(e,t)}):r&&new RegExp(r).test(t)?!0:!1});this._providerLookup=!0,o.forEach(function(e){e.displayName=e.getProperty("name")||e.getProperty("nameKey")}),n._providerLookup=!1,n._outlineService.setOutlineProviders(o),n.setOutlineProviders(o),n.generateOutline()}}),v.prototype={setOutlineProviders:function(e){this.providers=e;var t=this;this._preferences.get("/edit/outline").then(function(i){for(var n,o=0;o<e.length&&(n=e[o],i.outlineProvider!==e[o].getProperty("id"));o++);n&&t.setProvider(n)})},setProvider:function(e){this._providerResolved&&(this._provider=new i),this._provider.resolve(e),this._providerResolved=!0;var t=e.getProperty("id");t&&this._preferences.put("/edit/outline",{outlineProvider:t})},getProvider:function(){return this._provider.promise},emitOutline:function(e){var n=this;i.when(this.getProvider(),function(i){var o=e.getEditor();if(!o)return void n.dispatchEvent({type:"outline",outline:null});var r,s,a=o.getTitle(),l=n._serviceRegistry,d=l.getService("orion.page.progress"),h=l.getService(i);
if(r=h.computeOutline){var u=e.getContentType();s=[o.getEditorContext(),{contentType:u&&u.id}]}else(r=h.getOutline)&&(s=[o.getText(),a]);d.progress(r.apply(h,s),c.formatMessage(t.OutlineProgress,a,i.displayName)).then(function(e){e&&n.dispatchEvent({type:"outline",outline:e,title:a,providerId:i.getProperty("id")})})})}},v.prototype.constructor=v,{Outliner:m,OutlineService:v}}),define("orion/webui/contextmenu",["orion/webui/littlelib","orion/webui/dropdown","orion/objects"],function(e,t,i){function n(e){e.skipTriggerEventListeners=!0,o.call(this,e),this._initialize()}var o=t.Dropdown;return n.prototype=Object.create(o.prototype),n.prototype.constructor=n,i.mixin(n.prototype,{_initialize:function(){this._dropdownNode.dropdown||(this._dropdownNode.dropdown=this),this._boundcontextmenuEventHandler=this._contextmenuEventHandler.bind(this),this._boundContextMenuCloser=this._contextMenuCloser.bind(this),this._triggerNode.addEventListener("contextmenu",this._boundcontextmenuEventHandler,!0),window.addEventListener("contextmenu",this._boundContextMenuCloser,!1)},_contextMenuCloser:function(e){this.close(e)},_contextmenuEventHandler:function(t){this.open(t)?e.stop(t):this.close()}}),n.prototype.open=function(e){return this._triggerNode.addEventListener("click",this._boundContextMenuCloser,!1),o.prototype.open.call(this,e)},n.prototype.close=function(e){return this._triggerNode.removeEventListener("click",this._boundContextMenuCloser,!1),o.prototype.close.call(this,e)},n.prototype._positionDropdown=function(t){if(t){var i=t.clientX,n=t.clientY;this._dropdownNode.style.position="fixed",this._dropdownNode.style.left=i+1+"px",this._dropdownNode.style.top=n+"px";var r=e.bounds(this._dropdownNode),s=r.width,a=r.height,l=e.bounds(document.body),c=i+s-(l.left+l.width);c>0&&(this._dropdownNode.style.left=Math.floor(i-c)+"px");var d=n+a-(l.top+l.height);d>0&&(this._dropdownNode.style.top=Math.floor(n-d)+"px")}else o.prototype._positionDropdown.call(this)},n.prototype.destroy=function(){this._triggerNode.removeEventListener("contextmenu",this._boundcontextmenuEventHandler,!0),this._triggerNode.removeEventListener("click",this._boundContextMenuCloser,!1),window.removeEventListener("contextmenu",this._boundContextMenuCloser,!1),this._dropdownNode.dropdown=null,o.prototype.destroy.call(this)},{ContextMenu:n}}),define("orion/widgets/nav/common-nav",["i18n!orion/edit/nls/messages","orion/objects","orion/webui/littlelib","orion/explorers/explorer-table","orion/explorers/navigatorRenderer","orion/keyBinding","orion/fileCommands","orion/projectCommands","orion/extensionCommands","orion/globalCommands","orion/selection","orion/URITemplate","orion/PageUtil","orion/webui/contextmenu","orion/metrics"],function(e,t,i,n,o,r,s,a,l,c,d,h,u,p,f){function g(e){e.setFocus=!1,e.cachePrefix=null,e.modelEventDispatcher=s.getModelEventDispatcher(),e.dragAndDrop=s.uploadFile,v.apply(this,arguments),this.preferences=e.preferences,this.commandRegistry=e.commandRegistry,this.serviceRegistry=e.serviceRegistry,this.editorInputManager=e.editorInputManager,this.progressService=e.progressService,this.sidebar=e.sidebar;var t=this.sidebarNavInputManager=e.sidebarNavInputManager;this.toolbarNode=e.toolbarNode,this.fileActionsScope="fileActions",this.editActionsScope="editActions",this.viewActionsScope="viewActions",this.toolsActionsScope="toolsActions",this.additionalActionsScope="extraActions",this._parentNode=i.node(this.parentId),this._sidebarContextMenuNode=document.createElement("ul"),this._sidebarContextMenuNode.className="dropdownMenu",this._sidebarContextMenuNode.setAttribute("role","menu"),this._sidebarContextMenuNode.id=this.parentId+"ContextMenu",this._parentNode.parentNode.insertBefore(this._sidebarContextMenuNode,this._parentNode),this.contextMenuActionsScope=this._sidebarContextMenuNode.id+"commonNavContextMenu",this.treeRoot={};var n=this;this.editorInputListener=function(e){n.reveal(e.metadata).then(function(){f.logPageLoadTiming("complete",window.location.pathname)})},this.editorInputManager.addEventListener("InputChanged",this.editorInputListener),t&&(t.reveal=function(e){n.reveal(e)},this.addEventListener("rootChanged",function(e){t.dispatchEvent(e)}));var o=this.modelEventDispatcher,r=this._modelListener=this.onFileModelChange.bind(this);["move","delete"].forEach(function(e){o.addEventListener(e,r)}),this.selection=new d.Selection(this.registry,"commonNavFileSelection"),this._selectionListener=function(e){n.updateCommands(e.selections),t&&n.sidebarNavInputManager.dispatchEvent(e)},this.selection.addEventListener("selectionChanged",this._selectionListener),c.getMainSplitter().splitter.addEventListener("toggle",this._splitterToggleListener=function(){this.updateCommands()}.bind(this)),this.commandsRegistered=this.registerCommands(),this._createContextMenu()}function m(){y.apply(this,arguments)}var v=n.FileExplorer,_=r.KeyBinding,y=o.NavigatorRenderer,C=new h("#{,resource,params*}");return g.prototype=Object.create(v.prototype),t.mixin(g.prototype,{onLinkClick:function(e){v.prototype.onLinkClick.call(this,e),this.sidebarNavInputManager.dispatchEvent(e);var t=this.getNavHandler();if(t&&e.item.Directory){var i=e.item;t.cursorOn(i),t.setSelection(i,!1);var n=t._modelIterator.cursor();t.isExpandable(n)&&(t.isExpanded(n)?this.myTree.collapse(n):this.myTree.expand(n))}},onModelCreate:function(e){return v.prototype.onModelCreate.call(this,e).then(function(){this.sidebarNavInputManager.dispatchEvent(e)}.bind(this))},onFileModelChange:function(e){var t=e.oldValue,i=e.newValue,n=this.editorInputManager.getFileMetadata();if(n){var o;if([n].concat(n.Parents||[]).some(function(e){return t.Location===e.Location?(o=t,!0):!1}),o){var r;r=o.Location===n.Location?i&&i.ChildrenLocation||i&&i.ContentLocation||i&&i.Location||null:null,this.sidebarNavInputManager.dispatchEvent({type:"editorInputMoved",parent:t.parent.Location,newInput:r})}}},createActionSections:function(){var e=this;[].forEach(function(t){if(!e[t]){var i=document.createElement("ul");i.id=t,i.classList.add("commandList"),i.classList.add("layoutLeft"),i.classList.add("pageActions"),e.toolbarNode.appendChild(i),e[t]=i}})},destroy:function(){var e=this,t=this.modelEventDispatcher;["move","delete"].forEach(function(i){t.removeEventListener(i,e._modelListener)}),v.prototype.destroy.call(this),[].forEach(function(t){delete e[t]}),this.editorInputManager.removeEventListener("InputChanged",this.editorInputListener),this.selection.removeEventListener("selectionChanged",this._selectionListener);var i=c.getMainSplitter();i&&i.splitter.removeEventListener("toggle",this._splitterToggleListener),this._contextMenu&&(this._contextMenu.destroy(),this._contextMenu=null),this._sidebarContextMenuNode&&(this._parentNode.parentNode.removeChild(this._sidebarContextMenuNode),this._sidebarContextMenuNode=null)},display:function(e,t){return this.loadRoot(e,t).then(function(){return this.updateCommands(),this.reveal(this.editorInputManager.getFileMetadata()).then(function(){f.logPageLoadTiming("complete",window.location.pathname)})}.bind(this))},loadRoot:function(e,t){return e=e&&e.ChildrenLocation||e||"",this.commandsRegistered.then(function(){return e&&"object"==typeof e?this.load(e):this.loadResourceList(e,t)}.bind(this))},scope:function(e){e=e&&e.ChildrenLocation||e||"";var t=u.matchResourceParameters(),i=t.resource;if(delete t.resource,e){if(t.navigate===e)return;t.navigate=e}else delete t.navigate;window.location.href=C.expand({resource:i,params:t})},scopeUp:function(){var e,t=this.treeRoot,i=t.Parents&&t.Parents[0];e=i?i.ChildrenLocation:this.fileClient.fileServiceRootURL(t.Location),this.scope(e)},scopeDown:function(e){this.scope(e.ChildrenLocation)},isCommandsVisible:function(){var e=c.getMainSplitter();return e?!e.splitter.isClosed():!this.destroyed},registerCommands:function(){var t=this.commandRegistry,i=this.fileActionsScope,n=this.editActionsScope,o=this.viewActionsScope,r=this.contextMenuActionsScope,s=new _(113),c=new _(46),d=new _("x",!0),h=new _("c",!0),u=new _("v",!0),p=new _(38,!1,!1,!0),f=new _(40,!1,!1,!0);return f.domScope=p.domScope=u.domScope=h.domScope=d.domScope=c.domScope=s.domScope="sidebar",f.scopeName=p.scopeName=u.scopeName=h.scopeName=d.scopeName=c.scopeName=s.scopeName=e.Navigator,t.registerCommandContribution(i,"eclipse.newFile",1,"orion.menuBarFileGroup/orion.newContentGroup/orion.new.default"),t.registerCommandContribution(i,"eclipse.newFolder",2,"orion.menuBarFileGroup/orion.newContentGroup/orion.new.default",!1,null),t.registerCommandContribution(i,"orion.new.project",3,"orion.menuBarFileGroup/orion.newContentGroup/orion.new.default"),t.registerCommandContribution(i,"orion.new.linkProject",4,"orion.menuBarFileGroup/orion.newContentGroup/orion.new.default"),t.registerCommandContribution(i,"orion.import",1,"orion.menuBarFileGroup/orion.importGroup"),t.registerCommandContribution(i,"orion.importZipURL",2,"orion.menuBarFileGroup/orion.importGroup"),t.registerCommandContribution(i,"orion.importSFTP",3,"orion.menuBarFileGroup/orion.importGroup"),t.registerCommandContribution(i,"eclipse.downloadSingleFile",1,"orion.menuBarFileGroup/orion.exportGroup"),t.registerCommandContribution(i,"eclipse.downloadFile",2,"orion.menuBarFileGroup/orion.exportGroup"),t.registerCommandContribution(i,"eclipse.exportSFTPCommand",3,"orion.menuBarFileGroup/orion.exportGroup"),t.registerCommandContribution(n,"eclipse.cut",1,"orion.menuBarEditGroup/orion.clipboardGroup",!1,d),t.registerCommandContribution(n,"eclipse.copySelections",2,"orion.menuBarEditGroup/orion.clipboardGroup",!1,h),t.registerCommandContribution(n,"eclipse.pasteSelections",3,"orion.menuBarEditGroup/orion.clipboardGroup",!1,u),t.registerCommandContribution(n,"eclipse.deleteFile",4,"orion.menuBarEditGroup/orion.clipboardGroup",!1,c),t.registerCommandContribution(n,"eclipse.renameResource",5,"orion.menuBarEditGroup/orion.clipboardGroup",!1,s),t.registerCommandContribution(n,"eclipse.compareWith",6,"orion.menuBarEditGroup/orion.compareGroup"),t.registerCommandContribution(n,"eclipse.compareWithEachOther",7,"orion.menuBarEditGroup/orion.compareGroup"),t.registerCommandContribution(o,"eclipse.downFolder",1,"orion.menuBarViewGroup",!1,f),t.registerCommandContribution(o,"eclipse.upFolder",0,"orion.menuBarViewGroup",!1,p),t.addCommandGroup(o,"eclipse.openWith",1e3,e.OpenWith,"orion.menuBarViewGroup",null,null,null,"dropdownSelection"),t.addCommandGroup(o,"eclipse.fileCommandExtensions",1e3,e.OpenRelated,"orion.menuBarViewGroup"),t.addCommandGroup(r,"orion.commonNavContextMenuGroup",100,null,null,null,null,null,"dropdownSelection"),t.addCommandGroup(r,"orion.New",0,e.New,"orion.commonNavContextMenuGroup/orion.newGroup",null,null,null,"dropdownSelection"),t.registerCommandContribution(r,"eclipse.newFile",1,"orion.commonNavContextMenuGroup/orion.newGroup/orion.New"),t.registerCommandContribution(r,"eclipse.newFolder",2,"orion.commonNavContextMenuGroup/orion.newGroup/orion.New",!1,null),t.registerCommandContribution(r,"orion.new.project",3,"orion.commonNavContextMenuGroup/orion.newGroup/orion.New"),t.registerCommandContribution(r,"orion.new.linkProject",4,"orion.commonNavContextMenuGroup/orion.newGroup/orion.New"),t.registerCommandContribution(r,"eclipse.cut",1,"orion.commonNavContextMenuGroup/orion.editGroup",!1),t.registerCommandContribution(r,"eclipse.copySelections",2,"orion.commonNavContextMenuGroup/orion.editGroup",!1),t.registerCommandContribution(r,"eclipse.pasteSelections",3,"orion.commonNavContextMenuGroup/orion.editGroup",!1),t.registerCommandContribution(r,"eclipse.deleteFile",4,"orion.commonNavContextMenuGroup/orion.editGroup",!1),t.registerCommandContribution(r,"eclipse.renameResource",5,"orion.commonNavContextMenuGroup/orion.editGroup",!1),t.addCommandGroup(r,"orion.OpenWith",1001,e.OpenWith,"orion.commonNavContextMenuGroup/orion.relatedActions",null,null,null,"dropdownSelection"),t.addCommandGroup(r,"orion.Extensions",1002,e.OpenRelated,"orion.commonNavContextMenuGroup/orion.relatedActions",null,null,null,"dropdownSelection"),t.registerCommandContribution(r,"eclipse.compareWith",6,"orion.commonNavContextMenuGroup/orion.relatedActions"),t.registerCommandContribution(r,"eclipse.compareWithEachOther",7,"orion.commonNavContextMenuGroup/orion.relatedActions"),t.addCommandGroup(r,"orion.ImportGroup",1003,e.Import,"orion.commonNavContextMenuGroup/orion.ImportExport",null,null,null,"dropdownSelection"),t.addCommandGroup(r,"orion.ExportGroup",1004,e.Export,"orion.commonNavContextMenuGroup/orion.ImportExport",null,null,null,"dropdownSelection"),t.registerCommandContribution(r,"orion.import",1,"orion.commonNavContextMenuGroup/orion.ImportExport/orion.ImportGroup"),t.registerCommandContribution(r,"orion.importZipURL",2,"orion.commonNavContextMenuGroup/orion.ImportExport/orion.ImportGroup"),t.registerCommandContribution(r,"orion.importSFTP",3,"orion.commonNavContextMenuGroup/orion.ImportExport/orion.ImportGroup"),t.registerCommandContribution(r,"eclipse.downloadSingleFile",1,"orion.commonNavContextMenuGroup/orion.ImportExport/orion.ExportGroup"),t.registerCommandContribution(r,"eclipse.downloadFile",2,"orion.commonNavContextMenuGroup/orion.ImportExport/orion.ExportGroup"),t.registerCommandContribution(r,"eclipse.exportSFTPCommand",3,"orion.commonNavContextMenuGroup/orion.ImportExport/orion.ExportGroup"),t.registerCommandContribution(r,"orion.searchInFolder",1,"orion.commonNavContextMenuGroup"),t.registerCommandContribution(r,"orion.problemsInFolder",2,"orion.commonNavContextMenuGroup"),l.getOpenWithCommands(t).forEach(function(e){t.registerCommandContribution(o,e.id,1,"orion.menuBarViewGroup/eclipse.openWith"),t.registerCommandContribution(r,e.id,1,"orion.commonNavContextMenuGroup/orion.relatedActions/orion.OpenWith")}),l.getFileCommandIds().forEach(function(e){t.registerCommandContribution(o,e,1,"orion.menuBarViewGroup/eclipse.fileCommandExtensions"),t.registerCommandContribution(r,e,1,"orion.commonNavContextMenuGroup/orion.relatedActions/orion.Extensions")}),this.preferences.get("/common-nav").then(function(n){var o=n.showNewProjectCommands;if(void 0===o||o){t.addCommandGroup(i,"orion.projectsNewGroup",100,e.Project,"orion.menuBarFileGroup/orion.newContentGroup"),t.addCommandGroup(r,"orion.projectsNewGroup",100,e.Project,"orion.commonNavContextMenuGroup/orion.newGroup/orion.New");var s=0;a.getCreateProjectCommands(t).forEach(function(e){t.registerCommandContribution(i,e.id,s,"orion.menuBarFileGroup/orion.newContentGroup/orion.projectsNewGroup"),t.registerCommandContribution(r,e.id,s,"orion.commonNavContextMenuGroup/orion.newGroup/orion.New/orion.projectsNewGroup"),s++})}})},updateCommands:function(){var e=this.isCommandsVisible();this.createActionSections();var t=this.commandRegistry,i=this.sidebar.menuBar;i.setActiveExplorer(this),i.updateCommands(),t.registerSelectionService(this.contextMenuActionsScope,e?this.selection:null),this._sidebarContextMenuNode&&this._populateContextMenu(this._sidebarContextMenuNode)},getEditActionsScope:function(){return this.editActionsScope},getTreeRoot:function(){return this.treeRoot},_populateContextMenu:function(e){var t=this.selection,i=t.getSelections(),n=null;this.commandRegistry.destroy(e),(!i||Array.isArray(i)&&!i.length)&&(n=this.getTreeRoot()),this.commandRegistry.renderCommands(this.contextMenuActionsScope,e,n,this,"menu")},refreshSelection:function(){},_createContextMenu:function(){var e=function(e){var t=this.getNavHandler(),i=this.getNavDict(),n=e.event,o=null;if(n.target){for(var r=n.target;this._parentNode.contains(r);){if("TR"===r.nodeName){var s=r.id;o=i.getValue(s);break}r=r.parentNode}if(o&&!t.isDisabled(o.rowDomNode)){var a=t.getSelection();-1===a.indexOf(o.model)&&(t.cursorOn(o.model,!0,!1,!0),t.setSelection(o.model,!1,!0))}else{var l=void 0===n.offsetX?n.layerX:n.offsetX;l>0&&(this.selection.setSelections(null),t.refreshSelection(!0,!0))}f.logEvent("contextMenu","opened","navigator")}}.bind(this),t=new p.ContextMenu({dropdown:this._sidebarContextMenuNode,triggerNode:this._parentNode});t.addEventListener("triggered",e),this._contextMenu=t}}),m.prototype=Object.create(y.prototype),t.mixin(m.prototype,{showFolderLinks:!0,oneColumn:!0,createFolderNode:function(e){var t=y.prototype.createFolderNode.call(this,e);return this.showFolderLinks&&"A"===t.tagName?(t.href=C.expand({resource:e.Location}),t.classList.add("commonNavFolder")):t.classList.add("nav_fakelink"),t},rowCallback:function(e,t){y.prototype.rowCallback.call(this,e,t);var i=s.getCutBuffer();if(i){var n=i.some(function(e){return s.isEqualToOrChildOf(t,e)});if(n){var o=this.explorer.getNavHandler();o.disableItem(t)}}},emptyCallback:function(){}}),{CommonNavExplorer:g,CommonNavRenderer:m}}),define("orion/widgets/filesystem/filesystemSwitcher",["i18n!orion/edit/nls/messages","orion/objects","orion/webui/littlelib","orion/i18nUtil","orion/commands","orion/URL-shim"],function(e,t,i,n,o){function r(e){this.commandRegistry=e.commandRegistry,this.rootChangeListener=e.rootChangeListener,this.filesystemChangeDispatcher=e.filesystemChangeDispatcher,this.fileClient=e.fileClient,this.node=e.node,this._insertBeforeNode=e.insertBeforeNode,this.serviceRegistry=e.serviceRegistry;var t=this;this.listener=function(e){t.refresh(e.root)},this.rootChangeListener&&this.rootChangeListener.addEventListener("rootChanged",this.listener),this.render()}return t.mixin(r.prototype,{destroy:function(){this.rootChangeListener&&this.rootChangeListener.removeEventListener("rootChanged",this.listener),this.commandRegistry.destroy(this.node),i.empty(this.node),this.rootChangeListener=this.filesystemChangeDispatcher=this.listener=this.node=null},registerCommands:function(){if(!this.commandsRegistered){this.commandsRegistered=!0;var t=this.commandRegistry,i=this.serviceRegistry,n=new o.Command({name:e.ChooseFS,imageClass:"core-sprite-openarrow",selectionClass:"dropdownSelection",tooltip:e.ChooseFSTooltip,id:"orion.nav.switchfs",visibleWhen:function(){return i.getServiceReferences("orion.core.file").length>1},choiceCallback:this._switchFsMenuCallback.bind(this)});t.addCommand(n),t.registerCommandContribution("orion.mininav","orion.nav.switchfs",1)}},_switchFsMenuCallback:function(){var e=this.serviceRegistry,t=this;return e.getServiceReferences("orion.core.file").map(function(e){var i=e.getProperty("top"),n=t._fileServiceLabel(i,!0);return{checked:t.fileSystem===n,name:n,callback:t.setActiveFilesystem.bind(t,i)}})},render:function(){this.fsName=document.createElement("div"),this.fsName.classList.add("filesystemName"),this.menu=document.createElement("ul"),this.menu.classList.add("filesystemSwitcher"),this.menu.classList.add("commandList"),this.menu.classList.add("pageActions");var e=document.createElement("div");e.classList.add("filesystemSwitcherWrapper"),e.appendChild(this.fsName),e.appendChild(this.menu),this._insertBeforeNode?this.node.insertBefore(e,this._insertBeforeNode):this.node.appendChild(e),this.registerCommands(),this.fsName.addEventListener("click",this._openMenu.bind(this))},_openMenu:function(){var e=i.$(".dropdownTrigger",this.menu);if(e){var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),e.dispatchEvent(t)}},_fileServiceHostname:function(e){var t=this.fileClient.fileServiceRootURL(e);0===t.indexOf("filesystem:")&&(t=t.substr("filesystem:".length));var i=t;try{i=new URL(t,window.location.href).hostname}catch(n){}return i},_fileServiceLabel:function(t,o){var r=this.fileClient.fileServiceName(t),s=this._fileServiceHostname(t);if(o)return n.formatMessage(e.FSTitle,r,s);var a=document.createDocumentFragment();return a.textContent=e.FSTitle,i.processDOMNodes(a,[document.createTextNode(r),document.createTextNode(s)]),a},refresh:function(e){var t=e;e.ChildrenLocation&&(t=e.ChildrenLocation),i.empty(this.fsName),this.fileSystem=this._fileServiceLabel(t,!0),this.fsName.appendChild(this._fileServiceLabel(t)),this.commandRegistry.destroy(this.menu),this.commandRegistry.renderCommands("orion.mininav",this.menu,{},"menu");var n=i.$(".dropdownMenu",this.menu);n&&(n.style.position="fixed")},setActiveFilesystem:function(e){var t=e;e.ChildrenLocation&&(t=e.ChildrenLocation);var i=this.fileClient.fileServiceRootURL(t);this.filesystemChangeDispatcher&&this.filesystemChangeDispatcher.dispatchEvent({type:"filesystemChanged",newInput:i})}}),{FilesystemSwitcher:r}}),define("orion/widgets/nav/mini-nav",["i18n!orion/edit/nls/messages","orion/objects","orion/widgets/nav/common-nav","orion/PageUtil","orion/widgets/filesystem/filesystemSwitcher","orion/URL-shim"],function(e,t,i,n,o){function r(){l.apply(this,arguments);var e=this.sidebarNavInputManager;if(e){var t=this;this.addEventListener("rootChanged",function(e){t.sidebarNavInputManager.dispatchEvent({type:"InputChanged",input:e.root.ChildrenLocation})}),e.setInput=function(e){t.treeRoot&&t.treeRoot.ChildrenLocation!==e&&t.loadRoot(e).then(function(){t.updateCommands();var e=t.editorInputManager.getFileMetadata();t.reveal(e,!1)})}}}function s(){c.apply(this,arguments)}function a(e){this.preferences=e.preferences,this.commandRegistry=e.commandRegistry,this.contentTypeRegistry=e.contentTypeRegistry,this.fileClient=e.fileClient,this.editorInputManager=e.editorInputManager,this.parentNode=e.parentNode,this.sidebar=e.sidebar,this.sidebarNavInputManager=e.sidebarNavInputManager,this.toolbarNode=e.toolbarNode,this.serviceRegistry=e.serviceRegistry,this.progressService=e.progressService,this.fsToolbar=null,this.explorer=null,this.lastRoot=null;var t=this;this.sidebarNavInputManager.addEventListener("InputChanged",function(e){t.lastRoot=e.input}),this.sidebar.addViewMode(this.id,this)}var l=i.CommonNavExplorer,c=i.CommonNavRenderer;return r.prototype=Object.create(l.prototype),t.mixin(r.prototype,{reroot:function(e){return this.scope(""),this.loadRoot(this.fileClient.fileServiceRootURL(e.Location)).then(function(){return this.showItem(e,!1)}.bind(this))}}),s.prototype=Object.create(c.prototype),t.mixin(a.prototype,{label:e.Navigator,id:"nav",create:function(){var e=this;this.explorer=new r({preferences:this.preferences,commandRegistry:this.commandRegistry,fileClient:this.fileClient,editorInputManager:this.editorInputManager,sidebar:this.sidebar,sidebarNavInputManager:this.sidebarNavInputManager,parentId:this.parentNode.id,rendererFactory:function(t){return new s({checkbox:!1,treeTableClass:"miniNavTreeTable",cachePrefix:"MiniNav"},t,e.commandRegistry,e.contentTypeRegistry)},serviceRegistry:this.serviceRegistry,toolbarNode:this.toolbarNode,progressService:this.progressService}),this.fsSwitcher=new o.FilesystemSwitcher({commandRegistry:this.commandRegistry,rootChangeListener:this.explorer,filesystemChangeDispatcher:this.explorer.sidebarNavInputManager,fileClient:this.fileClient,node:this.toolbarNode,serviceRegistry:this.serviceRegistry});var t=n.matchResourceParameters(),i=t.navigate,a=t.resource,l=i||this.lastRoot||this.fileClient.fileServiceRootURL(a||"");this.explorer.display(l)},destroy:function(){this.explorer&&(this.explorer.destroy(),this.explorer=null),this.fsSwitcher&&this.fsSwitcher.destroy()}}),a}),define("orion/widgets/nav/project-nav",["i18n!orion/edit/nls/messages","orion/i18nUtil","orion/objects","orion/webui/littlelib","orion/explorers/explorer-table","orion/widgets/nav/common-nav","orion/projectCommands","orion/PageUtil","orion/URITemplate","orion/Deferred","orion/customGlobalCommands","orion/bidiUtils"],function(e,t,i,n,o,r,s,a,l,c,d,h){function u(e,t,i,n,o,r,s,a){this.projectClient=s,this.project=t,this.fileMetadata=a,_.apply(this,arguments)}function p(e){this.projectClient=e.projectClient,m.apply(this,arguments);var t=this;this.dependenciesDisplatcher=s.getDependencyDispatcher(),this.dependneciesListener=function(){t.changedItem.call(t)},this._dependenciesEventTypes=["create","delete"],this._dependenciesEventTypes.forEach(function(e){t.dependenciesDisplatcher.addEventListener(e,t.dependneciesListener)})}function f(){v.apply(this,arguments)}function g(e){this.preferences=e.preferences,this.commandRegistry=e.commandRegistry,this.contentTypeRegistry=e.contentTypeRegistry,this.fileClient=e.fileClient,this.editorInputManager=e.editorInputManager,this.parentNode=e.parentNode,this.sidebarNavInputManager=e.sidebarNavInputManager,this.toolbarNode=e.toolbarNode,this.serviceRegistry=e.serviceRegistry,this.projectClient=this.serviceRegistry.getService("orion.project.client"),this.sidebar=e.sidebar,this.progressService=e.progressService,this.explorer=null;var t=this,i=this.sidebar;this.editorInputManager.addEventListener("InputChanged",function(e){t.showViewMode(e.metadata&&!e.metadata.Projects),i.getActiveViewModeId()||i.setViewMode(i.getDefaultViewModeId())})}var m=r.CommonNavExplorer,v=r.CommonNavRenderer,_=o.FileModel,y=new l("#{,resource,params*}");return u.prototype=Object.create(_.prototype),i.mixin(u.prototype,{processParent:function(e,t){var i=_.prototype.processParent.call(this,e,t);e.Project||(e.Project=this.project);for(var n=0;n<t.length;n++)t[n].Project=this.project;return i},getChildren:function(e,t){if(e.children)return void t(this.processParent(e,e.children));if("Project"===e.type){var n=[];return this.fileMetadata.type="ProjectRoot",n.push(this.fileMetadata),void c.all((e.Dependencies||[]).map(function(t){var o={Dependency:t,Project:e};return n.push(o),this.projectClient.getDependencyFileMetadata(t,e.WorkspaceLocation).then(function(e){i.mixin(o,e)},function(){o.Directory=o.disconnected=!0})}.bind(this))).then(function(){this.processParent(e,n),n.splice(n.indexOf(this.fileMetadata),1),n.splice(0,0,this.fileMetadata),t(n)}.bind(this))}return _.prototype.getChildren.call(this,e,t)},getId:function(e){return"Project"===e.type?e={Location:e.ContentLocation}:e.Dependency&&e.disconnected&&(e=e.Dependency),_.prototype.getId.call(this,e)},hasChildren:function(){return!0}}),p.prototype=Object.create(m.prototype),i.mixin(p.prototype,{onFileModelChange:function(e){var t=e.oldValue,i=e.newValue;return t.ChildrenLocation===this.treeRoot.ContentLocation?void this.sidebarNavInputManager.dispatchEvent({type:"editorInputMoved",parent:i?i.ChildrenLocation||i.ContentLocation:null,newInput:i?i.ChildrenLocation||i.ContentLocation:null}):void m.prototype.onFileModelChange.call(this,e)},display:function(e,t){if(!e)return(new c).reject();var i=e;return this.projectClient.getProject(e).then(function(n){e=n,this.fileMetadata=e;var o;if(e&&e.Parents&&0===e.Parents.length?o=e:e&&e.Parents&&(o=e.Parents[e.Parents.length-1]),t||!o||o.Location!==this.projectLocation){var r=this.sidebar,s=function(e){e.item===i&&(r.sidebarNavInputManager.removeEventListener("projectDisplayed",s),r.sidebarNavInputManager.dispatchEvent({type:"projectOpened",item:i}))};return r.sidebarNavInputManager.addEventListener("projectDisplayed",s),this.projectClient.readProject(e,this.workspaceMetadata).then(function(i){return this.projectLocation=o?o.Location:null,i.type="Project",i.Directory=!0,i.fileMetadata=e,m.prototype.display.call(this,i,t).then(function(){return this.expandItem(e)}.bind(this)).then(function(){this.sidebarNavInputManager.dispatchEvent({type:"projectDisplayed",item:e})}.bind(this))}.bind(this))}}.bind(this))},loadResourceList:function(e){e&&"object"==typeof e&&(e=e.ChildrenLocation||e.ContentLocation),this.treeRoot&&e===this.treeRoot.ContentLocation?this.display(this.fileMetadata,!0):this.scopeUp()},createModel:function(){return new u(this.registry,this.treeRoot,this.fileClient,this.parentId,this.excludeFiles,this.excludeFolders,this.projectClient,this.fileMetadata)},reroot:function(e){var t=new c;return this.projectClient.getProject(e).then(function(i){this.display(i),t.resolve(e)}.bind(this),function(){this.scopeUp(e.Location),t.reject()}.bind(this)),t},registerCommands:function(){return m.prototype.registerCommands.call(this).then(function(){var t=this.commandRegistry,i=this.fileActionsScope;t.registerCommandContribution("dependencyCommands","orion.project.dependency.connect",1),t.registerCommandContribution("dependencyCommands","orion.project.dependency.disconnect",2),t.registerCommandContribution(i,"orion.project.create.readme",5,"orion.menuBarFileGroup/orion.newContentGroup");var n=0;t.addCommandGroup(i,"orion.newDependency",6,e.Dependency,"orion.menuBarFileGroup/orion.newContentGroup"),s.getAddDependencyCommands(t).forEach(function(e){t.registerCommandContribution(i,e.id,n++,"orion.menuBarFileGroup/orion.newContentGroup/orion.newDependency")})}.bind(this))},scopeDown:!1,scopeUp:function(){var e=a.matchResourceParameters(),t=e.resource;delete e.navigate,delete e.resource,window.location.href=y.expand({resource:t,params:e}),this.sidebar.setViewMode("nav")},getTreeRoot:function(){return this.fileMetadata},changedItem:function(e,t){return e&&this.model?e.Projects?(new c).resolve():m.prototype.changedItem.call(this,e,t):(this.fileMetadata.children=null,this.display(this.fileMetadata,!0))},destroy:function(){var e=this;this._dependenciesEventTypes.forEach(function(t){e.dependenciesDisplatcher.removeEventListener(t,e.dependneciesListener)}),e.launchConfigurationListener&&this._launchConfigurationEventTypes.forEach(function(t){e.launchConfigurationDispatcher.removeEventListener(t,e.launchConfigurationListener)}),m.prototype.destroy.call(this)}}),f.prototype=Object.create(v.prototype),i.mixin(f.prototype,{getCellElement:function(i,o,r){var s=v.prototype.getCellElement.call(this,i,o,r);if((o.Dependency||"ProjectRoot"===o.type)&&0===i){s.className="ProjectRoot"===o.type?"projectNavColumn projectPrimaryNavColumn":"projectNavColumn";var a=n.$(".mainNavColumn",s);a.classList.add("projectInformationNode");var l=o.Dependency?o.Dependency.Name:o.Project?o.Project.Name:o.Name;h.isBidiEnabled&&(l=h.enforceTextDirWithUcc(l));var c=n.$("a",s);if(o.disconnected&&(l=t.formatMessage(e.Disconnected,l),c.removeAttribute("href")),n.empty(c),c.appendChild(document.createTextNode(l)),o.Dependency){var d=document.createElement("span");d.className="mainNavColumn",d.style.cssFloat="right",this.explorer.commandRegistry.renderCommands("dependencyCommands",d,o,this,"tool"),s.appendChild(d)}return s}return s}}),i.mixin(g.prototype,{label:e.Project,id:"projectNav",create:function(){var e=this;this.explorer=new p({preferences:this.preferences,commandRegistry:this.commandRegistry,fileClient:this.fileClient,editorInputManager:this.editorInputManager,sidebar:this.sidebar,sidebarNavInputManager:this.sidebarNavInputManager,parentId:this.parentNode.id,projectClient:this.projectClient,rendererFactory:function(t){return new f({checkbox:!1,treeTableClass:"miniNavTreeTable",cachePrefix:"ProjectNav"},t,e.commandRegistry,e.contentTypeRegistry)},serviceRegistry:this.serviceRegistry,toolbarNode:this.toolbarNode,progressService:this.progressService}),this.explorer.workspaceMetadata=this.workspaceMetadata,this.explorer.display(this.editorInputManager.getFileMetadata()),this.toolbarNode.parentNode.classList.add("projectNavSidebarWrapper")},destroy:function(){this.explorer&&this.explorer.destroy(),this.explorer=null,this.toolbarNode.parentNode.classList.remove("projectNavSidebarWrapper")},showViewMode:function(e){var t=this.sidebar,i=!!t.getViewMode(this.id);i!==e&&(e?(t.addViewMode(this.id,this),t.renderViewModeMenu()):(t.removeViewMode(this.id),t.renderViewModeMenu()))}}),g}),define("text!orion/search/InlineSearchPane.html",[],function(){return'<div class="searchOptWrapperDiv">\r\n	<div class="searchMainOptionBlock">\r\n		<!-- search box gets inserted here -->\r\n		<div id="replaceWrapper" class="replaceWrapper replaceWrapperHidden">\r\n		<!-- replace box gets inserted here -->\r\n		</div>\r\n		<a id="toggleReplaceLink" class="toggleDisplayLink"></a>\r\n	</div>\r\n	<div class="searchParamBlockDiv">\r\n		<div class="searchOptionBlock">\r\n			<span class="searchOption">\r\n				<input type="checkbox" id="advSearchCaseSensitive" class="searchCheckbox">\r\n				<label id="advSearchCaseSensitiveLabel" class="searchCheckboxLabel" for="advSearchCaseSensitive"></label>\r\n			</span>\r\n			<span class="searchOption">\r\n				<input type="checkbox" id="advSearchWholeWord" class="searchCheckbox">\r\n				<label id="advSearchWholeWordLabel" class="searchCheckboxLabel" for="advSearchWholeWord"></label>\r\n			</span>\r\n			<span class="searchOption">\r\n				<input type="checkbox" id="advSearchRegEx" class="searchCheckbox">\r\n				<label id="advSearchRegExLabel" class="searchCheckboxLabel" for="advSearchRegEx"></label>\r\n			</span>\r\n		</div>\r\n		<div class="searchOptionBlock">\r\n			<div class="searchOption">\r\n				<div id="fileNamePatternsLabel" class="searchLabel"></div>\r\n				<!-- file name patterns box gets inserted here -->\r\n				<span id="fileNamePatternsHint" class="fileNamePatternsHint"></span>\r\n			</div>\r\n	\r\n			<div class="searchOption">\r\n				<div id="searchScope" class="searchScope">\r\n					<div id="searchScopeLabel" class="searchLabel"></div>\r\n					<span id="searchScopeInputWrapper" class="searchScopeInputWrapper">\r\n						<span id="searchScopeElementWrapper" class="searchScopeElementWrapper"></span>\r\n						<button id="searchScopeSelectButton" class="commandButton core-sprite-outline searchScopeSelectButton"></button>\r\n					</span>\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n<a id="toggleSearchOptionsLink" class="toggleDisplayLink toggleSearchOptionsLink linkHidden"></a>\r\n<div id="searchResultsTitle" class="searchResultsTitle"></div>\r\n<div id="searchPageActions" class="searchPageActions layoutLeft"></div>\r\n<div id="searchPageActionsRight" class="searchPageActions  searchPageActionsRight layoutRight"></div>\r\n<div class="searchResultsWrapperDiv"></div>\r\n'
}),define("orion/searchClient",["i18n!orion/search/nls/messages","orion/webui/littlelib","orion/i18nUtil","orion/searchUtils","orion/crawler/searchCrawler","orion/Deferred"],function(e,t,i){function n(e){this._registry=e.serviceRegistry,this._commandService=e.commandService,this._fileClient=e.fileService}return n.prototype={getFileService:function(){return this._fileClient},setLocationByMetaData:function(n,o){var r="",s=null;this._searchRootLocation=this._fileClient.fileServiceRootURL(n.Location),o&&n&&n.Parents&&n.Parents.length>0?s="last"===o.index?n.Parents[n.Parents.length-1]:n.Parents[0]:n&&n.Directory&&n.Location&&n.Parents&&(s=n),s?(this.setLocationbyURL(s.Location),r=s.Name,this._childrenLocation=s.ChildrenLocation):n&&(this.setLocationbyURL(this._searchRootLocation),r=this._fileClient.fileServiceName(n.Location),this._childrenLocation=n.ChildrenLocation);var a=t.node("search");if(r||(r=""),this._searchLocationName=r,a&&a.placeholder){a.value="";var l=i.formatMessage(e["Search ${0}"],r);a.placeholder=l.length>30?l.substring(0,27)+"...":i.formatMessage(e["Search ${0}"],r)}a&&a.title&&(a.title=e.TypeKeyOrWildCard+r)},setLocationbyURL:function(e){this._searchLocation=e},setRootLocationbyURL:function(e){this._searchRootLocation=e},setChildrenLocationbyURL:function(e){this._childrenLocation=e},getSearchLocation:function(){return this._searchLocation?this._searchLocation:this._fileClient.fileServiceRootURL()},getSearchLocationName:function(){return this._searchLocationName},getSearchRootLocation:function(){return this._searchRootLocation?this._searchRootLocation:this._fileClient.fileServiceRootURL()},getChildrenLocation:function(){return this._childrenLocation?this._childrenLocation:this._fileClient.fileServiceRootURL()},createSearchParams:function(e,t,i,n){var o=i?this.getSearchRootLocation():this.getSearchLocation();return t?{resource:o,sort:"NameLower asc",rows:100,start:0,nameSearch:!0,keyword:e}:{resource:o,sort:n&&n.sort?n.sort:"Path asc",rows:n&&n.rows?n.rows:40,start:0,caseSensitive:n?n.caseSensitive:void 0,wholeWord:n?n.wholeWord:void 0,regEx:n?n.regEx:void 0,fileType:n?n.fileType:void 0,fileNamePatterns:n&&n.fileNamePatterns?n.fileNamePatterns:void 0,keyword:e,replace:n?n.replace:void 0}}},n.prototype.constructor=n,{Searcher:n}}),define("orion/compare/nls/messages",{root:!0,de:!0,es:!0,fr:!0,it:!0,ja:!0,ko:!0,"pt-br":!0,zh:!0,"zh-hk":!0,"zh-tw":!0}),define("orion/compare/nls/root/messages",{CpCurChangeRightToLeft:"Copy current change from right to left",CpCurChangeLeftToRight:"Copy current change from left to right","Switch to unified diff":"Switch to unified diff",Unified:"Unified","Switch to side by side diff":"Switch to side by side diff","Side by side":"Side by side",GenerateCurDiffLink:"Generate link of the current diff","Generate Link":"Generate Link","Next diff block":"Next diff block","Previous diff block":"Previous diff block","Next diff change":"Next diff change","Previous diff change":"Previous diff change","Copy the link URL:":"Copy the link URL:",Compare:"Compare","Open the compare page":"Open the compare page","fetching...":"fetching...","Removed Submodule Message":"Removed submodule files that are not yet committed, discard this change will not bring the files back","Added Submodule Message":"Added submodule files that are not yet committed, to view the actual files please open its own repository","There are unsaved changes.":"There are unsaved changes.","ERROR: ":"ERROR: ","Compare...":"Compare...","n of t files changed":"${0} of ${1} files changed",Location:"Location",Options:"Options","Sort by folders":"Sort by folders","Line 0 : Col 0":"Line 0 : Col 0",NoDiffServiceLocationMatched:"No Matching DiffService for location:",NoFoldersIdentical:"${0} files compared. The two folders are identical.",generatingTreeResult:"Generating compare result...",fetchingFolder:"Fetching folder: ${0}...",readingFile:"Reading file: ${0}...",readingFileMetadata:"Reading file metadata: ${0}...",comparingFile:"Comparing: ${0}...",compareTreeTitle:"Compare Folders",IgnoreWhitespace:"Ignore white space",IgnoreWhitespaceTooltip:"Ignore white space where applicable",UseWhitespace:"Use white space",UseWhitespaceTooltip:"Compare white space where applicable",confirmUnsavedChanges:"There are unsaved changes. Do you want to save them?","word added":"word added","word deleted":"word deleted"}),define("orion/compare/diffParser",[],function(){var e=e||{};return e.DiffParser=function(){function e(e,i){this._lineDelimiter=e?e:t?"\r\n":"\n",this._diffLineDelimiter=i?i:this._lineDelimiter,this._DEBUG=!1}var t=-1!==window.navigator.platform.indexOf("Win"),i="\\ No newline at end of file";return e.prototype={_init:function(){this._oFileContents=[],this._diffContents=[],this._oBlocks=[],this._nBlocks=[],this._hunkRanges=[],this._lastToken=" ",this._deltaMap=[],this._nFileContents=[],this._oNewLineAtEnd=!0,this._nNewLineAtEnd=!0,this._diffContentIndex=1},getOriginalBlocks:function(){return this._oBlocks},getNewBlocks:function(){return this._nBlocks},setLineDelim:function(e){this._lineDelimiter=e,this._diffLineDelimiter=e},getDiffArray:function(){return{array:this._diffContents,index:this._diffContentIndex}},parse:function(e,t,i,n){if(this._init(),""===t)return{outPutFile:e,mapper:[]};this._oFileContents=""===e?[]:e.split(this._lineDelimiter),this._diffContents=t.split(this._diffLineDelimiter);var o={};o.mapper=[];var r=this._diffContents.length;this._hunkRanges=[];for(var s=0;r>s;s++){this._addFileModeProperties(this._diffContents[s],o);var a=this._parseHunkRange(s);a&&this._hunkRanges.push(a)}if(0===this._hunkRanges.length)return o.outPutFile=e,o;this._DEBUG&&(console.log("***Diff contents: \n"),this._diffContents.forEach(function(e){console.log(e)}),console.log("***Hunk ranges: \n"),console.log(JSON.stringify(this._hunkRanges)));for(var l=0;l<this._hunkRanges.length;l++)this._parseHunkBlock(l);return this._DEBUG&&(console.log("***Original Hunk range blocks: \n"),console.log(JSON.stringify(this._oBlocks)),console.log("***New Hunk range blocks: \n"),console.log(JSON.stringify(this._nBlocks))),this._buildMap(i),this._DEBUG&&(console.log("***New Line at end of file(original): \n"),console.log(JSON.stringify(this._oNewLineAtEnd)),console.log("***New Line at end of file(new): \n"),console.log(JSON.stringify(this._nNewLineAtEnd)),console.log("***Mapper: \n"),this._logMap(),console.log("***Total line number in original file: "+this._oFileContents.length)),n||this._buildNewFile(),this._DEBUG,o.outPutFile=this._nFileContents.join(this._diffLineDelimiter),o.mapper=this._deltaMap,o},_addFileModeProperties:function(e,t){function i(e,t){return 0===e.lastIndexOf(t,0)}i(e,"-")||i(e,"+")||i(e,"@")||(i(e,"deleted file mode")&&(t.deletedFileMode=e.split("deleted file mode")[1].match(/[^ ]+/g)[0]),i(e,"new file mode")&&(t.newFileMode=e.split("new file mode")[1].match(/[^ ]+/g)[0]),i(e,"old mode")&&(t.oldMode=e.split("old mode")[1].match(/[^ ]+/g)[0]),i(e,"new mode")&&(t.newMode=e.split("new mode")[1].match(/[^ ]+/g)[0]))},_logMap:function(){for(var e=0;e<this._deltaMap.length;e++)if(console.log(JSON.stringify(this._deltaMap[e])),this._deltaMap[e][2]>0){console.log("    **Diff content on change/add: \n");for(var t=0;t<this._deltaMap[e][0];t++)console.log("    "+this._diffContents[this._deltaMap[e][2]+t-1])}},_logNewFile:function(){for(var e=0;e<this._nFileContents.length;e++)console.log(this._nFileContents[e])},_createBlock:function(e,t,i,n){if(n!==i||" "!==e){var o=[i,n-i,"s"];"-"===e?o[2]="r":"+"===e?o[2]="a":"c"===e&&(o[2]="c"),t.push(o)}},_createMinusBlock:function(e,t,i,n){var o=this._oBlocks.length;0===o||e!==this._oBlocks[o-1][0]?(this._oBlocks.push([0===e?1:e,i,n]),this._nBlocks.push([t,0,-2])):(this._oBlocks[o-1][1]=this._oBlocks[o-1][1]+i,this._oBlocks[o-1][2]=n)},_createPlusBlock:function(e,t,i,n){var o=this._nBlocks.length;0===o||t!==this._nBlocks[o-1][0]?(this._oBlocks.push([0===e?1:e,0]),this._nBlocks.push([t,i,n])):(this._nBlocks[o-1][1]=this._nBlocks[o-1][1]+i,this._nBlocks[o-1][2]=n)},_parseHunkBlock:function(e){for(var t=" ",n=this._hunkRanges[e][0]+1,o=e===this._hunkRanges.length-1?this._diffContents.length:this._hunkRanges[e+1][0],r=0,s=0,a=this._hunkRanges[e][1],l=this._hunkRanges[e][3],c=n,d=n,h=n;o>h;h++)if(0!==this._diffContents[h].length){var u=this._diffContents[h][0];if("\\"!==u||i!==this._diffContents[h].substring(0,this._diffContents[h].length-1)&&i!==this._diffContents[h]){switch(u){case"-":case"+":case" ":break;default:continue}if(t!==u){switch("+"===u&&(c=h),"-"===u&&(d=h),t){case" ":a=this._hunkRanges[e][1]+r,l=this._hunkRanges[e][3]+s;break;case"-":this._createMinusBlock(a,l,this._hunkRanges[e][1]+r-a,d);break;case"+":this._createPlusBlock(a,l,this._hunkRanges[e][3]+s-l,c)}t=u}switch(u){case"-":r++;break;case"+":s++;break;case" ":r++,s++}}else"-"===t?this._oNewLineAtEnd=!1:" "===t?(this._nNewLineAtEnd=!1,this._oNewLineAtEnd=!1):this._nNewLineAtEnd=!1,h>n&&"\r"===this._diffContents[h-1][this._diffContents[h-1].length-1]&&(this._diffContents[h-1]=this._diffContents[h-1].substring(0,this._diffContents[h-1].length-1))}switch(t){case"-":this._createMinusBlock(a,l,this._hunkRanges[e][1]+r-a,d);break;case"+":this._createPlusBlock(a,l,this._hunkRanges[e][3]+s-l,c)}},_detectConflictes:function(e,t){if(0>e)return!1;for(var i=e+t,n=e;i>n;n++){var o=this._diffContents[n];if(o.indexOf("<<<<<")>-1||o.indexOf(">>>>>")>-1)return!0}return!1},_buildMap:function(e){for(var t,i=this._oBlocks.length,n=this._oFileContents.length,o=0,r=1,s=0;i>s;s++)t=this._oBlocks[s][0]-r,t>0&&(this._deltaMap.push([t,t,0]),o+=t),this._deltaMap.push(e&&this._detectConflictes(this._nBlocks[s][2],this._nBlocks[s][1])?[this._nBlocks[s][1],this._oBlocks[s][1],this._nBlocks[s][2]+1,1]:[this._nBlocks[s][1],this._oBlocks[s][1],this._nBlocks[s][2]+1]),o+=this._oBlocks[s][1],r=this._oBlocks[s][0]+this._oBlocks[s][1];if(n-r>0&&(this._deltaMap.push([n-r+1,n-r+1,0]),o+=n-r+1),n>o){t=n-o;var a=this._deltaMap[this._deltaMap.length-1];0===a[2]?(a[0]+=t,a[1]+=t):-1===a[2]?this._deltaMap.push([t,t,0]):this._nNewLineAtEnd===this._oNewLineAtEnd?this._deltaMap.push([t,t,0]):(this._nNewLineAtEnd&&(a[0]+=t),this._oNewLineAtEnd&&(a[1]+=t))}},_buildNewFile:function(){var e,t,i=1,n=!1,o=this._deltaMap.length;for(e=0;o>e;e++){if(n=!1,0===this._deltaMap[e][2]){for(t=0;t<this._deltaMap[e][0];t++)this._nFileContents.push(this._oFileContents[i+t-1]);n=!0}else if(this._deltaMap[e][2]>0)for(t=0;t<this._deltaMap[e][0];t++)this._nFileContents.push(this._diffContents[this._deltaMap[e][2]+t-1].substring(1));i+=this._deltaMap[e][1]}this._nNewLineAtEnd&&!n&&this._nFileContents.push("")},_converHRangeBody:function(e,t){if(e){var i=parseInt(e,10);t.push(i>=0?i:1)}else t.push(1)},_parseHunkRange:function(e){var t=this._diffContents[e],i=/^@@\s*-([\+|\-]*[\d]+)\s*,*\s*([\d]*)\s*\+([\+|\-]*[\d]+)\s*,*\s*([\d]*)\s*@@+/,n=/^@@\s*\+([\+|\-]*[\d]+)\s*,*\s*([\d]*)\s*-([\+|\-]*[\d]+)\s*,*\s*([\d]*)\s*@@+/,o=i.exec(t),r=null;return o&&5===o.length?(r=[e],this._converHRangeBody(o[1],r),this._converHRangeBody(o[2],r),this._converHRangeBody(o[3],r),this._converHRangeBody(o[4],r)):(o=n.exec(t),o&&5===o.length&&(r=[e],this._converHRangeBody(o[3],r),this._converHRangeBody(o[4],r),this._converHRangeBody(o[1],r),this._converHRangeBody(o[2],r))),r}},e}(),e}),define("orion/compare/compareRulers",["orion/compare/compareUtils"],function(e){var t=t||{};return t.CompareRuler=function(){function e(e,t,i){this._location=e||"left",this._overview=t||"page",this._rulerStyle=i,this._editor=null;var n=this;this._listener={onModelChanged:function(e){n._onModelChanged(e)}}}return e.prototype={setView:function(e){this._onModelChanged&&this._editor&&this._editor.removeEventListener("ModelChanged",this._listener.onModelChanged),this._editor=e,this._onModelChanged&&this._editor&&this._editor.addEventListener("ModelChanged",this._listener.onModelChanged)},getLocation:function(){return this._location},getOverview:function(){return this._overview},getAnnotationModel:function(){return null},addAnnotationType:function(){},isAnnotationTypeVisible:function(){return!1},removeAnnotationType:function(){},setAnnotationModel:function(){},getAnnotations:function(e,t){for(var i=[],n=e;t>n;n++){var o=this.getStyle(n);o&&(i[n]={html:this.getHTML(n),style:o})}return i},getWidestAnnotation:function(){return{html:this.getHTML(-1),style:this.getStyle(-1)}},getRulerStyle:function(){return this.getStyle(void 0)}},e}(),t.LineNumberCompareRuler=function(){function e(e,i,n,o,r,s){t.CompareRuler.call(this,n,"page",o),this._diffNavigator=e,this._oddStyle=r||{style:{backgroundColor:"white"}},this._evenStyle=s||{style:{backgroundColor:"white"}},this._numOfDigits=0,this._mapperColumnIndex=i}return e.prototype=new t.CompareRuler,e.prototype.getStyle=function(e){return void 0===e?this._rulerStyle:this._evenStyle},e.prototype.getHTML=function(e){var t=this._editor.getModel(),i=this._diffNavigator.getFeeder(0===this._mapperColumnIndex);if(!i)return"";if(-1===e)return t.getLineCount();if(i.getLineNumber){var n=i.getLineNumber(e);return-1===n?"":n+1}return e+1},e.prototype._onModelChanged=function(e){var t=e.start,i=this._editor.getModel(),n=i.getLineCount(),o=(n+"").length;if(this._numOfDigits!==o){this._numOfDigits=o;var r=i.getLineAtOffset(t);this._editor.redrawLines(r,n,this)}},e}(),t.CompareOverviewRuler=function(){function i(e,i,n,o){this._diffNavigator=n,this._onClick=o,t.CompareRuler.call(this,e,"document",i)}return i.prototype=new t.CompareRuler,i.prototype.getStyle=function(t){var i,n;if(void 0===t)i=this._rulerStyle||{},n=i.style||(i.style={}),n.lineHeight="1px",n.fontSize="1px",n.width="14px";else{if(i=-1!==t?{styleClass:"annotationOverview breakpoint"}||{}:{},n=i.style||(i.style={}),n.cursor="pointer",n.width="8px",n.left="2px",!(t>=0))return null;var o;if(!this._diffNavigator||!this._diffNavigator.getFeeder())return null;o=this._diffNavigator.getFeeder().getDiffBlocks();var r=e.getAnnotationIndex(o,t);if(-1===r)return null;var s,a=e.getAnnotationMapperIndex(o,r);s=this._diffNavigator.getMapper();var l=e.isMapperConflict(s,a);l&&(n.border="1px #FF0000 solid"),r===this._diffNavigator.getCurrentBlockIndex()&&(n.backgroundColor=l?"red":"blue");var c=this._diffNavigator.getFeeder().getDiffBlockH(r),d=this._diffNavigator.getFeeder().getOverviewLineCount();if(0>c)return null;var h=this._editor.getClientArea(),u=Math.floor(h.height*c/d);2>u&&(u=2),n.height=u+"px"}return i},i.prototype.setDiffNavigator=function(e){this._diffNavigator=e},i.prototype.getHTML=function(){return"&nbsp;"},i.prototype.onClick=function(e){void 0!==e&&this._onClick(e,this)},i.prototype._onModelChanged=function(){var e=this._editor.getModel(),t=e.getLineCount();t>0&&this._editor.redrawLines(0,1,this)},i}(),t.CompareCurveRuler=function(){function t(e){this._canvasDiv=e,this._mapper=void 0}return t.prototype={init:function(e,t,i,n){this._leftIniting=!0,this._rightIniting=!0,this._rightIniting=!0,this._mapper=e,this._leftEditor=t,this._rightEditor=i,this._leftTextView=t.getTextView(),this._rightTextView=i.getTextView(),this._diffNavigator=n,this.render()},matchPositionFrom:function(t){var i=t?this._leftTextView:this._rightTextView,n=t?this._rightTextView:this._leftTextView,o=i.getTopIndex(),r=i.getBottomIndex(),s=e.matchMapper(this._mapper,t?0:1,o,r);n.setTopIndex(s)},copyTo:function(e){if(this._diffNavigator.iterator){var t=this._diffNavigator.iterator.cursor();if(t){var i;if(i="word"===t.type?!t.copied&&!t.parent.copied:!t.copied,!i)return;var n=e?this._rightTextView.getText(t.oldA.start,t.oldA.end):this._leftTextView.getText(t.newA.start,t.newA.end),o=e?t.newA:t.oldA,r=e?this._leftTextView:this._rightTextView;r.setText(n,o.start,o.end),t.copied=!0}}},render:function(){if(this._mapper){var t=this._canvasDiv.getContext("2d");t.clearRect(0,0,this._canvasDiv.width,this._canvasDiv.height),t.strokeStyle="#AAAAAA",t.lineWidth=1,t.beginPath();var i=this._leftTextView.getTopIndex(),n=this._leftTextView.getBottomIndex(),o=this._rightTextView.getTopIndex(),r=this._rightTextView.getBottomIndex();this._leftLineH=this._leftTextView.getLineHeight(),this._rightLineH=this._rightTextView.getLineHeight();for(var s=0,a=0,l=!1,c=0;c<this._mapper.length;c++){if(0!==this._mapper[c][2])if(e.overlapMapper(this._mapper[c],0,s,i,n)||e.overlapMapper(this._mapper[c],1,a,o,r))this._renderCurve(c,s,a,this._canvasDiv,t,i,n,o,r),l=!0;else if(l)break;s+=this._mapper[c][0],a+=this._mapper[c][1]}t.stroke()}},_renderCurve:function(e,t,i,n,o){var r=this._mapper[e],s=this._leftTextView.getLinePixel(t+r[0]/2)+r[0]%2*this._leftLineH/3-this._leftTextView.getTopPixel(),a=this._rightTextView.getLinePixel(i+r[1]/2)+r[1]%2*this._rightLineH/3-this._rightTextView.getTopPixel(),l=n.parentNode.clientWidth;return e===this._diffNavigator.getCurrentMapperIndex()?(o.stroke(),o.strokeStyle="#000",o.lineWidth=1,o.beginPath(),o.moveTo(0,s),o.bezierCurveTo(l/3,s,.666*l,a,l,a),o.stroke(),o.strokeStyle="#AAAAAA",o.lineWidth=1,void o.beginPath()):(o.moveTo(0,s),o.bezierCurveTo(l/3,s,.666*l,a,l,a),void o.stroke())},onChanged:function(t,i){var n=i?this._rightIniting:this._leftIniting;if(t.removedLineCount!==t.addedLineCount){var o=i?this._rightTextView:this._leftTextView;n||e.updateMapper(this._mapper,i?1:0,o.getModel().getLineAtOffset(t.start),t.removedLineCount,t.addedLineCount),(t.removedLineCount>0||t.addedLineCount>0)&&this.render()}return i?this._rightIniting=!1:this._leftIniting=!1,n}},t}(),t}),define("orion/editor/keyModes",["orion/keyBinding","orion/util"],function(e,t){function i(e){e&&(this._view=e,this._keyBindings=this.createKeyBindings(),this._keyBindingIndex=0)}function n(e){i.call(this,e)}return i.prototype={createKeyBindings:function(){return[]},getKeyBindings:function(e){for(var t=[],i=this._keyBindings,n=0;n<i.length;n++)i[n].actionID===e&&t.push(i[n].keyBinding);return t},getView:function(){return this._view},isActive:function(){return-1!==this._view.getKeyModes().indexOf(this)},match:function(e){if("keydown"===e.type)switch(e.keyCode){case 16:case 17:case 18:case 91:return void 0}for(var t=this._keyBindingIndex,i=this._matchingKeyBindings||this._keyBindings,n=[],o=0;o<i.length;o++){var r=i[o],s=r.keyBinding,a=s.match(e,t);if(a===!0)return this._keyBindingIndex=0,this._matchingKeyBindings=null,r.actionID;"number"==typeof a&&n.push(r)}return 0!==n.length?(this._keyBindingIndex++,this._matchingKeyBindings=n,"noop"):(this._keyBindingIndex=0,void(this._matchingKeyBindings=null))},setKeyBinding:function(e,t){for(var i=this._keyBindings,n=0;n<i.length;n++){var o=i[n];if(o.keyBinding.equals(e))return void(t?o.actionID=t:o.predefined?o.actionID="noop":i.splice(n,1))}t&&i.push({keyBinding:e,actionID:t})},setView:function(e){this._view=e}},n.prototype=new i,n.prototype.createKeyBindings=function(){var i=e.KeyBinding,n=[];if(n.push({actionID:"lineUp",keyBinding:new i(38),predefined:!0}),n.push({actionID:"lineDown",keyBinding:new i(40),predefined:!0}),n.push({actionID:"charPrevious",keyBinding:new i(37),predefined:!0}),n.push({actionID:"charNext",keyBinding:new i(39),predefined:!0}),t.isMac?(n.push({actionID:"scrollPageUp",keyBinding:new i(33),predefined:!0}),n.push({actionID:"scrollPageDown",keyBinding:new i(34),predefined:!0}),n.push({actionID:"pageUp",keyBinding:new i(33,null,null,!0),predefined:!0}),n.push({actionID:"pageDown",keyBinding:new i(34,null,null,!0),predefined:!0}),n.push({actionID:"lineStart",keyBinding:new i(37,!0),predefined:!0}),n.push({actionID:"lineEnd",keyBinding:new i(39,!0),predefined:!0}),n.push({actionID:"wordPrevious",keyBinding:new i(37,null,null,!0),predefined:!0}),n.push({actionID:"wordNext",keyBinding:new i(39,null,null,!0),predefined:!0}),n.push({actionID:"scrollTextStart",keyBinding:new i(36),predefined:!0}),n.push({actionID:"scrollTextEnd",keyBinding:new i(35),predefined:!0}),n.push({actionID:"textStart",keyBinding:new i(38,!0),predefined:!0}),n.push({actionID:"textEnd",keyBinding:new i(40,!0),predefined:!0}),n.push({actionID:"scrollPageUp",keyBinding:new i(38,null,null,null,!0),predefined:!0}),n.push({actionID:"scrollPageDown",keyBinding:new i(40,null,null,null,!0),predefined:!0}),n.push({actionID:"lineStart",keyBinding:new i(37,null,null,null,!0),predefined:!0}),n.push({actionID:"lineEnd",keyBinding:new i(39,null,null,null,!0),predefined:!0}),n.push({actionID:"lineStart",keyBinding:new i(38,null,null,!0),predefined:!0}),n.push({actionID:"lineEnd",keyBinding:new i(40,null,null,!0),predefined:!0})):(n.push({actionID:"pageUp",keyBinding:new i(33),predefined:!0}),n.push({actionID:"pageDown",keyBinding:new i(34),predefined:!0}),n.push({actionID:"lineStart",keyBinding:new i(36),predefined:!0}),n.push({actionID:"lineEnd",keyBinding:new i(35),predefined:!0}),n.push({actionID:"wordPrevious",keyBinding:new i(37,!0),predefined:!0}),n.push({actionID:"wordNext",keyBinding:new i(39,!0),predefined:!0}),n.push({actionID:"textStart",keyBinding:new i(36,!0),predefined:!0}),n.push({actionID:"textEnd",keyBinding:new i(35,!0),predefined:!0})),t.isFirefox&&t.isLinux&&(n.push({actionID:"lineUp",keyBinding:new i(38,!0),predefined:!0}),n.push({actionID:"lineDown",keyBinding:new i(40,!0),predefined:!0})),t.isWindows&&(n.push({actionID:"scrollLineUp",keyBinding:new i(38,!0),predefined:!0}),n.push({actionID:"scrollLineDown",keyBinding:new i(40,!0),predefined:!0})),n.push({actionID:"selectLineUp",keyBinding:new i(38,null,!0),predefined:!0}),n.push({actionID:"selectLineDown",keyBinding:new i(40,null,!0),predefined:!0}),n.push({actionID:"selectCharPrevious",keyBinding:new i(37,null,!0),predefined:!0}),n.push({actionID:"selectCharNext",keyBinding:new i(39,null,!0),predefined:!0}),n.push({actionID:"selectPageUp",keyBinding:new i(33,null,!0),predefined:!0}),n.push({actionID:"selectPageDown",keyBinding:new i(34,null,!0),predefined:!0}),t.isMac?(n.push({actionID:"selectLineStart",keyBinding:new i(37,!0,!0),predefined:!0}),n.push({actionID:"selectLineEnd",keyBinding:new i(39,!0,!0),predefined:!0}),n.push({actionID:"selectWordPrevious",keyBinding:new i(37,null,!0,!0),predefined:!0}),n.push({actionID:"selectWordNext",keyBinding:new i(39,null,!0,!0),predefined:!0}),n.push({actionID:"selectTextStart",keyBinding:new i(36,null,!0),predefined:!0}),n.push({actionID:"selectTextEnd",keyBinding:new i(35,null,!0),predefined:!0}),n.push({actionID:"selectTextStart",keyBinding:new i(38,!0,!0),predefined:!0}),n.push({actionID:"selectTextEnd",keyBinding:new i(40,!0,!0),predefined:!0}),n.push({actionID:"selectLineStart",keyBinding:new i(37,null,!0,null,!0),predefined:!0}),n.push({actionID:"selectLineEnd",keyBinding:new i(39,null,!0,null,!0),predefined:!0}),n.push({actionID:"selectLineStart",keyBinding:new i(38,null,!0,!0),predefined:!0}),n.push({actionID:"selectLineEnd",keyBinding:new i(40,null,!0,!0),predefined:!0})):(t.isLinux&&(n.push({actionID:"selectWholeLineUp",keyBinding:new i(38,!0,!0),predefined:!0}),n.push({actionID:"selectWholeLineDown",keyBinding:new i(40,!0,!0),predefined:!0})),n.push({actionID:"selectLineStart",keyBinding:new i(36,null,!0),predefined:!0}),n.push({actionID:"selectLineEnd",keyBinding:new i(35,null,!0),predefined:!0}),n.push({actionID:"selectWordPrevious",keyBinding:new i(37,!0,!0),predefined:!0}),n.push({actionID:"selectWordNext",keyBinding:new i(39,!0,!0),predefined:!0}),n.push({actionID:"selectTextStart",keyBinding:new i(36,!0,!0),predefined:!0}),n.push({actionID:"selectTextEnd",keyBinding:new i(35,!0,!0),predefined:!0})),n.push({actionID:"undo",keyBinding:new e.KeyBinding("z",!0),predefined:!0}),n.push(t.isMac?{actionID:"redo",keyBinding:new e.KeyBinding("z",!0,!0),predefined:!0}:{actionID:"redo",keyBinding:new e.KeyBinding("y",!0),predefined:!0}),n.push({actionID:"deletePrevious",keyBinding:new i(8),predefined:!0}),n.push({actionID:"deletePrevious",keyBinding:new i(8,null,!0),predefined:!0}),n.push({actionID:"deleteNext",keyBinding:new i(46),predefined:!0}),n.push({actionID:"deleteWordPrevious",keyBinding:new i(8,!0),predefined:!0}),n.push({actionID:"deleteWordPrevious",keyBinding:new i(8,!0,!0),predefined:!0}),n.push({actionID:"deleteWordNext",keyBinding:new i(46,!0),predefined:!0}),n.push({actionID:"tab",keyBinding:new i(9),predefined:!0}),n.push({actionID:"shiftTab",keyBinding:new i(9,null,!0),predefined:!0}),n.push({actionID:"enter",keyBinding:new i(13),predefined:!0}),n.push({actionID:"enter",keyBinding:new i(13,null,!0),predefined:!0}),n.push({actionID:"escape",keyBinding:new i(27),predefined:!0}),n.push({actionID:"selectAll",keyBinding:new i("a",!0),predefined:!0}),n.push({actionID:"toggleTabMode",keyBinding:new i("m",!0),predefined:!0}),t.isMac&&(n.push({actionID:"deleteNext",keyBinding:new i(46,null,!0),predefined:!0}),n.push({actionID:"deleteWordPrevious",keyBinding:new i(8,null,null,!0),predefined:!0}),n.push({actionID:"deleteWordNext",keyBinding:new i(46,null,null,!0),predefined:!0})),n.push({actionID:"toggleWrapMode",keyBinding:new e.KeyBinding("w",!0,!1,!0)}),n.push({actionID:"toggleOverwriteMode",keyBinding:new e.KeyBinding(45)}),!t.isFirefox){var o=t.isMac&&t.isChrome;n.push({actionID:"noop",keyBinding:new i("u",!o,!1,!1,o),predefined:!0}),n.push({actionID:"noop",keyBinding:new i("i",!o,!1,!1,o),predefined:!0}),n.push({actionID:"noop",keyBinding:new i("b",!o,!1,!1,o),predefined:!0})}return t.isFirefox&&(n.push({actionID:"copy",keyBinding:new i(45,!0),predefined:!0}),n.push({actionID:"paste",keyBinding:new i(45,null,!0),predefined:!0}),n.push({actionID:"cut",keyBinding:new i(46,null,!0),predefined:!0})),t.isMac&&(n.push({actionID:"lineStart",keyBinding:new i("a",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"lineEnd",keyBinding:new i("e",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"lineUp",keyBinding:new i("p",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"lineDown",keyBinding:new i("n",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"charPrevious",keyBinding:new i("b",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"charNext",keyBinding:new i("f",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"deletePrevious",keyBinding:new i("h",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"deleteNext",keyBinding:new i("d",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"deleteLineEnd",keyBinding:new i("k",!1,!1,!1,!0),predefined:!0}),t.isFirefox?(n.push({actionID:"scrollPageDown",keyBinding:new i("v",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"deleteLineStart",keyBinding:new i("u",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"deleteWordPrevious",keyBinding:new i("w",!1,!1,!1,!0),predefined:!0})):(n.push({actionID:"pageDown",keyBinding:new i("v",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"centerLine",keyBinding:new i("l",!1,!1,!1,!0),predefined:!0}),n.push({actionID:"enterNoCursor",keyBinding:new i("o",!1,!1,!1,!0),predefined:!0}))),n},{KeyMode:i,DefaultKeyMode:n}}),define("orion/editor/util",[],function(){function e(e,t,i,n){"function"==typeof e.addEventListener?e.addEventListener(t,i,n===!0):e.attachEvent("on"+t,i)}function t(e,t,i,n){"function"==typeof e.removeEventListener?e.removeEventListener(t,i,n===!0):e.detachEvent("on"+t,i)}function i(e,t){if(!t)return!1;if(!e.compareDocumentPosition){for(var i=t;i;){if(e===i)return!0;i=i.parentNode}return!1}return e===t||0!==(16&e.compareDocumentPosition(t))}function n(e,t,i){var n;if(e&&(n=e.style[t],!n))if(e.currentStyle){for(var o=0,r=t;-1!==(o=r.indexOf("-",o));)r=r.substring(0,o)+r.substring(o+1,o+2).toUpperCase()+r.substring(o+2);n=e.currentStyle[r]}else{var s=e.ownerDocument.defaultView.getComputedStyle(e,null);n=s?s.getPropertyValue(t):null}return n||i}var o=function(){function e(e){this.options=e}return e.prototype.play=function(){function e(){c=-1===c?(new Date).getTime():c;var e=(new Date).getTime(),n=(e-c)/i;if(1>n){var h=o(n);t=s+h*l,r(t)}else r(a),d.stop()}var t,i="number"==typeof this.options.duration?this.options.duration:350,n="number"==typeof this.options.rate?this.options.rate:20,o=this.options.easing||this.defaultEasing,r=this.options.onAnimate||function(){},s=this.options.curve[0],a=this.options.curve[1],l=a-s,c=-1,d=this;this.interval=this.options.window.setInterval(e,n)},e.prototype.stop=function(){this.options.window.clearInterval(this.interval);var e=this.options.onEnd||function(){};e()},e.prototype.defaultEasing=function(e){return Math.sin(e*(Math.PI/2))},e}();return{contains:i,getNodeStyle:n,addEventListener:e,removeEventListener:t,Animation:o}}),define("orion/editor/textView",["i18n!orion/editor/nls/messages","orion/editor/textModel","orion/editor/keyModes","orion/editor/eventTarget","orion/editor/textTheme","orion/editor/util","orion/util","orion/metrics"],function(e,t,i,n,o,r,s,a){function l(e){return e.defaultView||e.parentWindow}function c(e){return new Array(e)}function d(e,t,i){if(i){t.className="";for(var n=t.attributes,o=n.length;o-->0;)(!s.isIE||s.isIE>=9||s.isIE<9&&n[o].specified)&&t.removeAttribute(n[o].name)}if(e){e.styleClass&&(t.className=e.styleClass);var r=e.style;if(r)for(var a in r)r.hasOwnProperty(a)&&(t.style[a]=r[a]);var l=e.attributes;if(l)for(var c in l)l.hasOwnProperty(c)&&t.setAttribute(c,l[c])}}function h(e){return e instanceof Array?e.slice(0):e}function u(e,t){if(!e)return t;if(!t)return e;for(var i in t)t.hasOwnProperty(i)&&(e.hasOwnProperty(i)||(e[i]=t[i]));return e}function p(e,t){if(e===t)return!0;if(e&&!t||!e&&t)return!1;if(e&&e.constructor===String||t&&t.constructor===String)return!1;if(e instanceof Array||t instanceof Array){if(!(e instanceof Array&&t instanceof Array))return!1;if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(!p(e[i],t[i]))return!1;return!0}if(!(e instanceof Object&&t instanceof Object))return!1;var n;for(n in e)if(e.hasOwnProperty(n)){if(!t.hasOwnProperty(n))return!1;if(!p(e[n],t[n]))return!1}for(n in t)if(!e.hasOwnProperty(n))return!1;return!0}function f(e,t,i){for(var n=0,o=0,r=0,s=e.length;s>r;){-1!==n&&r>=n&&(n=e.indexOf("\r",r)),-1!==o&&r>=o&&(o=e.indexOf("\n",r));var a,l=r;if(-1===o&&-1===n){t(e.substring(r));break}-1!==n&&-1!==o?n+1===o?(a=n,r=o+1):(a=o>n?n:o,r=(o>n?n:o)+1):-1!==n?(a=n,r=n+1):(a=o,r=o+1),t(e.substring(l,a)),i?i():r===s&&t("")}}function g(e){var t,i,n,o,r=l(e.ownerDocument);if(r.getComputedStyle){var s=r.getComputedStyle(e,null);t=s.getPropertyValue("border-left-width"),i=s.getPropertyValue("border-top-width"),n=s.getPropertyValue("border-right-width"),o=s.getPropertyValue("border-bottom-width")}else e.currentStyle&&(t=e.currentStyle.borderLeftWidth,i=e.currentStyle.borderTopWidth,n=e.currentStyle.borderRightWidth,o=e.currentStyle.borderBottomWidth);return{left:parseInt(t,10)||0,top:parseInt(i,10)||0,right:parseInt(n,10)||0,bottom:parseInt(o,10)||0}}function m(e){var t,i,n,o,r=l(e.ownerDocument);if(r.getComputedStyle){var s=r.getComputedStyle(e,null);t=s.getPropertyValue("padding-left"),i=s.getPropertyValue("padding-top"),n=s.getPropertyValue("padding-right"),o=s.getPropertyValue("padding-bottom")}else e.currentStyle&&(t=e.currentStyle.paddingLeft,i=e.currentStyle.paddingTop,n=e.currentStyle.paddingRight,o=e.currentStyle.paddingBottom);return{left:parseInt(t,10)||0,top:parseInt(i,10)||0,right:parseInt(n,10)||0,bottom:parseInt(o,10)||0}}function v(e){var t=e._trim;if(!t){t=m(e);var i=g(e);t.left+=i.left,t.top+=i.top,t.right+=i.right,t.bottom+=i.bottom,e._trim=t}return t}function _(e,t,i,n){function o(t){if(t.animationName===a){var i=t.target;"function"==typeof i.__DOMReady&&l(e).setTimeout(function(){i.__DOMReady()},0)}}function r(e,t){for(var i=["","-webkit-","-moz-","-ms-","-o-"],n="",o="body ."+e+" {\n",r=0;r<i.length;r++)n+="@"+i[r]+"keyframes "+t+" {\nfrom { opacity: 0.99; }\nto { opacity: 1; }\n}\n",o+=i[r]+"animation-duration: 0.001s;\n"+i[r]+"animation-name: "+t+";\n";return o+="}",n+o}i="_"+i+"DOMReady",t.className=t.className?t.className+" "+i:i,t.__DOMReady=n;var s=i+"Style";if(!e.getElementById(s)){var a=i+"Animation";x(e,"animationstart",o,!1),x(e,"MSAnimationStart",o,!1),x(e,"webkitAnimationStart",o,!1);var c=e.createElement("style");c.id=s;var d=e.getElementsByTagName("head")[0]||e.documentElement;c.appendChild(e.createTextNode(r(i,a))),d.insertBefore(c,d.firstChild)}}function y(e,t,i){this.start=e,this.end=t,this.caret=i,this._columnX=-1
}function C(e){this._view=e,this._divs=[];for(var t=e._clipDiv||e._rootDiv,i=0;3>i;i++){var n=e._createSelectionDiv();t.appendChild(n),this._divs.push(n)}}function w(e){this.left=e.left,this.top=e.top,this.right=e.right,this.bottom=e.bottom}function b(e,t,i){this.view=e,this.lineIndex=t,this._lineDiv=i}function S(e){this._init(e||{})}var x=r.addEventListener,L=r.removeEventListener,T=r.Animation;return y.compare=function(e,t){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(!e[i].equals(t[i]))return!1;return!0},y.editing=function(e,t){var i;if(t){for(i=e.length-1;i>=0;i--)if(e[i]._editing)return e[i];return e[e.length-1]}for(i=0;i<e.length;i++)if(e[i]._editing)return e[i];return e[0]},y.convert=function(e){return 1===e.length?e[0]:e},y.contains=function(e,t){return e.some(function(e){return e.contains(t)})},y.merge=function(e){if(e.length<=1)return e;e.sort(function(e,t){return e.start-t.start});for(var t=[],i=e[0],n=1;n<e.length;n++)e[n].start>=i.end||i._editing||e[n]._editing?(t.push(i),i=e[n]):i.end=Math.max(i.end,e[n].end);return t.push(i),t},y.prototype={clone:function(){var e=new y(this.start,this.end,this.caret);return e._columnX=this._columnX,e._editing=this._editing,e._docX=this._docX,e},contains:function(e){return this.start<=e&&e<this.end?!0:!1},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(e){if(this.caret?this.start=e:this.end=e,this.start>this.end){var t=this.start;this.start=this.end,this.end=t,this.caret=!this.caret}},setCaret:function(e){this.start=e,this.end=e,this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},getAnchor:function(){return this.caret?this.end:this.start},getOrientedSelection:function(){return{start:this.getAnchor(),end:this.getCaret()}},toString:function(){return"start="+this.start+" end="+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(e){return this.caret===e.caret&&this.start===e.start&&this.end===e.end&&this._editing===e._editing}},C.prototype={destroy:function(){this._divs&&(this._divs.forEach(function(e){e.parentNode.removeChild(e)}),this._divs=null)},setPrimary:function(e){this.primary=e},update:function(){var e,t=this._view,i=this.primary,n=t._hasFocus,o=t._cursorVisible,r=!this.primary&&this._selection&&this._selection.isEmpty();e=r?"textviewSelectionCaret":n?"textviewSelection":"textviewSelectionUnfocused",this._divs[0].style.visibility=r&&o&&n||!r?"visible":"hidden",this._divs[0].style.zIndex=o&&r?"2":"0",this._divs.forEach(function(t){t.className=e,s.isWebkit<537.36&&i&&(t.style.background=n?"transparent":"")})},setSelection:function(e){this._selection=e,this.update();var t=this._view,i=t._model,n=i.getLineAtOffset(e.start),o=i.getLineAtOffset(e.end),r=t._getLineNext();if(r){var s,a,l,c,d=t._getLinePrevious();n<r.lineIndex?(s=r,l=i.getLineStart(r.lineIndex)):n>d.lineIndex?(s=d,l=i.getLineStart(d.lineIndex)):(s=t._getLineNode(n),l=e.start),o<r.lineIndex?(a=r,c=i.getLineStart(r.lineIndex)):o>d.lineIndex?(a=d,c=i.getLineStart(d.lineIndex)):(a=t._getLineNode(o),c=e.end),this._setDOMSelection(s,l,a,c,e.caret)}},_setDOMSelection:function(e,t,i,n,o){if(this._setDOMFullSelection(e,t,i,n),this.primary){var r=this._view,a=e._line.getNodeOffset(t),l=i._line.getNodeOffset(n);if(a.node&&l.node){var c,d=r._getWindow(),h=r._parent.ownerDocument;if(d.getSelection){var u=d.getSelection();if(c=h.createRange(),c.setStart(a.node,a.offset),c.setEnd(l.node,l.offset),!r._hasFocus||u.anchorNode===a.node&&u.anchorOffset===a.offset&&u.focusNode===l.node&&u.focusOffset===l.offset&&u.anchorNode===l.node&&u.anchorOffset===l.offset&&u.focusNode===a.node&&u.focusOffset===a.offset||(r._anchorNode=a.node,r._anchorOffset=a.offset,r._focusNode=l.node,r._focusOffset=l.offset,r._ignoreSelect=!1,u.rangeCount>0&&u.removeAllRanges(),u.addRange(c),r._ignoreSelect=!0),r._cursorDiv){c=h.createRange(),o?(c.setStart(a.node,a.offset),c.setEnd(a.node,a.offset)):(c.setStart(l.node,l.offset),c.setEnd(l.node,l.offset));var p=c.getClientRects()[0],f=r._cursorDiv.parentNode,g=f.getBoundingClientRect();p&&g&&(r._cursorDiv.style.top=p.top-g.top+f.scrollTop+"px",r._cursorDiv.style.left=p.left-g.left+f.scrollLeft+"px")}}else if(h.selection){if(!r._hasFocus)return;var m=h.body,v=s.createElement(h,"div");m.appendChild(v),m.removeChild(v),c=m.createTextRange(),c.moveToElementText(a.node.parentNode),c.moveStart("character",a.offset);var _=m.createTextRange();_.moveToElementText(l.node.parentNode),_.moveStart("character",l.offset),c.setEndPoint("EndToStart",_),r._ignoreSelect=!1,c.select(),r._ignoreSelect=!0}}}},_setDOMFullSelection:function(e,t,i,n){this._divs.forEach(function(e){e.style.width=e.style.height="0px"});var o=this._view;if(o._fullSelection&&!(s.isIOS||e===i&&t===n&&this.primary)){var r=o._getViewPadding(),a=o._clientDiv.getBoundingClientRect(),l=o._viewDiv.getBoundingClientRect(),c=l.left+r.left,d=a.right,h=l.top+r.top,u=a.bottom,p=0,f=0;if(o._clipDiv){var g=o._clipDiv.getBoundingClientRect();p=g.left-o._clipDiv.scrollLeft,f=g.top}else{var m=o._rootDiv.getBoundingClientRect();p=m.left,f=m.top}o._ignoreDOMSelection=!0;var v,_,y=new b(o,e.lineIndex,e),C=y.getBoundingClientRect(t,!1),w=C.left;e===i&&t===n?(v=y,_=C):(v=new b(o,i.lineIndex,i),_=v.getBoundingClientRect(n,!1));var S=_.left;o._ignoreDOMSelection=!1;var x=this._divs[0],L=Math.min(d,Math.max(c,w)),T=Math.min(u,Math.max(h,C.top)),E=d,k=Math.min(u,Math.max(h,C.bottom));if(x.style.left=L-p+"px",x.style.top=T-f+"px",x.style.width=Math.max(0,E-L)+"px",x.style.height=Math.max(0,k-T)+"px",e.lineIndex===i.lineIndex)E=Math.min(S,d),x.style.width=Math.max(this.primary?0:1,E-L)+"px";else{var N=c,A=Math.min(u,Math.max(h,_.top)),R=Math.min(d,Math.max(c,S)),I=Math.min(u,Math.max(h,_.bottom)),D=this._divs[2];if(D.style.left=N-p+"px",D.style.top=A-f+"px",D.style.width=Math.max(0,R-N)+"px",D.style.height=Math.max(0,I-A)+"px",Math.abs(e.lineIndex-i.lineIndex)>1){var P=this._divs[1];P.style.left=c-p+"px",P.style.top=k-f+"px",P.style.width=Math.max(0,d-c)+"px",P.style.height=Math.max(0,A-k)+"px"}}}}},w.prototype={toString:function(){return"{l="+this.left+", t="+this.top+", r="+this.right+", b="+this.bottom+"}"}},b.prototype={create:function(e,t){if(!this._lineDiv){var i=this._lineDiv=this._createLine(e,t,this.lineIndex);return i._line=this,i}},_createLine:function(e,t,i){var n=this.view,o=n._model,r=o.getLine(i),a=o.getLineStart(i),l={type:"LineStyle",textView:n,lineIndex:i,lineText:r,lineStart:a};n.onLineStyle(l);var c=e.ownerDocument,h=t||s.createElement(c,"div");if(t&&p(t.viewStyle,l.style)||(d(l.style,h,t),t&&(t._trim=null),h.viewStyle=l.style,h.setAttribute("role","presentation")),h.lineIndex=i,t&&h.viewLineText===r&&p(l.ranges,h.viewRanges))return h;h.viewRanges=l.ranges,h.viewLineText=r;var u=[],f={tabOffset:0,ranges:u};this._createRanges(l.ranges,r,0,r.length,a,f);var g=" ";!n._fullSelection&&s.isIE<9&&(g="﻿");var m={text:g,style:n._metrics.largestFontStyle,ignoreChars:1};0!==u.length&&u[u.length-1].style&&"div"===u[u.length-1].style.tagName?u.splice(u.length-1,0,m):u.push(m);var v,_,y,C,w,b,S,x,L=0,T=0;if(s.isFirefox&&r.length>2e3){t&&(h.innerHTML="",t.lineWidth=void 0);var E=c.createDocumentFragment();for(x=0;x<u.length;x++)m=u[x],w=m.text,_=m.style,v=this._createSpan(h,w,_,m.ignoreChars),E.appendChild(v);h.appendChild(E)}else{var k,N;if(t){var A=t.modelChangedEvent;A&&(0===A.removedLineCount&&0===A.addedLineCount?(N=A.start-a,k=A.addedCharCount-A.removedCharCount):N=-1,t.modelChangedEvent=void 0),y=t.firstChild}for(x=0;x<u.length;x++){if(m=u[x],w=m.text,L+=w.length,_=m.style,y){if(b=y.firstChild.data,C=y.viewStyle,b===w&&p(_,C)){T+=b.length,y._rectsCache=void 0,v=y=y.nextSibling;continue}for(;y;){if(-1!==N){var R=L;R>=N&&(R-=k);var I=y.firstChild.data,D=I?I.length:0;if(T+D>R)break;T+=D}S=y.nextSibling,h.removeChild(y),y=S}}v=this._createSpan(h,w,_,m.ignoreChars),y?h.insertBefore(v,y):h.appendChild(v),t&&(t.lineWidth=void 0)}if(t)for(var P=v?v.nextSibling:null;P;)S=P.nextSibling,t.removeChild(P),P=S}return h.parentNode||e.appendChild(h),h},_createRanges:function(e,t,i,n,o,r){if(!(i>n)){if(e)for(var s=0;s<e.length;s++){var a=e[s];if(!(a.end<o+i)){var l=Math.max(o+i,a.start)-o;if(l>n)break;var c=Math.min(o+n,a.end)-o;if(c>=l){if(l=Math.max(i,l),c=Math.min(n,c),l>i&&this._createRange(t,i,l,null,r),!a.style||!a.style.unmergeable)for(;s+1<e.length&&e[s+1].start-o===c&&p(a.style,e[s+1].style);)a=e[s+1],c=Math.min(o+n,a.end)-o,s++;this._createRange(t,l,c,a.style,r),i=c}}}n>i&&this._createRange(t,i,n,null,r)}},_createRange:function(e,t,i,n,o){if(!(t>i)){var r,s=this.view._customTabSize;if(s&&8!==s)for(var a=e.indexOf("	",t);-1!==a&&i>a;){a>t&&(r={text:e.substring(t,a),style:n},o.ranges.push(r),o.tabOffset+=r.text.length);var l=s-o.tabOffset%s;if(l>0){for(var c=" ",d=1;l>d;d++)c+=" ";r={text:c,style:n,ignoreChars:l-1},o.ranges.push(r),o.tabOffset+=r.text.length}if(t=a+1,t===i)return;a=e.indexOf("	",t)}i>=t&&(r={text:e.substring(t,i),style:n},o.ranges.push(r),o.tabOffset+=r.text.length)}},_createSpan:function(e,t,i,n){var o=this.view,r="span";i&&i.tagName&&(r=i.tagName.toLowerCase());var a="a"===r;a&&(this.hasLink=!0),a&&!o._linksVisible&&(r="span");var l=e.ownerDocument,c=s.createElement(e.ownerDocument,r);if(c.appendChild(l.createTextNode(i&&i.text?i.text:t)),i&&i.html?(c.innerHTML=i.html,c.ignore=!0):i&&i.node&&(c.appendChild(i.node),c.ignore=!0),d(i,c),"a"===r){var h=o._getWindow();x(c,"click",function(e){return o._handleLinkClick(e?e:h.event)},!1)}return c.viewStyle=i,n&&(c.ignoreChars=n),c},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(e,t){var i=this._ensureCreated(),n=this.view;if(void 0===e)return this._getLineBoundingClientRect(i,!0);var o=n._model,r=i.ownerDocument,a=this.lineIndex,c=null;if(e<o.getLineEnd(a)){var d=o.getLineStart(a);this.forEach(function(t){var o=t.firstChild,a=this._nodeLength(t);if(d+a>e){var h,u=e-d;if(1===o.length)c=new w(t.getBoundingClientRect());else if(n._isRangeRects)h=r.createRange(),h.setStart(o,u),h.setEnd(o,u+1),c=new w(h.getBoundingClientRect());else if(s.isIE){h=r.body.createTextRange(),h.moveToElementText(t),h.collapse();var p=0===u&&8===s.isIE;p&&(u=1),h.moveEnd("character",u+1),h.moveStart("character",u),c=new w(h.getBoundingClientRect()),p&&(c.left=t.getClientRects()[0].left)}else{var f=o.data;t.removeChild(o),t.appendChild(r.createTextNode(f.substring(0,u)));var g=s.createElement(r,"span");if(g.appendChild(r.createTextNode(f.substring(u,u+1))),t.appendChild(g),t.appendChild(r.createTextNode(f.substring(u+1))),c=new w(g.getBoundingClientRect()),t.innerHTML="",t.appendChild(o),!this._createdDiv){var m=n._getSelections()[0];(d<=m.start&&m.start<d+a||d<=m.end&&m.end<d+a)&&n._updateDOMSelection()}}if(s.isIE<11){var v=l(i.ownerDocument),_=v.screen.logicalXDPI/v.screen.deviceXDPI,y=v.screen.logicalYDPI/v.screen.deviceYDPI;c.left=c.left*_,c.right=c.right*_,c.top=c.top*y,c.bottom=c.bottom*y}return!1}return d+=a,!0})}var h=this.getBoundingClientRect();if(!c)if(n._wrapMode){var u=this.getClientRects();c=u[u.length-1],c.left=c.right,c.left+=h.left,c.top+=h.top,c.right+=h.left,c.bottom+=h.top}else c=new w(h),c.left=c.right;return(t||void 0===t)&&(c.left-=h.left,c.top-=h.top,c.right-=h.left,c.bottom-=h.top),c},forEach:function(e){for(var t=this._ensureCreated(),i=t.firstChild;i;){var n=i.nextSibling;if(!i.ignore&&!e.call(this,i))break;i=n}},_getClientRects:function(e,t){var i,n,o,r;if(!e._rectsCache){for(i=e.getClientRects(),n=c(i.length),r=0;r<i.length;r++)o=n[r]=new w(i[r]),o.left-=t.left,o.top-=t.top,o.right-=t.left,o.bottom-=t.top;e._rectsCache=n}for(i=e._rectsCache,n=[i.length],r=0;r<i.length;r++)n[r]=new w(i[r]);return n},getClientRects:function(e){if(!this.view._wrapMode)return[this.getBoundingClientRect()];var t=this._ensureCreated(),i=[],n=t.getBoundingClientRect();return this.forEach(function(e){for(var t=this._getClientRects(e,n),o=0;o<t.length;o++){var r,s,a=t[o];if(a.top!==a.bottom){var l=a.top+(a.bottom-a.top)/2;for(r=0;r<i.length&&(s=i[r],!(s.top<=l&&l<s.bottom));r++);r===i.length?i.push(a):(a.left<s.left&&(s.left=a.left),a.top<s.top&&(s.top=a.top),a.right>s.right&&(s.right=a.right),a.bottom>s.bottom&&(s.bottom=a.bottom))}}return!0}),void 0!==e?i[e]:i},_getLineBoundingClientRect:function(e,t){var i=new w(e.getBoundingClientRect());if(this.view._wrapMode);else{i.right=i.left;for(var n=e.lastChild;n&&n.ignoreChars===n.firstChild.length;)n=n.previousSibling;if(n){var o=n.getBoundingClientRect();i.right=o.right+v(e).right}}if(t){var r=v(e);i.left=i.left+r.left,i.right=i.right-r.right}return i},getLineCount:function(){return this.view._wrapMode?this.getClientRects().length:1},getLineIndex:function(e){if(!this.view._wrapMode)return 0;for(var t=this.getClientRects(),i=this.getBoundingClientRect(e),n=i.top+(i.bottom-i.top)/2,o=0;o<t.length;o++)if(t[o].top<=n&&n<t[o].bottom)return o;return t.length-1},getLineStart:function(e){if(!this.view._wrapMode||0===e)return this.view._model.getLineStart(this.lineIndex);var t=this.getClientRects();return this.getOffset(t[e].left+1,t[e].top+1)},_nodeLength:function(e){if(!e||e.ignore)return 0;var t=e.firstChild.length;return e.ignoreChars&&(t-=e.ignoreChars),t},getModelOffset:function(e,t){if(!e)return 0;var i=0;return this.forEach(function(n){var o=n.firstChild;return o===e?(n.ignoreChars&&(i-=n.ignoreChars),i+=t,!1):(n.ignoreChars&&(i-=n.ignoreChars),i+=o.data.length,!0)}),Math.max(0,i)+this.view._model.getLineStart(this.lineIndex)},getNodeOffset:function(e){var t,i,n=0,o=this.view._model,r=o.getLineStart(this.lineIndex),s=e-r,a=o.getLineEnd(this.lineIndex)-r;return this.forEach(function(e){var o=e.firstChild,r=this._nodeLength(e);return r+n>s||n+r>=a?(t=o,i=s-n,e.ignoreChars&&r>0&&i===r&&(i+=e.ignoreChars),!1):(n+=r,!0)}),{node:t,offset:i}},getText:function(e){var t="",i=0;return this.forEach(function(n){var o;if(n.ignoreChars){o=n.lastChild;for(var r=0,s=[],a=-1;o;){var l=o.data;if(l)for(var c=l.length-1;c>=0;c--){var d=l.substring(c,c+1);r<n.ignoreChars&&(" "===d||"﻿"===d)?r++:s.push(" "===d?"	":d)}e===o&&(a=s.length),o=o.previousSibling}s=s.reverse().join(""),-1!==a&&(i=t.length+s.length-a),t+=s}else for(o=n.firstChild;o;)e===o&&(i=t.length),t+=o.data,o=o.nextSibling;return!0}),{text:t,offset:i}},getOffset:function(e,t){function i(i,n,d){var h,u,m,v,_,y,C,w,b,S=i.firstChild,x=g._nodeLength(i),L=p.ownerDocument,T=l(L),E=s.isIE<11?T.screen.logicalXDPI/T.screen.deviceXDPI:1,k=s.isIE<11?T.screen.logicalYDPI/T.screen.deviceYDPI:1,N=d.left+f.left;if(s.isIE||o._isRangeRects){_=o._isRangeRects?L.createRange():L.body.createTextRange();for(var A=x,R=-1;A-R>1;){var I=Math.floor((A+R)/2);y=R+1,C=I===x-1&&i.ignoreChars?S.length:I+1,w=0===y&&8===s.isIE,o._isRangeRects?(_.setStart(S,y),_.setEnd(S,C)):(w&&(y=1),_.moveToElementText(i),_.move("character",y),_.moveEnd("character",C-y)),b=_.getClientRects();for(var D=!1,P=0;P<b.length;P++)if(d=b[P],h=(w?N:d.left)*E-f.left,m=d.right*E-f.left,u=d.top*k-f.top,v=d.bottom*k-f.top,e>=h&&m>e&&(!o._wrapMode||t>=u&&v>=t)){D=!0;break}D?A=I:R=I}n+=A,y=A,C=A===x-1&&i.ignoreChars?S.length:Math.min(A+1,S.length),o._isRangeRects?(_.setStart(S,y),_.setEnd(S,C)):(_.moveToElementText(i),_.move("character",y),_.moveEnd("character",C-y)),b=_.getClientRects();var M=!1;b.length>0&&(d=b[0],h=(w?N:d.left)*E-f.left,m=d.right*E-f.left,M=e>h+(m-h)/2);var O=n-c,B=r.getLine(a),F=B.charCodeAt(O);F>=55296&&56319>=F&&M?O<B.length&&(F=B.charCodeAt(O+1),F>=56320&&57343>=F&&(n+=1)):F>=56320&&57343>=F&&!M&&O>0&&(F=B.charCodeAt(O-1),F>=55296&&56319>=F&&(n-=1)),M&&n++}else{for(var j=[],V=0;x>V;V++)j.push("<span>"),j.push(V===x-1?S.data.substring(V):S.data.substring(V,V+1)),j.push("</span>");i.innerHTML=j.join("");for(var U=i.firstChild;U;){if(d=U.getBoundingClientRect(),h=d.left-f.left,m=d.right-f.left,e>=h&&m>e){e>h+(m-h)/2&&n++;break}n++,U=U.nextSibling}if(!g._createdDiv){i.innerHTML="",i.appendChild(S);var W=o._getSelections()[0];(n<=W.start&&W.start<n+x||n<=W.end&&W.end<n+x)&&o._updateDOMSelection()}}return n}function n(i){if(i.ignore)return null;for(var n=g._getClientRects(i,f),r=0;r<n.length;r++){var s=n[r];if(s.left<=e&&e<s.right&&(!o._wrapMode||s.top<=t&&t<=s.bottom))return s}return null}var o=this.view,r=o._model,a=this.lineIndex,c=r.getLineStart(a),d=r.getLineEnd(a);if(c===d)return c;var h,u,p=this._ensureCreated(),f=this.getBoundingClientRect(),g=this;if(o._wrapMode){h=this.getClientRects(),t<h[0].top&&(t=h[0].top);for(var m=0;m<h.length&&(u=h[m],!(u.top<=t&&t<u.bottom));m++);e<u.left&&(e=u.left),e>u.right&&(e=u.right-1)}else 0>e&&(e=0),e>f.right-f.left&&(e=f.right-f.left);var v,_;if(this._lastHitChild&&this._lastHitChild.parentNode){if(v=this._lastHitOffset,_=this._lastHitChild,u=n(_),!u)for(var y=v,C=v+this._nodeLength(_),w=_.previousSibling,b=_.nextSibling;w||b;){if(w){if(y-=this._nodeLength(w),u=n(w)){_=w,v=y;break}w=w.previousSibling}if(b){if(u=n(b)){_=b,v=C;break}C+=this._nodeLength(b),b=b.nextSibling}}}else v=c,this.forEach(function(e){return _=e,(u=n(_))?!1:(v+=this._nodeLength(_),!0)});return _&&u&&(this._lastHitChild=_,this._lastHitOffset=v,v=i(_,v,u)),Math.min(d,Math.max(c,v))},getNextOffset:function(e,t){if("line"===t.unit){var i=this.view,n=i._model,o=n.getLineAtOffset(e);return t.count>0?(t.count--,n.getLineEnd(o)):(t.count++,n.getLineStart(o))}return"wordend"===t.unit||"wordWS"===t.unit||"wordendWS"===t.unit?this._getNextOffset_W3C(e,t):s.isIE?this._getNextOffset_IE(e,t):this._getNextOffset_W3C(e,t)},_getNextOffset_W3C:function(e,t){function i(e){return e>=33&&47>=e||e>=58&&64>=e||e>=91&&94>=e||96===e||e>=123&&126>=e}function n(e){return 32===e||9===e}var o,r=this.view,s=r._model,a=s.getLineAtOffset(e),l=s.getLine(a),c=s.getLineStart(a),d=s.getLineEnd(a),h=l.length,u=e-c,p=t.count<0?-1:1;if("word"===t.unit||"wordend"===t.unit||"wordWS"===t.unit||"wordendWS"===t.unit)for(var f,g,m,v;0!==t.count;){if(t.count>0){if(u===h)return d;for(o=l.charCodeAt(u),f=i(o),g=!f&&!n(o),u++;h>u;){if(o=l.charCodeAt(u),"wordWS"!==t.unit&&"wordendWS"!==t.unit){if(m=i(o),"wordend"===t.unit){if(!m&&f)break}else if(m&&!f)break;v=!m&&!n(o)}else v=!n(o);if("wordend"===t.unit||"wordendWS"===t.unit){if(!v&&g)break}else if(v&&!g)break;g=v,f=m,u++}}else{if(0===u)return c;for(u--,o=l.charCodeAt(u),f=i(o),g=!f&&!n(o);u>0;){if(o=l.charCodeAt(u-1),"wordWS"!==t.unit&&"wordendWS"!==t.unit){if(m=i(o),"wordend"===t.unit){if(m&&!f)break}else if(!m&&f)break;v=!m&&!n(o)}else v=!n(o);if("wordend"===t.unit||"wordendWS"===t.unit){if(v&&!g)break}else if(!v&&g)break;g=v,f=m,u--}}t.count-=p}else for(;0!==t.count&&u+p>=0&&h>=u+p;)u+=p,o=l.charCodeAt(u),o>=56320&&57343>=o&&u>0&&(o=l.charCodeAt(u-1),o>=55296&&56319>=o&&(u+=p)),t.count-=p;return c+u},_getNextOffset_IE:function(e,t){var i,n,o,r=this._ensureCreated(),s=this.view,a=s._model,l=this.lineIndex,c=0,d=a.getLineStart(l),h=a.getLine(l),u=a.getLineStart(l),p=r.ownerDocument,f=t.count<0?-1:1;if(e===a.getLineEnd(l)){for(o=r.lastChild;o&&o.ignoreChars===o.firstChild.length;)o=o.previousSibling;if(!o)return d;i=p.body.createTextRange(),i.moveToElementText(o),n=i.text.length,i.moveEnd(t.unit,f),c=e+i.text.length-n}else if(e===d&&t.count<0)c=d;else for(o=r.firstChild;o;){var g=this._nodeLength(o);if(d+g>e){if(i=p.body.createTextRange(),e===d&&t.count<0){for(var m=o.previousSibling;m&&(!m.firstChild||!m.firstChild.length);)m=m.previousSibling;i.moveToElementText(m?m:o.previousSibling)}else i.moveToElementText(o),i.collapse(),i.moveEnd("character",e-d);n=i.text.length,i.moveEnd(t.unit,f),c=e+i.text.length-n;break}d=g+d,o=o.nextSibling}var v=c-u,_=h.charCodeAt(v);return _>=56320&&57343>=_&&v>0&&(_=h.charCodeAt(v-1),_>=55296&&56319>=_&&(v+=f)),c=v+u,t.count-=f,c},updateLinks:function(){var e=this._ensureCreated();if(this.hasLink){var t=this;this.forEach(function(i){var n=i.viewStyle;return n&&n.tagName&&"a"===n.tagName.toLowerCase()&&e.replaceChild(t._createSpan(e,i.firstChild.data,n),i),!0})}},destroy:function(){var e=this._createdDiv;e&&(e.parentNode.removeChild(e),this._createdDiv=null)}},S.prototype={addKeyMode:function(e,t){var i=this._keyModes;void 0!==t?i.splice(t,0,e):i.push(e),e._modeAdded&&e._modeAdded()},addRuler:function(e,t){var i=this._rulers;if(void 0!==t){var n,o;for(n=0,o=0;n<i.length&&t>o;n++)e.getLocation()===i[n].getLocation()&&o++;i.splice(o,0,e),t=o}else i.push(e);this._createRuler(e,t),e.setView(this),this._update()},computeSize:function(){var e=0,t=0,i=this._model,n=this._clientDiv;if(!n)return{width:e,height:t};var o=n.style.width;s.isWebkit&&(n.style.width="0x7fffffffpx");for(var r=i.getLineCount(),a=0;r>a;a++){var l=this._getLine(a),c=l.getBoundingClientRect();e=Math.max(e,c.right-c.left),t+=c.bottom-c.top,l.destroy()}s.isWebkit&&(n.style.width=o);var d=this._getViewPadding();return e+=d.right+d.left+this._metrics.scrollWidth,t+=d.bottom+d.top+this._metrics.scrollWidth,{width:e,height:t}},convert:function(e,t,i){if(!this._clientDiv)return e;var n=this._getScroll(),o=this._getViewPadding(),r=this._viewDiv.getBoundingClientRect();return"document"===t&&(void 0!==e.x&&(e.x+=-n.x+r.left+o.left),void 0!==e.y&&(e.y+=-n.y+r.top+o.top)),"document"===i&&(void 0!==e.x&&(e.x+=n.x-r.left-o.left),void 0!==e.y&&(e.y+=n.y-r.top-o.top)),e},copy:function(){return this._clientDiv?this._doCopy():!1},cut:function(){return this._clientDiv?this._doCut():!1},destroy:function(){for(var e=0;e<this._rulers.length;e++)this._rulers[e].setView(null);this.rulers=null,this._destroyView();var t={type:"Destroy"};this.onDestroy(t),this._parent=null,this._model&&this._model.destroy&&this._model.destroy(),this._model=null,this._theme=null,this._selection=null,this._doubleClickSelection=null,this._keyModes=null,this._actions=null},focus:function(){this._clientDiv&&(this._updateDOMSelection(),this._clientDiv.focus(),this._updateDOMSelection())},hasFocus:function(){return this._hasFocus},getActionDescription:function(e){var t=this._actions[e];return t?t.actionDescription:void 0},getActions:function(e){var t=[],i=this._actions;for(var n in i)if(i.hasOwnProperty(n)){if(!e&&i[n].defaultHandler)continue;t.push(n)}return t},getBottomIndex:function(e){return this._clientDiv?this._getBottomIndex(e):0},getBottomPixel:function(){return this._clientDiv?this._getScroll().y+this._getClientHeight():0},getCaretOffset:function(){var e=this._getSelection();return e.getCaret()},getClientArea:function(){if(!this._clientDiv)return{x:0,y:0,width:0,height:0};var e=this._getScroll();return{x:e.x,y:e.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return this._clientDiv?this._getScroll().x:0},getKeyBindings:function(e){for(var t=[],i=this._keyModes,n=0;n<i.length;n++)t=t.concat(i[n].getKeyBindings(e));return t},getKeyModes:function(){return this._keyModes.slice(0)},getLineHeight:function(e){return this._clientDiv?this._getLineHeight(e):0},getLineIndex:function(e){return this._clientDiv?this._getLineIndex(e):0},isValidTextPosition:function(e,t){if(!this._clientDiv)return!1;var i=this._getLineIndex(t,!0);if(0>i)return!1;var n=this._getLine(i),o=this.getOffsetAtLocation(e,t),r=n.getBoundingClientRect(o);return n.destroy(),e>r.right?!1:!0},getLinePixel:function(e){return this._clientDiv?this._getLinePixel(e):0},getLocationAtOffset:function(e){if(!this._clientDiv)return{x:0,y:0};var t=this._model;e=Math.min(Math.max(0,e),t.getCharCount());var i=t.getLineAtOffset(e),n=this._getLine(i),o=n.getBoundingClientRect(e);n.destroy();var r=o.left,s=this._getLinePixel(i)+o.top;return{x:r,y:s}},getNextOffset:function(e,t){var i=new y(e,e,!1);return this._doMove(t,i),i.getCaret()},getOptions:function(){var e;if(0===arguments.length)e=this._defaultOptions();else if(1===arguments.length){var t=arguments[0];if("string"==typeof t)return h(this["_"+t]);e=t}else{e={};for(var i in arguments)arguments.hasOwnProperty(i)&&(e[arguments[i]]=void 0)}for(var n in e)e.hasOwnProperty(n)&&(e[n]=h(this["_"+n]));return e},getModel:function(){return this._model},getOffsetAtLocation:function(e,t){if(!this._clientDiv)return 0;var i=this._getLineIndex(t),n=this._getLine(i),o=n.getOffset(e,t-this._getLinePixel(i));return n.destroy(),o},getLineAtOffset:function(e){return this.getModel().getLineAtOffset(e)},getLineStart:function(e){return this.getModel().getLineStart(e)},getRulers:function(){return this._rulers.slice(0)},getSelection:function(){return this._getSelection()},getSelections:function(){return this._getSelections()},getSelectionText:function(e){var t=[],i=this,n=this._getSelections();return n.forEach(function(e){e.isEmpty()||t.push(i._getBaseText(e.start,e.end))}),t.join(void 0!==e?e:this._model.getLineDelimiter())},getText:function(e,t){var i=this._model;return i.getText(e,t)},getTopIndex:function(e){return this._clientDiv?this._getTopIndex(e):0},getTopPixel:function(){return this._clientDiv?this._getScroll().y:0},invokeAction:function(e,t,i){if(this._clientDiv){var n=this._actions[e];if(n){if(n.actionDescription&&n.actionDescription.id&&a.logEvent("editor","action",n.actionDescription.id),!t&&n.handler&&n.handler(i))return!0;if(n.defaultHandler)return"boolean"==typeof n.defaultHandler(i)}return!1}},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(e){return this.dispatchEvent(e)},onDragStart:function(e){return this.dispatchEvent(e)},onDrag:function(e){return this.dispatchEvent(e)},onDragEnd:function(e){return this.dispatchEvent(e)},onDragEnter:function(e){return this.dispatchEvent(e)},onDragOver:function(e){return this.dispatchEvent(e)},onDragLeave:function(e){return this.dispatchEvent(e)},onDrop:function(e){return this.dispatchEvent(e)},onDestroy:function(e){return this.dispatchEvent(e)},onSaving:function(e){return this.dispatchEvent(e)},onInputChanged:function(e){return this.dispatchEvent(e)},onLineStyle:function(e){return this.dispatchEvent(e)},onKeyDown:function(e){return this.dispatchEvent(e)},onKeyPress:function(e){return this.dispatchEvent(e)},onKeyUp:function(e){return this.dispatchEvent(e)},onModelChanged:function(e){return this.dispatchEvent(e)},onModelChanging:function(e){return this.dispatchEvent(e)},onModify:function(e){return this.dispatchEvent(e)},onMouseDown:function(e){return this.dispatchEvent(e)},onMouseUp:function(e){return this.dispatchEvent(e)},onMouseMove:function(e){return this.dispatchEvent(e)},onMouseOver:function(e){return this.dispatchEvent(e)},onMouseOut:function(e){return this.dispatchEvent(e)},onTouchStart:function(e){return this.dispatchEvent(e)},onTouchMove:function(e){return this.dispatchEvent(e)},onTouchEnd:function(e){return this.dispatchEvent(e)},onOptions:function(e){return this.dispatchEvent(e)},onSelection:function(e){return this.dispatchEvent(e)},onScroll:function(e){return this.dispatchEvent(e)},onVerify:function(e){return this.dispatchEvent(e)},onFocus:function(e){return this.dispatchEvent(e)},onBlur:function(e){return this.dispatchEvent(e)},paste:function(){return this._clientDiv?this._doPaste():!1},redraw:function(){if(!(this._redrawCount>0)){var e=this._model.getLineCount();this.redrawRulers(0,e),this.redrawLines(0,e)}},redrawRulers:function(e,t){if(!(this._redrawCount>0))for(var i=this.getRulers(),n=0;n<i.length;n++)this.redrawLines(e,t,i[n])},redrawLines:function(e,t,i){if(!(this._redrawCount>0)&&(void 0===e&&(e=0),void 0===t&&(t=this._model.getLineCount()),e!==t)){var n=this._clientDiv;if(n){if(i){var o=this._getRulerParent(i);for(n=o.firstChild;n&&n._ruler!==i;)n=n.nextSibling}i?n.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(e,t);var r=-1;if(i||-1===this._imeOffset||(r=this._model.getLineAtOffset(this._imeOffset)),!i||"page"===i.getOverview())for(var s=n.firstChild;s;){var a=s.lineIndex;a>=e&&t>a&&a!==r&&(s.lineChanged=!0),s=s.nextSibling}i||this._wrapMode||e<=this._maxLineIndex&&this._maxLineIndex<t&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0),this.dispatchEvent({type:"Redraw",startLine:e,endLine:t,ruler:i}),this._queueUpdate()}}},redrawRange:function(e,t){if(!(this._redrawCount>0)){var i=this._model;void 0===e&&(e=0),void 0===t&&(t=i.getCharCount());var n=i.getLineAtOffset(e),o=i.getLineAtOffset(Math.max(e,t-1))+1;this.redrawLines(n,o)}},removeKeyMode:function(e){for(var t=this._keyModes,i=0;i<t.length;i++)if(t[i]===e){t.splice(i,1);break}e._modeRemoved&&e._modeRemoved()},removeRuler:function(e){for(var t=this._rulers,i=0;i<t.length;i++)if(t[i]===e){t.splice(i,1),e.setView(null),this._destroyRuler(e),this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(e,t,i){if(e){var n=this._actions,o=n[e];o||(o=n[e]={}),o.handler=t,void 0!==i&&(o.actionDescription=i)}},setKeyBinding:function(e,t){this._keyModes[0].setKeyBinding(e,t)},setCaretOffset:function(e,t,i){var n=this._model.getCharCount();e=Math.max(0,Math.min(e,n));var o=new y(e,e,!1);this._setSelection(o,void 0===t||t,!0,i)},setHorizontalPixel:function(e){this._clientDiv&&(e=Math.max(0,e),this._scrollView(e-this._getScroll().x,0))},setRedraw:function(e){e?0===--this._redrawCount&&this.redraw():this._redrawCount++},setModel:function(e){if(e!==this._model){e=e||new t.TextModel,this._model.removeEventListener("preChanging",this._modelListener.onChanging),this._model.removeEventListener("postChanged",this._modelListener.onChanged);var i=this._model.getLineCount(),n=this._model.getCharCount(),o=e.getLineCount(),r=e.getCharCount(),s=e.getText(),a={type:"ModelChanging",text:s,start:0,removedCharCount:n,addedCharCount:r,removedLineCount:i,addedLineCount:o};this.onModelChanging(a),this._model=e,a={type:"ModelChanged",start:0,removedCharCount:n,addedCharCount:r,removedLineCount:i,addedLineCount:o},this.onModelChanged(a),this._model.addEventListener("preChanging",this._modelListener.onChanging),this._model.addEventListener("postChanged",this._modelListener.onChanged),this._reset(),this._update()}},setOptions:function(e){var t=this._defaultOptions();for(var i in e)if(e.hasOwnProperty(i)){var n=e[i],o=this["_"+i];if(p(o,n))continue;var r=t[i]?t[i].update:null;if(r){r.call(this,n);continue}this["_"+i]=h(n)}this.onOptions({type:"Options",options:e})},setSelection:function(e,t,i,n){var o=e>t;if(o){var r=e;e=t,t=r}var s=this._model.getCharCount();e=Math.max(0,Math.min(e,s)),t=Math.max(0,Math.min(t,s));var a=new y(e,t,o);this._setSelection(a,void 0===i||i,!0,n)},setSelections:function(e,t,i){var n=this._rangesToSelections(e);this._setSelection(n,void 0===t||t,!0,i)},setText:function(e,t,i,n,o){var r,a="string"==typeof e,l=void 0===t&&void 0===i&&a;a?(void 0===t&&(t=0),void 0===i&&(i=this._model.getCharCount()),r={text:e,selection:[new y(t,i,!1)]}):(r=e,r.selection=this._rangesToSelections(r.selection)),r._code=!0,l&&(this._variableLineHeight=!1),this._modifyContent(r,!l,void 0===n||n,o),l&&s.isFirefox<13&&this._fixCaret()},setTopIndex:function(e,t){this._clientDiv&&this._scrollViewAnimated(0,this._getLinePixel(Math.max(0,e))-this._getScroll().y,t)},setTopPixel:function(e,t){this._clientDiv&&this._scrollViewAnimated(0,Math.max(0,e)-this._getScroll().y,t)},showSelection:function(e,t){return this._showCaret(e?!1:!0,t,e)},update:function(e,t){this._clientDiv&&((e||this._metrics.invalid)&&this._updateStyle(),void 0===t||t?this._update():this._queueUpdate())},_handleRootMouseDown:function(e){if(this._cancelCheckSelection(),!this._ignoreEvent(e)){s.isFirefox<13&&1===e.which&&(this._clientDiv.contentEditable=!1,(this._overlayDiv||this._clientDiv).draggable=!0,this._ignoreBlur=!0);var t=this._overlayDiv||this._clientDiv;s.isIE<9&&(t=this._viewDiv);for(var i=e.target?e.target:e.srcElement;i;){if(t===i)return;if(i.className&&-1!==i.className.indexOf("textViewFind"))return;i=i.parentNode}if(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!this._isW3CEvents){var n=this,o=this._getWindow();o.setTimeout(function(){n._clientDiv.focus()},0)}}},_handleRootMouseUp:function(e){this._ignoreEvent(e)||(s.isFirefox<13&&1===e.which&&(this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1),s.isFirefox&&1===e.which&&(this._fixCaret(),this._ignoreBlur=!1))
},_handleBlur:function(){if(this._cancelCheckSelection(),!this._ignoreBlur){if(this._commitIME(),this._hasFocus=!1,s.isIE<9&&!this._getSelections()[0].isEmpty()){var e=this._rootDiv,t=s.createElement(e.ownerDocument,"div");e.appendChild(t),e.removeChild(t)}if(this._cursorDiv&&(this._cursorDiv.style.display="none"),this._domSelection){this._domSelection.forEach(function(e){e.update()});var i,n=this._getWindow(),o=this._parent.ownerDocument;if(n.getSelection){var r=n.getSelection();for(i=r.anchorNode;i;){if(i===this._clientDiv){r.rangeCount>0&&r.removeAllRanges();break}i=i.parentNode}}else if(o.selection){for(this._ignoreSelect=!1,i=o.selection.createRange().parentElement();i;){if(i===this._clientDiv){o.selection.empty();break}i=i.parentNode}this._ignoreSelect=!0}}this._ignoreFocus||this.onBlur({type:"Blur"})}},_handleCompositionStart:function(e){if(!this._ignoreEvent(e)){if(this._imeTimeout){var t=this._getWindow();t.clearTimeout(this._imeTimeout),this._imeTimeout=null}this._imeText&&(this._commitIME(this._imeText),this._imeText=null),this._startIME(),this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null)}},_handleCompositionUpdate:function(e){this._ignoreEvent(e)||(this._imeText=e.data)},_handleCompositionEnd:function(e){if(!this._ignoreEvent(e)){this._imeText=e.data;var t=this._getWindow();this._imeTimeout=t.setTimeout(function(){this._commitIME(this._imeText),this._imeText=this._imeTimeout=null}.bind(this),0)}},_handleContextMenu:function(e){if(!this._ignoreEvent(e)){s.isIE&&3===this._lastMouseButton&&this._updateDOMSelection();var t=!1;if(this.isListening("ContextMenu")){var i=this._createMouseEvent("ContextMenu",e);i.screenX=e.screenX,i.screenY=e.screenY,this.onContextMenu(i),t=i.defaultPrevented}else s.isMac&&s.isFirefox&&0===e.button&&(t=!0);return t?(e.preventDefault&&e.preventDefault(),!1):(this._contextMenuOpen=!0,void(s.isFirefox&&(this._checkSelectionChange=!0,this._pollSelectionChange(!0))))}},_handleCopy:function(e){return this._cancelCheckSelection(),this._ignoreEvent(e)||this._ignoreCopy?void 0:this._doCopy(e)?(e.preventDefault&&e.preventDefault(),!1):void 0},_handleCut:function(e){return this._cancelCheckSelection(),this._ignoreEvent(e)?void 0:this._doCut(e)?(e.preventDefault&&e.preventDefault(),!1):void 0},_handleDataModified:function(e){this._ignoreEvent(e)||this._startIME()},_handleDblclick:function(e){if(!this._ignoreEvent(e)){var t=e.timeStamp?e.timeStamp:(new Date).getTime();this._lastMouseTime=t,2!==this._clickCount&&(this._clickCount=2,this._handleMouse(e))}},_handleDragStart:function(e){if(!this._ignoreEvent(e)){if(s.isFirefox<13){var t=this,i=this._getWindow();i.setTimeout(function(){t._clientDiv.contentEditable=!0,t._clientDiv.draggable=!1,t._ignoreBlur=!1},0)}return this.isListening("DragStart")&&-1!==this._dragOffset?(this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",e)),this._dragOffset=-1,void 0):(e.preventDefault&&e.preventDefault(),!1)}},_handleDrag:function(e){this._ignoreEvent(e)||this.isListening("Drag")&&this.onDrag(this._createMouseEvent("Drag",e))},_handleDragEnd:function(e){this._ignoreEvent(e)||(this._dropTarget=!1,this._dragOffset=-1,this.isListening("DragEnd")&&this.onDragEnd(this._createMouseEvent("DragEnd",e)),s.isFirefox<13&&(this._fixCaret(),"none"!==e.dataTransfer.dropEffect||e.dataTransfer.mozUserCancelled||this._fixCaret()))},_handleDragEnter:function(e){if(!this._ignoreEvent(e)){var t=!0;return this._dropTarget=!0,this.isListening("DragEnter")&&(t=!1,this.onDragEnter(this._createMouseEvent("DragEnter",e))),s.isWebkit||t?(e.preventDefault&&e.preventDefault(),!1):void 0}},_handleDragOver:function(e){if(!this._ignoreEvent(e)){var t=!0;return this.isListening("DragOver")&&(t=!1,this.onDragOver(this._createMouseEvent("DragOver",e))),s.isWebkit||t?(t&&(e.dataTransfer.dropEffect="none"),e.preventDefault&&e.preventDefault(),!1):void 0}},_handleDragLeave:function(e){this._ignoreEvent(e)||(this._dropTarget=!1,this.isListening("DragLeave")&&this.onDragLeave(this._createMouseEvent("DragLeave",e)))},_handleDrop:function(e){return this._ignoreEvent(e)?void 0:(this._dropTarget=!1,this.isListening("Drop")&&this.onDrop(this._createMouseEvent("Drop",e)),e.preventDefault&&e.preventDefault(),!1)},_handleFocus:function(){this._hasFocus=!0,s.isIOS&&void 0!==this._lastTouchOffset?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=void 0):this._updateDOMSelection(),this._cursorDiv&&(this._cursorDiv.style.display="block"),this._domSelection&&this._domSelection.forEach(function(e){e.update()}),this._ignoreFocus||this.onFocus({type:"Focus"})},_handleKeyDown:function(e){if(this._cancelCheckSelection(),!this._ignoreEvent(e)){if(this.isListening("KeyDown")){var t=this._createKeyEvent("KeyDown",e);if(this.onKeyDown(t),t.defaultPrevented)return s.isFirefox&&(this._keyDownPrevented=!0),void e.preventDefault()}var i=!1;switch(e.keyCode){case 16:case 17:case 18:case 91:i=!0;break;default:this._setLinksVisible(!1)}if(229===e.keyCode){if(this._readonly)return e.preventDefault&&e.preventDefault(),!1;var n=!0;s.isSafari&&s.isMac&&e.ctrlKey&&(n=!1,e.keyCode=129),n&&this._startIME()}else i||this._commitIME();return(s.isMac||s.isLinux)&&s.isFirefox<4||s.isOpera<12.16?(this._keyDownEvent=e,!0):this._doAction(e)?(e.preventDefault?(e.preventDefault(),e.stopPropagation()):(e.cancelBubble=!0,e.returnValue=!1,e.keyCode=0),!1):void 0}},_handleKeyPress:function(e){if(!this._ignoreEvent(e)){if(this._keyDownPrevented)return e.preventDefault&&(e.preventDefault(),e.stopPropagation()),void(this._keyDownPrevented=void 0);if(s.isMac&&s.isWebkit&&(63232<=e.keyCode&&e.keyCode<=63487||13===e.keyCode||8===e.keyCode))return e.preventDefault&&e.preventDefault(),!1;if(((s.isMac||s.isLinux)&&s.isFirefox<4||s.isOpera<12.16)&&this._doAction(this._keyDownEvent))return e.preventDefault&&e.preventDefault(),!1;var t=s.isMac?e.metaKey:e.ctrlKey;if(void 0!==e.charCode&&t)switch(e.charCode){case 99:case 118:case 120:return!0}if(this.isListening("KeyPress")){var i=this._createKeyEvent("KeyPress",e);if(this.onKeyPress(i),i.defaultPrevented)return void e.preventDefault()}if(this._doAction(e))return e.preventDefault?(e.preventDefault(),e.stopPropagation()):(e.cancelBubble=!0,e.returnValue=!1,e.keyCode=0),!1;var n=!1;if(s.isMac?(e.ctrlKey||e.metaKey)&&(n=!0):s.isFirefox?(e.ctrlKey||e.altKey)&&(n=!0):e.ctrlKey^e.altKey&&(n=!0),!n){var o=s.isOpera?e.which:void 0!==e.charCode?e.charCode:e.keyCode;if(o>31)return this._doContent(String.fromCharCode(o)),e.preventDefault&&e.preventDefault(),!1}}},_handleDocKeyUp:function(e){var t=s.isMac?e.metaKey:e.ctrlKey;t||this._setLinksVisible(!1)},_handleKeyUp:function(e){if(!this._ignoreEvent(e)){if(this.isListening("KeyUp")){var t=this._createKeyEvent("KeyUp",e);if(this.onKeyUp(t),t.defaultPrevented)return void e.preventDefault()}this._handleDocKeyUp(e),13===e.keyCode&&this._commitIME()}},_handleLinkClick:function(e){var t=s.isMac?e.metaKey:e.ctrlKey;return t?void 0:(e.preventDefault&&e.preventDefault(),!1)},_handleMouse:function(e){var t=this._getWindow(),i=!0,n=t;if((s.isIE||s.isFirefox&&!this._overlayDiv)&&(n=this._clientDiv),this._overlayDiv){this._hasFocus&&(this._ignoreFocus=!0);var o=this;t.setTimeout(function(){o.focus(),o._ignoreFocus=!1},0)}var r=e.shiftKey,a=e.altKey,l=s.isMac?e.metaKey:e.ctrlKey;if(this._blockSelection=this._doubleClickSelection=null,1===this._clickCount){var c=(!s.isOpera||s.isOpera>=12.16)&&this._hasFocus&&this.isListening("DragStart");i=this._setSelectionTo(e.clientX,e.clientY,!0,r,l,c),i&&this._setGrab(n)}else this._isW3CEvents&&this._setGrab(n),this._setSelectionTo(e.clientX,e.clientY,!0,r,l,!1),this._doubleClickSelection=y.editing(this._getSelections());return a&&(this._blockSelection=y.editing(this._getSelections())),i},_handleMouseDown:function(e){if(!this._ignoreEvent(e)){if(this._linksVisible){var t=e.target||e.srcElement;if("A"===t.tagName)return;this._setLinksVisible(!1)}this._commitIME();var i=e.which;i||(4===e.button&&(i=2),2===e.button&&(i=3),1===e.button&&(i=1));var n=2!==i&&e.timeStamp?e.timeStamp:(new Date).getTime(),o=n-this._lastMouseTime,r=Math.abs(this._lastMouseX-e.clientX),a=Math.abs(this._lastMouseY-e.clientY),l=this._lastMouseButton===i;if(this._lastMouseX=e.clientX,this._lastMouseY=e.clientY,this._lastMouseTime=n,this._lastMouseButton=i,1===i&&(this._isMouseDown=!0,l&&o<=this._clickTime&&r<=this._clickDist&&a<=this._clickDist?this._clickCount++:this._clickCount=1),this.isListening("MouseDown")){var c=this._createMouseEvent("MouseDown",e);if(this.onMouseDown(c),c.defaultPrevented)return void e.preventDefault()}1===i&&this._handleMouse(e)&&(s.isIE>=9||s.isOpera||s.isChrome||s.isSafari||s.isFirefox&&!this._overlayDiv)&&(this._hasFocus||this.focus(),e.preventDefault()),s.isFirefox&&3===this._lastMouseButton&&this._updateDOMSelection()}},_handleMouseOver:function(e){this._ignoreEvent(e)||this._animation||this.isListening("MouseOver")&&this.onMouseOver(this._createMouseEvent("MouseOver",e))},_handleMouseOut:function(e){this._ignoreEvent(e)||this._animation||this.isListening("MouseOut")&&this.onMouseOut(this._createMouseEvent("MouseOut",e))},_handleMouseMove:function(e){if(!this._animation){var t=this._isClientDiv(e);if(this.isListening("MouseMove")&&(t||this._isMouseDown)){var i=this._createMouseEvent("MouseMove",e);if(this.onMouseMove(i),i.defaultPrevented)return void e.preventDefault()}if(!this._dropTarget){var n=this._linksVisible||this._lastMouseMoveX!==e.clientX||this._lastMouseMoveY!==e.clientY;if(this._lastMouseMoveX=e.clientX,this._lastMouseMoveY=e.clientY,this._setLinksVisible(n&&!this._isMouseDown&&e.altKey&&(s.isMac?e.metaKey:e.ctrlKey)),this._checkOverlayScroll(),!this._isW3CEvents){if(0===e.button)return this._setGrab(null),!0;if(!this._isMouseDown&&1===e.button&&0!==(1&this._clickCount)&&t)return this._clickCount=2,this._handleMouse(e,this._clickCount)}if(this._isMouseDown&&-1===this._dragOffset){var o=e.clientX,r=e.clientY,a=this._getViewPadding(),l=this._viewDiv.getBoundingClientRect(),c=this._getClientWidth(),d=this._getClientHeight(),h=l.left+a.left,u=l.top+a.top,p=l.left+a.left+c,f=l.top+a.top+d;u>r?this._doAutoScroll("up",o,r-u):r>f?this._doAutoScroll("down",o,r-f):h>o&&!this._wrapMode?this._doAutoScroll("left",o-h,r):o>p&&!this._wrapMode?this._doAutoScroll("right",o-p,r):(this._endAutoScroll(),this._setSelectionTo(o,r,!1,!0))}}}},_isClientDiv:function(e){for(var t=this._overlayDiv||this._clientDiv,i=e.target?e.target:e.srcElement;i;){if(t===i)return!0;i=i.parentNode}return!1},_createKeyEvent:function(e,t){return{type:e,event:t,preventDefault:function(){this.defaultPrevented=!0}}},_createMouseEvent:function(e,t){var i=this.convert({x:t.clientX,y:t.clientY},"page","document");return{type:e,event:t,clickCount:this._clickCount,x:i.x,y:i.y,preventDefault:function(){this.defaultPrevented=!0}}},_createTouchEvent:function(e,t){var i=t.touches.length?this.convert({x:t.touches[0].clientX,y:t.touches[0].clientY},"page","document"):{};return{type:e,event:t,touchCount:t.touches.length,x:i.x,y:i.y,preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(e){var t=e.which?0===e.button:1===e.button;if(this.isListening("MouseUp")&&(this._isClientDiv(e)||t&&this._isMouseDown)){var i=this._createMouseEvent("MouseUp",e);if(this.onMouseUp(i),i.defaultPrevented)return e.preventDefault(),void(this._isMouseDown=!1)}if(!this._linksVisible){if(t&&this._isMouseDown){var n=this._getSelections(),o=y.editing(n);n.forEach(function(e){e._editing=!1}),-1!==this._dragOffset&&(o.extend(this._dragOffset),o.collapse(),n=o,this._dragOffset=-1),this._setSelection(n,!1),this._isMouseDown=!1,this._endAutoScroll(),this._isW3CEvents&&this._setGrab(null)}t&&this._isMouseDown&&s.isFirefox&&(this._updateDOMSelection(),e.preventDefault())}},_handleMouseWheel:function(e){if(!this._noScroll){var t=this._getLineHeight(),i=0,n=0;if(s.isIE||s.isOpera)n=-e.wheelDelta/40*t;else if(s.isFirefox){var o=256;if("wheel"===e.type)e.deltaMode?(i=Math.max(-o,Math.min(o,e.deltaX))*t,n=Math.max(-o,Math.min(o,e.deltaY))*t):(i=e.deltaX,n=e.deltaY);else{var r;r=s.isMac?3*e.detail:Math.max(-o,Math.min(o,e.detail))*t,e.axis===e.HORIZONTAL_AXIS?i=r:n=r}}else if(s.isMac){var a,l,c=e.timeStamp-this._wheelTimeStamp;this._wheelTimeStamp=e.timeStamp,a=e.wheelDeltaX%120!==0?1:40>c?40/(40-c):40,l=e.wheelDeltaY%120!==0?1:40>c?40/(40-c):40,i=Math.ceil(-e.wheelDeltaX/a),i>-1&&0>i&&(i=-1),i>0&&1>i&&(i=1),n=Math.ceil(-e.wheelDeltaY/l),n>-1&&0>n&&(n=-1),n>0&&1>n&&(n=1)}else{i=-e.wheelDeltaX;var d=8;n=-e.wheelDeltaY/120*d*t}if(s.isSafari||s.isChrome&&s.isMac){for(var h=e.target;h&&void 0===h.lineIndex;)h=h.parentNode;this._mouseWheelLine=h}var u=this._getScroll();this._scrollView(i,n);var p=this._getScroll();return u.x!==p.x||u.y!==p.y?(e.preventDefault&&e.preventDefault(),!1):void 0}},_handlePaste:function(e){if(this._cancelCheckSelection(),!this._ignoreEvent(e)&&!this._ignorePaste&&this._doPaste(e)){if(s.isIE){var t=this;this._ignoreFocus=!0;var i=this._getWindow();i.setTimeout(function(){t._updateDOMSelection(),t._ignoreFocus=!1},0)}return e.preventDefault&&e.preventDefault(),!1}},_handleResize:function(){var e=this._rootDiv.clientWidth,t=this._rootDiv.clientHeight;if(this._rootWidth!==e||this._rootHeight!==t){this._rootWidth!==e&&this._wrapMode&&this._resetLineHeight(),this._rootWidth=e,this._rootHeight=t;var i=s.isIE<9,n=this._calculateMetrics();p(n,this._metrics)||(this._metrics.invalid&&!n.invalid?this._updateStyle(!1,n):(this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight()),this._metrics=n),i=!0),i?this._queueUpdate():this._update(),this.dispatchEvent({type:"Resize"})}},_handleRulerEvent:function(e){for(var t=e.target?e.target:e.srcElement,i=t.lineIndex,n=t;n&&!n._ruler;)void 0===i&&void 0!==n.lineIndex&&(i=n.lineIndex),n=n.parentNode;var o=n?n._ruler:null;if(void 0===i&&o&&"document"===o.getOverview()){var r,s,a=this._getClientHeight(),l=this._model.getLineCount(),c=this._getViewPadding(),d=this._viewDiv.getBoundingClientRect(),h=this._getLineHeight(),u=h*l,p=a+c.top+c.bottom-2*this._metrics.scrollWidth;p>u?(r=h,s=c.top):(r=p/l,s=this._metrics.scrollWidth),i=Math.floor((e.clientY-d.top-s)/r),i>=0&&l>i||(i=void 0)}if(o)switch(e.type){case"click":o.onClick&&o.onClick(i,e);break;case"dblclick":o.onDblClick&&o.onDblClick(i,e);break;case"mousemove":o.onMouseMove&&o.onMouseMove(i,e);break;case"mouseover":o.onMouseOver&&o.onMouseOver(i,e);break;case"mouseout":if(o.onMouseOut){for(var f=e.relatedTarget;f&&f!==this._rootDiv;){if(f===n)return;f=f.parentNode}o.onMouseOut(i,e)}}},_handleScroll:function(){this._lastScrollTime=(new Date).getTime();var e=this._getScroll(!1),t=this._hScroll,i=this._vScroll;if(t!==e.x||i!==e.y){this._hScroll=e.x,this._vScroll=e.y,this._commitIME(),this._update(i===e.y);var n={type:"Scroll",oldValue:{x:t,y:i},newValue:e};this.onScroll(n)}},_handleSelectStart:function(e){var t=this._contextMenuOpen;return this._contextMenuOpen=!1,t?void(this._checkSelectionChange=!0):this._ignoreSelect?(e&&e.preventDefault&&e.preventDefault(),!1):void 0},_getModelOffset:function(e,t){if(e){var i;return i="DIV"===e.tagName?e:e.parentNode.parentNode,i._line?i._line.getModelOffset(e,t):0}},_updateSelectionFromDOM:function(){if(!(s.isIOS||s.isAndroid||this._checkSelectionChange))return!1;var e=this._getWindow(),t=e.getSelection(),i=this._getModelOffset(t.anchorNode,t.anchorOffset),n=this._getModelOffset(t.focusNode,t.focusOffset),o=this._getSelections()[0];if(void 0===i||void 0===n||o.start===i&&o.end===n)return!1;if(this._checkSelectionChange){var r=this._getLineNext(),a=this._getLinePrevious();if(t.anchorNode===r.firstChild.firstChild&&0===t.anchorOffset&&t.focusNode===a.firstChild.firstChild&&0===t.focusOffset)return!1;(t.anchorNode===r.firstChild.firstChild&&0===t.anchorOffset&&t.focusNode===a.lastChild.firstChild||t.anchorNode===this._clientDiv&&t.focusNode===this._clientDiv)&&(i=0,n=this.getModel().getCharCount())}return this._setSelection(new y(i,n),!1,!1),this._checkSelectionChange=!1,!0},_cancelCheckSelection:function(){this._checkSelectionChange&&(this._checkSelectionChange=!1,this._cancelPollSelectionChange())},_cancelPollSelectionChange:function(){if(this._selPollTimer){var e=this._getWindow();e.clearTimeout(this._selPollTimer),this._selPollTimer=null}},_pollSelectionChange:function(e){var t=this,i=this._getWindow();this._cancelPollSelectionChange(),this._selPollTimer=i.setTimeout(function(){if(t._selPollTimer=null,t._clientDiv){var i=t._updateSelectionFromDOM();!i&&e&&t._pollSelectionChange(e)}},100)},_handleSelectionChange:function(){-1===this._imeOffset&&(s.isAndroid?this._pollSelectionChange():this._updateSelectionFromDOM())},_handleTextInput:function(e){if(!this._ignoreEvent(e)&&-1===this._imeOffset){var t=this._getWindow().getSelection();if(t.anchorNode!==this._anchorNode||t.focusNode!==this._focusNode||t.anchorOffset!==this._anchorOffset||t.focusOffset!==this._focusOffset){for(var i=t.anchorNode;i&&void 0===i.lineIndex;)i=i.parentNode;if(i){var n=this._model,o=i.lineIndex,r=n.getLine(o),s=r,a=0,l=n.getLineStart(o);if(t.rangeCount>0){t.getRangeAt(0).deleteContents();var c=i.ownerDocument.createTextNode(e.data);t.getRangeAt(0).insertNode(c);var d=this._getDOMText(i,c);s=d.text,a=d.offset,c.parentNode.removeChild(c)}i.lineRemoved=!0;for(var h=0;r.charCodeAt(h)===s.charCodeAt(h)&&a>h;)h++;for(var u=r.length-1,p=s.length-r.length;r.charCodeAt(u)===s.charCodeAt(u+p)&&u+p>=a+e.data.length;)u--;u++;var f=s.substring(h,u+p);h+=l,u+=l;var g=this._getSelections(),m=g[0].start-h,v=g[0].end-u;g[0].start=h,g[0].end=u;for(var _=1;_<g.length;_++)g[_].start-=m,g[_].end-=v;this._modifyContent({text:f,selection:g,_ignoreDOMSelection:!0},!0)}}else this._doContent(e.data);e.preventDefault()}},_handleTouchStart:function(e){if(this.isListening("TouchStart")){var t=this._createTouchEvent("TouchStart",e);if(this.onTouchStart(t),t.defaultPrevented)return void e.preventDefault();if(this._noScroll)return}this._commitIME();var i=this._getWindow();this._touchScrollTimer&&(this._vScrollDiv.style.display="none",this._hScrollDiv.style.display="none",i.clearInterval(this._touchScrollTimer),this._touchScrollTimer=null);var n=e.touches;if(1===n.length){var o=n[0],r=o.clientX,a=o.clientY;this._touchStartX=r,this._touchStartY=a,s.isAndroid&&(a<o.pageY-i.pageYOffset||r<o.pageX-i.pageXOffset)&&(r=o.pageX-i.pageXOffset,a=o.pageY-i.pageYOffset);var l=this.convert({x:r,y:a},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(l.x,l.y),this._touchStartTime=e.timeStamp,this._touching=!0}},_handleTouchMove:function(e){if(this.isListening("TouchMove")){var t=this._createTouchEvent("TouchMove",e);if(this.onTouchMove(t),t.defaultPrevented)return void e.preventDefault();if(this._noScroll)return}var i=e.touches;if(1===i.length){var n=i[0];this._touchCurrentX=n.clientX,this._touchCurrentY=n.clientY;var o=10;if(!this._touchScrollTimer&&e.timeStamp-this._touchStartTime<20*o){this._vScrollDiv.style.display="block",this._wrapMode||(this._hScrollDiv.style.display="block");var r=this,s=this._getWindow();this._touchScrollTimer=s.setInterval(function(){var e=0,t=0;if(r._touching)e=r._touchStartX-r._touchCurrentX,t=r._touchStartY-r._touchCurrentY,r._touchSpeedX=e/o,r._touchSpeedY=t/o,r._touchStartX=r._touchCurrentX,r._touchStartY=r._touchCurrentY;else{if(Math.abs(r._touchSpeedX)<.1&&Math.abs(r._touchSpeedY)<.1)return r._vScrollDiv.style.display="none",r._hScrollDiv.style.display="none",s.clearInterval(r._touchScrollTimer),void(r._touchScrollTimer=null);e=r._touchSpeedX*o,t=r._touchSpeedY*o,r._touchSpeedX*=.95,r._touchSpeedY*=.95}r._scrollView(e,t)},o)}this._touchScrollTimer&&e.preventDefault()}},_handleTouchEnd:function(e){if(this.isListening("TouchEnd")){var t=this._createTouchEvent("TouchEnd",e);if(this.onTouchEnd(t),t.defaultPrevented)return void e.preventDefault();if(this._noScroll)return}var i=e.touches;0===i.length&&(this._touching=!1)},_doAction:function(e){var t,i,n=this._keyModes;for(i=n.length-1;i>=0;i--)if(t=n[i],"function"==typeof t.match){var o=t.match(e);if(void 0!==o)return this.invokeAction(o)}return!1},_doMove:function(e,t){var i=this._model,n=t.getCaret(),o=i.getLineAtOffset(n);for(e.count||(e.count=1);0!==e.count;){var r=i.getLineStart(o);if(e.count<0&&n===r){if(!(o>0))break;"character"===e.unit&&e.count++,o--,t.extend(i.getLineEnd(o))}else if(e.count>0&&n===i.getLineEnd(o)){if(!(o+1<i.getLineCount()))break;"character"===e.unit&&e.count--,o++,t.extend(i.getLineStart(o))}else{var s=!1;if(e.expandTab&&"character"===e.unit&&(n-r)%this._tabSize===0){var a=i.getText(r,n);s=!/[^ ]/.test(a)}if(s)t.extend(n-this._tabSize),e.count+=e.count<0?1:-1;else{var l=this._getLine(o);t.extend(l.getNextOffset(n,e)),l.destroy()}}n=t.getCaret()}return t},_doBackspace:function(e){var t=this,i=this._getSelections();return i.forEach(function(i){i.isEmpty()&&(e.count||(e.count=1),e.count*=-1,e.expandTab=t._expandTab,t._doMove(e,i))}),this._modifyContent({text:"",selection:i},!0),!0},_doCase:function(e){var t=this,i=this._getSelections(),n=[];return i.forEach(function(i){t._doMove(e,i);var o=t.getText(i.start,i.end);switch(e.type){case"lower":o=o.toLowerCase();break;case"capitalize":o=o.replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()});break;case"reverse":for(var r="",s=0;s<o.length;s++){var a=o[s],l=a.toLowerCase();a=l!==a?l:a.toUpperCase(),r+=a}o=r;break;default:o=o.toUpperCase()}n.push(o)}),this._modifyContent({text:n,selection:i,_ignoreDOMSelection:!0},!0)},_doContent:function(e){var t=this,i=this._getSelections();return i.forEach(function(e){if(t._overwriteMode&&e.isEmpty()){var i=t._model,n=i.getLineAtOffset(e.end);if(e.end<i.getLineEnd(n)){var o=t._getLine(n);e.extend(o.getNextOffset(e.getCaret(),{unit:"character",count:1})),o.destroy()}}}),this._modifyContent({text:e,selection:i,_ignoreDOMSelection:!0},!0)},_doCopy:function(e){var t=this.getSelectionText();return t?this._setClipboardText(t,e):!0},_doCursorNext:function(e){var t=this,i=this._getSelections();return i.forEach(function(i){i.isEmpty()||e.select?t._doMove(e,i):i.start=i.end,e.select||i.collapse()}),this._setSelection(i,!0),!0},_doCursorPrevious:function(e){var t=this,i=this._getSelections();return i.forEach(function(i){i.isEmpty()||e.select?(e.count||(e.count=1),e.count*=-1,t._doMove(e,i)):i.end=i.start,e.select||i.collapse()}),this._setSelection(i,!0),!0},_doCut:function(e){var t=this.getSelectionText();if(t){if(!this._setClipboardText(t,e))return!1;this._doContent("")}return!0},_doDelete:function(e){var t=this,i=this._getSelections();return i.forEach(function(i){i.isEmpty()&&t._doMove(e,i)}),this._modifyContent({text:"",selection:i},!0),!0},_doEnd:function(e){var t=this._model,i=this,n=this._getSelections();return n.forEach(function(n){if(e.ctrl)n.extend(t.getCharCount());else{var o=n.getCaret(),r=t.getLineAtOffset(o);if(i._wrapMode){var s=i._getLine(r),a=s.getLineIndex(o);o=a===s.getLineCount()-1?t.getLineEnd(r):s.getLineStart(a+1)-1,s.destroy()}else e.count&&e.count>0&&(r=Math.min(r+e.count-1,t.getLineCount()-1)),o=t.getLineEnd(r);n.extend(o)}e.select||n.collapse()}),this._setSelection(n,!0,!0,e.ctrl?function(){}:null),!0},_doEnter:function(e){if(this._singleMode)return!0;var t=this._model,i=this._getSelections();return this._doContent(t.getLineDelimiter()),e&&e.noCursor&&(i.forEach(function(e){e.end=e.start}),this._setSelection(i,!0)),!0},_doEscape:function(){var e=this._getSelections();return e.length>1&&this._setSelection(e[0],!0),!0},_doHome:function(e){var t=this._model,i=this,n=this._getSelections();return n.forEach(function(n){if(e.ctrl)n.extend(0);else{var o=n.getCaret(),r=t.getLineAtOffset(o);if(i._wrapMode){var s=i._getLine(r),a=s.getLineIndex(o);o=s.getLineStart(a),s.destroy()}else o=t.getLineStart(r);n.extend(o)}e.select||n.collapse()}),this._setSelection(n,!0,!0,e.ctrl?function(){}:null),!0},_doLineDown:function(e){var t=this._model,i=this,n=this._getSelections();return n.forEach(function(n){var o,r=n.getCaret(),a=t.getLineAtOffset(r),l=i._getLine(a),c=n._columnX,d=1,h=!1;if(-1===c||e.wholeLine||e.select&&s.isIE){var u=e.wholeLine?t.getLineEnd(a+1):r;c=n._columnX=l.getBoundingClientRect(u).left}if((o=l.getLineIndex(r))<l.getLineCount()-1)d=l.getClientRects(o+1).top+1;else{var p=t.getLineCount()-1;h=a===p,e.count&&e.count>0?a=Math.min(a+e.count,p):a++}var f=!1;h?(e.select||s.isMac||s.isLinux)&&(n.extend(t.getCharCount()),f=!0):(l.lineIndex!==a&&(l.destroy(),l=i._getLine(a)),n.extend(l.getOffset(c,d)),f=!0),f&&(e.select||n.collapse()),l.destroy()}),i._setSelection(n,!0,!0,null,0,!1,!0),!0},_doLineUp:function(e){var t=this._model,i=this,n=this._getSelections();return n.forEach(function(n){var o,r,a=n.getCaret(),l=t.getLineAtOffset(a),c=i._getLine(l),d=n._columnX,h=!1;if(-1===d||e.wholeLine||e.select&&s.isIE){var u=e.wholeLine?t.getLineStart(l-1):a;d=n._columnX=c.getBoundingClientRect(u).left}(o=c.getLineIndex(a))>0?r=c.getClientRects(o-1).top+1:(h=0===l,h||(e.count&&e.count>0?l=Math.max(l-e.count,0):l--,r=i._getLineHeight(l)-1));var p=!1;h?(e.select||s.isMac||s.isLinux)&&(n.extend(0),p=!0):(c.lineIndex!==l&&(c.destroy(),c=i._getLine(l)),n.extend(c.getOffset(d,r)),p=!0),p&&(e.select||n.collapse()),c.destroy()}),i._setSelection(n,!0,!0,null,0,!1,!0),!0},_doNoop:function(){return!0},_doPageDown:function(e){var t,i,n,o=this,r=this._model,a=this._getSelections(),l=r.getLineCount(),c=this._getScroll(),d=this._getClientHeight(),h=this._getLineHeight(),u=Math.floor(d/h);return a.forEach(function(a){var p=a.getCaret(),f=r.getLineAtOffset(p);if(o._lineHeight){t=a._columnX;var g=o._getBoundsAtOffset(p);(-1===t||e.select&&s.isIE)&&(t=a._columnX=g.left);var m=o._getLineIndex(g.top+d);i=o._getLine(m);var v=o._getLinePixel(m),_=g.top+d-v;p=i.getOffset(t,_);var y=i.getBoundingClientRect(p);i.destroy(),a.extend(p),e.select||a.collapse(),n=void 0!==n?Math.min(n,y.top+v-g.top):y.top+v-g.top}else if(l-1>f){var C=Math.min(l-f-1,u);C=Math.max(1,C),t=a._columnX,(-1===t||e.select&&s.isIE)&&(i=o._getLine(f),t=a._columnX=i.getBoundingClientRect(p).left,i.destroy()),i=o._getLine(f+C),a.extend(i.getOffset(t,0)),i.destroy(),e.select||a.collapse();var w=l*h,b=c.y+C*h;b+d>w&&(b=w-d),n=void 0!==n?Math.min(n,b-c.y):b-c.y}}),this._setSelection(a,!0,!0,function(){},n,!1,!0),!0},_doPageUp:function(e){var t,i,n,o=this,r=this._model,a=this._getSelections(),l=this._getScroll(),c=this._getClientHeight(),d=this._getLineHeight(),h=Math.floor(c/d);return a.forEach(function(a){var u=a.getCaret(),p=r.getLineAtOffset(u);if(o._lineHeight){t=a._columnX;var f=o._getBoundsAtOffset(u);(-1===t||e.select&&s.isIE)&&(t=a._columnX=f.left);var g=o._getLineIndex(f.bottom-c);i=o._getLine(g);var m=o._getLinePixel(g),v=f.bottom-c-m;u=i.getOffset(t,v);var _=i.getBoundingClientRect(u);i.destroy(),a.extend(u),e.select||a.collapse(),n=void 0!==n?Math.max(n,_.top+m-f.top):_.top+m-f.top}else if(p>0){var y=Math.max(1,Math.min(p,h));t=a._columnX,(-1===t||e.select&&s.isIE)&&(i=o._getLine(p),t=a._columnX=i.getBoundingClientRect(u).left,i.destroy()),i=o._getLine(p-y),a.extend(i.getOffset(t,o._getLineHeight(p-y)-1)),i.destroy(),e.select||a.collapse();var C=Math.max(0,l.y-y*d);n=void 0!==n?Math.max(n,C-l.y):C-l.y}}),this._setSelection(a,!0,!0,function(){},n,!1,!0),!0},_doPaste:function(e){var t=this,i=this._getClipboardText(e,function(e){if(e.length){if(s.isLinux&&2===t._lastMouseButton){var i=(new Date).getTime()-t._lastMouseTime;i<=t._clickTime&&t._setSelectionTo(t._lastMouseX,t._lastMouseY,!0)}var n=t._getSelections(),o=t._singleMode?"":t._model.getLineDelimiter();t._doContent(n.length>1&&n.length===e.length?e:e.join(o))}});return null!==i},_doScroll:function(e){var t,i=e.type,n=this._model,o=n.getLineCount(),r=this._getClientHeight(),s=this._getLineHeight(),a=this._lineHeight?this._scrollHeight:o*s,l=this._getScroll().y;switch(i){case"textStart":t=0;break;case"textEnd":t=a-r;break;case"pageDown":t=l+r;break;case"pageUp":t=l-r;break;case"lineDown":t=l+s;break;case"lineUp":t=l-s;break;case"centerLine":var c=this._getSelections()[0],d=n.getLineAtOffset(c.start),h=n.getLineAtOffset(c.end),u=(h-d+1)*s;t=d*s-r/2+u/2}return void 0!==t&&(t=Math.min(Math.max(0,t),a-r),this._scrollViewAnimated(0,t-l,function(){})),!0},_doSelectAll:function(){var e=this._model;return this._setSelection(new y(0,e.getCharCount()),!1),!0},_doTab:function(){if(this._tabMode&&!this._readonly){var e="	",t=this._getSelections();if(this._expandTab){e=[];var i=this._model,n=this._tabSize;t.forEach(function(t){var o=t.getCaret(),r=i.getLineAtOffset(o),s=i.getLineStart(r),a=n-(o-s)%n;e.push(c(a+1).join(" "))})}return this._modifyContent({text:e,selection:t,_ignoreDOMSelection:!0},!0)}},_doShiftTab:function(){return this._tabMode&&!this._readonly?!0:void 0},_doOverwriteMode:function(){return this._readonly?void 0:(this.setOptions({overwriteMode:!this.getOptions("overwriteMode")}),!0)},_doTabMode:function(){return this._tabMode=!this._tabMode,!0},_doWrapMode:function(){return this.setOptions({wrapMode:!this.getOptions("wrapMode")}),!0},_autoScroll:function(){var e,t,i=this._model,n=this._getSelections(),o=y.editing(n,"down"===this._autoScrollDir),r=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),a=o.getCaret(),l=i.getLineCount(),c=i.getLineAtOffset(a);if("up"===this._autoScrollDir||"down"===this._autoScrollDir){var d=this._autoScrollY/this._getLineHeight();d=0>d?Math.floor(d):Math.ceil(d),e=c,e=Math.max(0,Math.min(l-1,e+d))}else("left"===this._autoScrollDir||"right"===this._autoScrollDir)&&(e=this._getLineIndex(r.y),t=this._getLine(c),r.x+=t.getBoundingClientRect(a,!1).left,t.destroy());this._blockSelection?n=this._getBlockSelections(n,e,r):0===e&&(s.isMac||s.isLinux)?o.extend(0):e===l-1&&(s.isMac||s.isLinux)?o.extend(i.getCharCount()):(t=this._getLine(e),o.extend(t.getOffset(r.x,r.y-this._getLinePixel(e))),t.destroy()),this._setSelection(n,!0)},_autoScrollTimer:function(){this._autoScroll();var e=this,t=this._getWindow();this._autoScrollTimerID=t.setTimeout(function(){e._autoScrollTimer()},this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(e){if(this._lineHeight&&!this._calculateLHTimer){var t=this._model.getLineCount(),i=0;if(e){for(var n=0,o=100,r=(new Date).getTime(),s=0;t>i&&(this._lineHeight[i]||(n++,s||(s=i),this._lineHeight[i]=this._calculateLineHeight(i)),i++,!((new Date).getTime()-r>o)););this.redrawRulers(0,t),this._queueUpdate()}var a=this._getWindow();if(i!==t){var l=this;return void(this._calculateLHTimer=a.setTimeout(function(){l._calculateLHTimer=null,l._calculateLineHeightTimer(!0)},0))}this._calculateLHTimer&&(a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=void 0)}},_calculateLineHeight:function(e){var t=this._getLine(e),i=t.getBoundingClientRect();return t.destroy(),Math.max(1,i.bottom-i.top)},_calculateMetrics:function(){var e=this._clientDiv,t=e.ownerDocument,i=" ",n=s.createElement(t,"div");n.style.lineHeight="normal";var o=this._model,r=o.getLine(0),a={type:"LineStyle",textView:this,0:0,lineText:r,lineStart:0};this.onLineStyle(a),d(a.style,n),n.style.position="fixed",n.style.left="-1000px";var l=s.createElement(t,"span");l.appendChild(t.createTextNode(i)),n.appendChild(l);var h=s.createElement(t,"span");h.style.fontStyle="italic",h.appendChild(t.createTextNode(i)),n.appendChild(h);var u=s.createElement(t,"span");u.style.fontWeight="bold",u.appendChild(t.createTextNode(i)),n.appendChild(u);var p=s.createElement(t,"span");p.style.fontWeight="bold",p.style.fontStyle="italic",p.appendChild(t.createTextNode(i)),n.appendChild(p),e.appendChild(n);var f=n.getBoundingClientRect(),g=l.getBoundingClientRect(),_=h.getBoundingClientRect(),y=u.getBoundingClientRect(),C=p.getBoundingClientRect(),w=g.bottom-g.top,b=_.bottom-_.top,S=y.bottom-y.top,x=C.bottom-C.top,L=0,T=f.bottom-f.top<=0,E=Math.max(1,f.bottom-f.top);b>w&&(L=1),S>b&&(L=2),x>S&&(L=3);var k;0!==L&&(k={style:{}},0!==(1&L)&&(k.style.fontStyle="italic"),0!==(2&L)&&(k.style.fontWeight="bold"));var N=v(n);e.removeChild(n);var A=m(this._viewDiv),R=s.createElement(t,"div");R.style.position="fixed",R.style.left="-1000px",R.style.paddingLeft=A.left+"px",R.style.paddingTop=A.top+"px",R.style.paddingRight=A.right+"px",R.style.paddingBottom=A.bottom+"px",R.style.width="100px",R.style.height="100px";
var I=s.createElement(t,"div");I.style.width="100%",I.style.height="100%",R.appendChild(I),e.appendChild(R);var D=R.getBoundingClientRect(),P=I.getBoundingClientRect(),M=0;if(!this._singleMode&&!this._noScroll){R.style.overflow="hidden",I.style.height="200px";var O=R.clientWidth;R.style.overflow="scroll";var B=R.clientWidth;M=O-B}e.removeChild(R),A={left:P.left-D.left,top:P.top-D.top,right:D.right-P.right,bottom:D.bottom-P.bottom};var F=0,j=0,V=0;return T||(R=s.createElement(t,"div"),R.style.position="fixed",R.style.left="-1000px",e.appendChild(R),R.innerHTML=c(2).join("a"),D=R.getBoundingClientRect(),V=Math.ceil(D.right-D.left),(this._wrapOffset||this._marginOffset)&&(R.innerHTML=c(this._wrapOffset+1+(s.isWebkit?0:1)).join(" "),D=R.getBoundingClientRect(),F=Math.ceil(D.right-D.left),R.innerHTML=c(this._marginOffset+1).join(" "),P=R.getBoundingClientRect(),j=Math.ceil(P.right-P.left)),e.removeChild(R)),{lineHeight:E,largestFontStyle:k,lineTrim:N,viewPadding:A,scrollWidth:M,wrapWidth:F,marginWidth:j,charWidth:V,invalid:T}},_cancelAnimation:function(){this._animation&&(this._animation.stop(),this._animation=null)},_clearSelection:function(e){var t=this._getSelections();return t.forEach(function(t){"next"===e?t.start=t.end:t.end=t.start}),this._setSelection(t,!0),!0},_commitIME:function(e){if(-1!==this._imeOffset){var t=this._model,i=t.getLineAtOffset(this._imeOffset),n=t.getLineStart(i),o=this._getLineNode(i);if(!e){this._scrollDiv.focus(),this._clientDiv.focus();var r=this._getDOMText(o).text,a=t.getLine(i),l=this._imeOffset-n,c=l+r.length-a.length;l!==c&&(e=r.substring(l,c))}this._imeOffset=-1,e&&(this._doContent(e)||s.isWebkit||(o.lineRemoved=!0,this._queueUpdate()))}},_createActions:function(){this.addKeyMode(new i.DefaultKeyMode(this));var t=this;this._actions={noop:{defaultHandler:function(){return t._doNoop()}},lineUp:{defaultHandler:function(e){return t._doLineUp(u(e,{select:!1}))},actionDescription:{name:e.lineUp}},lineDown:{defaultHandler:function(e){return t._doLineDown(u(e,{select:!1}))},actionDescription:{name:e.lineDown}},lineStart:{defaultHandler:function(e){return t._doHome(u(e,{select:!1,ctrl:!1}))},actionDescription:{name:e.lineStart}},lineEnd:{defaultHandler:function(e){return t._doEnd(u(e,{select:!1,ctrl:!1}))},actionDescription:{name:e.lineEnd}},charPrevious:{defaultHandler:function(e){return t._doCursorPrevious(u(e,{select:!1,unit:"character"}))},actionDescription:{name:e.charPrevious}},charNext:{defaultHandler:function(e){return t._doCursorNext(u(e,{select:!1,unit:"character"}))},actionDescription:{name:e.charNext}},pageUp:{defaultHandler:function(e){return t._doPageUp(u(e,{select:!1}))},actionDescription:{name:e.pageUp}},pageDown:{defaultHandler:function(e){return t._doPageDown(u(e,{select:!1}))},actionDescription:{name:e.pageDown}},scrollPageUp:{defaultHandler:function(e){return t._doScroll(u(e,{type:"pageUp"}))},actionDescription:{name:e.scrollPageUp}},scrollPageDown:{defaultHandler:function(e){return t._doScroll(u(e,{type:"pageDown"}))},actionDescription:{name:e.scrollPageDown}},scrollLineUp:{defaultHandler:function(e){return t._doScroll(u(e,{type:"lineUp"}))},actionDescription:{name:e.scrollLineUp}},scrollLineDown:{defaultHandler:function(e){return t._doScroll(u(e,{type:"lineDown"}))},actionDescription:{name:e.scrollLineDown}},wordPrevious:{defaultHandler:function(e){return t._doCursorPrevious(u(e,{select:!1,unit:"word"}))},actionDescription:{name:e.wordPrevious}},wordNext:{defaultHandler:function(e){return t._doCursorNext(u(e,{select:!1,unit:"word"}))},actionDescription:{name:e.wordNext}},textStart:{defaultHandler:function(e){return t._doHome(u(e,{select:!1,ctrl:!0}))},actionDescription:{name:e.textStart}},textEnd:{defaultHandler:function(e){return t._doEnd(u(e,{select:!1,ctrl:!0}))},actionDescription:{name:e.textEnd}},scrollTextStart:{defaultHandler:function(e){return t._doScroll(u(e,{type:"textStart"}))},actionDescription:{name:e.scrollTextStart}},scrollTextEnd:{defaultHandler:function(e){return t._doScroll(u(e,{type:"textEnd"}))},actionDescription:{name:e.scrollTextEnd}},centerLine:{defaultHandler:function(e){return t._doScroll(u(e,{type:"centerLine"}))},actionDescription:{name:e.centerLine}},selectLineUp:{defaultHandler:function(e){return t._doLineUp(u(e,{select:!0}))},actionDescription:{name:e.selectLineUp}},selectLineDown:{defaultHandler:function(e){return t._doLineDown(u(e,{select:!0}))},actionDescription:{name:e.selectLineDown}},selectWholeLineUp:{defaultHandler:function(e){return t._doLineUp(u(e,{select:!0,wholeLine:!0}))},actionDescription:{name:e.selectWholeLineUp}},selectWholeLineDown:{defaultHandler:function(e){return t._doLineDown(u(e,{select:!0,wholeLine:!0}))},actionDescription:{name:e.selectWholeLineDown}},selectLineStart:{defaultHandler:function(e){return t._doHome(u(e,{select:!0,ctrl:!1}))},actionDescription:{name:e.selectLineStart}},selectLineEnd:{defaultHandler:function(e){return t._doEnd(u(e,{select:!0,ctrl:!1}))},actionDescription:{name:e.selectLineEnd}},selectCharPrevious:{defaultHandler:function(e){return t._doCursorPrevious(u(e,{select:!0,unit:"character"}))},actionDescription:{name:e.selectCharPrevious}},selectCharNext:{defaultHandler:function(e){return t._doCursorNext(u(e,{select:!0,unit:"character"}))},actionDescription:{name:e.selectCharNext}},selectPageUp:{defaultHandler:function(e){return t._doPageUp(u(e,{select:!0}))},actionDescription:{name:e.selectPageUp}},selectPageDown:{defaultHandler:function(e){return t._doPageDown(u(e,{select:!0}))},actionDescription:{name:e.selectPageDown}},selectWordPrevious:{defaultHandler:function(e){return t._doCursorPrevious(u(e,{select:!0,unit:"word"}))},actionDescription:{name:e.selectWordPrevious}},selectWordNext:{defaultHandler:function(e){return t._doCursorNext(u(e,{select:!0,unit:"word"}))},actionDescription:{name:e.selectWordNext}},selectTextStart:{defaultHandler:function(e){return t._doHome(u(e,{select:!0,ctrl:!0}))},actionDescription:{name:e.selectTextStart}},selectTextEnd:{defaultHandler:function(e){return t._doEnd(u(e,{select:!0,ctrl:!0}))},actionDescription:{name:e.selectTextEnd}},deletePrevious:{defaultHandler:function(e){return t._doBackspace(u(e,{unit:"character"}))},actionDescription:{name:e.deletePrevious}},deleteNext:{defaultHandler:function(e){return t._doDelete(u(e,{unit:"character"}))},actionDescription:{name:e.deleteNext}},deleteWordPrevious:{defaultHandler:function(e){return t._doBackspace(u(e,{unit:"word"}))},actionDescription:{name:e.deleteWordPrevious}},deleteWordNext:{defaultHandler:function(e){return t._doDelete(u(e,{unit:"word"}))},actionDescription:{name:e.deleteWordNext}},deleteLineStart:{defaultHandler:function(e){return t._doBackspace(u(e,{unit:"line"}))},actionDescription:{name:e.deleteLineStart}},deleteLineEnd:{defaultHandler:function(e){return t._doDelete(u(e,{unit:"line"}))},actionDescription:{name:e.deleteLineEnd}},tab:{defaultHandler:function(e){return t._doTab(u(e,{}))},actionDescription:{name:e.tab}},shiftTab:{defaultHandler:function(e){return t._doShiftTab(u(e,{}))},actionDescription:{name:e.shiftTab}},enter:{defaultHandler:function(e){return t._doEnter(u(e,{}))},actionDescription:{name:e.enter}},enterNoCursor:{defaultHandler:function(e){return t._doEnter(u(e,{noCursor:!0}))},actionDescription:{name:e.enterNoCursor}},escape:{defaultHandler:function(e){return t._doEscape(u(e,{}))},actionDescription:{name:e.escape}},selectAll:{defaultHandler:function(e){return t._doSelectAll(u(e,{}))},actionDescription:{name:e.selectAll}},copy:{defaultHandler:function(e){return t._doCopy(u(e,{}))},actionDescription:{name:e.copy}},cut:{defaultHandler:function(e){return t._doCut(u(e,{}))},actionDescription:{name:e.cut}},paste:{defaultHandler:function(e){return t._doPaste(u(e,{}))},actionDescription:{name:e.paste}},uppercase:{defaultHandler:function(e){return t._doCase(u(e,{type:"upper"}))},actionDescription:{name:e.uppercase}},lowercase:{defaultHandler:function(e){return t._doCase(u(e,{type:"lower"}))},actionDescription:{name:e.lowercase}},capitalize:{defaultHandler:function(e){return t._doCase(u(e,{unit:"word",type:"capitalize"}))},actionDescription:{name:e.capitalize}},reversecase:{defaultHandler:function(e){return t._doCase(u(e,{type:"reverse"}))},actionDescription:{name:e.reversecase}},toggleOverwriteMode:{defaultHandler:function(e){return t._doOverwriteMode(u(e,{}))},actionDescription:{name:e.toggleOverwriteMode}},toggleTabMode:{defaultHandler:function(e){return t._doTabMode(u(e,{}))},actionDescription:{name:e.toggleTabMode}},toggleWrapMode:{defaultHandler:function(e){return t._doWrapMode(u(e,{}))},actionDescription:{name:e.toggleWrapMode}}}},_createRulerParent:function(e,t){var i=s.createElement(e,"div");return i.className=t,i.tabIndex=-1,i.style.overflow="hidden",i.style.MozUserSelect="none",i.style.WebkitUserSelect="none",i.style.position="absolute",i.style.top="0px",i.style.bottom="0px",i.style.cursor="default",i.style.display="none",i.setAttribute("aria-hidden","true"),this._rootDiv.appendChild(i),i},_createRuler:function(e,t){if(this._clientDiv){var i=this._getRulerParent(e);if(i){(i!==this._marginDiv||this._marginOffset)&&(i.style.display="block"),i.rulerWidth=void 0;var n=s.createElement(i.ownerDocument,"div");if(n._ruler=e,e.node=n,n.rulerChanged=!0,n.style.position="relative",n.style.cssFloat="left",n.style.styleFloat="left",n.style.outline="none",void 0===t||0>t||t>=i.children.length)i.appendChild(n);else{for(var o=i.firstChild;o&&t-->0;)o=o.nextSibling;i.insertBefore(n,o)}}}},_createSelectionDiv:function(){var e=s.createElement(this._parent.ownerDocument,"div");return e.className="textviewSelection",e.style.position="absolute",e.style.borderWidth="0px",e.style.margin="0px",e.style.padding="0px",e.style.outline="none",e.style.width="0px",e.style.height="0px",e.style.zIndex="0",e},_createView:function(){function e(){C._rootDiv&&(C.update(!0),C._metrics.invalid&&C._getWindow().setTimeout(function(){e()},100))}if(!this._clientDiv){for(var t=this._parent;t.hasChildNodes();)t.removeChild(t.lastChild);var i=t.ownerDocument,n=s.createElement(i,"div");this._rootDiv=n,n.tabIndex=-1,n.style.position="relative",n.style.overflow="hidden",n.style.width="100%",n.style.height="100%",n.style.overflow="hidden",n.style.WebkitTextSizeAdjust="100%",n.setAttribute("role","application"),t.appendChild(n);var o=this._createRulerParent(i,"textviewLeftRuler");this._leftDiv=o;var r=s.createElement(i,"div");r.className="textviewScroll",this._viewDiv=r,r.tabIndex=-1,r.style.position="absolute",r.style.top="0px",r.style.bottom="0px",r.style.borderWidth="0px",r.style.margin="0px",r.style.outline="none",r.style.background="transparent",n.appendChild(r);var a=this._createRulerParent(i,"textviewRightRuler");this._rightDiv=a,"rtl"==document.dir?a.style.left="0px":a.style.right="0px";var l=this._createRulerParent(i,"textviewInnerRightRuler");this._innerRightDiv=l,l.style.zIndex="1";var c=s.createElement(i,"div");this._scrollDiv=c,c.style.margin="0px",c.style.borderWidth="0px",c.style.padding="0px",r.appendChild(c);var d=this._marginDiv=this._createRulerParent(i,"textviewMarginRuler");if(d.style.zIndex="4",!s.isIE&&!s.isIOS){var h=s.createElement(i,"div");this._clipDiv=h,h.style.position="absolute",h.style.overflow="hidden",h.style.margin="0px",h.style.borderWidth="0px",h.style.padding="0px",h.style.background="transparent",n.appendChild(h);var u=s.createElement(i,"div");this._clipScrollDiv=u,u.style.position="absolute",u.style.height="1px",u.style.top="-1000px",u.style.background="transparent",h.appendChild(u)}var p=s.createElement(i,"div");if(p.className="textviewContent",this._clientDiv=p,p.tabIndex=0,p.style.position="absolute",p.style.borderWidth="0px",p.style.margin="0px",p.style.padding="0px",p.style.outline="none",p.style.zIndex="1",p.style.WebkitUserSelect="text",p.setAttribute("spellcheck","false"),(s.isIOS||s.isAndroid)&&(p.style.WebkitTapHighlightColor="transparent"),(this._clipDiv||n).appendChild(p),this._setFullSelection(this._fullSelection,!0),s.isIOS||s.isAndroid){var f=s.createElement(i,"div");this._vScrollDiv=f,f.style.position="absolute",f.style.borderWidth="1px",f.style.borderColor="white",f.style.borderStyle="solid",f.style.borderRadius="4px",f.style.backgroundColor="black",f.style.opacity="0.5",f.style.margin="0px",f.style.padding="0px",f.style.outline="none",f.style.zIndex="3",f.style.width="8px",f.style.display="none",n.appendChild(f);var g=s.createElement(i,"div");this._hScrollDiv=g,g.style.position="absolute",g.style.borderWidth="1px",g.style.borderColor="white",g.style.borderStyle="solid",g.style.borderRadius="4px",g.style.backgroundColor="black",g.style.opacity="0.5",g.style.margin="0px",g.style.padding="0px",g.style.outline="none",g.style.zIndex="3",g.style.height="8px",g.style.display="none",n.appendChild(g)}if(s.isFirefox&&!p.setCapture){var m=s.createElement(i,"div");this._overlayDiv=m,m.style.position=p.style.position,m.style.borderWidth=p.style.borderWidth,m.style.margin=p.style.margin,m.style.padding=p.style.padding,m.style.cursor="text",m.style.zIndex="2",(this._clipDiv||n).appendChild(m)}p.contentEditable="true",p.setAttribute("role","textbox"),p.setAttribute("aria-multiline","true"),this._setWrapMode(this._wrapMode,!0),this._setReadOnly(this._readonly),this._setThemeClass(this._themeClass,!0),this._setTabSize(this._tabSize,!0),this._setMarginOffset(this._marginOffset,!0),this._hookEvents();for(var v=this._rulers,y=0;y<v.length;y++)this._createRuler(v[y]);this._update();var C=this;_(i,n,"textview",e)}},_defaultOptions:function(){return{parent:{value:void 0,update:null},model:{value:void 0,update:this.setModel},scrollAnimation:{value:0,update:null},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},tabMode:{value:!0,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:!1,update:null},singleMode:{value:!1,update:this._setSingleMode},noScroll:{value:!1,update:this._setNoScroll},overwriteMode:{value:!1,update:this._setOverwriteMode},blockCursorVisible:{value:!1,update:this._setBlockCursor},marginOffset:{value:0,update:this._setMarginOffset},wrapOffset:{value:0,update:this._setWrapOffset},wrapMode:{value:!1,update:this._setWrapMode},wrappable:{value:!1,update:null},undoStack:{value:null,update:this._setUndoStack},theme:{value:o.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:void 0,update:this._setThemeClass}}},_destroyRuler:function(e){var t=this._getRulerParent(e);if(t)for(var i=t.firstChild;i;){if(i._ruler===e){i._ruler=void 0,t.removeChild(i),0!==t.children.length||t===this._marginDiv&&this._marginOffset||(t.style.display="none"),t.rulerWidth=void 0;break}i=i.nextSibling}},_destroyView:function(){var e=this._clientDiv;if(e){this._setGrab(null),this._unhookEvents();var t=this._getWindow();this._autoScrollTimerID&&(t.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null),this._updateTimer&&(t.clearTimeout(this._updateTimer),this._updateTimer=null),this._calculateLHTimer&&(t.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=null),this._cursorTimer&&(t.clearInterval(this._cursorTimer),this._cursorTimer=null),this._imeTimeout&&(t.clearInterval(this._imeTimeout),this._imeTimeout=null);var i=this._rootDiv;i.parentNode.removeChild(i),this._domSelection=null,this._clipboardDiv=null,this._rootDiv=null,this._scrollDiv=null,this._viewDiv=null,this._clipDiv=null,this._clipScrollDiv=null,this._clientDiv=null,this._overlayDiv=null,this._leftDiv=null,this._rightDiv=null,this._innerRightDiv=null,this._marginDiv=null,this._cursorDiv=null,this._vScrollDiv=null,this._hScrollDiv=null}},_doAutoScroll:function(e,t,i){this._autoScrollDir=e,this._autoScrollX=t,this._autoScrollY=i,this._autoScrollTimerID||this._autoScrollTimer()},_endAutoScroll:function(){if(this._autoScrollTimerID){var e=this._getWindow();e.clearTimeout(this._autoScrollTimerID)}this._autoScrollDir=void 0,this._autoScrollTimerID=void 0},_fixCaret:function(){var e=this._clientDiv;if(e){var t=this._hasFocus;this._ignoreFocus=!0,t&&e.blur(),e.contentEditable=!1,e.contentEditable=!0,t&&e.focus(),this._ignoreFocus=!1}},_getBaseText:function(e,t){var i=this._model;return i.getBaseModel&&(e=i.mapOffset(e),t=i.mapOffset(t),i=i.getBaseModel()),i.getText(e,t)},_getBottomIndex:function(e){var t=this._bottomChild;if(e&&this._getClientHeight()>this._getLineHeight()){var i=t.getBoundingClientRect(),n=this._clientDiv.getBoundingClientRect();i.bottom>n.bottom&&(t=this._getLinePrevious(t)||t)}return t.lineIndex},_getBlockSelections:function(e,t,i){var n=this._model;e=e.filter(function(e){return!e._editing});var o,r=n.getLineAtOffset(this._blockSelection.getAnchor());t>r?o=t:(o=r,r=t);for(var s=r;o>=s;s++){var a=this._getLine(s),l=a.getOffset(i.x,1),c=a.getOffset(this._blockSelection._docX,1);if(a.destroy(),l!==c||l!==n.getLineEnd(s)){var d=c>l,h=new y(d?l:c,d?c:l,d);h._editing=!0,e.push(h)}}return e},_getBoundsAtOffset:function(e){var t=this._model,i=this._getLine(t.getLineAtOffset(e)),n=i.getBoundingClientRect(e),o=this._getLinePixel(i.lineIndex);return n.top+=o,n.bottom+=o,i.destroy(),n},_getClientHeight:function(){var e=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-e.top-e.bottom)},_getInnerRightWidth:function(){var e=this._innerRightDiv.rulerWidth;if(void 0===e){var t=this._innerRightDiv.getBoundingClientRect();this._innerRightDiv.rulerWidth=e=t.right-t.left}return e},_getClientWidth:function(){var e=this._getViewPadding(),t=this._getInnerRightWidth();return Math.max(0,this._viewDiv.clientWidth-e.left-e.right-t)},_getClipboardText:function(e,t){function i(e){var i=[];return f(e,function(e){i.push(e)},null),t&&t(i),i}var n=this._getWindow(),o=n.clipboardData;if(!o&&e&&(o=e.clipboardData),o)return i(o.getData(s.isIE?"Text":"text/plain"));if(s.isFirefox){this._ignoreFocus=!0;var r=this._clipboardDiv,a=this._rootDiv.ownerDocument;r||(r=s.createElement(a,"div"),this._clipboardDiv=r,r.style.position="fixed",r.style.whiteSpace="pre",r.style.left="-1000px",this._rootDiv.appendChild(r)),r.innerHTML="<pre contenteditable=''></pre>",r.firstChild.focus();var l=this,c=function(){var e=l._getTextFromElement(r);return r.innerHTML="",i(e)},d=!1;if(this._ignorePaste=!0,!s.isLinux||2!==this._lastMouseButton)try{d=a.execCommand("paste",!1,null)}catch(h){d=r.childNodes.length>1||r.firstChild&&r.firstChild.childNodes.length>0}return this._ignorePaste=!1,d?(this.focus(),this._ignoreFocus=!1,c()):e?(n.setTimeout(function(){l.focus(),c(),l._ignoreFocus=!1},0),null):(this.focus(),this._ignoreFocus=!1,"")}return""},_getDOMText:function(e,t){return e._line.getText(t)},_getTextFromElement:function(e){var t=e.ownerDocument,i=t.defaultView;if(!i.getSelection)return e.innerText||e.textContent;var n=t.createRange();n.selectNode(e);var o,r=i.getSelection(),s=[];for(o=0;o<r.rangeCount;o++)s.push(r.getRangeAt(o));this._ignoreSelect=!0,r.removeAllRanges(),r.addRange(n);var a=r.toString();for(r.removeAllRanges(),o=0;o<s.length;o++)r.addRange(s[o]);return this._ignoreSelect=!1,a},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(e){var t=this._getLineNode(e);return!t||t.lineChanged||t.lineRemoved?new b(this,e):t._line},_getLineHeight:function(e,t){if(void 0!==e&&this._lineHeight){var i=this._lineHeight[e];if(i)return i;if(t||void 0===t){var n=this._lineHeight[e]=this._calculateLineHeight(e);return n}}return this._metrics.lineHeight},_getLineNode:function(e){for(var t=this._clientDiv,i=t.firstChild;i;){if(e===i.lineIndex)return i;i=i.nextSibling}return void 0},_getLineNext:function(e){for(var t=e?e.nextSibling:this._clientDiv.firstChild;t&&(-1===t.lineIndex||!t._line);)t=t.nextSibling;return t},_getLinePrevious:function(e){for(var t=e?e.previousSibling:this._clientDiv.lastChild;t&&(-1===t.lineIndex||!t._line);)t=t.previousSibling;return t},_getLinePixel:function(e){if(e=Math.min(Math.max(0,e),this._model.getLineCount()),this._lineHeight){var t,i=this._getTopIndex(),n=-this._topIndexY+this._getScroll().y;if(e>i)for(t=i;e>t;t++)n+=this._getLineHeight(t);else for(t=i-1;t>=e;t--)n-=this._getLineHeight(t);return n}var o=this._getLineHeight();return o*e},_getLineIndex:function(e,t){var i,n=0,o=this._model.getLineCount();if(this._lineHeight){n=this._getTopIndex();var r=-this._topIndexY+this._getScroll().y;if(e!==r)if(r>e)for(;r>e&&n>0;)e+=this._getLineHeight(--n);else for(i=this._getLineHeight(n);e-i>=r&&o-1>n;)e-=i,i=this._getLineHeight(++n)}else i=this._getLineHeight(),n=Math.floor(e/i);return t&&(0===o||0>n||n>o-1)?-1:Math.max(0,Math.min(o-1,n))},_getRulerParent:function(e){switch(e.getLocation()){case"left":return this._leftDiv;case"right":return this._rightDiv;case"innerRight":return this._innerRightDiv;case"margin":return this._marginDiv}return null},_getScroll:function(e){(void 0===e||e)&&this._cancelAnimation();var t=this._viewDiv;return{x:t.scrollLeft,y:t.scrollTop}},_getSelection:function(){return(Array.isArray(this._selection)?this._selection[0]:this._selection).clone()},_getSelections:function(){return(Array.isArray(this._selection)?this._selection:[this._selection]).map(function(e){return e.clone()})},_getTopIndex:function(e){var t=this._topChild;if(e&&this._getClientHeight()>this._getLineHeight()){var i=t.getBoundingClientRect(),n=this._getViewPadding(),o=this._viewDiv.getBoundingClientRect();i.top<o.top+n.top&&(t=this._getLineNext(t)||t)}return t.lineIndex},_hookEvents:function(){var e=this;this._modelListener={onChanging:function(t){e._onModelChanging(t)},onChanged:function(t){e._onModelChanged(t)}},this._model.addEventListener("preChanging",this._modelListener.onChanging),this._model.addEventListener("postChanged",this._modelListener.onChanged),this._themeListener={onChanged:function(){e._setThemeClass(e._themeClass)}},this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);var t=this._handlers=[],i=this._clientDiv,n=this._viewDiv,o=this._rootDiv,r=this._overlayDiv||i,a=i.ownerDocument,l=this._getWindow(),c=s.isIE?a:l;if(t.push({target:l,type:"resize",handler:function(t){return e._handleResize(t?t:l.event)}}),t.push({target:i,type:"blur",handler:function(t){return e._handleBlur(t?t:l.event)}}),t.push({target:i,type:"focus",handler:function(t){return e._handleFocus(t?t:l.event)}}),t.push({target:n,type:"focus",handler:function(){i.focus()}}),t.push({target:n,type:"scroll",handler:function(t){return e._handleScroll(t?t:l.event)}}),t.push({target:i,type:"textInput",handler:function(t){return e._handleTextInput(t?t:l.event)}}),t.push({target:i,type:"keydown",handler:function(t){return e._handleKeyDown(t?t:l.event)}}),t.push({target:i,type:"keypress",handler:function(t){return e._handleKeyPress(t?t:l.event)}}),t.push({target:i,type:"keyup",handler:function(t){return e._handleKeyUp(t?t:l.event)}}),s.isIE&&t.push({target:a,type:"keyup",handler:function(t){return e._handleDocKeyUp(t?t:l.event)}}),t.push({target:i,type:"contextmenu",handler:function(t){return e._handleContextMenu(t?t:l.event)}}),t.push({target:i,type:"copy",handler:function(t){return e._handleCopy(t?t:l.event)}}),t.push({target:i,type:"cut",handler:function(t){return e._handleCut(t?t:l.event)}}),t.push({target:i,type:"paste",handler:function(t){return e._handlePaste(t?t:l.event)}}),t.push({target:a,type:"selectionchange",handler:function(t){return e._handleSelectionChange(t?t:l.event)}}),s.isIOS||s.isAndroid)t.push({target:i,type:"touchstart",handler:function(t){return e._handleTouchStart(t?t:l.event)}}),t.push({target:i,type:"touchmove",handler:function(t){return e._handleTouchMove(t?t:l.event)}}),t.push({target:i,type:"touchend",handler:function(t){return e._handleTouchEnd(t?t:l.event)}});else{if(t.push({target:i,type:"selectstart",handler:function(t){return e._handleSelectStart(t?t:l.event)}}),t.push({target:i,type:"mousedown",handler:function(t){return e._handleMouseDown(t?t:l.event)}}),t.push({target:i,type:"mouseover",handler:function(t){return e._handleMouseOver(t?t:l.event)}}),t.push({target:i,type:"mouseout",handler:function(t){return e._handleMouseOut(t?t:l.event)}}),t.push({target:c,type:"mouseup",handler:function(t){return e._handleMouseUp(t?t:l.event)}}),t.push({target:c,type:"mousemove",handler:function(t){return e._handleMouseMove(t?t:l.event)}}),t.push({target:o,type:"mousedown",handler:function(t){return e._handleRootMouseDown(t?t:l.event)}}),t.push({target:o,type:"mouseup",handler:function(t){return e._handleRootMouseUp(t?t:l.event)}}),t.push({target:r,type:"dragstart",handler:function(t){return e._handleDragStart(t?t:l.event)}}),t.push({target:r,type:"drag",handler:function(t){return e._handleDrag(t?t:l.event)}}),t.push({target:r,type:"dragend",handler:function(t){return e._handleDragEnd(t?t:l.event)}}),t.push({target:r,type:"dragenter",handler:function(t){return e._handleDragEnter(t?t:l.event)}}),t.push({target:r,type:"dragover",handler:function(t){return e._handleDragOver(t?t:l.event)}}),t.push({target:r,type:"dragleave",handler:function(t){return e._handleDragLeave(t?t:l.event)}}),t.push({target:r,type:"drop",handler:function(t){return e._handleDrop(t?t:l.event)}}),t.push({target:this._clientDiv,type:s.isFirefox>26?"wheel":s.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(t){return e._handleMouseWheel(t?t:l.event)}}),this._clipDiv&&t.push({target:this._clipDiv,type:s.isFirefox>26?"wheel":s.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(t){return e._handleMouseWheel(t?t:l.event)}}),s.isFirefox&&(!s.isWindows||s.isFirefox>=15)){var d=l.MutationObserver||l.MozMutationObserver;d?(this._mutationObserver=new d(function(t){e._handleDataModified(t)}),this._mutationObserver.observe(i,{subtree:!0,characterData:!0})):t.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(t){return e._handleDataModified(t?t:l.event)}})}(s.isFirefox&&(!s.isWindows||s.isFirefox>=15)||s.isIE||s.isWebkit)&&(t.push({target:this._clientDiv,type:"compositionstart",handler:function(t){return e._handleCompositionStart(t?t:l.event)}}),t.push({target:this._clientDiv,type:"compositionend",handler:function(t){return e._handleCompositionEnd(t?t:l.event)}}),t.push({target:this._clientDiv,type:"compositionupdate",handler:function(t){return e._handleCompositionUpdate(t?t:l.event)}})),this._overlayDiv&&(t.push({target:this._overlayDiv,type:"mousedown",handler:function(t){return e._handleMouseDown(t?t:l.event)}}),t.push({target:this._overlayDiv,type:"mouseover",handler:function(t){return e._handleMouseOver(t?t:l.event)}}),t.push({target:this._overlayDiv,type:"mouseout",handler:function(t){return e._handleMouseOut(t?t:l.event)}}),t.push({target:this._overlayDiv,type:"contextmenu",handler:function(t){return e._handleContextMenu(t?t:l.event)}})),this._isW3CEvents||t.push({target:this._clientDiv,type:"dblclick",handler:function(t){return e._handleDblclick(t?t:l.event)}})}this._hookRulerEvents(this._leftDiv,t),this._hookRulerEvents(this._rightDiv,t),this._hookRulerEvents(this._innerRightDiv,t),this._hookRulerEvents(this._marginDiv,t);for(var h=0;h<t.length;h++){var u=t[h];x(u.target,u.type,u.handler,u.capture)}},_hookRulerEvents:function(e,t){if(e){var i=this,n=this._getWindow();s.isIE&&t.push({target:e,type:"selectstart",handler:function(){return!1}}),t.push({target:e,type:s.isFirefox>26?"wheel":s.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(e){return i._handleMouseWheel(e?e:n.event)}}),t.push({target:e,type:"click",handler:function(e){i._handleRulerEvent(e?e:n.event)}}),t.push({target:e,type:"dblclick",handler:function(e){i._handleRulerEvent(e?e:n.event)}}),t.push({target:e,type:"mousemove",handler:function(e){i._handleRulerEvent(e?e:n.event)}}),t.push({target:e,type:"mouseover",handler:function(e){i._handleRulerEvent(e?e:n.event)}}),t.push({target:e,type:"mouseout",handler:function(e){i._handleRulerEvent(e?e:n.event)}})}},_getWindow:function(){return l(this._parent.ownerDocument)},_ignoreEvent:function(e){for(var t=e.target;t&&t!==this._clientDiv;){if(t.ignore)return!0;t=t.parentNode}return!1},_init:function(e){var i=e.parent;if("string"==typeof i&&(i=(e.document||document).getElementById(i)),!i)throw new Error("no parent");e.parent=i,e.model=e.model||new t.TextModel;var n=this._defaultOptions();for(var o in n)if(n.hasOwnProperty(o)){var r;r=void 0!==e[o]?e[o]:n[o].value,this["_"+o]=r}this._keyModes=[],this._rulers=[],this._selection=[new y(0,0,!1)],this._linksVisible=!1,this._redrawCount=0,this._maxLineWidth=0,this._maxLineIndex=-1,this._ignoreSelect=!0,this._ignoreFocus=!1,this._hasFocus=!1,this._dragOffset=-1,this._isRangeRects=(!s.isIE||s.isIE>=9)&&"function"==typeof i.ownerDocument.createRange().getBoundingClientRect,this._isW3CEvents=i.addEventListener,this._autoScrollX=null,this._autoScrollY=null,this._autoScrollTimerID=null,this._AUTO_SCROLL_RATE=50,this._grabControl=null,this._moseMoveClosure=null,this._mouseUpClosure=null,this._lastMouseX=0,this._lastMouseY=0,this._lastMouseTime=0,this._clickCount=0,this._clickTime=250,this._clickDist=5,this._isMouseDown=!1,this._doubleClickSelection=null,this._hScroll=0,this._vScroll=0,this._imeOffset=-1,this._createActions(),this._createView()},_checkOverlayScroll:function(){if(s.isMac&&s.isWebkit&&!this._metrics.invalid&&0===this._metrics.scrollWidth){var e=this._viewDiv,t=this._isOverOverlayScroll();e.style.pointerEvents=t.vertical||t.horizontal?"":"none"}},_isOverOverlayScroll:function(){var e=(new Date).getTime()-this._lastScrollTime<200;if(!e)return{};var t=this._viewDiv.getBoundingClientRect(),i=this._lastMouseMoveX,n=this._lastMouseMoveY,o=15;return{vertical:t.top<=n&&n<t.bottom&&t.right-o<=i&&i<t.right,horizontal:t.bottom-o<=n&&n<t.bottom&&t.left<=i&&i<t.right}},_startUndo:function(){if(this._undoStack){var e=this;this._compoundChange=this._undoStack.startCompoundChange({end:function(){e._compoundChange=null}})}},_endUndo:function(){this._undoStack&&this._undoStack.endCompoundChange()},_modifyContent:function(e,t,i,n){if(this._readonly&&!e._code)return!1;e.type="Verify";var o=e.start=e.selection[0].start,r=e.end=e.selection[0].end;if(this.onVerify(e),o!==e.start&&(e.selection[0].start=e.start),r!==e.end&&(e.selection[0].end=e.end),null===e.text||void 0===e.text)return!1;e.selection.length>1&&this.setRedraw(!1);var s=this._compoundChange;s?y.compare(this._getSelections(),s.owner.selection)||(this._endUndo(),e.selection.length>1&&this._startUndo()):e.selection.length>1&&this._startUndo();var a=this._model;try{e._ignoreDOMSelection&&(this._ignoreDOMSelection=!0);var l=0,c=0;e.selection.forEach(function(i){i.start+=l,i.end+=l;var n=Array.isArray(e.text)?e.text[c]:e.text;a.setText(n,i.start,i.end),l+=i.start-i.end+n.length,i.setCaret(t?i.start+n.length:i.start),c++})}finally{e._ignoreDOMSelection&&(this._ignoreDOMSelection=!1)}return this._setSelection(e.selection,i,!0,n),s=this._compoundChange,s&&(s.owner.selection=e.selection),e.selection.length>1&&this.setRedraw(!0),this.onModify({type:"Modify"}),!0},_onModelChanged:function(e){e.type="ModelChanged",this.onModelChanged(e),e.type="Changed";var t=e.start,i=e.addedCharCount,n=e.removedCharCount,o=e.addedLineCount,r=e.removedLineCount,s=this._getSelections();s.forEach(function(e){e.end>t&&(e.end>t&&e.start<t+n?e.setCaret(t+i):(e.start+=i-n,e.end+=i-n))}),this._setSelection(s,!1,!1);for(var a=this._model,l=a.getLineAtOffset(t),d=this._getLineNext();d;){var h=d.lineIndex;h>=l&&l+r>=h&&(l!==h||d.modelChangedEvent||d.lineRemoved?(d.lineRemoved=!0,d.lineChanged=!1,d.modelChangedEvent=null):(d.modelChangedEvent=e,d.lineChanged=!0)),h>l+r&&(d.lineIndex=h+o-r,d._line.lineIndex=d.lineIndex),d=this._getLineNext(d)}if(this._lineHeight){var u=[l,r].concat(c(o));Array.prototype.splice.apply(this._lineHeight,u)}this._wrapMode||l<=this._maxLineIndex&&this._maxLineIndex<=l+r&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0),this._update()},_onModelChanging:function(e){e.type="ModelChanging",this.onModelChanging(e),e.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&!this._ignoreQueueUpdate){var e=this,t=this._getWindow();this._updateTimer=t.setTimeout(function(){e._updateTimer=null,e._update()
},0)}},_rangesToSelections:function(e){var t=[],i=this._model.getCharCount();return e.forEach(function(e){var n;if(e instanceof y)n=e.clone();else{var o=e.start,r=e.end,s=o>r;if(s){var a=o;o=r,r=a}o=Math.max(0,Math.min(o,i)),r=Math.max(0,Math.min(r,i)),n=new y(o,r,s)}t.push(n)}),t},_resetLineHeight:function(e,t){if(this._wrapMode||this._variableLineHeight){if(void 0!==e&&void 0!==t)for(var i=e;t>i;i++)this._lineHeight[i]=void 0;else this._lineHeight=c(this._model.getLineCount());this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var e=this._clientDiv;if(e)for(var t=e.firstChild;t;)t.lineWidth=void 0,t=t.nextSibling},_reset:function(){this._maxLineIndex=-1,this._maxLineWidth=0,this._topChild=null,this._bottomChild=null,this._topIndexY=0,this._variableLineHeight=!1,this._resetLineHeight(),this._setSelection(new y(0,0,!1),!1,!1),this._viewDiv&&(this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0);var e=this._clientDiv;if(e){for(var t=e.firstChild;t;)t.lineRemoved=!0,t=t.nextSibling;s.isFirefox<13&&this._fixCaret()}},_scrollViewAnimated:function(e,t,i){var n=this._getWindow();if(i&&this._scrollAnimation){var o=this;this._animation=new T({window:n,duration:this._scrollAnimation,curve:[t,0],onAnimate:function(e){var i=t-Math.floor(e);o._scrollView(0,i),t-=i},onEnd:function(){o._animation=null,o._scrollView(e,t),i&&n.setTimeout(i,0)}}),this._animation.play()}else this._scrollView(e,t),i&&n.setTimeout(i,0)},_scrollView:function(e,t){this._ensureCaretVisible=!1;var i=this._viewDiv;e&&(i.scrollLeft+=e),t&&(i.scrollTop+=t)},_setClipboardText:function(e,t){var i,n=this._getWindow(),o=n.clipboardData;if(!o&&t&&(o=t.clipboardData),o){i=[],f(e,function(e){i.push(e)},function(){i.push(s.platformDelimiter)});var r=o.setData(s.isIE?"Text":"text/plain",i.join(""));if(r||t&&(s.isFirefox>21||s.isWebkit))return!0;if(!t)return!1}var a=this._parent.ownerDocument,l=s.createElement(a,"pre");l.style.position="fixed",l.style.left="-1000px",f(e,function(e){l.appendChild(a.createTextNode(e))},function(){l.appendChild(s.createElement(a,"br"))}),l.appendChild(a.createTextNode(" ")),this._clientDiv.appendChild(l);var c=a.createRange();c.setStart(l.firstChild,0),c.setEndBefore(l.lastChild);var d=n.getSelection();d.rangeCount>0&&d.removeAllRanges(),d.addRange(c);var h=this,u=function(){l&&l.parentNode===h._clientDiv&&h._clientDiv.removeChild(l),h._updateDOMSelection()},p=!1;this._ignoreCopy=!0;try{p=a.execCommand("copy",!1,null)}catch(g){}return this._ignoreCopy=!1,!p&&t?(n.setTimeout(u,0),!1):(u(),!0)},_setGrab:function(e){e!==this._grabControl&&(e?(e.setCapture&&e.setCapture(),this._grabControl=e):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null))},_setLinksVisible:function(e){if(this._linksVisible!==e){this._linksVisible=e,s.isIE&&e&&(this._hadFocus=this._hasFocus);var t=this._clientDiv;t.contentEditable=!e,this._hadFocus&&!e&&t.focus(),this._overlayDiv&&(this._overlayDiv.style.zIndex=e?"-1":"1");for(var i=this._getLineNext();i;)i._line.updateLinks(),i=this._getLineNext(i);this._updateDOMSelection()}},_setSelection:function(e,t,i,n,o,r,s){if(e){void 0===i&&(i=!0);var a,l=this._getSelections();if(a=Array.isArray(e)?e:r?l.concat([e]):[e],this._selection=y.merge(a),s||a.forEach(function(e){e._columnX=-1}),t!==!1&&this._showCaret(!1,n,t,o),i&&this._updateDOMSelection(),!y.compare(l,a)){var c={type:"Selection",oldValue:y.convert(l),newValue:y.convert(a)};this.onSelection(c)}}},_setSelectionTo:function(e,t,i,n,o,r){var s=this._model,a=this._getSelections(),l=this.convert({x:e,y:t},"page","document"),c=this._getLineIndex(l.y),d=this._getLine(c),h=d.getOffset(l.x,l.y-this._getLinePixel(c));if(r&&!n&&y.contains(a,h))return this._dragOffset=h,d.destroy(),!1;if(this._blockSelection)a=this._getBlockSelections(a,c,l);else{var u;if(i?n?(u=a[a.length-1],u._editing=!0):(u=new y(0,0),u._editing=!0,o?a.push(u):a=[u],u._docX=l.x):u=y.editing(a),1===this._clickCount)u.extend(h),n||u.collapse();else{var p,f,g=0===(1&this._clickCount);if(g)this._doubleClickSelection?h>=this._doubleClickSelection.start?(p=this._doubleClickSelection.start,f=d.getNextOffset(h,{unit:"wordend",count:1})):(p=d.getNextOffset(h,{unit:"word",count:-1}),f=this._doubleClickSelection.end):(p=d.getNextOffset(h,{unit:"word",count:-1}),f=d.getNextOffset(p,{unit:"wordend",count:1}));else if(this._doubleClickSelection){var m=s.getLineAtOffset(this._doubleClickSelection.start);c>=m?(p=s.getLineStart(m),f=s.getLineEnd(c)):(p=s.getLineStart(c),f=s.getLineEnd(m))}else p=s.getLineStart(c),f=s.getLineEnd(c);u.setCaret(p),u.extend(f)}}return this._setSelection(a,!0,!0,null,!1),d.destroy(),!0},_setFullSelection:function(e,t){this._fullSelection=e,s.isWebkit<537.36&&(this._fullSelection=e=!0),this._domSelection||(this._domSelection=[],this._cursorVisible=!0),t||this._updateDOMSelection()},_setBlockCursor:function(e){this._blockCursorVisible=e,this._updateBlockCursorVisible()},_setOverwriteMode:function(e){this._overwriteMode=e,this._updateBlockCursorVisible()},_updateBlockCursorVisible:function(){if(this._blockCursorVisible||this._overwriteMode){if(!this._cursorDiv){var e=this._viewDiv,t=s.createElement(e.ownerDocument,"div");t.className="textviewBlockCursor",this._cursorDiv=t,t.tabIndex=-1,t.style.zIndex="2",t.style.color="transparent",t.style.position="absolute",t.style.pointerEvents="none",t.innerHTML="&nbsp;",e.appendChild(t),this._updateDOMSelection()}}else this._cursorDiv&&(this._cursorDiv.parentNode.removeChild(this._cursorDiv),this._cursorDiv=null)},_setMarginOffset:function(e,t){this._marginOffset=e,this._marginDiv.style.display=e?"block":"none",t||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setWrapOffset:function(e,t){this._wrapOffset=e,t||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setReadOnly:function(e){this._readonly=e,this._clientDiv.setAttribute("aria-readonly",e?"true":"false")},_setSingleMode:function(e,t){this._singleMode=e,this._updateOverflow(),this._updateStyle(t)},_setNoScroll:function(e,t){this._noScroll=e,this._updateOverflow(),this._updateStyle(t)},_setTabSize:function(e,t){this._tabSize=e,this._customTabSize=void 0;var i=this._clientDiv;s.isOpera?i&&(i.style.OTabSize=this._tabSize+""):s.isWebkit>=537.1?i&&(i.style.tabSize=this._tabSize+""):s.isFirefox>=4?i&&(i.style.MozTabSize=this._tabSize+""):8!==this._tabSize&&(this._customTabSize=this._tabSize),t||(this.redrawLines(),this._resetLineWidth())},_setTheme:function(e){this._theme&&this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged),this._theme=e,this._theme&&this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged),this._setThemeClass(this._themeClass)},_setThemeClass:function(e,t){this._themeClass=e;var i="textview",n=this._theme.getThemeClass();n&&(i+=" "+n),this._themeClass&&n!==this._themeClass&&(i+=" "+this._themeClass),this._rootDiv.className=i,this._updateStyle(t)},_setUndoStack:function(e){this._undoStack=e},_setWrapMode:function(e,t){this._wrapMode=e&&this._wrappable;var i=this._clientDiv;this._wrapMode?(i.style.whiteSpace="pre-wrap",i.style.wordWrap="break-word"):(i.style.whiteSpace="pre",i.style.wordWrap="normal"),this._updateOverflow(),t||(this.redraw(),this._resetLineWidth()),this._resetLineHeight()},_showCaret:function(e,t,i,n){if(this._clientDiv&&!(this._redrawCount>0||this._ignoreDOMSelection||-1!==this._imeOffset)){var o=this._model,r=this._getSelections(),s=y.editing(r,"down"===this._autoScrollDir),a=this._getScroll(),l=s.getCaret(),c=s.start,d=s.end,h=o.getLineAtOffset(c),u=o.getLineAtOffset(d),p=Math.max(Math.max(c,o.getLineStart(u)),d-1),f=this._getClientWidth(),g=this._getClientHeight(),m=f/4,v=this._getBoundsAtOffset(l===c?c:p),_=v.left,C=v.right,w=v.top,b=v.bottom,S=0,x="object"==typeof i;!e&&!x||s.isEmpty()||(v=this._getBoundsAtOffset(l===d?c:p),S=(v.bottom>b?v.bottom:b)-(v.top<w?v.top:w),e&&(v.top===w?l===c?C=_+Math.min(v.right-_,f):_=C-Math.min(C-v.left,f):l===c?b=w+Math.min(v.bottom-w,g):w=b-Math.min(b-v.top,g)));var L=0;_<a.x&&(L=Math.min(_-a.x,-m)),C>a.x+f&&(L=Math.max(C-a.x-f,m));var T=0;w<a.y?T=w-a.y:b>a.y+g&&(T=b-a.y-g),n&&(n>0?T>0&&(T=Math.max(T,n)):0>T&&(T=Math.min(T,n)));var E=x&&"always"===i.scrollPolicy;if(0!==L||0!==T||E){if(x){var k=T>0;0===T&&(T=w-a.y);var N=i.viewAnchor,A=i.selectionAnchor,R=Math.min(Math.max(0,i.viewAnchorOffset||0));T+=Math.floor("top"===N?k?(1-R)*g:-R*g:"bottom"===N?k?R*g:-(1-R)*g:"center"===N?k?g/2+R*g:g/2-(1-R)*g:k?R*g:-R*g),h!==u&&("top"===A&&l!==c?T+=Math.floor(-S):"bottom"===A&&l!==d?T+=Math.floor(S):"center"===A&&(T+=Math.floor(S/2)))}else 0!==T&&"number"==typeof i&&(0>i&&(i=0),i>1&&(i=1),T+=Math.floor(T>0?i*g:-i*g));return this._scrollViewAnimated(L,T,t),g!==this._getClientHeight()||f!==this._getClientWidth()?this._showCaret():this._ensureCaretVisible=!0,!0}return t&&t(),!1}},_startIME:function(){if(-1===this._imeOffset){for(var e=!1,t=this._getSelections(),i=0;i<t.length&&!e;i++)e=!t[i].isEmpty();e&&this._modifyContent({text:"",selection:t},!0),this._imeOffset=t[0].start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",this._modelListener.onChanging),this._model.removeEventListener("postChanged",this._modelListener.onChanged),this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged),this._modelListener=null;for(var e=0;e<this._handlers.length;e++){var t=this._handlers[e];L(t.target,t.type,t.handler)}this._handlers=null,this._mutationObserver&&this._mutationObserver.disconnect()},_updateDOMSelection:function(){if(!(this._redrawCount>0)&&!this._ignoreDOMSelection&&-1===this._imeOffset&&this._clientDiv){var e,t=this._getSelections(),i=this._domSelection;if(i.length<t.length)for(e=i.length;e<t.length;e++)i.push(new C(this));else i.length>t.length&&i.splice(t.length).forEach(function(e){e.destroy()});for(e=0;e<i.length;e++)i[e].setPrimary(0===e),i[e].setSelection(t[e]);var n=this._getWindow(),o=this;i.length>1?this._cursorTimer||(this._cursorTimer=n.setInterval(function(){o._cursorVisible=!o._cursorVisible,o._domSelection.forEach(function(e){e.update()})},500)):this._cursorTimer&&(n.clearInterval(this._cursorTimer),this._cursorTimer=null)}},_update:function(e){if(!(this._redrawCount>0)){if(this._updateTimer){var t=this._getWindow();t.clearTimeout(this._updateTimer),this._updateTimer=null,e=!1}var i=this._clientDiv,n=this._viewDiv;if(i){this._metrics.invalid&&(this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1);var o=this._model,r=this._getScroll(!1),a=this._getViewPadding(),l=o.getLineCount(),c=this._getLineHeight(),d=!1,h=!1,u=!1,p=this._metrics.scrollWidth;this._wrapMode&&(i.style.width=(this._metrics.wrapWidth||this._getClientWidth())+"px");var f,g,m,v,_,y,C,w,S,x,L,T=0,E=0;if(this._lineHeight){for(;l>E&&(L=this._getLineHeight(E),!(T+L>r.y));)T+=L,E++;f=E,g=Math.max(0,f-1),v=m=r.y-T,f>0&&(m+=this._getLineHeight(f-1))}else{var k=Math.max(0,r.y)/c;f=Math.floor(k),g=Math.max(0,f-1),m=Math.round((k-g)*c),v=Math.round((k-f)*c),x=l*c}this._topIndexY=v;var N=this._rootDiv,A=N.clientWidth,R=N.clientHeight;if(e){for(_=0,this._leftDiv&&(y=this._leftDiv.getBoundingClientRect(),_=y.right-y.left),C=this._getClientWidth(),w=this._getClientHeight(),S=C,this._wrapMode?this._metrics.wrapWidth&&(S=this._metrics.wrapWidth):S=Math.max(this._maxLineWidth,S);l>E;)L=this._getLineHeight(E,!1),T+=L,E++;x=T}else{w=this._getClientHeight();for(var I,D,P=Math.floor((w+v)/c),M=Math.min(f+P,l-1),O=Math.min(M+1,l-1),B=i.firstChild;B;){I=B.lineIndex;var F=B.nextSibling;I>=g&&O>=I&&!B.lineRemoved&&-1!==B.lineIndex||(this._mouseWheelLine===B?(B.style.display="none",B.lineIndex=-1):i.removeChild(B)),B=F}B=this._getLineNext();var j=n.ownerDocument,V=j.createDocumentFragment();for(I=g;O>=I;I++)!B||B.lineIndex>I?new b(this,I).create(V,null):(V.firstChild&&(i.insertBefore(V,B),V=j.createDocumentFragment()),B&&B.lineChanged&&(B=new b(this,I).create(V,B),B.lineChanged=!1),B=this._getLineNext(B));V.firstChild&&i.insertBefore(V,B),s.isWebkit&&!this._wrapMode&&(i.style.width="0x7fffffffpx");var U;B=this._getLineNext();for(var W=w+m,z=!1;B;){if(D=B.lineWidth,void 0===D){U=B._line.getBoundingClientRect(),D=B.lineWidth=Math.ceil(U.right-U.left);var H=U.bottom-U.top;this._lineHeight?this._lineHeight[B.lineIndex]=H:0!==c&&0!==H&&Math.ceil(c)!==Math.ceil(H)&&(this._variableLineHeight=!0,this._lineHeight=[],this._lineHeight[B.lineIndex]=H)}this._lineHeight&&!z&&(W-=this._lineHeight[B.lineIndex],0>W&&(M=B.lineIndex,z=!0)),this._wrapMode||(D>=this._maxLineWidth&&(this._maxLineWidth=D,this._maxLineIndex=B.lineIndex),this._checkMaxLineIndex===B.lineIndex&&(this._checkMaxLineIndex=-1)),B.lineIndex===f&&(this._topChild=B),B.lineIndex===M&&(this._bottomChild=B),B=this._getLineNext(B)}if(-1!==this._checkMaxLineIndex&&(I=this._checkMaxLineIndex,this._checkMaxLineIndex=-1,I>=0&&l>I)){var G=new b(this,I);U=G.getBoundingClientRect(),D=U.right-U.left,D>=this._maxLineWidth&&(this._maxLineWidth=D,this._maxLineIndex=I),G.destroy()}for(;l>E;)L=this._getLineHeight(E,M>=E),T+=L,E++;x=T,this._updateRuler(this._leftDiv,f,O,R),this._updateRuler(this._rightDiv,f,O,R),this._updateRuler(this._innerRightDiv,f,O,R),this._updateRuler(this._marginDiv,f,O,R),_=0,this._leftDiv&&(y=this._leftDiv.getBoundingClientRect(),_=y.right-y.left);var $=0;if(this._rightDiv){var K=this._rightDiv.getBoundingClientRect();$=K.right-K.left}n.style.left=_+"px",n.style.right=$+"px";var Y=this._scrollDiv;if(Y.style.height=x+(s.isWebkit?0:a.bottom)+"px",C=this._getClientWidth(),!this._singleMode&&!this._wrapMode&&!this._noScroll){var q=w,J=w,X="scroll"===n.style.overflowX;X?q+=p:J-=p;var Z=C,Q=C,et="scroll"===n.style.overflowY;et?Z+=p:Q-=p,w=q,C=Z,x>w&&(u=!0,C=Q),this._maxLineWidth>C&&(h=!0,w=J,x>w&&(u=!0,C=Q)),X!==h&&(n.style.overflowX=h?"scroll":"hidden"),et!==u&&(n.style.overflowY=u?"scroll":"hidden"),d=X!==h||et!==u}var tt=C;this._wrapMode?this._metrics.wrapWidth&&(tt=this._metrics.wrapWidth):tt=Math.max(this._maxLineWidth+this._getInnerRightWidth(),tt),S=tt,(!s.isIE||s.isIE>=9)&&this._maxLineWidth>C&&(tt+=a.right+a.left),Y.style.width=tt+"px",this._clipScrollDiv&&(this._clipScrollDiv.style.width=tt+"px"),r=this._getScroll(!1);var it=this._innerRightDiv;it&&(it.style.right=$+("scroll"===n.style.overflowY?this._metrics.scrollWidth:0)+"px",it.style.bottom=("scroll"===n.style.overflowX?p:0)+"px")}if(this._scrollHeight=x,this._vScrollDiv){var nt=w-8,ot=Math.max(15,Math.ceil(Math.min(1,nt/(x+a.top+a.bottom))*nt));this._vScrollDiv.style.left=_+C-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,r.y*nt/x))+"px",this._vScrollDiv.style.height=ot+"px"}if(!this._wrapMode&&this._hScrollDiv){var rt=C-8,st=Math.max(15,Math.ceil(Math.min(1,rt/(this._maxLineWidth+a.left+a.right))*rt));this._hScrollDiv.style.left=_+Math.floor(Math.max(0,Math.floor(r.x*rt/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=w-9+"px",this._hScrollDiv.style.width=st+"px"}var at,lt,ct=r.x,dt=this._clipDiv,ht=this._overlayDiv,ut=this._marginDiv;if(ut&&(ut.style.left=-ct+_+this._metrics.marginWidth+a.left+"px",ut.style.bottom=("scroll"===n.style.overflowX?p:0)+"px"),dt){dt.scrollLeft=ct,dt.scrollTop=0,at=_+a.left,lt=a.top;var pt=C,ft=w,gt=0,mt=-m;0===r.x&&(at-=a.left,pt+=a.left,gt=a.left),r.x+C===S&&(pt+=a.right),0===r.y&&(lt-=a.top,ft+=a.top,mt+=a.top),r.y+w===x&&(ft+=a.bottom),dt.style.left=at+"px",dt.style.top=lt+"px",dt.style.right=A-pt-at+"px",dt.style.bottom=R-ft-lt+"px",i.style.left=gt+"px",i.style.top=mt+"px",i.style.width=S+"px",i.style.height=w+m+"px",ht&&(ht.style.left=i.style.left,ht.style.top=i.style.top,ht.style.width=i.style.width,ht.style.height=i.style.height)}else{at=ct,lt=m;var vt=ct+C,_t=m+w;0===at&&(at-=a.left),0===lt&&(lt-=a.top),vt===S&&(vt+=a.right),r.y+w===x&&(_t+=a.bottom),i.style.clip="rect("+lt+"px,"+vt+"px,"+_t+"px,"+at+"px)","rtl"==document.dir?i.style.right=-ct+_+a.left+"px":i.style.left=-ct+_+a.left+"px",i.style.width=(this._wrapMode||s.isWebkit?S:C+ct)+"px",e||(i.style.top=-m+a.top+"px",i.style.height=w+m+"px"),ht&&(ht.style.clip=i.style.clip,ht.style.left=i.style.left,ht.style.width=i.style.width,e||(ht.style.top=i.style.top,ht.style.height=i.style.height))}if(this._updateDOMSelection(),d){var yt=this._ensureCaretVisible;this._ensureCaretVisible=!1,yt&&this._showCaret(),this._queueUpdate()}}}},_updateOverflow:function(){var e=this._viewDiv;this._noScroll?e.style.overflow="hidden":this._wrapMode?(e.style.overflowX="hidden",e.style.overflowY="scroll"):e.style.overflow="hidden"},_updateRuler:function(e,t,i,n){if(e)for(var o=this._parent.ownerDocument,r=this._getLineHeight(),a=this._getViewPadding(),l=e.firstChild;l;){var c=l._ruler,h=c.getOverview();if(l.rulerChanged&&(d(c.getRulerStyle(),l),e.rulerWidth=void 0),"fixed"!==h){var u=r;"page"===h&&(u+=this._topIndexY),l.style.top=-u+"px",l.style.height=n+u+"px";var p,f=l.firstChild;f?(p=f,f=f.nextSibling):(p=s.createElement(o,"div"),p.style.visibility="hidden",l.appendChild(p));var g,m;l.rulerChanged&&p&&(g=-1,m=c.getWidestAnnotation(),m&&(d(m.style,p),m.html&&(p.innerHTML=m.html)),p.lineIndex=g,p.style.height=r+a.top+"px");var v,_,y;if("page"===h){for(y=c.getAnnotations(t,i+1);f;){g=f.lineIndex;var C=f.nextSibling;g>=t&&i>=g&&!f.lineChanged||l.removeChild(f),f=C}for(f=l.firstChild.nextSibling,_=o.createDocumentFragment(),g=t;i>=g;g++)!f||f.lineIndex>g?(v=s.createElement(o,"div"),m=y[g],m&&(d(m.style,v),m.html&&(v.innerHTML=m.html),v.annotation=m),v.lineIndex=g,v.style.height=this._getLineHeight(g)+"px",_.appendChild(v)):(_.firstChild&&(l.insertBefore(_,f),_=o.createDocumentFragment()),f&&(f=f.nextSibling));_.firstChild&&l.insertBefore(_,f)}else{var w,b,S=this._getClientHeight(),x=this._model.getLineCount(),L=r*x,T=S+a.top+a.bottom-2*this._metrics.scrollWidth;if(T>L?(w=r,b=a.top):(w=T/x,b=this._metrics.scrollWidth),l.rulerChanged){for(var E=l.childNodes.length;E>1;)l.removeChild(l.lastChild),E--;y=c.getAnnotations(0,x),_=o.createDocumentFragment();for(var k in y)g=k>>>0,0>g||(v=s.createElement(o,"div"),m=y[k],d(m.style,v),v.style.position="absolute",v.style.top=b+r+Math.floor(g*w)+"px",m.html&&(v.innerHTML=m.html),v.annotation=m,v.lineIndex=g,_.appendChild(v));l.appendChild(_)}else if(l._oldTrackHeight!==T)for(v=l.firstChild?l.firstChild.nextSibling:null;v;)v.style.top=this._metrics.scrollWidth+r+Math.floor(v.lineIndex*w)+"px",v=v.nextSibling;l._oldTrackHeight=T}l.rulerChanged=!1,l=l.nextSibling}else l.rulerChanged=!1,l=l.nextSibling}},_updateStyleSheet:function(){var e="";if(s.isWebkit&&this._metrics.scrollWidth>0&&(e+="\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}"),e){var t=this._clientDiv.ownerDocument,i=t.getElementById("_textviewStyle");if(i)i.removeChild(i.firstChild),i.appendChild(t.createTextNode(e));else{i=s.createElement(t,"style"),i.id="_textviewStyle";var n=t.getElementsByTagName("head")[0]||t.documentElement;i.appendChild(t.createTextNode(e)),n.insertBefore(i,n.firstChild)}}},_updateStyle:function(e,t){if(!e&&s.isIE&&(this._rootDiv.style.lineHeight="normal"),t=this._metrics=t||this._calculateMetrics(),this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight()),this._rootDiv.style.lineHeight=s.isIE?t.lineHeight-(t.lineTrim.top+t.lineTrim.bottom)+"px":"normal",this._updateStyleSheet(),s.isMac&&s.isWebkit){var i=this._viewDiv;t.invalid||0!==t.scrollWidth?(i.style.pointerEvents="",i.style.zIndex=""):(i.style.pointerEvents="none",i.style.zIndex="2")}e||(this.redraw(),this._resetLineWidth())}},n.EventTarget.addMixin(S.prototype),{TextView:S}}),define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(e,t){function i(e){this._model=e,this._projections=[];var t=this;this._listener={onChanged:function(e){t._onChanged(e)},onChanging:function(e){t._onChanging(e)}},e.addEventListener("postChanged",this._listener.onChanged),e.addEventListener("preChanging",this._listener.onChanging)}return i.prototype={destroy:function(){this._model&&(this._model.removeEventListener("postChanged",this._listener.onChanged),this._model.removeEventListener("preChanging",this._listener.onChanging),this._model=null)},addProjection:function(t){if(t){var i=this._model,n=this._projections;t._lineIndex=i.getLineAtOffset(t.start),t._lineCount=i.getLineAtOffset(t.end)-t._lineIndex;var o=t.text;o||(o=""),t._model="string"==typeof o?new e.TextModel(o,i.getLineDelimiter()):o;var r=this.mapOffset(t.start,!0),s=t.end-t.start,a=t._lineCount,l=t._model.getCharCount(),c=t._model.getLineCount()-1,d={type:"Changing",text:t._model.getText(),start:r,removedCharCount:s,addedCharCount:l,removedLineCount:a,addedLineCount:c};this.onChanging(d);var h=this._binarySearch(n,t.start);n.splice(h,0,t);var u={type:"Changed",start:r,removedCharCount:s,addedCharCount:l,removedLineCount:a,addedLineCount:c};this.onChanged(u)}},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(e,t){var i,n,o=this._projections,r=0;if(t){for(i=0;i<o.length&&(n=o[i],!(n.start>e));i++){if(n.end>e)return-1;r+=n._model.getCharCount()-(n.end-n.start)}return e+r}for(i=0;i<o.length&&(n=o[i],!(n.start>e-r));i++){var s=n._model.getCharCount();if(n.start+s>e-r)return-1;r+=s-(n.end-n.start)}return e-r},removeProjection:function(e){this._removeProjection(e)},_removeProjection:function(e,t){var i,n=0;for(i=0;i<this._projections.length;i++){var o=this._projections[i];if(o===e){e=o;break}n+=o._model.getCharCount()-(o.end-o.start)}if(i<this._projections.length){var r=this._model,s=e.start+n,a=e.end-e.start,l=e._lineCount,c=e._model.getCharCount(),d=e._model.getLineCount()-1;if(!t){var h={type:"Changing",text:r.getText(e.start,e.end),start:s,removedCharCount:c,addedCharCount:a,removedLineCount:d,addedLineCount:l};this.onChanging(h)}if(this._projections.splice(i,1),!t){var u={type:"Changed",start:s,removedCharCount:c,addedCharCount:a,removedLineCount:d,addedLineCount:l};this.onChanged(u)}}},_binarySearch:function(e,t){for(var i,n=e.length,o=-1;n-o>1;)i=Math.floor((n+o)/2),t<=e[i].start?n=i:o=i;return n},getCharCount:function(){for(var e=this._model.getCharCount(),t=this._projections,i=0;i<t.length;i++){var n=t[i];e+=n._model.getCharCount()-(n.end-n.start)}return e},getLine:function(e,t){if(0>e)return null;var i,n,o,r=this._model,s=this._projections,a=0,l=[],c=0;for(i=0;i<s.length&&(o=s[i],!(o._lineIndex>=e-a));i++){if(n=o._model.getLineCount()-1,o._lineIndex+n>=e-a){var d=e-(o._lineIndex+a);if(n>d)return o._model.getLine(d,t);l.push(o._model.getLine(n))}c=o.end,a+=n-o._lineCount}for(c=Math.max(c,r.getLineStart(e-a));i<s.length&&(o=s[i],!(o._lineIndex>e-a));i++){if(l.push(r.getText(c,o.start)),n=o._model.getLineCount()-1,o._lineIndex+n>e-a)return l.push(o._model.getLine(0,t)),l.join("");l.push(o._model.getText()),c=o.end,a+=n-o._lineCount}var h=r.getLineEnd(e-a,t);return h>c&&l.push(r.getText(c,h)),l.join("")},getLineAtOffset:function(e){for(var t=this._model,i=this._projections,n=0,o=0,r=0;r<i.length;r++){var s=i[r];if(s.start>e-n)break;var a=s._model.getCharCount();if(s.start+a>e-n){var l=e-(s.start+n);o+=s._model.getLineAtOffset(l),n+=l;break}o+=s._model.getLineCount()-1-s._lineCount,n+=a-(s.end-s.start)}return t.getLineAtOffset(e-n)+o},getLineCount:function(){for(var e=this._model,t=this._projections,i=e.getLineCount(),n=0;n<t.length;n++){var o=t[n];i+=o._model.getLineCount()-1-o._lineCount}return i},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(e,t){if(0>e)return-1;for(var i=this._model,n=this._projections,o=0,r=0,s=0;s<n.length;s++){var a=n[s];if(a._lineIndex>e-o)break;var l=a._model.getLineCount()-1;if(a._lineIndex+l>e-o){var c=e-(a._lineIndex+o);return a._model.getLineEnd(c,t)+a.start+r}r+=a._model.getCharCount()-(a.end-a.start),o+=l-a._lineCount}return i.getLineEnd(e-o,t)+r},getLineStart:function(e){if(0>e)return-1;for(var t=this._model,i=this._projections,n=0,o=0,r=0;r<i.length;r++){var s=i[r];if(s._lineIndex>=e-n)break;var a=s._model.getLineCount()-1;if(s._lineIndex+a>=e-n){var l=e-(s._lineIndex+n);return s._model.getLineStart(l)+s.start+o}o+=s._model.getCharCount()-(s.end-s.start),n+=a-s._lineCount}return t.getLineStart(e-n)+o},getText:function(e,t){void 0===e&&(e=0);var i,n,o,r=this._model,s=this._projections,a=0,l=[];for(i=0;i<s.length&&(n=s[i],!(n.start>e-a));i++){if(o=n._model.getCharCount(),n.start+o>e-a){if(void 0!==t&&n.start+o>t-a)return n._model.getText(e-(n.start+a),t-(n.start+a));l.push(n._model.getText(e-(n.start+a))),e=n.end+a+o-(n.end-n.start)}a+=o-(n.end-n.start)}var c=e-a;if(void 0!==t){for(;i<s.length&&(n=s[i],!(n.start>t-a));i++){if(l.push(r.getText(c,n.start)),o=n._model.getCharCount(),n.start+o>t-a)return l.push(n._model.getText(0,t-(n.start+a))),l.join("");l.push(n._model.getText()),c=n.end,a+=o-(n.end-n.start)}l.push(r.getText(c,t-a))}else{for(;i<s.length;i++)n=s[i],l.push(r.getText(c,n.start)),l.push(n._model.getText()),c=n.end;l.push(r.getText(c))}return l.join("")},_onChanged:function(){var e,t,i=this._change,n=i.baseStart,o=i.baseEnd,r=this._projections;for(e=0;e<r.length&&(t=r[e],!(t.end>n));e++);var s=e;for(e=0;e<r.length&&(t=r[e],!(t.start>=o));e++);var a=e,l=this._model,c=i.baseText.length-(o-n);for(e=a;e<r.length;e++)t=r[e],t.start+=c,t.end+=c,t._lineIndex=l.getLineAtOffset(t.start);var d=r.splice(s,a-s);for(e=0;e<d.length;e++)d[e].annotation&&d[e].annotation._expand();var h={type:"Changed",start:i.start,removedCharCount:i.removedCharCount,addedCharCount:i.addedCharCount,removedLineCount:i.removedLineCount,addedLineCount:i.addedLineCount};this.onChanged(h),this._change=void 0},_onChanging:function(e){function t(e){for(a=0,s=0;a<c.length&&(l=c[a],!(l.start>e));a++){if(l.end>e)return-1;s+=l._model.getCharCount()-(l.end-l.start)}return e+s}var i=!!this._change,n=this._change||{},o=e.start,r=o+e.removedCharCount;if(n.baseStart=o,n.baseEnd=r,n.baseText=e.text,n.addedLineCount=e.addedLineCount,!i){this._change=n,n.text=e.text;var s,a,l,c=this._projections;n.start=t(o),-1===n.start&&(n.text=this._model.getText(l.start,o)+n.text,n.addedLineCount+=this._model.getLineAtOffset(o)-this._model.getLineAtOffset(l.start),n.start=l.start+s),n.end=t(r),-1===n.end&&(n.text+=this._model.getText(r,l.end),n.addedLineCount+=this._model.getLineAtOffset(l.end)-this._model.getLineAtOffset(r),n.end=l.start+s)}n.addedCharCount=n.text.length,n.removedCharCount=n.end-n.start,n.removedLineCount=this.getLineAtOffset(n.end)-this.getLineAtOffset(n.start);var d={type:"Changing",text:n.text,start:n.start,removedCharCount:n.removedCharCount,addedCharCount:n.addedCharCount,removedLineCount:n.removedLineCount,addedLineCount:n.addedLineCount};this.onChanging(d)},onChanging:function(e){return this.dispatchEvent(e)},onChanged:function(e){return this.dispatchEvent(e)},setLineDelimiter:function(e){this._model.setLineDelimiter(e)},setText:function(e,t,i){function n(e){for(r=0,o=0;r<c.length&&(s=c[r],!(s.start>e-o));r++){var t=s._model.getCharCount();if(s.start+t>e-o)return-1;o+=t-(s.end-s.start)}return e-o}this._change={text:e||"",start:t||0,end:void 0===i?this.getCharCount():i};var o,r,s,a,l,c=this._projections,d=n(this._change.start);-1===d&&(a={projection:s,start:this._change.start-(s.start+o)},d=s.end);var h=n(this._change.end);-1===h&&(l={projection:s,end:this._change.end-(s.start+o)},h=s.start),a&&l&&a.projection===l.projection?s._model.setText(this._change.text,a.start,l.end):(this._model.setText(this._change.text,d,h),a&&(s=a.projection,s._model.setText("",a.start)),l&&(s=l.projection,s._model.setText("",0,l.end),s.start=s.end,s._lineCount=0)),this._change=void 0}},t.EventTarget.addMixin(i.prototype),{ProjectionTextModel:i}}),define("orion/editor/tooltip",["i18n!orion/editor/nls/messages","orion/editor/textView","orion/editor/projectionTextModel","orion/Deferred","orion/editor/util","orion/webui/littlelib","orion/util"],function(e,t,i,n,o,r,s){function a(e){this._view=e;var t=e.getOptions("parent");this._create(t?t.ownerDocument:document)}return a.getTooltip=function(e){return e._tooltip||(e._tooltip=new a(e)),e._tooltip},a.prototype={_create:function(e){if(!this._tooltipDiv){var t=this._tooltipDiv=s.createElement(e,"div");t.tabIndex=0,t.className="textviewTooltip",t.setAttribute("aria-live","assertive"),t.setAttribute("aria-atomic","true"),this._tooltipDiv.style.visibility="hidden",this._tipShowing=!1,e.body.appendChild(t);var i=this;o.addEventListener(e,"mousedown",this._mouseDownHandler=function(e){i.isVisible()&&(o.contains(t,e.target||e.srcElement)||i._locked||i.hide())},!0),o.addEventListener(e,"scroll",this._scrollHandler=function(e){i.isVisible()&&(o.contains(t,e.target||e.srcElement)||(i._topPixel!==i._view.getTopPixel()||i._leftPixel!==i._view.getHorizontalPixel())&&i.hide())},!0),o.addEventListener(e,"mousemove",this._mouseMoveHandler=function(e){i._prevX&&i._prevX===e.clientX&&i._prevY&&i._prevY===e.clientY||(i._prevX=e.clientX,i._prevY=e.clientY,!i.isVisible()||i._locked||i._hasFocus()||i._isInRect(i._outerArea,e.clientX,e.clientY)||i.hide())},!0),o.addEventListener(t,"focus",function(){i._locked||i._tooltipDiv.classList.add("textViewTooltipOnFocus")},!1),o.addEventListener(t,"blur",function(){i._tooltipDiv.classList.remove("textViewTooltipOnFocus")},!1),o.addEventListener(t,"mouseenter",function(){i._locked||i._tooltipDiv.classList.add("textViewTooltipOnHover")},!1),o.addEventListener(t,"mouseleave",function(){i._hasFocus()||i._tooltipDiv.classList.remove("textViewTooltipOnHover")},!1),o.addEventListener(t,"keydown",function(e){27===e.keyCode&&(i._locked||i.hide())},!1),this._view.addEventListener("Destroy",function(){i.destroy()})}},destroy:function(){if(this._tooltipDiv){this.hide();var e=this._tooltipDiv.parentNode;e&&e.removeChild(this._tooltipDiv);var t=this._tooltipDiv.ownerDocument;o.removeEventListener(t,"mousedown",this._mouseDownHandler,!0),o.removeEventListener(t,"scroll",this._scrollHandler,!0),o.removeEventListener(t,"mousemove",this._mouseMoveHandler,!0),this._tooltipDiv=null}},show:function(e,t,i){this._locked=t,this._giveFocus=i,this._topPixel=this._view.getTopPixel(),this._leftPixel=this._view.getHorizontalPixel(),this._processInfo(e.getTooltipInfo())},update:function(e,t){e&&(t?this._showContents(null,e.getTooltipInfo(),!0):this._processInfo(e.getTooltipInfo(),!0))},onHover:function(e,t,i){e&&(this._isInRect(this._anchorArea,t,i)||this._isInRect(this._tooltipArea,t,i)||this._locked||this._hasFocus()||this._processInfo(e.getTooltipInfo()))},hide:function(e){e&&(this._locked=void 0),!this._locked&&this.isVisible()&&(this.hover&&this.hover.clearQuickFixes(),this._hasFocus()&&this._view.focus(),this._tooltipContents&&(this._tooltipDiv.removeChild(this._tooltipContents),this._tooltipContents=null),this._tooltipDiv.classList.remove("textviewTooltipCodeProjection"),this._tooltipDiv.classList.remove("textviewTooltipOnHover"),this._tooltipDiv.classList.remove("textviewTooltipOnFocus"),this._tooltipDiv.style.visibility="hidden",this._tipShowing=!1,this._tooltipDiv.style.left="",this._tooltipDiv.style.right="",this._tooltipDiv.style.top="",this._tooltipDiv.style.bottom="",this._tooltipDiv.style.width="auto",this._tooltipDiv.style.maxWidth="",this._tooltipDiv.style.height="auto",this._tooltipDiv.style.maxHeight="",this._tooltipDiv.style.overflowX="",this._tooltipDiv.style.overflowY="",this._giveFocus=void 0,this._anchorArea=void 0,this._tooltipArea=void 0,this._outerArea=void 0,this._hoverPromises&&this._hoverPromises.forEach(function(e){e.resolved||e.cancel()}),this._hoverPromises=void 0,this._tipRect=void 0)},isVisible:function(){return this._tipShowing},_processInfo:function(e,t){if(this._tooltipDiv){var i;if(t&&this._tooltipContents?(this._tooltipContents.innerHTML="",i=this._tooltipContents):i=s.createElement(this._tooltipDiv.ownerDocument,"div"),e){if(e.contents&&this._renderImmediateInfo(i,e.contents,e.context))return this._showContents(i,e,t),!0;if(this.hover&&e.context&&(this._hoverPromises=this.hover.computeHoverInfo(e.context),this._hoverPromises)){var o=this,r=this._hoverPromises.slice(0);return r.forEach(function(r){n.when(r,function(n){if(o._hoverPromises){var s=o._hoverPromises.indexOf(r);
s>=0&&o._hoverPromises.splice(s,1)}n&&o._renderPluginContent(i,n)&&(n.offsetStart&&(e.context.offsetStart=n.offsetStart),n.offsetEnd&&(e.context.offsetEnd=n.offsetEnd),n.allowFullWidth&&(e.allowFullWidth=n.allowFullWidth),o._showContents(i,e,t))},function(e){console&&e&&"Cancel"!==e.name&&(console.log("Error computing hover tooltip"),console.log(e&&e.stack))})}),!0}}}},_showContents:function(e,t,i){i?this._tooltipArea&&t.tooltipArea&&(this._tooltipArea.left!==t.tooltipArea.left||this._tooltipArea.top!==t.tooltipArea.top||this._tooltipArea.width!==t.tooltipArea.width||this._tooltipArea.height!==t.tooltipArea.height)&&(this._anchorArea=null,this._tooltipArea=null,this._outerArea=null):this.hide(),e&&(this._tooltipContents&&this._tooltipDiv.removeChild(this._tooltipContents),this._tooltipContents=e,this._tooltipDiv.appendChild(e)),this._anchorArea||(this._anchorArea=this._computeAnchorArea(t)),this._tooltipArea||(this._tooltipArea=this._computeTooltipArea(t,this._anchorArea,this._tooltipDiv)),this._outerArea||(this._outerArea=this._computeOuterArea(this._anchorArea,this._tooltipArea)),this._tooltipDiv.style.visibility="visible",this._tipShowing=!0,this._giveFocus&&(this._setInitialFocus(this._tooltipDiv),this._giveFocus=void 0)},_computeAnchorArea:function(e){if(e.anchorArea&&e.anchorArea.top&&e.anchorArea.left&&e.anchorArea.height&&e.anchorArea.width)return e.anchorArea;if(e.context){if(e.context.offsetStart&&e.context.offsetEnd){var t=this.mapOffset(e.context.offsetStart,!1),i=this.mapOffset(e.context.offsetEnd,!1);return this._computeRectangleFromOffset(t,i)}if(e.context.offset>=0){var n=this.mapOffset(e.context.offset,!1),o=this._view.getNextOffset(n,{unit:"wordend",count:0}),r=this._view.getNextOffset(o,{unit:"word",count:-1});return this._computeRectangleFromOffset(r,o)}}return{top:0,left:0,height:0,width:0}},_computeTooltipArea:function(e,t,i){var n=i.ownerDocument.documentElement,o=16;if(e.tooltipArea&&e.tooltipArea.top&&e.tooltipArea.left&&e.tooltipArea.height&&e.tooltipArea.width)return i.style.overflowY="auto",i.style.resize="none",i.style.top=e.tooltipArea.top+"px",i.style.left=e.tooltipArea.left+"px",i.style.height=e.tooltipArea.height-o+"px",i.style.width=e.tooltipArea.width-o+"px",e.tooltipArea;var r=i.getBoundingClientRect(),s={width:r.width,height:r.height},a=i.getElementsByTagName("img")[0];a&&!a.complete&&0===a.width&&(s.width+=30);var l=e.position?e.position:"below",c=(this._view._rootDiv?this._view._rootDiv:n).getBoundingClientRect(),d=c.left,h=c.top,u=c.width,p=c.height,f=u,g=p;e.allowFullWidth?s.width>u&&(s.width=u):(f=Math.min(u/2,600),g=Math.min(p/2,400),s.width=Math.min(s.width,f),s.height=Math.min(s.height,g)),i.style.width=s.width-o+"px",s.height=Math.min(i.getBoundingClientRect().height,g),25+o>s.height&&s.width>f-o&&(s.height=40+o);var m=p-(t.top+t.height-h),v=t.top-h,_=u-(t.left+t.width-d);"above"===l&&s.height>v&&s.height<=m?l="below":"below"===l&&s.height>m&&s.height<=v&&(l="above");var y=e.tooltipOffsetX?e.tooltipOffsetX:0,C=e.tooltipOffsetY?e.tooltipOffsetY:0;switch(l){case"left":s.top=s.height+C>m+t.height?p+h-s.height:t.top+C,s.top=Math.max(s.top,h),s.left=Math.max(t.left-s.width+y,d);break;case"right":s.top=s.height+C>m+t.height?p+h-s.height:t.top+C,s.top=Math.max(s.top,h),s.left=Math.max(t.left+t.width+y,d);break;case"above":s.left=s.width+y>_+t.width?u+d-s.width:t.left+y,s.left=Math.max(s.left,d),s.top=Math.max(t.top-s.height+C,h);break;case"below":s.left=s.width+y>_+t.width?u+d-s.width:t.left+y,s.left=Math.max(s.left,d),s.top=Math.max(t.top+t.height+C,h)}return s.maxWidth=Math.min(u+d-s.left,u),s.maxHeight=Math.min(p+h-s.top,p),i.style.maxWidth=s.maxWidth-o+"px",i.style.maxHeight=s.maxHeight-o+"px",i.style.width=s.width-o+"px",i.style.height=s.height-o+"px",i.style.left=s.left+"px",i.style.top=s.top+"px",s},_computeOuterArea:function(e,t){var i=Math.min(e.left,t.left),n=Math.min(e.top,t.top),o=e.left+e.width,r=t.left+t.width,s=Math.max(o,r),a=e.top+e.height,l=t.top+t.height,c=Math.max(a,l);return{left:i,top:n,width:s-i,height:c-n}},_hasFocus:function(){var e=this._tooltipDiv;return e?o.contains(e,e.ownerDocument.activeElement):!1},_isNode:function(e){return"object"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName},_setInitialFocus:function(e){var t=r.$("button",e);if(t)return void t.focus();var i=r.$("a",e);if(i){i.focus();var n=this;return void i.addEventListener("click",function(){n.hide()})}var o=r.firstTabbable(e);o&&o.focus()},_isInRect:function(e,t,i){if(!e)return!1;var n=t>=e.left&&t<=e.left+e.width,o=i>=e.top&&i<=e.top+e.height;return n&&o},mapOffset:function(e){var t=this._view,i=t.getModel();return i.getBaseModel&&(e=i.mapOffset(e,!0)),e},_computeRectangleFromOffset:function(e,t){var i=this._view,n=i.getLineAtOffset(e),o=i.getLineAtOffset(t);n!==o&&(t=i.getModel().getLineEnd(n));var r=i.getLineHeight(n),s=i.getLocationAtOffset(e),a=i.getLocationAtOffset(t),l={x:s.x,y:s.y,width:a.x-s.x,height:r};return l=this._view.convert(l,"document","page"),{left:l.x,top:l.y,width:l.width,height:l.height}},_renderPluginContent:function(e,t){var i=this._tooltipDiv.ownerDocument;if("string"!=typeof t&&"undefined"==typeof t.content)return!1;var n=s.createElement(i,"div");if(t.title){var o=s.createElement(i,"div");this.hover.renderMarkDown?o.innerHTML=this.hover.renderMarkDown(t.title):o.textContent=t.title,o.classList.add("hoverTooltipTitle"),n.appendChild(o)}var r=s.createElement(i,"div");if("string"==typeof t)r.appendChild(i.createTextNode(t));else switch(t.type){case"delegatedUI":case"html":if(t.content){var a=i.createElement("iframe");a.id="HtmlHover",a.name="HTML Hover",a.type="text/html",a.sandbox="allow-scripts allow-same-origin allow-forms",a.style.border="none",a.style.width="100%",a.style.height="100%",this._tooltipDiv.style.paddingBottom="5px",a.srcdoc=t.content,t.width&&(a.style.width=t.width),t.height&&(a.style.height=t.height),n.style.height="100%",e.style.height="100%",n.appendChild(a)}break;case"markdown":this.hover.renderMarkDown&&(r.innerHTML=this.hover.renderMarkDown(t.content));break;default:r.appendChild(i.createTextNode(t.content))}return n.appendChild(r),e.appendChild(n),!0},_renderImmediateInfo:function(e,n,o){if(n instanceof Array&&(n=this._getAnnotationContents(n,o),!n))return!1;if("string"==typeof n)return e.textContent=n,!0;if(this._isNode(n))return e.appendChild(n),!0;if(n instanceof i.ProjectionTextModel){var r=this._view,s=r.getOptions();s.wrapMode=!1,s.parent=e;var a="tooltipTheme",l=s.themeClass;l?(l=l.replace(a,""),l&&(l=" "+l),l=a+l):l=a,s.themeClass=l;var c=this._contentsView=new t.TextView(s),d={onLineStyle:function(e){r.onLineStyle(e)}};c.addEventListener("LineStyle",d.onLineStyle),c.setModel(n),this._tooltipDiv.appendChild(e),this._tooltipDiv.classList.add("textviewTooltipCodeProjection");var h=c.computeSize();return e.style.width=h.width+8+"px",e.style.height=h.height+8+"px",c.resize(),this._tooltipDiv.removeChild(e),!0}return!1},_getAnnotationContents:function(t,n){function r(e,t){var i=e.title,r=s.createElement(p,"div");if(r.className="tooltipRow",e.html){var l=s.createElement(p,"div");l.className="tooltipImage",l.innerHTML=e.html,l.lastChild&&o.addEventListener(l.lastChild,"click",function(){var t=e.start,i=e.end;g.getBaseModel&&(t=g.mapOffset(t,!0),i=g.mapOffset(i,!0)),f.setSelection(t,i,1/3,function(){a.hide()})},!1),r.appendChild(l)}if(!i){var c=m.getLineStart(m.getLineAtOffset(e.start)),d=m.getLineEnd(m.getLineAtOffset(e.end),!0);i=m.getText(c,d)}if("function"==typeof i&&(i=e.title()),"string"==typeof i){var h=s.createElement(p,"span");h.className="tooltipTitle",h.appendChild(p.createTextNode(i)),i=h}return r.appendChild(i),t&&a.hover.renderQuickFixes(e,r),n&&(n.offsetStart=e.start,n.offsetEnd=e.end),r}var a=this,l=a.hover?!0:!1;l&&n&&n.source&&n.source.indexOf("ruler")>=0&&t.length>1&&(l=!1);for(var c,d=[],h=0;h<t.length;h++)c=t[h],""===c.title||c.groupAnnotation||(!l||c.title||"orion.annotation.folding"===c.type)&&d.push(c);if(t=d,0===t.length)return null;var u,p=this._tooltipDiv.ownerDocument,f=this._view,g=f.getModel(),m=g.getBaseModel?g.getBaseModel():g;if(1===t.length&&"orion.annotation.folding"===t[0].type){var v=new i.ProjectionTextModel(m),_=m.getLineStart(m.getLineAtOffset(t[0].start)),y=m.getCharCount();return t[0].end!==y&&v.addProjection({start:t[0].end,end:y}),_>0&&v.addProjection({start:0,end:_}),v}if(1===t.length){if(u=r(t[0],l),u&&u.firstChild){var C=u.firstChild.className;C&&(C+=" "),C+="single",u.firstChild.className=C}return u}var w=s.createElement(p,"div"),b=s.createElement(p,"multi_anno");b.appendChild(p.createTextNode(e.multipleAnnotations)),w.appendChild(b);for(var S=0;S<t.length;S++)u=r(t[S],l),u&&w.appendChild(u);return w}},{Tooltip:a}}),define("orion/editor/editor",["i18n!orion/editor/nls/messages","orion/editor/eventTarget","orion/editor/tooltip","orion/editor/annotations","orion/objects","orion/util"],function(e,t,i,n,o,r){function s(e){e=e||{},this._domNode=e.domNode,this._model=e.model,this._undoStack=e.undoStack,this._statusReporter=e.statusReporter,this._title=null;var t=this;this._listener={onChanged:function(e){t.onChanged(e)}},this._model&&this._model.addEventListener("Changed",this._listener.onChanged),this.checkDirty()}function a(e){e=e||{},s.call(this,e),this._textViewFactory=e.textViewFactory,this._undoStackFactory=e.undoStackFactory,this._textDNDFactory=e.textDNDFactory,this._annotationFactory=e.annotationFactory,this._zoomRulerFactory=e.zoomRulerFactory,this._foldingRulerFactory=e.foldingRulerFactory,this._lineNumberRulerFactory=e.lineNumberRulerFactory,this._contentAssistFactory=e.contentAssistFactory,this._keyBindingFactory=e.keyBindingFactory,this._hoverFactory=e.hoverFactory,this._annotationStyler=null,this._annotationModel=null,this._annotationRuler=null,this._lineNumberRuler=null,this._overviewRuler=null,this._zoomRuler=null,this._foldingRuler=null,this._contentAssist=null}var l=n.AnnotationType,c="orion.annotation.highlightError";return s.prototype={destroy:function(){this.uninstall(),this._statusReporter=this._domNode=null,this._model&&this._model.removeEventListener("Changed",this._listener.onChanged)},checkDirty:function(){this.setDirty(this._undoStack&&!this._undoStack.isClean())},focus:function(){},getModel:function(){return this._model},getText:function(e,t){return this.getModel().getText(e,t)},getTitle:function(){return this._title},getUndoStack:function(){return this._undoStack},install:function(){this.installed=!0},isDirty:function(){return this._undoStack?!this._undoStack.isClean():this._dirty},markClean:function(){this.getUndoStack().markClean(),this.setDirty(!1)},onDirtyChanged:function(e){return this.dispatchEvent(e)},onInputChanged:function(e){return this.dispatchEvent(e)},onChanged:function(){this.checkDirty()},reportStatus:function(e,t,i){this._statusReporter&&this._statusReporter(e,t,i)},resize:function(){},setDirty:function(e){this._dirty!==e&&(this._dirty=e,this.onDirtyChanged({type:"DirtyChanged"}))},_setModelText:function(e){this._model&&this._model.setText(e)},setInput:function(e,t,i,n){this._title=e,n||(t?this.reportStatus(t,"error"):null!==i&&void 0!==i&&("string"==typeof i&&this._setModelText(i),this._undoStack&&this._undoStack.reset())),this.checkDirty(),this.onInputChanged({type:"InputChanged",title:e,message:t,contents:i,contentsSaved:n})},setText:function(e,t,i){this.getModel().setText(e,t,i)},uninstall:function(){this.installed=!1}},t.EventTarget.addMixin(s.prototype),a.prototype=new s,o.mixin(a.prototype,{destroy:function(){s.prototype.destroy.call(this),this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=this._hoverFactory=this._zoomRulerFactory=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},getAnnotationStyler:function(){return this._annotationStyler},getContentAssist:function(){return this._contentAssist},getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getTooltip:function(){return i.Tooltip.getTooltip(this._textView)},getZoomRuler:function(){return this._zoomRuler},getModel:function(){if(!this._textView)return null;var e=this._textView.getModel();return e.getBaseModel&&(e=e.getBaseModel()),e},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getKeyModes:function(){return this._textView.getKeyModes()},getSourceCodeActions:function(){return this._sourceCodeActions},getLinkedMode:function(){return this._linkedMode},getTextActions:function(){return this._textActions},focus:function(){this._textView&&this._textView.focus()},resize:function(){this._textView&&this._textView.resize()},setAnnotationRulerVisible:function(e,t){if((this._annotationRulerVisible!==e||t)&&(this._annotationRulerVisible=e,this._annotationRuler)){var i=this._textView;e?i.addRuler(this._annotationRuler,0):i.removeRuler(this._annotationRuler)}},setFoldingRulerVisible:function(e,t){if((this._foldingRulerVisible!==e||t)&&(this._foldingRulerVisible=e,this._foldingRuler)){var i=this._textView;i.getModel().getBaseModel&&(e?i.addRuler(this._foldingRuler):i.removeRuler(this._foldingRuler))}},setLineNumberRulerVisible:function(e,t){if((this._lineNumberRulerVisible!==e||t)&&(this._lineNumberRulerVisible=e,this._lineNumberRuler)){var i=this._textView;e?i.addRuler(this._lineNumberRuler,this._annotationRulerVisible?1:0):i.removeRuler(this._lineNumberRuler)}},setOverviewRulerVisible:function(e,t){if((this._overviewRulerVisible!==e||t)&&(this._overviewRulerVisible=e,this._overviewRuler)){var i=this._textView;e?i.addRuler(this._overviewRuler):i.removeRuler(this._overviewRuler)}},setZoomRulerVisible:function(e,t){if((this._zoomRulerVisible!==e||t)&&(this._zoomRulerVisible=e,this._zoomRuler)){var i=this._textView;e?i.addRuler(this._zoomRuler):i.removeRuler(this._zoomRuler)}},mapOffset:function(e,t){var i=this._textView,n=i.getModel();return n.getBaseModel&&(e=n.mapOffset(e,t)),e},getLineAtOffset:function(e){return this.getModel().getLineAtOffset(this.mapOffset(e))},getLineStart:function(e){return this.getModel().getLineStart(e)},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},getSelectionText:function(e){var t=this._textView;return t.getSelectionText(e)},getSelection:function(){var e=this._textView,t=e.getSelection(),i=e.getModel();return i.getBaseModel&&(t.start=i.mapOffset(t.start),t.end=i.mapOffset(t.end)),t},getSelections:function(){var e=this._textView,t=e.getModel(),i=e.getSelections();return i.forEach(function(e){t.getBaseModel&&(e.start=t.mapOffset(e.start),e.end=t.mapOffset(e.end))}),i},_expandOffset:function(e){var t=this._textView.getModel(),i=this._annotationModel;if(i&&t.getBaseModel)for(var n=i.getAnnotations(e,e+1);n.hasNext();){var o=n.next();o.type===l.ANNOTATION_FOLDING&&o.expand&&o.expand()}},setCaretOffset:function(e,t,i){var n=this._textView,o=n.getModel();o.getBaseModel&&(this._expandOffset(e),e=o.mapOffset(e,!0)),n.setCaretOffset(e,t,i)},setText:function(e,t,i,n,o){var r=this._textView,s=r.getModel();s.getBaseModel&&(void 0!==t&&(this._expandOffset(t),t=s.mapOffset(t,!0)),void 0!==i&&(this._expandOffset(i),i=s.mapOffset(i,!0))),r.setText(e,t,i,n,o)},setSelection:function(e,t,i,n){var o=this._textView,r=o.getModel();r.getBaseModel&&(this._expandOffset(e),this._expandOffset(t),e=r.mapOffset(e,!0),t=r.mapOffset(t,!0)),o.setSelection(e,t,i,n)},setSelections:function(e,t,i){var n=this,o=this._textView,r=o.getModel();e.forEach(function(e){var t=e.start,i=e.end;r.getBaseModel&&(n._expandOffset(t),n._expandOffset(i),t=r.mapOffset(t,!0),i=r.mapOffset(i,!0)),e.start=t,e.end=i}),o.setSelections(e,t,i)},moveSelection:function(e,t,i,n){t=t||e;var o=this._textView;this.setSelection(e,t,1/3,function(){(void 0===n||n)&&o.focus(),i&&i()})},_getTooltipInfo:function(e,t){var i=this._textView,n=this.getAnnotationModel();if(!n)return null;var o=this._annotationStyler;if(!o)return null;if(!i.isValidTextPosition(e,t))return null;var r=i.getOffsetAtLocation(e,t);if(-1===r)return null;r=this.mapOffset(r);for(var s=o.getAnnotationsByType(n,r,r+1),a=[],l=0;l<s.length;l++)s[l].rangeStyle&&a.push(s[l]);var c={contents:a,position:"below",context:{source:"editor",offset:r}};return c},_highlightCurrentLine:function(e,t){function i(e){var t={};return e&&e.some(function(e){return e&&e.isEmpty()?(t[s.getLineAtOffset(e.start).toString()]=!0,!1):!0})?{}:t}function n(e,t){for(var i in e)if(!t[i])return!0;return!1}var o=this._annotationModel;if(o){var r=this._textView;if(!r.getOptions("singleMode")){t=Array.isArray(t)?t:[t],e=Array.isArray(e)?e:[e];var s=r.getModel(),a=i(t),c=i(e);if(n(a,c)||n(c,a)){var d=this._currentLineAnnotations,h=[];for(var u in c){var p=u>>0,f=s.getLineStart(p),g=s.getLineEnd(p);s.getBaseModel&&(f=s.mapOffset(f),g=s.mapOffset(g));var m=l.ANNOTATION_CURRENT_LINE,v=l.createAnnotation(m,f,g);h.push(v)}this._currentLineAnnotations=h,o.replaceAnnotations(d,h)}}}},installTextView:function(){this.install()},install:function(){if(!this._textView){if(this._textView=this._textViewFactory(),this._undoStackFactory&&(this._undoStack=this._undoStackFactory.createUndoStack(this),this._textView.setOptions({undoStack:this._undoStack}),this.checkDirty()),this._textDNDFactory&&(this._textDND=this._textDNDFactory.createTextDND(this,this._undoStack)),this._contentAssistFactory){var e=this._contentAssistFactory.createContentAssistMode(this);this._contentAssist=e.getContentAssist()}var t=i.Tooltip.getTooltip(this._textView);this._hoverFactory&&(this._hover=this._hoverFactory.createHover(this),t.hover=this._hover);var n=this,o=this._textView,r=this;if(this._listener={onModelChanged:function(){r.checkDirty()},onMouseOver:function(e){r._listener.onMouseMove(e)},onMouseDown:function(){r._listener.mouseDown=!0},onMouseUp:function(){r._listener.mouseDown=!1},onMouseMove:function(e){t&&!r._listener.mouseDown&&(e.event.clientX!==r._listener.lastMouseX||e.event.clientY!==r._listener.lastMouseY)&&(r._listener.lastMouseX=e.event.clientX,r._listener.lastMouseY=e.event.clientY,r._hoverTimeout&&(window.clearTimeout(r._hoverTimeout),r._hoverTimeout=null),r._hoverTimeout=window.setTimeout(function(){r._hoverTimeout=null,r._listener&&t.onHover({y:e.y,x:e.x,getTooltipInfo:function(){return r._getTooltipInfo(this.x,this.y)}},e.x,e.y)},175))},onMouseOut:function(){r._hoverTimeout&&(window.clearTimeout(r._hoverTimeout),r._hoverTimeout=null)},onSelection:function(e){t&&t.hide(),r._updateCursorStatus(),r._highlightCurrentLine(e.newValue,e.oldValue)}},o.addEventListener("ModelChanged",this._listener.onModelChanged),o.addEventListener("Selection",this._listener.onSelection),o.addEventListener("MouseOver",this._listener.onMouseOver),o.addEventListener("MouseOut",this._listener.onMouseOut),o.addEventListener("MouseDown",this._listener.onMouseDown),o.addEventListener("MouseUp",this._listener.onMouseUp),o.addEventListener("MouseMove",this._listener.onMouseMove),this._keyBindingFactory){var a;a="function"==typeof this._keyBindingFactory?this._keyBindingFactory(this,this.getKeyModes(),this._undoStack,this._contentAssist):this._keyBindingFactory.createKeyBindings(n,this._undoStack,this._contentAssist),a&&(this._textActions=a.textActions,this._linkedMode=a.linkedMode,this._sourceCodeActions=a.sourceCodeActions)}var d=function(e){if(void 0!==e&&-1!==e){for(var t=this.getView(),i=t.getModel(),o=this.getAnnotationModel(),r=n.mapOffset(i.getLineStart(e)),s=n.mapOffset(i.getLineEnd(e)),a=o.getAnnotations(r,s),c=null;a.hasNext();){var d=a.next();if(d.type===l.ANNOTATION_BOOKMARK){c=d;break}}c?o.removeAnnotation(c):(c=l.createAnnotation(l.ANNOTATION_BOOKMARK,r,s,n.getText(r,s)),o.addAnnotation(c))}};if(this._annotationFactory){var h=o.getModel();if(h.getBaseModel&&(h=h.getBaseModel()),this._annotationModel=this._annotationFactory.createAnnotationModel(h),this._annotationModel){var u=this._annotationStyler=this._annotationFactory.createAnnotationStyler(o,this._annotationModel);u&&(u.addAnnotationType(l.ANNOTATION_CURRENT_SEARCH),u.addAnnotationType(l.ANNOTATION_MATCHING_SEARCH),u.addAnnotationType(l.ANNOTATION_ERROR),u.addAnnotationType(l.ANNOTATION_WARNING),u.addAnnotationType(l.ANNOTATION_MATCHING_BRACKET),u.addAnnotationType(l.ANNOTATION_CURRENT_BRACKET),u.addAnnotationType(l.ANNOTATION_CURRENT_LINE),u.addAnnotationType(l.ANNOTATION_READ_OCCURRENCE),u.addAnnotationType(l.ANNOTATION_WRITE_OCCURRENCE),u.addAnnotationType(l.ANNOTATION_SELECTED_LINKED_GROUP),u.addAnnotationType(l.ANNOTATION_CURRENT_LINKED_GROUP),u.addAnnotationType(l.ANNOTATION_LINKED_GROUP),u.addAnnotationType(c))}var p=this._annotationFactory.createAnnotationRulers(this._annotationModel),f=this._annotationRuler=p.annotationRuler;f&&(f.onDblClick=d,f.setMultiAnnotationOverlay({html:"<div class='annotationHTML overlay'></div>"}),f.addAnnotationType(l.ANNOTATION_ERROR),f.addAnnotationType(l.ANNOTATION_WARNING),f.addAnnotationType(l.ANNOTATION_TASK),f.addAnnotationType(l.ANNOTATION_BOOKMARK),f.addAnnotationType(l.ANNOTATION_DIFF_ADDED),f.addAnnotationType(l.ANNOTATION_DIFF_DELETED),f.addAnnotationType(l.ANNOTATION_DIFF_MODIFIED)),this.setAnnotationRulerVisible(this._annotationRulerVisible||void 0===this._annotationRulerVisible,!0),f=this._overviewRuler=p.overviewRuler,f&&(f.addAnnotationType(l.ANNOTATION_CURRENT_SEARCH),f.addAnnotationType(l.ANNOTATION_MATCHING_SEARCH),f.addAnnotationType(l.ANNOTATION_READ_OCCURRENCE),f.addAnnotationType(l.ANNOTATION_WRITE_OCCURRENCE),f.addAnnotationType(l.ANNOTATION_CURRENT_BLAME),f.addAnnotationType(l.ANNOTATION_ERROR),f.addAnnotationType(l.ANNOTATION_WARNING),f.addAnnotationType(l.ANNOTATION_TASK),f.addAnnotationType(l.ANNOTATION_BOOKMARK),f.addAnnotationType(l.ANNOTATION_MATCHING_BRACKET),f.addAnnotationType(l.ANNOTATION_CURRENT_BRACKET),f.addAnnotationType(l.ANNOTATION_CURRENT_LINE),f.addAnnotationType(l.ANNOTATION_DIFF_ADDED),f.addAnnotationType(l.ANNOTATION_DIFF_DELETED),f.addAnnotationType(l.ANNOTATION_DIFF_MODIFIED)),this.setOverviewRulerVisible(this._overviewRulerVisible||void 0===this._overviewRulerVisible,!0)}this._zoomRulerFactory&&(this._zoomRuler=this._zoomRulerFactory.createZoomRuler(this._annotationModel),this.setZoomRulerVisible(this._zoomRulerVisible,!0)),this._lineNumberRulerFactory&&(this._lineNumberRuler=this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.addAnnotationType(l.ANNOTATION_CURRENT_BLAME),this._lineNumberRuler.addAnnotationType(l.ANNOTATION_BLAME),this._lineNumberRuler.addAnnotationType(l.ANNOTATION_DIFF_ADDED),this._lineNumberRuler.addAnnotationType(l.ANNOTATION_DIFF_MODIFIED),this._lineNumberRuler.addAnnotationType(l.ANNOTATION_DIFF_DELETED),this._lineNumberRuler.onDblClick=d,this.setLineNumberRulerVisible(this._lineNumberRulerVisible||void 0===this._lineNumberRulerVisible,!0)),this._foldingRulerFactory&&(this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),this._foldingRuler.addAnnotationType(l.ANNOTATION_FOLDING),this.setFoldingRulerVisible(this._foldingRulerVisible||void 0===this._foldingRulerVisible,!0));var g={type:"TextViewInstalled",textView:o};this.dispatchEvent(g),s.prototype.install.call(this)}},uninstallTextView:function(){this.uninstall()},uninstall:function(){var e=this._textView;if(e){e.destroy(),this._annotationModel&&this._annotationModel.setTextModel(null),this._textView=this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=this._annotationStyler=this._annotationRuler=this._overviewRuler=this._zoomRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotations=this._title=null,this._dirty=!1,this._foldingRulerVisible=this._overviewRulerVisible=this._zoomRulerVisible=this._lineNumberRulerVisible=this._annotationRulerVisible=void 0;var t={type:"TextViewUninstalled",textView:e};this.dispatchEvent(t),s.prototype.uninstall.call(this)}},_updateCursorStatus:function(){for(var t=this.getKeyModes(),i=0;i<t.length;i++){var n=t[i];if(n.isActive()&&n.isStatusActive&&n.isStatusActive())return}var o,s=this.getModel(),a=this.getSelections();if(a.length>1)o=r.formatMessage(e.multiSelections,a.length);else{var l=a[0].getCaret(),c=s.getLineAtOffset(l),d=s.getLineStart(c),h=l-d;o=localStorage.languageTools?r.formatMessage(e.lineColumnOffset,c+1,h+1,l):r.formatMessage(e.lineColumn,c+1,h+1)}this.reportStatus(o)},showAnnotations:function(e,t,i,n){var o=this._annotationModel;if(o){for(var r,s=[],a=[],c=o.getTextModel(),d=o.getAnnotations();d.hasNext();)r=d.next(),-1!==t.indexOf(r.type)&&r.creatorID===this&&s.push(r);if(e)for(var h=0;h<e.length;h++)if(r=e[h]){if(i)r=i(r);else{var u,p;if(r.lineStart&&r.lineEnd)u=c.getLineStart(r.lineStart),p=c.getLineCount()===r.lineEnd?c.getLineEnd(r.lineEnd-1):c.getLineStart(r.lineEnd);else if("number"==typeof r.line){var f=r.line-1,g=c.getLineStart(f);u=g+r.start-1,p=g+r.end-1}else u=r.start,p=r.end;var m=n(r);if(!m)continue;r=l.createAnnotation(m,u,p,r.description)}r.id=e[h].id,e[h].data&&(r.data=e[h].data),r.creatorID=this,a.push(r)}o.replaceAnnotations(s,a)}},showProblems:function(e){this.showAnnotations(e,[l.ANNOTATION_ERROR,l.ANNOTATION_WARNING,l.ANNOTATION_TASK],null,function(e){switch(e.severity){case"error":return l.ANNOTATION_ERROR;case"warning":return l.ANNOTATION_WARNING;case"task":return l.ANNOTATION_TASK}return null})},showOccurrences:function(e){this.showAnnotations(e,[l.ANNOTATION_READ_OCCURRENCE,l.ANNOTATION_WRITE_OCCURRENCE],null,function(e){return e.readAccess?l.ANNOTATION_READ_OCCURRENCE:l.ANNOTATION_WRITE_OCCURRENCE})},showBlame:function(t){var i=this._blameRGB,s=this.getTextView().getOptions("parent").ownerDocument;if(!i){var a=r.createElement(s,"div");a.className="annotation blame",s.body.appendChild(a);var c=s.defaultView||s.parentWindow,d=c.getComputedStyle(a),h=d.getPropertyValue("background-color");a.parentNode.removeChild(a);var u=h.indexOf("("),p=h.indexOf(")");h=h.substring(u+1,p),this._blameRGB=i=h.split(",").slice(0,3)}var f=function(){var e=n.AnnotationType.createAnnotation(this.groupType,this.start,this.end,this.title);return e.style=o.mixin({},e.style),e.style.style=o.mixin({},e.style.style),e.style.style.backgroundColor="",this.groupAnnotation=e,e.blame=this.blame,e.html=this.html,e.creatorID=this.creatorID,e},g=function(){var t=r.createElement(s,"div");t.className="tooltipTitle";var i=this.blame.Message.indexOf("\n");-1===i&&(i=this.blame.Message.length);var n=r.createElement(s,"a");return n.href=this.blame.CommitLink,n.appendChild(s.createTextNode(this.blame.Message.substring(0,i))),t.appendChild(n),t.appendChild(r.createElement(s,"br")),t.appendChild(s.createTextNode(r.formatMessage(e.committerOnTime,this.blame.AuthorName,this.blame.Time))),t},m=this.getModel();this.showAnnotations(t,[l.ANNOTATION_BLAME,l.ANNOTATION_CURRENT_BLAME],function(e){var t=m.getLineStart(e.Start-1),r=m.getLineEnd(e.End-1,!0),s=n.AnnotationType.createAnnotation(l.ANNOTATION_BLAME,t,r,g),a=i.slice(0);return a.push(e.Shade),s.style=o.mixin({},s.style),s.style.style=o.mixin({},s.style.style),s.style.style.backgroundColor="rgba("+a.join()+")",s.groupId=e.Name,s.groupType=l.ANNOTATION_CURRENT_BLAME,s.createGroupAnnotation=f,s.html='<img class="annotationHTML blame" src="'+e.AuthorImage+'"/>',s.blame=e,s})},showDiffAnnotations:function(e){this.showAnnotations(e,[l.ANNOTATION_DIFF_ADDED,l.ANNOTATION_DIFF_MODIFIED,l.ANNOTATION_DIFF_DELETED],null,function(e){return"added"===e.type?l.ANNOTATION_DIFF_ADDED:"modified"===e.type?l.ANNOTATION_DIFF_MODIFIED:l.ANNOTATION_DIFF_DELETED})},showSelection:function(e,t,i,n,o){if("number"==typeof e)return"number"!=typeof t&&(t=e),this.moveSelection(e,t),!0;if("number"==typeof i){var r=this.getModel(),s=r.getLineStart(i-1);return"number"==typeof n&&(s+=n),"number"!=typeof o&&(o=0),this.moveSelection(s,s+o),!0}return!1},_setModelText:function(e){this._textView&&(this._textView.setText(e),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelections()))},setInput:function(e,t,i,n,o){s.prototype.setInput.call(this,e,t,i,n),!this._textView||n||o||this._textView.focus()},onGotoLine:function(e,t,i,n){if(this._textView){var o=this.getModel();e=Math.max(0,Math.min(e,o.getLineCount()-1));var r=o.getLineStart(e),s=0;if(void 0===i&&(i=0),"string"==typeof t){var a=o.getLine(e).indexOf(t);-1!==a&&(s=a,i=s+t.length)}else{s=t;var l=o.getLineEnd(e)-r;s=Math.min(s,l),i=Math.min(i,l)}this.moveSelection(r+s,r+i,n)}}}),{BaseEditor:s,Editor:a}}),define("orion/editor/find",["i18n!orion/editor/nls/messages","orion/keyBinding","orion/editor/keyModes","orion/editor/annotations","orion/regex","orion/objects","orion/util"],function(e,t,i,n,o,r,s){function a(e){var t=e.getTextView();i.KeyMode.call(this,t),this.editor=e,this._active=!1,this._success=!0,this._ignoreSelection=!1,this._prefix="",t.setAction("incrementalFindCancel",function(){return this.setActive(!1),!0}.bind(this)),t.setAction("incrementalFindBackspace",function(){return this._backspace()}.bind(this));var n=this;this._listener={onVerify:function(e){var t=n.editor,i=t.getModel(),r=t.mapOffset(e.start),s=t.mapOffset(e.end),a=i.getText(r,s),l=n._prefix,c=l.match(new RegExp("^"+o.escape(a),"i"));c&&c.length>0&&(l=n._prefix+=e.text,n._success=!0,n._status(),n.find(n._forward,!0),e.text=null)},onSelection:function(){n._ignoreSelection||n.setActive(!1)}}}function l(e,t,i){if(e){this._editor=e,this._undoStack=t,this._showAll=!0,this._visible=!1,this._caseInsensitive=!0,this._wrap=!0,this._wholeWord=!1,this._incremental=!0,this._regex=!1,this._findAfterReplace=!0,this._hideAfterFind=!1,this._reverse=!1,this._start=void 0,this._end=void 0,this._timer=void 0,this._lastString="";var n=this;this._listeners={onEditorFocus:function(e){n._removeCurrentAnnotation(e)}},this.setOptions(i)}}var c={};return a.prototype=new i.KeyMode,r.mixin(a.prototype,{createKeyBindings:function(){var e=t.KeyBinding,i=[];return i.push({actionID:"incrementalFindBackspace",keyBinding:new e(8)}),i.push({actionID:"incrementalFindCancel",keyBinding:new e(13)}),i.push({actionID:"incrementalFindCancel",keyBinding:new e(27)}),i.push({actionID:"incrementalFindReverse",keyBinding:new e(38)}),i.push({actionID:"incrementalFind",keyBinding:new e(40)}),i.push({actionID:"incrementalFindReverse",keyBinding:new e("k",!0,!0)}),i.push({actionID:"incrementalFind",keyBinding:new e("k",!0)}),i},find:function(e,t){if(this._forward=e,!this.isActive())return this.setActive(!0),!1;var i=this._prefix;if(0===i.length)return!1;var n,o=this.editor,r=o.getModel();n=e?this._success?t?this._start:o.getCaretOffset()+1:0:this._success?t?this._start:o.getCaretOffset():r.getCharCount()-1;var s=o.getModel().find({string:i,start:n,reverse:!e,caseInsensitive:i.toLowerCase()===i}).next();return s?(t||(this._start=n),this._success=!0,this._ignoreSelection=!0,o.moveSelection(e?s.start:s.end,e?s.end:s.start),this._ignoreSelection=!1):this._success=!1,this._status(),!0},isActive:function(){return this._active},isStatusActive:function(){return this.isActive()},setActive:function(e){if(this._active!==e){this._active=e,this._prefix="",this._success=!0;var t=this.editor,i=t.getTextView();this._start=this.editor.getCaretOffset(),this.editor.setCaretOffset(this._start),this._active?(i.addEventListener("Verify",this._listener.onVerify),i.addEventListener("Selection",this._listener.onSelection),i.addKeyMode(this)):(i.removeEventListener("Verify",this._listener.onVerify),i.removeEventListener("Selection",this._listener.onSelection),i.removeKeyMode(this)),this._status()}},_backspace:function(){var e=this._prefix;return e=this._prefix=e.substring(0,e.length-1),0===e.length?(this._success=!0,this._ignoreSelection=!0,this.editor.setCaretOffset(this.editor.getSelection().start),this._ignoreSelection=!1,this._status(),!0):this.find(this._forward,!0)},_status:function(){if(!this.isActive())return void this.editor.reportStatus("");
var t;t=this._forward?this._success?e.incrementalFindStr:e.incrementalFindStrNotFound:this._success?e.incrementalFindReverseStr:e.incrementalFindReverseStrNotFound,t=s.formatMessage(t,this._prefix),this.editor.reportStatus(t,this._success?"":"error")}}),c.IncrementalFind=a,l.prototype={find:function(e,t,i){this.setOptions({reverse:!e});var n,o=this.getFindString();t&&(o=t.findString||o,n=t.count);var r=this.getOptions();this.setOptions(t);var s=i?this._startOffset:this.getStartOffset(),a=this._doFind(o,s,n);return a&&(i||(this._startOffset=a.start)),this.setOptions(r),this._hideAfterFind&&this.hide(),a},getStartOffset:function(){return void 0!==this._start?this._start:this._reverse?this._editor.getSelection().start-1:this._editor.getCaretOffset()},getFindString:function(){var e=this._editor.getSelection(),t=this._editor.getText(e.start,e.end);return this._regex&&(t=o.escape(t)),t||this._lastString},getOptions:function(){return{showAll:this._showAll,caseInsensitive:this._caseInsensitive,wrap:this._wrap,wholeWord:this._wholeWord,incremental:this._incremental,regex:this._regex,findAfterReplace:this._findAfterReplace,hideAfterFind:this._hideAfterFind,reverse:this._reverse,findCallback:this._findCallback,start:this._start,end:this._end}},getReplaceString:function(){return""},hide:function(){this._visible=!1,this._savedOptions&&(this.setOptions(this._savedOptions.pop()),0===this._savedOptions.length&&(this._savedOptions=null)),this._removeAllAnnotations();var e=this._editor.getTextView();e&&(e.removeEventListener("Focus",this._listeners.onEditorFocus),e.focus())},_processReplaceString:function(e){var t=e;if(this._regex){t="";for(var i=!1,n=this._editor.getModel().getLineDelimiter(),o=0;o<e.length;o++){var r=e.substring(o,o+1);if(i){switch(r){case"R":t+=n;break;case"r":t+="\r";break;case"n":t+="\n";break;case"t":t+="	";break;case"\\":t+="\\";break;default:t+="\\"+r}i=!1}else"\\"===r?i=!0:t+=r}i&&(t+="\\")}return t},isVisible:function(){return this._visible},replace:function(){var e=this.getFindString();if(e){var t=this._editor,i=this._processReplaceString(this.getReplaceString()),n=t.getSelection(),o=n.start,r=t.getModel().find({string:e,start:o,reverse:!1,wrap:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive}).next();r&&(this.startUndo(),this._doReplace(r.start,r.end,e,i),this.endUndo())}this._findAfterReplace&&e&&this._doFind(e,this.getStartOffset())},replaceAll:function(){var t=this.getFindString();if(t){this._replacingAll=!0;var i=this._editor,n=i.getTextView();i.reportStatus(e.replacingAll);var o=this._processReplaceString(this.getReplaceString()),r=this;window.setTimeout(function(){for(var a=0,l=0;;){var c=r._doFind(t,a,null,!0);if(!c)break;l++,1===l&&(n.setRedraw(!1),r.startUndo()),r._doReplace(c.start,c.end,t,o),a=r.getStartOffset()}l>0&&(r.endUndo(),n.setRedraw(!0)),a>0?i.reportStatus(s.formatMessage(e.replacedMatches,l)):i.reportStatus(e.nothingReplaced,"error"),r._replacingAll=!1},100)}},setOptions:function(e){if(e){if((e.showAll===!0||e.showAll===!1)&&this._showAll!==e.showAll&&(this._showAll=e.showAll,this.isVisible()))if(this._showAll)this._markAllOccurrences();else{var t=this._editor.getAnnotationModel();t&&t.removeAnnotations(n.AnnotationType.ANNOTATION_MATCHING_SEARCH)}(e.caseInsensitive===!0||e.caseInsensitive===!1)&&(this._caseInsensitive=e.caseInsensitive),(e.wrap===!0||e.wrap===!1)&&(this._wrap=e.wrap),(e.wholeWord===!0||e.wholeWord===!1)&&(this._wholeWord=e.wholeWord),(e.incremental===!0||e.incremental===!1)&&(this._incremental=e.incremental),(e.regex===!0||e.regex===!1)&&(this._regex=e.regex),(e.findAfterReplace===!0||e.findAfterReplace===!1)&&(this._findAfterReplace=e.findAfterReplace),(e.hideAfterFind===!0||e.hideAfterFind===!1)&&(this._hideAfterFind=e.hideAfterFind),(e.reverse===!0||e.reverse===!1)&&(this._reverse=e.reverse),e.hasOwnProperty("findCallback")&&(this._findCallback=e.findCallback),e.hasOwnProperty("start")&&(this._start=e.start),e.hasOwnProperty("end")&&(this._end=e.end)}},show:function(e){this._visible=!0,e&&(this._savedOptions||(this._savedOptions=[]),this._savedOptions.push(this.getOptions()),this.setOptions(e)),this._startOffset=this._editor.getSelection().start,this._editor.getTextView().addEventListener("Focus",this._listeners.onEditorFocus);var t=this;window.setTimeout(function(){t._incremental&&t.find(!0,null,!0)},0)},startUndo:function(){this._undoStack&&this._undoStack.startCompoundChange()},endUndo:function(){this._undoStack&&this._undoStack.endCompoundChange()},_find:function(e,t,i){return this._editor.getModel().find({string:e,start:t,end:this._end,reverse:this._reverse,wrap:i?!1:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive})},_doFind:function(t,i,o,r){o=o||1;var s=this._editor;if(!t)return this._removeAllAnnotations(),null;this._lastString=t;var a,l;if(this._regex)try{l=this._find(t,i,r)}catch(c){return void s.reportStatus(c.message,"error")}else l=this._find(t,i,r);for(var d=0;o>d&&l.hasNext();d++)a=l.next();if(!this._replacingAll){if(a?this._editor.reportStatus(""):this._editor.reportStatus(e.notFound,"error"),this.isVisible()){var h=n.AnnotationType.ANNOTATION_CURRENT_SEARCH,u=s.getAnnotationModel();if(u&&(u.removeAnnotations(h),a&&u.addAnnotation(n.AnnotationType.createAnnotation(h,a.start,a.end))),this._showAll){this._timer&&window.clearTimeout(this._timer);var p=this;this._timer=window.setTimeout(function(){p._markAllOccurrences(),p._timer=null},500)}}this._findCallback?this._findCallback(a):a&&s.moveSelection(a.start,a.end,null,!1)}return a},_doReplace:function(e,t,i,n){var o=this._editor;this._regex&&(n=o.getText(e,t).replace(new RegExp(i,this._caseInsensitive?"i":""),n)),o.setText(n,e,t),o.setSelection(e,e+n.length,!0)},_markAllOccurrences:function(){var e=this._editor.getAnnotationModel();if(e){for(var t,i=n.AnnotationType.ANNOTATION_MATCHING_SEARCH,o=e.getAnnotations(),r=[];o.hasNext();){var s=o.next();s.type===i&&r.push(s)}if(this.isVisible()){var a=this.getFindString();for(o=this._editor.getModel().find({string:a,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive}),t=[];o.hasNext();){var l=o.next();t.push(n.AnnotationType.createAnnotation(i,l.start,l.end))}}e.replaceAnnotations(r,t)}},_removeAllAnnotations:function(){var e=this._editor.getAnnotationModel();e&&(e.removeAnnotations(n.AnnotationType.ANNOTATION_CURRENT_SEARCH),e.removeAnnotations(n.AnnotationType.ANNOTATION_MATCHING_SEARCH))},_removeCurrentAnnotation:function(){var e=this._editor.getAnnotationModel();e&&e.removeAnnotations(n.AnnotationType.ANNOTATION_CURRENT_SEARCH)}},c.Find=l,c}),define("orion/editor/findUI",["i18n!orion/editor/nls/messages","orion/editor/find","orion/objects","orion/editor/util","orion/util"],function(e,t,i,n,o){function r(e,i,n){t.Find.call(this,e,i,n)}return r.prototype=new t.Find,i.mixin(r.prototype,{getFindString:function(){var e=this._findInput;return e?e.value:t.Find.prototype.getFindString.call(this)},getReplaceString:function(){var e=this._replaceInput;return e?e.value:t.Find.prototype.getReplaceString(this)},hide:function(){var e=this.isVisible();t.Find.prototype.hide.call(this),e&&(this._rootDiv.className="textViewFind")},show:function(e){t.Find.prototype.show.call(this,e);var i=e.findString,n=e.replaceString,o=this._findInput;if(o||(this._create(),o=this._findInput),i&&(o.value=i),n){var r=this._replaceInput;r.value=n}var s=this;window.setTimeout(function(){s._rootDiv.className="textViewFind show",o.select(),o.focus()},0)},_create:function(){var e=this,t=this._editor.getTextView(),i=t.getOptions("parent"),r=i.ownerDocument,s=o.createElement(r,"div");s.className="textViewFind",n.addEventListener(s,"keydown",function(t){e._handleKeyDown(t)}),this._rootDiv=s,this._createContents(r,s),t._rootDiv.insertBefore(s,t._rootDiv.firstChild)},_createContents:function(t,i){var r=this,s=o.createElement(t,"input");s.className="textViewFindInput",this._findInput=s,s.type="text",s.placeholder=e.findWith,n.addEventListener(s,"input",function(e){return r._handleInput(e)}),i.appendChild(s);var a=o.createElement(t,"span");r._createButton(t,a,e.next,function(){r.find(!0)}),r._createButton(t,a,e.previous,function(){r.find(!1)}),i.appendChild(a);var l=r._editor.getTextView().getOptions("readonly");if(!l){var c=o.createElement(t,"input");c.className="textViewReplaceInput",this._replaceInput=c,c.type="text",c.placeholder=e.replaceWith,i.appendChild(c),a=o.createElement(t,"span"),r._createButton(t,a,e.replace,function(){r.replace()}),r._createButton(t,a,e.replaceAll,function(){r.replaceAll()}),i.appendChild(a)}a=o.createElement(t,"span"),r._createButton(t,a,e.regex,function(e){r._toggle("regex",e.target)},this._regex,e.regexTooltip),r._createButton(t,a,e.caseInsensitive,function(e){r._toggle("caseInsensitive",e.target)},this._caseInsensitive,e.caseInsensitiveTooltip),r._createButton(t,a,e.wholeWord,function(e){r._toggle("wholeWord",e.target)},this._wholeWord,e.wholeWordTooltip),i.appendChild(a);var d=r._createButton(t,i,"",function(){r.hide()});d.className="textViewFindCloseButton",d.title=e.closeTooltip},_createButton:function(e,t,i,o,r,s){var a=e.createElement("button");return a.type="button",this._checked(r,a),s&&(a.title=s),n.addEventListener(a,"click",function(e){o.call(this,e)},!1),i&&a.appendChild(e.createTextNode(i)),t.appendChild(a),a},_toggle:function(e,t){var i={};i[e]=!this["_"+e],this.setOptions(i),this._checked(i[e],t)},_checked:function(e,t){t.className="textViewFindButton",e&&(t.className+=" checked")},_handleInput:function(){return this._incremental&&this.find(!0,null,!0),!0},_handleKeyDown:function(e){var t,i=(o.isMac?e.metaKey:e.ctrlKey)&&!e.altKey&&!e.shiftKey;return i&&70===e.keyCode&&(t=!0),((o.isMac?e.metaKey:e.ctrlKey)&&!e.altKey&&75===e.keyCode||13===e.keyCode)&&(this.find(13===e.keyCode?this._reverse?e.shiftKey:!e.shiftKey:!e.shiftKey),t=!0),i&&82===e.keyCode&&(this.replace(),t=!0),27===e.keyCode&&(this.hide(),t=!0),t?(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,!1):!0}}),{FindUI:r}}),define("orion/editor/actions",["i18n!orion/editor/nls/messages","orion/keyBinding","orion/editor/annotations","orion/editor/tooltip","orion/editor/find","orion/editor/findUI","orion/util"],function(e,t,i,n,o,r,s){function a(e,t,i,n){function o(e,t,i){s.setText(e,t,i),r+=t-i+e.length}var r=0,s=e.editor,a=s.getSelections();!n&&(t||a.length>1)&&e.startUndo(),a.forEach(function(e){e.start+=r,e.end+=r,i(e,o)}),s.setSelections(a),!n&&(t||a.length>1)&&e.endUndo()}function l(e,t,i){this.editor=e,this.undoStack=t,this._incrementalFind=new o.IncrementalFind(e),this._find=i?i:new r.FindUI(e,t),this._lastEditLocation=null,this.init()}function c(e,t,i,n){this.editor=e,this.undoStack=t,this.contentAssist=i,this.linkedMode=n,this.contentAssist&&this.contentAssist.addEventListener("ProposalApplied",this.contentAssistProposalApplied.bind(this)),this.init()}var d=i.AnnotationType,h={};return l.prototype={init:function(){var i=this.editor.getTextView();this._lastEditListener={onModelChanged:function(e){this.editor.isDirty()&&(this._lastEditLocation=e.start+e.addedCharCount)}.bind(this)},i.addEventListener("ModelChanged",this._lastEditListener.onModelChanged),i.setAction("undo",function(e){if(this.undoStack){var t=1;for(e&&e.count&&(t=e.count);t>0;)this.undoStack.undo(),--t;return!0}return!1}.bind(this),{name:e.undo}),i.setAction("redo",function(e){if(this.undoStack){var t=1;for(e&&e.count&&(t=e.count);t>0;)this.undoStack.redo(),--t;return!0}return!1}.bind(this),{name:e.redo}),i.setKeyBinding(new t.KeyBinding("f",!0),"find"),i.setAction("find",function(){if(this._find){var e=this.editor.getSelection();return this._find.show({findString:this.editor.getText(e.start,e.end)}),!0}return!1}.bind(this),{name:e.find}),i.setKeyBinding(new t.KeyBinding("k",!0),"findNext"),i.setAction("findNext",function(e){return this._find?(this._find.find(!0,e),!0):!1}.bind(this),{name:e.findNext}),i.setKeyBinding(new t.KeyBinding("k",!0,!0),"findPrevious"),i.setAction("findPrevious",function(e){return this._find?(this._find.find(!1,e),!0):!1}.bind(this),{name:e.findPrevious}),i.setKeyBinding(new t.KeyBinding("j",!0),"incrementalFind"),i.setAction("incrementalFind",function(){return this._incrementalFind&&this._incrementalFind.find(!0),!0}.bind(this),{name:e.incrementalFind}),i.setKeyBinding(new t.KeyBinding("j",!0,!0),"incrementalFindReverse"),i.setAction("incrementalFindReverse",function(){return this._incrementalFind&&this._incrementalFind.find(!1),!0}.bind(this),{name:e.incrementalFindReverse}),i.setAction("tab",function(){return this.indentLines()}.bind(this)),i.setAction("shiftTab",function(){return this.unindentLines()}.bind(this),{name:e.unindentLines}),i.setKeyBinding(new t.KeyBinding(38,!1,!1,!0),"moveLinesUp"),i.setAction("moveLinesUp",function(){return this.moveLinesUp()}.bind(this),{name:e.moveLinesUp}),i.setKeyBinding(new t.KeyBinding(40,!1,!1,!0),"moveLinesDown"),i.setAction("moveLinesDown",function(){return this.moveLinesDown()}.bind(this),{name:e.moveLinesDown}),i.setKeyBinding(new t.KeyBinding(38,!0,!1,!0),"copyLinesUp"),i.setAction("copyLinesUp",function(){return this.copyLinesUp()}.bind(this),{name:e.copyLinesUp}),i.setKeyBinding(new t.KeyBinding(40,!0,!1,!0),"copyLinesDown"),i.setAction("copyLinesDown",function(){return this.copyLinesDown()}.bind(this),{name:e.copyLinesDown}),i.setKeyBinding(new t.KeyBinding("d",!0,!1,!1),"deleteLines"),i.setAction("deleteLines",function(e){return this.deleteLines(e)}.bind(this),{name:e.deleteLines}),i.setKeyBinding(new t.KeyBinding("l",!s.isMac,!1,!1,s.isMac),"gotoLine"),i.setAction("gotoLine",function(){return this.gotoLine()}.bind(this),{name:e.gotoLine}),i.setKeyBinding(new t.KeyBinding(190,!0),"nextAnnotation"),i.setAction("nextAnnotation",function(){return this.nextAnnotation(!0)}.bind(this),{name:e.nextAnnotation}),i.setKeyBinding(new t.KeyBinding(188,!0),"previousAnnotation"),i.setAction("previousAnnotation",function(){return this.nextAnnotation(!1)}.bind(this),{name:e.prevAnnotation}),i.setKeyBinding(new t.KeyBinding("e",!0,!1,!0,!1),"expand"),i.setAction("expand",function(){return this.expandAnnotation(!0)}.bind(this),{name:e.expand}),i.setKeyBinding(new t.KeyBinding("c",!0,!1,!0,!1),"collapse"),i.setAction("collapse",function(){return this.expandAnnotation(!1)}.bind(this),{name:e.collapse}),i.setKeyBinding(new t.KeyBinding("e",!0,!0,!0,!1),"expandAll"),i.setAction("expandAll",function(){return this.expandAnnotations(!0)}.bind(this),{name:e.expandAll}),i.setKeyBinding(new t.KeyBinding("c",!0,!0,!0,!1),"collapseAll"),i.setAction("collapseAll",function(){return this.expandAnnotations(!1)}.bind(this),{name:e.collapseAll}),i.setKeyBinding(new t.KeyBinding("q",!s.isMac,!1,!1,s.isMac),"lastEdit"),i.setAction("lastEdit",function(){return this.gotoLastEdit()}.bind(this),{name:e.lastEdit})},copyLinesDown:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;var i=e.getModel();return a(this,!1,function(e,t){var n=i.getLineAtOffset(e.start),o=i.getLineAtOffset(e.end>e.start?e.end-1:e.end),r=i.getLineStart(n),s=i.getLineEnd(o,!0),a=i.getLineCount(),l="",c=i.getText(r,s);o===a-1&&(c=(l=i.getLineDelimiter())+c);var d=s;t(c,d,d),e.start=d+l.length,e.end=d+c.length}),!0},copyLinesUp:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;var i=e.getModel();return a(this,!1,function(e,t){var n=i.getLineAtOffset(e.start),o=i.getLineAtOffset(e.end>e.start?e.end-1:e.end),r=i.getLineStart(n),s=i.getLineEnd(o,!0),a=i.getLineCount(),l="",c=i.getText(r,s);o===a-1&&(c+=l=i.getLineDelimiter());var d=r;t(c,d,d),e.start=d,e.end=d+c.length-l.length}),!0},deleteLines:function(e){var t=this.editor,i=t.getTextView();if(i.getOptions("readonly"))return!1;var n=1;e&&e.count&&(n=e.count);var o=t.getModel();return a(this,!1,function(e,t){var i,r=o.getLineAtOffset(e.start),s=o.getLineStart(r);i=e.start!==e.end||1===n?o.getLineAtOffset(e.end>e.start?e.end-1:e.end):Math.min(r+n-1,o.getLineCount()-1);var a=o.getLineEnd(i,!0);t("",s,a),e.start=e.end=s}),!0},expandAnnotation:function(e){var t=this.editor,n=t.getAnnotationModel();if(!n)return!0;var o=t.getModel(),r=t.getCaretOffset(),s=o.getLineAtOffset(r),a=o.getLineStart(s),l=o.getLineEnd(s,!0);o.getBaseModel&&(a=o.mapOffset(a),l=o.mapOffset(l),o=o.getBaseModel());for(var c,d=n.getAnnotations(a,l);!c&&d.hasNext();){var h=d.next();h.type===i.AnnotationType.ANNOTATION_FOLDING&&(c=h)}return c&&e!==c.expanded&&(e?c.expand():(t.setCaretOffset(c.start),c.collapse())),!0},expandAnnotations:function(e){var t=this.editor,n=t.getTextView(),o=t.getAnnotationModel();if(!o)return!0;var r,s=o.getAnnotations();for(n.setRedraw(!1);s.hasNext();)r=s.next(),r.type===i.AnnotationType.ANNOTATION_FOLDING&&e!==r.expanded&&(e?r.expand():r.collapse());return n.setRedraw(!0),!0},indentLines:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;if(t.getOptions("tabMode")){var i=e.getModel(),n=0,o=e.getSelections();return o.length>1&&this.startUndo(),o.some(function(r){r.start+=n,r.end+=n;var s=i.getLineAtOffset(r.start),a=i.getLineAtOffset(r.end>r.start?r.end-1:r.end);if(!(s!==a||o.length>1))return!0;var l=[];l.push("");for(var c=s;a>=c;c++)l.push(i.getLine(c,!0));var d=i.getLineStart(s),h=i.getLineEnd(a,!0),u=t.getOptions("tabSize","expandTab"),p=u.expandTab?new Array(u.tabSize+1).join(" "):"	",f=l.join(p);e.setText(f,d,h);var g=d===r.start?r.start:r.start+p.length,m=r.end+(a-s+1)*p.length;return n+=d-h+f.length,r.start=g,r.end=m,!1})?!1:(e.setSelections(o),o.length>1&&this.endUndo(),!0)}},gotoLastEdit:function(){return"number"==typeof this._lastEditLocation&&this.editor.showSelection(this._lastEditLocation),!0},gotoLine:function(){var t=this.editor,i=t.getModel(),n=i.getLineAtOffset(t.getCaretOffset());return n=prompt(e.gotoLinePrompty,n+1),n&&(n=parseInt(n,10),t.onGotoLine(n-1,0)),!0},moveLinesDown:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;var i=e.getModel();return a(this,!0,function(e,t){var n=i.getLineAtOffset(e.start),o=i.getLineAtOffset(e.end>e.start?e.end-1:e.end),r=i.getLineCount();if(o!==r-1){var s,a=i.getLineStart(n),l=i.getLineEnd(o,!0),c=i.getLineEnd(o+1,!0)-(l-a),d=0;if(o!==r-2)s=i.getText(a,l);else{var h=i.getLineEnd(o);s=i.getText(h,l)+i.getText(a,h),d+=l-h}t("",a,l),t(s,c,c),e.start=c+d,e.end=c+d+s.length}}),!0},moveLinesUp:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;var i=e.getModel();return a(this,!0,function(e,t){var n=i.getLineAtOffset(e.start);if(0!==n){var o=i.getLineAtOffset(e.end>e.start?e.end-1:e.end),r=i.getLineCount(),s=i.getLineStart(n-1),a=i.getLineStart(n),l=i.getLineEnd(o,!0),c=i.getText(a,l),d=0;if(o===r-1){var h=i.getLineEnd(n-1),u=i.getLineEnd(n-1,!0);c+=i.getText(h,u),a=h,d=u-h}t("",a,l),t(c,s,s),e.start=s,e.end=s+c.length-d}}),!0},nextAnnotation:function(e){function t(e){return!!e.lineStyle||e.type===d.ANNOTATION_MATCHING_BRACKET||e.type===d.ANNOTATION_CURRENT_BRACKET||!r.isAnnotationTypeVisible(e.type)}var i=this.editor,o=i.getAnnotationModel();if(!o)return!0;var r=i.getOverviewRuler()||i.getAnnotationStyler();if(!r)return!0;for(var s=i.getModel(),a=i.getCaretOffset(),l=o.getAnnotations(e?a:0,e?s.getCharCount():a),c=null;l.hasNext();){var h=l.next();if(e){if(h.start<=a)continue}else if(h.start>=a)continue;if(!t(h)&&(c=h,e))break}if(c){var u=[c];for(l=o.getAnnotations(c.start,c.start);l.hasNext();)h=l.next(),h===c||t(h)||u.push(h);var p=i.getTextView(),f=(s.getLineAtOffset(c.start),n.Tooltip.getTooltip(p));if(!f)return i.moveSelection(c.start),!0;i.moveSelection(c.start,c.start,function(){setTimeout(function(){var e=i.getTextView(),t=c.start,n=e.getLocationAtOffset(t);f.show({x:n.x,y:n.y,getTooltipInfo:function(){return i._getTooltipInfo(this.x,this.y)}},!1,!1)},0)})}return!0},unindentLines:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;if(t.getOptions("tabMode")){var i=e.getModel();return a(this,!1,function(e,n){for(var o=i.getLineAtOffset(e.start),r=i.getLineAtOffset(e.end>e.start?e.end-1:e.end),s=t.getOptions("tabSize"),a=new Array(s+1).join(" "),l=[],c=0,d=0,h=o;r>=h;h++){var u=i.getLine(h,!0);if(i.getLineStart(h)!==i.getLineEnd(h))if(0===u.indexOf("	"))u=u.substring(1),c++;else{if(0!==u.indexOf(a))return!0;u=u.substring(s),c+=s}h===o&&(d=c),l.push(u)}var p=i.getLineStart(o),f=i.getLineEnd(r,!0),g=i.getLineStart(r),m=l.join("");n(m,p,f);var v=p===e.start?e.start:e.start-d,_=Math.max(v,e.end-c+(e.end===g+1&&e.start!==e.end?1:0));e.start=v,e.end=_}),!0}},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()}},h.TextActions=l,c.prototype={init:function(){var i=this.editor.getTextView();i.setAction("lineStart",function(){return this.lineStart()}.bind(this)),i.setAction("enter",function(){return this.autoIndent()}.bind(this)),i.setKeyBinding(new t.KeyBinding("t",!0,!1,!0),"trimTrailingWhitespaces"),i.setAction("trimTrailingWhitespaces",function(){return this.trimTrailingWhitespaces()}.bind(this),{name:e.trimTrailingWhitespaces}),i.setKeyBinding(new t.KeyBinding(191,!0),"toggleLineComment"),i.setAction("toggleLineComment",function(){return this.toggleLineComment()}.bind(this),{name:e.toggleLineComment}),i.setKeyBinding(new t.KeyBinding(191,!0,!s.isMac,!1,s.isMac),"addBlockComment"),i.setAction("addBlockComment",function(){return this.addBlockComment()}.bind(this),{name:e.addBlockComment}),i.setKeyBinding(new t.KeyBinding(220,!0,!s.isMac,!1,s.isMac),"removeBlockComment"),i.setAction("removeBlockComment",function(){return this.removeBlockComment()}.bind(this),{name:e.removeBlockComment}),i.setKeyBinding(new t.KeyBinding("[",!1,!1,!1,!1,"keypress"),"autoPairSquareBracket"),i.setAction("autoPairSquareBracket",function(){return this.autoPairBrackets("[","]")}.bind(this)),i.setKeyBinding(new t.KeyBinding("]",!1,!1,!1,!1,"keypress"),"skipClosingSquareBracket"),i.setAction("skipClosingSquareBracket",function(){return this.handleClosingBracket("]")}.bind(this)),i.setKeyBinding(new t.KeyBinding("<",!1,!1,!1,!1,"keypress"),"autoPairAngleBracket"),i.setAction("autoPairAngleBracket",function(){return this.autoPairBrackets("<",">")}.bind(this)),i.setKeyBinding(new t.KeyBinding(">",!1,!1,!1,!1,"keypress"),"skipClosingAngleBracket"),i.setAction("skipClosingAngleBracket",function(){return this.handleClosingBracket(">")}.bind(this)),i.setKeyBinding(new t.KeyBinding("(",!1,!1,!1,!1,"keypress"),"autoPairParentheses"),i.setAction("autoPairParentheses",function(){return this.autoPairBrackets("(",")")}.bind(this)),i.setKeyBinding(new t.KeyBinding(")",!1,!1,!1,!1,"keypress"),"skipClosingParenthesis"),i.setAction("skipClosingParenthesis",function(){return this.handleClosingBracket(")")}.bind(this)),i.setKeyBinding(new t.KeyBinding("{",!1,!1,!1,!1,"keypress"),"autoPairBraces"),i.setAction("autoPairBraces",function(){return this.autoPairBrackets("{","}")}.bind(this)),i.setKeyBinding(new t.KeyBinding("}",!1,!1,!1,!1,"keypress"),"skipClosingBrace"),i.setAction("skipClosingBrace",function(){return this.handleClosingBracket("}")}.bind(this)),i.setKeyBinding(new t.KeyBinding("'",!1,!1,!1,!1,"keypress"),"autoPairSingleQuotation"),i.setAction("autoPairSingleQuotation",function(){return this.autoPairQuotations("'")}.bind(this)),i.setKeyBinding(new t.KeyBinding('"',!1,!1,!1,!1,"keypress"),"autoPairDblQuotation"),i.setAction("autoPairDblQuotation",function(){return this.autoPairQuotations('"')}.bind(this)),i.setAction("deletePrevious",function(){return this.deletePrevious()}.bind(this))},autoIndent:function(){function e(e,t){if(e.start===e.end){for(var i,o=n.getLineAtOffset(e.start),a=n.getLine(o,!1),u=n.getLineStart(o),p=0,f=e.start-u;f>p&&(32===(i=a.charCodeAt(p))||9===i);)p++;var g,m,v=a.substring(0,p),_=a.substring(0,f),y=a.substring(f);if(h.smartIndentation&&123===a.charCodeAt(m=_.trimRight().length-1)){var C=f-m-1,w=y.length-y.trimLeft().length;return g=125===a.charCodeAt(f+w)?s+v+r+s+v:s+v+r,t(g,e.start-C,e.end+w),e.start=e.end=e.start+s.length+v.length+r.length-C,!0}if(h.autoCompleteComments&&!d.test(_)&&(l.test(_)||c.test(_))){var b,S=l.exec(_);if(S)return g=s+v+" * ",g+=d.test(y)?y.substring(0,y.length-2).trim():y.trim(),n.getLineCount()!==o+1&&c.test(n.getLine(o+1))||(g+=s+v+" */"),t(g,e.start,e.end+y.length),e.start=e.end=e.start+s.length+v.length+3,!0;if(S=c.exec(_))for(var x=o-1;x>=0;x--){var L=n.getLine(x,!1);if(l.test(L))return d.test(y)||47===a.charCodeAt(f)?(g=s+v+"*"+y,b=e.start+s.length+v.length+1):(g=s+v+"* "+y,b=e.start+s.length+v.length+2),t(g,e.start,e.end+y.length),e.start=e.end=b,!0;if(!c.test(L))return!1}return!1}if(d.test(_)&&32===v.charCodeAt(v.length-1))return g=s+v.substring(0,v.length-1),t(g,e.start,e.end),e.start=e.end=e.start+g.length,!0;if(p>0){for(p=f;p<a.length&&(32===(i=a.charCodeAt(p++))||9===i);)e.end++;return g=n.getLineDelimiter()+v,t(g,e.start,e.end),e.start=e.end=e.start+g.length,!0}}return!1}var t=this.editor,i=t.getTextView();if(i.getOptions("readonly"))return!1;if(i.getOptions("singleMode"))return!1;var n=t.getModel(),o=i.getOptions("tabSize","expandTab"),r=o.expandTab?new Array(o.tabSize+1).join(" "):"	",s=n.getLineDelimiter(),l=/^[\s]*\/\*[\*]*[\s]*$/,c=/^[\s]*\*/,d=/\*\/[\s]*$/,h=this;return a(this,!0,function(t,i){e(t,i)||(i(s,t.start,t.end),t.start=t.end=t.start+s.length)}),!0},addBlockComment:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;var i=e.getModel(),n="/*",o="*/",r=new RegExp("/\\*|\\*/","g"),s=this;return a(this,!1,function(e,t){var a=s._findEnclosingComment(i,e.start,e.end);if(void 0===a.commentStart||void 0===a.commentEnd){var l=i.getText(e.start,e.end);if(0!==l.length){var c=l.length;l=l.replace(r,"");var d=l.length;l=n+l+o,t(l,e.start,e.end),e.start+=n.length,e.end+=n.length+(d-c)}}}),!0},autoPairBrackets:function(e,t){if("["===e&&!this.autoPairSquareBrackets)return!1;if("{"===e&&!this.autoPairBraces)return!1;if("("===e&&!this.autoPairParentheses)return!1;if("<"===e&&!this.autoPairAngleBrackets)return!1;var i=this.editor,n=i.getTextView();if(n.getOptions("readonly"))return!1;var o=new RegExp("^$|[)}\\]>]"),r=i.getModel();return a(this,!1,function(i,n){var s,a=i.start===r.getCharCount()?"":r.getText(i.start,i.start+1).trim();i.start===i.end&&o.test(a)?(s=e+t,n(s,i.start,i.start),i.start=i.end=i.start+1):i.start!==i.end?(s=e+r.getText(i.start,i.end)+t,n(s,i.start,i.end),i.start+=1,i.end+=1):(n(e,i.start,i.end),i.start=i.end=i.start+e.length)}),!0},autoPairQuotations:function(e){if(!this.autoPairQuotation)return!1;var t=this.editor,i=t.getTextView();if(i.getOptions("readonly"))return!1;var n=new RegExp("^\"$|^'$"),o=new RegExp("\\w"),r=new RegExp("^$|[)}\\]>]"),s=t.getModel();return a(this,!1,function(t,i){function a(){i(e,t.start,t.end),t.start=t.end=t.start+e.length}var l=0===t.start?"":s.getText(t.start-1,t.start).trim(),c=t.start===s.getCharCount()?"":s.getText(t.start,t.start+1).trim();if(t.start!==t.end){var d=s.getText(t.start,t.end);n.test(d)?a():(i(e+d+e,t.start,t.end),t.start+=1,t.end+=1)}else c===e?t.start=t.end=t.start+1:l===e||n.test(c)||o.test(l)||!r.test(c)?a():(i(e+e,t.start,t.end),t.start=t.end=t.start+e.length)}),!0},contentAssistProposalApplied:function(e){function t(){return"number"==typeof i.escapePosition?i.escapePosition:e.data.start+i.proposal.length}var i=e.data.proposal;if(i.positions&&i.positions.length>0&&this.linkedMode){for(var n=[],o=0;o<i.positions.length;++o)n[o]={positions:[{offset:i.positions[o].offset,length:i.positions[o].length}]};this.linkedMode.enterLinkedMode({groups:n,escapePosition:t()})}else if(i.groups&&i.groups.length>0&&this.linkedMode)this.linkedMode.enterLinkedMode({groups:i.groups,escapePosition:t()});else if("number"==typeof i.escapePosition){var r=this.editor.getTextView();r.setCaretOffset(i.escapePosition)}return!0},deletePrevious:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;var i=e.getModel();return a(this,!1,function(e,t){if(e.start===e.end){var n=0===e.start?"":i.getText(e.start-1,e.start),o=e.start===i.getCharCount()?"":i.getText(e.start,e.start+1);("("===n&&")"===o||"["===n&&"]"===o||"{"===n&&"}"===o||"<"===n&&">"===o||'"'===n&&'"'===o||"'"===n&&"'"===o)&&t("",e.start,e.start+1)}},!0),!1},_findEnclosingComment:function(e,t,i){var n,o,r,s,a,l,c,d="/*",h="*/",u=e.getLineAtOffset(t),p=e.getLineAtOffset(i);for(n=u;n>=0&&(o=e.getLine(n),r=n===u?t-e.getLineStart(u):o.length,s=o.lastIndexOf(d,r),a=o.lastIndexOf(h,r),!(a>s));n--)if(-1!==s){l=e.getLineStart(n)+s;break}for(n=p;n<e.getLineCount()&&(o=e.getLine(n),r=n===p?i-e.getLineStart(p):0,s=o.indexOf(d,r),a=o.indexOf(h,r),!(-1!==s&&a>s));n++)if(-1!==a){c=e.getLineStart(n)+a;break}return{commentStart:l,commentEnd:c}},lineStart:function(){var e=this.editor,t=e.getModel();return a(this,!1,function(e){var i,n=e.getCaret(),o=t.getLineAtOffset(n),r=t.getLineStart(o),s=t.getLine(o);for(i=0;i<s.length;i++){var a=s.charCodeAt(i);if(32!==a&&9!==a)break}i+=r,e.setCaret(n!==i?i:r)}),!0},removeBlockComment:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;var i=e.getModel(),n="/*",o="*/",r=this;return a(this,!1,function(e,t){var s,a,l,c=i.getText(e.start,e.end);for(l=0;l<c.length;l++)if(c.substring(l,l+n.length)===n){s=e.start+l;break}for(;l<c.length;l++)if(c.substring(l,l+o.length)===o){a=e.start+l;break}var d;if(void 0!==s&&void 0!==a)d=i.getText(s+n.length,a),t(d,s,a+o.length),e.start=s,e.end=a;else{var h=r._findEnclosingComment(i,e.start,e.end);void 0!==h.commentStart&&void 0!==h.commentEnd&&(d=i.getText(h.commentStart+n.length,h.commentEnd),t(d,h.commentStart,h.commentEnd+o.length),e.start=e.start-n.length,e.end=e.end-o.length)}}),!0},toggleLineComment:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;var i=this.lineComment||"//",n=e.getModel();return t.setRedraw(!1),a(this,!0,function(e,t){for(var o,r=n.getLineAtOffset(e.start),s=n.getLineAtOffset(e.end>e.start?e.end-1:e.end),a=!0,l=[],c=r;s>=c;c++){var d=n.getLine(c,!0);if(o=d.indexOf(i),l.push(o),a&&-1!==o){if(0!==o){var h;for(h=0;o>h;h++){var u=d.charCodeAt(h);if(32!==u&&9!==u)break}a=h===o}}else a=!1}var p,f,g,m=i.length,v=n.getLineStart(r);if(a){for(g=l.length-1;g>=0;g--)o=l[g]+n.getLineStart(r+g),t("",o,o+m);var _=n.getLineStart(s);p=v===e.start?e.start:e.start-m,f=e.end-m*(s-r+1)+(e.end===_+1?m:0)}else{for(g=l.length-1;g>=0;g--)o=n.getLineStart(r+g),t(i,o,o);p=v===e.start?e.start:e.start+m,f=e.end+m*(s-r+1)}e.start=p,e.end=f}),t.setRedraw(!0),!0},trimTrailingWhitespaces:function(){var e=this.editor,t=e.getModel(),i=e.getSelections();e.getTextView().setRedraw(!1),this.startUndo();for(var n=/(\s+$)/,o=t.getLineCount(),r=0;o>r;r++){var s=t.getLine(r),a=n.exec(s);if(a){var l=t.getLineStart(r),c=a[0].length,d=l+a.index;t.setText("",d,d+c),i.forEach(function(e){e.start>d&&(e.start=Math.max(d,e.start-c)),e.start!==e.end&&e.end>d&&(e.end=Math.max(d,e.end-c))})}}this.endUndo(),e.setSelections(i,!1),e.getTextView().setRedraw(!0)},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},handleClosingBracket:function(e){var t=this.editor,i=t.getTextView();if(i.getOptions("readonly"))return!1;var n=t.getModel(),o=t.getSelections();if(1===o.length&&o[0].start===o[0].end){var r=o[0].start===n.getCharCount()?"":n.getText(o[0].start,o[0].start+1);if(r===e)return o[0].start=o[0].end=o[0].start+1,t.setSelections(o),!0;var s=n.getLineAtOffset(o[0].start),a=n.getLine(s,!0);if(a.match(/^\s*$/)&&i.getOptions("tabMode")){var l=i.getOptions("tabSize"),c=new Array(l+1).join(" "),d=n.getLineStart(s),h=n.getLineEnd(s);if(d!==h){if(0===a.indexOf("	"))return a=a.substring(1),n.setText(a,d,h),t.setSelection(o[0].start-1,o[0].end-1),!1;if(0===a.indexOf(c))return a=a.substring(l),n.setText(a,d,h),t.setSelection(o[0].start-l,o[0].end-l),!1}}}return!1},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},setAutoPairParentheses:function(e){this.autoPairParentheses=e
},setAutoPairBraces:function(e){this.autoPairBraces=e},setAutoPairSquareBrackets:function(e){this.autoPairSquareBrackets=e},setAutoPairAngleBrackets:function(e){this.autoPairAngleBrackets=e},setAutoPairQuotations:function(e){this.autoPairQuotation=e},setAutoCompleteComments:function(e){this.autoCompleteComments=e},setLineComment:function(e){this.lineComment=e},setSmartIndentation:function(e){this.smartIndentation=e}},h.SourceCodeActions=c,String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/g,"")}),String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")}),h}),define("orion/editor/undoStack",[],function(){function e(e,t,i,n,o){this.model=e,this.offset=t,this.text=i,this.previousText=n,this.type=o}function t(e){this.owner=e,this.changes=[]}function i(e,t){this.size=void 0!==t?t:100,this.reset();var i=this;if(this._listener={onChanging:function(e){i._onChanging(e)},onDestroy:function(e){i._onDestroy(e)}},e.getModel){var n=e.getModel();n.getBaseModel&&(n=n.getBaseModel()),this.model=n,this.setView(e)}else this.shared=!0,this.model=e;this.model.addEventListener("Changing",this._listener.onChanging)}return e.prototype={getRedoChanges:function(){return[{start:this.offset,end:this.offset+this.previousText.length,text:this.text}]},getUndoChanges:function(){return[{start:this.offset,end:this.offset+this.text.length,text:this.previousText}]},undo:function(e,t){return this._doUndoRedo(this.offset,this.previousText,this.text,e,t),!0},redo:function(e,t){return this._doUndoRedo(this.offset,this.text,this.previousText,e,t),!0},merge:function(e,t,i,n,o){if(n===this.type){if(1===n&&e===this.offset+this.text.length)return this.text+=t,!0;if(-1===n&&o===this.offset)return this.offset=e,this.previousText=i+this.previousText,!0;if(-1===n&&e===this.offset)return this.previousText=this.previousText+i,!0}return!1},_doUndoRedo:function(e,t,i,n,o){if(this.model.setText(t,e,e+i.length),o&&n){var r=n.getModel();r!==this.model&&(e=r.mapOffset(e,!0)),n.setSelection(e,e+t.length)}}},t.prototype={getRedoChanges:function(){for(var e=[],t=0;t<this.changes.length;t++)e=e.concat(this.changes[t].getRedoChanges());return e},getUndoChanges:function(){for(var e=[],t=this.changes.length-1;t>=0;t--)e=e.concat(this.changes[t].getUndoChanges());return e},add:function(e){this.changes.push(e)},end:function(e){e&&(this.endSelection=e.getSelections());var t=this.owner;t&&t.end&&t.end()},undo:function(e,t){this.changes.length>1&&e&&e.setRedraw(!1);for(var i=this.changes.length-1;i>=0;i--)this.changes[i].undo(e,!1);t&&e&&e.setSelections(this.startSelection),this.changes.length>1&&e&&e.setRedraw(!0);var n=this.owner;return n&&n.undo&&n.undo(),this.changes.length>0},redo:function(e,t){this.changes.length>1&&e&&e.setRedraw(!1);for(var i=0;i<this.changes.length;i++)this.changes[i].redo(e,!1);t&&e&&e.setSelections(this.endSelection),this.changes.length>1,e&&e.setRedraw(!0);var n=this.owner;return n&&n.redo&&n.redo(),this.changes.length>0},merge:function(e,t,i,n,o,r){var s=this.changes.length;return s>0&&this===r?this.changes[s-1].merge(e,t,i,n,o):!1},start:function(e){e&&(this.startSelection=e.getSelections());var t=this.owner;t&&t.start&&t.start()}},i.prototype={destroy:function(){this._onDestroy()},add:function(e){if(this.compoundChange)this.compoundChange.add(e);else{var t=this.stack.length;this.stack.splice(this.index,t-this.index,e),this.index++,this.stack.length>this.size&&(this.stack.shift(),this.index--)}},markClean:function(){this._commitUndo(),this.cleanChange=this.stack[this.index-1],this.cleanChange&&(this.cleanChange.type=2)},isClean:function(){return this.cleanChange===this.stack[this.index-1]},canUndo:function(){return this.index>0},canRedo:function(){return this.stack.length-this.index>0},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view),this.compoundChange=void 0},getSize:function(){return{undo:this.index,redo:this.stack.length-this.index}},getRedoChanges:function(){this._commitUndo();for(var e=[],t=this.index;t<this.stack.length;t++)e=e.concat(this.stack[t].getRedoChanges());return e},getUndoChanges:function(){this._commitUndo();for(var e=[],t=this.index;t>=0;t--)e=e.concat(this.stack[t].getUndoChanges());return e},undo:function(){this._commitUndo();var e,t=!1;this._ignoreUndo=!0;do{if(this.index<=0)break;e=this.stack[--this.index]}while(!(t=e.undo(this.view,!0)));return this._ignoreUndo=!1,t},redo:function(){this._commitUndo();var e,t=!1;this._ignoreUndo=!0;do{if(this.index>=this.stack.length)break;e=this.stack[this.index++]}while(!(t=e.redo(this.view,!0)));return this._ignoreUndo=!1,t},reset:function(){this.index=0,this.cleanChange=void 0,this.stack=[],this._ignoreUndo=!1,this._compoundChange=void 0},setView:function(e){this.view!==e&&(this.view&&e.removeEventListener("Destroy",this._listener.onDestroy),this.view=e,this.view&&e.addEventListener("Destroy",this._listener.onDestroy))},startCompoundChange:function(e){this._commitUndo();var i=new t(e);return this.add(i),this.compoundChange=i,this.compoundChange.start(this.view),this.compoundChange},_commitUndo:function(){this.endCompoundChange()},_onDestroy:function(e){e&&this.shared||this.model.removeEventListener("Changing",this._listener.onChanging),this.view&&(this.view.removeEventListener("Destroy",this._listener.onDestroy),this.view=null)},_trackUnsavedChanges:function(e){if(this._unsavedChanges){var t=this._unsavedChanges.length,i=e.addedCharCount,n=e.removedCharCount,o=e.start,r=e.start+n,s=0;if(0===i?s=-1:0===n&&(s=1),t>0&&s===this._previousChangeType){var a=this._unsavedChanges[t-1];if(0===n&&o===a.end+a.text.length)return void(a.text+=e.text);if(0===e.addedCharCount&&r===a.start)return void(a.start=o)}this._previousChangeType=s,this._unsavedChanges.push({start:o,end:r,text:e.text})}},_onChanging:function(t){if(this._trackUnsavedChanges(t),!this._ignoreUndo){var i=t.text,n=t.start,o=t.addedCharCount,r=t.removedCharCount,s=n+r,a=0;0===o&&1===r?a=-1:1===o&&0===r&&(a=1);var l=this.stack.length,c=this.model.getText(n,s);if(l>0&&this.index===l){var d=this.stack[l-1];if(d.merge(n,i,c,a,s,this.compoundChange))return}this.add(new e(this.model,n,i,c,a))}}},{UndoStack:i}}),define("orion/editor/rulers",["i18n!orion/editor/nls/messages","orion/editor/textView","orion/editor/annotations","orion/editor/tooltip","orion/objects","orion/editor/util","orion/util"],function(e,t,i,n,o,r,s){function a(e,t,i){this._location=e||"left",this._overview=t||"page",this._rulerStyle=i,this._view=null}function l(e,t,i,n){a.call(this,t,i,n);var o=this;this._listener={onTextModelChanged:function(e){o._onTextModelChanged(e)},onAnnotationModelChanged:function(e){o._onAnnotationModelChanged(e)}},this.setAnnotationModel(e)}function c(e,t,i,n,o){l.call(this,e,t,"page",i),this._oddStyle=n||{style:{backgroundColor:"white"}},this._evenStyle=o||{style:{backgroundColor:"white"}},this._numOfDigits=0,this._firstLine=1}function d(e,t,i){l.call(this,e,t,"page",i)}function h(e,t,i){l.call(this,e,t,"document",i)}function u(e,t,i){d.call(this,e,t,i)}a.prototype={getLocation:function(){return this._location},getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},getView:function(){return this._view},setView:function(e){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged),this._view=e,this._onTextModelChanged&&this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)}},l.prototype=o.mixin(new a,{getAnnotations:function(e,t){var i=this._annotationModel;if(!i)return[];var n=this._view.getModel(),o=n.getLineStart(e),r=n.getLineEnd(t-1),s=n;n.getBaseModel&&(s=n.getBaseModel(),o=n.mapOffset(o),r=n.mapOffset(r));for(var a=[],l=this.getAnnotationsByType(i,o,r),c=0;c<l.length;c++)for(var d=l[c],h=s.getLineAtOffset(d.start),u=s.getLineAtOffset(Math.max(d.start,d.end-1)),p=h;u>=p;p++){var f=p;if(n!==s){var g=s.getLineStart(p);if(g=n.mapOffset(g,!0),-1===g)continue;f=n.getLineAtOffset(g)}if(f>=e&&t>f){var m=this._mergeAnnotation(a[f],d,p-h,u-h+1);m&&(a[f]=m)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var v in a)a[v]._multiple&&(a[v].html=a[v].html+this._multiAnnotationOverlay.html);return a},getAnnotationModel:function(){return this._annotationModel},getWidestAnnotation:function(){return null},setAnnotationModel:function(e){this._annotationModel&&this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged),this._annotationModel=e,this._annotationModel&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(e){this._multiAnnotation=e},setMultiAnnotationOverlay:function(e){this._multiAnnotationOverlay=e},onClick:function(e){if(void 0!==e){var t,i,o,r=this._view,s=r.getModel(),a=s.getLineStart(e),l=s.getLineEnd(e,!0),c=r.getSelection().start,d=r.getSelection().end,h=this._annotationModel;if(h){s.getBaseModel&&(a=s.mapOffset(a),l=s.mapOffset(l),c=s.mapOffset(c),d=s.mapOffset(d));var u=this;t=this._findNextAnnotation(h,a,l,c,d,function(e){return u.isAnnotationTypeVisible(e)}),i=t?t.start:a,o=t?t.end:a,s.getBaseModel&&(i=s.mapOffset(i,!0),o=s.mapOffset(o,!0)),t&&void 0!==t.groupId&&(this._currentClickGroup=this._currentClickGroup===t.groupId?null:t.groupId,this._setCurrentGroup(e))}this._view.setSelection(o,i,1/3,function(){});var p=n.Tooltip.getTooltip(this._view);p&&(t&&"left"===this.getLocation()?p.show({getTooltipInfo:function(){return u._getTooltipInfo([t])}},!1,!1):p.hide())}},onDblClick:function(){},onMouseMove:function(e,t){var i=n.Tooltip.getTooltip(this._view);if(i&&(!i.isVisible()||this._tooltipLineIndex!==e)&&(this._tooltipLineIndex=e,t.clientX!==this._lastMouseX||t.clientY!==this._lastMouseY)){this._lastMouseX=t.clientX,this._lastMouseY=t.clientY,this._hoverTimeout&&(window.clearTimeout(this._hoverTimeout),this._hoverTimeout=null);var o=t.target?t.target:t.srcElement,r=o.getBoundingClientRect();this._curElementBounds=Object.create(null),this._curElementBounds.top=r.top,this._curElementBounds.left=r.left,this._curElementBounds.height=r.height,this._curElementBounds.width=r.width,o===this.node&&(this._curElementBounds.top=t.clientY,this._curElementBounds.height=1);var s=this;s._hoverTimeout=window.setTimeout(function(){s._hoverTimeout=null,i.onHover({getTooltipInfo:function(){var e=s._getAnnotationsAtLineIndex(s._tooltipLineIndex),i=s._getTooltipContents(s._tooltipLineIndex,e);return s._getTooltipInfo(i,t.clientY,{source:"ruler",rulerLocation:s.getLocation()})}},t.clientX,t.clientY)},175)}},onMouseOver:function(e,t){this.onMouseMove(e,t),this._currentClickGroup||this._setCurrentGroup(e)},onMouseOut:function(){this._currentClickGroup||this._setCurrentGroup(-1),this._hoverTimeout&&(window.clearTimeout(this._hoverTimeout),this._hoverTimeout=null)},_findNextAnnotation:function(e,t,i,n,o,r){var s,a=null,l=t;if(n>=0&&o>=0&&n>=t&&i>n){l=n;for(var c=e.getAnnotations(n,o);!s&&c.hasNext();){var d=c.next();(!r||r(d.type))&&d.start===n&&d.end===o&&(s=d)}}for(var h,u=e.getAnnotations(l,i);u.hasNext();)if(d=u.next(),!r||r(d.type)){if(a||(a=d),!s){a=d;break}if(h&&(s.start!==d.start||s.end!==d.end)){h=!1,a=d;break}s&&s===d&&(h=!0)}return h&&(a=null),a},_getAnnotationsAtLineIndex:function(e){if(void 0!==e){var t,i=this._view,n=this._annotationModel,o=[];if(!i)return[];if(t=i.getModel(),n&&t){var r=t.getLineStart(e),s=t.getLineEnd(e);t.getBaseModel&&(r=t.mapOffset(r),s=t.mapOffset(s)),o=this.getAnnotationsByType(n,r,s)}return o}},_getTooltipInfo:function(e,t,i){if(!e)return null;var n=Object.create(null);n.top=this._curElementBounds.top,n.left=this._curElementBounds.left,n.height=this._curElementBounds.height,n.width=this._curElementBounds.width,"string"==typeof e&&t&&(n.top=t,n.height=1);var o=this.getLocation(),r=this.getRulerStyle(),s="left"===o?"right":"left",a=this._view._clientDiv.getBoundingClientRect(),l=0,c=0;l=a.left-(n.left+n.width),c=n.height,"left"===s&&(l=-25,1===n.height&&(l+=2)),r.styleClass.indexOf("folding")>=0&&(c-=14);var d={contents:e,position:s,tooltipOffsetX:l,tooltipOffsetY:c,anchorArea:n,context:i};return d},_getTooltipContents:function(e,t){return t},_getOnClickTooltipInfo:function(e){var t=this._view,i=Object.create(null);i.top=this._curElementBounds.top,i.left=this._curElementBounds.left,i.height=this._curElementBounds.height,i.width=this._curElementBounds.width;var n=this.getLocation(),o="left"===n?"right":"left",r={contents:[e],position:o,anchorArea:i},s=t._clientDiv.getBoundingClientRect();return r.offsetX=s.left-(i.left+i.width),r.offsetY=i.height,"left"===r.position&&(r.offsetX=20),r},_onAnnotationModelChanged:function(e){function t(e){for(var t=0;t<e.length;t++)if(o.isAnnotationTypeVisible(e[t].type)){s=e[t].start;var r=e[t].end;n.getBaseModel&&(s=n.mapOffset(s,!0),r=n.mapOffset(r,!0)),-1!==s&&-1!==r&&i.redrawLines(n.getLineAtOffset(s),n.getLineAtOffset(Math.max(s,r-1))+1,o)}}var i=this._view;if(i){var n=i.getModel(),o=this,r=n.getLineCount();if(e.textModelChangedEvent){var s=e.textModelChangedEvent.start;n.getBaseModel&&(s=n.mapOffset(s,!0));var a=n.getLineAtOffset(s);return void i.redrawLines(a,r,o)}t(e.added),t(e.removed),t(e.changed)}},_mergeAnnotation:function(e,t,i){return e||(e={}),0===i&&(e.html&&t.html?(t.html!==e.html&&!e._multiple&&this._multiAnnotation&&(e.html=this._multiAnnotation.html),e._multiple=!0):e.html=t.html),e.style=this._mergeStyle(e.style,t.style),e},_mergeStyle:function(e,t){if(t){e||(e={}),e.styleClass&&t.styleClass&&e.styleClass!==t.styleClass?e.styleClass+=" "+t.styleClass:e.styleClass=t.styleClass;var i;if(t.style){e.style||(e.style={});for(i in t.style)void 0===e.style[i]&&(e.style[i]=t.style[i])}if(t.attributes){e.attributes||(e.attributes={});for(i in t.attributes)void 0===e.attributes[i]&&(e.attributes[i]=t.attributes[i])}}return e},_setCurrentGroup:function(e){var t,i,n=this._annotationModel,o=null,r=n.getTextModel(),s=this._currentGroupAnnotation;if(-1!==e){var a=r.getLineStart(e),l=r.getLineEnd(e);for(r.getBaseModel&&(a=r.mapOffset(a),l=r.mapOffset(l)),i=n.getAnnotations(a,l);i.hasNext();)if(t=i.next(),this.isAnnotationTypeVisible(t.type)&&t.start<=a&&t.end>=l&&void 0!==t.groupId){o=t;break}if(s&&o&&s.groupId===o.groupId)return}if(this._currentGroupAnnotation=null,s&&n.removeAnnotations(s.groupType),o&&-1!==e){this._currentGroupAnnotation=o,i=n.getAnnotations();for(var c=[];i.hasNext();)t=i.next(),delete t.groupAnnotation,t.groupId===o.groupId&&(t=t.createGroupAnnotation(),c.push(t));n.replaceAnnotations(null,c)}}}),i.AnnotationTypeList.addMixin(l.prototype),c.prototype=new l,c.prototype.getAnnotations=function(e,t){for(var i=l.prototype.getAnnotations.call(this,e,t),n=this._view.getModel(),o=e;t>o;o++){var r=o-this._firstLine&1?this._oddStyle:this._evenStyle,s=o;if(n.getBaseModel){var a=n.getLineStart(s);s=n.getBaseModel().getLineAtOffset(n.mapOffset(a))}i[o]||(i[o]={}),i[o].html=this._firstLine+s+"",i[o].style||(i[o].style=r)}return i},c.prototype.getWidestAnnotation=function(){var e=this._view.getModel().getLineCount();return this.getAnnotations(e-1,e)[e-1]},c.prototype.setFirstLine=function(e){this._firstLine=void 0!==e?e:1},c.prototype._onTextModelChanged=function(e){var t=e.start,i=this._view.getModel(),n=i.getBaseModel?i.getBaseModel().getLineCount():i.getLineCount(),o=(this._firstLine+n-1+"").length;if(this._numOfDigits!==o){this._numOfDigits=o;var r=i.getLineAtOffset(t);this._view.redrawLines(r,i.getLineCount(),this)}},d.prototype=new l,h.prototype=new l,h.prototype.getRulerStyle=function(){var e={style:{lineHeight:"1px",fontSize:"1px"}};return e=this._mergeStyle(e,this._rulerStyle)},h.prototype._getTooltipContents=function(t,i){if(i&&0===i.length){var n=this._view.getModel(),o=t;if(n.getBaseModel){var r=n.getLineStart(o);o=n.getBaseModel().getLineAtOffset(n.mapOffset(r))}return s.formatMessage(e.line,o+1)}return l.prototype._getTooltipContents.call(this,t,i)},h.prototype._mergeAnnotation=function(e,t,i,n){if(0!==i)return void 0;var o=e;if(!o){var r=3*n;o={html:"&nbsp;",style:{style:{height:r+"px"}}},o.style=this._mergeStyle(o.style,t.overviewStyle)}return o},u.prototype=new d,u.prototype.onClick=function(e){if(void 0!==e){var t=this._annotationModel;if(t){var i=this._view,o=i.getModel(),r=o.getLineStart(e),s=o.getLineEnd(e,!0);o.getBaseModel&&(r=o.mapOffset(r),s=o.mapOffset(s),o=o.getBaseModel());for(var a,l=t.getAnnotations(r,s);!a&&l.hasNext();){var c=l.next();this.isAnnotationTypeVisible(c.type)&&o.getLineAtOffset(c.start)===o.getLineAtOffset(r)&&(a=c)}if(a){var d=n.Tooltip.getTooltip(this._view);d&&d.hide(),a.expanded?a.collapse():a.expand()}}}},u.prototype._getTooltipContents=function(e,t){if(t&&t.length>0){var i=this._view,n=i.getModel(),o=n.getLineStart(e);n.getBaseModel&&(o=n.mapOffset(o),n=n.getBaseModel());for(var r=n.getLineAtOffset(o),s=0;s<t.length;s++){var a=t[s];if(this.isAnnotationTypeVisible(a.type)&&n.getLineAtOffset(a.start)===r){if(t[s].expanded)break;return d.prototype._getTooltipContents.call(this,e,[a])}}}return null},u.prototype._onAnnotationModelChanged=function(e){function t(e){for(n=0;n<e.length;n++)if(r.isAnnotationTypeVisible(e[n].type)){var t=e[n].start;o.getBaseModel&&(t=o.mapOffset(t,!0)),-1!==t&&(a=Math.min(a,o.getLineAtOffset(t)))}}if(e.textModelChangedEvent)return void d.prototype._onAnnotationModelChanged.call(this,e);var i=this._view;if(i){var n,o=i.getModel(),r=this,s=o.getLineCount(),a=s;t(e.added),t(e.removed),t(e.changed);var l=i.getRulers();for(n=0;n<l.length;n++)i.redrawLines(a,s,l[n])}};var p=function(e,t){a.call(this,e,"fixed",t)};return p.prototype=o.mixin(new a,{setView:function(e){this._destroy(),a.prototype.setView.call(this,e),this._create()},_create:function(){function e(e){var t="textviewZoom",i=e.themeClass;return i?(i=i.replace(t,""),i&&(i=" "+i),i=t+i):i=t,e.themeClass=i,e.noScroll=!0,e.readonly=!0,e}function i(e,t){var i=e.y*t.zoomFactor,n=t.clientHeight*t.zoomFactor;y.top=i,y.bottom=i+n,i=g.convert({y:i},"document","page").y,i-=y.node.getBoundingClientRect().top,v.style.top=i+"px",v.style.height=n-_+"px"}function n(){var e=p._metrics.viewPadding,t=p._metrics.viewPadding,i=p.getLineHeight(),n=g.getLineHeight(),o=p.getModel().getLineCount(),r=p._lineHeight?p._scrollHeight:o*i,s=g._lineHeight?g._scrollHeight:o*n,a=s/r,l=p.getClientArea().height+e.top+e.bottom,c=g.getClientArea().height+t.top+t.bottom,d=l*a,h=p._metrics.scrollWidth;return{zoomFactor:a,documentHeight:r,zoomDocumentHeight:s,clientHeight:l,zoomClientHeight:c,scrollWidth:h,windowHeight:d,padding:e}}function o(e,t){return e.y*(t.zoomFactor+(t.windowHeight-t.clientHeight-t.scrollWidth)/t.documentHeight)}function a(e){e=e||{y:p.getTopPixel()};var t=n(),r=o(e,t);g.setTopPixel(r),i(e,t)}function l(e){var t;if(e.wrapMode&&!e.wrapOffset&&p._metrics.charWidth){var i=s.createElement(m,"div");i.style.position="fixed",i.style.left="-1000px",g._clientDiv.appendChild(i),i.textContent=new Array(Math.ceil(p.getClientArea().width/p._metrics.charWidth)+1).join("a");var n=i.getBoundingClientRect();t=Math.min(150,Math.ceil(n.right-n.left))+"px"}else t="";var o=y.node.style.width;return y.node.style.width=t,o!==t}function c(e,t,i){if(i||y.top<=e.y&&e.y<=y.bottom)y.mouseDown=!0,y.delta=t-v.getBoundingClientRect().top+y.node.getBoundingClientRect().top;else{var n=g.getOffsetAtLocation(e.x,e.y);p.setSelection(n,n,.5,function(){})}}function d(){y.mouseDown=!1}function h(e){if(y.mouseDown){var t=n(),i=Math.min(t.zoomClientHeight-t.windowHeight,Math.max(0,e-y.delta));p.setTopPixel(i*(t.documentHeight-t.clientHeight)/Math.min(t.zoomDocumentHeight,t.zoomClientHeight-t.windowHeight))}}function u(e){e.preventDefault()}var p=this.getView();if(p){var f=e(p.getOptions());f.parent=this.node;var g=this._zoomView=new t.TextView(f);g._clientDiv.contentEditable=!1,g.setModel(p.getModel());var m=p.getOptions("parent").ownerDocument,v=this._windowDiv=s.createElement(m,"div");v.className="rulerZoomWindow",this.node.appendChild(v);var _=parseInt(r.getNodeStyle(v,"border-top-width",0))+parseInt(r.getNodeStyle(v,"border-bottom-width",0)),y=this;p.addEventListener("Scroll",this._scrollListener=function(e){a(e.newValue)}),p.addEventListener("Resize",this._resizeListener=function(){l(g.getOptions()),a()}),p.addEventListener("Redraw",this._redrawListener=function(e){e.ruler||g.redrawLines(e.startLine,e.endLine)}),p.addEventListener("Options",this._optionsListener=function(t){var i=e(t.options);g.setOptions(i),l(g.getOptions())}),g.addEventListener("LineStyle",this._lineListener=function(e){p.onLineStyle(e)}),s.isIOS||s.isAndroid?(v.addEventListener("touchstart",function(e){var t=e.touches;1===t.length&&(c(e,e.touches[0].clientY,!0),e.preventDefault())}),v.addEventListener("touchend",function(e){var t=e.touches;0===t.length&&d(e)}),v.addEventListener("touchmove",function(e){var t=e.touches;1===t.length&&h(e.touches[0].clientY)}),g.addEventListener("TouchStart",function(e){1===e.touchCount&&(c(e,e.event.touches[0].clientY),u(e))})):(v.style.pointerEvents="none",g.addEventListener("MouseDown",function(e){var t=e.event;(t.which?0===t.button:1===t.button)&&c(e,t.clientY),u(e)}),g.addEventListener("MouseUp",function(e){d(e),u(e)}),g.addEventListener("MouseMove",function(e){h(e.event.clientY),u(e)})),(m.defaultView||m.parentWindow).setTimeout(function(){a()},0)}},_destroy:function(){var e=this.getView();e&&(e.removeEventListener("Scroll",this._scrollListener),this._scrollListener=null,e.removeEventListener("Resize",this._resizeListener),this._resizeListener=null,e.removeEventListener("Redraw",this._redrawListener),this._redrawListener=null,e.removeEventListener("Options",this._optionsListener),this._optionsListener=null);var t=this._zoomView;t&&(t.removeEventListener("LineStyle",this._lineListener),t.setModel(null),t.destroy(),this._zoomView=null)}}),{BaseRuler:a,Ruler:l,AnnotationRuler:d,LineNumberRuler:c,OverviewRuler:h,FoldingRuler:u,ZoomRuler:p}}),define("orion/editor/textDND",["orion/util"],function(e){function t(e,t){this._view=e,this._undoStack=t,this._dragSelection=null,this._dropOffset=-1,this._dropText=null;var i=this;this._listener={onDragStart:function(e){i._onDragStart(e)},onDragEnd:function(e){i._onDragEnd(e)},onDragEnter:function(e){i._onDragEnter(e)},onDragOver:function(e){i._onDragOver(e)},onDrop:function(e){i._onDrop(e)},onDestroy:function(e){i._onDestroy(e)}},e.addEventListener("DragStart",this._listener.onDragStart),e.addEventListener("DragEnd",this._listener.onDragEnd),e.addEventListener("DragEnter",this._listener.onDragEnter),e.addEventListener("DragOver",this._listener.onDragOver),e.addEventListener("Drop",this._listener.onDrop),e.addEventListener("Destroy",this._listener.onDestroy)}return t.prototype={destroy:function(){var e=this._view;e&&(e.removeEventListener("DragStart",this._listener.onDragStart),e.removeEventListener("DragEnd",this._listener.onDragEnd),e.removeEventListener("DragEnter",this._listener.onDragEnter),e.removeEventListener("DragOver",this._listener.onDragOver),e.removeEventListener("Drop",this._listener.onDrop),e.removeEventListener("Destroy",this._listener.onDestroy),this._view=null)},_onDestroy:function(){this.destroy()},_onDragStart:function(e){var t=this._view,i=t.getSelectionText();i&&(this._dragSelection=t.getSelections(),e.event.dataTransfer.effectAllowed="copyMove",e.event.dataTransfer.setData("Text",i))},_onDragEnd:function(t){if(this._dragSelection){var i=this._view,n=t.event.dataTransfer.dropEffect;e.isFirefox||("none"!==n||this._dropText)&&(n=t.event.dataTransfer.dropEffect=this._dropEffect),this._undoStack&&this._undoStack.startCompoundChange();var o="move"===n;if(o&&i.setText({text:"",selection:this._dragSelection}),this._dropText){var r=this._dropText,s=this._dropOffset;o&&this._dragSelection.forEach(function(e){s>=e.end?s-=e.end-e.start:s>=e.start&&(s=e.start)}),i.setText(r,s,s),i.setSelection(s,s+r.length),this._dropText=null,this._dropOffset=-1}this._undoStack&&this._undoStack.endCompoundChange(),this._dragSelection=null}},_onDragEnter:function(e){this._onDragOver(e)},_onDragOver:function(t){var i=t.event.dataTransfer.types,n=!this._view.getOptions("readonly");if(n&&i&&(n=i.contains?i.contains("text/plain")||i.contains("Text"):-1!==i.indexOf("text/plain")||-1!==i.indexOf("Text")),n){if(!e.isFirefox){var o=e.isMac?t.event.altKey:t.event.ctrlKey;this._dropEffect=t.event.dataTransfer.dropEffect=o?"copy":"move"}}else t.event.dataTransfer.dropEffect="none"},_onDrop:function(t){var i=this._view,n=t.event.dataTransfer.getData("Text");if(n){e.isFirefox||(t.event.dataTransfer.dropEffect=this._dropEffect);var o=i.getOffsetAtLocation(t.x,t.y);this._dragSelection?(this._dropOffset=o,this._dropText=n):(i.setText(n,o,o),i.setSelection(o,o+n.length))}}},{TextDND:t}}),define("orion/editor/linkedMode",["i18n!orion/editor/nls/messages","orion/keyBinding","orion/editor/keyModes","orion/editor/annotations","orion/objects","orion/util"],function(e,t,i,n,o){function r(e){this._data=e}function s(e,t,n){var o=e.getTextView();i.KeyMode.call(this,o),this.editor=e,this.undoStack=t,this.contentAssist=n,this.linkedModeModel=null,o.setAction("linkedModeEnter",function(){return this.exitLinkedMode(!0),!0}.bind(this)),o.setAction("linkedModeCancel",function(){return this.exitLinkedMode(!1),!0}.bind(this)),o.setAction("linkedModeNextGroup",function(){var e=this.linkedModeModel;return this.selectLinkedGroup((e.selectedGroupIndex+1)%e.groups.length),!0}.bind(this)),o.setAction("linkedModePreviousGroup",function(){var e=this.linkedModeModel;return this.selectLinkedGroup(e.selectedGroupIndex>0?e.selectedGroupIndex-1:e.groups.length-1),!0}.bind(this)),this.linkedModeListener={onActivating:function(){this._groupContentAssistProvider&&(this.contentAssist.setProviders([this._groupContentAssistProvider]),this.contentAssist.setProgress(null))}.bind(this),onModelChanged:function(e){if(!this.ignoreVerify){for(var t,i,n=this.editor.mapOffset(e.start),o=this.linkedModeModel;o&&(t=this._getPositionChanged(o,n,n+e.removedCharCount),i=t.position,void 0===i||i.model!==o);)this.exitLinkedMode(!1),o=this.linkedModeModel;if(o){for(var r,s,a=0,l=e.addedCharCount-e.removedCharCount,c=t.positions,d=0;d<c.length;++d){s=c[d],r=s.position;var h=r.offset<=n&&n<=r.offset+r.length;h&&!s.ansestor?(r.offset+=a,r.length+=l,a+=l):(r.offset+=a,s.ansestor&&h&&(r.length+=l)),s.escape&&(s.model.escapePosition=r.offset)}this._updateAnnotations(c)}}}.bind(this),onVerify:function(e){if(!this.ignoreVerify){for(var t,i,n=this.editor,o=n.mapOffset(e.start),r=this.editor.mapOffset(e.end),s=this.linkedModeModel;s&&(t=this._getPositionChanged(s,o,r),i=t.position,void 0===i||i.model!==s);)this.exitLinkedMode(!1),s=this.linkedModeModel;if(s){var a=this._compoundChange;a?(a.owner.model!==s||a.owner.group!==i.group)&&(this.endUndo(),this.startUndo()):this.startUndo(),s.selectedGroupIndex=i.group;for(var l,c,d=0,h=e.text.length-(r-o),u=t.positions,p=o-i.position.offset,f=r-i.position.offset,g=0;g<u.length;++g)c=u[g],l=c.position,c.oldOffset=l.offset,c.model===s&&c.group===i.group?(l.offset+=d,l.length+=h,d+=h):(l.offset+=d,c.ansestor&&(l.length+=i.count*h)),c.escape&&(c.model.escapePosition=l.offset);for(this.ignoreVerify=!0,g=u.length-1;g>=0;g--)c=u[g],c.model===s&&c.group===i.group&&n.setText(e.text,c.oldOffset+p,c.oldOffset+f,!1);this.ignoreVerify=!1,e.text=null,this._updateAnnotations(u)}}}.bind(this)}}var a={};return r.prototype={chop:function(e,t){return t.substring(e.length)},computeProposals:function(e,t,i){var n=i.prefix,o=[],r=this._data.style?this._data.style:null;r=r?r:"emphasis";for(var s=this._data.values,a=0;a<s.length;a++){var l=s[a];"string"==typeof l&&0===l.indexOf(n)?o.push({proposal:this.chop(n,l),description:l,hover:l,style:r}):"object"==typeof l&&l.proposal&&o.push({proposal:this.chop(n,l.proposal),description:l.description?l.description:l.proposal,hover:l.hover?l.hover:l.proposal,style:r})}var c=this._data.title?this._data.title:null;return 0<o.length&&o.splice(0,0,{proposal:"",description:c?c:"Options",style:"noemphasis_title",unselectable:!0}),o}},s.prototype=new i.KeyMode,o.mixin(s.prototype,{createKeyBindings:function(){var e=t.KeyBinding,i=[];return i.push({actionID:"linkedModeEnter",keyBinding:new e(13)}),i.push({actionID:"linkedModeCancel",keyBinding:new e(27)}),i.push({actionID:"linkedModeNextGroup",keyBinding:new e(9)}),i.push({actionID:"linkedModePreviousGroup",keyBinding:new e(9,!1,!0)}),i},enterLinkedMode:function(t){if(!this.linkedModeModel){var i=this.editor.getTextView();i.addKeyMode(this),i.addEventListener("Verify",this.linkedModeListener.onVerify),i.addEventListener("ModelChanged",this.linkedModeListener.onModelChanged);var n=this.contentAssist;n.addEventListener("Activating",this.linkedModeListener.onActivating),this.editor.reportStatus(e.linkedModeEntered,null,!0)}this._sortedPositions=null,this.linkedModeModel&&(t.previousModel=this.linkedModeModel,t.parentGroup=this.linkedModeModel.selectedGroupIndex,this.linkedModeModel.nextModel=t),this.linkedModeModel=t,this.selectLinkedGroup(0)},exitLinkedMode:function(t){if(this.isActive()){this._compoundChange&&(this.endUndo(),this._compoundChange=null),this._sortedPositions=null;var i=this.linkedModeModel;if(this.linkedModeModel=i.previousModel,i.parentGroup=i.previousModel=void 0,this.linkedModeModel&&(this.linkedModeModel.nextModel=void 0),!this.linkedModeModel){var n=this.editor,o=n.getTextView();o.removeKeyMode(this),o.removeEventListener("Verify",this.linkedModeListener.onVerify),o.removeEventListener("ModelChanged",this.linkedModeListener.onModelChanged);var r=this.contentAssist;r.removeEventListener("Activating",this.linkedModeListener.onActivating),r.offset=void 0,this.editor.reportStatus(e.linkedModeExited,null,!0),t&&"number"==typeof i.escapePosition&&n.setCaretOffset(i.escapePosition,!1)}this.selectLinkedGroup(0)}},startUndo:function(){if(this.undoStack){var e=this,t=this.linkedModeModel;this._compoundChange=this.undoStack.startCompoundChange({model:t,group:t.selectedGroupIndex,end:function(){e._compoundChange=null}})}},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},isActive:function(){return!!this.linkedModeModel},isStatusActive:function(){return!!this.linkedModeModel},selectLinkedGroup:function(e){var t=this.linkedModeModel;if(t){t.selectedGroupIndex=e;var i=t.groups[e],n=i.positions[0],o=this.editor;o.setSelection(n.offset,n.offset+n.length);var s=this.contentAssist;if(s)if(s.offset=void 0,i.data&&"link"===i.data.type&&i.data.values){var a=this._groupContentAssistProvider=new r(i.data);a.getPrefix=function(){var e=o.getSelection();if(e.start===e.end){var t=o.getCaretOffset();if(n.offset<=t&&t<=n.offset+n.length)return o.getText(n.offset,t)}return""},s.offset=n.offset,s.deactivate(),s.activate()}else this._groupContentAssistProvider&&(this._groupContentAssistProvider=null,s.deactivate())}this._updateAnnotations()},_getModelPositions:function(e,t,i){for(var n=t.groups,o=0;o<n.length;o++)for(var r=n[o].positions,s=0;s<r.length;s++){var a=r[s];i&&(a={offset:a.offset+i,length:a.length});var l={index:s,group:o,count:r.length,model:t,position:a};e.push(l),t.nextModel&&t.nextModel.parentGroup===o&&(l.ansestor=!0,this._getModelPositions(e,t.nextModel,(i||0)+r[s].offset-r[0].offset))}},_getSortedPositions:function(e){var t=this._sortedPositions;if(!t){for(t=[];e.previousModel;)e=e.previousModel;for(this._getModelPositions(t,e);e;)"number"==typeof e.escapePosition&&t.push({escape:!0,model:e,position:{offset:e.escapePosition,length:0}}),e=e.nextModel;t.sort(function(e,t){return e.position.offset-t.position.offset}),this._sortedPositions=t}return t},_getPositionChanged:function(e,t,i){for(var n,o=this._getSortedPositions(e),r=o.length-1;r>=0;r--)if(!o[r].escape){var s=o[r].position;if(s.offset<=t&&i<=s.offset+s.length){n=o[r];break}}return{position:n,positions:o}},_updateAnnotations:function(e){var t=this.editor.getAnnotationModel();if(t){for(var i,o=[],r=[],s=t.getAnnotations();s.hasNext();)switch(i=s.next(),i.type){case n.AnnotationType.ANNOTATION_LINKED_GROUP:case n.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP:case n.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:o.push(i)
}var a=this.linkedModeModel;if(a){e=e||this._getSortedPositions(a);for(var l=0;l<e.length;l++){var c=e[l];if(c.model===a&&!c.escape){var d=n.AnnotationType.ANNOTATION_LINKED_GROUP;c.group===a.selectedGroupIndex&&(d=0===c.index?n.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:n.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP),c=c.position,i=n.AnnotationType.createAnnotation(d,c.offset,c.offset+c.length,""),r.push(i)}}}t.replaceAnnotations(o,r)}}}),a.LinkedMode=s,a}),define("orion/editor/factories",["orion/editor/actions","orion/editor/undoStack","orion/editor/rulers","orion/editor/annotations","orion/editor/textDND","orion/editor/linkedMode","orion/util"],function(e,t,i,n,o,r,s){function a(){}function l(){}function c(){}function d(){}function h(){}function u(){}function p(){}var f={};return a.prototype={createKeyBindings:function(t,i,n,o){var s=new e.TextActions(t,i,o),a=new r.LinkedMode(t,i,n),l=new e.SourceCodeActions(t,i,n,a);return{textActions:s,linkedMode:a,sourceCodeActions:l}}},f.KeyBindingsFactory=a,l.prototype={createUndoStack:function(e){var i=e.getTextView();return new t.UndoStack(i,200)}},f.UndoFactory=l,c.prototype={createLineNumberRuler:function(e){return new i.LineNumberRuler(e,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}},f.LineNumberRulerFactory=c,d.prototype={createFoldingRuler:function(e){return new i.FoldingRuler(e,"left",{styleClass:"ruler folding"})}},f.FoldingRulerFactory=d,h.prototype={createZoomRuler:function(){return new i.ZoomRuler(s.isIOS||s.isAndroid?"right":"innerRight",{styleClass:"ruler zoom"})}},f.ZoomRulerFactory=h,u.prototype={createAnnotationModel:function(e){return new n.AnnotationModel(e)},createAnnotationStyler:function(e,t){return new n.AnnotationStyler(e,t)},createAnnotationRulers:function(e){var t=new i.AnnotationRuler(e,"left",{styleClass:"ruler annotations"}),n=new i.OverviewRuler(e,"right",{styleClass:"ruler overview"});return{annotationRuler:t,overviewRuler:n}}},f.AnnotationFactory=u,p.prototype={createTextDND:function(e,t){return new o.TextDND(e.getTextView(),t)}},f.TextDNDFactory=p,f}),define("orion/editor/editorFeatures",["orion/editor/factories","orion/editor/actions","orion/editor/linkedMode","orion/objects"],function(e,t,i,n){return n.mixin({},e,t,i)}),define("text!orion/compare/sideBySideTemplate.html",[],function(){return'<div id="topWidget_id" style="height:100%;width:100%;position:relative">\r\n	<div class="leftPanelLayout ">\r\n		<div class="titleActionContainer">\r\n			<div class="compareActionContainer" id="left_action_id"></div>\r\n			<div class="titleContainer" id="left_title_id"></div>\r\n		</div>\r\n		<div class="compareEditorParent" id="left_editor_id"></div>\r\n		<div class="statusContainer" id="left_status_id"></div>\r\n	</div>\r\n	<div class="split compareSplitLayout"></div>\r\n	<div class="rightPanelLayout">\r\n		<div class="titleActionContainer">\r\n			<div class="compareActionContainer" id="right_action_id"></div>\r\n			<div class="titleContainer" id="right_title_id"></div>\r\n		</div>\r\n		<div class="compareEditorParent"  id="right_editor_wrapper_id">\r\n			<div class="canvasContainer">\r\n				<canvas id="diff_canvas_id" class="compareCanvas" width="46" height="3000"></canvas>\r\n			</div>\r\n			<div class="compareEditorParentWithCanvas" id="right_editor_id"></div>\r\n		</div>\r\n		<div class="statusContainer" id="right_status_id"></div>\r\n	</div>\r\n</div>\r\n'}),define("orion/compare/compareUIFactory",["orion/webui/littlelib","orion/webui/splitter","text!orion/compare/sideBySideTemplate.html"],function(e,t,i){var n=n||{};return n.TwoWayCompareUIFactory=function(){function n(e){this._parentDivID=e.parentDivID,this._commandSpanId=e.commandSpanId,this._showTitle=e.showTitle,this._leftTitle=e.leftTitle,this._rightTitle=e.rightTitle,this._showLineStatus=e.showLineStatus}return n.prototype={_init:function(){var t=this._parentDivID+"_";this._topWidgetDiv=e.node("topWidget_id"),this._topWidgetDiv.id=t+"topWidget_id",this._leftEditorParentDiv=e.node("left_editor_id"),this._leftEditorParentDiv.id=t+"left_editor_id",this._rightEditorParentDiv=e.node("right_editor_id"),this._rightEditorParentDiv.id=t+"right_editor_id",this._rightEditorWrapperDiv=e.node("right_editor_wrapper_id"),this._rightEditorWrapperDiv.id=t+"right_editor_wrapper_id",this._leftActionDiv=e.node("left_action_id"),this._leftActionDiv.id=t+"left_action_id",this._rightActionDiv=e.node("right_action_id"),this._rightActionDiv.id=t+"right_action_id",this._leftTitleDiv=e.node("left_title_id"),this._leftTitleDiv.id=t+"left_title_id",this._rightTitleDiv=e.node("right_title_id"),this._rightTitleDiv.id=t+"right_title_id",this._leftStatusDiv=e.node("left_status_id"),this._leftStatusDiv.id=t+"left_status_id",this._rightStatusDiv=e.node("right_status_id"),this._rightStatusDiv.id=t+"right_status_id",this._diffCanvasDiv=e.node("diff_canvas_id"),this._diffCanvasDiv.id=t+"diff_canvas_id",this._splitterId=t+"orion_splitter",this._showTitle||this.disableTitle(),this._showLineStatus||this.disableLineStatus()},_createSplitter:function(){var i=e.$(".split",this._topWidgetDiv);i.id=this._splitterId;var n=e.$(".leftPanelLayout",this._topWidgetDiv),o=e.$(".rightPanelLayout",this._topWidgetDiv);i&&n&&o&&(this._splitter=new t.Splitter({node:i,sidePanel:n,mainPanel:o,proportional:!0}))},buildUI:function(){e.node(this._parentDivID).innerHTML=i,this._init(),this._createSplitter()},destroy:function(){},getSplitter:function(){return this._splitter},isLeftPane:function(t){var i=e.$(".leftPanelLayout",this._topWidgetDiv);return i===t},getEditorParentDiv:function(e){return e?this._leftEditorParentDiv:this._rightEditorParentDiv},getTitleDiv:function(e){return e?this._leftTitleDiv:this._rightTitleDiv},getActionDivId:function(e){return e?this._leftActionDiv.id:this._rightActionDiv.id},getStatusDiv:function(e){return e?this._leftStatusDiv:this._rightStatusDiv},getCommandSpanId:function(){return this._commandSpanId},getDiffCanvasDiv:function(){return this._diffCanvasDiv},disableTitle:function(){this._leftEditorParentDiv.style.top="0px",this._rightEditorWrapperDiv.style.top="0px",this._leftTitleDiv.style.height="0px",this._rightTitleDiv.style.height="0px"},disableLineStatus:function(){this._leftEditorParentDiv.style.marginBottom="0px",this._rightEditorWrapperDiv.style.marginBottom="0px",this._leftStatusDiv.style.height="0px",this._rightStatusDiv.style.height="0px"}},n}(),n});var JsDiff=function(){function e(e){return{newPos:e.newPos,components:e.components.slice(0)}}function t(e){for(var t=[],i=0;i<e.length;i++)e[i]&&t.push(e[i]);return t}function i(e){var t=e;return t=t.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/"/g,"&quot;")}var n=function(e){this.ignoreWhitespace=e};n.prototype={diff:function(t,i,n){if(this.ignoreWhitespace=n,i===t)return[{value:i}];if(!i)return[{value:t,removed:!0}];if(!t)return[{value:i,added:!0}];i=this.tokenize(i),t=this.tokenize(t);var o=i.length,r=t.length,s=o+r,a=[{newPos:-1,components:[]}],l=this.extractCommon(a[0],i,t,0);if(a[0].newPos+1>=o&&l+1>=r)return a[0].components;for(var c=1;s>=c;c++)for(var d=-1*c;c>=d;d+=2){var h,u=a[d-1],p=a[d+1];l=(p?p.newPos:0)-d,u&&(a[d-1]=void 0);var f=u&&u.newPos+1<o,g=p&&l>=0&&r>l;if(f||g){!f||g&&u.newPos<p.newPos?(h=e(p),this.pushComponent(h.components,t[l],"",void 0,!0)):(h=e(u),h.newPos++,this.pushComponent(h.components,i[h.newPos],"",!0,void 0));var l=this.extractCommon(h,i,t,d);if(h.newPos+1>=o&&l+1>=r)return h.components;a[d]=h}else a[d]=void 0}},pushComponent:function(e,t,i,n,o){var r=e[e.length-1];r&&r.added===n&&r.removed===o?e[e.length-1]={value:this.join(r.value,t),helperValue:this.join(r.helperValue,i),added:n,removed:o}:e.push({value:t,helperValue:i,added:n,removed:o})},extractCommon:function(e,t,i,n){for(var o=t.length,r=i.length,s=e.newPos,a=s-n;o>s+1&&r>a+1&&this.equals(t[s+1],i[a+1]);)s++,a++,this.pushComponent(e.components,t[s],i[a],void 0,void 0);return e.newPos=s,a},equals:function(e,t){var i=/\S/;return!this.ignoreWhitespace||i.test(e)||i.test(t)?this._equals(e,t):!0},join:function(e,t){return e+t},tokenize:function(e){return e}};var o=new n;o._equals=function(e,t){return e===t};var r=new n(!1);r.tokenize=function(e){return t(e.split(/(\s+|\b)/))},r._equals=function(e,t){return e===t};var s=new n(!0);s.tokenize=function(e){return t(e.split(/([{}:;,]|\s+)/))},s._equals=function(e,t){return e===t};var a=new n;return a.tokenize=function(e){var t=e.split(/^/m);return t&&t.length>0&&!t[t.length-1]&&t.pop(),t},a._equals=function(e,t){if(this.ignoreWhitespace){var i=e.replace(/^\s+|\s+$|\s+(?=\s)/g,""),n=t.replace(/^\s+|\s+$|\s+(?=\s)/g,"");return i===n}return e===t},{diffChars:function(e,t,i){return o.diff(e,t,i)},diffWords:function(e,t,i){return r.diff(e,t,i)},diffLines:function(e,t,i){return a.diff(e,t,i)},diffCss:function(e,t){return s.diff(e,t)},createPatch:function(e,t,i,n,o){var r=[];r.push("Index: "+e),r.push("==================================================================="),r.push("--- "+e+"	"+n),r.push("+++ "+e+"	"+o);var s=a.diff(t,i);s.push({value:"",lines:[]});for(var l=0,c=0,d=[],h=1,u=1,p=0;p<s.length;p++){var f=s[p],g=f.lines||f.value.replace(/\n$/,"").split("\n");if(f.lines=g,f.added||f.removed){if(!l){var m=s[p-1];l=h,c=u,m&&(d.push.apply(d,m.lines.slice(-4).map(function(e){return" "+e})),l-=4,c-=4)}d.push.apply(d,g.map(function(e){return(f.added?"+":"-")+e})),f.added?u+=g.length:h+=g.length}else{if(l)if(g.length<=8&&p<s.length-1)d.push.apply(d,g.map(function(e){return" "+e}));else{var v=Math.min(g.length,4);r.push("@@ -"+l+","+(h-l+v)+" +"+c+","+(u-c+v)+" @@"),r.push.apply(r,d),r.push.apply(r,g.slice(0,v).map(function(e){return" "+e})),l=0,c=0,d=[]}h+=g.length,u+=g.length}}return s.length>1&&!/\n$/.test(s[s.length-2].value)&&r.push("\\ No newline at end of file\n"),r.join("\n")},convertChangesToXML:function(e){for(var t=[],n=0;n<e.length;n++){var o=e[n];o.added?t.push("<ins>"):o.removed&&t.push("<del>"),t.push(i(o.value)),o.added?t.push("</ins>"):o.removed&&t.push("</del>")}return t.join("")}}}();"undefined"!=typeof module&&(module.exports=JsDiff),"function"==typeof define&&define.amd&&define("jsdiff/diff",[],function(){return JsDiff}),define("orion/compare/jsdiffAdapter",["jsdiff/diff"],function(e){var t=t||{};return t.JSDiffAdapter=function(){function t(e){this._ignoreWhitespace=e}return t.prototype={_specialLine:function(e,t,i){return t.value===e&&i!==e},adapt:function(t,i,n){n||(n="\n");for(var o=t.split(n),r=i.split(n),s=""===o[o.length-1],a=""===r[r.length-1],l=e.diffLines(t,i,this._ignoreWhitespace),c=[],d=[],h=0,u=0,p=-1,f=0,g=!0,m=n,v=0;v<l.length;v++){var _=l[v],y=_.lines||_.value.split(n),C=y.length,w=0;if(y.length>1&&""===y[y.length-1]&&C--,C>1&&!g&&""===y[0]&&(C--,w++),_.lines=y,_.added||_.removed)if(_.added){-1===p&&(p=d.length+1),h+=C;for(var b=w;C+w>b;b++)d.push(_.lines[b])}else u+=C;else this._specialLine(n,_,m)||((h||u)&&(c.push([h,u,p]),h=0,u=0,p=-1,f+=u),c.push([C,C,0]),f+=C);g=!1,y.length>1&&""===y[y.length-1]&&(g=!0),m=_.value?_.value[_.value.length-1]:n}if((h||u)&&(c.push([h,u,p]),f+=u),f<o.length&&o.length>1){var S=c[c.length-1];0===S[2]?(S[0]+=1,S[1]+=1):-1===S[2]?c.push([1,1,0]):s===a?c.push([1,1,0]):(a&&(S[0]+=1),s&&(S[1]+=1))}return{mapper:c,changContents:{array:d,index:0}}},adaptCharDiff:function(t,i,n){for(var o=n?e.diffWords(t,i,this._ignoreWhitespace):e.diffChars(t,i,this._ignoreWhitespace),r=[],s=0,a=0,l=0,c=0,d=0;d<o.length;d++){var h=o[d];h.added||h.removed?h.added?l+=h.value.length:c+=h.value.length:((l>0||c>0)&&(r.push([a,a+l,s,s+c]),a+=l,s+=c,l=0,c=0),a+=h.value.length,s+=h.helperValue?h.helperValue.length:h.value.length)}return(l>0||c>0)&&r.push([a,a+l,s,s+c]),r}},t}(),t}),define("orion/compare/diffTreeNavigator",["i18n!orion/compare/nls/messages","orion/treeModelIterator","orion/compare/compareUtils","orion/editor/annotations","orion/compare/jsdiffAdapter"],function(e,t,i,n,o){var r={},s={};return r.DiffTreeNavigator=function(){function r(e,t,i,n,o,r){this._root={type:"root",children:[]},this._initialized=!1,this.initAll(e,t,i,n,o,r)}s.ANNO_DIFF_ADDED_BLOCK="orion.annotation.diff.addedBlock",s.ANNO_DIFF_CURRENT_ADDED_BLOCK="orion.annotation.diff.currentAddedBlock",s.ANNO_DIFF_DELETED_BLOCK="orion.annotation.diff.deletedBlock",s.ANNO_DIFF_CURRENT_DELETED_BLOCK="orion.annotation.diff.currentDeletedBlock",s.ANNO_DIFF_BLOCK_TOPONLY="orion.annotation.diff.blockTop",s.ANNO_DIFF_CURRENT_BLOCK_TOPONLY="orion.annotation.diff.currentBlockTop",s.ANNO_DIFF_BLOCK_CONFLICT="orion.annotation.diff.blockConflict",s.ANNO_DIFF_CURRENT_BLOCK_CONFLICT="orion.annotation.diff.currentBlockConflict",s.ANNO_DIFF_ADDED_WORD="orion.annotation.diff.addedWord",s.ANNO_DIFF_CURRENT_ADDED_WORD="orion.annotation.diff.currentAddedWord",s.ANNO_DIFF_DELETED_WORD="orion.annotation.diff.deletedWord",s.ANNO_DIFF_CURRENT_DELETED_WORD="orion.annotation.diff.currentDeletedWord",s.ANNO_DIFF_EMPTY_DELETED_WORD_LEFT="orion.annotation.diff.emptyDeletedWordLeft",s.ANNO_DIFF_EMPTY_DELETED_WORD_RIGHT="orion.annotation.diff.emptyDeletedWordRight",s.ANNO_DIFF_EMPTY_ADDED_WORD_LEFT="orion.annotation.diff.emptyAddedWordLeft",s.ANNO_DIFF_EMPTY_ADDED_WORD_RIGHT="orion.annotation.diff.emptyAddedWordRight",n.AnnotationType.registerType(s.ANNO_DIFF_ADDED_BLOCK,{title:"",html:"",lineStyle:{styleClass:"annotationLine addedBlockDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_CURRENT_ADDED_BLOCK,{title:"",html:"",lineStyle:{styleClass:"annotationLine currentAddedBlockDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_DELETED_BLOCK,{title:"",html:"",lineStyle:{styleClass:"annotationLine deletedBlockDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_CURRENT_DELETED_BLOCK,{title:"",html:"",lineStyle:{styleClass:"annotationLine currentDeletedBlockDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_BLOCK_TOPONLY,{title:"",html:"",lineStyle:{styleClass:"annotationLine blockDiffTopOnly"}}),n.AnnotationType.registerType(s.ANNO_DIFF_CURRENT_BLOCK_TOPONLY,{title:"",html:"",lineStyle:{styleClass:"annotationLine currentBlockDiffTopOnly"}}),n.AnnotationType.registerType(s.ANNO_DIFF_BLOCK_CONFLICT,{title:"",html:"",lineStyle:{styleClass:"annotationLine blockDiffConflict"}}),n.AnnotationType.registerType(s.ANNO_DIFF_CURRENT_BLOCK_CONFLICT,{title:"",html:"",lineStyle:{styleClass:"annotationLine currentBlockDiffConflict"}}),n.AnnotationType.registerType(s.ANNO_DIFF_ADDED_WORD,{title:e["word added"],html:"",rangeStyle:{styleClass:"annotationRange addedWordDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_CURRENT_ADDED_WORD,{title:"",html:"",rangeStyle:{styleClass:"annotationRange currentAddedWordDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_DELETED_WORD,{title:e["word deleted"],html:"",rangeStyle:{styleClass:"annotationRange deletedWordDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_CURRENT_DELETED_WORD,{title:"",html:"",rangeStyle:{styleClass:"annotationRange currentDeletedWordDiff"}}),n.AnnotationType.registerType(s.ANNO_DIFF_EMPTY_DELETED_WORD_LEFT,{title:"",html:"",rangeStyle:{styleClass:"annotationRange emptyDeletedWordDiffLeft"}}),n.AnnotationType.registerType(s.ANNO_DIFF_EMPTY_DELETED_WORD_RIGHT,{title:"",html:"",rangeStyle:{styleClass:"annotationRange emptyDeletedWordDiffRight"}}),n.AnnotationType.registerType(s.ANNO_DIFF_EMPTY_ADDED_WORD_LEFT,{title:"",html:"",rangeStyle:{styleClass:"annotationRange emptyAddedWordDiffLeft"}}),n.AnnotationType.registerType(s.ANNO_DIFF_EMPTY_ADDED_WORD_RIGHT,{title:"",html:"",rangeStyle:{styleClass:"annotationRange emptyAddedWordDiffRight"}});var a=5e3;return r.prototype={initAll:function(e,t,i,n,o,r,s){this._charOrWordDiff=e?e:"word",t&&(this._initialized=!0),this.editorWrapper=[{editor:t,diffFeeder:n},{editor:i,diffFeeder:o}],this._curveRuler=s,this._overviewRuler=r,this._overviewRuler&&this._overviewRuler.setDiffNavigator(this)},initMapper:function(e){if(e)for(var t=0;t<this.editorWrapper.length;t++)this.editorWrapper[t].diffFeeder.init(this.editorWrapper[t].editor.getTextView().getModel(),e)},destroy:function(){this.initAll(this._charOrWordDiff)},renderAnnotations:function(e){var i;for(i=0;i<this.editorWrapper.length;i++){this.editorWrapper[i].annoTypes=[],this.editorWrapper[i].diffFeeder.getBlockAnnoTypes(this.editorWrapper[i].annoTypes),this.editorWrapper[i].diffFeeder.getWordAnnoTypes(this.editorWrapper[i].annoTypes);for(var n=0;n<this.editorWrapper[i].annoTypes.length;n++)this.editorWrapper[i].annoTypes[n].current&&this.editorWrapper[i].editor.getAnnotationStyler().addAnnotationType(this.editorWrapper[i].annoTypes[n].current),this.editorWrapper[i].annoTypes[n].normal&&this.editorWrapper[i].editor.getAnnotationStyler().addAnnotationType(this.editorWrapper[i].annoTypes[n].normal)}this._root.children=[];var r=this.editorWrapper[0].diffFeeder.getDiffBlocks();if(!r||0===r.length)return this.replaceAllAnnotations(!0,0,"block",!1,[]),this.replaceAllAnnotations(!0,1,"block",!1,[]),this.replaceAllAnnotations(!0,0,"word",!1,[]),this.replaceAllAnnotations(!0,1,"word",!1,[]),this.replaceAllAnnotations(!0,0,"block",!0,[]),this.replaceAllAnnotations(!0,1,"block",!0,[]),this.replaceAllAnnotations(!0,0,"word",!0,[]),void this.replaceAllAnnotations(!0,1,"word",!0,[]);var s=new o.JSDiffAdapter(e);for(i=0;i<r.length;i++){var a=this.generatePairBlockAnnotations(this._root,i);this._root.children.push(a);var l=this.generatePairWordAnnotations(a,i,s);l&&(a.children=l)}this.replaceAllAnnotations(!1,0,"block",!0),this.replaceAllAnnotations(!1,1,"block",!0),this.replaceAllAnnotations(!1,0,"word",!0),this.replaceAllAnnotations(!1,1,"word",!0),this.iterator=new t.TreeModelIterator(this._root.children)},replaceAllAnnotations:function(e,t,i,n,o){if(this.editorWrapper[t].annoTypes)for(var r=0;r<this.editorWrapper[t].annoTypes.length;r++)this.editorWrapper[t].annoTypes[r].type===i&&this.replaceDiffAnnotations(this.editorWrapper[t].editor,o?o:this.editorWrapper[t].annoTypes[r].list,n?this.editorWrapper[t].annoTypes[r].normal:this.editorWrapper[t].annoTypes[r].current,e)},getMapper:function(){return this.editorWrapper[0].diffFeeder.getMapper()},getFeeder:function(e){return e?this.editorWrapper[1].diffFeeder:this.editorWrapper[0].diffFeeder},iterateOnBlock:function(e,t){this.iterator&&(this.iterator.iterateOnTop(e,t),this.updateCurrentAnnotation(!0))},iterateOnChange:function(e){if(!this.iterator)return null;var t=this.iterator.iterate(e);if(t){var i=this.iterator.cursor();"block"===i.type&&i.children&&i.children.length>0&&this.iterator.iterate(e),this.updateCurrentAnnotation(!0)}return t},gotoChangeUsingIndex:function(e){var t=0,i=0;if(e>=0)for(;i<this._root.children.length;){var n=this._root.children[i].children.length;if(!(e>t+n-1)){var o=e-t;return this.gotoBlock(i,o)}t+=n,i++}},gotoBlock:function(e,t){this.iterator&&((0>e||e>=this._root.children.length||0===this._root.children.length)&&(e=0),this.iterator.setCursor(void 0!==t&&t>=0&&this._root.children[e].children&&t<this._root.children[e].children.length?this._root.children[e].children[t]:this._root.children[e]),this.updateCurrentAnnotation(!1),this._positionDiffBlock())},_hitDiffAnnotation:function(e,t,i){if(i===this.editorWrapper[e].editor.getTextView()){for(var n=0;n<this._root.children.length;n++){var o=this._root.children[n],r=0===e?o.oldA:o.newA;if(t>=r.start&&t<=r.end){var s=o;if(o.children&&o.children.length>0)for(var a=0;a<o.children.length;a++){var l=o.children[a],c=0===e?l.oldA:l.newA;if(t>=c.start&&t<=c.end){s=l;break}}return s}}return null}},gotoChange:function(e,t){for(var i=0;i<this.editorWrapper.length;i++){var n=this._hitDiffAnnotation(i,e,t);if(n)return this.iterator.setCursor(n),this.updateCurrentAnnotation(!1,t),!0}return!1},getCurrentBlockIndex:function(){if(!this.iterator)return-1;var e=this.iterator.cursor();return e?"block"===e.type?e.index:e.parent.index:-1},getCurrentPosition:function(){if(!this.iterator)return{};var e=this.iterator.cursor();return e?"block"===e.type?{block:e.index+1}:{block:e.parent.index+1,change:e.index+1}:{}},getCurrentMapperIndex:function(){var e=this.getCurrentBlockIndex();0>e&&(e=0);var t=this.getFeeder().getDiffBlocks();return t&&0!==t.length?(e>t.length-1&&(e=0),t[e][1]):-1},replaceDiffAnnotations:function(e,t,i,n){if(t&&i){var o=e.getAnnotationModel();if(o){for(var r=o.getAnnotations(),s=[];n&&r.hasNext();){var a=r.next();a.type===i&&s.push(a)}o.replaceAnnotations(s,t)}}},updateCurrentAnnotation:function(e,t){if(this.replaceAllAnnotations(!0,0,"block",!1,[]),this.replaceAllAnnotations(!0,1,"block",!1,[]),this.replaceAllAnnotations(!0,0,"word",!1,[]),this.replaceAllAnnotations(!0,1,"word",!1,[]),this.iterator){var i=this.iterator.cursor();if(i){var o,r,s={start:i.oldA.start,end:i.oldA.end},a={start:i.newA.start,end:i.newA.end};"word"===i.type?(o=this.editorWrapper[0].diffFeeder.getCurrentWordAnnoType(s,this.editorWrapper[0].editor.getTextView().getModel()),r=this.editorWrapper[1].diffFeeder.getCurrentWordAnnoType(a,this.editorWrapper[1].editor.getTextView().getModel())):(o=this.editorWrapper[0].diffFeeder.getCurrentBlockAnnoType(i.index),r=this.editorWrapper[1].diffFeeder.getCurrentBlockAnnoType(i.index)),o&&this.replaceDiffAnnotations(this.editorWrapper[0].editor,[new(n.AnnotationType.getType(o.current))(s.start,s.end)],o,!0),r&&this.replaceDiffAnnotations(this.editorWrapper[1].editor,[new(n.AnnotationType.getType(r.current))(a.start,a.end)],r,!0),e?(this.autoSelecting=!0,this.editorWrapper[0].editor.setSelection(i.oldA.start,i.oldA.end,!0),this.editorWrapper[1].editor.setSelection(i.newA.start,i.newA.end,!0),this.autoSelecting=!1):t&&(this.autoSelecting=!0,t!==this.editorWrapper[0].editor.getTextView()&&this.editorWrapper[0].editor.setSelection(i.oldA.start,i.oldA.end,!0),t!==this.editorWrapper[1].editor.getTextView()&&this.editorWrapper[1].editor.setSelection(i.newA.start,i.newA.end,!0),this.autoSelecting=!1)}}},generatePairBlockAnnotations:function(e,t){var i=this.generateBlockDiffAnnotations(0,t),n=this.generateBlockDiffAnnotations(1,t);return{parent:e,index:t,type:"block",oldA:i,newA:n}},generatePairWordAnnotations:function(e,t,i){var n=this.editorWrapper[0].diffFeeder.getTextOnBlock(t),o=this.editorWrapper[1].diffFeeder.getTextOnBlock(t),r=null,s=0,l=0;if(!(n&&o&&n.text&&o.text&&n.text.length<=a&&o.text.length<=a))return null;r=i.adaptCharDiff(n.text,o.text,"word"===this._charOrWordDiff),l=o.start,s=n.start;var c=[],d=[];this.generateWordDiffAnnotations(0,c,s,r,2,3),this.generateWordDiffAnnotations(1,d,l,r,0,1);for(var h=[],u=0;u<c.length;u++)h.push({parent:e,index:u,type:"word",oldA:c[u],newA:d[u]});return h},getAnnoModelList:function(e,t,i){for(var n=0;n<this.editorWrapper[e].annoTypes.length;n++)if(this.editorWrapper[e].annoTypes[n].type===t&&this.editorWrapper[e].annoTypes[n].normal===i)return this.editorWrapper[e].annoTypes[n].list;return null},generateBlockDiffAnnotations:function(e,t){var i=this.editorWrapper[e].diffFeeder.getCurrentBlockAnnoType(t),o=this.getAnnoModelList(e,"block",i.normal),r=this.editorWrapper[e].diffFeeder.getCharRange(t),s=n.AnnotationType.createAnnotation(i.normal,r.start,r.end);return o&&o.push(s),s},generateWordDiffAnnotations:function(e,t,i,o,r,s){if(o)for(var a=this.editorWrapper[e].diffFeeder.getCurrentWordAnnoType({start:-1,end:-1}),l=this.getAnnoModelList(e,"word",a.normal),c=0;c<o.length;c++){var d=o[c][r]+i,h=o[c][s]+i,u=n.AnnotationType.createAnnotation(a.normal,d,h);l.push(u),t.push(u)}},_updateOverviewRuler:function(){if(this._overviewRuler){var e=this.editorWrapper[0].editor.getTextView().getTopIndex();this.editorWrapper[0].editor.getTextView().redrawLines(e,e+1,this._overviewRuler)}},_updateCurveRuler:function(){this._curveRuler&&this._curveRuler.render()},_setTextViewPosition:function(e,t){var i=e.getLineHeight(),n=e.getClientArea(),o=Math.floor(n.height/i/3);e.setTopIndex(t-o>0?t-o:0)},_positionDiffBlock:function(){var e=this.getCurrentBlockIndex();0>e&&(e=0);var t=this.getFeeder().getDiffBlocks();if(0!==t.length){if(this._setTextViewPosition(this.editorWrapper[0].editor.getTextView(),t[e][0]),this.editorWrapper[0].editor!==this.editorWrapper[1].editor){var n=i.lookUpLineIndex(this.getMapper(),0,t[e][1]);this._setTextViewPosition(this.editorWrapper[1].editor.getTextView(),n)}this._updateOverviewRuler(),this._updateCurveRuler()}},matchPositionFromOverview:function(e){if(this._initialized){var t;t=0>e?0:i.getAnnotationIndex(this.getFeeder().getDiffBlocks(),e),this.gotoBlock(t)}},gotoDiff:function(e,t){this.gotoChange(e,t)&&(this._updateOverviewRuler(),this._updateCurveRuler())},nextDiff:function(){this.iterateOnBlock(!0,!0),this._positionDiffBlock()},prevDiff:function(){this.iterateOnBlock(!1,!0),this._positionDiffBlock()},nextChange:function(){var e=this.iterateOnChange(!0);return this._positionDiffBlock(),e},prevChange:function(){this.iterateOnChange(!1),this._positionDiffBlock()}},r}(),r.DiffBlockFeeder=function(){function e(){}return e.prototype={_isAddedSide:function(){return 0===this._mapperColumnIndex},getWordAnnoTypes:function(e){e.push(this._isAddedSide()?{type:"word",current:s.ANNO_DIFF_CURRENT_ADDED_WORD,normal:s.ANNO_DIFF_ADDED_WORD,list:[]}:{type:"word",current:s.ANNO_DIFF_CURRENT_DELETED_WORD,normal:s.ANNO_DIFF_DELETED_WORD,list:[]}),e.push({type:"word",current:s.ANNO_DIFF_EMPTY_DELETED_WORD_LEFT}),e.push({type:"word",current:s.ANNO_DIFF_EMPTY_DELETED_WORD_RIGHT}),e.push({type:"word",current:s.ANNO_DIFF_EMPTY_ADDED_WORD_LEFT}),e.push({type:"word",current:s.ANNO_DIFF_EMPTY_ADDED_WORD_RIGHT})},getCurrentWordAnnoType:function(e,t){return e.start===e.end&&t?this._isAddedSide()?{current:this._repositionEmptyWord(e,t),normal:s.ANNO_DIFF_ADDED_WORD}:{current:this._repositionEmptyWord(e,t),normal:s.ANNO_DIFF_DELETED_WORD}:this._isAddedSide()?{current:s.ANNO_DIFF_CURRENT_ADDED_WORD,normal:s.ANNO_DIFF_ADDED_WORD}:{current:s.ANNO_DIFF_CURRENT_DELETED_WORD,normal:s.ANNO_DIFF_DELETED_WORD}},_repositionEmptyWord:function(e,t){var i=t.getLineAtOffset(e.start),n=t.getLineStart(i),o=t.getLineEnd(i);return n!==o?e.start===o?(e.start--,this._isAddedSide()?s.ANNO_DIFF_EMPTY_ADDED_WORD_RIGHT:s.ANNO_DIFF_EMPTY_DELETED_WORD_RIGHT):(e.end++,this._isAddedSide()?s.ANNO_DIFF_EMPTY_ADDED_WORD_LEFT:s.ANNO_DIFF_EMPTY_DELETED_WORD_LEFT):i>0&&(i--,n=t.getLineStart(i),o=t.getLineEnd(i),n!==o)?(e.start=o-1,e.end=o,this._isAddedSide()?s.ANNO_DIFF_EMPTY_ADDED_WORD_RIGHT:s.ANNO_DIFF_EMPTY_DELETED_WORD_RIGHT):this._isAddedSide()?s.ANNO_DIFF_EMPTY_ADDED_WORD_LEFT:s.ANNO_DIFF_EMPTY_DELETED_WORD_LEFT},getMapper:function(){return this._mapper},getDiffBlocks:function(){return this._diffBlocks},getDiffBlockH:function(e){if(!this._diffBlocks||0===this._diffBlocks.length)return-1;var t=this._diffBlocks[e][1];return-1===t?0:this._mapper[t][this._mapperColumnIndex]},getOverviewLineCount:function(){return this._textModel.getLineCount()},getLineNumber:function(e){return e},getCharRange:function(e){if(!this._diffBlocks||0===this._diffBlocks.length)return null;var t=this._diffBlocks[e][1],i=this._diffBlocks[e][0],n=i+this._mapper[t][this._mapperColumnIndex]-1,o=this._textModel.getLineStart(i);if(i>n)return{start:o,end:o};var r=this._textModel.getLineEnd(n,!0);return{start:o,end:r}},getTextOnBlock:function(e){if(!this._diffBlocks||0===this._diffBlocks.length)return null;var t=this._diffBlocks[e][1];0===this._mapper[t][0]||0===this._mapper[t][1]||0===this._mapper[t][2];var i=this.getCharRange(e);return{start:i.start,text:this._textModel.getText(i.start,i.end)}},isMapperEmpty:function(){return 0===this._mapper.length}},e}(),r.TwoWayDiffBlockFeeder=function(){function e(e,t,i,n){this._mapperColumnIndex=i,this._reverseAnnotation=n,this.init(e,t)}return e.prototype=new r.DiffBlockFeeder,e.prototype._isAddedSide=function(){return this._reverseAnnotation?0!==this._mapperColumnIndex:0===this._mapperColumnIndex},e.prototype.init=function(e,t){if(this._textModel=e,this._diffBlocks=void 0,t){this._mapper=t,this._diffBlocks=[];for(var i=0,n=0;n<this._mapper.length;n++)0!==this._mapper[n][2]&&this._diffBlocks.push([i,n]),i+=this._mapper[n][this._mapperColumnIndex]}},e.prototype.getBlockAnnoTypes=function(e){e.push(this._isAddedSide()?{type:"block",normal:s.ANNO_DIFF_ADDED_BLOCK,current:s.ANNO_DIFF_CURRENT_ADDED_BLOCK,list:[]}:{type:"block",normal:s.ANNO_DIFF_DELETED_BLOCK,current:s.ANNO_DIFF_CURRENT_DELETED_BLOCK,list:[]}),e.push({type:"block",normal:s.ANNO_DIFF_BLOCK_TOPONLY,current:s.ANNO_DIFF_CURRENT_BLOCK_TOPONLY,list:[]}),e.push({type:"block",normal:s.ANNO_DIFF_BLOCK_CONFLICT,current:s.ANNO_DIFF_CURRENT_BLOCK_CONFLICT,list:[]})},e.prototype.getCurrentBlockAnnoType=function(e){if(!this._diffBlocks||0===this._diffBlocks.length||this._diffBlocks.length<=e)return null;var t=this._diffBlocks[e][1];return 0===this._mapper[t][this._mapperColumnIndex]?{normal:s.ANNO_DIFF_BLOCK_TOPONLY,current:s.ANNO_DIFF_CURRENT_BLOCK_TOPONLY}:i.isMapperConflict(this.getMapper(),t)?{normal:s.ANNO_DIFF_BLOCK_CONFLICT,current:s.ANNO_DIFF_CURRENT_BLOCK_CONFLICT}:this._isAddedSide()?{type:"block",normal:s.ANNO_DIFF_ADDED_BLOCK,current:s.ANNO_DIFF_CURRENT_ADDED_BLOCK,list:[]}:{type:"block",normal:s.ANNO_DIFF_DELETED_BLOCK,current:s.ANNO_DIFF_CURRENT_DELETED_BLOCK,list:[]}},e}(),r.inlineDiffBlockFeeder=function(){function e(e,t){this._mapperColumnIndex=t,this.init(e)}return e.prototype=new r.DiffBlockFeeder,e.prototype.setModel=function(e){this._textModel=e},e.prototype.init=function(e){if(this._diffBlocks=void 0,e){this._mapper=e,this._diffBlocks=[],this._gapBlocks=[];for(var t=0,i=0,n=0;n<this._mapper.length;n++){if(0!==this._mapper[n][2]){if(this._isAddedSide()){var o=t+this._mapper[n][1];this._diffBlocks.push([o,n]),this._gapBlocks.push([o,o+this._mapper[n][0],i])}else this._diffBlocks.push([t,n]),this._gapBlocks.push([t,t+this._mapper[n][1],i]);t+=this._mapper[n][0]+this._mapper[n][1]}else this._gapBlocks.push([t,t+this._mapper[n][this._mapperColumnIndex],i]),t+=this._mapper[n][this._mapperColumnIndex];i+=this._mapper[n][this._mapperColumnIndex]}}},e.prototype.getBlockAnnoTypes=function(e){e.push(this._isAddedSide()?{type:"block",normal:s.ANNO_DIFF_ADDED_BLOCK,current:s.ANNO_DIFF_CURRENT_ADDED_BLOCK,list:[]}:{type:"block",normal:s.ANNO_DIFF_DELETED_BLOCK,current:s.ANNO_DIFF_CURRENT_DELETED_BLOCK,list:[]}),e.push({type:"block",normal:s.ANNO_DIFF_BLOCK_CONFLICT,current:s.ANNO_DIFF_CURRENT_BLOCK_CONFLICT,list:[]})},e.prototype.getCurrentBlockAnnoType=function(e){if(!this._diffBlocks||0===this._diffBlocks.length)return null;var t=this._diffBlocks[e][1];return 0===this._mapper[t][this._mapperColumnIndex]?{current:s.ANNO_DIFF_CURRENT_ADDED_WORD,normal:s.ANNO_DIFF_ADDED_WORD}:i.isMapperConflict(this.getMapper(),t)?{normal:s.ANNO_DIFF_BLOCK_CONFLICT,current:s.ANNO_DIFF_CURRENT_BLOCK_CONFLICT}:this._isAddedSide()?{type:"block",normal:s.ANNO_DIFF_ADDED_BLOCK,current:s.ANNO_DIFF_CURRENT_ADDED_BLOCK,list:[]}:{type:"block",normal:s.ANNO_DIFF_DELETED_BLOCK,current:s.ANNO_DIFF_CURRENT_DELETED_BLOCK,list:[]}},e.prototype.getDiffBlockH=function(e){if(!this._diffBlocks||0===this._diffBlocks.length)return-1;var t=this._diffBlocks[e][1];return this._mapper[t][0]+this._mapper[t][1]},e.prototype.getLineNumber=function(e){for(var t=0;t<this._gapBlocks.length;t++)if(this._gapBlocks[t][0]!==this._gapBlocks[t][1]&&e>=this._gapBlocks[t][0]&&e<this._gapBlocks[t][1]){var i=e-this._gapBlocks[t][0];return i+this._gapBlocks[t][2]}return-1},e}(),r}),define("orion/compare/compareView",["i18n!orion/compare/nls/messages","orion/Deferred","orion/EventTarget","orion/webui/littlelib","orion/compare/diffParser","orion/compare/compareRulers","orion/editor/editor","orion/editor/editorFeatures","orion/keyBinding","orion/editor/textView","orion/compare/compareUIFactory","orion/compare/compareUtils","orion/compare/jsdiffAdapter","orion/compare/diffTreeNavigator"],function(e,t,i,n,o,r,s,a,l,c,d,h,u,p){var f={};return f.CompareView=function(){function e(){i.attach(this),this._diffParser=new o.DiffParser}return e.prototype={_clearOptions:function(){this.options={},this.options.blockNumber=1,this.options.changeNumber=0},_disableAnnoBookMark:function(e){e.forEach(function(e){var t=e.getAnnotationRuler();
t&&(t.onDblClick=function(){})})},_getLineDelim:function(){var e="\n";return e},_generateMapper:function(e,t,i,n,o){var r=this._getLineDelim(t,n);if(this._diffParser.setLineDelim(r),this.options.mapper&&this.options.toggler&&!e)return{delim:r,mapper:this.options.mapper,output:this.options.newFile.Content,diffArray:this.options.diffArray};if(n||"string"!=typeof i||"string"!=typeof t){var s=this._diffParser.parse(t,n,o,!0),a=this._diffParser.getDiffArray();this.options.toggler&&(this.options.mapper=s.mapper,this.options.newFile.Content=i,this.options.diffArray=a);var l={delim:r,mapper:s.mapper,output:i,diffArray:a};return s.deletedFileMode&&"160000"===s.deletedFileMode?l.submoduleChanged="removed":s.newFileMode&&"160000"===s.newFileMode&&(l.submoduleChanged="added"),l}var c=new u.JSDiffAdapter(this.isWhitespaceIgnored()),d=c.adapt(t,i,r);return this.options.toggler&&(this.options.mapper=d.mapper,this.options.newFile.Content=i,this.options.diffArray=d.changContents),{delim:r,mapper:d.mapper,output:i,diffArray:d.changContents}},_loadImageFile:function(e,i,n){var o=document.createElement("img");o.src=e;var r=new t;return o.onload=function(){if(i.appendChild(o),n){var e=document.createElement("hr");i.appendChild(e)}r.resolve(o.height)},o.onerror=function(){r.resolve(0)},r},_initSyntaxHighlighter:function(e){if(this._syntaxHighlighters=null,this.options.highlighters&&this.options.highlighters.length>0){if(e.length<1||e.length>2)return;this._syntaxHighlighters=[{highlighter:this.options.highlighters[0],target:e[0]}],2===e.length&&2===this.options.highlighters.length&&this._syntaxHighlighters.push({highlighter:this.options.highlighters[1],target:e[1]})}},_highlightSyntax:function(){if(this._syntaxHighlighters){var e=[];this._syntaxHighlighters.forEach(function(t){e.push(t.highlighter.highlight(t.target.fileName,t.target.contentType,t.target.editor))}.bind(this)),t.all(e,function(e){return{_error:e}}).then(function(){this._diffNavigator.renderAnnotations(this.isWhitespaceIgnored()),this._diffNavigator.gotoBlock(this.options.blockNumber-1,this.options.changeNumber-1),this.dispatchEvent({type:"contentLoaded"}),this.options.toggler&&this.options.toggler.dispatchEvent({type:"contentLoaded"})}.bind(this))}else window.setTimeout(function(){this._diffNavigator.renderAnnotations(this.isWhitespaceIgnored()),this._diffNavigator.gotoBlock(this.options.blockNumber-1,this.options.changeNumber-1),this.dispatchEvent({type:"contentLoaded"}),this.options.toggler&&this.options.toggler.dispatchEvent({type:"contentLoaded"})}.bind(this),50)},isWhitespaceIgnored:function(){return this.getWidget().options.ignoreWhitespace},ignoreWhitespace:function(e){var t=this.getWidget().options;if(t.ignoreWhitespace=e,t.diffProvider&&t.diffContent){var i=e?"true":"false";t.diffProvider._diffProvider.getDiffContent(t.resource,{ignoreWS:i}).then(function(e){t.diffContent=t.hasConflicts?e.split("diff --git")[1]:e,this.getWidget().refresh(!0,!0)}.bind(this),function(){})}else this.getWidget().refresh(!0,!0)},setOptions:function(e,t){if(t&&this._clearOptions(),this.options||(this.options={}),e&&Object.keys(e).forEach(function(t){this.options[t]=e[t]}.bind(this)),e.newFileOnRight){var i=this.options.newFile;this.options.newFile=this.options.oldFile,this.options.oldFile=i}},getOptions:function(){return this.options},getCurrentDiffPos:function(){return this._diffNavigator.getCurrentPosition()},initDiffNav:function(){this._diffNavigator.gotoBlock(0,0)},nextDiff:function(){this._diffNavigator.nextDiff()},prevDiff:function(){this._diffNavigator.prevDiff()},nextChange:function(){return this._diffNavigator.nextChange()},prevChange:function(){this._diffNavigator.prevChange()},getWidget:function(){return this},startup:function(){this.initEditors(),this.refresh(!0)},initEditors:function(){},initImageMode:function(){}},e}(),f.TwoWayCompareView=function(){function i(e){f.CompareView.call(this,e),this.setOptions(e,!0),this._diffNavigator=new p.DiffTreeNavigator("word"),this.type="twoWay",this._uiFactory=this.options.uiFactory,this._uiFactory||(this._uiFactory=new d.TwoWayCompareUIFactory({parentDivID:this.options.parentDivId,showTitle:this.options.showTitle?this.options.showTitle:!1,showLineStatus:this.options.showLineStatus?this.options.showLineStatus:!1}),this._uiFactory.buildUI()),this._viewLoadedCounter=0,this.options.commandProvider&&this.options.commandProvider.initCommands(this),this._curveRuler=new r.CompareCurveRuler(this._uiFactory.getDiffCanvasDiv())}return i.prototype=Object.create(f.CompareView.prototype),i.prototype.initEditors=function(t){this.options.preCreate&&this.options.preCreate(),this._editors=[],this._editors.push(this._createEditor(t,this._uiFactory.getEditorParentDiv(!1),this._uiFactory.getStatusDiv(!1),this.options.oldFile)),this._editors.push(this._createEditor(t,this._uiFactory.getEditorParentDiv(!0),this._uiFactory.getStatusDiv(!0),this.options.newFile,!0)),this._overviewRuler=new r.CompareOverviewRuler("right",{styleClass:"ruler overview"},null,function(e){this._diffNavigator.matchPositionFromOverview(e)}.bind(this)),this.options.postCreate&&this.options.postCreate(),window.onbeforeunload=function(){return this.isDirty()?e["There are unsaved changes."]:void 0}.bind(this)},i.prototype.disableAnnoBookMark=function(){this._disableAnnoBookMark(this._editors)},i.prototype.initImageMode=function(){this._editors&&(this._editors.forEach(function(e){e.destroy()}),this._editors=null),this._uiFactory.getEditorParentDiv(!0).classList.add("compareEditorParentImageMode"),this._uiFactory.getEditorParentDiv().classList.add("compareEditorParentImageMode"),this._uiFactory.disableTitle(),this._uiFactory.disableLineStatus(),this._imageMode=!0},i.prototype.getImageMode=function(){return this._imageMode},i.prototype.getEditors=function(){return this._editors},i.prototype.gotoDiff=function(e,t,i){var n=i?this._editors[1].getTextView():this._editors[0].getTextView(),o=n.getModel().getLineStart(e)+t;this._diffNavigator.gotoDiff(o,n)},i.prototype.copyToLeft=function(){this._curveRuler.copyTo(!0)},i.prototype.copyToRight=function(){this._curveRuler.copyTo(!1)},i.prototype.resizeEditors=function(){this._editors.forEach(function(e){e.getTextView().resize()})},i.prototype.getSplitter=function(){return this._uiFactory.getSplitter()},i.prototype._createEditor=function(t,i,n,o,r){var l="undefined"==typeof o.readonly?!0:o.readonly,d=function(){var e=new c.TextView({parent:i,readonly:l,tabSize:4});this._viewLoadedCounter++,2===this._viewLoadedCounter&&this._diffNavigator.matchPositionFromOverview(-1),this.onLoad&&this.onLoad();var t=this.getSplitter();return t&&t.addResizeListener(function(t){if(t){var i=!1;i=this._uiFactory.isLeftPane(t)?r:!r,i&&e.resize()}}.bind(this)),e}.bind(this),h=o.keyBindingFactory;h||(h=new a.KeyBindingsFactory);var u=null;if(n){var p="",f="";u=function(t,i){n&&(f=i?e["ERROR: "]+t:t,n.textContent=p+f)}}var g=new s.Editor({textViewFactory:d,undoStackFactory:new a.UndoFactory,annotationFactory:new a.AnnotationFactory,keyBindingFactory:h,statusReporter:u,domNode:i});g.installTextView(),g.setInput(null,null,o.Content?o.Content:t),g.setOverviewRulerVisible(!1);var m=g.getTextView();return m.addEventListener("Selection",function(e){var t=Array.isArray(e.newValue)?e.newValue:[e.newValue];t.length>1||!t[0].isEmpty()||!this._diffNavigator.autoSelecting&&this._diffNavigator.editorWrapper[0].diffFeeder&&this._diffNavigator.gotoDiff(t[0].getCaret(),m)}.bind(this)),m.getModel().addEventListener("Changed",function(e){this._curveRuler.onChanged(e,!r)||(this.options.mapper=null)}.bind(this)),r?m.addEventListener("Scroll",function(){this._curveRuler&&(this._curveRuler.matchPositionFrom(!0),this._curveRuler.render()),this.onScroll&&this.onScroll()}.bind(this)):m.addEventListener("Scroll",function(){this._curveRuler&&this._curveRuler.render()}.bind(this)),g},i.prototype.isDirty=function(){return this._editors?this._editors.some(function(e){return e.isDirty()}):!1},i.prototype._destroy=function(){this._editors&&(this._diffNavigator.destroy(),this._editors.forEach(function(e){e.destroy()}),this._uiFactory.destroy())},i.prototype.destroy=function(){this._destroyed=!0,this._destroy()},i.prototype.addRulers=function(){if(this._editors&&!this._hasRuler){var e=new r.LineNumberCompareRuler(this._diffNavigator,0,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"}),t=new r.LineNumberCompareRuler(this._diffNavigator,0,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"});this._editors[1].getTextView().addRuler(e),this._editors[0].getTextView().addRuler(t),this._editors[0].getTextView().addRuler(this._overviewRuler),this._hasRuler=!0}},i.prototype.refresh=function(e,i,n){if(!this._destroyed){if(this._imageMode){this.options.commandProvider&&this.options.commandProvider.renderCommands(this);var o=this;return this._loadImageFile(this.options.newFile.URL,this._uiFactory.getEditorParentDiv(!0)).then(function(e){return o._loadImageFile(o.options.oldFile.URL,o._uiFactory.getEditorParentDiv()).then(function(i){return(new t).resolve(e>i?e:i)})})}var r=this._generateMapper(i,this.options.oldFile.Content,this.options.newFile.Content,this.options.diffContent,this.options.hasConflicts,!this.options.toggler),s=this.options.oldFile.Content,a=this.options.newFile.Content;"string"!=typeof a&&(a=r.output);var l=new p.TwoWayDiffBlockFeeder(this._editors[0].getTextView().getModel(),r.mapper,1,this.options.newFileOnRight),c=new p.TwoWayDiffBlockFeeder(this._editors[1].getTextView().getModel(),r.mapper,0,this.options.newFileOnRight);this._diffNavigator.initAll(this.options.charDiff?"char":"word",this._editors[0],this._editors[1],l,c,this._overviewRuler,this._curveRuler),this._curveRuler.init(r.mapper,this._editors[1],this._editors[0],this._diffNavigator),e&&("number"==typeof n?1===n?this._editors[1].setInput(this.options.newFile.Name,null,a):this._editors[0].setInput(this.options.oldFile.Name,null,s):(this._editors[1].setInput(this.options.newFile.Name,null,a),this._editors[0].setInput(this.options.oldFile.Name,null,s))),this._initSyntaxHighlighter([{fileName:this.options.newFile.Name,contentType:this.options.newFile.Type,editor:this._editors[1]},{fileName:this.options.oldFile.Name,contentType:this.options.oldFile.Type,editor:this._editors[0]}]),this._highlightSyntax(),this.options.commandProvider&&this.options.commandProvider.renderCommands(this),this.addRulers(),2===this._viewLoadedCounter&&this._diffNavigator.gotoBlock(this.options.blockNumber-1,this.options.changeNumber-1),this.refreshTitle(0),this.refreshTitle(1);var d=this._editors[1].getTextView().getModel().getLineCount()*this._editors[1].getTextView().getLineHeight()+5,h=this._editors[0].getTextView().getModel().getLineCount()*this._editors[0].getTextView().getLineHeight()+5;return d>h?d:h}},i.prototype.refreshTitle=function(e,t){var i,o=this.options.newFile.Name,r=this.options.oldFile.Name,s="/",a=" ... ",l=o.split(s),c=r.split(s),d=[],h=[],u=!1;for(i=0;i<Math.min(l.length-1,c.length-1);i++)l[i]!==c[i]?(u&&(d.push(a),h.push(a)),d.push(l[i]),h.push(c[i]),u=!1):u=!0;for(u&&(d.push(a),h.push(a));i<Math.max(l.length,c.length);i++)i<l.length&&d.push(l[i]),i<c.length&&h.push(c[i]);if(o=d.join(s),r=h.join(s),1===e){var p=this._uiFactory.getTitleDiv(!0);p&&(n.empty(p),p.appendChild(document.createTextNode(t||this._editors[e].isDirty()?o+"*":o)))}else{var f=this._uiFactory.getTitleDiv(!1);f&&(n.empty(f),f.appendChild(document.createTextNode(t||this._editors[e].isDirty()?r+"*":r)))}},i.prototype.gotoLine=function(e,t,i,n){"number"!=typeof t&&(t=0);var o=function(){n&&n(e)}.bind(this);this._editors[1].onGotoLine(e,t,i,o)},i.prototype.getMainEditor=function(){return this._editors?this._editors[1]:null},i.prototype.getLineNumber=function(e){return e},i}(),f.InlineCompareView=function(){function i(e){f.CompareView.call(this,e),this.setOptions(e,!0),this._diffNavigator=new p.DiffTreeNavigator("word"),this.type="inline",this.options.commandProvider&&this.options.commandProvider.initCommands(this),this._editorDiv=this.options.parentDivId}return i.prototype=Object.create(f.CompareView.prototype),i.prototype.addRulers=function(){this._textView&&!this._hasRuler&&(this._textView.addRuler(this._rulerOrigin),this._textView.addRuler(this._rulerNew),this._textView.addRuler(this._overviewRuler),this._hasRuler=!0)},i.prototype.removeRulers=function(){this._textView&&this._hasRuler&&(this._textView.removeRuler(this._rulerOrigin),this._textView.removeRuler(this._rulerNew),this._textView.removeRuler(this._overviewRuler),this._hasRuler=!1)},i.prototype.destroyEditor=function(){this._textView&&(this._diffNavigator.destroy(),this._textView.setText(""),this.removeRulers())},i.prototype.isDirty=function(){return!1},i.prototype.destroy=function(){this._destroyed=!0,this._textView&&(this._diffNavigator.destroy(),this._textView.destroy())},i.prototype.initEditors=function(e){this.options.preCreate&&this.options.preCreate();var t=n.node(this._editorDiv),i=function(){var e=new c.TextView({parent:t,readonly:!0,tabSize:4});return e}.bind(this);this._editor=new s.Editor({textViewFactory:i,undoStackFactory:new a.UndoFactory,annotationFactory:new a.AnnotationFactory,domNode:t}),this._editor.installTextView(),this._editor.setInput(null,null,e),this._editor.setOverviewRulerVisible(!1),this._editor.setAnnotationRulerVisible(!0),this._textView=this._editor.getTextView(),this._rulerOrigin=new r.LineNumberCompareRuler(this._diffNavigator,1,"left",{styleClass:"ruler lines inlineRulerLeft"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"}),this._rulerNew=new r.LineNumberCompareRuler(this._diffNavigator,0,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"}),this._overviewRuler=new r.CompareOverviewRuler("right",{styleClass:"ruler overview"},null,function(e){this._diffNavigator.matchPositionFromOverview(e)}.bind(this)),this._textView.addEventListener("Selection",function(e){var t=Array.isArray(e.newValue)?e.newValue:[e.newValue];t.length>1||!t[0].isEmpty()||!this._diffNavigator.autoSelecting&&this._diffNavigator.editorWrapper[0].diffFeeder&&this._diffNavigator.gotoDiff(t[0].getCaret(),this._textView)}.bind(this))},i.prototype.disableAnnoBookMark=function(){this._disableAnnoBookMark([this._editor])},i.prototype.initImageMode=function(){this._editor&&(this._editor.destroy(),this._editor=null),n.node(this._editorDiv).classList.add("compareEditorParentImageMode"),this._imageMode=!0},i.prototype.getImageMode=function(){return this._imageMode},i.prototype._initDiffPosition=function(e){var t=e.getModel();if(t&&t.getAnnotations){var i=t.getAnnotations();if(i.length>0){var n=i[0][0],o=e.getLineHeight(),r=e.getClientArea(),s=Math.floor(r.height/o/3);e.setTopIndex(n-s>0?n-s:0)}}},i.prototype.refresh=function(i,o){if(!this._destroyed){if(this._imageMode){this.options.commandProvider&&this.options.commandProvider.renderCommands(this);var r=this;return this._loadImageFile(this.options.newFile.URL,n.node(this._editorDiv),!0).then(function(e){return r._loadImageFile(r.options.oldFile.URL,n.node(r._editorDiv)).then(function(i){return(new t).resolve(e+i+20)})})}var s=this._generateMapper(o,this.options.oldFile.Content,this.options.newFile.Content,this.options.diffContent,this.options.hasConflicts,!this.options.toggler);if(s.submoduleChanged)switch(s.submoduleChanged){case"removed":this._textView.getModel().setText(e["Removed Submodule Message"]);break;case"added":this._textView.getModel().setText(e["Added Submodule Message"])}else{this._mapper=s.mapper,this._textView.getModel().setText(this.options.oldFile.Content);var a=new p.inlineDiffBlockFeeder(s.mapper,1),l=new p.inlineDiffBlockFeeder(s.mapper,0);h.mergeDiffBlocks(this._textView.getModel(),l.getDiffBlocks(),s.mapper,s.diffArray.array,s.diffArray.index,this._diffParser._lineDelimiter),a.setModel(this._textView.getModel()),l.setModel(this._textView.getModel()),this._diffNavigator.initAll(this.options.charDiff?"char":"word",this._editor,this._editor,a,l,this._overviewRuler),this._initSyntaxHighlighter([{fileName:this.options.oldFile.Name,contentType:this.options.oldFile.Type,editor:this._editor}]),this._highlightSyntax(),this.options.commandProvider&&this.options.commandProvider.renderCommands(this),this.removeRulers(),this.addRulers();var c=this._textView.getTopIndex();this._textView.redrawLines(c,c+1,this._overviewRuler),this._textView.redrawLines(c,c+1,this._rulerOrigin),this._textView.redrawLines(c,c+1,this._rulerNew),this._diffNavigator.gotoBlock(this.options.blockNumber-1,this.options.changeNumber-1)}return this._textView.getLineHeight()*this._textView.getModel().getLineCount()+5}},i.prototype.setConflicting=function(e){this._conflcit=e},i.prototype.gotoDiff=function(e){this._diffNavigator.gotoChangeUsingIndex(e)},i.prototype.gotoLine=function(e,t,i,n){"number"!=typeof t&&(t=0);var o=h.convertMergedLineNumber(this._mapper,e),r=function(){n(o)}.bind(this);this._editor.onGotoLine(o,t,i,r)},i.prototype.getMainEditor=function(){return this._editor?this._editor:null},i.prototype.getLineNumber=function(e,t,i){if(t){var n=this._diffNavigator.getFeeder(i?!1:!0);return n?n.getLineNumber(e):e}var o=h.convertMergedLineNumber(this._mapper,e,i);return o},i}(),f.toggleableCompareView=function(){function e(e,t){i.attach(this),t&&(t.toggler=this),this._widget="inline"===e?new f.InlineCompareView(t):new f.TwoWayCompareView(t)}return e.prototype={startup:function(){this._widget.startup()},initImageMode:function(){this._imageMode=!0,this._widget.initImageMode()},_toggle:function(e){this._widget.destroy(),n.empty(n.node(e.parentDivId)),this._widget="inline"===this._widget.type?new f.TwoWayCompareView(e):new f.InlineCompareView(e),this._imageMode?this._widget.initImageMode():this._widget.initEditors(),this._widget.refresh(!0),e.onInputChanged&&"twoWay"===this._widget.type&&e.onInputChanged()},toggle:function(){var e=this._widget.options;if(!this._imageMode){var t=this._widget.getCurrentDiffPos();e.blockNumber=t.block,e.changeNumber=t.change}this._toggle(e)},isDirty:function(){return this._widget.isDirty()},destroy:function(){return this._widget.destroy()},getWidget:function(){return this._widget}},e}(),f}),define("orion/editor/stylers/lib/syntax",[],function(){return{id:"orion.lib",grammars:[{id:"orion.lib",repository:{brace_open:{match:"{",name:"punctuation.section.block.begin"},brace_close:{match:"}",name:"punctuation.section.block.end"},bracket_open:{match:"\\[",name:"punctuation.section.bracket.begin"},bracket_close:{match:"\\]",name:"punctuation.section.bracket.end"},parenthesis_open:{match:"\\(",name:"punctuation.section.parens.begin"},parenthesis_close:{match:"\\)",name:"punctuation.section.parens.end"},operator:{match:"(\\+|-|!|=|>|<|&|(\\|\\|))+",name:"punctuation.operator"},doc_block:{begin:{match:"/\\*\\*",literal:"/**"},end:{match:"\\*/",literal:"*/"},name:"comment.block.documentation",patterns:[{match:"@(?:(?!\\*/)\\S)*",name:"meta.documentation.annotation"},{match:"<[^\\s>]*>",name:"meta.documentation.tag"},{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]},number_decimal:{match:"\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:[eE][+-]?\\d+)?\\b",name:"constant.numeric.number"},number_hex:{match:"\\b0[xX][0-9A-Fa-f]+\\b",name:"constant.numeric.hex"},string_doubleQuote:{match:'"(?:\\\\.|[^"])*"?',name:"string.quoted.double"},string_singleQuote:{match:"'(?:\\\\.|[^'])*'?",name:"string.quoted.single"},todo_comment_singleLine:{match:"(\\b)(TODO)(\\b)(.*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}}},{id:"orion.c-like",repository:{comment_singleLine:{match:{match:"//.*",literal:"//"},name:"comment.line.double-slash",patterns:[{include:"orion.lib#todo_comment_singleLine"}]},comment_block:{begin:{match:"/\\*",literal:"/*"},end:{match:"\\*/",literal:"*/"},name:"comment.block",patterns:[{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]}}}],keywords:[]}}),define("orion/editor/stylers/application_javascript/syntax",["orion/editor/stylers/lib/syntax"],function(e){var t=["class","const","debugger","delete","enum","export","extends","function","implements","import","in","instanceof","interface","let","new","package","private","protected","public","static","super","typeof","var","void","with"],i=["break","case","catch","continue","default","do","else","finally","for","if","return","switch","throw","try","while","yield"],n=["this"],o=["false","null","true","undefined"],r=[];return r.push.apply(r,e.grammars),r.push({id:"orion.js",contentTypes:["application/javascript"],patterns:[{begin:"'(?:\\\\.|[^\\\\'])*\\\\$",end:"^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))",name:"string.quoted.single.js"},{begin:'"(?:\\\\.|[^\\\\"])*\\\\$',end:'^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))',name:"string.quoted.double.js"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"},{include:"orion.c-like#comment_singleLine"},{match:"/(?![\\s\\*])(?:\\\\.|[^/])+/(?:[gim]{0,3})",name:"string.regexp.js"},{include:"orion.lib#doc_block"},{include:"orion.c-like#comment_block"},{include:"#jsFunctionDef"},{include:"orion.lib#brace_open"},{include:"orion.lib#brace_close"},{include:"orion.lib#bracket_open"},{include:"orion.lib#bracket_close"},{include:"orion.lib#parenthesis_open"},{include:"orion.lib#parenthesis_close"},{include:"orion.lib#operator"},{include:"orion.lib#number_decimal"},{include:"orion.lib#number_hex"},{match:"\\b(?:"+t.join("|")+")\\b",name:"keyword.operator.js"},{match:"\\b(?:"+i.join("|")+")\\b",name:"keyword.control.js"},{match:"\\b(?:"+o.join("|")+")\\b",name:"constant.language.js"},{match:"\\b(?:"+n.join("|")+")\\b",name:"variable.language.js"}],repository:{jsFunctionDef:{begin:"(function)(\\s+[_$a-zA-Z\\xA0-\\uFFFF][_$a-zA-Z0-9\\xA0-\\uFFFF]*)?\\s*\\(",end:"\\)",captures:{1:{name:"keyword.operator.js"},2:{name:"entity.name.function.js"}},patterns:[{include:"orion.c-like#comment_singleLine"},{include:"orion.c-like#comment_block"},{match:"[^\\s,]+",name:"variable.parameter.js"}]}}}),{id:r[r.length-1].id,grammars:r,keywords:t.concat(i).concat(n).concat(o)}}),define("orion/editor/stylers/text_x-java-source/syntax",["orion/editor/stylers/lib/syntax"],function(e){var t=["abstract","boolean","byte","char","class","double","extends","final","float","implements","import","instanceof","int","interface","long","native","new","package","private","protected","public","short","static","synchronized","throws","transient","void","volatile"],i=["break","case","catch","continue","default","do","else","finally","for","if","return","switch","throw","try","while"],n=["false","null","true"],o=["this","super"],r=[];return r.push.apply(r,e.grammars),r.push({id:"orion.java",contentTypes:["text/x-java-source"],patterns:[{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"},{include:"orion.c-like#comment_singleLine"},{include:"orion.lib#doc_block"},{include:"orion.c-like#comment_block"},{include:"orion.lib#brace_open"},{include:"orion.lib#brace_close"},{include:"orion.lib#bracket_open"},{include:"orion.lib#bracket_close"},{include:"orion.lib#parenthesis_open"},{include:"orion.lib#parenthesis_close"},{include:"orion.lib#operator"},{include:"orion.lib#number_decimal"},{include:"orion.lib#number_hex"},{match:"\\b(?:"+t.join("|")+")\\b",name:"keyword.operator.java"},{match:"\\b(?:"+i.join("|")+")\\b",name:"keyword.control.java"},{match:"\\b(?:"+n.join("|")+")\\b",name:"constant.language.java"},{match:"\\b(?:"+o.join("|")+")\\b",name:"variable.language.java"}]}),{id:r[r.length-1].id,grammars:r,keywords:t.concat(i).concat(n).concat(o)}}),define("orion/editor/stylers/text_css/syntax",["orion/editor/stylers/lib/syntax"],function(e){var t=["alignment-adjust","alignment-baseline","animation-delay","animation-direction","animation-duration","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","animation","appearance","azimuth","backface-visibility","background-attachment","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","background","baseline-shift","binding","bleed","bookmark-label","bookmark-level","bookmark-state","bookmark-target","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-bottom","border-collapse","border-color","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-image","border-left-color","border-left-style","border-left-width","border-left","border-radius","border-right-color","border-right-style","border-right-width","border-right","border-spacing","border-style","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-top","border-width","border","bottom","box-align","box-decoration-break","box-direction","box-flex-group","box-flex","box-lines","box-ordinal-group","box-orient","box-pack","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","clear","clip","color-profile","color","column-count","column-fill","column-gap","column-rule-color","column-rule-style","column-rule-width","column-rule","column-span","column-width","columns","content","counter-increment","counter-reset","crop","cue-after","cue-before","cue","cursor","direction","display","dominant-baseline","drop-initial-after-adjust","drop-initial-after-align","drop-initial-before-adjust","drop-initial-before-align","drop-initial-size","drop-initial-value","elevation","empty-cells","fit-position","fit","flex-align","flex-flow","flex-inline-pack","flex-order","flex-pack","float-offset","float","font-family","font-size-adjust","font-size","font-stretch","font-style","font-variant","font-weight","font","grid-columns","grid-rows","hanging-punctuation","height","hyphenate-after","hyphenate-before","hyphenate-character","hyphenate-lines","hyphenate-resource","hyphens","icon","image-orientation","image-rendering","image-resolution","inline-box-align","left","letter-spacing","line-height","line-stacking-ruby","line-stacking-shift","line-stacking-strategy","line-stacking","list-style-image","list-style-position","list-style-type","list-style","margin-bottom","margin-left","margin-right","margin-top","margin","mark-after","mark-before","mark","marker-offset","marks","marquee-direction","marquee-loop","marquee-play-count","marquee-speed","marquee-style","max-height","max-width","min-height","min-width","move-to","nav-down","nav-index","nav-left","nav-right","nav-up","opacity","orphans","outline-color","outline-offset","outline-style","outline-width","outline","overflow-style","overflow-x","overflow-y","overflow","padding-bottom","padding-left","padding-right","padding-top","padding","page-break-after","page-break-before","page-break-inside","page-policy","page","pause-after","pause-before","pause","perspective-origin","perspective","phonemes","pitch-range","pitch","play-during","position","presentation-level","punctuation-trim","quotes","rendering-intent","resize","rest-after","rest-before","rest","richness","right","rotation-point","rotation","ruby-align","ruby-overhang","ruby-position","ruby-span","size","speak-header","speak-numeral","speak-punctuation","speak","speech-rate","stress","string-set","table-layout","target-name","target-new","target-position","target","text-align-last","text-align","text-decoration","text-emphasis","text-height","text-indent","text-justify","text-outline","text-shadow","text-transform","text-wrap","top","transform-origin","transform-style","transform","transition-delay","transition-duration","transition-property","transition-timing-function","transition","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch-range","voice-pitch","voice-rate","voice-stress","voice-volume","volume","white-space-collapse","white-space","widows","width","word-break","word-spacing","word-wrap","z-index"],i=[];return i.push.apply(i,e.grammars),i.push({id:"orion.css",contentTypes:["text/css"],patterns:[{begin:"'(?:\\\\.|[^\\\\'])*\\\\$",end:"^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))",name:"string.quoted.single.css"},{begin:'"(?:\\\\.|[^\\\\"])*\\\\$',end:'^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))',name:"string.quoted.double.css"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"},{include:"orion.c-like#comment_block"},{include:"orion.lib#brace_open"},{include:"orion.lib#brace_close"},{include:"orion.lib#bracket_open"},{include:"orion.lib#bracket_close"},{include:"orion.lib#parenthesis_open"},{include:"orion.lib#parenthesis_close"},{include:"orion.lib#number_decimal"},{include:"#number_hex"},{match:"(?i)\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:%|em|ex|ch|rem|vw|vh|vmin|vmax|in|cm|mm|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?\\b",name:"constant.numeric.value.css"},{match:"(?:-webkit-|-moz-|-ms-|-o-|\\b)(?:"+t.join("|")+")\\b",name:"support.type.propertyName.css"}],repository:{number_hex:{match:"#[0-9A-Fa-f]+\\b",name:"constant.numeric.hex.css"}}}),{id:i[i.length-1].id,grammars:i,keywords:t}}),define("examples/editor/textStyler",["orion/editor/annotations","orion/editor/stylers/application_javascript/syntax","orion/editor/stylers/text_x-java-source/syntax","orion/editor/stylers/text_css/syntax"],function(e,t,i,n){function o(e,t){this.keywords=e,this.whitespacesVisible=t,this.setText("")}function r(){o.call(this,null,!0)}function s(e){o.call(this,null,e)}function a(){o.call(this,null,!1)}function l(e,t,i){this.commentStart="/*",this.commentEnd="*/";var n=[];switch(t){case"java":n=d;break;case"js":n=c;break;case"css":n=h}this.whitespacesVisible=!1,this.detectHyperlinks=!0,this.highlightCaretLine=!1,this.foldingEnabled=!0,this.detectTasks=!0,this._scanner=new o(n,this.whitespacesVisible),this._firstScanner=new a,this._commentScanner=new s(this.whitespacesVisible),this._whitespaceScanner=new r,"css"===t&&(this._scanner.isCSS=!0,this._firstScanner.isCSS=!0),this.view=e,this.annotationModel=i,this._bracketAnnotations=void 0;var l=this;this._listener={onChanged:function(e){l._onModelChanged(e)},onDestroy:function(e){l._onDestroy(e)},onLineStyle:function(e){l._onLineStyle(e)},onMouseDown:function(e){l._onMouseDown(e)},onSelection:function(e){l._onSelection(e)}};var u=e.getModel();u.getBaseModel&&(u=u.getBaseModel()),u.addEventListener("Changed",this._listener.onChanged),e.addEventListener("MouseDown",this._listener.onMouseDown),e.addEventListener("Selection",this._listener.onSelection),e.addEventListener("Destroy",this._listener.onDestroy),e.addEventListener("LineStyle",this._listener.onLineStyle),this._computeComments(),this._computeFolding(),e.redrawLines()}var c=t.keywords,d=i.keywords,h=n.keywords,u=1,p=2,f=3,g=4,m=5,v=6,_=7,y=8,C=9,w=10,b=11,S=12,x=13,L=14,T="{}()[]<>",E={styleClass:"comment"},k={styleClass:"comment"},N={styleClass:"comment block documentation"},A={styleClass:"meta documentation tag"},R={styleClass:"keyword other documentation task"},I={styleClass:"meta documentation annotation"},D={styleClass:"string"},P={styleClass:"constant numeric"},M={styleClass:"keyword"},O={styleClass:"punctuation separator space",unmergeable:!0},B={styleClass:"punctuation separator tab",unmergeable:!0},F={styleClass:"meta annotation currentLine"};return o.prototype={getOffset:function(){return this.offset},getStartOffset:function(){return this.startOffset},getData:function(){return this.text.substring(this.startOffset,this.offset)},getDataLength:function(){return this.offset-this.startOffset},_default:function(e){switch(e){case 32:case 9:if(this.whitespacesVisible)return 32===e?b:w;do e=this._read();while(32===e||9===e);return this._unread(e),C;case 123:case 125:case 40:case 41:case 91:case 93:case 60:case 62:return e;
default:var t=this.isCSS,i=this.offset-1;if(!t&&e>=48&&57>=e){for(var n=!1,o=!1,r=!1,s=e;;)if(e=this._read(),46!==e||n)if(101!==e||o){if(120===e&&48===s&&this.offset-i===2)n=o=r=!0;else if(!(e>=48&&57>=e||r&&(e>=65&&70>=e||e>=97&&102>=e)))break}else n=o=!0,e=this._read(),45!==e&&this._unread(e);else n=!0;return this._unread(e),f}if(e>=97&&122>=e||e>=65&&90>=e||95===e||45===e&&t){do e=this._read();while(e>=97&&122>=e||e>=65&&90>=e||95===e||e>=48&&57>=e||45===e&&t);this._unread(e);var a=this.keywords;if(a.length>0)for(var l=this.text.substring(i,this.offset),c=0;c<a.length;c++)if(this.keywords[c]===l)return p}return u}},_read:function(){return this.offset<this.text.length?this.text.charCodeAt(this.offset++):-1},_unread:function(e){-1!==e&&this.offset--},nextToken:function(){for(this.startOffset=this.offset;;){var e,t=this._read();switch(t){case-1:return null;case 47:if(t=this._read(),!this.isCSS&&47===t)for(;;)if(t=this._read(),-1===t||10===t||13===t)return this._unread(t),v;if(42===t){t=this._read();var i=_;for(42===t&&(i=y);;){for(;42===t;)if(t=this._read(),47===t)return i;if(-1===t)return this._unread(t),i;t=this._read()}}return this._unread(t),u;case 39:for(e=g;;)switch(t=this._read()){case 39:return e;case 13:case 10:case-1:return this._unread(t),e;case 92:switch(t=this._read()){case 10:e=m;break;case 13:e=m,t=this._read(),10!==t&&this._unread(t)}}break;case 34:for(e=g;;)switch(t=this._read()){case 34:return e;case 13:case 10:case-1:return this._unread(t),e;case 92:switch(t=this._read()){case 10:e=m;break;case 13:e=m,t=this._read(),10!==t&&this._unread(t)}}break;default:return this._default(t)}}},setText:function(e){this.text=e,this.offset=0,this.startOffset=0}},r.prototype=new o(null),r.prototype.nextToken=function(){for(this.startOffset=this.offset;;){var e=this._read();switch(e){case-1:return null;case 32:return b;case 9:return w;default:do e=this._read();while(32!==e&&9!==e&&-1!==e);return this._unread(e),u}}},s.prototype=new o(null),s.prototype.setType=function(e){this._type=e},s.prototype.nextToken=function(){for(this.startOffset=this.offset;;){var e=this._read();switch(e){case-1:return null;case 32:case 9:if(this.whitespacesVisible)return 32===e?b:w;do e=this._read();while(32===e||9===e);return this._unread(e),C;case 60:if(this._type===y){do e=this._read();while(62!==e&&-1!==e);if(62===e)return S}return u;case 64:if(this._type===y){do e=this._read();while(e>=97&&122>=e||e>=65&&90>=e||95===e||e>=48&&57>=e);return this._unread(e),x}return u;case 84:if(79===(e=this._read()))if(68===(e=this._read()))if(79===(e=this._read())){if(e=this._read(),!(e>=97&&122>=e||e>=65&&90>=e||95===e||e>=48&&57>=e))return this._unread(e),L;this._unread(e)}else this._unread(e);else this._unread(e);else this._unread(e);default:do e=this._read();while(32!==e&&9!==e&&-1!==e&&60!==e&&64!==e&&84!==e);return this._unread(e),u}}},a.prototype=new o(null),a.prototype._default=function(e){for(;;)switch(e=this._read()){case 47:case 34:case 39:case-1:return this._unread(e),u}},l.prototype={destroy:function(){var e=this.view;if(e){var t=e.getModel();t.getBaseModel&&(t=t.getBaseModel()),t.removeEventListener("Changed",this._listener.onChanged),e.removeEventListener("MouseDown",this._listener.onMouseDown),e.removeEventListener("Selection",this._listener.onSelection),e.removeEventListener("Destroy",this._listener.onDestroy),e.removeEventListener("LineStyle",this._listener.onLineStyle),this.view=null}},setHighlightCaretLine:function(e){this.highlightCaretLine=e},setWhitespacesVisible:function(e,t){this.whitespacesVisible!==e&&(this.whitespacesVisible=e,this._scanner.whitespacesVisible=e,this._commentScanner.whitespacesVisible=e,t&&this.view.redraw())},setDetectHyperlinks:function(e){this.detectHyperlinks=e},setFoldingEnabled:function(e){this.foldingEnabled=e},setDetectTasks:function(e){this.detectTasks=e},_binarySearch:function(e,t,i,n,o){var r;for(void 0===n&&(n=-1),void 0===o&&(o=e.length);o-n>1;)if(r=Math.floor((o+n)/2),t<=e[r].start)o=r;else{if(i&&t<e[r].end){o=r;break}n=r}return o},_computeComments:function(){var e=this.view.getModel();e.getBaseModel&&(e=e.getBaseModel()),this.comments=this._findComments(e.getText())},_computeFolding:function(){if(this.foldingEnabled){var t=this.view,i=t.getModel();if(i.getBaseModel){var n=this.annotationModel;if(n){n.removeAnnotations(e.AnnotationType.ANNOTATION_FOLDING);for(var o=[],r=i.getBaseModel(),s=this.comments,a=0;a<s.length;a++){var l=s[a],c=this._createFoldingAnnotation(i,r,l.start,l.end);c&&o.push(c)}n.replaceAnnotations(null,o)}}}},_createFoldingAnnotation:function(t,i,n,o){var r=i.getLineAtOffset(n),s=i.getLineAtOffset(o);return r===s?null:new(e.AnnotationType.getType(e.AnnotationType.ANNOTATION_FOLDING))(n,o,t)},_computeTasks:function(t,i,n){if(this.detectTasks){var o=this.annotationModel;if(o){var r=this.view,s=r.getModel(),a=s;s.getBaseModel&&(a=s.getBaseModel());for(var l=o.getAnnotations(i,n),c=[],d=e.AnnotationType.ANNOTATION_TASK;l.hasNext();){var h=l.next();h.type===d&&c.push(h)}var u=[],p=this._commentScanner;p.setText(a.getText(i,n));for(var f;f=p.nextToken();){var g=p.getStartOffset()+i;if(f===L){var m=a.getLineEnd(a.getLineAtOffset(g));t!==v&&(m=Math.min(m,n-this.commentEnd.length)),u.push(e.AnnotationType.createAnnotation(d,g,m,a.getText(g,m)))}}o.replaceAnnotations(c,u)}}},_getLineStyle:function(e){if(this.highlightCaretLine){var t=this.view,i=t.getModel(),n=t.getSelections(),o=!1;if(!n.some(function(t){return t.start===t.end?(o=o||i.getLineAtOffset(t.start)===e,!1):!0})&&o)return F}return null},_getStyles:function(e,t,i){e.getBaseModel&&(i=e.mapOffset(i));for(var n=i+t.length,o=[],r=i,s=this.comments,a=this._binarySearch(s,i,!0),l=a;l<s.length&&!(s[l].start>=n);l++){var c=s[l].start,d=s[l].end;c>r&&this._parse(t.substring(r-i,c-i),r,o);var h,u=s[l].type;switch(u){case y:h=N;break;case _:h=k;break;case m:h=D}var p=Math.max(r,c),f=Math.min(n,d);u!==y&&u!==_||!this.whitespacesVisible&&!this.detectHyperlinks?u===m&&this.whitespacesVisible?this._parseString(t.substring(p-i,f-i),p,o,D):o.push({start:p,end:f,style:h}):this._parseComment(t.substring(p-i,f-i),p,o,h,u),r=d}if(n>r&&this._parse(t.substring(r-i,n-i),r,o),e.getBaseModel)for(var g=0;g<o.length;g++){var v=o[g].end-o[g].start;o[g].start=e.mapOffset(o[g].start,!0),o[g].end=o[g].start+v}return o},_parse:function(e,t,i){var n=this._scanner;n.setText(e);for(var o;o=n.nextToken();){var r=n.getStartOffset()+t,s=null;switch(o){case p:s=M;break;case f:s=P;break;case m:case g:if(this.whitespacesVisible){this._parseString(n.getData(),r,i,D);continue}s=D;break;case y:this._parseComment(n.getData(),r,i,N,o);continue;case v:this._parseComment(n.getData(),r,i,E,o);continue;case _:this._parseComment(n.getData(),r,i,k,o);continue;case w:this.whitespacesVisible&&(s=B);break;case b:this.whitespacesVisible&&(s=O)}i.push({start:r,end:n.getOffset()+t,style:s})}},_parseComment:function(e,t,i,n,o){var r=this._commentScanner;r.setText(e),r.setType(o);for(var s;s=r.nextToken();){var a=r.getStartOffset()+t,l=n;switch(s){case w:this.whitespacesVisible&&(l=B);break;case b:this.whitespacesVisible&&(l=O);break;case S:l=A;break;case x:l=I;break;case L:l=R;break;default:this.detectHyperlinks&&(l=this._detectHyperlinks(r.getData(),a,i,l))}l&&i.push({start:a,end:r.getOffset()+t,style:l})}},_parseString:function(e,t,i,n){var o=this._whitespaceScanner;o.setText(e);for(var r;r=o.nextToken();){var s=o.getStartOffset()+t,a=n;switch(r){case w:this.whitespacesVisible&&(a=B);break;case b:this.whitespacesVisible&&(a=O)}a&&i.push({start:s,end:o.getOffset()+t,style:a})}},_detectHyperlinks:function(e,t,i,n){var o,r,s=null;if((o=e.indexOf("://"))>0){s=e;for(var a=o;a>0;){var l=s.charCodeAt(a-1);if(!(l>=97&&122>=l||l>=65&&90>=l||45===l||l>=48&&57>=l))break;a--}if(a>0){var c="\"\"''(){}[]<>";if(o=c.indexOf(s.substring(a-1,a)),-1!==o&&0===(1&o)&&-1!==(o=s.lastIndexOf(c.substring(o+1,o+2)))){var d=o;return r=this._clone(n),r.tagName="a",r.attributes={href:s.substring(a,d)},i.push({start:t,end:t+a,style:n}),i.push({start:t+a,end:t+d,style:r}),i.push({start:t+d,end:t+e.length,style:n}),null}}}else 0===e.toLowerCase().indexOf("bug#")&&(s="https://bugs.eclipse.org/bugs/show_bug.cgi?id="+parseInt(e.substring(4),10));return s?(r=this._clone(n),r.tagName="a",r.attributes={href:s},r):n},_clone:function(e){if(!e)return e;var t={};for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];t[i]=n}return t},_findComments:function(e,t){t=t||0;var i,n=this._firstScanner;n.setText(e);for(var o=[];i=n.nextToken();)(i===_||i===y||i===m)&&o.push({start:n.getStartOffset()+t,end:n.getOffset()+t,type:i}),(i===v||i===_||i===y)&&this._computeTasks(i,n.getStartOffset()+t,n.getOffset()+t);return o},_findMatchingBracket:function(e,t){var i=T,n=e.getText(t,t+1),o=i.indexOf(n,0);if(-1===o)return-1;var r;r=1&o?i.substring(o-1,o):i.substring(o+1,o+2);var s=e.getLineAtOffset(t),a=e.getLine(s),l=e.getLineStart(s),c=e.getLineEnd(s);i=this._findBrackets(n,r,a,l,l,c);for(var d=0;d<i.length;d++){var h=i[d]>=0?1:-1;if(i[d]*h-1===t){var u=1;if(1&o){for(d--;d>=0;d--)if(h=i[d]>=0?1:-1,u+=h,0===u)return i[d]*h-1;for(s-=1;s>=0;){a=e.getLine(s),l=e.getLineStart(s),c=e.getLineEnd(s),i=this._findBrackets(n,r,a,l,l,c);for(var p=i.length-1;p>=0;p--)if(h=i[p]>=0?1:-1,u+=h,0===u)return i[p]*h-1;s--}}else{for(d++;d<i.length;d++)if(h=i[d]>=0?1:-1,u+=h,0===u)return i[d]*h-1;s+=1;for(var f=e.getLineCount();f>s;){a=e.getLine(s),l=e.getLineStart(s),c=e.getLineEnd(s),i=this._findBrackets(n,r,a,l,l,c);for(var g=0;g<i.length;g++)if(h=i[g]>=0?1:-1,u+=h,0===u)return i[g]*h-1;s++}}break}}return-1},_findBrackets:function(e,t,i,n,o,r){for(var s,a=[],l=e.charCodeAt(0),c=t.charCodeAt(0),d=o,h=this._scanner,u=this.comments,p=this._binarySearch(u,o,!0),f=p;f<u.length&&!(u[f].start>=r);f++){var g=u[f].start,m=u[f].end;if(g>d)for(h.setText(i.substring(d-o,g-o));s=h.nextToken();)s===l?a.push(h.getStartOffset()+d-o+n+1):s===c&&a.push(-(h.getStartOffset()+d-o+n+1));d=m}if(r>d)for(h.setText(i.substring(d-o,r-o));s=h.nextToken();)s===l?a.push(h.getStartOffset()+d-o+n+1):s===c&&a.push(-(h.getStartOffset()+d-o+n+1));return a},_onDestroy:function(){this.destroy()},_onLineStyle:function(e){e.textView===this.view&&(e.style=this._getLineStyle(e.lineIndex)),e.ranges=this._getStyles(e.textView.getModel(),e.lineText,e.lineStart)},_onSelection:function(t){function i(e){var t={};return e.some(function(e){return e.isEmpty()?(t[l.getLineAtOffset(e.start).toString()]=!0,!1):!0})?{}:t}function n(e,t){for(var i in e)t[i]||(o=i>>0,a.redrawLines(o,o+1))}var o,r=Array.isArray(t.oldValue)?t.oldValue:[t.oldValue],s=Array.isArray(t.newValue)?t.newValue:[t.newValue],a=this.view,l=a.getModel();if(this.highlightCaretLine){var c=i(r),d=i(s);n(c,d),n(d,c)}if(this.annotationModel){var h,u,p=this._bracketAnnotations;if(1===s.length&&s[0].isEmpty()&&(u=s[0].getCaret())>0){var f=u-1;l.getBaseModel&&(f=l.mapOffset(f),l=l.getBaseModel());var g=this._findMatchingBracket(l,f);-1!==g&&(h=[e.AnnotationType.createAnnotation(e.AnnotationType.ANNOTATION_MATCHING_BRACKET,g,g+1),e.AnnotationType.createAnnotation(e.AnnotationType.ANNOTATION_CURRENT_BRACKET,f,f+1)])}this._bracketAnnotations=h,this.annotationModel.replaceAnnotations(p,h)}},_onMouseDown:function(e){if(2===e.clickCount){var t=this.view,i=t.getModel(),n=t.getOffsetAtLocation(e.x,e.y);if(n>0){var o=n-1,r=i;i.getBaseModel&&(o=i.mapOffset(o),r=i.getBaseModel());var s=this._findMatchingBracket(r,o);if(-1!==s){e.preventDefault();var a=s;i.getBaseModel&&(a=i.mapOffset(a,!0)),n>a&&(n--,a++),t.setSelection(a,n)}}}},_onModelChanged:function(t){var i,n=t.start,o=t.removedCharCount,r=t.addedCharCount,s=r-o,a=this.view,l=a.getModel(),c=l.getBaseModel?l.getBaseModel():l,d=n+o,h=c.getCharCount(),u=this.comments.length,p=c.getLineStart(c.getLineAtOffset(n)),f=this._binarySearch(this.comments,p,!0),g=this._binarySearch(this.comments,d,!1,f-1,u);u>f&&this.comments[f].start<=p&&p<this.comments[f].end?(i=this.comments[f].start,i>n&&(i+=s)):i=f===u&&u>0&&h-s===this.comments[u-1].end?this.comments[u-1].start:p;var m;u>g?(m=this.comments[g].end,m>n&&(m+=s),g+=1):(g=u,m=h);var v,_,y=c.getText(i,m),C=this._findComments(y,i);for(_=f;_<this.comments.length;_++)v=this.comments[_],v.start>n&&(v.start+=s),v.start>n&&(v.end+=s);var w=g-f!==C.length;if(!w)for(_=0;_<C.length;_++){v=this.comments[f+_];var b=C[_];if(v.start!==b.start||v.end!==b.end||v.type!==b.type){w=!0;break}}var S=[f,g-f].concat(C);if(Array.prototype.splice.apply(this.comments,S),w){var x=i,L=m;l!==c&&(x=l.mapOffset(x,!0),L=l.mapOffset(L,!0)),a.redrawRange(x,L)}if(this.foldingEnabled&&c!==l&&this.annotationModel){for(var T,E=this.annotationModel,k=E.getAnnotations(i,m),N=[],A=[];k.hasNext();)if(T=k.next(),T.type===e.AnnotationType.ANNOTATION_FOLDING){for(A.push(T),_=0;_<C.length&&(T.start!==C[_].start||T.end!==C[_].end);_++);if(_===C.length)N.push(T),T.expand();else{var R=T.start,I=T.end;if(R>n&&(R-=s),I>n&&(I-=s),n>=R&&I>n&&d>=R&&I>d){var D=c.getLineAtOffset(T.start),P=c.getLineAtOffset(T.end);D!==P?T.expanded||T.expand():E.removeAnnotation(T)}}}var M=[];for(_=0;_<C.length;_++){v=C[_];for(var O=0;O<A.length&&(A[O].start!==v.start||A[O].end!==v.end);O++);O===A.length&&(T=this._createFoldingAnnotation(l,c,v.start,v.end),T&&M.push(T))}E.replaceAnnotations(N,M)}}},{TextStyler:l}}),define("orion/editor/textStyler",["orion/editor/annotations","orion/editor/eventTarget","orion/metrics"],function(e,t,i){function n(e){return JSON.parse(JSON.stringify(e))}function o(e,t,i){this._patternManager=new r(e,t),this._contentType=i}function r(e,t){this._unnamedCounter=0,this._patterns=[],this._rootId=t,e.forEach(function(e){this._addRepositoryPatterns(e.repository||{},e.id),this._addPatterns(e.patterns||[],e.id)}.bind(this))}function s(e,t,i,n,o,r,s){this.start=e.start,this.end=e.end,this.contentStart=e.contentStart,this.contentEnd=e.contentEnd,this.name=t,this.typeId=i,this.styler=n,this.parent=r,s&&s(this),this._subBlocks=n.computeBlocks(o,o.getText(this.contentStart,this.end),this,this.contentStart,null,null,null)}function a(e){this._styler=e}function l(t,n,o){this._whitespacesVisible=!1,this._highlightCaretLine=!1,this._foldingEnabled=!0,this._detectTasks=!0,this._annotationProviders=[],this._view=t,this._annotationModel=n,this._stylerAdapter=o,this._stylerAdapter.setStyler(this),this._accessor=new a(this),this._bracketAnnotations;var r=this;this._listener={onChanged:function(e){r._onModelChanged(e)},onDestroy:function(e){r._onDestroy(e)},onLineStyle:function(e){r._onLineStyle(e)},onMouseDown:function(e){r._onMouseDown(e)},onSelection:function(e){r._onSelection(e)}};var s=t.getModel();s.getBaseModel&&(s=s.getBaseModel()),s.addEventListener("Changed",this._listener.onChanged),t.addEventListener("MouseDown",this._listener.onMouseDown),t.addEventListener("Selection",this._listener.onSelection),t.addEventListener("Destroy",this._listener.onDestroy),t.addEventListener("LineStyle",this._listener.onLineStyle);var l=s.getCharCount(),c={start:0,contentStart:0,end:l,contentEnd:l};if(l>=5e4)var d=(new Date).getTime();if(this._rootBlock=this._stylerAdapter.createBlock(c,this,s,null),d){var h=(new Date).getTime()-d;h>10&&i.logTiming("editor","styler compute blocks (ms/50000 chars)",5e4*h/l,o.getContentType())}if(n){var u=[];n.removeAnnotations(e.AnnotationType.ANNOTATION_FOLDING),this._computeFolding(this._rootBlock.getBlocks(),t.getModel(),u),this._detectTasks&&(n.removeAnnotations(e.AnnotationType.ANNOTATION_TASK),this._computeTasks(this._rootBlock,s,u)),n.replaceAnnotations([],u)}t.redrawLines()}var c=function(e,t,i,n,o){var r;for(void 0===n&&(n=-1),void 0===o&&(o=e.length);o-n>1;)if(r=Math.floor((o+n)/2),t<=e[r].start)o=r;else{if(i&&t<e[r].end){o=r;break}n=r}return o},d=function(e,t,i){return new o(e,t,i)};return o.prototype={blockSpansBeyondEnd:function(e){return e.pattern.regexEnd===this._eolRegex},computeBlocks:function(e,t,i,n,o,r,s){if(!t)return[];var a,l=[],c=[];if(o=o||0,r=r||1/0,s=s||1/0,i.blockPatterns.forEach(function(e){a=this._findMatch(e.regexBegin||e.regex,t,o),a&&c.push({result:a,pattern:e})}.bind(this)),!c.length)return l;c.sort(function(e,t){return e.result.index<t.result.index?-1:e.result.index>t.result.index?1:e.pattern.pattern.index<t.pattern.pattern.index?-1:1});for(var d=0;c.length>0;){var h=c[0];if(c.splice(0,1),r<h.result.index)break;if(h.result.index<d)this._updateMatch(h,t,c,d,r);else{var u=n+h.result.index,p=h.result.index,f=null,g=h.pattern.regexEnd;if(g){p+=h.result[0].length;var m=h.pattern,v=this._substituteCaptureValues(g,h.result);v!==g&&(m={pattern:m.pattern,regexBegin:m.regexBegin,regexEnd:v},g=v);for(var _=p;!f;){a=this._findMatch(g,t,_),a||(this._eolRegex.lastIndex=0,a=this._eolRegex.exec(t),m={pattern:m.pattern,regexBegin:m.regexBegin,regexEnd:this._eolRegex});var y=this.createBlock({start:u,end:n+a.index+a[0].length,contentStart:n+p,contentEnd:n+a.index},i.styler,e,i,m),C=y.getBlocks();(!C.length||C[C.length-1].end<=a.index+n)&&(f=y),_=a.index+a[0].length}}else f=this.createBlock({start:u,end:u+h.result[0].length,contentStart:u,contentEnd:u+h.result[0].length},i.styler,e,i,h.pattern);if(l.push(f),l.length===s||r<=f.end)break;d=f.end-n,this._updateMatch(h,t,c,d,r)}}return l},computeStyle:function(e,t,i){if(!e.pattern)return null;var n={start:e.start,end:e.end,style:e.pattern.pattern.name};if(e.contentStart<=i&&i<e.contentEnd)return e.pattern.pattern.contentName?{start:e.contentStart,end:e.contentEnd,style:e.pattern.pattern.contentName}:n;var o,r,s,a;if(i<e.contentStart){if(r=e.pattern.pattern.beginCaptures||e.pattern.pattern.captures,!r)return n;o=e.pattern.regexBegin,s=t.getText(e.start,e.contentStart),a=e.start}else{if(r=e.pattern.pattern.endCaptures||e.pattern.pattern.captures,!r)return n;o=e.pattern.regexEnd,s=t.getText(e.contentEnd,e.end),a=e.contentEnd}o.lastIndex=0;var l=o.exec(s);if(l){var d=[];this._getCaptureStyles(l,r,a,d);var h=d[c(d,i,!0)];if(h&&h.start<=i&&i<h.end)return h}return n},createBlock:function(e,t,i,n,o){return new s(e,o?o.pattern.name:null,o?o.pattern.id:null,t,i,n,function(e){e.pattern=o,e.linePatterns=[],e.blockPatterns=[],e.enclosurePatterns={},this._initPatterns(this._patternManager,e)}.bind(this))},getBlockContentStyleName:function(e){return e.pattern.pattern.contentName||e.pattern.pattern.name},getBlockEndStyle:function(e,t,i,n){var o;if(e.pattern.regexEnd&&(o=this._findMatch(e.pattern.regexEnd,t,0))){var r=e.pattern.pattern.endCaptures||e.pattern.pattern.captures;r?this._getCaptureStyles(o,r,i-o[0].length,n):e.pattern.pattern.name&&n.push({start:i-o[0].length,end:i,style:e.pattern.pattern.name})}return o?o[0]:null},getBlockFoldBounds:function(e){return{start:e.start,end:e.end}},getBlockStartStyle:function(e,t,i,n){var o;if(e.pattern.regexBegin&&(o=this._findMatch(e.pattern.regexBegin,t,0))){var r=e.pattern.pattern.beginCaptures||e.pattern.pattern.captures;r?this._getCaptureStyles(o,r,i,n):n.push({start:i,end:i+o[0].length,style:e.pattern.pattern.name})}return o?o[0]:null},getBracketMatch:function(e,t){for(var i,n=Object.keys(e.enclosurePatterns),o=0;o<n.length;o++){var r=e.enclosurePatterns[n[o]],s=this._findMatch(r.regex,t,0);if(s&&0===s.index){i=r;break}}if(!i)return null;var a,l=!1;-1!==i.pattern.name.indexOf(this._PUNCTUATION_SECTION_BEGIN)?(l=!0,a=i.pattern.name.replace(this._PUNCTUATION_SECTION_BEGIN,this._PUNCTUATION_SECTION_END)):a=i.pattern.name.replace(this._PUNCTUATION_SECTION_END,this._PUNCTUATION_SECTION_BEGIN);var c=e.enclosurePatterns[a];return c?{beginName:i.pattern.name,endName:a,atStart:l}:null},getContentType:function(){return this._contentType},parse:function(e,t,i,n,o,r){if(e){var s=n.linePatterns;if(s){var a,l=[];s.forEach(function(t){var n=t.regex||t.regexBegin;n.oldLastIndex=n.lastIndex,a=this._findMatch(n,e,i),a&&l.push({result:a,pattern:t})}.bind(this)),l.sort(function(e,t){return e.result.index<t.result.index?-1:e.result.index>t.result.index?1:e.pattern.pattern.index<t.pattern.pattern.index?-1:1});for(var c=i;l.length>0;){var d=l[0];if(l.splice(0,1),d.result.index<c)this._updateMatch(d,e,l,c);else{var h,u=d.result.index,p=[];if(d.pattern.regex){a=d.result,h=u+a[0].length;var f={start:t+u,end:t+h,style:d.pattern.pattern.name};if(!r){d.pattern.pattern.captures&&this._getCaptureStyles(a,d.pattern.pattern.captures,t+u,p),p.sort(function(e,t){return e.start<t.start?-1:e.start>t.start?1:0});for(var g=0;g<p.length-1;g++)if(p[g+1].start<p[g].end){var m={start:p[g+1].end,end:p[g].end,style:p[g].style};p[g].end=p[g+1].start,p.splice(g+2,0,m)}}this._mergeStyles(f,p,o)}else{var v=d.pattern.regexEnd;v=this._substituteCaptureValues(v,d.result),a=this._findMatch(v,e,d.result.index+d.result[0].length),a||(this._eolRegex.lastIndex=0,a=this._eolRegex.exec(e)),h=a.index+a[0].length,o.push({start:t+u,end:t+h,style:d.pattern.pattern.name})}c=a.index+a[0].length,this._updateMatch(d,e,l,c)}}s.forEach(function(e){var t=e.regex||e.regexBegin;t.lastIndex=t.oldLastIndex})}}},setStyler:function(){},verifyBlock:function(e,t,i,n){var o,r=null,s=[],a=i.parent;if(a.blockPatterns.forEach(function(e){o=this._findMatch(e.regexBegin||e.regex,t,0),o&&s.push({result:o,pattern:e})}.bind(this)),s.sort(function(e,t){return!e.result.index&&t.result.index?-1:e.result.index&&!t.result.index?1:e.result.index||t.result.index?0:e.pattern.pattern.index<t.pattern.pattern.index?-1:1}),s.length&&0===s[0].result.index&&s[0].pattern.pattern.id===i.pattern.pattern.id){o=s[0];var l=o.pattern.regexEnd;if(l){l=this._substituteCaptureValues(l,o.result);for(var c=o.result[0].length,d=this._findMatch(l,t,c);null===r&&d&&i.start+d.index!==i.contentEnd+n;){var h=this.computeBlocks(e,t,i,i.start,c,d.index+1,null);!h.length||h[h.length-1].end<=i.start+d.index?r=!1:h.length?(c=h[h.length-1].end-i.start,d=this._findMatch(l,t,c)):d=null}d||(this._eolRegex.lastIndex=0,d=this._eolRegex.exec(t),r=i.start+d.index===i.end+n)}else r=i.start+o.result[0].length===i.end+n}else r=!1;return null!==r?r:!0},_findMatch:function(e,t,i,n){var o=i,r=e.lastIndex;this._linebreakRegex.lastIndex=i;var s,a,l=this._linebreakRegex.exec(t);if(e.lastIndex=0,l){for(var c=l.index;0<=--c;){var d=t.charAt(c);if(d===this._NEWLINE||d===this._CR)break}s=t.substring(c+1,l.index+l[1].length),e.lastIndex=a=l.index-c-1}for(;l&&l.index<t.length;){var h;if(n){var u=e.lastIndex;e.test(s)&&(e.lastIndex=u,h=e.exec(s))}else h=e.exec(s);if(h)return h.index+=o,h.index-=a,e.lastIndex=r,h;a=0,o+=l[0].length,l=this._linebreakRegex.exec(t),l&&(s=l[1],e.lastIndex=0)}return e.lastIndex=r,null},_getCaptureStyles:function(e,t,i,n){if(t[0])return void n.push({start:i,end:i+e[0].length,style:t[0].name});for(var o=0,r=1;r<e.length;r++)if(e[r]){var s=t[r];if(s){var a=i+o;n.push({start:a,end:a+e[r].length,style:s.name})}o+=e[r].length}},_initPatterns:function(e,t){if(t.pattern&&t.pattern.pattern.linePatterns)return t.linePatterns=t.pattern.pattern.linePatterns,t.blockPatterns=t.pattern.pattern.blockPatterns,void(t.enclosurePatterns=t.pattern.pattern.enclosurePatterns);var i=e.getPatterns(t.pattern?t.pattern.pattern:null),n=function(e){var t="string"==typeof e?e:e.match,i=this._ignoreCaseRegex.exec(t),n=this._FLAGS;return i&&(t=t.substring(i[0].length),n+="i"),new RegExp(t,n)}.bind(this),o=-1,r=0;i.forEach(function(e){var i;!e.match||e.begin||e.end?!e.match&&e.begin&&e.end&&(o=r,i={regexBegin:n(e.begin),regexEnd:n(e.end),pattern:e},t.linePatterns.push(i)):(i={regex:n(e.match),pattern:e},t.linePatterns.push(i),!e.name||0!==e.name.indexOf("punctuation.section")||-1===e.name.indexOf(this._PUNCTUATION_SECTION_BEGIN)&&-1===e.name.indexOf(this._PUNCTUATION_SECTION_END)||(t.enclosurePatterns[e.name]=i)),r++}.bind(this)),t.blockPatterns=t.linePatterns.slice(0,o+1),t.pattern&&(t.pattern.pattern.enclosurePatterns=t.enclosurePatterns,t.pattern.pattern.linePatterns=t.linePatterns,t.pattern.pattern.blockPatterns=t.blockPatterns)},_mergeStyles:function(e,t,i){var n=e.start;t.forEach(function(t){n<=t.start&&i.push({start:n,end:t.start,style:e.style}),i.push(t),n=t.end}),n<e.end&&i.push({start:n,end:e.end,style:e.style})},_substituteCaptureValues:function(e,t){var i=e.toString();if(this._captureReferenceRegex.lastIndex=0,!this._captureReferenceRegex.test(i))return e;this._captureReferenceRegex.lastIndex=0;for(var n=this._captureReferenceRegex.exec(i);n;)i=i.replace(n[0],t[n[1]]||""),this._captureReferenceRegex.lastIndex=0,n=this._captureReferenceRegex.exec(i);return new RegExp(i.substring(1,i.length-1-this._FLAGS.length),this._FLAGS)},_updateMatch:function(e,t,i,n,o){var r=e.pattern.regex?e.pattern.regex:e.pattern.regexBegin;o=o||1/0;var s=this._findMatch(r,t,n,!0);if(s&&s.index<o){e.result=s;for(var a=0;a<i.length;a++)if(s.index<i[a].result.index||s.index===i[a].result.index&&e.pattern.pattern.index<i[a].pattern.pattern.index)return void i.splice(a,0,e);i.push(e)}},_captureReferenceRegex:/\\(\d)/g,_eolRegex:/$/,_ignoreCaseRegex:/^\(\?i\)\s*/,_linebreakRegex:/(.*)(?:[\r\n]|$)/g,_CR:"\r",_FLAGS:"g",_NEWLINE:"\n",_PUNCTUATION_SECTION_BEGIN:".begin",_PUNCTUATION_SECTION_END:".end"},r.prototype={getPatterns:function(e){var t;e?(t="string"==typeof e?e:e.qualifiedId,t+="#"):t=this._rootId+"#"+this._NO_ID;var i=[0],o={},r=new RegExp("^"+t+"[^#]+$");this._patterns.forEach(function(e){if(r.test(e.qualifiedId))if(e.include)this._processInclude(e,i,o);else{var t=n(e);t.index=i[0]++,o[e.qualifiedId]=t}}.bind(this));var s=[],a=Object.keys(o);return a.forEach(function(e){s.push(o[e])}),s},_addPattern:function(e,t,i){e.parentId=i,e.id=t,e.qualifiedId=e.parentId+"#"+e.id,this._patterns.push(e),e.patterns&&!e.include&&this._addPatterns(e.patterns,e.qualifiedId)},_addPatterns:function(e,t){e.forEach(function(e){this._addPattern(e,this._NO_ID+this._unnamedCounter++,t)}.bind(this))},_addRepositoryPatterns:function(e,t){var i=Object.keys(e);i.forEach(function(i){this._addPattern(e[i],i,t)}.bind(this))},_processInclude:function(e,t,i){var o,r=e.include.indexOf("#");o=new RegExp(0===r?"^"+e.qualifiedId.substring(0,e.qualifiedId.indexOf("#"))+e.include+"$":-1===r?"^"+e.include+"#"+this._NO_ID+"[^#]+$":"^"+e.include+"$"),this._patterns.forEach(function(e){if(o.test(e.qualifiedId))if(e.include)this._processInclude(e,t,i);else if(!i[e.qualifiedId]){var r=n(e);r.index=t[0]++,i[e.qualifiedId]=r}}.bind(this))},_NO_ID:"NoID"},s.prototype={adjustBounds:function(e,t){e<this.start&&(this.start+=t),e<this.contentStart&&(this.contentStart+=t),e<=this.end&&(this.end+=t),e<=this.contentEnd&&(this.contentEnd+=t),this._subBlocks.forEach(function(i){e<=i.end&&i.adjustBounds(e,t)})},getBlocks:function(){return this._subBlocks},getBlockAtIndex:function(e){return c(this.getBlocks(),e,!0)},isRenderingWhitespace:function(){return this.styler._isRenderingWhitespace()}},a.prototype={getStyles:function(e){return this._styler.getStyles(e)}},l.prototype={addAnnotationProvider:function(e){"function"==typeof e&&this._annotationProviders.push(e)},computeBlocks:function(e,t,i,n,o,r,s){return this._stylerAdapter.computeBlocks(e,t,i,n,o,r,s)},destroy:function(){if(this._view){var e=this._view.getModel();e.getBaseModel&&(e=e.getBaseModel()),e.removeEventListener("Changed",this._listener.onChanged),this._view.removeEventListener("MouseDown",this._listener.onMouseDown),this._view.removeEventListener("Selection",this._listener.onSelection),this._view.removeEventListener("Destroy",this._listener.onDestroy),this._view.removeEventListener("LineStyle",this._listener.onLineStyle),this._view=null}},getAnnotationModel:function(){return this._annotationModel},getBlockAtIndex:function(e){return this._findBlock(this._rootBlock,e)},getRootBlock:function(){return this._rootBlock},getStyleAccessor:function(){return this._accessor},getStyles:function(e){var t=[],i=this._view.getModel();i.getBaseModel&&(i=i.getBaseModel());var n=this._findBlock(this._rootBlock,e),o=i.getLineAtOffset(e),r=i.getLine(o),s=[];this._stylerAdapter.parse(r,i.getLineStart(o),0,n,s);var a=s[c(s,e,!0)];for(a&&a.start<=e&&e<a.end&&t.push(a);n;)a=this._stylerAdapter.computeStyle(n,i,e),a&&t.splice(0,0,a),n=n.parent;return t},getTextModel:function(){var e=this._view.getModel();return e.getBaseModel&&(e=e.getBaseModel()),e},removeAnnotationProvider:function(e){if("function"==typeof e){var t=this._annotationProviders.indexOf(e);-1!==t&&this._annotationProviders.splice(t,1)}},setDetectHyperlinks:function(){},setDetectTasks:function(e){this._detectTasks=e},setFoldingEnabled:function(e){this._foldingEnabled=e},setHighlightCaretLine:function(e){this._highlightCaretLine=e},setWhitespacesVisible:function(e,t){this._whitespacesVisible!==e&&(this._whitespacesVisible=e,t&&this._view.redraw())},_computeFolding:function(e,t,i){if(t.getBaseModel){var n=t.getBaseModel();e.forEach(function(e){var o=this._stylerAdapter.getBlockFoldBounds(e,n),r=this._createFoldingAnnotation(t,n,o.start,o.end);r&&i.push(r),this._computeFolding(e.getBlocks(),t,i)}.bind(this))}},_computeTasks:function(t,i,n,o,r){if(o=o||t.start,r=r||t.end,t.start<=r&&o<=t.end){if(!this._annotationModel)return;var s=e.AnnotationType.ANNOTATION_TASK;if(t.name&&0===t.name.indexOf("comment")){var a=[],l=i.getLineAtOffset(t.contentStart),c=i.getLineStart(l);this._stylerAdapter.parse(i.getText(c,t.end),c,t.contentStart-c,t,a,!0);for(var d=0;d<a.length;d++)"meta.annotation.task.todo"===a[d].style&&o<=a[d].start&&a[d].end<=r&&n.push(e.AnnotationType.createAnnotation(s,a[d].start,a[d].end,i.getText(a[d].start,a[d].end)))}t.getBlocks().forEach(function(e){this._computeTasks(e,i,n,o,r)}.bind(this))}},_createFoldingAnnotation:function(t,i,n,o){var r=i.getLineAtOffset(n),s=i.getLineAtOffset(o);return r===s?null:r+1===s&&i.getLineStart(s)===i.getLineEnd(s)?null:new(e.AnnotationType.getType(e.AnnotationType.ANNOTATION_FOLDING))(n,o,t)},_findBlock:function(e,t){var i=e.getBlocks();if(!i.length)return e;var n=c(i,t,!0);return n<i.length&&i[n].start<=t&&t<i[n].end?this._findBlock(i[n],t):e},_findBrackets:function(e,t,i,n,o,r){for(var s=[],a=[],l=o,d=i.getBlocks(),h=c(d,o,!0),u=h;u<d.length&&!(d[u].start>=r);u++){var p=d[u].start,f=d[u].end;if(p>l){var g=e.getLineAtOffset(l),m=e.getLineStart(g);this._stylerAdapter.parse(n.substring(m-o,p-o),m,l-m,i,a),a.forEach(function(e){e.style&&(0===e.style.indexOf(t.beginName)?s.push(e.start+1):0===e.style.indexOf(t.endName)&&s.push(-(e.start+1)))}),a=[]}l=f}return r>l&&(g=e.getLineAtOffset(l),m=e.getLineStart(g),this._stylerAdapter.parse(n.substring(m-o,r-o),m,l-m,i,a),a.forEach(function(e){e.style&&(0===e.style.indexOf(t.beginName)?s.push(e.start+1):0===e.style.indexOf(t.endName)&&s.push(-(e.start+1)))})),s},_findMatchingBracket:function(e,t,i){var n=e.getLineAtOffset(i),o=e.getLineEnd(n),r=e.getText(i,o),s=this._stylerAdapter.getBracketMatch(t,r);if(!s)return-1;for(var a=e.getLine(n),l=e.getLineStart(n),c=this._findBrackets(e,s,t,a,l,o),d=0;d<c.length;d++){var h=c[d]>=0?1:-1;if(c[d]*h-1===i){var u=1;if(s.atStart){for(d++;d<c.length;d++)if(h=c[d]>=0?1:-1,u+=h,0===u)return c[d]*h-1;n+=1;for(var p=e.getLineCount();p>n;){a=e.getLine(n),l=e.getLineStart(n),o=e.getLineEnd(n),c=this._findBrackets(e,s,t,a,l,o);for(var f=0;f<c.length;f++)if(h=c[f]>=0?1:-1,u+=h,0===u)return c[f]*h-1;n++}}else{for(d--;d>=0;d--)if(h=c[d]>=0?1:-1,u+=h,0===u)return c[d]*h-1;for(n-=1;n>=0;){a=e.getLine(n),l=e.getLineStart(n),o=e.getLineEnd(n),c=this._findBrackets(e,s,t,a,l,o);for(var g=c.length-1;g>=0;g--)if(h=c[g]>=0?1:-1,u+=h,0===u)return c[g]*h-1;n--}}break}}return-1},_getLineStyle:function(e){if(this._highlightCaretLine){var t=this._view,i=t.getModel(),n=t.getSelections(),o=!1;if(!n.some(function(t){return t.start===t.end?(o=o||i.getLineAtOffset(t.start)===e,!1):!0})&&o)return this._caretLineStyle}return null},_getStyles:function(e,t,i,n,o){for(var r=n+i.length,s=[],a=n+o,l=e.getBlocks(),d=c(l,a,!0),h=d;h<l.length&&!(l[h].start>=r);h++){var u=l[h].start,p=l[h].end;if(u>a){var f=t.getLineAtOffset(a),g=t.getLineStart(f);this._stylerAdapter.parse(i.substring(g-n,u-n),g,a-g,e,s)}var m=Math.max(a,u);if(m===u){var v=this._stylerAdapter.getBlockStartStyle(l[h],i.substring(m-n),m,s);v&&(m+=v.length)}var _=Math.min(r,p),y=[];if(_===p){var C=i.substring(_-a-(l[h].end-l[h].contentEnd)),w=this._stylerAdapter.getBlockEndStyle(l[h],C,_,y);
w&&(_-=w.length)}f=t.getLineAtOffset(m),g=t.getLineStart(f);var b=this._getStyles(l[h],t,i.substring(g-n,_-n),g,m-g),S=this._stylerAdapter.getBlockContentStyleName(l[h]);if(S){var x=m;b.forEach(function(e){e.start-x&&s.push({start:x,end:e.start,style:S}),e.mergeable&&(e.style+=","+S),s.push(e),x=e.end}),_-x&&s.push({start:x,end:_,style:S})}else s=s.concat(b);s=s.concat(y),a=p}return r>a&&(f=t.getLineAtOffset(a),g=t.getLineStart(f),this._stylerAdapter.parse(i.substring(g-n,r-n),g,a-g,e,s)),s},_isRenderingWhitespace:function(){return this._whitespacesVisible},_onDestroy:function(){this.destroy()},_onLineStyle:function(e){e.textView===this._view&&(e.style=this._getLineStyle(e.lineIndex));var t=e.lineStart,i=e.textView.getModel();if(i.getBaseModel){t=i.mapOffset(t);var n=i.getBaseModel()}e.ranges=this._getStyles(this._rootBlock,n||i,e.lineText,t,0);for(var o=e.ranges.length-1;o>=0;o--){var r=e.ranges[o];if(r.style){if(r.style={styleClass:r.style.replace(/\./g," ")},n){var s=r.end-r.start;r.start=i.mapOffset(r.start,!0),r.end=r.start+s}}else e.ranges.splice(o,1)}this._isRenderingWhitespace()&&(this._spliceStyles(this._spacePattern,e.ranges,e.lineText,e.lineStart),this._spliceStyles(this._tabPattern,e.ranges,e.lineText,e.lineStart))},_onModelChanged:function(t){for(var i,n,o,r,s,a,l,d=t.start,h=t.removedCharCount,u=t.addedCharCount,p=u-h,f=this._view.getModel(),g=f.getBaseModel?f.getBaseModel():f,m=d+h,v=g.getCharCount(),_=g.getLineStart(g.getLineAtOffset(d)),y=this._findBlock(this._rootBlock,d);;){if(o=y.parent,!i&&o){if(0>p&&y.end-d<=-p){y=o;continue}if(s=g.getText(y.start,Math.min(v,y.end+p+1)),!this._stylerAdapter.verifyBlock(g,s,y,p)){y=o;continue}}n=y.getBlocks();var C=n.length,w=c(n,_,!0),b=c(n,m,!1,w-1,C);if(i=!1,w&&n.length&&n[w-1].end===d){s=g.getText(n[w-1].start,Math.min(v,d+1));var S=this.computeBlocks(g,s,y,n[w-1].start,null,null,null);S.length&&S[0].end!==n[w-1].end&&(w--,i=!0)}C>w&&n[w].start<=_&&(_<n[w].end||i)?(l=n[w].start,l>d&&(l+=p)):w===C&&C>0&&y.end-p===n[C-1].end?(l=n[--w].start,l>d&&(l+=p)):l=Math.max(_,y.contentStart),a=C>b?n[b].end:y.contentEnd,a>=d&&(a+=p),a=Math.min(a,v-1),s=g.getText(l,a+1);var x=this.computeBlocks(g,s,y,l,null,null,null);if(C>b){if(x.length&&x[x.length-1].end===a&&x[x.length-1].typeId===n[b].typeId)break;if(x.length&&this._stylerAdapter.blockSpansBeyondEnd(x[x.length-1])){b++;for(var L=x[x.length-1].getBlocks(),T=(L.length?L[L.length-1]:x[x.length-1]).typeId;C>b;){if(n[b].typeId===T){var E=n[b].end+p;E=Math.min(E,v-1),s=g.getText(l,E+1);var k=this.computeBlocks(g,s,y,l,null,null,null);if(k.length&&k[k.length-1].end===E){a=E,x=k;break}}b++}if(C>b)break}}else if(!x.length||x[x.length-1].end<=y.contentEnd+p)break;if(!o){a=v,b=C,s=g.getText(l,a),x=this.computeBlocks(g,s,y,l,null,null,null);break}y=o,r=!0}this._rootBlock.adjustBounds(d,p),b=Math.min(b+1,C);var N;if(r||(r=b-w!==x.length),!r)for(var A=0;A<x.length;A++){N=n[w+A];var R=x[A];if(N.start!==R.start||N.end!==R.end||N.typeId!==R.typeId){r=!0;break}}if(n.length||x.length)this.dispatchEvent({type:"BlocksChanged",oldBlocks:n.slice(w,b),newBlocks:x});else{var I=[y],D=[y];this.dispatchEvent({type:"BlocksChanged",oldBlocks:I,newBlocks:D}),y=D[0]}var P=[w,b-w].concat(x);if(Array.prototype.splice.apply(n,P),r){var M=l,O=a;f!==g&&(M=f.mapOffset(M,!0),O=f.mapOffset(O,!0)),this._view.redrawRange(M,O)}if(this._annotationModel){for(var B=[],F=[],j=[],V=this._annotationModel.getAnnotations(l,a),U=this._foldingEnabled&&g!==f,W=y.parent||y;V.hasNext();){var z=V.next();if(U&&z.type===e.AnnotationType.ANNOTATION_FOLDING){for(j.push(z),N=this._findBlock(W,z.start);N;){var H=this._stylerAdapter.getBlockFoldBounds(N,g);if(z.start===H.start&&z.end===H.end)break;N=N.parent}if(N&&z.start===H.start&&z.end===H.end){var G=z.start,$=z.end;if(G>d&&(G-=p),$>d&&($-=p),d>=G&&$>d&&m>=G&&$>m){var K=g.getLineAtOffset(z.start),Y=g.getLineAtOffset(z.end);K!==Y?z.expanded||z.expand():B.push(z)}}else B.push(z),z.expand()}else z.type===e.AnnotationType.ANNOTATION_TASK&&y.start<=z.start&&z.end<=y.end&&B.push(z)}U&&W.getBlocks().forEach(function(e){this._updateFolding(e,g,f,j,F,l,a)}.bind(this)),this._detectTasks&&this._computeTasks(y,g,F,l,a),this._annotationProviders.forEach(function(e){var t=[],i=[];e(this._annotationModel,g,y,l,a,t,i),B=B.concat(t),F=F.concat(i)}.bind(this)),this._annotationModel.replaceAnnotations(B,F)}},_onMouseDown:function(e){if(2===e.clickCount){var t=this._view.getModel(),i=this._view.getOffsetAtLocation(e.x,e.y);if(i>0){var n=i-1,o=t;t.getBaseModel&&(n=t.mapOffset(n),o=t.getBaseModel());var r=this._findBlock(this._rootBlock,n),s=this._findMatchingBracket(o,r,n);if(-1!==s){e.preventDefault();var a=s;t.getBaseModel&&(a=t.mapOffset(a,!0)),i>a&&(i--,a++),this._view.setSelection(a,i)}}}},_onSelection:function(t){function i(e){var t={};return e.some(function(e){return e.isEmpty()?(t[l.getLineAtOffset(e.start).toString()]=!0,!1):!0})?{}:t}function n(e,t){for(var i in e)t[i]||(o=i>>0,a.redrawLines(o,o+1))}var o,r=Array.isArray(t.oldValue)?t.oldValue:[t.oldValue],s=Array.isArray(t.newValue)?t.newValue:[t.newValue],a=this._view,l=a.getModel();if(this._highlightCaretLine){var c=i(r),d=i(s);n(c,d),n(d,c)}if(this._annotationModel){var h,u,p=this._bracketAnnotations;if(1===s.length&&s[0].isEmpty()&&(u=s[0].getCaret())>0){var f=u-1;l.getBaseModel&&(f=l.mapOffset(f),l=l.getBaseModel());var g=this._findBlock(this._rootBlock,f),m=this._findMatchingBracket(l,g,f);-1!==m&&(h=[e.AnnotationType.createAnnotation(e.AnnotationType.ANNOTATION_MATCHING_BRACKET,m,m+1),e.AnnotationType.createAnnotation(e.AnnotationType.ANNOTATION_CURRENT_BRACKET,f,f+1)])}this._bracketAnnotations=h,this._annotationModel.replaceAnnotations(p,h)}},_spliceStyles:function(e,t,i,o){var r=e.regex;r.lastIndex=0;for(var s=0,a=r.exec(i);a;){for(var l=o+a.index;s<t.length&&!(l<t[s].end);)s++;var c={start:l,end:l+1,style:n(e.style)};if(s<t.length&&t[s].start<=l){var d={start:l+1,end:t[s].end,style:t[s].style};t[s].end=l,t.splice(s+1,0,d),t.splice(s+1,0,c),s+=2,c.style.styleClass+=" "+t[s].style.styleClass}else t.splice(s,0,c),s++;a=r.exec(i)}},_updateFolding:function(e,t,i,n,o,r,s){r=r||e.start,s=s||e.end;var a=this._stylerAdapter.getBlockFoldBounds(e,t);if(!e.doNotFold&&a.start<=s&&r<=a.end){var l=c(n,a.start,!0);if(!(l<n.length&&n[l].start===a.start&&n[l].end===a.end)){var d=this._createFoldingAnnotation(i,t,a.start,a.end);d&&o.push(d)}e.getBlocks().forEach(function(e){this._updateFolding(e,t,i,n,o,r,s)}.bind(this))}},_caretLineStyle:{styleClass:"meta annotation currentLine"},_spacePattern:{regex:/[ ]/g,style:{styleClass:"punctuation separator space",unmergeable:!0}},_tabPattern:{regex:/\t/g,style:{styleClass:"punctuation separator tab",unmergeable:!0}}},t.EventTarget.addMixin(l.prototype),{TextStyler:l,Block:s,createPatternBasedAdapter:d}}),define("orion/editor/textMateStyler",["orion/regex"],function(e){function t(e){var i;if(e instanceof Array){i=new Array(e.length);for(var n=0;n<e.length;n++)i[n]=t(e[n])}else{i={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=e[o];i[o]="object"==typeof r&&null!==r?t(r):r}}return i}function i(e,i,n){this.initialize(e),this.grammar=t(i),this.externalGrammars=n?t(n):[],this._styles={},this._tree=null,this._allGrammars={},this.preprocess(this.grammar)}var n={unsupported:[{regex:/\(\?[ims\-]:/,func:function(){return"option on/off for subexp"}},{regex:/\(\?<([=!])/,func:function(e){return"="===e[1]?"lookbehind":"negative lookbehind"}},{regex:/\(\?>/,func:function(){return"atomic group"}}],toRegExp:function(e){function t(e,t){throw new Error('Unsupported regex feature "'+e+'": "'+t[0]+'" at index: '+t.index+" in "+t.input)}function i(e){for(var t="",i=!1,n=e.length,o=0;n>o;){var r=e.charAt(o);if(i||"#"!==r)if(!i&&/\s/.test(r))for(;n>o&&/\s/.test(r);)r=e.charAt(++o);else"\\"===r?(t+=r,/\s/.test(e.charAt(o+1))||(t+=e.charAt(o+1),o+=1),o+=1):"["===r?(i=!0,t+=r,o+=1):"]"===r?(i=!1,t+=r,o+=1):(t+=r,o+=1);else for(;n>o&&"\r"!==r&&"\n"!==r;)r=e.charAt(++o)}return t}var o,r="";for(e=n.processGlobalFlag("x",e,function(e){return i(e)}),e=n.processGlobalFlag("i",e,function(e){return r+="i",e}),o=0;o<this.unsupported.length;o++){var s;(s=this.unsupported[o].regex.exec(e))&&t(this.unsupported[o].func(s),s)}return new RegExp(e,r)},processGlobalFlag:function(e,t,i){function n(e,t){for(var i=0,n=e.length,o=-1,r=t;n>r&&-1===o;r++)switch(e.charAt(r)){case"\\":r++;break;case"(":i++;break;case")":i--,0===i&&(o=r)}return o}var o="(?"+e+")",r="(?"+e+":";if(t.substring(0,o.length)===o)return i(t.substring(o.length));if(t.substring(0,r.length)===r){var s=n(t,0);if(s<t.length-1)throw new Error("Only a "+r+") group that encloses the entire regex is supported in: "+t);return i(t.substring(r.length,s))}return t},hasBackReference:function(e){return/\\\d+/.test(e.source)},getSubstitutedRegex:function(t,i,n){n="undefined"==typeof n?!0:!1;for(var o=t.source.split(/(\\\d+)/g),r=[],s=0;s<o.length;s++){var a=o[s],l=/\\(\d+)/.exec(a);if(l){var c=i[l[1]]||"";r.push(n?e.escape(c):c)}else r.push(a)}return new RegExp(r.join(""))},groupify:function(e,t){for(var i=1,n=2,o=3,r=4,s=e.source,a=s.length,l=[],c=0,d=[],h=1,u=1,p=[],f={},g={},m=0;a>m;m++){var v=l[l.length-1],_=s.charAt(m);switch(_){case"(":v===r&&(l.pop(),p.push(")"),d[d.length-1].end=m);var y=a>m+2?s.charAt(m+1)+""+s.charAt(m+2):null;if("?:"===y||"?="===y||"?!"===y){var C;"?:"===y?C=i:(C=o,c++),l.push(C),d.push({start:m,end:-1,type:C}),p.push(_),p.push(y),m+=y.length}else l.push(n),d.push({start:m,end:-1,type:n,oldNum:h,num:u}),p.push(_),0===c&&(g[u]=null),f[h]=u,h++,u++;break;case")":var w=l.pop();w===o&&c--,d[d.length-1].end=m,p.push(_);break;case"*":case"+":case"?":case"}":var b=_,S=s.charAt(m-1),x=m-1;if("}"===_){for(var L=m-1;"{"!==s.charAt(L)&&L>=0;L--);S=s.charAt(L-1),x=L-1,b=s.substring(L,m+1)}var T=d[d.length-1];if(")"===S&&(T.type===n||T.type===r)){p.splice(T.start,0,"("),p.push(b),p.push(")");for(var E={start:T.start,end:p.length-1,type:r,num:T.num},k=0;k<d.length;k++)w=d[k],(w.type===n||w.type===r)&&w.start>=T.start&&w.end<=x&&(w.start+=1,w.end+=1,w.num=w.num+1,w.type===n&&(f[w.oldNum]=w.num));d.push(E),u++;break}default:if("|"!==_&&v!==n&&v!==r&&0===c&&(l.push(r),d.push({start:m,end:-1,type:r,num:u}),p.push("("),g[u]=null,u++),p.push(_),"\\"===_){var N=s.charAt(m+1);p.push(N),m+=1}}}for(;l.length;)l.pop(),p.push(")");var A=new RegExp(p.join("")),R={};t=t||f;for(var I in t)t.hasOwnProperty(I)&&(R[I]="\\"+t[I]);return A=this.getSubstitutedRegex(A,R,!1),[A,f,g]},complexCaptures:function(e){if(!e)return!1;for(var t in e)if(e.hasOwnProperty(t)&&"0"!==t)return!0;return!1}};return i.prototype={initialize:function(e){this.textView=e,this.textView.stylerOptions=this;var t=this;this._listener={onModelChanged:function(e){t.onModelChanged(e)},onDestroy:function(e){t.onDestroy(e)},onLineStyle:function(e){t.onLineStyle(e)},onStorage:function(e){t.onStorage(e)}},e.addEventListener("ModelChanged",this._listener.onModelChanged),e.addEventListener("Destroy",this._listener.onDestroy),e.addEventListener("LineStyle",this._listener.onLineStyle),e.redrawLines()},onDestroy:function(){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged),this.textView.removeEventListener("Destroy",this._listener.onDestroy),this.textView.removeEventListener("LineStyle",this._listener.onLineStyle),this.textView=null),this.grammar=null,this._styles=null,this._tree=null,this._listener=null},preprocess:function(e){for(var t=[e];0!==t.length;){var i=t.pop();if((!i._resolvedRule||!i._typedRule)&&(i._resolvedRule=this._resolve(i),i._typedRule=this._createTypedRule(i),this.addStyles(i.name),this.addStyles(i.contentName),this.addStylesForCaptures(i.captures),this.addStylesForCaptures(i.beginCaptures),this.addStylesForCaptures(i.endCaptures),i._resolvedRule!==i&&t.push(i._resolvedRule),i.patterns))for(var n=0;n<i.patterns.length;n++)t.push(i.patterns[n])}},addStyles:function(e){if(e&&!this._styles[e]){this._styles[e]=[];for(var t=e.split("."),i=0;i<t.length;i++)this._styles[e].push(t.slice(0,i+1).join("-"))}},addStylesForCaptures:function(e){for(var t in e)if(e.hasOwnProperty(t)){var i=e[t].name;this.addStyles(i)}},ContainerRule:function(){function e(e){this.rule=e,this.subrules=e.patterns}return e.prototype.valueOf=function(){return"aa"},e}(),BeginEndRule:function(){function e(e){this.rule=e,this.beginRegex=n.toRegExp(e.begin),this.endRegex=n.toRegExp(e.end),this.subrules=e.patterns||[],this.endRegexHasBackRef=n.hasBackReference(this.endRegex);var t=n.complexCaptures(e.captures),i=n.complexCaptures(e.beginCaptures)||n.complexCaptures(e.endCaptures);if(this.isComplex=t||i,this.isComplex){var o=n.groupify(this.beginRegex);this.beginRegex=o[0],this.beginOld2New=o[1],this.beginConsuming=o[2];var r=n.groupify(this.endRegex,this.beginOld2New);this.endRegex=r[0],this.endOld2New=r[1],this.endConsuming=r[2]}}return e.prototype.valueOf=function(){return this.beginRegex},e}(),MatchRule:function(){function e(e){if(this.rule=e,this.matchRegex=n.toRegExp(e.match),this.isComplex=n.complexCaptures(e.captures),this.isComplex){var t=n.groupify(this.matchRegex);this.matchRegex=t[0],this.matchOld2New=t[1],this.matchConsuming=t[2]}}return e.prototype.valueOf=function(){return this.matchRegex},e}(),_createTypedRule:function(e){return e.match?new this.MatchRule(e):e.begin?new this.BeginEndRule(e):new this.ContainerRule(e)},_resolve:function(e){var t=e;if(e.include){if(e.begin||e.end||e.match)throw new Error('Unexpected regex pattern in "include" rule '+e.include);var i=e.include;if("#"===i.charAt(0)){if(t=this.grammar.repository&&this.grammar.repository[i.substring(1)],!t)throw new Error("Couldn't find included rule "+i+" in grammar repository")}else if("$self"===i)t=this.grammar;else{if("$base"===i)throw new Error('Include "$base" is not supported');if(t=this._allGrammars[i],!t)for(var n=0;n<this.externalGrammars.length;n++){var o=this.externalGrammars[n];if(o.scopeName===i){this.preprocess(o),this._allGrammars[i]=o,t=o;break}}}}return t},ContainerNode:function(){function e(e,t){this.parent=e,this.rule=t,this.children=[],this.start=null,this.end=null}return e.prototype.addChild=function(e){this.children.push(e)},e.prototype.valueOf=function(){var e=this.rule;return"ContainerNode { "+(e.include||"")+" "+(e.name||"")+(e.comment||"")+"}"},e}(),BeginEndNode:function(){function e(e,t,i){this.parent=e,this.rule=t,this.children=[],this.setStart(i),this.end=null,this.endMatch=null,this.endRegexSubstituted=t.endRegexHasBackRef?n.getSubstitutedRegex(t.endRegex,i):null}return e.prototype.addChild=function(e){this.children.push(e)},e.prototype.getIndexInParent=function(){return this.parent?this.parent.children.indexOf(this):-1},e.prototype.setStart=function(e){this.start=e.index,this.beginMatch=e},e.prototype.setEnd=function(e){if(e&&"object"==typeof e){var t=e;this.endMatch=t,this.end=t.index+t[0].length}else{var i=e;this.endMatch=null,this.end=i}},e.prototype.shiftStart=function(e){this.start+=e,this.beginMatch.index+=e},e.prototype.shiftEnd=function(e){this.end+=e,this.endMatch&&(this.endMatch.index+=e)},e.prototype.valueOf=function(){return"{"+this.rule.beginRegex+" range="+this.start+".."+this.end+"}"},e}(),push:function(e,t){if(t)for(var i=t.length;i>0;)e.push(t[--i])},exec:function(e,t,i){var n=e.exec(t);return n&&(n.index+=i),e.lastIndex=0,n},afterMatch:function(e){return e.index+e[0].length},getEndMatch:function(e,t,i){if(e instanceof this.BeginEndNode){var n=e.rule,o=e.endRegexSubstituted||n.endRegex;return o?this.exec(o,t,i):null}return null},initialParse:function(){var e=(this.textView.getModel().getCharCount(),new this.ContainerNode(null,this.grammar._typedRule));this._tree=e,this.parse(this._tree,!1,0)},onModelChanged:function(e){var t=e.addedCharCount,i=(e.addedLineCount,e.removedCharCount),n=(e.removedLineCount,e.start);if(this._tree){var o=this.textView.getModel(),r=o.getCharCount(),s=o.getLineEnd(o.getLineAtOffset(n)-1),a=this.getFirstDamaged(s,s);s=-1===s?0:s;var l;l=a?this.parse(a,!0,s,n,t,i):r,this.textView.redrawRange(s,l)}else this.initialParse()},getFirstDamaged:function(e,t){if(0>e)return this._tree;for(var i=[this._tree],n=null;i.length;){var o=i.pop();if(!o.parent||this.isDamaged(o,e,t)){o instanceof this.BeginEndNode&&(n=o);for(var r=0;r<o.children.length;r++)i.push(o.children[r])}}return n||this._tree},isDamaged:function(e,t,i){return e.start<=i&&e.end>t},parse:function(e,t,i,n,o,r){var s=this.textView.getModel(),a=s.getLineStart(s.getLineCount()-1),l=s.getCharCount(),c=this.getInitialExpected(e,i),d=-1;if(t){e.repaired=!0,e.endNeedsUpdate=!0;var h=e.children[e.children.length-1],u=o-r,p=h?s.getLineEnd(s.getLineAtOffset(h.end+u)):-1,f=s.getLineEnd(s.getLineAtOffset(n+r));d=Math.max(p,f)}d=-1===d?l:d;for(var g=c,m=e,v=!1,_=i,y=-1;m&&(!t||d>_);){var C=this.getNextMatch(s,m,_);C||(_=_>=a?l:s.getLineStart(s.getLineAtOffset(_)+1));var w=C&&C.match,b=C&&C.rule,S=C&&C.isSub,x=C&&C.isEnd;if(S){if(_=this.afterMatch(w),b instanceof this.BeginEndRule)if(v=!0,t&&b===g.rule&&m===g.parent){var L=g;L.setStart(w),L.repaired=!0,L.endNeedsUpdate=!0,m=L,g=this.getNextExpected(g,"begin")}else{t&&(this.prune(m,g),t=!1);var T=new this.BeginEndNode(m,b,w);m.addChild(T),m=T}}else(x||_===l)&&(m instanceof this.BeginEndNode&&(w?(v=!0,y=Math.max(y,m.end),m.setEnd(w),_=this.afterMatch(w),t&&m===g&&m.parent===g.parent?(m.repaired=!0,delete m.endNeedsUpdate,g=this.getNextExpected(g,"end")):t&&(this.prune(m,g),t=!1)):(m.setEnd(l),delete m.endNeedsUpdate)),m=m.parent);t&&_>=d&&!v&&(this.prune(e,c),t=!1)}return this.removeUnrepairedChildren(e,t,i),this.cleanup(t,e,i,d,l,o,r),t?Math.max(y,_):_},removeUnrepairedChildren:function(e,t,i){if(t){for(var n=e.children,o=-1,r=0;r<n.length;r++){var s=n[r];if(!s.repaired&&this.isDamaged(s,i,Number.MAX_VALUE)){o=r;break}}-1!==o&&(e.children.length=o)}},cleanup:function(e,t,i,n,o,r,s){var a,l,c;if(e){var d=r-s,h=this.getIntersecting(n-d+1,o);for(c=this.getIntersecting(i,n),a=0;a<h.length;a++)l=h[a],!l.repaired&&l instanceof this.BeginEndNode&&(l.shiftEnd(d),l.shiftStart(d));for(a=0;a<c.length;a++)l=c[a],l.repaired&&l.endNeedsUpdate&&l.shiftEnd(d),delete l.endNeedsUpdate,delete l.repaired}else for(c=this.getIntersecting(i,n),a=0;a<c.length;a++)delete c[a].repaired},getNextMatch:function(e,t,i,n){var o=e.getLineAtOffset(i),r=e.getLineEnd(o),s=e.getText(i,r),a=[],l=[],c=[],d=[];for(this.push(a,t.rule.subrules);a.length;){var h=a.length?a.pop():null,u=h&&h._resolvedRule._typedRule;if(u instanceof this.ContainerRule&&-1===l.indexOf(u))l.push(u),this.push(a,u.subrules);else if(!u||!n||u.matchRegex){var p=u&&this.exec(u.matchRegex||u.beginRegex,s,i);p&&(c.push(p),d.push(u))}}for(var f=Number.MAX_VALUE,g=-1,m=0;m<c.length;m++){var v=c[m];v.index<f&&(f=v.index,g=m)}if(!n){var _=t,y=this.getEndMatch(t,s,i);if(y){var C=_.rule.applyEndPatternLast,w=-1===g||y.index<f||!C&&y.index===f;if(w)return{isEnd:!0,rule:_.rule,match:y}}}return-1===g?null:{isSub:!0,rule:d[g],match:c[g]}},getInitialExpected:function(e,t){var i,n;if(e===this._tree){for(i=0;i<e.children.length;i++)if(n=e.children[i],n.start>=t)return n}else if(e instanceof this.BeginEndNode&&e.endMatch){var o=e.endMatch.index;for(i=0;i<e.children.length&&(n=e.children[i],!(n.start>=t));i++);if(n&&n.start<o)return n}return e},getNextExpected:function(e,t){var i=e;if("begin"===t){var n=i.children[0];return n?n:i}if("end"===t){var o=i.parent;if(o){var r=o.children[o.children.indexOf(i)+1];return r?r:o}}return null},prune:function(e,t){var i=t.parent===e;i?e.children.length=t.getIndexInParent():e instanceof this.BeginEndNode&&(e.endMatch=null,e.end=null),e.parent&&(e.parent.children.length=e.getIndexInParent()+1)},onLineStyle:function(e){function t(e,t){return e.start-t.start}this._tree||this.initialParse();var i=e.lineStart,n=this.textView.getModel(),o=n.getLineEnd(e.lineIndex),r=n.getLineEnd(n.getLineAtOffset(i)-1),s=this.getFirstDamaged(r,r),a=this.getLineScope(n,s,i,o);e.ranges=this.toStyleRanges(a),e.ranges.sort(t)},getLineScope:function(e,t,i,n){for(var o=i,r=this.getInitialExpected(t,i),s=[],a=[];t&&n>o;){var l=this.getNextMatch(e,t,o);if(!l)break;var c=l&&l.match,d=l&&l.rule,h=l&&l.isSub,u=l&&l.isEnd;c.index!==o&&a.push({start:o,end:c.index,node:t}),h?(o=this.afterMatch(c),d instanceof this.BeginEndRule?(this.addBeginScope(s,c,d),t=r,r=this.getNextExpected(r,"begin")):this.addMatchScope(s,c,d)):u&&(o=this.afterMatch(c),this.addEndScope(s,c,d),r=this.getNextExpected(r,"end"),t=t.parent)}n>o&&a.push({start:o,end:n,node:t});var p=this.getInheritedLineScope(a,i,n);return s.concat(p)},getInheritedLineScope:function(e){for(var t=[],i=0;i<e.length;i++)for(var n=e[i],o=n.node;o;){var r=o.rule.rule,s=r.name,a=r.contentName,l=a||s;if(l){this.addScopeRange(t,n.start,n.end,l);break}o=o.parent}return t},addBeginScope:function(e,t,i){var n=i.rule;this.addCapturesScope(e,t,n.beginCaptures||n.captures,i.isComplex,i.beginOld2New,i.beginConsuming)},addEndScope:function(e,t,i){var n=i.rule;this.addCapturesScope(e,t,n.endCaptures||n.captures,i.isComplex,i.endOld2New,i.endConsuming)},addMatchScope:function(e,t,i){var n=i.rule,o=n.name,r=n.captures;r?this.addCapturesScope(e,t,r,i.isComplex,i.matchOld2New,i.matchConsuming):this.addScope(e,t,o)},addScope:function(e,t,i){i&&e.push({start:t.index,end:this.afterMatch(t),scope:i})},addScopeRange:function(e,t,i,n){n&&e.push({start:t,end:i,scope:n})},addCapturesScope:function(e,t,i,n,o,r){if(i)if(n){for(var s={1:0},a=0,l=1;void 0!==t[l];l++)void 0!==r[l]&&(a+=t[l].length),void 0!==t[l+1]&&(s[l+1]=a);for(var c=t.index,d=1;i[d];d++){var h=i[d].name,u=o[d],p=c+s[u];if("undefined"!=typeof t[u]){var f=p+t[u].length;this.addScopeRange(e,p,f,h)}}}else this.addScope(e,t,i[0]&&i[0].name)},getIntersecting:function(e,t){for(var i=[],n=this._tree?[this._tree]:[];n.length;){var o=n.pop(),r=!1;if(o instanceof this.ContainerNode?r=!0:this.isDamaged(o,e,t)&&(r=!0,i.push(o)),r)for(var s=o.children.length,a=0;s>a;a++)n.push(o.children[a])}return i.reverse()},toStyleRanges:function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i],o=this._styles[n.scope];if(!o)throw new Error("styles not found for "+n.scope);var r=o.join(" ");t.push({start:n.start,end:n.end,style:{styleClass:r}})}return t}},{RegexUtil:n,TextMateStyler:i}}),define("orion/editor/AsyncStyler",["i18n!orion/editor/nls/messages","orion/editor/annotations"],function(e,t){function i(e){return-1!==e.getProperty("objectClass").indexOf(o)&&"highlighter"===e.getProperty("type")}function n(e,t,i){this.initialize(e,t,i),this.lineStyles=[]}var o="orion.edit.highlighter",r="orion.annotation.highlightError",s=o+" service must be an event emitter";return t.AnnotationType.registerType(r,{title:e.syntaxError,html:"<div class='annotationHTML error'></div>",rangeStyle:{styleClass:"annotationRange error"}}),n.prototype={initialize:function(e,t,n){this.textView=e,this.serviceRegistry=t,this.annotationModel=n,this.services=[];var r=this;this.listener={onModelChanging:function(e){r.onModelChanging(e)},onModelChanged:function(e){r.onModelChanged(e)},onDestroy:function(e){r.onDestroy(e)},onLineStyle:function(e){r.onLineStyle(e)},onStyleReady:function(e){r.onStyleReady(e)},onServiceAdded:function(e){r.onServiceAdded(e.serviceReference,r.serviceRegistry.getService(e.serviceReference))},onServiceRemoved:function(e){r.onServiceRemoved(e.serviceReference,r.serviceRegistry.getService(e.serviceReference))}},e.addEventListener("ModelChanging",this.listener.onModelChanging),e.addEventListener("ModelChanged",this.listener.onModelChanged),e.addEventListener("Destroy",this.listener.onDestroy),e.addEventListener("LineStyle",this.listener.onLineStyle),t.addEventListener("registered",this.listener.onServiceAdded),t.addEventListener("unregistering",this.listener.onServiceRemoved);for(var s=t.getServiceReferences(o),a=0;a<s.length;a++){var l=s[a];i(l)&&this.addServiceListener(t.getService(l))}},onDestroy:function(){this.destroy()},destroy:function(){if(this.textView&&(this.textView.removeEventListener("ModelChanging",this.listener.onModelChanging),this.textView.removeEventListener("ModelChanged",this.listener.onModelChanged),this.textView.removeEventListener("Destroy",this.listener.onDestroy),this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView=null),this.services){for(var e=0;e<this.services.length;e++)this.removeServiceListener(this.services[e]);this.services=null}this.serviceRegistry&&(this.serviceRegistry.removeEventListener("registered",this.listener.onServiceAdded),this.serviceRegistry.removeEventListener("unregistering",this.listener.onServiceRemoved),this.serviceRegistry=null),this.listener=null,this.lineStyles=null},onModelChanging:function(e){this.startLine=this.textView.getModel().getLineAtOffset(e.start)},onModelChanged:function(e){var t=this.startLine;(e.addedLineCount||e.removedLineCount)&&Array.prototype.splice.apply(this.lineStyles,[t,e.removedLineCount].concat(this._getEmptyStyle(e.addedLineCount)))},onStyleReady:function(e){var i=e.lineStyles||e.style,n=Number.MAX_VALUE,o=-1,s=this.textView.getModel();for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(this.lineStyles[a]=i[a],n=Math.min(n,a),o=Math.max(o,a));n=Math.max(n,0),o=Math.min(o,s.getLineCount());var l=this.annotationModel;if(l){for(var c=l.getAnnotations(s.getLineStart(n),s.getLineEnd(o)),d=[];c.hasNext();){var h=c.next();h.type===r&&d.push(h)}for(var u=[],p=n;o>=p;p++){a=p;var f=this.lineStyles[a],g=f&&f.errors,m=s.getLineStart(a);if(g)for(var v=0;v<g.length;v++){var _=g[v];u.push(t.AnnotationType.createAnnotation(r,_.start+m,_.end+m))}}l.replaceAnnotations(d,u)}this.textView.redrawLines(n,o+1)},onLineStyle:function(e){function t(e,t){for(var i=e.length,n=[],o=0;i>o;o++){var r=e[o];n.push({start:r.start+t,end:r.end+t,style:r.style})}return n}var i=this.lineStyles[e.lineIndex];i&&(i.ranges?e.ranges=t(i.ranges,e.lineStart):i.style&&(e.style=i.style))},_getEmptyStyle:function(e){for(var t=[],i=0;e>i;i++)t.push(null);return t},setContentType:function(e){if(this.contentType=e,this.services)for(var t=0;t<this.services.length;t++){var i=this.services[t];if(i.setContentType){var n=this.serviceRegistry.getService("orion.page.progress");n?n.progress(i.setContentType(this.contentType),this.contentType.id):i.setContentType(this.contentType)}}},onServiceAdded:function(e,t){i(e)&&this.addServiceListener(t)},onServiceRemoved:function(e,t){-1!==this.services.indexOf(t)&&this.removeServiceListener(t)},addServiceListener:function(e){if("function"==typeof e.addEventListener){if(e.addEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),this.services.push(e),e.setContentType&&this.contentType){var t=this.serviceRegistry.getService("orion.page.progress");t?t.progress(e.setContentType(this.contentType),this.contentType.id):e.setContentType(this.contentType)}}else"undefined"!=typeof console&&console.log(new Error(s))},removeServiceListener:function(e){if("function"==typeof e.removeEventListener){e.removeEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady);var t=this.services.indexOf(e);-1!==t&&this.services.splice(t,1)}else"undefined"!=typeof console&&console.log(new Error(s))}},n}),define("orion/highlight",["examples/editor/textStyler","orion/editor/textStyler","orion/editor/textMateStyler","orion/editor/AsyncStyler","orion/Deferred"],function(e,t,i,n,o){function r(r,s,l,c,d,h,u){function p(e,t){var i=e.getProperty("contentType")||e.getProperty("contentTypes"),n=e.getProperty("fileTypes");if(i)return o.when(s.isSomeExtensionOf(l,i)).then(function(t){return t?e:null});if(t&&n&&-1!==n.indexOf(t)){var r=new o;return r.resolve(e),r}return null}function f(e){return u||"highlighter"!==e.getProperty("type")}function g(t){var i=null;switch(t&&t.id){case"application/javascript":case"application/json":i=new e.TextStyler(c,"js",d);break;case"text/x-java-source":i=new e.TextStyler(c,"java",d);break;case"text/css":i=new e.TextStyler(c,"css",d)}return i}if(!a){var m=g(l);if(m){var v=new o;return v.resolve(m),v}}a&&!this.orionGrammars&&(this.orionGrammars={});for(var _=h&&h.split(".").pop().toLowerCase(),y=r.getServiceReferences("orion.edit.highlighter"),C=[],w=[],b=0;b<y.length;b++){var S=y[b],x=S.getProperty("type");if("grammar"===x||!a&&"undefined"==typeof x)C.push(S.getProperty("grammar"));else if("highlighter"!==x){var L=S.getProperty("id");L&&!this.orionGrammars[L]&&(this.orionGrammars[L]={id:L,contentTypes:S.getProperty("contentTypes"),patterns:S.getProperty("patterns"),repository:S.getProperty("repository")})}var T=p(S,_);T&&w.push(T)}return o.all(w,function(e){return{_error:e}}).then(function(e){for(var o,s=e.length-1;s>=0;s--){var h=e[s];if(h&&!h._error&&f(h)){o=h;break}}var u;if(o){var p=o.getProperty("type");if("highlighter"===p)u=new n(c,r,d),u.setContentType(l);else if("grammar"===p||!a&&"undefined"==typeof p){var g=o.getProperty("grammar");u=new i.TextMateStyler(c,g,C)}else if(a){var m=[];for(var v in this.orionGrammars)m.push(this.orionGrammars[v]);var _=new t.createPatternBasedAdapter(m,o.getProperty("id"),l.id);u=new t.TextStyler(c,d,_)}}else!a||l&&"text/x-markdown"===l.id||(_=new t.createPatternBasedAdapter([],""),u=new t.TextStyler(c,d,_));return u})}function s(e,t){this.serviceRegistry=e,this.contentTypeService=t,this.styler=null}var a=1;return s.prototype={setup:function(e,t,i,n,o){o="undefined"==typeof o?!0:o,this.styler&&(this.styler.destroy&&this.styler.destroy(),this.styler=null);var s=this;return r(this.serviceRegistry,this.contentTypeService?this.contentTypeService:this.serviceRegistry.getService("orion.core.contentTypeRegistry"),e,t,i,n,o).then(function(e){return s.styler=e,e})},getStyler:function(){return this.styler}},{createStyler:r,SyntaxHighlighter:s}}),define("orion/searchModel",["i18n!orion/search/nls/messages","orion/Deferred","orion/i18nUtil","orion/explorers/explorer","orion/uiUtils","orion/searchUtils","orion/objects"],function(e,t,i,n,o,r,s){function a(e,t,i,n,o,s){this.registry=e,this.fileClient=t,i&&i.categories?(this._fileList=i.refResult,this._categories=i.categories):this._fileList=i,this._numberOnPage=this._fileList.length,this._totalNumber=n,this._shape=o.shape?o.shape:"file",this._listRoot={isRoot:!0,children:[]},this._filteredRoot={isRoot:!0,children:[]},this._filterText=null,this._indexedFileItems=[],this._location2ModelMap=[],this._lineDelimiter="",this.onMatchNumberChanged=s.onMatchNumberChanged,this._matchFilter=s.matchFilter,this._searchHelper=r.generateSearchHelper(o)}return a.prototype=new n.ExplorerModel,s.mixin(a.prototype,{getRoot:function(e){e(this.getListRoot())},getChildren:function(e,t){if(e){if("file"===e.type&&this._filterText)return void t(e.filteredChildren?e.filteredChildren:[]);if(e.children)t(e.children);else if("detail"===e.type)t([]);else if("file"===e.type&&e.location){if(""===this._searchHelper.params.keyword)return;this.registry.getService("orion.page.progress").progress(this.fileClient.read(e.location),"Getting file contents "+e.name).then(function(i){r.searchWithinFile(this._searchHelper.inFileQuery,e,i,this.replaceMode(),this._searchHelper.params.caseSensitive),this.onMatchNumberChanged&&this.onMatchNumberChanged(e),t(e.children)}.bind(this),function(e){this.registry.getService("orion.page.message").setProgressResult({Message:e.message,Severity:"Error"}),t([])}.bind(this))}else t("group"===e.type?e.children:[])}},getId:function(e){var t;return e===this.getListRoot()?t=this.rootId:(t=e.location,t=t.replace(/[^\.\:\-\_0-9A-Za-z]/g,""),"number"==typeof e.lineNumber&&(t=t+"-"+e.lineNumber),"number"==typeof e.matchNumber&&(t=t+"-"+e.matchNumber),"number"==typeof e.start&&(t=t+"-"+e.start)),t},disableExpand:function(){return""===this._provideSearchHelper().params.keyword},enableCheckbox:function(){return this.replaceMode()},getListRoot:function(){return this._filterText?this._filteredRoot:this._listRoot},buildResultModel:function(){if(this._indexedFileItems=[],this.getListRoot().children=[],"group"===this._shape&&this._categories){for(var e in this._categories)if(void 0!==this._categories[e]&&null!==this._categories[e]){var t={parent:this.getListRoot(),type:"group",name:this._categories[e].name,location:this._categories[e].category,category:this._categories[e].category,sort:this._categories[e].sort,children:[]};
this.getListRoot().children.push(t)}this.getListRoot().children.sort(function(e,t){return e.sort-t.sort})}for(var i=0,n=this._fileList.length;n>i;i++)switch(this._shape){case"file":this._buildFileResult(this._fileList[i]);break;case"group":this._buildCategoryResult(this._fileList[i])}if("group"===this._shape&&this._categories){var o=this.getListRoot().children.filter(function(e){return e.children.length>0});this.getListRoot().children=o,this.getListRoot().children.forEach(function(e){e.children.sort(function(e,t){var i="number"==typeof e.confidence?e.confidence:-1e3,n="number"==typeof t.confidence?t.confidence:-1e3;return i===n?e.location===t.location?e.lineNumber-t.lineNumber:e.logicalParent.name-t.logicalParent.name:n-i})})}},_buildFileResult:function(e){var t=e.children,i={parent:this.getListRoot(),type:"file",name:e.name,children:t,contents:e.contents,location:e.location,parentLocation:o.path2FolderName(e.location,e.name,!0),fullPathName:o.path2FolderName(e.path,e.name)};if(t){var n=[];t.forEach(function(e){for(var t=0;t<e.matches.length;t++)if(this._filterOnMatch(e.matches[t])){var o=t+1,r={confidence:e.matches[t].confidence,parent:i,matches:e.matches,lineNumber:e.lineNumber,matchNumber:o,checked:100===e.matches[t].confidence?!0:!1,type:"detail",start:e.matches[t].start,end:e.matches[t].end,name:e.name,location:i.location};n.push(r)}}.bind(this)),n.sort(function(e,t){return e.confidence===t.confidence?e.lineNumber-t.lineNumber:t.confidence-e.confidence}),i.children=n}(!t||i.children&&i.children.length>0)&&(this.getListRoot().children.push(i),this._indexedFileItems.push(i))},_match2Category:function(e){var t=this.getListRoot().children[0];return this.getListRoot().children.some(function(i){return i.category===e.category?(t=i,!0):!1},this),t},_getLogicalFileNode:function(e){var t=null;return this._indexedFileItems.some(function(i){return i.location===e.location?(t=i,!0):!1},this),t||(t={type:"file",name:e.name,children:[],contents:e.contents,location:e.location,parentLocation:o.path2FolderName(e.location,e.name,!0),fullPathName:o.path2FolderName(e.path,e.name)},this._indexedFileItems.push(t)),t},_filterOnMatch:function(e){if(!this._matchFilter)return!0;for(var t in this._matchFilter)if(this._matchFilter[t].filterFunc(e.confidence,this._matchFilter[t].flag))return!0;return!1},_buildCategoryResult:function(e){var t=e.children;if(t)for(var i=this._getLogicalFileNode(e),n=0,o=t.length;o>n;n++)for(var r=t[n],s=r.matches,a=0,l=s.length;l>a;a++){var c=s[a];if(this._filterOnMatch(c)){var d=a+1;c.lineNumber=r.lineNumber,c.matchNumber=d,c.matches=s,c.checked=100===c.confidence?!0:!1,r.name?(c.lineString=r.name,c.name=r.name):(c.lineString="",c.name=""),c.location=e.location?e.location:"";var h=this._match2Category(c);c.parent=h,h.children.push(c),c.logicalParent=i,i.children.push(c)}}},replaceMode:function(){return"string"==typeof this._searchHelper.params.replace},getPagingParams:function(){return{totalNumber:this._totalNumber,start:"undefined"==typeof this._searchHelper.params.start?0:this._searchHelper.params.start,rows:"undefined"==typeof this._searchHelper.params.rows?this._totalNumber:this._searchHelper.params.rows,numberOnPage:this._numberOnPage}},getScopingParams:function(t){var n=r.copySearchParams(this._searchHelper.params,!0);n.resource=t.parentLocation,n.start=0;var o=i.formatMessage(e['Search again in this folder with "${0}"'],this._searchHelper.displayedSearchTerm);return{name:t.fullPathName,tooltip:o}},getDetailInfo:function(e){var t=e.lineString?e.lineString:e.name,i=Array.isArray(e.matches)?e.matches:e.parent.children;return{lineString:t,lineNumber:e.lineNumber-1,matches:i,matchNumber:e.matchNumber?e.matchNumber-1:0}},getFileName:function(e){return e.name},provideFileContent:function(e,t){this._provideFileContent(e).then(function(){t(e)})},getFileContents:function(e){return e.contents.join(this._lineDelimiter)},getReplacedFileContent:function(e,t,i){r.generateNewContents(t,i.contents,e,i,this._searchHelper.params.replace,this._searchHelper.inFileQuery.searchStrLength),e.lineDelim=this._lineDelimiter},writeReplacedContents:function(e){var i=[],n=this.getValidFileList();return n.forEach(function(t){i.push(this._writeOneFile(t,e))}.bind(this)),t.all(i,function(e){return{_error:e}})},getHeaderString:function(){if("group"===this._shape){for(var t=0,n=0,o=this._fileList.length;o>n;n++){var r=this._fileList[n].totalMatches;"number"==typeof r&&(t+=r)}var s=this._searchHelper.params.resource;if(s&&"/file"!==s){s=s.replace(/\/$/g,"");var a=s.lastIndexOf("/");return a>-1&&(s=s.substring(a+1)),i.formatMessage(e.refsInProject,{0:t,1:this._searchHelper.displayedSearchTerm,2:decodeURIComponent(s)})}return i.formatMessage(e.refsInWorkspace,{0:t,1:this._searchHelper.displayedSearchTerm})}var l=e.Results;if(this._searchHelper.displayedSearchTerm){var c=this.getPagingParams();if(c.numberOnPage>0){var d=c.start+1,h=d+c.numberOnPage-1;l="",l=this.replaceMode()?i.formatMessage(e.ReplaceAwithBforCofD,this._searchHelper.displayedSearchTerm,this._searchHelper.params.replace,d+"-"+h,c.totalNumber):i.formatMessage(e.FilesAofBmatchingC,d+"-"+h,c.totalNumber,this._searchHelper.displayedSearchTerm)}}return l},getValidFileList:function(){return this._indexedFileItems},setValidFileList:function(e){this._indexedFileItems=e},filterOn:function(e){if(this._filterText=e,this._filterText){var t=this._filterText.toLowerCase();this._filteredRoot.children=[],this._indexedFileItems.forEach(function(e){var i=!1;(this._filterSingleString(e.name,t)||this._filterSingleString(e.fullPathName,t))&&(i=!0),e.children&&(e.filteredChildren=[],e.children.forEach(function(n){this._filterSingleString(n.name,t)&&(e.filteredChildren.push(n),i=!0)}.bind(this))),i&&this._filteredRoot.children.push(e)}.bind(this))}},getFilteredChildren:function(e){return"file"===e.type&&this._filterText&&e.filteredChildren?e.filteredChildren:e.isRoot&&this._filterText?this._filteredRoot.children:e.children},_location2Model:function(e){return e&&this._location2ModelMap[e]?this._location2ModelMap[e]:this._indexedFileItems.length>0?this._indexedFileItems[0]:null}}),a.prototype._provideFileContent=function(e){return e.contents?(new t).resolve(e):this.registry.getService("orion.page.progress").progress(this.fileClient.read(e.location),"Getting file contents "+e.Name).then(function(t){return r.searchWithinFile(this._searchHelper.inFileQuery,e,t,this.replaceMode(),this._searchHelper.params.caseSensitive),e}.bind(this),function(t){return this.registry.getService("orion.page.message").setProgressResult({Message:t.message,Severity:"Error"}),e}.bind(this))},a.prototype._provideSearchHelper=function(){return this._searchHelper},a.prototype._filterSingleString=function(e,t){var i=e.toLowerCase();return i.indexOf(t)>=0},a.prototype._model2Index=function(e,t){var i=t;if(!i&&e.parent&&(i=e.parent.children),i)for(var n=0;n<i.length;n++)if(i[n]===e)return n;return-1},a.prototype._restoreGlobalStatus=function(){this.defaultReplaceStr=this._searchHelper.displayedSearchTerm;var e=window.sessionStorage.global_search_default_replace_string;"string"==typeof e&&e.length>0&&(this.defaultReplaceStr=e),this.sortByName=this._provideSearchHelper().params.sort.indexOf("Name")>-1},a.prototype._storeGlobalStatus=function(e){window.sessionStorage.global_search_default_replace_string=e},a.prototype._writeOneFile=function(i,n){var o=this._matchesReplaced(i);return o>0?this._provideFileContent(i).then(function(){o=this._matchesReplaced(i);var t={};r.generateNewContents(!1,i.contents,t,i,this._searchHelper.params.replace,this._searchHelper.inFileQuery.searchStrLength);var s=t.contents.join(this._lineDelimiter),a=i.ETag,l=a?{ETag:a}:null;return this.registry.getService("orion.page.progress").progress(this.fileClient.write(i.location,s,l),"Saving changes to "+i.location).then(function(){n.push({model:i,matchesReplaced:o,status:"pass"})}.bind(this),function(t){412===t.status?n.push({model:i,message:e["ResourceChanged."],matchesReplaced:o,status:"failed"}):(t.log=!0,n.push({model:i,message:e["Failed to write file."],matchesReplaced:o,status:"failed"}))}.bind(this))}.bind(this)):(new t).resolve(i)},a.prototype._matchesReplaced=function(e){var t=0;if(!e.children)return e.checked===!1?0:1;if(e.children)for(var i=0;i<e.children.length;i++)e.children[i].checked!==!1&&(t+=1);return t},a.prototype.removeChild=function(e,t){var i=e.children.indexOf(t);i>-1&&(e.children.splice(i,1),t.stale=!0)},a.prototype.constructor=a,{SearchResultModel:a}}),define("orion/explorers/fileDetailRenderer",["i18n!orion/search/nls/messages","orion/i18nUtil","orion/explorers/explorer","orion/webui/littlelib","orion/explorers/navigationUtils","orion/objects","orion/Deferred"],function(e,t,i,n,o,r,s){function a(e,t,i){var o=n.node(e);o&&o.addEventListener(t,i,!1)}function l(e,t,i){var o=n.node(t);o&&("only"===i&&n.empty(o),o.appendChild(e))}function c(e,t,i,o){var r=document.createElement(e);if(t)if(Array.isArray(t))for(var s=0;s<t.length;s++)r.classList.add(t[s]);else"string"==typeof t&&(r.className=t);i&&(r.id=i);var a=n.node(o);return a&&a.appendChild(r),r}function d(e,t,i,n){var o=c("span",e,t,i);return n&&o.appendChild(document.createTextNode(n)),o}function h(e,t,i){return e.get(t).then(function(e){var t=[];return i.forEach(function(i){var n=!!e[i];t.push(n)}),(new s).resolve(t)},function(){return(new s).resolve(!1)})}function u(e,t){t?e.classList.add("showFullPath"):e.classList.remove("showFullPath")}function p(e,t,i){return e.get(t).then(function(n){var o=[];return i.forEach(function(e){var t=!n[e];n[e]=t,o.push(t)}),e.put(t,n),(new s).resolve(o)},function(){return(new s).resolve()})}function f(e,t){i.SelectionRenderer.call(this,e,t)}return f.prototype=Object.create(i.SelectionRenderer.prototype),r.mixin(f.prototype,{renderRow:function(e,t){i.SelectionRenderer.prototype.renderRow.call(this,e,t),"file"!==e.type&&t.classList.add("searchDetailRow")},getCellHeaderElement:function(){return null},focus:function(){var e=n.node(this.explorer.getParentDivId());window.setTimeout(function(){e.focus()},10)},_getFileRenderName:function(i){var n;return i.totalMatches?n=this.explorer.model.getFileName(i)+" ("+t.formatMessage(e["${0} matches"],i.totalMatches)+")":"file"===i.type?n=this.explorer.model.getFileName(i):"group"===i.type&&(n=i.name),n},_getFileNameElement:function(e){var t=this._getFileRenderName(e),i=document.createElement("span");return i.classList.add("fileNameSpan"),i.appendChild(document.createTextNode(t)),i},renderGroupElement:function(i,n){var o=document.createElement("span");o.appendChild(document.createTextNode(i.name)),o.classList.add("groupNameSpan"),n.appendChild(o);var r=document.createElement("span"),s=t.formatMessage(e["(${0})"],i.children.length);1===i.children.length&&(s=e.singleMatch),r.appendChild(document.createTextNode(s)),r.classList.add("groupCountSpan"),n.appendChild(r),n.classList.add("groupParentSpan")},renderFileElement:function(e,t,i){var n=this.generateFileLink(i,e);o.addNavGrid(this.explorer.getNavDict(),e,n);var r=i.getScopingParams(e),s=decodeURIComponent(r.name).split("/"),a=s.pop();if(a=a,0<s.length){var l=document.createElement("span");l.classList.add("fullPathSpan");var c=s.join("/");l.appendChild(document.createTextNode(c+"/")),n.appendChild(l);var d=document.createElement("span");d.classList.add("ellipsisSpan"),d.appendChild(document.createTextNode(".../")),n.appendChild(d)}var h=document.createElement("span");h.classList.add("fileParentSpan"),h.appendChild(document.createTextNode(a+"/")),n.appendChild(h);var u=this._getFileNameElement(e);n.appendChild(u),n.addEventListener("click",function(){t.click()}),t.appendChild(n),t.classList.add("filePathSpan")},_generateDetailSegments:function(e){var t=this.explorer.model.getDetailInfo(e),i=[];if("group"===e.parent.type){var n=e.startIndex+e.length;e.startIndex>0&&i.push({name:e.lineString.substring(0,e.startIndex),startIndex:0,bold:!1,highlight:!1}),i.push({name:e.lineString.substring(e.startIndex,n),startIndex:e.startIndex,bold:!0,highlight:!1}),n<e.lineString.length&&i.push({name:e.lineString.substring(n),startIndex:n,bold:!1,highlight:!1})}else{for(var o=0,r=0;r<t.matches.length&&!(o>=t.lineString.length);r++)if(!this.enableCheckbox(e)||r===t.matchNumber){o!==t.matches[r].startIndex&&i.push({name:t.lineString.substring(o,t.matches[r].startIndex),startIndex:o,bold:!1,highlight:!1});var s=t.matches[r].length;if(i.push({name:t.lineString.substring(t.matches[r].startIndex,t.matches[r].startIndex+s),startIndex:t.matches[r].startIndex,bold:!0,highlight:!1}),o=t.matches[r].startIndex+s,this.enableCheckbox(e))break}o<t.lineString.length-1&&i.push({name:t.lineString.substring(o),startIndex:o,bold:!1,highlight:!1})}return i},_mergesingleSegment:function(e,t){var i=[];return e.forEach(function(e){var n=e.startIndex,o=e.startIndex+e.name.length;t.start>n&&t.end<o?(i.push({name:e.name.substring(0,t.start-n),startIndex:e.startIndex,bold:e.bold,highlight:!1}),i.push({name:e.name.substring(t.start-n,t.end-n),startIndex:t.start,bold:e.bold,highlight:!0}),i.push({name:e.name.substring(t.end-n),startIndex:t.end,bold:e.bold,highlight:!1})):t.start>n&&t.start<o?(i.push({name:e.name.substring(0,t.start-n),startIndex:e.startIndex,bold:e.bold,highlight:!1}),i.push({name:e.name.substring(t.start-n),startIndex:t.start,bold:e.bold,highlight:!0})):n>=t.start&&o<=t.end?(e.highlight=!0,i.push(e)):t.end>n&&t.end<o?(i.push({name:e.name.substring(0,t.end-n),startIndex:e.startIndex,bold:e.bold,highlight:!0}),i.push({name:e.name.substring(t.end-n),startIndex:t.end,bold:e.bold,highlight:!1})):i.push(e)}.bind(this)),i},_renderSegments:function(e,t){e.forEach(function(e){if(e.bold){var i=c("b",null,null,t);e.highlight&&i.classList.add("search-filter-text"),l(document.createTextNode(e.name),i,"only")}else{var n=c("span",null,null,t);e.highlight&&n.classList.add("search-filter-text"),l(document.createTextNode(e.name),n,"only")}}.bind(this))},generateDetailHighlight:function(e,t){var i=this._generateDetailSegments(e);this._renderSegments(i,t)},renderDetailElement:function(e,t){this.generateDetailDecorator(e,t);var i=this.getDetailElement(e,t);this.generateDetailHighlight(e,i)},renderDetailLineNumber:function(e,t,i){var n=this.explorer.model.getDetailInfo(e),o=n.lineNumber+1,r=document.createElement("span");if(r.className="fileLineSpan",i){var s=e.location;l(document.createTextNode(s.substring(s.lastIndexOf("/")+1)+"@"),r,"last")}if(!this.enableCheckbox(e)||n.matches.length<=1)l(document.createTextNode(o+":"),r,"last");else{var a=n.matchNumber+1;l(document.createTextNode(o+"("+a+"):"),r,"last")}t.appendChild(r)},getDetailElement:function(e,t){var i=this.generateDetailLink(e);t.appendChild(i),i.classList.add("searchDetailLink"),o.addNavGrid(this.explorer.getNavDict(),e,i),a(i,"click",function(){t.click()});var n=c("span",null,null,i);return n},enableCheckbox:function(e){return"function"==typeof this.explorer.model.enableCheckbox&&this.explorer.model.enableCheckbox(e)},generateDetailDecorator:function(){},getCellElement:function(t,n,o){var r,s=null;switch(t){case 0:"file"===n.type?(s=c("td"),s.noWrap=!0,"function"==typeof this.explorer.model.disableExpand&&this.explorer.model.disableExpand(n)||this.getExpandImage(o,d(null,null,s,null))):"group"===n.type?(s=c("td"),s.noWrap=!0,this.getExpandImage(o,d(null,null,s,null))):"function"==typeof this.explorer.model.enableCheckbox&&this.explorer.model.enableCheckbox(n)?s=i.ExplorerRenderer.prototype.getCheckboxColumn.call(this,n,o):(s=c("td"),r=d(null,null,s,null),l(document.createTextNode("",r,"last")));break;case 1:s=c("td"),"file"===n.type?(s.colSpan=2,r=d(null,this.getFileIconId?this.getFileIconId(n):null,s,null),this._lastFileIconDom=r,r=d(null,this.getFileSpanId(n),s,null),this.renderFileElement(n,r,this.explorer.model),o.title=n.name):"group"===n.type?(s.colSpan=2,r=d(null,null,s,null),this.renderGroupElement(n,r,this.explorer.model),o.title=n.name):this.renderDetailLineNumber(n,s,"group"===n.parent.type);break;case 2:"file"!==n.type&&"group"!==n.type&&(s=c("td"),this.renderDetailElement(n,s));break;case 20:if("file"===n.type){s=c("td");var a=c("button",["imageSprite","core-sprite-delete","dismissButton","deleteSearchRowButton"],null,s);a.title=e["Remove from search results"],a.addEventListener("click",function(){var e=this.explorer.model;e.removeChild(n.parent,n),this.explorer.getNavHandler().refreshModel(this.explorer.getNavDict(),e,e.children),this.explorer.getNavHandler().cursorOn(null,!0),o.parentNode.removeChild(o),n.children&&n.children.forEach(function(e){var t=this.explorer.getRow(e);t.parentNode.removeChild(t)},this)}.bind(this))}}return s},getRowActionElement:function(e){return n.node(this.getItemLinkId(e))},getFileSpanId:function(e){return this.explorer.model.getId(e)+"_fileSpan"},getFileIconId:function(e){return this.explorer.model.getId(e)+"_fileIcon"},getItemLinkId:function(e){return"string"==typeof e?e+"_itemLink":this.explorer.model.getId(e)+"_itemLink"},getPrimColumnStyle:function(e){if(e){if("group"===e.type)return"refs_primaryColumn";if("file"===e.type)return"search_primaryColumn"}return"search_primaryColumn_Details"},getSecondaryColumnStyle:function(e){return 2===e?"search_secondaryColumn_line":"search_secondaryColumn"}}),{FileDetailRenderer:f,togglePrefs:p,getPrefs:h,showFullPath:u}}),define("orion/inlineSearchResultExplorer",["i18n!orion/search/nls/messages","orion/Deferred","orion/webui/littlelib","orion/contentTypes","orion/i18nUtil","orion/explorers/explorer","orion/fileClient","orion/commands","orion/searchUtils","orion/compare/compareView","orion/highlight","orion/webui/tooltip","orion/explorers/navigatorRenderer","orion/extensionCommands","orion/searchModel","orion/gSearchClient","orion/explorers/fileDetailRenderer"],function(e,t,i,n,o,r,s,a,l,c,d,h,u,p,f,g,m){function v(e){var t=i.node(e);return t&&i.empty(t),t}function _(e,t,n){var o=i.node(e);o&&o.addEventListener(t,n,!1)}function y(e,t,n){var o=i.node(t);o&&("only"===n&&i.empty(o),o.appendChild(e))}function C(e,t,n,o){var r=document.createElement(e);if(t)if(Array.isArray(t))for(var s=0;s<t.length;s++)r.classList.add(t[s]);else"string"==typeof t&&(r.className=t);n&&(r.id=n);var a=i.node(o);return a&&a.appendChild(r),r}function w(e,t,i,n){var o=C("span",e,t,i);return n&&o.appendChild(document.createTextNode(n)),o}function b(e){return e?"file"===e.type?e:e.logicalParent?e.logicalParent:e.parent:null}function S(e,t){return b(e)===b(t)}function x(e){return"function"==typeof e.getValidFileList?e.getValidFileList():e.getListRoot().children}function L(t){return"function"==typeof t.getHeaderString?t.getHeaderString():e.Results}function T(e,t){m.FileDetailRenderer.call(this,e,t)}function E(e,t){this._init(e),this.options=e,this.explorer=t}function k(e,t,i,n,o,r){this.parentId=e,this.reportList=t,this.resultModel=i,this._commandService=n,this._contentTypeService=o,this._openWithCommands=r,this.renderer=new E({checkbox:!1},this)}function N(e){this._syntaxHighlither=new d.SyntaxHighlighter(e)}function A(e,t,i,o){this.registry=e,this._commandService=t,this.fileClient=new s.FileClient(this.registry),this.defaulRows=40,this._contentTypeService=new n.ContentTypeRegistry(this.registry),this._inlineSearchPane=i,this._preferences=o,this._replaceRenderer=new T({checkbox:!0,highlightSelection:!1,getCheckedFunc:function(e){return this.getItemChecked(e)}.bind(this),onCheckedFunc:function(e,t,i){this.onRowChecked(e,t,i)}.bind(this)},this),this.render=this._normalRenderer=new T({checkbox:!1,highlightSelection:!1},this),m.getPrefs(this._preferences,"/inlineSearchPane",["showFullPath","viewByFile","hidePerfectMatch","hideNonMatch","hidePossibleMatch"]).then(function(e){this._shouldShowFullPath=e?e[0]:!1,this._viewByFile=e?e[1]:!1,this._matchFilter={},this._matchFilter.hidePerfectMatch={flag:e?e[2]:!1,filterFunc:function(e,t){return!t&&100===e}},this._matchFilter.hideNonMatch={flag:e?e[3]:!1,filterFunc:function(e,t){return!t&&0===e}},this._matchFilter.hidePossibleMatch={flag:e?e[4]:!1,filterFunc:function(e,t){return!t&&100!==e&&0!==e}},this.declareCommands()}.bind(this))}return T.prototype=Object.create(m.FileDetailRenderer.prototype),T.prototype.generateFileLink=function(e,t){var i=null;e._provideSearchHelper&&(i=e._provideSearchHelper());var n=i?l.generateFindURLBinding(i.params,i.inFileQuery,null,i.params.replace,!0):null,o=u.createLink(null,{Location:t.location},this.explorer._commandService,this.explorer._contentTypeService,this.explorer._openWithCommands,{id:this.getItemLinkId&&this.getItemLinkId(t)},n,{holderDom:this._lastFileIconDom});return o},T.prototype.generateDetailDecorator=function(e,t){if("number"==typeof e.confidence){var i=document.createElement("div");i.classList.add("confidenceDecoratorImg"),e.confidence>=100?(i.classList.add("confidenceHighImg"),i.classList.add("core-sprite-checkmark"),i.title="Perfect match"):0===e.confidence?(i.classList.add("confidenceLowImg"),i.classList.add("core-sprite-error"),i.title="Not a match"):(i.classList.add("confidenceUnknownImg"),i.classList.add("core-sprite-questionmark"),i.title="Could be a match"),t.appendChild(i)}},T.prototype.generateDetailLink=function(e){var t=null;this.explorer.model._provideSearchHelper&&(t=this.explorer.model._provideSearchHelper());var i;i="number"==typeof e.start&&"number"==typeof e.end?{start:e.start,end:e.end}:t?l.generateFindURLBinding(t.params,t.inFileQuery,e.lineNumber,t.params.replace,!0):null;var n=e.location;n||(e.parent.location?e.parent.location:"#");var o=u.createLink(null,{Location:n},this.explorer._commandService,this.explorer._contentTypeService,this.explorer._openWithCommands,{id:this.getItemLinkId(e)},i,{});return o},T.prototype.initCheckboxColumn=function(){if(this._useCheckboxSelection){var e=C("th"),t=C("span",null,null,e);return t.classList.add("selectionCheckmarkSprite"),t.classList.add("core-sprite-check"),this.getCheckedFunc&&(t.checked=this.getCheckedFunc(this.explorer.model.getListRoot()),t.classList.toggle("core-sprite-check_on")),_(t,"click",function(e){var t=e.target.checked?!1:!0;this.onCheck(null,e.target,t)}.bind(this)),e}},T.prototype.getCheckboxColumn=function(e,t){return this.enableCheckbox(e)&&"file"!==e.type&&"group"!==e.type?document.createElement("td"):r.ExplorerRenderer.prototype.getCheckboxColumn.call(this,e,t)},T.prototype.replaceFileElement=function(e){if(e.totalMatches){var t=this._getFileNameElement(e),n=i.node(this.getItemLinkId(e));n.removeChild(n.lastElementChild),n.appendChild(t)}},T.prototype.replaceDetailIcon=function(e,t){if(!this.enableCheckbox(e)&&e&&"detail"===e.type){var n=i.node(this.getDetailIconId(e));if(n){v(n);var o=w(null,null,n);o.classList.add("imageSprite"),o.classList.add("right"===t?"core-sprite-rightarrow":"left"===t?"core-sprite-leftarrow":"core-sprite-none")}}},T.prototype.generateContextTip=function(e){for(var t=C("table"),i=0;i<e.context.length;i++){var n,o=C("tr",null,null,t);if(e.context[i].current){n=C("td",null,null,o),n.noWrap=!0;var r=C("span",null,null,n);this.generateDetailHighlight(e,r)}else n=C("td",null,null,o),n.noWrap=!0,n.textContent=e.context[i].context+" "}return t},T.prototype.getDetailIconId=function(e){return this.explorer.model.getId(e)+"_detailIcon"},E.prototype=new r.SelectionRenderer,E.prototype.getCellHeaderElement=function(t){var i,n;switch(t){case 0:i=C("th","search_report",null,null),n=C("h2",null,null,i),n.textContent=e["Files replaced"]}return i},E.prototype.getCellElement=function(t,n,r){var s=null;switch(t){case 0:s=C("td","search_report",null,null);var a=w(null,null,s,null);T.prototype.renderFileElement.call(this,n.model,a,this.explorer.resultModel);var l=this.explorer.resultModel.getScopingParams(n.model);if(r.title=decodeURI(l.name+"/"+n.model.name),n.status){var c,d=i.$(".navlink",a),h=document.createElement("span");switch(h.classList.add("imageSprite"),n.status){case"warning":h.classList.add("core-sprite-warning"),c=n.message;break;case"failed":h.classList.add("core-sprite-error"),c=n.message;break;case"pass":h.classList.add("core-sprite-ok"),c=n.model.totalMatches?o.formatMessage(e.matchesReplacedMsg,n.matchesReplaced,n.model.totalMatches):n.message}d.insertBefore(h,d.firstElementChild);var u=C("span","replacementStatusSpan",null,d);u.appendChild(document.createTextNode("("+c+")"))}}return s},E.prototype._getFileRenderName=function(e){return this.explorer.resultModel.getFileName(e)},E.prototype._getFileNameElement=function(e){return T.prototype._getFileNameElement.call(this,e)},E.prototype.generateFileLink=function(e,t){return T.prototype.generateFileLink.call(this,e,t)},E.prototype.constructor=E,k.prototype=new r.Explorer,k.prototype.report=function(){this.createTree(this.parentId,new r.ExplorerFlatModel(null,null,this.reportList))},k.prototype.constructor=k,N.prototype={highlight:function(e,t,i){return this._syntaxHighlither.setup(t,i.getTextView(),null,e,!1)}},A.prototype=new r.Explorer,A.prototype.onchange=function(){},A.prototype.setResult=function(e,t){this.parentNode=e,m.showFullPath(this.parentNode,this._shouldShowFullPath),this.model=t,this.model.replaceMode()?(this._hasCheckedItems=!0,this.checkbox=!0,this.renderer=this._replaceRenderer):(this.checkbox=!1,this.renderer=this._normalRenderer),this._reporting=!1,this._currentPreviewModel=null,this._currentReplacedContents={contents:null},this._popUpContext=!1,this._timer=null,this.compareView=null},A.prototype.declareCommands=function(){var t=this,i=new a.Command({tooltip:e.viewByTypesTooltip,name:e.viewByTypes,imageClass:"problems-sprite-view-mode",id:"orion.globalSearch.switchView",groupId:"orion.searchGroup",type:"switch",checked:this._viewByFile,visibleWhen:function(){return i.checked=this._viewByFile,i.name=this._viewByFile?e.viewByTypes:e.viewByFiles,i.tooltip=this._viewByFile?e.viewByTypesTooltip:e.viewByFilesTooltip,this._cacheSearchResult&&t.model}.bind(this),callback:function(){this.switchViewMode()}.bind(this)}),n=new a.Command({name:e["Apply Changes"],tooltip:e["Replace all selected matches"],id:"orion.globalSearch.replaceAll",callback:function(){t.replaceAll()},visibleWhen:function(){return t.model&&t.model.replaceMode()&&!t._reporting&&t._hasCheckedItems}}),o=new a.Command({tooltip:e["Next result"],imageClass:"core-sprite-move-down",id:"orion.search.nextResult",groupId:"orion.searchGroup",visibleWhen:function(){return!t._reporting&&t.getItemCount()>0},callback:function(){t.gotoNext(!0,!0)}}),s=new a.Command({tooltip:e["Previous result"],imageClass:"core-sprite-move-up",id:"orion.search.prevResult",groupId:"orion.searchGroup",visibleWhen:function(){return!t._reporting&&t.getItemCount()>0},callback:function(){t.gotoNext(!1,!0)}}),l=new a.Command({name:e.fullPath,tooltip:e.switchFullPath,imageClass:"sprite-switch-full-path",id:"orion.search.switchFullPath",groupId:"orion.searchGroup",type:"switch",checked:this._shouldShowFullPath,visibleWhen:function(){return t._cacheSearchResult?t.getItemCount()>0&&t._cacheSearchParams&&"file"===t._cacheSearchParams.shape:t.getItemCount()>0},callback:function(){t.switchFullPath()}}),c=new a.Command({tooltip:e.showPerfectMatch,imageClass:"core-sprite-checkmark",extraClass:"togglePerfectMatch",id:"orion.globalSearch.toggleMatch.perfect",groupId:"orion.searchGroup",type:"toggle",visibleWhen:function(){if(!localStorage.showSearchFilters)return!1;var i=!this._matchFilter.hidePerfectMatch.flag;return c.checked=i,c.tooltip=i?e.hidePerfectMatch:e.showPerfectMatch,this._cacheSearchResult&&t.model}.bind(this),callback:function(){this.filterMatch("hidePerfectMatch")}.bind(this)}),d=new a.Command({tooltip:e.showNonMatch,imageClass:"core-sprite-error",extraClass:"toggleNonMatch",id:"orion.globalSearch.toggleMatch.non",groupId:"orion.searchGroup",type:"toggle",visibleWhen:function(){if(!localStorage.showSearchFilters)return!1;var i=!this._matchFilter.hideNonMatch.flag;return d.checked=i,d.tooltip=i?e.hideNonMatch:e.showNonMatch,this._cacheSearchResult&&t.model}.bind(this),callback:function(){this.filterMatch("hideNonMatch")}.bind(this)}),h=new a.Command({tooltip:e.showPossibleMatch,imageClass:"core-sprite-questionmark",extraClass:"togglePossibleMatch",id:"orion.globalSearch.toggleMatch.possible",groupId:"orion.searchGroup",type:"toggle",visibleWhen:function(){if(!localStorage.showSearchFilters)return!1;var i=!this._matchFilter.hidePossibleMatch.flag;return h.checked=i,h.tooltip=i?e.hidePossibleMatch:e.showPossibleMatch,this._cacheSearchResult&&t.model}.bind(this),callback:function(){this.filterMatch("hidePossibleMatch")}.bind(this)});this._commandService.addCommand(i),this._commandService.addCommand(c),this._commandService.addCommand(d),this._commandService.addCommand(h),this._commandService.addCommand(o),this._commandService.addCommand(s),this._commandService.addCommand(n),this._commandService.addCommand(l),this._commandService.addCommandGroup("searchPageActions","orion.searchActions.unlabeled",200),r.createExplorerCommands(this._commandService,function(e){var i=!1;return t.model._provideSearchHelper&&""===t.model._provideSearchHelper().params.keyword&&(i=!0),!e._reporting&&!i}),this._commandService.registerCommandContribution("searchPageActions","orion.globalSearch.switchView",0),this._commandService.registerCommandContribution("searchPageActions","orion.globalSearch.toggleMatch.perfect",1),this._commandService.registerCommandContribution("searchPageActions","orion.globalSearch.toggleMatch.possible",2),this._commandService.registerCommandContribution("searchPageActions","orion.globalSearch.toggleMatch.non",3),this._commandService.registerCommandContribution("searchPageActionsRight","orion.globalSearch.replaceAll",11),this._commandService.registerCommandContribution("searchPageActionsRight","orion.explorer.expandAll",12),this._commandService.registerCommandContribution("searchPageActionsRight","orion.explorer.collapseAll",13),this._commandService.registerCommandContribution("searchPageActionsRight","orion.search.nextResult",14),this._commandService.registerCommandContribution("searchPageActionsRight","orion.search.prevResult",15),this._commandService.registerCommandContribution("searchPageActionsRight","orion.search.switchFullPath",16)},A.prototype._fileExpanded=function(e,t){var n=x(this.model)[e];return null===t||void 0===t?{childrenNumber:0,childDiv:i.node(this.model.getId(n))}:n.children&&n.children.length>0?(0>t?t=n.children.length-1:t>=n.children.length&&(t=0),{childrenNumber:n.children.length,childDiv:i.node(this.model.getId(n.children[t]))}):{childrenNumber:0,childDiv:null}},A.prototype.replaceAll=function(){var t=[];this._reporting=!0,this.initCommands(),this.reportStatus(e["Writing files..."]),this.model.writeReplacedContents(t).then(function(){v(this.getParentDivId());var e=new k(this.getParentDivId(),t,this.model,this._commandService,this._contentTypeService,this._openWithCommands);e.report(),this._inlineSearchPane.hideReplacePreview(),this.reportStatus("")}.bind(this))},A.prototype.toggleCompare=function(e){this.replacePreview(!1,e)},A.prototype.replacePreview=function(t,i){v(this.getParentDivId()),i?(this.compareView&&(this.compareView.destroy(),this.compareView=null),this._currentPreviewModel=null):(this.compareView&&(this.compareView.destroy(),this.compareView=null),this._currentPreviewModel=null),this.initCommands(),t&&this.reportStatus(e["Preparing preview..."]);var n=this;this.createTree(this.getParentDivId(),this.model,{selectionPolicy:"singleSelection",indent:0,setFocus:!0,onCollapse:function(e){n.onCollapse(e)}}),t?(this.gotoCurrent(this.model.restoreLocationStatus?this.model.restoreLocationStatus():null),this.reportStatus("")):this.gotoCurrent(this.model.restoreLocationStatus?this.model.restoreLocationStatus():null)},A.prototype.getItemChecked=function(e){return void 0===e.checked&&(e.checked=("group"!==e.type||0!==e.children.length&&"partial"!==e.location&&"uncategorized"!==e.location)&&(!e.parent||"group"!==e.parent.type||"partial"!==e.parent.location&&"uncategorized"!==e.parent.location)?!0:!1),e.checked},A.prototype._checkedItem=function(){for(var e=x(this.model),t=0;t<e.length;t++){if(e[t].checked)return!0;
if(e[t].children)for(var i=0;i<e[t].children.length;i++)if(e[t].children[i].checked)return!0}return!1},A.prototype.onRowChecked=function(e,t,n){var o;if(e){var r=i.node(e);r&&r._item&&this.onItemChecked(r._item,t,n),o=this._checkedItem()}else o=t,this.onItemChecked(this.model.getListRoot(),t,n);o!==this._hasCheckedItems&&(this._hasCheckedItems=o,this.initCommands())},A.prototype.onNewContentChanged=function(e){e===b(this.getNavHandler().currentModel())&&this.buildPreview(!0)},A.prototype.onItemChecked=function(e,t,n){if(e.checked=t,"file"===e.type||"group"===e.type||e===this.model.getListRoot()){if(e.children)for(var o=0;o<e.children.length;o++){var r=i.node(this.renderer.getCheckBoxId(this.model.getId(e.children[o])));r?this.renderer.onCheck(null,r,t,!1):e.children[o].checked=t}("file"===e.type||"group"===e.type)&&this.onNewContentChanged(e)}else n&&this.onNewContentChanged(e.parent)},A.prototype.buildPreview=function(t){if(0!==x(this.model).length){var n=b(this.getNavHandler().currentModel());this._currentPreviewModel=n,this.model.provideFileContent(n,function(n){this.model.onMatchNumberChanged&&this.model.onMatchNumberChanged(n),this.model.getReplacedFileContent(this._currentReplacedContents,t,n);var o=this._currentReplacedContents.contents;Array.isArray(o)&&(o=this._currentReplacedContents.contents.join(this._currentReplacedContents.lineDelim));var r=this.model.getFileName(n),s=this._contentTypeService.getFilenameContentType(r),a={readonly:!0,hasConflicts:!1,oldFile:{Name:n.location,Type:s,Content:this.model.getFileContents(n)},newFile:{Name:n.location,Type:s,Content:o}};this.compareView?(this.compareView.setOptions(a),this.compareView.refresh(!0)):(a.parentDivId=this._inlineSearchPane.getReplaceCompareDiv(),this.compareView=new c.InlineCompareView(a),this.compareView.setOptions({highlighters:[new N(this.registry)]}),this.compareView.startup());var l=this._inlineSearchPane.getReplaceCompareTitleDiv();i.empty(l),l.appendChild(document.createTextNode(e["Preview: "]+r)),window.setTimeout(function(){this.renderer.focus()}.bind(this),100)}.bind(this))}},A.prototype.caculateNextPage=function(){var e=this.model.getPagingParams();return e.start+e.rows>=e.totalNumber?{start:e.start}:{start:e.start+e.rows}},A.prototype.caculatePrevPage=function(){var e=this.model.getPagingParams(),t=e.start-e.rows;return 0>t&&(t=0),{start:t}},A.prototype.initCommands=function(){var e=this;this._commandService.destroy("searchPageActions"),this._commandService.destroy("searchPageActionsRight"),this._cacheSearchResult?(this._commandService.renderCommands("searchPageActions","searchPageActions",e,e,"button"),this._commandService.renderCommands("searchPageActionsRight","searchPageActionsRight",e,e,"button")):this._commandService.renderCommands("searchPageActionsRight","searchPageActions",e,e,"button")},A.prototype.reportStatus=function(e){this.registry.getService("orion.page.message").setProgressMessage(e)},A.prototype.isExpanded=function(e){return this.myTree.isExpanded(this.model.getId(e))},A.prototype.popupContext=function(e){this.contextTip&&(this.contextTip.destroy(),this.contextTip=null);var t=this.renderer.getDetailIconId(e),n=this.renderer.generateContextTip(e),o=i.node(t),r=["below","right"];if(o)for(var s=this.myTree._parent,a=s.getClientRects()[0],l=o.getClientRects(),c=0,d=l.length;d>c;c++){var u=l[c];if(u.bottom+100>a.bottom){r=["above","right"];break}}this.contextTip=new h.Tooltip({node:o,showDelay:0,trigger:"none",position:r});var p=this.contextTip.contentContainer();p.appendChild(n),this.contextTip.show()},A.prototype.closeContextTip=function(e){this.model.replaceMode()||(this.contextTip&&(this.contextTip.destroy(),this.contextTip=null),e||(this._popUpContext=!1),this.renderer.replaceDetailIcon(this.getNavHandler().currentModel(),"right"))},A.prototype.onCollapse=function(e){var t=this.getNavHandler().currentModel();if(t&&"detail"===t.type){var i=b(e);i===e&&this.getNavHandler().cursorOn(e)}},A.prototype.onExpand=function(e,t){if(e&&e.children&&e.children.length>0&&"string"==typeof t){var i=0;i="first"===t?0:"last"===t?e.children.length-1:JSON.parse(t),("string"==typeof i||0>i||i>=e.children.length)&&(i=0),this.getNavHandler().cursorOn(e.children[i])}},A.prototype.forceExpandFunc=function(e,t,i){return this.myTree.expand(e,function(){this.onExpand(e,t,i)}.bind(this)),null},A.prototype.keyEventListeningDiv=function(e){return i.node(this.getParentDivId(e))},A.prototype.onFocus=function(e){e||this.closeContextTip()},A.prototype.preventDefaultFunc=function(e,t){if(!t)return!0;if(!this.model.replaceMode()&&!e.ctrlKey&&"detail"===t.type){if(37===e.keyCode&&this._popUpContext)return this.closeContextTip(),e.preventDefault(),!0;if(39===e.keyCode&&!this._popUpContext)return this._popUpContext=!0,this.renderer.replaceDetailIcon(t,"left"),this.popupContext(t),e.preventDefault(),!0}return!1},A.prototype.onReplaceCursorChanged=function(e){if(this._inlineSearchPane.showReplacePreview(),S(this._currentPreviewModel,e)||this.buildPreview(),this.compareView&&"detail"===e.type)if(e.checked){var t=0;e.parent.children.some(function(i){return this.model.getId(e)===this.model.getId(i)?!0:(i.checked&&t++,!1)},this),this.compareView.gotoDiff(t)}else if(void 0!==e.lineNumber){var i=e.matches[e.matchNumber-1].startIndex,n=i+e.matches[e.matchNumber-1].length;this.compareView.gotoLine(e.lineNumber-1,i,n)}},A.prototype.onCursorChanged=function(e,t){this.renderer.replaceDetailIcon(e,"none"),this.model.storeLocationStatus&&this.model.storeLocationStatus(t),this.model.replaceMode()?(this._timer&&window.clearTimeout(this._timer),this._timer=window.setTimeout(function(){this._timer=null,this.onReplaceCursorChanged(t)}.bind(this),200)):"detail"===t.type?this._popUpContext?(this.popupContext(t),this.renderer.replaceDetailIcon(t,"left")):this.renderer.replaceDetailIcon(t,"right"):this._popUpContext&&this.closeContextTip(!0)},A.prototype._startUp=function(){var t=this.model.getPagingParams();if(this.model._provideSearchHelper&&(this._inlineSearchPane.newDocumentTitle=this.model._provideSearchHelper().displayedSearchTerm+" - "+o.formatMessage(e["${0} matches"],t.totalNumber),window.document.title=this._inlineSearchPane.newDocumentTitle),0===t.numberOnPage){var i=e["No matches"];this.model._provideSearchHelper&&(i=o.formatMessage(e.NoMatchFound,this.model._provideSearchHelper().displayedSearchTerm)),this.parentNode.textContent="";var n=C("b",null,null,this.parentNode);return y(document.createTextNode(i),n,"only"),void this.reportStatus("")}var r=this;this.model.buildResultModel(),this.model.replaceMode()?r.replacePreview(!0,!0):(this.initCommands(),v(this.getParentDivId()),this.createTree(this.getParentDivId(),this.model,{selectionPolicy:"singleSelection",indent:0,getChildrenFunc:function(e){return this.model.getFilteredChildren(e)}.bind(this),setFocus:!0,onCollapse:function(e){r.onCollapse(e)}}),this.gotoCurrent(this.model.restoreLocationStatus?this.model.restoreLocationStatus():null),this.reportStatus(""))},A.prototype.startUp=function(){if(this._openWithCommands)this._startUp();else{var e=p.createOpenWithCommands(this.registry,this._contentTypeService,this._commandService);t.when(e,function(e){this._openWithCommands=e,this._startUp()}.bind(this))}},A.prototype._incrementalRender=function(){var e=this;this.model.buildResultModel(),this.createTree(this.getParentDivId(),this.model,{selectionPolicy:"singleSelection",getChildrenFunc:function(e){return this.model.getFilteredChildren(e)}.bind(this),indent:0,setFocus:!0,onCollapse:function(t){e.onCollapse(t)}})},A.prototype.incrementalRender=function(){if(this._openWithCommands)this._incrementalRender();else{var e=p.createOpenWithCommands(this.registry,this._contentTypeService,this._commandService);t.when(e,function(e){this._openWithCommands=e,this._incrementalRender()}.bind(this))}},A.prototype.getItemCount=function(){var e=0;return this.model&&(e=this.model.getListRoot().children.length),e},A.prototype.getParentDivId=function(){return this.parentNode.id},A.prototype.gotoCurrent=function(e){var t=null,i="none";e?(t=e.file,i=e.detail):t=this.getNavHandler().currentModel(),t||(t=x(this.model).length>0?x(this.model)[0]:null),this.getNavHandler().cursorOn(t,!0,null,!0),t&&i&&"none"!==i&&this.myTree.expand(t,function(){this.onExpand(t,i)}.bind(this))},A.prototype.gotoNext=function(e,t){if(0!==x(this.model).length&&(this.getNavHandler().iterate(e,t,!0),this.model.replaceMode()))for(var i=this.getNavHandler().currentModel();i&&!i.checked;)this.getNavHandler().iterate(e,t,!0),i=this.getNavHandler().currentModel()},A.prototype.switchFullPath=function(){m.togglePrefs(this._preferences,"/inlineSearchPane",["showFullPath"]).then(function(e){this._shouldShowFullPath=e?e[0]:!1,m.showFullPath(this.parentNode,this._shouldShowFullPath)}.bind(this))},A.prototype.switchViewMode=function(){m.togglePrefs(this._preferences,"/inlineSearchPane",["viewByFile"]).then(function(e){this._viewByFile=e?e[0]:!1,this.runSearch(this._cacheSearchParams,this._resultsNode,this._cacheSearchResult)}.bind(this))},A.prototype.filterMatch=function(e){m.togglePrefs(this._preferences,"/inlineSearchPane",[e]).then(function(t){this._matchFilter[e].flag=t?t[0]:!1,this.runSearch(this._cacheSearchParams,this._resultsNode,this._cacheSearchResult)}.bind(this))},A.prototype._renderSearchResult=function(e,t,n,o){var r=i.node(e);i.empty(r),r.focus();var s=this,a=new f.SearchResultModel(this.registry,this.fileClient,n,n.length,t,{onMatchNumberChanged:function(e){s.renderer.replaceFileElement(e)},matchFilter:this._matchFilter});this.setResult(e,a),o?this.incrementalRender():this.startUp();var l=this._inlineSearchPane.getSearchResultsTitleDiv();i.empty(l),l.appendChild(document.createTextNode(L(this.model)))},A.prototype._search=function(t,n,r){if(i.empty(t),r)return this._resultsNode=t,this._cacheSearchParams=n,this._cacheSearchParams.shape=this._viewByFile?"file":"group",this._cacheSearchResult=r,this._renderSearchResult(t,this._cacheSearchParams,r,n.incremental),void window.setTimeout(function(){this.expandAll(null,["partial"])}.bind(this),10);if(this._cacheSearchResult=null,"undefined"!=typeof n.keyword){this.registry.getService("orion.page.message").setProgressMessage(e["Searching..."]);var s=new g.GSearchClient({serviceRegistry:this.registry,fileClient:this.fileClient});s.search(n).then(function(e){this.registry.getService("orion.page.message").setProgressMessage(""),e&&this._renderSearchResult(t,n,e)}.bind(this),function(t){var i=o.formatMessage(e["${0}. Try your search again."],t&&t.error?t.error:"Error");this.registry.getService("orion.page.message").setProgressResult({Message:i,Severity:"Error"})}.bind(this),function(e,i){this._renderSearchResult(t,n,s.convert(e,n),i)}.bind(this))}},A.prototype.runSearch=function(e,t,n){var o=i.node(t);this._search(o,e,n)},A.prototype.constructor=A,A}),define("text!orion/widgets/input/ComboTextInput.html",[],function(){return'<div class="comboTextInputWrapper">\r\n	<input type="text" class="comboTextInputField">\r\n	<button class="orionButton recentEntryButton" tabindex="-1">\r\n		<span class="core-sprite-openarrow recentEntryArrow"></span>\r\n	</button>\r\n	<button class="orionButton commandButton comboTextInputButton"></button>\r\n</div>'}),define("orion/inputCompletion/inputCompletion",["orion/EventTarget"],function(e){function t(t,i,n){e.attach(this),this._binderFunc=i,this.setInputField(t);var o=n?n.group:null;o||(o=this._inputField&&this._inputField.id?this._inputField.id:"default__input__group"),this._completionIdPrefix=o+"__completion__",this._proposeFromStart=n?n.proposeFromStart:!1,this._extendedProvider=n?n.extendedProvider:null,this._serviceRegistry=n?n.serviceRegistry:null,this._onDelete=n?n.onDelete:null,this._deleteToolTips=n?n.deleteToolTips:"",this._proposalIndex=-1,this._dismissed=!0,this._mouseDown=!1,this._dataList=[],this._initUI(),this._listeners=[];var r=function(e){if(this._binderFunc){var t=this;this._binderFunc(function(t){this._bind(t),e.deleting&&(this._proposeOn(this._inputField.value),this._selectProposal(this._proposalIndex,!0))}.bind(t))}}.bind(this);this.addEventListener("inputDataListChanged",r),this._listeners.push({evtTarget:this,type:"inputDataListChanged",handler:r});var s=function(){this._mouseDown=!0}.bind(this);this._completionUIContainer.addEventListener("mousedown",s),this._listeners.push({evtTarget:this._completionUIContainer,type:"mousedown",handler:s});var a=function(){this._mouseDown=!1}.bind(this);this._completionUIContainer.addEventListener("mouseup",a),this._listeners.push({evtTarget:this._completionUIContainer,type:"mouseup",handler:a})}return t.prototype._removeListeners=function(e){e&&e.forEach(function(e){e.evtTarget.removeEventListener(e.type,e.handler,!1)})},t.prototype.destroy=function(){this._removeListeners(this._inputFieldListeners),this._removeListeners(this.listeners)},t.prototype.hasValueOf=function(e){return this._dataList.some(function(t){return t.value===e})},t.prototype.setInputField=function(e){this._inputField&&this._inputFieldListeners&&this._removeListeners(this._inputFieldListeners),this._inputFieldListeners=[],this._inputField=e,"string"==typeof this._inputField&&(this._inputField=document.getElementById(this._inputField));var t=function(){if(this._mouseDown){var e=this;window.setTimeout(function(){this._inputField.focus()}.bind(e),200)}else document.activeElement!==this._inputField&&this._dismiss()}.bind(this);this._inputField.addEventListener("blur",t),this._inputFieldListeners.push({evtTarget:this._inputField,type:"blur",handler:t});var i=function(e){this.onKeyDown(e)}.bind(this);this._inputField.addEventListener("keydown",i),this._inputFieldListeners.push({evtTarget:this._inputField,type:"keydown",handler:i});var n=function(){this._proposeOn(this._inputField.value)}.bind(this);this._inputField.addEventListener("input",n),this._inputFieldListeners.push({evtTarget:this._inputField,type:"input",handler:n});var o=function(){if(this._dismissed&&this._binderFunc){if(this._dismissing)return void(this._dismissing=!1);if(this._binderFunc){var e=this;this._binderFunc(function(e){this._bind(e),this._inputField.value}.bind(e))}}}.bind(this);this._inputField.addEventListener("focus",o),this._inputFieldListeners.push({evtTarget:this._inputField,type:"focus",handler:o})},t.prototype.onKeyDown=function(e){if(this._dismissed)return!0;var t=e.charCode||e.keyCode;return 13===t?this._proposalList&&this._proposalList.length>0&&this._proposalIndex>=0&&this._proposalIndex<this._proposalList.length?(e.preventDefault(),this._dismiss(this._proposalList[this._proposalIndex].item.value,e.ctrlKey),e.stopPropagation(),!1):!0:(40===t||38===t)&&this._proposalList&&this._proposalList.length>0?(e.preventDefault(),this._walk(40===t),e.stopPropagation(),!1):27===t?(e.preventDefault(),this._dismiss(),!1):46===t&&this._proposalIndex>-1&&this._onDelete?(e.preventDefault(),this._onDelete(this._proposalList[this._proposalIndex].item.value,this),this._resetIndexAfterDeletion(),e.stopPropagation(),!1):!0},t.prototype._resetIndexAfterDeletion=function(){this._proposalList.length<=1?this._proposalIndex=-1:this._proposalIndex===this._proposalList.length-1&&(this._proposalIndex=this._proposalList.length-2)},t.prototype._bind=function(e){this._dataList=e},t.prototype._getUIContainerID=function(){return this._completionIdPrefix+"UIContainer"},t.prototype._getUIProposalListId=function(){return this._completionIdPrefix+"UIProposalList"},t.prototype._initUI=function(){this._completionUIContainer=document.getElementById(this._getUIContainerID()),this._completionUIContainer||(this._completionUIContainer=document.createElement("div"),this._completionUIContainer.id=this._getUIContainerID(),this._completionUIContainer.style.display="none",this._completionUIContainer.className="inputCompletionContainer",this._completionUIContainer.setAttribute("role","list"),this._completionUIContainer.setAttribute("aria-atomic","true"),this._completionUIContainer.setAttribute("aria-live","assertive"),document.body.appendChild(this._completionUIContainer)),this._completionUIContainer.textContent="",this._completionUL=document.getElementById(this._getUIProposalListId()),this._completionUL||(this._completionUL=document.createElement("ul"),this._completionUL.id=this._getUIProposalListId(),this._completionUL.className="inputCompletionUL"),this._completionUL.textContent="",this._completionUIContainer.appendChild(this._completionUL)},t.prototype._createProposalLink=function(e,t,i,n){var o=document.createElement("a");return o.href=require.toUrl(t),o.appendChild(this._createBoldText(e,i,n)),o},t.prototype._createBoldText=function(e,t,i,n){if(0>t)return document.createTextNode(e);var o,r=n?n:document.createElement("span"),s=0;s!==t&&(o=document.createTextNode(e.substring(s,t)),r.appendChild(o));var a=document.createElement("b");return r.appendChild(a),o=document.createTextNode(e.substring(t,t+i)),a.appendChild(o),t+i<e.length&&(o=document.createTextNode(e.substring(t+i)),r.appendChild(o)),r},t.prototype._proposeOnCategory=function(e,t){if(0!==t.length){var i;if(e){i=document.createElement("li"),i.className="inputCompletionLICategory";var n=document.createTextNode(e);i.appendChild(n),this._completionUL.appendChild(i)}t.forEach(function(e){i=document.createElement("li"),i.onmouseover=function(e){this._selectProposal(e.currentTarget)}.bind(this),i.onclick=function(e){this._dismiss(e.currentTarget.completionItem.value)}.bind(this),i.className="inputCompletionLINormal",i.completionItem=e.item;var t;if("string"==typeof e.item.value){var n=document.createElement("table");n.style.width="100%",n.style.tableLayout="fixed",n.style.borderSpacing="0";var o=document.createElement("tr");o.style.width=this._inputField.offsetWidth+"px",n.appendChild(o);var r=document.createElement("td");r.classList.add("inputCompletionLILeftTD");var s=this._createBoldText(e.item.value,e.boldIndex,e.boldLength);if(r.appendChild(s),r.style.overflow="hidden",o.appendChild(r),this._onDelete){t=document.createElement("button"),t.classList.add("inputCompletionDismissButton"),t.classList.add("layoutRight"),t.classList.add("core-sprite-close"),t.classList.add("imageSprite"),t.style.display="none",t.style.margin="0 0 0",t.title=this._deleteToolTips,t.onclick=function(t){t.stopPropagation(),this._onDelete(e.item.value,this),this._resetIndexAfterDeletion()}.bind(this);var a=document.createElement("td");a.classList.add("inputCompletionLIRightTD"),a.appendChild(t),o.appendChild(a)}i.appendChild(n)}else e.item.value.name&&"link"===e.item.value.type&&i.appendChild(this._createProposalLink(e.item.value.name,e.item.value.value,e.boldIndex,e.boldLength));this._completionUL.appendChild(i),this._proposalList.push({item:e.item,domNode:i,deleteBtn:t})}.bind(this))}},t.prototype._domNode2Index=function(e){if(this._proposalList)for(var t=0;t<this._proposalList.length;t++)if(this._proposalList[t].domNode===e)return t;return-1},t.prototype._highlight=function(e,t){var i,n=e,o=!1;isNaN(n)||(o=!0,this._proposalList&&e>=0&&e<this._proposalList.length?(n=this._proposalList[e].domNode,i=this._proposalList[e].deleteBtn):n=null),n&&(n.className=t?"inputCompletionLISelected":"inputCompletionLINormal",i&&(i.style.display=t?"":"none"),t&&o&&(n.offsetTop<this._completionUIContainer.scrollTop?n.scrollIntoView(!0):n.offsetTop+n.offsetHeight>this._completionUIContainer.scrollTop+this._completionUIContainer.clientHeight&&n.scrollIntoView(!1)))},t.prototype._selectProposal=function(e,t){var i=e;isNaN(i)&&(i=this._domNode2Index(e)),(i!==this._proposalIndex||t)&&(this._highlight(this._proposalIndex,!1),this._proposalIndex=i,this._highlight(this._proposalIndex,!0))},t.prototype._dismiss=function(e,t){this._mouseDown||(this._dismissed=!0,this._proposalList=null,this._proposalIndex=-1,"string"==typeof e?(this._inputField.value=e,this._dismissing=!0,this._inputField.focus()):e&&e.name&&"link"===e.type&&(t?window.open(e.value):window.location.href=e.value),this._completionUIContainer.style.display="none")},t.prototype._show=function(){if(this._proposalList&&this._proposalList.length>0){for(var e=0,t=0,i=this._inputField;i;)e+=i.offsetLeft,t+=i.offsetTop,i=i.offsetParent;this._completionUIContainer.style.display="block",this._completionUIContainer.style.top=t+this._inputField.offsetHeight+2+"px",this._completionUIContainer.style.left=e+"px",this._completionUIContainer.style.width=this._inputField.offsetWidth+"px",this._mouseDown=!1,this._dismissed=!1}else this._dismissed=!0,this._proposalList=null,this._proposalIndex=-1,this._completionUIContainer.style.display="none"},t.prototype._walk=function(e){var t=this._proposalIndex+(e?1:-1);-1>t?t=this._proposalList.length-1:t>=this._proposalList.length&&(t=-1),this._selectProposal(t)},t.prototype._proposeOnList=function(e,t,i){var n="",o=[],r=t?t.length:0;e.forEach(function(e){if("category"===e.type)this._proposeOnCategory(n,o),n=e.label,o=[];else{var s=!0,a=-1;if(t&&i){var l;"string"==typeof e.value?l=e.value.toLowerCase():e.value.name&&(l=e.value.name.toLowerCase()),a=l.indexOf(t),0>a?s=!1:this._proposeFromStart&&(s=0===a)}s&&o.push({item:e,boldIndex:a,boldLength:r})}}.bind(this)),this._proposeOnCategory(n,o)},t.prototype._proposeOn=function(e){this._completionUL.textContent="";var t=e?e.toLowerCase():null;this._proposalList=[],this._proposeOnList(this._dataList,t,!0),this._extendedProvider&&t?this._extendedProvider(e,function(i){if(i){var n=this;i.forEach(function(i){this._proposeOnList(i.proposals,i.filterForMe?t:e,i.filterForMe)}.bind(n))}this._show()}.bind(this),[]):this._show()},t.prototype.constructor=t,{InputCompletion:t}}),define("orion/widgets/input/ComboTextInput",["orion/objects","orion/webui/littlelib","text!orion/widgets/input/ComboTextInput.html","i18n!orion/widgets/nls/messages","orion/inputCompletion/inputCompletion"],function(e,t,i,n,o){function r(e){this._domNodeId=e.id,this._parentNode=e.parentNode,this._insertBeforeNode=e.insertBeforeNode,this._hasButton=e.hasButton,this._buttonText=e.buttonText,this._buttonClickListener=e.buttonClickListener,this._hasInputCompletion=e.hasInputCompletion,this._serviceRegistry=e.serviceRegistry,this._defaultRecentEntryProposalProvider=e.defaultRecentEntryProposalProvider,this._extendedRecentEntryProposalProvider=e.extendedRecentEntryProposalProvider,this._onRecentEntryDelete=e.onRecentEntryDelete,this._initializeDomNodes()}return e.mixin(r.prototype,{_initializeDomNodes:function(){this._domNode=t.createNodes(i),this._domNode.id=this._domNodeId,this._comboTextInputWrapper=t.$(".comboTextInputWrapper",this._domNode),this._comboTextInputWrapper||(this._comboTextInputWrapper=this._domNode),this._textInputNode=t.$(".comboTextInputField",this._domNode),this._textInputNode.addEventListener("focus",function(){this._domNode.classList.add("comboTextInputWrapperFocussed")}.bind(this)),this._textInputNode.addEventListener("blur",function(){this._domNode.classList.remove("comboTextInputWrapperFocussed")}.bind(this)),this._recentEntryButton=t.$(".recentEntryButton",this._domNode),this._hasInputCompletion?this._initializeCompletion():(this._domNode.removeChild(this._recentEntryButton),this._recentEntryButton=void 0),this._comboTextInputButton=t.$(".comboTextInputButton",this._domNode),this._hasButton?(this._comboTextInputButton=t.$(".comboTextInputButton",this._domNode),this._buttonText&&this._comboTextInputButton.appendChild(document.createTextNode(this._buttonText)),this._buttonClickListener&&this._comboTextInputButton.addEventListener("click",function(e){this._buttonClickListener(e)}.bind(this))):(this._domNode.removeChild(this._comboTextInputButton),this._comboTextInputButton=void 0),this._insertBeforeNode?this._parentNode.insertBefore(this._domNode,this._insertBeforeNode):this._parentNode.appendChild(this._domNode)},_initializeCompletion:function(){this._localStorageKey=this._domNodeId+"LocalStorageKey";var e=!1;this._defaultRecentEntryProposalProvider?e=!0:this._defaultRecentEntryProposalProvider=function(e){var t=this.getRecentEntryArray();t||(t=[]),e(t)}.bind(this),void 0===this._onRecentEntryDelete&&(this._onRecentEntryDelete=function(e,t){var i=this.getRecentEntryArray(),n=this._getIndexOfValue(i,e);n>-1&&(i.splice(n,1),this._storeRecentEntryArray(i),0===i.length&&this._hideRecentEntryButton(),t&&window.setTimeout(function(){t.dispatchEvent({type:"inputDataListChanged",deleting:!0})}.bind(this),20))}.bind(this)),this._inputCompletion=new o.InputCompletion(this._textInputNode,this._defaultRecentEntryProposalProvider,{serviceRegistry:this._serviceRegistry,group:this._domNodeId+"InputCompletion",extendedProvider:this._extendedRecentEntryProposalProvider,onDelete:this._onRecentEntryDelete,deleteToolTips:n.DeleteSearchTrmMsg}),this._recentEntryButton.addEventListener("click",function(e){this._textInputNode.focus(),this._inputCompletion._proposeOn(),t.stop(e)}.bind(this));var i=this.getRecentEntryArray();e||i&&0<i.length?this._showRecentEntryButton():this._hideRecentEntryButton()},getDomNode:function(){return this._domNode},getTextInputNode:function(){return this._textInputNode},getTextInputValue:function(){return this._textInputNode.value},setTextInputValue:function(e){this._textInputNode.value=e},getButton:function(){return this._comboTextInputButton},getRecentEntryButton:function(){return this._recentEntryButton},setRecentEntryButtonTitle:function(e){this._recentEntryButton&&(this._recentEntryButton.title=e)},addTextInputValueToRecentEntries:function(){var e=this.getTextInputValue();if(e){var t=this.getRecentEntryArray();t||(t=[]);var i=this._getIndexOfValue(t,e);0!==i&&(-1!==i&&t.splice(i,1),t.unshift({type:"proposal",label:e,value:e}),this._storeRecentEntryArray(t),this._showRecentEntryButton())}},_getIndexOfValue:function(e,t){var i=-1;return e.some(function(e,n){return e.value===t?(i=n,!0):!1}),i},showButton:function(){this._comboTextInputButton.classList.remove("isHidden")},hideButton:function(){this._comboTextInputButton.classList.add("isHidden")},show:function(){this._comboTextInputWrapper.classList.remove("hidden")},hide:function(){this._comboTextInputWrapper.classList.add("hidden")},enable:function(e){this._textInputNode.disabled=!e,this._recentEntryButton.disabled=!e},getRecentEntryArray:function(){var e=null;if(this._localStorageKey){var t=localStorage.getItem(this._localStorageKey);t&&(e=JSON.parse(t))}return e},_storeRecentEntryArray:function(e){var t=JSON.stringify(e);localStorage.setItem(this._localStorageKey,t)},_showRecentEntryButton:function(){this._recentEntryButton.classList.remove("isHidden")},_hideRecentEntryButton:function(){this._recentEntryButton.classList.add("isHidden")}}),r}),define("orion/search/InlineSearchPane",["orion/objects","orion/webui/littlelib","text!orion/search/InlineSearchPane.html","orion/searchClient","orion/inlineSearchResultExplorer","orion/searchUtils","orion/Deferred","orion/webui/dialogs/DirectoryPrompterDialog","orion/widgets/input/ComboTextInput","i18n!orion/search/nls/messages","orion/webui/Slideout"],function(e,t,i,n,o,r,s,a,l,c,d){function h(e,t){u.call(this,e),this._serviceRegistry=t.serviceRegistry,this._commandRegistry=t.commandRegistry,this._fileClient=t.fileClient,this._preferences=t.preferences,this._initialize()}var u=d.SlideoutViewMode;return h.prototype=Object.create(u.prototype),h.prototype.constructor=h,e.mixin(h.prototype,{_initialize:function(){this._searchWrapper=document.createElement("div"),this._slideout.getContentNode().appendChild(this._searchWrapper);var e=document.createRange();e.selectNode(this._slideout.getContentNode());var r=e.createContextualFragment(i);this._searchWrapper.appendChild(r),this._searchWrapper.classList.add("searchWrapper"),this._focusOnTextInput=function(){this._searchTextInputBox.select(),this._searchTextInputBox.focus()}.bind(this),this._replaceWrapper=t.$(".replaceWrapper",this._searchWrapper),this._searchOptWrapperDiv=t.$(".searchOptWrapperDiv",this._searchWrapper),this._searchResultsTitle=t.$(".searchResultsTitle",this._searchWrapper),this._searchResultsWrapperDiv=t.$(".searchResultsWrapperDiv",this._searchWrapper),this._searchResultsWrapperDiv.id="inlineSearchResultsWrapper",this._replaceCompareTitleDiv=t.node("replaceCompareTitleDiv"),this._replaceCompareDiv=t.node("replaceCompareDiv"),this._searcher=new n.Searcher({serviceRegistry:this._serviceRegistry,commandService:this._commandRegistry,fileService:this._fileClient}),this._searchResultExplorer=new o(this._serviceRegistry,this._commandRegistry,this,this._preferences),this._initControls(),this._initHTMLLabels(),this._slideout.getContentNode().removeChild(this._searchWrapper)},isVisible:function(){return this._slideout.isVisible()&&this===this._slideout.getCurrentViewMode()},show:function(){this.previousDocumentTitle=window.document.title,u.prototype.show.call(this),window.setTimeout(this._focusOnTextInput,100)},hide:function(){window.document.title===this.newDocumentTitle&&(window.document.title=this.previousDocumentTitle),u.prototype.hide.call(this),this._filledResult&&(this._showSearchOptBLocks(),this._hideReplaceField(),this._searchBox.show(),this._searchBox.enable(!0),delete this._filledResult,t.empty(t.node("searchResultsTitle")),t.empty(t.node("searchPageActions")),t.empty(t.node("searchPageActionsRight")),t.empty(this._searchResultsWrapperDiv)),this.hideReplacePreview()},getWrapperNode:function(){return this._searchWrapper},getOptions:function(){var e="";this._searchLocations.forEach(function(t){e&&(e=e.concat(",")),e=e.concat(t)},this),this._correctFileNamePatternsInputValue();var t=r.getFileNamePatternsArray(this._fileNamePatternsBox.getTextInputValue()),i=this._replaceBox.getTextInputValue()||void 0;return{keyword:this._searchBox.getTextInputValue(),rows:1e4,start:0,replace:i,caseSensitive:this._caseSensitiveCB.checked,wholeWord:this._wholeWordCB.checked,regEx:this._regExCB.checked,fileNamePatterns:t,resource:e}},search:function(){this._searchBox.enable(!0),this._submitSearch()},fillSearchResult:function(e){this._filledResult=e,this._showReplaceField(),this._hideSearchOptBLocks(),this._searchResultExplorer.runSearch(e.searchParams,this._searchResultsWrapperDiv,e)},_submitSearch:function(){var e=this.getOptions();if(e.replace=null,e.keyword){this._searchBox.addTextInputValueToRecentEntries(),this._fileNamePatternsBox.addTextInputValueToRecentEntries();var t=r.getSearchParams(this._searcher,e.keyword,e);this._searchResultExplorer.runSearch(t,this._searchResultsWrapperDiv),this._hideSearchOptions()}},_replacePreview:function(){var e=this.getOptions();if(e.replace||(e.replace=""),e.keyword){this._searchBox.addTextInputValueToRecentEntries(),this._replaceBox.addTextInputValueToRecentEntries(),this._fileNamePatternsBox.addTextInputValueToRecentEntries();var t;this._filledResult?(t=r.copySearchParams(this._filledResult.searchParams),t.replace=e.replace):(t=r.getSearchParams(this._searcher,e.keyword,e),this._hideSearchOptions()),this._searchResultExplorer.runSearch(t,this._searchResultsWrapperDiv,this._filledResult)}},_initSearchBox:function(){var e=function(e,t){var i=this._serviceRegistry.getServiceReferences("orion.search.proposal");if(!i||0===i.length)return void t(null);var n=[],o=this;i.forEach(function(t){var i=t.getProperty("filterForMe");n.push(this._serviceRegistry.getService(t).run(e).then(function(e){for(var t={filterForMe:i,proposals:[]},n=0;n<e.length;n++){t.proposals.push({type:"category",label:e[n].category});for(var o=0;o<e[n].datalist.length;o++)t.proposals.push({type:"proposal",label:e[n].datalist[o],value:e[n].datalist[o]})}return t}))}.bind(o)),s.all(n).then(function(e){t(e)})}.bind(this),i=t.$(".searchMainOptionBlock",this._searchWrapper),n=function(){this.isVisible()||this.show(),this._submitSearch()}.bind(this);this._searchBox=new l({id:"advSearchInput",parentNode:i,insertBeforeNode:this._replaceWrapper,hasButton:!0,buttonClickListener:n,hasInputCompletion:!0,serviceRegistry:this._serviceRegistry,extendedRecentEntryProposalProvider:e});var o=document.createElement("span");o.classList.add("core-sprite-search"),this._searchButton=this._searchBox.getButton(),this._searchButton.classList.add("searchButton"),this._searchButton.appendChild(o),this._searchTextInputBox=this._searchBox.getTextInputNode(),this._searchTextInputBox.placeholder=c["Type a search term"],this._searchBox.setRecentEntryButtonTitle(c["Show previous search terms"]),this._searchWrapper.addEventListener("keydown",function(e){if(!e.defaultPrevented){var i=e.charCode||e.keyCode;
i===t.KEY.ENTER&&this._searchTextInputBox===e.target?(this._searchTextInputBox.blur(),this._replaceBoxIsHidden()?this._submitSearch():this._replacePreview()):i===t.KEY.ESCAPE&&this._slideout.getPreviousActiveElement()&&(this._slideout.getPreviousActiveElement()===this._searchTextInputBox?this._searchTextInputBox.blur():this._slideout.getPreviousActiveElement().focus(),this.hide())}}.bind(this))},_initReplaceBox:function(){this._replaceBox=new l({id:"advReplaceInput",parentNode:this._replaceWrapper,hasButton:!0,buttonText:c["Replace..."],buttonClickListener:this._replacePreview.bind(this),hasInputCompletion:!0,serviceRegistry:this._serviceRegistry}),this._replaceTextInputBox=this._replaceBox.getTextInputNode(),this._replaceTextInputBox.placeholder=c["Replace With"],this._replaceButton=this._replaceBox.getButton(),this._replaceButton.title=c["Show replacement preview"],this._replaceBox.setRecentEntryButtonTitle(c["Show previous replace terms"]),this._replaceTextInputBox.addEventListener("keydown",function(e){var i=e.charCode||e.keyCode;i===t.KEY.ENTER&&(this._replacePreview(),this._replaceTextInputBox.blur())}.bind(this))},_initFileNamePatternsBox:function(){this._fileNamePatternsHint=t.$(".fileNamePatternsHint",this._searchWrapper),this._fileNamePatternsBox=new l({id:"fileNamePatternsInput",insertBeforeNode:this._fileNamePatternsHint,parentNode:this._fileNamePatternsHint.parentNode,hasButton:!1,hasInputCompletion:!0,serviceRegistry:this._serviceRegistry}),this._fileNamePatternsBox.getDomNode().classList.add("fileNamePatternsInput"),this._fileNamePatternsTextInput=this._fileNamePatternsBox.getTextInputNode(),this._fileNamePatternsTextInput.classList.add("fileNamePatternsTextInput"),this._fileNamePatternsTextInput.placeholder="*.*",t.empty(this._fileNamePatternsHint),this._fileNamePatternsHint.appendChild(document.createTextNode(c["(* = any string, ? = any character)"])),this._fileNamePatternsTextInput.addEventListener("focus",function(){this._fileNamePatternsHint.classList.add("fileNamePatternsHintVisible")}.bind(this)),this._fileNamePatternsTextInput.addEventListener("blur",function(){this._correctFileNamePatternsInputValue(),this._fileNamePatternsHint.classList.remove("fileNamePatternsHintVisible")}.bind(this)),this._fileNamePatternsTextInput.addEventListener("keydown",function(e){var i=e.charCode||e.keyCode;i===t.KEY.ENTER&&(this._fileNamePatternsTextInput.blur(),this._replaceBoxIsHidden()?this._submitSearch():this._replacePreview())}.bind(this))},_initControls:function(){this._initSearchBox(),this._initReplaceBox(),this._initFileNamePatternsBox(),this._caseSensitiveCB=t.$("#advSearchCaseSensitive",this._searchWrapper),this._wholeWordCB=t.$("#advSearchWholeWord",this._searchWrapper),this._regExCB=t.$("#advSearchRegEx",this._searchWrapper),this._toggleReplaceLink=t.$("#toggleReplaceLink",this._searchWrapper),this._toggleSearchOptionsLink=t.$("#toggleSearchOptionsLink",this._searchWrapper),this._toggleSearchOptionsLink.addEventListener("click",this.showSearchOptions.bind(this)),this._toggleSearchOptionsLink.textContent=c["^ Edit Search"],this._replaceBoxIsHidden()&&(this._toggleReplaceLink.textContent=c["Show Replace"]),this._toggleReplaceLink.addEventListener("click",this._toggleReplaceFieldVisibility.bind(this)),this._initSearchScope()},_initHTMLLabels:function(){this._replaceCompareTitleDiv.textContent=c["Preview: "],t.$("#advSearchCaseSensitiveLabel",this._searchWrapper).appendChild(document.createTextNode(c["Case sensitive"])),t.$("#advSearchWholeWordLabel",this._searchWrapper).appendChild(document.createTextNode(c["Whole Word"])),t.$("#advSearchRegExLabel",this._searchWrapper).appendChild(document.createTextNode(c["Regular expression"])),t.$("#searchScopeLabel",this._searchWrapper).appendChild(document.createTextNode(c.Scope)),t.$("#fileNamePatternsLabel",this._searchWrapper).appendChild(document.createTextNode(c["File name patterns (comma-separated)"])),t.$("#searchScopeSelectButton",this._searchWrapper).title=c["Choose a Folder"]},setSearchScope:function(e){if(e&&e.fileMetadata&&(e=e.fileMetadata),e&&(e.Path||e.Location)){var t=e.Path||e.Location;this._searchLocations=[t]}else this._searchLocations=[this._rootURL];e&&e.Location?this._searcher.setLocationByMetaData(e):this._searcher.setLocationbyURL(this._searchLocations[0]),this._displaySelectedSearchScope()},setSearchText:function(e){this._searchBox.setTextInputValue(e)},_initSearchScope:function(){this._rootURL=this._fileClient.fileServiceRootURL(),this._searchLocations=[this._rootURL],this._searchScopeElementWrapper=t.$("#searchScopeElementWrapper",this._searchOptWrapperDiv),this._searchScopeSelectButton=t.$("#searchScopeSelectButton",this._searchOptWrapperDiv),this._searchScopeSelectButton.addEventListener("click",function(){var e=new a.DirectoryPrompterDialog({title:c["Choose a Folder"],serviceRegistry:this._serviceRegistry,fileClient:this._fileClient,func:this.setSearchScope.bind(this)});e.show()}.bind(this))},_replaceBoxIsHidden:function(){return this._replaceWrapper.classList.contains("replaceWrapperHidden")},searchOptionsVisible:function(){return!this._searchWrapper.classList.contains("searchOptionsHidden")},_toggleReplaceFieldVisibility:function(){this._replaceBoxIsHidden()?this._showReplaceField():this._hideReplaceField(),this._searchTextInputBox.focus()},showSearchOptions:function(){this._searchWrapper.classList.remove("searchOptionsHidden"),this._toggleSearchOptionsLink.classList.add("linkHidden")},_hideSearchOptions:function(){this._searchWrapper.classList.add("searchOptionsHidden"),this._toggleSearchOptionsLink.classList.remove("linkHidden")},_showSearchOptBLocks:function(){this._searchWrapper.classList.remove("searchOptParamBlockHidden")},_hideSearchOptBLocks:function(){this._searchWrapper.classList.add("searchOptParamBlockHidden"),this._replaceTextInputBox.focus(),this._searchBox.enable(!1)},_showReplaceField:function(){this._searchBox.hideButton(),this._replaceWrapper.classList.remove("replaceWrapperHidden"),this._searchWrapper.classList.add("replaceModeActive"),this._toggleReplaceLink.textContent=c["Hide Replace"]},_hideReplaceField:function(){this._searchBox.showButton(),this._replaceWrapper.classList.add("replaceWrapperHidden"),this._searchWrapper.classList.remove("replaceModeActive"),this._toggleReplaceLink.textContent=c["Show Replace"],this.hideReplacePreview()},showReplacePreview:function(){this._replaceCompareTitleDiv.classList.add("replaceCompareTitleDivVisible"),this._replaceCompareDiv.classList.add("replaceCompareDivVisible")},hideReplacePreview:function(){this._replaceCompareTitleDiv.classList.remove("replaceCompareTitleDivVisible"),this._replaceCompareDiv.classList.remove("replaceCompareDivVisible")},_displaySelectedSearchScope:function(){var e=this._searchScopeElementWrapper;t.empty(e),this._searchLocations.forEach(function(t){var i=decodeURI(t),n=i,o=this._fileClient.fileServiceRootURL(n);if(o===t)n=this._fileClient.fileServiceName(n);else{var r=n.split("/");r&&(n=r.pop(),n||(n=r.pop()))}var s=document.createElement("span");s.classList.add("searchScopeElement"),s.title=i,e.title=i,s.appendChild(document.createTextNode(n)),e.appendChild(s)},this)},_correctFileNamePatternsInputValue:function(){var e=this._fileNamePatternsBox.getTextInputValue();if(e){var t=r.getFileNamePatternsArray(e);this._fileNamePatternsBox.setTextInputValue(t.join(", "))}},getSearchResultsTitleDiv:function(){return this._searchResultsTitle},getReplaceCompareTitleDiv:function(){return this._replaceCompareTitleDiv},getReplaceCompareDiv:function(){return this._replaceCompareDiv}}),h}),define("orion/problems/nls/messages",{root:!0,de:!0,es:!0,fr:!0,it:!0,ja:!0,ko:!0,"pt-br":!0,zh:!0,"zh-hk":!0,"zh-tw":!0}),define("orion/problems/nls/root/messages",{ProblemsFilter:"Filter on descriptions, file names and folders(* = any string, ? = any character)",computeCancelled:"Problems computation cancelled by user",computingProblems:"Computing problems...",Errors:"Errors",Warnings:"Warnings",items:" (${0} items)",viewByTypes:"By types",viewByFiles:"By files",viewByTypesTooltip:"View problems grouped by errors and warnings",viewByFilesTooltip:"View problems grouped by files"}),define("orion/edit/editorContext",[],function(){function e(e,t){var n=Object.create(null);return i(e,t).forEach(function(t){var i=e.getService(t);Object.keys(i).forEach(function(e){"function"==typeof i[e]&&(n[e]=i[e].bind(i))})}),n}function t(e,t){var n=Object.create(null);return i(e,t).forEach(function(e){e.getPropertyKeys().forEach(function(t){"service.id"!==t&&"service.names"!==t&&"objectClass"!==t&&(n[t]=e.getProperty(t))})}),n}function i(e,t){return e.getServiceReferences(t||"orion.edit.context")}return{getEditorContext:e,getOptions:t}}),define("orion/syntaxchecker",["orion/Deferred","orion/edit/editorContext","orion/i18nUtil"],function(e,t){function i(t,i,n){function o(e,t){var i=e.getProperty("contentType");return r.isSomeExtensionOf(t,i).then(function(t){return t?e:null})}for(var r=t.getService("orion.core.contentTypeRegistry"),s=t.getServiceReferences("orion.edit.validator"),a=[],l=0;l<s.length;l++){var c=s[l],d=c.getProperty("pattern");if(c.getProperty("contentType"))a.push(o(c,i));else if(d&&new RegExp(d).test(n)){var h=new e;h.resolve(c),a.push(h)}}return e.all(a,function(e){return{_error:e}}).then(function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i];n&&!n._error&&t.push(n)}return t})}var n=function(){function n(e,t){this.registry=e,this.textModel=t}function o(e,t,i){return e=Math.max(e,t),e=Math.min(e,i)}function r(e){e=e||{};var t=e.problems||e.errors||e;return Array.isArray(t)?t:[]}return n.prototype={checkSyntax:function(n,o,s,a,l){if(!n||s)return(new e).resolve([]);if(!s){var c=this.registry,d=this;return i(c,n,o).then(function(i){if(0===i.length)return(new e).resolve();var s=c.getService("orion.page.progress"),h=i.map(function(e){var i,d=c.getService(e);if(d.computeProblems){var h={contentType:n.id,title:o};i=d.computeProblems(l?l:t.getEditorContext(c),h)}else d.checkSyntax&&(i=d.checkSyntax(o,a));return s.progress(i,"Validating "+o).then(r)});return e.all(h,function(e){return{_error:e}}).then(function(t){for(var i=[],n=0;n<t.length;n++){var o=t[n];o._error||(d._fixup(o),i=i.concat(o))}return(new e).resolve(i)})})}},setTextModel:function(e){this.textModel=e},_fixup:function(e){for(var t=this.textModel,i=0;i<e.length;i++){var n=e[i];if(n.description=n.description||n.reason,n.severity=n.severity||"error",n.start="number"==typeof n.start?n.start:n.character,"number"==typeof n.line){var r=t.getLine(n.line-1,!1).length;n.start=o(n.start,1,r),n.end="number"==typeof n.end?n.end:-1,n.end=o(n.end,n.start+1,r+1)}else{var s=t.getCharCount();if(n.start=o(n.start,0,s),n.end="number"==typeof n.end?n.end:-1,n.end=o(n.end,n.start,s),n.end===s&&t.getLineCount()>1&&s===t.getLineStart(t.getLineCount()-1)){var a=t.getLineCount()-2,l=t.getLineStart(a),c=t.getLineEnd(a);l===c?n.start=n.end=c:(n.start=c-1,n.end=c)}}}}},n}();return{SyntaxChecker:n,getValidators:i}}),define("orion/problems/problemsExplorer",["i18n!orion/problems/nls/messages","i18n!orion/search/nls/messages","orion/Deferred","orion/explorers/explorer","orion/webui/littlelib","orion/crawler/searchCrawler","orion/extensionCommands","orion/commands","orion/explorers/navigatorRenderer","orion/objects","orion/syntaxchecker","orion/editor/textModel","orion/explorers/navigationUtils","orion/explorers/fileDetailRenderer","orion/uiUtils","orion/i18nUtil","orion/URL-shim"],function(e,t,i,n,o,r,s,a,l,c,d,h,u,p,f,g){function m(e,t,i){var n=o.node(t);n&&("only"===i&&o.empty(n),n.appendChild(e))}function v(e,t,i){var n=document.createElement("div");n.classList.add("problemsDecorator"),i&&n.classList.add(i),n.classList.add(t?"problemsError":"problemsWarning"),e.appendChild(n)}function _(e,t,i){var n={start:t.start,end:t.end},o=t.description,r=t.fileLocation,s=l.createLink(null,{Location:r,Name:i?o:null},e.commandService,e.contentTypeRegistry,e._openWithCommands,{id:t.location+"_linkId"},n,{});return s}function y(e,t,i){t.forEach(function(t){t.type="problem",t.fileName=e.name,t.filePath=e.path,t.fileLocation=e.location,t.location=e.location+t.description+t.start+t.end,i.push(t)})}function C(t){var i={children:[],type:"category",location:"category_errors_id",name:e.Errors},n={children:[],type:"category",location:"category_warnings_id",name:e.Warnings};return t.forEach(function(e){"warning"===e.severity?(e.parent=n,n.children.push(e)):(e.parent=i,i.children.push(e))}),[i,n]}function w(e,t){var i=[];return e.forEach(function(e){var n=t.filter(function(t){return t.fileLocation===e.location});n&&n.length>0&&(i.push(e),e.children=n,n.forEach(function(t){t.parent=e}))}),i}function b(e,t){var i=null;t.forEach(function(t){if(i||(i=new h.TextModel(e)),"number"==typeof t.line){var n=t.line-1,o=i.getLineStart(n);t.start=o+t.start-1,t.end=o+t.end-1}else t.line=i.getLineAtOffset(t.start)+1})}function S(e){this.problems=e.problems,this.registry=e.registry,this.progressService=e.progressService}function x(e){S.call(this,e)}function L(e){this.totalProblems=[],this.totalFiles=[],this._ProblemsRendererByType=new T({registry:e.serviceRegistry,commandService:e.commandRegistry,actionScopeId:e.actionScopeId,checkbox:!1},this),this._ProblemsRendererByFile=new E({registry:e.serviceRegistry,commandService:e.commandRegistry,actionScopeId:e.actionScopeId,checkbox:!1},this),n.Explorer.call(this,e.serviceRegistry,e.selection,this._ProblemsRendererByType,e.commandRegistry),this.fileClient=e.fileClient,this.contentTypeRegistry=e.contentTypeRegistry,this.preferences=e.preferences,this.parentId=e.parentId,this.actionScopeId=e.actionScopeId,this.location=e.location,this.progressService=e.progressService,p.getPrefs(this.preferences,"/problemsView",["showFullPath","viewByFile"]).then(function(e){this._shouldShowFullPath=e?e[0]:!1,this._viewByFile=e?e[1]:!1,this.declareCommands()}.bind(this))}function T(e,t){n.SelectionRenderer.call(this,e,t)}function E(e,t){p.FileDetailRenderer.call(this,e,t)}var k=!1;return S.prototype=Object.create(n.ExplorerModel.prototype),c.mixin(S.prototype,{destroy:function(){},getListRoot:function(){return!1},getRoot:function(e){e(this.problems||this.root||(this.root={Type:"Root"}))},getChildren:function(e,t){t(e.children?e.children:e)},getId:function(e){var t;return e===this.getListRoot()?t=this.rootId:(t=e.location,t=t.replace(/[^\.\:\-\_0-9A-Za-z]/g,"")),t}}),x.prototype=Object.create(S.prototype),c.mixin(x.prototype,{getFileName:function(e){return e.name},getScopingParams:function(e){return{name:f.path2FolderName(e.path,e.name)}},getDetailInfo:function(e){return{lineString:e.description,lineNumber:e.line-1,matches:[],matchNumber:0}}}),L.prototype=Object.create(n.Explorer.prototype),c.mixin(L.prototype,{declareCommands:function(){var i=new a.Command({tooltip:e.viewByTypesTooltip,name:e.viewByTypes,imageClass:"problems-sprite-view-mode",id:"orion.problemsView.switchView",groupId:"orion.problemsViewGroup",type:"switch",checked:this._viewByFile,visibleWhen:function(){return i.checked=this._viewByFile,i.name=this._viewByFile?e.viewByTypes:e.viewByFiles,i.tooltip=this._viewByFile?e.viewByTypesTooltip:e.viewByFilesTooltip,this.getItemCount()>0}.bind(this),callback:function(){this.switchViewMode()}.bind(this)}),o=new a.Command({tooltip:t["Next result"],imageClass:"core-sprite-move-down",id:"orion.problemsView.nextResult",groupId:"orion.problemsViewGroup",visibleWhen:function(){return this.getItemCount()>0}.bind(this),callback:function(){this.gotoNext(!0,!0)}.bind(this)}),r=new a.Command({tooltip:t["Previous result"],imageClass:"core-sprite-move-up",id:"orion.problemsView.prevResult",groupId:"orion.problemsViewGroup",visibleWhen:function(){return this.getItemCount()>0}.bind(this),callback:function(){this.gotoNext(!1,!0)}.bind(this)}),s=new a.Command({name:t.fullPath,tooltip:t.switchFullPath,imageClass:"sprite-switch-full-path",id:"orion.problemsView.switchFullPath",groupId:"orion.problemsViewGroup",type:"switch",checked:this._shouldShowFullPath,visibleWhen:function(){return this._viewByFile&&this.getItemCount()>0}.bind(this),callback:function(){this.switchFullPath()}.bind(this)});this.commandService.addCommand(i),this.commandService.addCommand(o),this.commandService.addCommand(r),this.commandService.addCommand(s),this.commandService.addCommandGroup("problemsViewActions","orion.problemsViewActions.unlabeled",200),n.createExplorerCommands(this.commandService,function(){return this.getItemCount()>0}.bind(this),"orion.explorer.problems.expandAll","orion.explorer.problems.collapseAll"),this.commandService.registerCommandContribution("problemsViewActions","orion.problemsView.switchView",1),this.commandService.registerCommandContribution("problemsViewActions","orion.explorer.problems.expandAll",2),this.commandService.registerCommandContribution("problemsViewActions","orion.explorer.problems.collapseAll",3),this.commandService.registerCommandContribution("problemsViewActions","orion.problemsView.nextResult",4),this.commandService.registerCommandContribution("problemsViewActions","orion.problemsView.prevResult",5),this.commandService.registerCommandContribution("problemsViewActions","orion.problemsView.switchFullPath",6)},refreshCommands:function(){this.commandService.destroy("problemsViewActionsContainer"),this.commandService.renderCommands("problemsViewActions","problemsViewActionsContainer",this,this,"button")},getItemCount:function(){return this.totalProblems.length},gotoNext:function(e,t){this.getNavHandler().iterate(e,t,!0)},switchViewMode:function(){p.togglePrefs(this.preferences,"/problemsView",["viewByFile"]).then(function(e){this._viewByFile=e?e[0]:!1,this._generateProblemsModel(this.currentFlatProblems),this.incrementalRender(!0)}.bind(this))},switchFullPath:function(){p.togglePrefs(this.preferences,"/problemsView",["showFullPath"]).then(function(e){this._shouldShowFullPath=e?e[0]:!1,p.showFullPath(o.node(this.parentId),this._shouldShowFullPath)}.bind(this))},validate:function(t,i){this._postValidate=i,this._initSpinner();var n=new r.SearchCrawler(this.registry,this.fileClient,null,{location:t,cancelMessage:e.computeCancelled,visitSingleFile:this._visitFile.bind(this)});n.search(function(e,t){this._renderProblems(e,t)}.bind(this))},_generateProblemsModel:function(e){this.currentFlatProblems=e,this.filteredProblems=this._viewByFile?w(this.totalFiles,e):C(e)},_initSpinner:function(){var t=o.node(this.parentId);o.empty(t);var i=document.createElement("span");i.classList.add("modelDecorationSprite"),i.classList.add("core-sprite-progress"),t.appendChild(i);var n=document.createElement("span");n.appendChild(document.createTextNode(e.computingProblems)),n.classList.add("problemsProgressSpan"),t.appendChild(n)},filterProblems:function(e){var t=null;if(e){var i="i";t=e.replace(/([.+^=!:${}()|\[\]\/\\])/g,"\\$1"),t=t.replace(/([*?])/g,".$1"),/[A-Z]/.test(t)&&(i=""),t=new RegExp(t,i),this._filterOn(t)}else this._generateProblemsModel(this.totalProblems);this.incrementalRender(!0)},_filterSingle:function(e,t){return-1!==e.description.search(t)||-1!==e.fileName.search(t)||this._viewByFile&&this._shouldShowFullPath&&-1!==e.filePath.search(t)},_filterOn:function(e){var t=this.totalProblems.filter(function(t){return this._filterSingle(t,e)}.bind(this));this._generateProblemsModel(t)},_visitFile:function(e,t,i){e.addTotalCounter();var n=this;if(!e.isCancelled())return d.getValidators(this.registry,i,t.Location).then(function(o){return o&&o.length>0?(n.progressService?n.progressService.progress(n.fileClient.read(t.Location),"Reading file "+t.Location):n.fileClient.read(t.Location)).then(function(o){return n._findProblems(o,t,i).then(function(i){i&&0!==i.length&&(t.problems=i,b(o,i),k&&(console.log("File that has problems: "+t.Name),console.log(i)),e.incrementalReport(t))})},function(e){e&&e.message&&"cancel"!==e.message.toLowerCase()&&console.error("Error loading file content: "+e.message)}):void(k&&console.log("File that are not read at all: "+t.Name))})},_findProblems:function(e,t,i){var n=new d.SyntaxChecker(this.registry,new h.TextModel(e)),o={getFileMetadata:function(){return{contentType:i,location:t.Location}},getText:function(){return e}};return n.checkSyntax(i,t.Location,null,e,o)},_renderProblems:function(e,t){if(!t){var i=[];o.empty(o.node(this.parentId)),this.totalProblems=[],this.totalFiles=[],e.response.numFound>0&&e.response.docs.forEach(function(e){if(!e.Directory){var n=e.Location,o=e.Path;if(!o){var r=this.fileClient.fileServiceRootURL(n);o=n.substring(r.length)}var s={location:n,path:o,type:"file",name:e.Name,lastModified:e.LastModified};t?i.push(s):(this.totalFiles.push(s),y(s,e.problems,this.totalProblems))}}.bind(this)),p.showFullPath(o.node(this.parentId),this._shouldShowFullPath),t?this.filteredProblems=i:this._generateProblemsModel(this.totalProblems),t?this.incrementalRender():(this.incrementalRender(!0),this.registry.getService("orion.page.message").setProgressMessage(""),"function"==typeof this._postValidate&&this._postValidate())}},getParent:function(){return o.node(this.parentId)},destroy:function(){this._selectionListener&&(this.selection.removeEventListener("selectionChanged",this._selectionListener),this._selectionListener=null),n.Explorer.prototype.destroy.call(this)},_incrementalRender:function(e){this.refreshCommands();var t;this._viewByFile?(t=new x({registry:this.registry,problems:this.filteredProblems,progressService:this.progressService}),this.setRenderer(this._ProblemsRendererByFile)):(t=new S({registry:this.registry,problems:this.filteredProblems,progressService:this.progressService}),this.setRenderer(this._ProblemsRendererByType)),this.createTree(this.parentId,t,{selectionPolicy:"singleSelection",indent:18,setFocus:!1}),e&&this.expandAll(),this.filteredProblems.length>0&&this.getNavHandler().cursorOn(this.filteredProblems[0],!0,null,!0)},incrementalRender:function(e){if(this._openWithCommands)this._incrementalRender(e);else{var t=s.createOpenWithCommands(this.registry,this.contentTypeRegistry,this.commandService);i.when(t,function(t){this._openWithCommands=t,this._incrementalRender(e)}.bind(this))}},isRowSelectable:function(){return!0}}),T.prototype=Object.create(n.SelectionRenderer.prototype),c.mixin(T.prototype,{renderProblemsElement:function(e,t){var i=_(this.explorer,e,!0);u.addNavGrid(this.explorer.getNavDict(),e,i),t.appendChild(i)},renderDetailLineNumber:function(e,t){m(document.createTextNode(e.line+":"),t,"last")},getCellElement:function(t,i,n){var o,r,s;switch(t){case 0:return r=document.createElement("td"),o=document.createElement("div"),r.appendChild(o),"category"===i.type?(r.classList.add("problemsDecoratorTDTitle"),this.getExpandImage(n,o),v(o,"category_errors_id"===i.location)):"problem"===i.type&&(r.classList.add("problemsDecoratorTD"),v(o,"error"===i.severity)),r;case 1:return r=document.createElement("td"),"category"===i.type?(o=document.createElement("div"),r.appendChild(o),s=document.createElement("span"),s.textContent=i.name+g.formatMessage(e.items,i.children.length),s.id=i.name+"CategoryItemId",o.appendChild(s)):"file"===i.type?(o=document.createElement("div"),r.appendChild(o),s=document.createElement("span"),s.textContent=i.name,s.id=i.location+"FileItemId",o.appendChild(s)):"problem"===i.type&&this.renderProblemsElement(i,r),r;case 2:return r=document.createElement("td"),"problem"===i.type&&(o=document.createElement("div"),r.appendChild(o),s=document.createElement("span"),s.textContent=i.fileName,o.appendChild(s)),r}}}),E.prototype=Object.create(p.FileDetailRenderer.prototype),c.mixin(E.prototype,{generateFileLink:function(e,t){var i=l.createLink(null,{Location:t.location},this.explorer.commandService,this.explorer.contentTypeRegistry,this.explorer._openWithCommands,{id:t.location+"_linkId"},null,{holderDom:this._lastFileIconDom});return i},generateDetailLink:function(e){return _(this.explorer,e)},generateDetailDecorator:function(e,t){v(t,"error"===e.severity,"problemsDecoratorLessMargin")}}),{ProblemsExplorer:L}}),define("orion/problems/problemsView",["i18n!orion/problems/nls/messages","orion/objects","orion/webui/littlelib","orion/problems/problemsExplorer","orion/webui/Slideout"],function(e,t,i,n,o){function r(e,t){t&&s.call(this,t);var n=e.parentId?e.parentId:"orion.PropertyPanel.container";this._parent=i.node(n),this.serviceRegistry=e.serviceRegistry,this.commandRegistry=e.commandRegistry,this.preferences=e.preferences,this.fileClient=e.fileClient,this.contentTypeRegistry=e.contentTypeRegistry,this._init(t)}var s=o.SlideoutViewMode;return r.prototype=Object.create(s.prototype),r.prototype.constructor=r,t.mixin(r.prototype,{_init:function(e){this._inner_node||(this._inner_node=document.createElement("div"),this._inner_node.classList.add("problems_inner_container")),e?this._slideout.getContentNode().appendChild(this._inner_node):(i.empty(this._parent),this._parent.appendChild(this._inner_node)),this._createFilterInput(),this._createCommandsContainer();var t=document.createElement("div");t.id="problemsExplorerParent_id",t.classList.add("problemsExplorerNodeWrapper"),this._inner_node.appendChild(t),this._problemsExplorer=new n.ProblemsExplorer({parentId:t.id,serviceRegistry:this.serviceRegistry,commandRegistry:this.commandRegistry,preferences:this.preferences,contentTypeRegistry:this.contentTypeRegistry,fileClient:this.fileClient})},_createCommandsContainer:function(){var e=document.createElement("div");e.id="problemsViewActionsContainer",e.classList.add("problemsCommandsContainer"),this._inner_node.appendChild(e)},_createFilterInput:function(){var t=document.createElement("input");t.classList.add("problemsFilter"),t.placeholder=e.ProblemsFilter,t.type="text",t.addEventListener("input",function(){this._filterInputTimeout&&window.clearTimeout(this._filterInputTimeout);var e=this;this._filterInputTimeout=window.setTimeout(function(){e._problemsExplorer&&e._problemsExplorer.filterProblems(t.value),e._filterInputTimeout=null},400)}.bind(this)),t.addEventListener("keydown",function(e){var n=null,o=null;e.keyCode===i.KEY.DOWN?(t.blur(),n=this._problemsExplorer.getNavHandler(),n.focus(),n.getTopLevelNodes()&&(o=n.getTopLevelNodes()[0],n.cursorOn(o,!1,!0),o.isNotSelectable&&n.iterate(!0,!1,!1,!0)),e.preventDefault&&e.preventDefault()):e.keyCode===i.KEY.ESCAPE&&this._slideout.getPreviousActiveElement()&&(this._slideout.getPreviousActiveElement()===t?t.blur():this._slideout.getPreviousActiveElement().focus(),this.hide())}.bind(this),!1),this._inner_node.appendChild(t),this._filterInput=t},getWrapperNode:function(){return this._inner_node},validate:function(e){this._filterInput.value="",this._filterInput.style.display="none",this._problemsExplorer.validate(e,function(){this._filterInput.style.display="",this._filterInput.select()}.bind(this))}}),{ProblemsView:r}}),define("orion/sidebar",["orion/objects","orion/commands","orion/outliner","orion/webui/littlelib","orion/widgets/nav/mini-nav","orion/widgets/nav/project-nav","orion/globalCommands","i18n!orion/edit/nls/messages","orion/search/InlineSearchPane","orion/keyBinding","orion/problems/problemsView","orion/webui/Slideout"],function(e,t,i,n,o,r,s,a,l,c,d,h){function u(e){this.params=e,this.preferences=e.preferences,this.commandRegistry=e.commandRegistry,this.contentTypeRegistry=e.contentTypeRegistry,this.fileClient=e.fileClient,this.editorInputManager=e.editorInputManager,this.outlineService=e.outlineService,this.parentNode=n.node(e.parent),this.toolbarNode=n.node(e.toolbar),this.serviceRegistry=e.serviceRegistry,this.sidebarNavInputManager=e.sidebarNavInputManager,this.menuBar=e.menuBar,this.viewModes={},this.activeViewMode=null,this.switcherScope=e.switcherScope,this.editScope=e.editScope,this.switcherNode=null,this.progressService=e.progressService}return e.mixin(u.prototype,{create:function(){this.created||(this.created=!0,this._createViewModeMenu(),this._createNavigationViewMode(),this._createProjectViewMode(),this._createSlideout(),this._createOutliner(),this._createInlineSearchPane(),this._createProblemsPane())},showToolbar:function(){this.toolbarNode.style.display="block",this.parentNode.classList.remove("toolbarTarget-toolbarHidden")},hideToolbar:function(){this.toolbarNode.style.display="none",this.parentNode.classList.add("toolbarTarget-toolbarHidden")},viewModeMenuCallback:function(){var e=this,t=this.getActiveViewModeId();return Object.keys(this.viewModes).map(function(i){var n=e.getViewMode(i);return{checked:i===t,name:n.label||i,callback:e.setViewMode.bind(e,i)}})},getActiveViewModeId:function(){return this.activeViewModeId},getDefaultViewModeId:function(){var e=localStorage.sidebarActiveViewModeId;return e&&this.getViewMode(e)?e:this.getNavigationViewMode().id},addViewMode:function(e,t){if(!e)throw new Error("Invalid id: "+e);if(!t||"object"!=typeof t)throw new Error("Invalid mode: "+t);Object.prototype.hasOwnProperty.call(this.viewModes,e)||(this.viewModes[e]=t)},removeViewMode:function(e){var t=this.getViewMode(e);t&&"function"==typeof t.destroy&&t.destroy(),delete this.viewModes[e],this.getActiveViewModeId()===e&&(this.activeViewModeId=null,delete localStorage.sidebarActiveViewModeId)},getViewMode:function(e){return Object.prototype.hasOwnProperty.call(this.viewModes,e)?this.viewModes[e]:null},setViewMode:function(e){var t=this.activeViewMode;t&&"function"==typeof t.destroy&&t.destroy(),this.toolbarNode&&this.commandRegistry.destroy(this.toolbarNode),n.empty(this.parentNode),t=this.activeViewMode=this.getViewMode(e),this.activeViewModeId=t?e:null,this.activeViewModeId?localStorage.sidebarActiveViewModeId=this.activeViewModeId:delete localStorage.sidebarActiveViewModeId,t&&"function"==typeof t.create&&t.create()},renderViewModeMenu:function(){var e=this.switcherNode;this.commandRegistry.destroy(e),this.commandRegistry.renderCommands(e.id,e,null,this,"button")},getInlineSearchPane:function(){return this._inlineSearchPane},getNavigationViewMode:function(){return this._navigationViewMode},getProjectViewMode:function(){return this.projectViewMode},getOutliner:function(){return this.outliner},_createViewModeMenu:function(){this.switcherNode=n.node(this.switcherScope);var e=new t.Command({name:a.SidePanel,imageClass:"core-sprite-outline",selectionClass:"dropdownSelection",tooltip:a.SidePanelTooltip,id:"orion.sidebar.viewmode",visibleWhen:function(){var e=s.getMainSplitter();return e?!e.splitter.isClosed():!0},choiceCallback:this.viewModeMenuCallback.bind(this)});this.commandRegistry.addCommand(e),this.commandRegistry.registerCommandContribution(this.switcherNode.id,"orion.sidebar.viewmode",2,"orion.menuBarViewGroup")},_createNavigationViewMode:function(){this._navigationViewMode=new o({commandRegistry:this.commandRegistry,contentTypeRegistry:this.contentTypeRegistry,preferences:this.preferences,fileClient:this.fileClient,editorInputManager:this.editorInputManager,parentNode:this.parentNode,sidebarNavInputManager:this.sidebarNavInputManager,serviceRegistry:this.serviceRegistry,toolbarNode:this.toolbarNode,sidebar:this,progressService:this.progressService})},_createProjectViewMode:function(){this.projectViewMode=new r({commandRegistry:this.commandRegistry,contentTypeRegistry:this.contentTypeRegistry,preferences:this.preferences,fileClient:this.fileClient,editorInputManager:this.editorInputManager,parentNode:this.parentNode,sidebarNavInputManager:this.sidebarNavInputManager,serviceRegistry:this.serviceRegistry,toolbarNode:this.toolbarNode,sidebar:this,progressService:this.progressService})},_createOutliner:function(){this.outliner=new i.Outliner(this._slideout,{toolbar:this.toolbarNode,serviceRegistry:this.serviceRegistry,contentTypeRegistry:this.contentTypeRegistry,preferences:this.preferences,outlineService:this.outlineService,commandService:this.commandRegistry,inputManager:this.editorInputManager,progressService:this.progressService,sidebar:this,switcherNode:this.switcherNode})},_createSlideout:function(){this._slideout=new h.Slideout(this.toolbarNode.parentNode),this.commandRegistry.addCommandGroup(this.switcherNode.id,"orion.slideoutMenuGroup",3,a.Slideout,"orion.menuBarViewGroup",null,null,null,"dropdownSelection")
},_createProblemsPane:function(){this._problemsPane=new d.ProblemsView({serviceRegistry:this.serviceRegistry,commandRegistry:this.commandRegistry,contentTypeRegistry:this.contentTypeRegistry,preferences:this.preferences,fileClient:this.fileClient},this._slideout);var e=new t.Command({name:a.showProblems,id:"orion.problemsInFolder",visibleWhen:function(e){return Array.isArray(e)&&1===e.length&&e[0].Directory?!0:!1},callback:function(e){var t=e.items[0];this._problemsPane.show(),this._problemsPane.validate(t.Location)}.bind(this)});this.commandRegistry.addCommand(e),this.commandRegistry.registerCommandContribution(this.editScope,"orion.problemsInFolder",101,"orion.menuBarEditGroup/orion.findGroup")},fillSearchPane:function(e,t,i){var n=s.getMainSplitter();n.splitter.isClosed()&&n.splitter.toggleSidePanel(),this._inlineSearchPane.setSearchText(e),this._inlineSearchPane.setSearchScope(t),this._inlineSearchPane.show(),this._inlineSearchPane.showSearchOptions(),i?this._inlineSearchPane.fillSearchResult(i):this._inlineSearchPane.search()},_createInlineSearchPane:function(){this._inlineSearchPane=new l(this._slideout,{serviceRegistry:this.serviceRegistry,commandRegistry:this.commandRegistry,fileClient:this.fileClient,preferences:this.preferences}),this._lastSearchRoot=null,this.sidebarNavInputManager.addEventListener("rootChanged",function(e){this._lastSearchRoot=e.root}.bind(this)),this.toolbarNode.parentNode.addEventListener("scroll",function(){this._inlineSearchPane.isVisible()&&(this.toolbarNode.parentNode.scrollTop=0)}.bind(this));var e=function(){var e=this.editorInputManager.getEditor();return e&&e.getSelectionText?e.getSelectionText(""):""}.bind(this),i=new t.Command({name:a.searchInFolder,id:"orion.searchInFolder",visibleWhen:function(e){return Array.isArray(e)&&1===e.length&&e[0].Directory?!0:!1},callback:function(t){var i=t.items[0];this._inlineSearchPane.setSearchText(e()),this._inlineSearchPane.setSearchScope(i),this._inlineSearchPane.show(),this._inlineSearchPane.showSearchOptions()}.bind(this)}),n=new t.Command({name:a["Global Search"],id:"orion.openSearch",visibleWhen:function(){return!0},callback:function(){if(this._inlineSearchPane.isVisible())this._inlineSearchPane.hide();else{var t=s.getMainSplitter();t.splitter.isClosed()&&t.splitter.toggleSidePanel(),this._inlineSearchPane.setSearchText(e()),this._inlineSearchPane.setSearchScope(this._lastSearchRoot),this._inlineSearchPane.show(),this._inlineSearchPane.showSearchOptions()}}.bind(this)}),o=new t.Command({name:a.searchFilesCommand,tooltip:a.searchFilesCommand,id:"orion.quickSearch",visibleWhen:function(){return!0},callback:function(){this.fillSearchPane(e(),this._lastSearchRoot)}.bind(this)});this.commandRegistry.addCommand(i),this.commandRegistry.addCommand(n),this.commandRegistry.addCommand(o),this.commandRegistry.registerCommandContribution(this.editScope,"orion.searchInFolder",99,"orion.menuBarEditGroup/orion.findGroup"),this.commandRegistry.registerCommandContribution(this.editScope,"orion.quickSearch",100,"orion.menuBarEditGroup/orion.findGroup",!1,new c.KeyBinding("h",!0)),this.commandRegistry.registerCommandContribution(this.editScope,"orion.openSearch",101,"orion.menuBarEditGroup/orion.findGroup",!1,new c.KeyBinding("h",!0,!0))}}),u}),define("orion/inputManager",["i18n!orion/edit/nls/messages","orion/explorers/navigatorRenderer","orion/i18nUtil","orion/Deferred","orion/EventTarget","orion/objects","orion/PageUtil","orion/metrics"],function(e,t,i,n,o,r,s,a){function l(e){this._document=e.document||document,this._timeout=e.timeout;for(var t=["mousedown","keypress","keydown","keyup"],i=function(){this._resetTimer()}.bind(this),n=0;n<t.length;n++){var r=t[n];this._document.addEventListener(r,i,!0)}o.attach(this)}function c(t){var i={Severity:"Error",Message:e.noResponse};if("Cancel"===t.name)return{Severity:"Warning",Message:t.name,Cancel:!0};if(0===t.status)return i.Cancel=!0,i;if(t.responseText){var n=t.responseText;try{var o=JSON.parse(n);i.Severity=o.Severity||i.Severity,i.Message=o.Message||i.Message}catch(r){i.Message=n}}else try{i.Message=JSON.stringify(t)}catch(r){}return i}function d(e,t){return e?(t.Severity||(t=c(t)),e.setProgressResult(t),t):void window.console.log(t)}function h(e,t,i,n){if(window.TextDecoder)i(new TextDecoder(t).decode(e));else{var o="text/plain; charset="+t,r=new Blob([e],{type:o}),s=new FileReader;s.onload=function(){i(s.result)}.bind(this),s.onerror=n,s.readAsText(r,t)}}function u(e){return!e||e===f}function p(e){o.attach(this),this.serviceRegistry=e.serviceRegistry,this.statusService=e.statusService,this.fileClient=e.fileClient,this.progressService=e.progressService,this.contentTypeRegistry=e.contentTypeRegistry,this.selection=e.selection,this._input=this._title=""}l.prototype={_resetTimer:function(){var e=this._document.defaultView||this._document.parentWindow;this._timer&&(e.clearTimeout(this._timer),this._timer=null),-1!==this._timeout&&(this._timer=e.setTimeout(function(){this.onIdle({type:"Idle"}),this._timer=null,this._resetTimer()}.bind(this),this._timeout))},onIdle:function(e){return this.dispatchEvent(e)},setTimeout:function(e){this._timeout=e,this._resetTimer()}};var f="UTF-8";return r.mixin(p.prototype,{_maybeLoadWorkspace:function(e){var t=this.fileClient,i=e;return i.indexOf("?")&&(i=i.split("?")[0]),i===t.fileServiceRootURL(i)?t.loadWorkspace(i).then(function(e){return e.Location}):(new n).resolve(e)},_read:function(e){var i=this.cachedMetadata||t.getClickedItem();if(i&&i.Location===e&&i.Parents&&i.Attributes&&i.ETag)return(new n).resolve(i);var o=this.fileClient,r=Array.prototype.slice.call(arguments,1);return this._maybeLoadWorkspace(e).then(function(e){return o.read.apply(o,[e].concat(r))})},_isSameParent:function(e){if(this._lastMetadata&&this._lastMetadata.Parents&&this._lastMetadata.Parents.length>0){var t=e.substring(0,e.lastIndexOf("/",e.length-("/"===e[e.length-1]?2:1))+1);return this._lastMetadata.Parents[0].Location===t}return!1},load:function(t){var o=this.getInput();if(o){var s=this.fileClient,a=this._parsedLocation.resource,l=this.progressService,c=function(e,t,n){return l?l.progress(e,i.formatMessage(t,n)):e},p=this.getEditor();if(this._fileMetadata)this._fileMetadata._saving||this._fileMetadata.Directory||this.getReadOnly()||c(s.read(a,!0),e.ReadingMetadata,o).then(function(t){this._fileMetadata&&!this._fileMetadata._saving&&this._fileMetadata.Location===t.Location&&this._fileMetadata.ETag!==t.ETag&&(this._fileMetadata=r.mixin(this._fileMetadata,t),(!p.isDirty()||window.confirm(e.loadOutOfSync))&&c(s.read(a),e.Reading,o).then(function(e){p.setInput(o,null,e),this._clearUnsavedChanges()}.bind(this)))}.bind(this));else{var f=window.setTimeout(function(){f=null,this.reportStatus(i.formatMessage(e.Fetching,o))}.bind(this),800),g=function(){this.reportStatus(""),f&&window.clearTimeout(f)}.bind(this),m=function(e){g();var t=null;this.serviceRegistry?t=this.serviceRegistry.getService("orion.page.message"):this.statusService&&(t=this.statusService),d(t,e),this._setNoInput()}.bind(this);this._acceptPatch=null;var v=a;if(!this._isSameParent(v)){var _=new URL(v);_.query.set("tree",localStorage.useCompressedTree?"compressed":"decorated"),v=_.href}c(this._read(v,!0),e.ReadingMetadata,a).then(function(r){if(r)if(r.Directory)n.when(r.Children||c(s.fetchChildren(r.ChildrenLocation),e.Reading,o),function(e){g(),r.Children=e,this._setInputContents(this._parsedLocation,o,e,r)}.bind(this),m);else{t=t||this._charset;var l=this._isText(r);u(t)&&l?c(s.read(a,!1,!0),e.Reading,o).then(function(e){g(),"string"!=typeof e&&(this._acceptPatch=e.acceptPatch,e=e.result),this._setInputContents(this._parsedLocation,o,e,r)}.bind(this),m):c(s._getService(a).readBlob(a),e.Reading,o).then(function(e){return g(),l?void h(e,t,function(e){this._setInputContents(this._parsedLocation,o,e,r)}.bind(this),m):void this._setInputContents(this._parsedLocation,o,e,r)}.bind(this),m)}else m({responseText:i.formatMessage(e.ReadingMetadataError,a)})}.bind(this),m)}}},processParameters:function(e){var t=this.getEditor();return t&&t.processParameters?t.processParameters(e):!1},getAutoLoadEnabled:function(){return this._autoLoadEnabled},getAutoSaveEnabled:function(){return this._autoSaveEnabled},getEditor:function(){return this.editor},getEncodingCharset:function(){return this._charset||f},getInput:function(){return this._input},getLocation:function(){return this._location},getTitle:function(){return this._title},getFileMetadata:function(){return this._fileMetadata},isSaveEnabled:function(){return!this.getReadOnly()},getReadOnly:function(){var e=this._fileMetadata;return this._readonly||!e||e.Attributes&&e.Attributes.ReadOnly},getContentType:function(){return this._contentType},onFocus:function(){return this._autoSaveEnabled&&this._errorSaving?void this.save():void(this._autoLoadEnabled&&this._fileMetadata&&this.load())},reportStatus:function(e){this.statusReporter?this.statusReporter(e):this.editor&&this.editor.reportStatus(e)},save:function(t){function o(e){var t=l._savingDeferred;return t.resolve(e),l._savingDeferred=null,l._saving=!1,t}function r(i){return p===c.getInput()&&(l.ETag=i.ETag,h.setInput(p,null,f,!0)),c.reportStatus(""),u&&x&&x.setProgressResult({Message:e.Saved,Severity:"Normal"}),c.postSave&&c.postSave(t),o(i)}function s(e){c.reportStatus("");var t=d(x,e);return a.logEvent("status","exception",(c._autoSaveActive?"Auto-save: ":"Save: ")+t.Message),c._errorSaving=!0,o()}var l=this.getFileMetadata();if(!l)return(new n).reject();if(l._saving)return l._savingDeferred;var c=this;l._savingDeferred=new n,l._saving=!0;var h=this.getEditor();if(!h||!h.isDirty()||this.getReadOnly())return o();var u=this._errorSaving,p=this.getInput();this.reportStatus(e["Saving..."]),this._saveEventLogged||(this._logMetrics("save"),this._saveEventLogged=!0),this.dispatchEvent({type:"Saving",inputManager:this}),h.markClean();var f=h.getText(),g=f;if(this._getSaveDiffsEnabled()&&!this._errorSaving){var m=this._getUnsavedChanges();if(m){for(var v=0,_=0;_<m.length;_++)v+=m[_].text.length;f.length>v&&(g={diff:m})}}this._clearUnsavedChanges(),this._errorSaving=!1;var y=l.ETag,C={ETag:y},w=this._parsedLocation.resource,b=this.fileClient.write(w,g,C),S=this.progressService,x=null;return this.serviceRegistry&&(x=this.serviceRegistry.getService("orion.page.message")),S&&(b=S.progress(b,i.formatMessage(e.savingFile,p))),b.then(r,function(t){if(412===t.status){var n=window.confirm(e.saveOutOfSync);if(!n)return o();var a=c.fileClient.write(w,f);S&&(a=S.progress(a,i.formatMessage(e.savingFile,p))),a.then(r,s)}else s(t)}),l._savingDeferred},setAutoLoadEnabled:function(e){this._autoLoadEnabled=e},setAutoSaveTimeout:function(e){if(this._autoSaveEnabled=-1!==e,this._autoSaveActive=!1,this._idle)this._idle.setTimeout(e);else{var t={document:document,timeout:e};this._idle=new l(t),this._idle.addEventListener("Idle",function(){this._errorSaving||(this._autoSaveActive=!0,this.save().then(function(){this._autoSaveActive=!1}))}.bind(this))}},setContentType:function(e){this._contentType=e},setEncodingCharset:function(e){this._charset=e},setInput:function(t){function i(){u.session&&u.session.save()}if(!this._ignoreInput&&(t||(t=s.hash()),"string"==typeof t)){var n=this.getEditor();t&&"#"!==t[0]&&(t="#"+t);var o=s.matchResourceParameters(t),r=this._parsedLocation||{},a=r.encoding!==o.encoding;if(n&&n.isDirty()){var l=this._location,c=r.resource,d=o.resource;if(c!==d||a)if(this._autoSaveEnabled)this.save();else if(!window.confirm(e.confirmUnsavedChanges))return void(window.location.hash=l)}var h=n&&r.editor!==o.editor;this._location=t,this._parsedLocation=o,this._ignoreInput=!0,this.selection&&this.selection.setSelections(t),this._ignoreInput=!1;var u={type:"InputChanging",input:o};this.dispatchEvent(u);var p=o.resource;if(u.metadata){i(),this.reportStatus(""),this._input=p;var f=u.metadata;return void this._setInputContents(o,p,null,f)}p?p!==this._input||a?(i(),this._input=p,this._readonly=!1,this._lastMetadata=this._fileMetadata,this._fileMetadata=null,this.load(o.encoding)):h?(this.reportStatus(""),this._setInputContents(o,p,null,this._fileMetadata,this._isText(this._fileMetadata))):this.processParameters(o)||u.session&&u.session.apply(!0):(i(),this._setNoInput(!0))}},setTitle:function(e){var t=e.lastIndexOf("/"),i=e;-1!==t&&(i=i.substring(t+1)),this._title=i},setSaveDiffsEnabled:function(e){this._saveDiffsEnabled=e;var t=this.editor;t&&!t.isDirty()&&this._clearUnsavedChanges()},_getSaveDiffsEnabled:function(){return this._saveDiffsEnabled&&this._acceptPatch&&-1!==this._acceptPatch.indexOf("application/json-patch")},_logMetrics:function(e){var t="(none)",i=this.getContentType(),n=this.getFileMetadata();if(i)t=i.id;else if(n){var o=n.Name,r=o.lastIndexOf(".");if(r>=0)t="unregistered: "+o.substring(r);else switch(o){case"AUTHORS":case"config":case"LICENSE":case"make":case"Makefile":t="unregistered: "+o}}a.logEvent("editor",e,t)},_unknownContentTypeAsText:function(){return!0},_isText:function(e){var t=this.contentTypeRegistry.getFileContentType(e);if(!t)return this._unknownContentTypeAsText();var i=this.contentTypeRegistry.getContentType("text/plain");return this.contentTypeRegistry.isExtensionOf(t,i)},_setNoInput:function(e){return e?void this.fileClient.loadWorkspace("").then(function(e){this._input=e.ChildrenLocation,this._setInputContents(e.ChildrenLocation,null,e,e)}.bind(this)):(this._input=this._title=this._fileMetadata=null,this.setContentType(null),void this.dispatchEvent({type:"InputChanged",input:null}))},_setInputContents:function(e,t,i,n,o){var r,s=!1;n?(this._fileMetadata=n,this.setTitle(n.Location||String(n)),this.setContentType(this.contentTypeRegistry.getFileContentType(n)),r=n.Name,s=n.Directory):(this._fileMetadata=null,this.setTitle(t),this.setContentType(this.contentTypeRegistry.getFilenameContentType(this.getTitle())),r=this.getTitle());var l=this.getEditor();this._focusListener&&(l&&l.getTextView&&l.getTextView()&&l.getTextView().removeEventListener("Focus",this._focusListener),this._focusListener=null);var c={type:"InputChanged",input:e,name:r,title:t,contentType:this.getContentType(),metadata:n,location:window.location,contents:i};if(this._logMetrics("open"),this.dispatchEvent(c),this.editor=l=c.editor,!s){if(o||l.setInput(t,null,i),l&&l.getTextView&&l.getTextView()){var d=l.getTextView();d.addEventListener("Focus",this._focusListener=this.onFocus.bind(this))}this._clearUnsavedChanges(),this.processParameters(e)||c.session&&c.session.apply()}this._saveEventLogged=!1,a.logPageLoadTiming("interactive",window.location.pathname)},_getUnsavedChanges:function(){var e=this.editor;return e&&e.getUndoStack&&e.getUndoStack()?e.getUndoStack()._unsavedChanges:null},_clearUnsavedChanges:function(){var e=this.editor;e&&e.getUndoStack&&e.getUndoStack()&&(e.getUndoStack()._unsavedChanges=this._getSaveDiffsEnabled()?[]:null)}}),{handleError:d,InputManager:p}}),function(){function e(e){this.tokens=[],this.tokens.links={},this.options=e||c.defaults,this.rules=d.normal,this.options.gfm&&(this.rules=this.options.tables?d.tables:d.gfm)}function t(e,t){if(this.options=t||c.defaults,this.links=e,this.rules=h.normal,this.renderer=this.options.renderer||new i,this.renderer.options=this.options,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.rules=this.options.breaks?h.breaks:h.gfm:this.options.pedantic&&(this.rules=h.pedantic)}function i(e){this.options=e||{}}function n(e){this.tokens=[],this.token=null,this.options=e||c.defaults,this.options.renderer=this.options.renderer||new i,this.renderer=this.options.renderer,this.renderer.options=this.options}function o(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function r(e){return e.replace(/&([#\w]+);/g,function(e,t){return t=t.toLowerCase(),"colon"===t?":":"#"===t.charAt(0)?String.fromCharCode("x"===t.charAt(1)?parseInt(t.substring(2),16):+t.substring(1)):""})}function s(e,t){return e=e.source,t=t||"",function i(n,o){return n?(o=o.source||o,o=o.replace(/(^|[^\[])\^/g,"$1"),e=e.replace(n,o),i):new RegExp(e,t)}}function a(){}function l(e){for(var t,i,n=1;n<arguments.length;n++){t=arguments[n];for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}function c(t,i,r){if(r||"function"==typeof i){r||(r=i,i=null),i=l({},c.defaults,i||{});var s,a,d=i.highlight,h=0;try{s=e.lex(t,i)}catch(u){return r(u)}a=s.length;var p=function(){var e,t;try{e=n.parse(s,i)}catch(o){t=o}return i.highlight=d,t?r(t):r(null,e)};if(!d||d.length<3)return p();if(delete i.highlight,!a)return p();for(;h<s.length;h++)!function(e){return"code"!==e.type?--a||p():d(e.text,e.lang,function(t,i){return null==i||i===e.text?--a||p():(e.text=i,e.escaped=!0,void(--a||p()))})}(s[h])}else try{return i&&(i=l({},c.defaults,i)),n.parse(e.lex(t,i),i)}catch(u){if(u.message+="\nPlease report this to https://github.com/chjj/marked.",(i||c.defaults).silent)return"<p>An error occured:</p><pre>"+o(u.message+"",!0)+"</pre>";throw u}}var d={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:a,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:a,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,blockquote:/^( *>[^\n]+(\n(?!def)[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:a,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/};d.bullet=/(?:[*+-]|\d+\.)/,d.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,d.item=s(d.item,"gm")(/bull/g,d.bullet)(),d.list=s(d.list)(/bull/g,d.bullet)("hr","\\n+(?=\\1?(?:[-*_] *){3,}(?:\\n+|$))")("def","\\n+(?="+d.def.source+")")(),d.blockquote=s(d.blockquote)("def",d.def)(),d._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|[^\\w\\s@]*@)\\b",d.html=s(d.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,d._tag)(),d.paragraph=s(d.paragraph)("hr",d.hr)("heading",d.heading)("lheading",d.lheading)("blockquote",d.blockquote)("tag","<"+d._tag)("def",d.def)(),d.normal=l({},d),d.gfm=l({},d.normal,{fences:/^ *(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/}),d.gfm.paragraph=s(d.paragraph)("(?!","(?!"+d.gfm.fences.source.replace("\\1","\\2")+"|"+d.list.source.replace("\\1","\\3")+"|")(),d.tables=l({},d.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),e.rules=d,e.lex=function(t,i){var n=new e(i);return n.lex(t)},e.prototype.lex=function(e){return e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(e,!0)},e.prototype.token=function(e,t,i){for(var n,o,r,s,a,l,c,h,u,e=e.replace(/^ +$/gm,"");e;)if((r=this.rules.newline.exec(e))&&(e=e.substring(r[0].length),r[0].length>1&&this.tokens.push({type:"space"})),r=this.rules.code.exec(e))e=e.substring(r[0].length),r=r[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?r:r.replace(/\n+$/,"")});else if(r=this.rules.fences.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"code",lang:r[2],text:r[3]});else if(r=this.rules.heading.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"heading",depth:r[1].length,text:r[2]});else if(t&&(r=this.rules.nptable.exec(e))){for(e=e.substring(r[0].length),l={type:"table",header:r[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:r[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:r[3].replace(/\n$/,"").split("\n")},h=0;h<l.align.length;h++)l.align[h]=/^ *-+: *$/.test(l.align[h])?"right":/^ *:-+: *$/.test(l.align[h])?"center":/^ *:-+ *$/.test(l.align[h])?"left":null;for(h=0;h<l.cells.length;h++)l.cells[h]=l.cells[h].split(/ *\| */);this.tokens.push(l)}else if(r=this.rules.lheading.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"heading",depth:"="===r[2]?1:2,text:r[1]});else if(r=this.rules.hr.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"hr"});else if(r=this.rules.blockquote.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"blockquote_start"}),r=r[0].replace(/^ *> ?/gm,""),this.token(r,t,!0),this.tokens.push({type:"blockquote_end"});else if(r=this.rules.list.exec(e)){for(e=e.substring(r[0].length),s=r[2],this.tokens.push({type:"list_start",ordered:s.length>1}),r=r[0].match(this.rules.item),n=!1,u=r.length,h=0;u>h;h++)l=r[h],c=l.length,l=l.replace(/^ *([*+-]|\d+\.) +/,""),~l.indexOf("\n ")&&(c-=l.length,l=this.options.pedantic?l.replace(/^ {1,4}/gm,""):l.replace(new RegExp("^ {1,"+c+"}","gm"),"")),this.options.smartLists&&h!==u-1&&(a=d.bullet.exec(r[h+1])[0],s===a||s.length>1&&a.length>1||(e=r.slice(h+1).join("\n")+e,h=u-1)),o=n||/\n\n(?!\s*$)/.test(l),h!==u-1&&(n="\n"===l.charAt(l.length-1),o||(o=n)),this.tokens.push({type:o?"loose_item_start":"list_item_start"}),this.token(l,!1,i),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(r=this.rules.html.exec(e))e=e.substring(r[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:"pre"===r[1]||"script"===r[1]||"style"===r[1],text:r[0],isHTML:!0});else if(!i&&t&&(r=this.rules.def.exec(e)))e=e.substring(r[0].length),this.tokens.links[r[1].toLowerCase()]={href:r[2],title:r[3]},this.tokens.push({type:"def",id:r[1].toLowerCase(),href:r[2],title:r[3]});else if(t&&(r=this.rules.table.exec(e))){for(e=e.substring(r[0].length),l={type:"table",header:r[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:r[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:r[3].replace(/(?: *\| *)?\n$/,"").split("\n")},h=0;h<l.align.length;h++)l.align[h]=/^ *-+: *$/.test(l.align[h])?"right":/^ *:-+: *$/.test(l.align[h])?"center":/^ *:-+ *$/.test(l.align[h])?"left":null;for(h=0;h<l.cells.length;h++)l.cells[h]=l.cells[h].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(l)}else if(t&&(r=this.rules.paragraph.exec(e)))e=e.substring(r[0].length),this.tokens.push({type:"paragraph",text:"\n"===r[1].charAt(r[1].length-1)?r[1].slice(0,-1):r[1]});else if(r=this.rules.text.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"text",text:r[0]});else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0));return this.tokens};var h={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:a,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:a,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/};h._inside=/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,h._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,h.link=s(h.link)("inside",h._inside)("href",h._href)(),h.reflink=s(h.reflink)("inside",h._inside)(),h.normal=l({},h),h.pedantic=l({},h.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),h.gfm=l({},h.normal,{escape:s(h.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:s(h.text)("]|","~]|")("|","|https?://|")()}),h.breaks=l({},h.gfm,{br:s(h.br)("{2,}","*")(),text:s(h.gfm.text)("{2,}","*")()}),t.rules=h,t.output=function(e,i,n){var o=new t(i,n);return o.output(e)},t.prototype.output=function(e){for(var t,i,n,r,s="";e;)if(r=this.rules.escape.exec(e))e=e.substring(r[0].length),s+=r[1];else if(r=this.rules.autolink.exec(e))e=e.substring(r[0].length),"@"===r[2]?(i=this.mangle(":"===r[1].charAt(6)?r[1].substring(7):r[1]),n=this.mangle("mailto:")+i):(i=o(r[1]),n=i),s+=this.renderer.link(n,null,i);else if(this.inLink||!(r=this.rules.url.exec(e))){if(r=this.rules.tag.exec(e))!this.inLink&&/^<a /i.test(r[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(r[0])&&(this.inLink=!1),e=e.substring(r[0].length),s+=this.options.sanitize?o(r[0]):r[0];else if(r=this.rules.link.exec(e))e=e.substring(r[0].length),this.inLink=!0,s+=this.outputLink(r,{href:r[2],title:r[3]}),this.inLink=!1;else if((r=this.rules.reflink.exec(e))||(r=this.rules.nolink.exec(e))){if(e=e.substring(r[0].length),t=(r[2]||r[1]).replace(/\s+/g," "),t=this.links[t.toLowerCase()],!t||!t.href){s+=r[0].charAt(0),e=r[0].substring(1)+e;continue}this.inLink=!0,s+=this.outputLink(r,t),this.inLink=!1}else if(r=this.rules.strong.exec(e))e=e.substring(r[0].length),s+=this.renderer.strong(this.output(r[2]||r[1]));else if(r=this.rules.em.exec(e))e=e.substring(r[0].length),s+=this.renderer.em(this.output(r[2]||r[1]));else if(r=this.rules.code.exec(e))e=e.substring(r[0].length),s+=this.renderer.codespan(o(r[2],!0));else if(r=this.rules.br.exec(e))e=e.substring(r[0].length),s+=this.renderer.br();else if(r=this.rules.del.exec(e))e=e.substring(r[0].length),s+=this.renderer.del(this.output(r[1]));else if(r=this.rules.text.exec(e))e=e.substring(r[0].length),s+=o(this.smartypants(r[0]));else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0))}else e=e.substring(r[0].length),i=o(r[1]),n=i,s+=this.renderer.link(n,null,i);return s},t.prototype.outputLink=function(e,t){var i=o(t.href),n=t.title?o(t.title):null;return"!"!==e[0].charAt(0)?this.renderer.link(i,n,this.output(e[1])):this.renderer.image(i,n,o(e[1]))},t.prototype.smartypants=function(e){return this.options.smartypants?e.replace(/--/g,"—").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…"):e},t.prototype.mangle=function(e){for(var t,i="",n=e.length,o=0;n>o;o++)t=e.charCodeAt(o),Math.random()>.5&&(t="x"+t.toString(16)),i+="&#"+t+";";return i},i.prototype.code=function(e,t,i){if(this.options.highlight){var n=this.options.highlight(e,t);null!=n&&n!==e&&(i=!0,e=n)}return t?'<pre><code class="'+this.options.langPrefix+o(t,!0)+'">'+(i?e:o(e,!0))+"\n</code></pre>\n":"<pre><code>"+(i?e:o(e,!0))+"\n</code></pre>"},i.prototype.blockquote=function(e){return"<blockquote>\n"+e+"</blockquote>\n"},i.prototype.def=function(){return""},i.prototype.html=function(e){return e},i.prototype.heading=function(e,t,i){return"<h"+t+' id="'+this.options.headerPrefix+i.toLowerCase().replace(/[^\w]+/g,"-")+'">'+e+"</h"+t+">\n"},i.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},i.prototype.list=function(e,t){var i=t?"ol":"ul";return"<"+i+">\n"+e+"</"+i+">\n"},i.prototype.listitem=function(e){return"<li>"+e+"</li>\n"},i.prototype.paragraph=function(e){return"<p>"+e+"</p>\n"},i.prototype.table=function(e,t){return"<table>\n<thead>\n"+e+"</thead>\n<tbody>\n"+t+"</tbody>\n</table>\n"},i.prototype.tablerow=function(e){return"<tr>\n"+e+"</tr>\n"},i.prototype.tablecell=function(e,t){var i=t.header?"th":"td",n=t.align?"<"+i+' style="text-align:'+t.align+'">':"<"+i+">";return n+e+"</"+i+">\n"},i.prototype.strong=function(e){return"<strong>"+e+"</strong>"},i.prototype.em=function(e){return"<em>"+e+"</em>"},i.prototype.codespan=function(e){return"<code>"+e+"</code>"},i.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"},i.prototype.del=function(e){return"<del>"+e+"</del>"},i.prototype.link=function(e,t,i){if(this.options.sanitize){try{var n=decodeURIComponent(r(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(o){return""}if(0===n.indexOf("javascript:"))return""}var s='<a href="'+e+'"';return t&&(s+=' title="'+t+'"'),s+=">"+i+"</a>"},i.prototype.image=function(e,t,i){var n='<img src="'+e+'" alt="'+i+'"';return t&&(n+=' title="'+t+'"'),n+=this.options.xhtml?"/>":">"},n.parse=function(e,t,i){var o=new n(t,i);return o.parse(e)},n.prototype.parse=function(e){this.inline=new t(e.links,this.options,this.renderer),this.tokens=e.reverse();for(var i="";this.next();)i+=this.tok();return i},n.prototype.next=function(){return this.token=this.tokens.pop()},n.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},n.prototype.parseText=function(){for(var e=this.token.text;"text"===this.peek().type;)e+="\n"+this.next().text;return this.inline.output(e)},n.prototype.tok=function(){switch(this.token.type){case"space":return"";case"def":return this.renderer.def(this.token.id,this.token.href,this.token.title);case"hr":return this.renderer.hr();case"heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,this.token.text);case"code":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case"table":var e,t,i,n,o,r="",s="";for(i="",e=0;e<this.token.header.length;e++)n={header:!0,align:this.token.align[e]},i+=this.renderer.tablecell(this.inline.output(this.token.header[e]),{header:!0,align:this.token.align[e]});for(r+=this.renderer.tablerow(i),e=0;e<this.token.cells.length;e++){for(t=this.token.cells[e],i="",o=0;o<t.length;o++)i+=this.renderer.tablecell(this.inline.output(t[o]),{header:!1,align:this.token.align[o]});s+=this.renderer.tablerow(i)}return this.renderer.table(r,s);case"blockquote_start":for(var s="";"blockquote_end"!==this.next().type;)s+=this.tok();return this.renderer.blockquote(s);case"list_start":for(var s="",a=this.token.ordered;"list_end"!==this.next().type;)s+=this.tok();return this.renderer.list(s,a);case"list_item_start":for(var s="";"list_item_end"!==this.next().type;)s+="text"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(s);case"loose_item_start":for(var s="";"list_item_end"!==this.next().type;)s+=this.tok();return this.renderer.listitem(s);case"html":var l=this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);return this.renderer.html(l);case"paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));case"text":return this.renderer.paragraph(this.parseText())}},a.exec=a,c.options=c.setOptions=function(e){return l(c.defaults,e),c},c.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1,headerPrefix:"",renderer:new i,xhtml:!1},c.Parser=n,c.parser=n.parse,c.Renderer=i,c.Lexer=e,c.lexer=e.lex,c.InlineLexer=t,c.inlineLexer=t.output,c.parse=c,"object"==typeof exports?module.exports=c:"function"==typeof define&&define.amd?define("marked/marked",[],function(){return c}):this.marked=c}.call(function(){return this||("undefined"!=typeof window?window:global)}()),define("orion/section",["orion/EventTarget","orion/webui/littlelib","orion/commonHTMLFragments","orion/objects","orion/selection","orion/webui/tooltip","orion/bidiUtils"],function(e,t,i,n,o,r,s){function a(n,o){e.attach(this);var s=this;if(this._expandImageClass="core-sprite-openarrow",this._collapseImageClass="core-sprite-closedarrow",this._progressImageClass="core-sprite-progress",this._twistieSpriteClass="modelDecorationSprite",!o.id)throw new Error("Missing required argument: id");if(this.id=o.id,!o.title)throw new Error("Missing required argument: title");var a=o.useAuxStyle?["sectionWrapper","sectionWrapperAux","toolComposite"]:["sectionWrapper","toolComposite"];this.domNode=document.createElement("div"),o.sibling?n.insertBefore(this.domNode,o.sibling):n.appendChild(this.domNode);for(var l=0;l<a.length;l++)this.domNode.classList.add(a[l]);this.domNode.id=o.id,o.tooltip&&(this.domNode.optionsTooltip=new r.Tooltip({node:this.domNode,text:o.tooltip,position:["above","below","right","left"]})),this.canHide=o.canHide,o.canHide&&(this.domNode.style.cursor="pointer",o.noTwistie||(this.twistie=document.createElement("span"),this.twistie.classList.add("modelDecorationSprite"),this.twistie.classList.add("layoutLeft"),this.twistie.classList.add("sectionTitleTwistie"),this.domNode.appendChild(this.twistie)),this.domNode.tabIndex=0,this.domNode.addEventListener("click",function(e){(e.target===s.titleNode||e.target===s.twistie||e.target===s.domNode||e.target===s._iconNode||e.target===s.dropdownArrow)&&s._changeExpandedState()
},!1),this.domNode.addEventListener("keydown",function(e){(e.target===s.domNode||e.target===s.titleNode||e.target===s.twistie)&&(e.keyCode===t.KEY.ENTER?s._changeExpandedState():e.keyCode===t.KEY.DOWN&&s.dropdown?s.setHidden(!1):e.keyCode===t.KEY.UP&&s.dropdown?s.setHidden(!0):e.keyCode===t.KEY.ESCAPE&&s.setHidden(!0))},!1));var c;if(o.iconClass){var d=this._iconNode=document.createElement("span");d.classList.add("sectionIcon"),this.domNode.appendChild(d),c=Array.isArray(o.iconClass)?o.iconClass:[o.iconClass],c.forEach(function(e){d.classList.add(e)})}if(o.headerClass&&(c=Array.isArray(o.headerClass)?o.headerClass:[o.headerClass],c.forEach(function(e){this.domNode.classList.add(e)}.bind(this))),o.keepHeader&&(this._keepHeader=o.keepHeader),this.titleActionsNode=document.createElement("div"),this.titleActionsNode.id=o.id+"TitleActionsArea",this.titleActionsNode.classList.add("layoutLeft"),this.titleActionsNode.classList.add("sectionActions"),this.domNode.appendChild(this.titleActionsNode),this.titleNode=document.createElement("div"),this.titleNode.id=o.id+"Title",this.titleNode.classList.add("sectionAnchor"),this.titleNode.classList.add("sectionTitle"),this.titleNode.classList.add("layoutLeft"),this.domNode.appendChild(this.titleNode),this.titleNode.textContent=o.title,"function"==typeof o.getItemCount){var h=document.createElement("div");h.classList.add("layoutLeft"),h.classList.add("sectionItemCount"),this.domNode.appendChild(h),h.textContent=o.getItemCount(this)}this._progressNode=document.createElement("div"),this._progressNode.id=o.id+"Progress",this._progressNode.classList.add("sectionProgress"),this._progressNode.classList.add("sectionTitle"),this._progressNode.classList.add("layoutLeft"),this._progressNode.style.display="none",this._progressNode.textContent="...",this.domNode.appendChild(this._progressNode),this.titleLeftActionsNode=document.createElement("div"),this.titleLeftActionsNode.id=o.id+"LeftTitleActionsArea",this.titleLeftActionsNode.classList.add("layoutLeft"),this.titleLeftActionsNode.classList.add("sectionActions"),this.domNode.appendChild(this.titleLeftActionsNode),o.dropdown&&!o.noArrow&&(this.dropdownArrow=document.createElement("div"),this.dropdownArrow.classList.add("modelDecorationSprite"),this.dropdownArrow.classList.add("layoutLeft"),this.dropdownArrow.classList.add("sectionDropdownArrow"),this.dropdownArrow.classList.add(this._expandImageClass),this.domNode.appendChild(this.dropdownArrow));var u=this.searchBox=document.createElement("div");if(u.id=o.id+"FilterSearchBox",this.domNode.appendChild(u),this._toolActionsNode=document.createElement("div"),this._toolActionsNode.id=o.id+"ToolActionsArea",this._toolActionsNode.classList.add("layoutRight"),this._toolActionsNode.classList.add("sectionActions"),this.domNode.appendChild(this._toolActionsNode),this.actionsNode=document.createElement("ul"),this.actionsNode.id=o.id+"ActionArea",this.actionsNode.classList.add("layoutRight"),this.actionsNode.classList.add("commandList"),this.actionsNode.classList.add("sectionActions"),this.domNode.appendChild(this.actionsNode),this.selectionNode=document.createElement("ul"),this.selectionNode.id=o.id+"SelectionArea",this.selectionNode.classList.add("layoutRight"),this.selectionNode.classList.add("commandList"),this.selectionNode.classList.add("sectionActions"),this.domNode.appendChild(this.selectionNode),o.slideout){var p=i.slideoutHTMLFragment(o.id),f=document.createRange();f.selectNode(this.domNode),p=f.createContextualFragment(p),this.domNode.appendChild(p)}if(this._contentParent=document.createElement("div"),this._contentParent.id=this.id+"Content",this._contentParent.setAttribute("role","region"),this._contentParent.classList.add("sectionTable"),this._contentParent.setAttribute("aria-labelledby",this.titleNode.id),this._collapse(),o.sibling?n.insertBefore(this._contentParent,o.sibling):n.appendChild(this._contentParent),o.content&&this.setContent(o.content),"function"==typeof o.onExpandCollapse&&(this._onExpandCollapse=o.onExpandCollapse),this._preferenceService=o.preferenceService,o.dropdown)this._updateExpandedState(!0),this.dropdown=!0,this.positionNode=o.positionNode,t.addAutoDismiss([this._contentParent,this.positionNode||this.domNode],function(e){for(var t=e.target;t;){if(t.classList&&t.classList.contains("tooltipContainer"))return;t=t.parentNode}this.setHidden(!0)}.bind(this));else if(this._preferenceService){var g=this;this._preferenceService.get("/window/views").then(function(e){var t=e[g.id];void 0===t?o.hidden||g._expand():t&&g._expand(),g._updateExpandedState(!1)})}else o.hidden||this._expand(),this._updateExpandedState(!1);this._commandService=o.commandService,this._lastMonitor=0,this._loading={}}function l(e){this._section=e,this._id=++e._lastMonitor}return a.prototype={destroy:function(){var e;this.domNode&&(e=this.domNode.parentNode,e&&e.removeChild(this.domNode),this.domNode=null),this._contentParent&&(e=this._contentParent.parentNode,e&&e.removeChild(this._contentParent),this._contentParent=null)},setTitle:function(e){this.titleNode.textContent=e},getHeaderElement:function(){return this.domNode},getTitleElement:function(){return this.titleNode},getActionElement:function(){return this._toolActionsNode},setContent:function(e){"string"==typeof e?this._contentParent.innerHTML=e:(this._contentParent.innerHTML="",this._contentParent.appendChild(e))},setHidden:function(e){this.hidden!==e&&this.canHide&&this._changeExpandedState()},setOnExpandCollapse:function(e){this._onExpandCollapse=e},getContentElement:function(){return this._contentParent},embedExplorer:function(e,i,r){this._contentParent.innerHTML="",e.parent||(e.parent=i),this._contentParent.appendChild(e.parent),e.section=this,n.mixin(e,{createActionSections:function(){this.actionsSections&&this.actionsSections.forEach(function(e){if(!t.node(e)){var i=document.createElement("ul");i.id=e,i.classList.add("commandList"),i.classList.add("layoutRight"),this.section.actionsNode.appendChild(i)}}.bind(this))},getCommandsVisible:function(){return"hidden"!==this.section.actionsNode.style.visibility},setCommandsVisible:function(e,i){this.section.actionsNode.style.visibility=e?"":"hidden",void 0===i&&(i=e?null:"cursorOnly"),this.renderer.selectionPolicy=i;var n=this.getNavHandler();n&&n.setSelectionPolicy(i),e?this.updateCommands():this.actionsSections&&this.actionsSections.forEach(function(e){t.node(e)&&this.commandRegistry.destroy(e)}.bind(this))},destroy:function(){Object.getPrototypeOf(this).destroy.call(this);var e=this;this.actionsSections&&(this.actionsSections.forEach(function(t){delete e[t]}),delete this.actionsSections)},updateCommands:function(e){this.section.actionsNode&&this.getCommandsVisible()&&(this.createActionSections(),Object.getPrototypeOf(this).updateCommands.call(this,e))},loaded:function(){var e=this;this.selection||r||(this.serviceRegistry||this.registry?(this.selection=new o.Selection(this.serviceRegistry||this.registry,this.parent.id+"Selection"),this.selection.addEventListener("selectionChanged",function(t){e.updateCommands(t.selections)})):window.console.error("Could not create a Selection for the explorer because of lack of serviceRegistry"));var t=this.registerCommands();t&&t.then?t.then(function(){e.updateCommands()}):e.updateCommands()}}),e.renderer&&(e.renderer.section=this,this._keepHeader||n.mixin(e.renderer,{getCellHeaderElement:function(e){var t=Object.getPrototypeOf(this).getCellHeaderElement.call(this,e);if(t){var i=t.innerHTML;s.isBidiEnabled&&(i=s.enforceTextDirWithUcc(i)),this.section.setTitle(i)}return null}}))},createProgressMonitor:function(){return new l(this)},_setMonitorMessage:function(e,t){this._progressNode.style.display="block",this._loading[e]=t;var i="";for(var n in this._loading)""!==i&&(i+="\n"),i+=this._loading[n];this._progressNode.title=i,this._updateExpandedState(!1)},_monitorDone:function(e){delete this._loading[e];var t="";for(var i in this._loading)""!==t&&(t+="\n"),t+=this._loading[i];this._progressNode.title=t,""===t&&(this._progressNode.style.display="none"),this._updateExpandedState(!1)},_changeExpandedState:function(){if(this.hidden){this._expand();var e=t.firstTabbable(this.domNode.nextElementSibling);e&&"INPUT"===e.tagName&&e.focus()}else this._collapse();this._updateExpandedState(!0)},_updateExpandedState:function(e){var t=!this.hidden,i=this.working,n=this.twistie,o=this.id;if(n&&(n.classList.remove(this._expandImageClass),n.classList.remove(this._collapseImageClass),n.classList.remove(this._progressImageClass),n.classList.add(i?this._progressImageClass:t?this._expandImageClass:this._collapseImageClass)),this._preferenceService&&e){var r={};r[o]=t,this._preferenceService.put("/window/views",r)}this._onExpandCollapse&&this._onExpandCollapse(t,this),this.dispatchEvent({type:"toggle",isExpanded:t})},_expand:function(){this._positionDropdown(),this._contentParent&&(this._contentParent.classList.remove("sectionClosed"),this._contentParent.classList.add("sectionOpened")),this.domNode&&(this.domNode.classList.remove("sectionClosed"),this.domNode.classList.add("sectionOpened")),this.hidden=!1},_positionDropdown:function(){if(this.dropdown){var e=t.bounds(this.positionNode||this.domNode),i=t.bounds(this._boundingNode(this.domNode)),n=t.bounds(document.body),o=t.bounds(this._contentParent);this._contentParent.style.left=e.left+o.width>n.left+n.width?e.left-i.left-o.width+e.width+"px":e.left-i.left+"px",this._contentParent.style.top=e.top+e.height-i.top+"px"}},_boundingNode:function(e){var t=window.getComputedStyle(e,null);if(null===t)return e;var i=t.getPropertyValue("position");return"absolute"!==i&&e.parentNode&&e!==document.body?this._boundingNode(e.parentNode):e},_collapse:function(){this.hidden=!0,this._contentParent&&(this._contentParent.classList.add("sectionClosed"),this._contentParent.classList.remove("sectionOpened")),this.domNode&&(this.domNode.classList.add("sectionClosed"),this.domNode.classList.remove("sectionOpened"))}},a.prototype.constructor=a,l.prototype={begin:function(e){this._section.working=!0,this.status=e,this._section._setMonitorMessage(this.id,e)},worked:function(e){this.status=e,this._section._setMonitorMessage(this.id,e)},done:function(e){this._section.working=!1,this.status=e,this._section._monitorDone(this.id)}},l.prototype.constructor=l,{Section:a}}),define("orion/markdownView",["marked/marked","orion/editor/editor","orion/objects","orion/webui/littlelib","orion/URITemplate","orion/section","orion/URL-shim"],function(e,t,i,n,o,r){function s(e,t,i,n){return function(o,r){if(-1===r.href.indexOf(":"))try{var s;if("filesystem:"===t.protocol?s={href:"filesystem:"+new URL(r.href,t.pathname).href}:(s=new URL(r.href,t),n&&(s.protocol="",s.host="")),"!"!==o[0][0])r.href=h.expand({resource:s.href});else{if(i.readBlob){var a="_md_img_"+p++;return i.readBlob(s.href).then(function(e){var t=s.href.match(u),i=t?"image/"+t[1]:"image/png",n=URL.createObjectURL(new Blob([e],{type:i}));document.getElementById(a).src=n,document.getElementById(a).onload=function(){URL.revokeObjectURL(n)}}),"<img id='"+a+"' src=''>"}r.href=s.href}}catch(l){console.log(l)}return e.call(this,o,r)}}function a(t,i,n){var o=e.InlineLexer.prototype.outputLink,r=new URL(i,window.location.href);e.InlineLexer.prototype.outputLink=s(o,r,n,-1===i.indexOf(":"));var a=e(t,{sanitize:!0});return e.InlineLexer.prototype.outputLink=o,a}function l(e){this.fileClient=e.fileClient,this.progress=e.progress,this.canHide=e.canHide,this._node=null}function c(e){this.id="orion.viewer.markdown",this.fileClient=e.fileClient,this.metadata=e.metadata,f.apply(this,arguments)}function d(e){this._parent=e.parent,this.fileClient=e.fileService,this.metadata=e.metadata,this.serviceRegistry=e.serviceRegistry,this.contentTypeRegistry=e.contentTypeRegistry,this.commandRegistry=e.commandRegistry,this.progress=e.progressService,this.model=e.model,this.undoStack=e.undoStack}var h=new o("#{,resource,params*}"),u=/\.([0-9a-z]+)(?:[\?#]|$)/i,p=0;l.prototype={display:function(e,t,i,n){e.classList.add("orionMarkdown"),e.innerHTML=a(t,i,n)},displayContents:function(e,t){var i=t.Location||t;n.empty(e);var o=document.createElement("div");(this.progress?this.progress.progress(this.fileClient.read(i),"Reading file "+(t.Name||i)):this.fileClient.read(i)).then(function(e){this.display.bind(this)(o,e,i,this.fileClient)}.bind(this)),e.appendChild(o)},displayInFrame:function(e,t,i,n,o){var s=new r.Section(e,{id:"markdownSection",title:t.Name||o||"readme",headerClass:i,canHide:this.canHide});if(n){var a=s.getTitleElement();a&&a.classList.add(n)}this.displayContents.call(this,s.getContentElement(),t)}};var f=t.BaseEditor;return c.prototype=Object.create(f.prototype),i.mixin(c.prototype,{createMarked:function(e){return a(e,this.metadata.Location,this.fileClient)},install:function(){var e=this._rootDiv=document.createElement("div");e.style.width="100%",e.style.height="100%";var t=this._contentDiv=document.createElement("div");t.classList.add("orionMarkdown"),e.appendChild(t);var i=n.node(this._domNode);i.appendChild(e),this._contentDiv.innerHTML=this.createMarked(this.getModel().getText()),f.prototype.install.call(this)},setInput:function(e,t,i,n){f.prototype.setInput.call(this,e,t,i,n),t||n||(this._contentDiv.innerHTML=this.createMarked(i))},uninstall:function(){n.empty(this._domNode),f.prototype.uninstall.call(this)}}),d.prototype={create:function(){this.editor=new c({domNode:this._parent,fileClient:this.fileClient,metadata:this.metadata,model:this.model,undoStack:this.undoStack}),this.editor.install()},destroy:function(){this.editor&&this.editor.destroy(),this.editor=null}},{MarkdownEditorView:d,MarkdownView:l}}),define("orion/projects/projectEditor",["i18n!orion/edit/nls/messages","orion/i18nUtil","orion/URITemplate","orion/webui/littlelib","orion/Deferred","orion/objects","orion/projectCommands","orion/PageLinks","orion/explorers/explorer","orion/section","orion/webui/tooltip"],function(e,t,i,n,o,r,s,a,l,c){function d(e){this.root=e}function h(e,t,i){this._init(e),this.projectEditor=t,this.explorer=i}function u(e){this.root=e}function p(e,t,i){this._init(e),this.projectEditor=t,this.explorer=i}function f(e,t){this.root=e,this.projectClient=t}function g(e,t,i){this._init(e),this.projectEditor=t,this.explorer=i,this.commandService=e.commandRegistry,this.actionScopeId=e.actionScopeId}function m(e){this.idCount=v++,this.serviceRegistry=e.serviceRegistry,this.fileClient=e.fileClient,this.progress=e.progress,this.preferences=e.preferences,this.projectClient=this.serviceRegistry.getService("orion.project.client"),this.commandRegistry=e.commandRegistry,this._node=null,this.dependencyActions="dependencyActions",this.createCommands()}var v=0,_=new i("./edit.html#{,resource,params*}");return d.prototype=new l.ExplorerModel,d.prototype.constructor=d,d.prototype.getRoot=function(e){return e(this.root)},d.prototype.getChildren=function(t,i){i(t===this.root?[{id:"Name",displayName:e.Name,value:t.Name,no:1},{id:"Description",displayName:e.Description,value:t.Description,no:2},{id:"Url",displayName:e.Site,value:t.Url,href:t.Url,no:3}]:[])},d.prototype.getId=function(e){return"ProjectInfo"+e.id},h.prototype=new l.SelectionRenderer,h.prototype.constructor=h,h.prototype.getCellHeaderElement=function(){},h.prototype.getCellElement=function(t,i){if(0===t){var o=document.createElement("td"),r=document.createElement("span");return r.className="discreetInputLabel",r.appendChild(document.createTextNode(i.displayName)),o.classList.add("discreetInputLabel"),o.appendChild(r),o.width="20%",o}if(1===t){var o;if(i.href){o=document.createElement("td");var s=document.createElement("input");s.classList.add("discreetInputHidden");var a=document.createElement("div");a.title=e.ClickEditLabel,a.classList.add("discreetInput"),a.classList.add("discreetInputURLWrapper"),a.tabIndex=i.no;var l=document.createElement("a");return l.href=i.value||"",l.appendChild(document.createTextNode(i.value||"")),l.tabIndex=i.no+1,a.appendChild(l),a.title="Click to edit",a.onclick=function(){a.classList.add("discreetInputHidden"),l.classList.add("discreetInputHidden"),s.classList.remove("discreetInputHidden"),s.focus()}.bind(this.projectEditor),a.onfocus=a.onclick,a.onkeyup=function(e){e.keyCode===n.KEY.ENTER&&a.onclick(e)}.bind(this.projectEditor),l.urlSelector=a,this.projectEditor._renderEditableFields(s,i.id,i.no,l),o.appendChild(s),o.appendChild(a),o}o=document.createElement("td");var c=document.createElement("Description"===i.id?"textArea":"input");return this.projectEditor._renderEditableFields(c,i.id,i.no,null),o.appendChild(c),o}},h.prototype.getSecondaryColumnStyle=function(){return"discreetInputCell"},u.prototype=new l.ExplorerModel,u.prototype.constructor=u,u.prototype.getRoot=function(e){return e(this.root)},u.prototype.getChildren=function(e,t){if(e===this.root){for(var i=0;i<e.Children.length;i++)e.Children[i].parent=e;t(e.Children)}else t([])},u.prototype.getId=function(e){return"AdditionalInfo"+l.ExplorerModel.prototype.getId.call(this,{Location:e.parent.Name+e.Name})},p.prototype=new l.SelectionRenderer,p.prototype.constructor=p,p.prototype.getCellHeaderElement=function(e){if(0===e){var t=document.createElement("td");return t.colSpan=2,t.appendChild(document.createTextNode(this.explorer.model.root.Name)),t}},p.prototype.getCellElement=function(e,t){if(0===e){var n=document.createElement("td"),o=document.createElement("span");return o.className="discreetInputLabel",o.appendChild(document.createTextNode(t.Name)),n.classList.add("discreetInputLabel"),n.appendChild(o),n.width="20%",n}if(1===e){var n=document.createElement("td");if(t.Href){var r=document.createElement("a"),s=new i(t.Href);r.href=s.expand({OrionHome:a.getOrionHome()}),r.appendChild(document.createTextNode(t.Value||" ")),n.appendChild(r)}else n.appendChild(document.createTextNode(t.Value||" "));return n}},p.prototype.getSecondaryColumnStyle=function(){return"discreetInfoCell"},f.prototype=new l.ExplorerModel,f.prototype.constructor=f,f.prototype.getRoot=function(e){return e(this.root)},f.prototype.getChildren=function(e,t){if(e===this.root){var i=[];o.all((e.Dependencies||[]).map(function(t){var n={Dependency:t,Project:e};return i.push(n),this.projectClient.getDependencyFileMetadata(t,e.WorkspaceLocation).then(function(e){r.mixin(n,e)},function(){n.Directory=n.disconnected=!0})}.bind(this))).then(function(){t(i)}.bind(this))}else t([])},f.prototype.getId=function(e){return l.ExplorerModel.prototype.getId.call(this,e.Dependency)},g.prototype=new l.SelectionRenderer,g.prototype.constructor=g,g.prototype.getCellHeaderElement=function(){},g.prototype.getCellElement=function(i,n,o){if(0===i){var r=document.createElement("td");if(n.Location){r.className="navColumnNoIcon";var s=document.createElement("a");s.href=_.expand({resource:n.Location}),s.appendChild(document.createTextNode(n.Dependency.Name)),r.appendChild(s)}else{var a=n.Dependency.Name;n.disconnected&&(a=t.formatMessage(e.Disconnected,a)),r.appendChild(document.createTextNode(a))}return r}if(1===i){var l=this.getActionsColumn(n,o,null,null,!0);return l.style.textAlign="right",l}},m.prototype={createCommands:function(){this.dependenciesDisplatcher=s.getDependencyDispatcher();var e=this;this.dependneciesListener=function(t){e.dependenciesChanged.call(e,t)},this._dependenciesEventTypes=["create","delete"],this._dependenciesEventTypes.forEach(function(t){e.dependenciesDisplatcher.addEventListener(t,e.dependneciesListener)}),this.commandRegistry.registerCommandContribution(this.dependencyActions,"orion.project.dependency.connect",1),this.commandRegistry.registerCommandContribution(this.dependencyActions,"orion.project.dependency.disconnect",2)},changedItem:function(){this.fileClient.read(this.parentFolder.Location,!0).then(function(e){n.empty(this.node),this.displayContents(this.node,e)}.bind(this))},display:function(e,t){function i(e,t){t=t||{},e.forEach(function(e){var i;switch(e){case"projectInfo":i=document.createElement("span"),this.node.appendChild(i),this.renderProjectInfo(i,t[e]);break;case"additionalInfo":i=document.createElement("span"),this.node.appendChild(i),this.renderAdditionalProjectProperties(i);break;case"dependencies":i=document.createElement("span"),i.id="projectDependenciesNode",this.node.appendChild(i),this.renderDependencies(i,t[e])}}.bind(this))}this.node=e,this.node.className="orionProject",this.projectData=t;var n=["projectInfo","additionalInfo","dependencies"];this.preferences.get("/sectionsOrder").then(function(e){n=e.projectView||n;var t=e.projectViewNames||[];i.apply(this,[n,t])}.bind(this),function(e){i.apply(this,[n,{}]),window.console.error(e)}.bind(this))},displayContents:function(e,t){this.parentFolder=t,this.projectClient.readProject(t).then(function(t){this.display.bind(this)(e,t)}.bind(this))},dependenciesChanged:function(e){var t=n.node("projectDependenciesNode");if(t){if(e.project.ContentLocation===this.projectData.ContentLocation)if("delete"===e.type){if(this.projectData.Dependencies&&e.oldValue)for(var i=0;i<this.projectData.Dependencies.length;i++)this.projectData.Dependencies[i].Location===e.oldValue.Location&&this.projectData.Dependencies.splice(i,1)}else"create"===e.type&&this.projectData.Dependencies&&e.newValue&&this.projectData.Dependencies.push(e.newValue);n.empty(t),this.renderDependencies(t,this.dependenciesSectionName)}},_renderEditableFields:function(t,i,o,r){var s=function(e){var o={};o[i]=e.target.value,this.progress.progress(this.projectClient.changeProjectProperties(this.projectData,o),"Saving project "+this.projectData.Name).then(function(i){i&&(this.projectData=i,t.value=e.target.value,r&&(n.empty(r),r.appendChild(document.createTextNode(e.target.value)||""),r.href=e.target.value,r.classList.remove("discreetInputHidden"),r.urlSelector&&r.urlSelector.classList.remove("discreetInputHidden"),t.classList.add("discreetInputHidden")))}.bind(this))}.bind(this);t.value=this.projectData[i]||"",t.title=e.ClickEditLabel,t.classList.add("discreetInput"),t.tabIndex=String(o),t.onkeyup=function(e){e.keyCode===n.KEY.ENTER?"TEXTAREA"!==t.tagName.toUpperCase()&&t.blur():e.keyCode===n.KEY.ESCAPE&&(t.value=this.projectData[i]||"",t.blur())}.bind(this),t.onblur=function(e){s(e)}},renderProjectInfo:function(t,i){var n=i||e.ProjectInfo,o=new c.Section(t,{id:"projectInfoSection"+this.idCount,headerClass:["sectionTreeTableHeader"],title:n,canHide:!0}),r=document.createElement("div");r.id="projectInformationNode"+this.idCount;var s=new h({checkbox:!1,treeTableClass:"sectionTreeTable",cachePrefix:"ProjectInfoExplorer"},this),a=new l.Explorer(this.serviceRegistry,null,s,this.commandRegistry);o.embedExplorer(a,r),a.createTree(r,new d(this.projectData),{noSelection:!0})},renderAdditionalProjectProperties:function(e){this.projectClient.getMatchingProjectHandlers(this.parentFolder).then(function(t){for(var i=0;i<t.length;i++){var n=t[i];n&&n.getAdditionalProjectProperties&&this.progress.progress(n.getAdditionalProjectProperties(this.parentFolder,this.projectData),"Getting additional project information").then(function(t){if(t&&t.length&&0!==t.length)for(var i=0;i<t.length;i++){var n=t[i];if(n.Name){var o=new c.Section(e,{id:n.Name+"Section"+this.idCount,headerClass:["sectionTreeTableHeader"],title:n.Name,canHide:!0}),r=document.createElement("div");r.id=n.Name+"Table"+this.idCount;var s=new p({treeTableClass:"sectionTreeTable",checkbox:!1},this),a=new l.Explorer(this.serviceRegistry,null,s,this.commandRegistry);o.embedExplorer(a,r),a.createTree(r,new u(n),{noSelection:!0})}}}.bind(this))}}.bind(this))},renderDependencies:function(e,t){if(this.projectData.Dependencies&&0!==this.projectData.Dependencies.length){this.dependenciesSectionName=t||"Associated Content";var i=new c.Section(e,{id:"projectDependenciesSection",headerClass:["sectionTreeTableHeader"],title:this.dependenciesSectionName,canHide:!0}),n=document.createElement("div");n.id="dependenciesNode";var o=new g({checkbox:!1,treeTableClass:"sectionTreeTable",commandRegistry:this.commandRegistry,actionScopeId:this.dependencyActions},this),r=new l.Explorer(this.serviceRegistry,null,o,this.commandRegistry);r.actionScopeId=this.dependencyActions,i.embedExplorer(r,n),r.createTree(n,new f(this.projectData,this.projectClient),{indent:"8px",noSelection:!0})}},destroy:function(){var e=this;this._dependenciesEventTypes.forEach(function(t){e.dependenciesDisplatcher.removeEventListener(t,e.dependneciesListener)})}},{ProjectEditor:m}}),define("orion/projects/projectExplorer",["i18n!orion/edit/nls/messages","orion/URITemplate","orion/webui/littlelib","orion/explorers/explorer","orion/section","orion/bidiUtils"],function(e,t,i,n,o,r){function s(e){this._init(e)}function a(e,t,i,n){this.idCount=l++,this.registry=t,this.selection=i,this.commandRegistry=n,this.parentId=e,this.renderer=new s({}),this.renderer.explorer=this,this.myTree=null,this.newActionsScope=d,this.actionsSections=[this.newActionsScope],this._init()}var l=0,c=new t("../edit/edit.html#{,resource,params*}"),d="newProjectActions";return s.prototype=new n.SelectionRenderer,s.prototype.getCellHeaderElement=function(){return null},s.prototype.emptyCallback=function(t){var n=document.createElement("tr"),o=document.createElement("td");o.colSpan=this.oneColumn?1:3;var r=document.createElement("div");r.classList.add("noFile"),r.textContent=e.NoProjects;var s=document.createElement("span");s.appendChild(document.createTextNode(e.File)),i.processDOMNodes(r,[s]),o.appendChild(r),n.appendChild(o),t.appendChild(n)},s.prototype.getCellElement=function(e,t){function i(e){if(!e.Description)return" ";var t=e.Description;return r.isBidiEnabled&&(t=r.enforceTextDirWithUcc(t)),e.Description.length>200?t.substring(0,180)+"...":t}var n=document.createElement("td");switch(e){case 0:n.className="navColumnNoIcon";var o=document.createElement("a"),s=t.Name;return r.isBidiEnabled&&(s=r.enforceTextDirWithUcc(s)),o.appendChild(document.createTextNode(s)),o.href=c.expand({resource:t.ContentLocation}),n.appendChild(o),n;case 1:return n.appendChild(document.createTextNode(i(t))),n;case 2:return t.Url?(o=document.createElement("a"),o.appendChild(document.createTextNode(t.Url)),o.href=t.Url,n.appendChild(o)):n.appendChild(document.createTextNode(" ")),n}return null},a.prototype=Object.create(n.Explorer.prototype),a.prototype._init=function(){var t=new o.Section(i.node(this.parentId),{id:"projectsSection"+this.idCount,title:e.projectsSectionTitle,canHide:!0}),n=document.createElement("div");n.id="projectsExplorer"+this.idCount,t.embedExplorer(this,n)},a.prototype.loadProjects=function(e){this.model=new n.SimpleFlatModel(e,"orion.project.",function(e){return e.ContentLocation?e.ContentLocation.replace(/[\\\/]/g,""):void 0}),this.myTree=this.createTree(this.parent,this.model,{indent:"8px",selectionPolicy:this.renderer.selectionPolicy}),this.updateCommands()},{ProjectExplorer:a,newActionsScope:d}}),define("orion/projects/projectView",["i18n!orion/edit/nls/messages","orion/projects/projectExplorer","orion/selection","orion/URITemplate","orion/fileCommands"],function(e,t,i,n,o){function r(e){this.progress=e.progress,this.fileClient=e.fileClient,this.serviceRegistry=e.serviceRegistry,this.commandRegistry=e.commandRegistry,this.projectClient=this.serviceRegistry.getService("orion.project.client"),this.modelEventDispatcher=o.getModelEventDispatcher();var t=this;this.modelListener=function(e){t.changedItemEvent.call(t,e)},this._eventTypes=["copy","create","delete","import","move"],this._eventTypes.forEach(function(e){t.modelEventDispatcher.addEventListener(e,t.modelListener)})}var s=new n("#{,resource,params*}");return r.prototype={display:function(e,n){n.classList.add("orionProject"),this.projectExplorer=new t.ProjectExplorer(n,this.serviceRegistry,new i.Selection(this.serviceRegistry),this.commandRegistry),this.changedItem(e)},setCommandsVisible:function(e){this.projectExplorer&&this.projectExplorer.setCommandsVisible.call(this.projectExplorer,e)},changedItemEvent:function(e){e.parent&&this.workspace&&e.parent.Location===this.workspace.Location&&this.projects&&this._handleChangedEvent(e.oldValue,e.newValue)},_handleChangedEvent:function(e,t){var i=this;if(e&&e.ContentLocation&&!e.Children&&!e.ChildrenLocation)return void this.fileClient.loadWorkspace(e.ContentLocation).then(function(e){i._handleChangedEvent(e,t)});if(t&&t.ContentLocation&&!t.Children&&!t.ChildrenLocation)return void this.fileClient.loadWorkspace(t.ContentLocation).then(function(t){i._handleChangedEvent(e,t)});if(t)this.projectClient.readProject(t,this.workspace).then(function(t){if(e){for(var n=0;n<i.projects.length;n++)if(e.Location===i.projects[n].ContentLocation)return void(t?(i.projects[n]=t,i.projectExplorer.loadProjects(i.projects)):(i.projects.splice(n,1),i.projectExplorer.loadProjects(i.projects)))}else t&&(i.projects.push(t),i.projectExplorer.loadProjects(i.projects))});else if(e)for(var n=0;n<i.projects.length;n++)if(e.Location===i.projects[n].ContentLocation)return i.projects.splice(n,1),void i.projectExplorer.loadProjects(i.projects)},changedItem:function(t,i,n){var o=this;return"created"===n&&t.ContentLocation?void(window.location=s.expand({resource:t.ContentLocation})):void(t?o.progress.progress(o.projectClient.readAllProjects(t),e.listingProjects).then(function(e){o.workspace=t,o.projects=e,o.projectExplorer.loadProjects(e)}):o.progress.progress(o.fileClient.loadWorkspace(),e.gettingWorkspaceInfo).then(function(i){o.progress.progress(o.projectClient.readAllProjects(t),e.listingProjects).then(function(e){o.workspace=i,o.projects=e,o.projectExplorer.loadProjects(e)})}))},destroy:function(){var e=this;this._eventTypes.forEach(function(t){e.modelEventDispatcher.removeEventListener(t,e.modelListener)})}},{ProjectView:r}}),define("orion/folderView",["orion/globalCommands","orion/explorers/explorer-table","orion/explorers/navigatorRenderer","orion/fileCommands","orion/markdownView","orion/projects/projectEditor","orion/PageUtil","orion/URITemplate","orion/webui/littlelib","orion/objects","orion/Deferred","orion/projects/projectView","orion/section"],function(e,t,i,n,o,r,s,a,l,c,d,h,u){function p(){_.apply(this,arguments)}function f(e){e.setFocus=!1,e.cachePrefix=null,e.dragAndDrop=n.uploadFile,e.modelEventDispatcher=n.getModelEventDispatcher(),e.rendererFactory=function(t){return new p({checkbox:!1,treeTableClass:"sectionTreeTable",cachePrefix:"FolderNavigator"},t,e.commandRegistry,e.contentTypeRegistry)},v.apply(this,arguments),this.menuBar=e.menuBar,this.serviceRegistry=e.serviceRegistry,this.fileClient=e.fileClient,this.commandRegistry=e.commandRegistry,this.contentTypeRegistry=e.contentTypeRegistry,this.editorInputManager=e.editorInputManager,this.treeRoot={},this.parent=l.node(e.parentId)}function g(e){this.idCount=m++,this._parent=e.parent,this._metadata=e.metadata,this.menuBar=e.menuBar,this.fileClient=e.fileService,this.progress=e.progressService,this.serviceRegistry=e.serviceRegistry,this.commandRegistry=e.commandRegistry,this.contentTypeRegistry=e.contentTypeRegistry,this.editorInputManager=e.inputManager,this.preferences=e.preferences,this.showProjectView=void 0===e.showProjectView?!0:e.showProjectView,this.showFolderNav=!0,this._init()}var m=0,v=t.FileExplorer,_=i.NavigatorRenderer,y=new a("#{,resource,params*}");return p.prototype=Object.create(_.prototype),c.mixin(p.prototype,{showFolderImage:!0,createFolderNode:function(e){var t=i.NavigatorRenderer.prototype.createFolderNode.call(this,e);return this.showFolderLinks&&"A"===t.tagName&&(t.href=y.expand({resource:e.Location})),t.classList.add("folderNavFolder"),t.classList.add("navlink"),t.classList.add("targetSelector"),t.classList.remove("navlinkonpage"),t},getCellHeaderElement:function(e){var t;if(0===e){t=document.createElement("th"),t.colSpan=1;var i=this.explorer.treeRoot;return t.appendChild(document.createTextNode(i.Parents?i.Name:this.explorer.fileClient.fileServiceName(i.Location))),t}return null},getExpandImage:function(){return null}}),f.prototype=Object.create(v.prototype),c.mixin(f.prototype,{loadRoot:function(e){e?this.load(e,"Loading "+e.Name).then(this.loaded.bind(this)):this.loadResourceList(s.matchResourceParameters().resource+"?depth=1",!1).then(this.loaded.bind(this))
},isCommandsVisible:function(){if(!this.selection)return!1;var t=e.getMainSplitter();return t?t.splitter.isClosed():!0},scope:function(e){window.location.href=y.expand({resource:e})},scopeUp:function(){var e,t=this.treeRoot,i=t.Parents&&t.Parents[0];e=i?i.ChildrenLocation:this.fileClient.fileServiceRootURL(t.Location),this.scope(e)},scopeDown:function(e){this.scope(e.ChildrenLocation)},registerCommands:function(){return(new d).resolve()},getTreeRoot:function(){return this.treeRoot},updateCommands:function(){this.menuBar&&(this.menuBar.setActiveExplorer(this),this.menuBar.updateCommands())}}),g.prototype={_init:function(){this.markdownView=new o.MarkdownView({fileClient:this.fileClient,canHide:!0,progress:this.progress}),this.showProjectView&&(this.projectEditor=new r.ProjectEditor({fileClient:this.fileClient,progress:this.progress,serviceRegistry:this.serviceRegistry,commandRegistry:this.commandRegistry,preferences:this.preferences}),this.projectView=new h.ProjectView({fileClient:this.fileClient,progress:this.progress,serviceRegistry:this.serviceRegistry,commandRegistry:this.commandRegistry}));var t=e.getMainSplitter();t&&e.getMainSplitter().splitter.addEventListener("toggle",this._splitterToggleListener=function(e){[this.markdownView,this.projectEditor,this.projectView,this.folderNavExplorer].forEach(function(t){t&&t.setCommandsVisible&&t.setCommandsVisible(e.closed)})}.bind(this))},_isCommandsVisible:function(){var t=e.getMainSplitter();return t?t.splitter.isClosed():!0},displayWorkspaceView:function(){var e=this;if(this._node||(this._node=document.createElement("div")),this._parent.appendChild(this._node),this.showProjectView){var t=document.createElement("div");e._node.appendChild(t),this.projectView.display(this._metadata,t),this.projectView.setCommandsVisible(this._isCommandsVisible())}},displayFolderView:function(e){function t(e,t){e.forEach(function(e){if("project"===e)i&&this.showProjectView&&(a=document.createElement("div"),this.projectEditor.displayContents(a,this._metadata),this._node.appendChild(a));else if("folderNav"===e){if(this.showFolderNav){var o=document.createElement("div");o.id="folderNavNode"+this.idCount;var r=t[e]||"Files",s=new u.Section(this._node,{id:"folderNavSection"+this.idCount,headerClass:["sectionTreeTableHeader"],title:r,canHide:!0});this.folderNavExplorer=new f({parentId:o,view:this,menuBar:this.menuBar,serviceRegistry:this.serviceRegistry,fileClient:this.fileClient,editorInputManager:this.editorInputManager,commandRegistry:this.commandRegistry,contentTypeRegistry:this.contentTypeRegistry}),s.embedExplorer(this.folderNavExplorer),this.folderNavExplorer.setCommandsVisible(this._isCommandsVisible()),this.folderNavExplorer.loadRoot(this._metadata)}}else"readme"===e&&n&&(a=document.createElement("div"),this.markdownView.displayInFrame(a,n,["sectionTreeTableHeader"],null,t[e]),this._node.appendChild(a))}.bind(this))}var i,n,o=e.Children;if(o)for(var r=0;r<o.length;r++){var s=o[r];s.Directory||"project.json"!==s.Name||(i=s),!s.Directory&&s.Name&&"readme.md"===s.Name.toLowerCase()&&(n=s)}var a;this._node||(this._node=document.createElement("div")),this._parent.appendChild(this._node);var l=["project","folderNav","readme"],c={};this.preferences?this.preferences.get("/sectionsOrder").then(function(e){c=e.folderViewNames||c,l=e.folderView||l,t.apply(this,[l,c])}.bind(this),function(e){t.apply(this,[l,c]),window.console.error(e)}.bind(this)):t.apply(this,[l,c])},create:function(){this._metadata.Projects&&this.displayWorkspaceView(),this._metadata.Children?this.displayFolderView(this._metadata):this._metadata.ChildrenLocation&&this.progress.progress(this.fileClient.fetchChildren(this._metadata.ChildrenLocation),"Fetching children of "+this._metadata.Name).then(function(e){this._metadata.Children=e,this.displayFolderView(this._metadata)}.bind(this))},destroy:function(){var t=e.getMainSplitter();t&&t.splitter.removeEventListener("toggle",this._splitterToggleListener),this.folderNavExplorer&&this.folderNavExplorer.destroy(),this.folderNavExplorer=null,this._node&&this._node.parentNode&&this._node.parentNode.removeChild(this._node),this.projectView&&this.projectView.destroy(),this.projectEditor&&this.projectEditor.destroy(),this._node=null}},{FolderView:g}}),define("orion/hover",["marked/marked"],function(e){function t(e,t){this.editor=e,this.hoverFactory=t,this.inputManager=t.inputManager,this.serviceRegistry=t.serviceRegistry,this.commandRegistry=t.commandRegistry,this._qfToolbars=[]}function i(e,t,i){this.serviceRegistry=e,this.inputManager=t,this.commandRegistry=i,this.filterHoverPlugins(),this.inputManager.addEventListener("InputChanged",function(){this.filterHoverPlugins()}.bind(this))}return t.prototype={computeHoverInfo:function(e){var t=[];return this.hoverFactory._applicableProviders.forEach(function(i){var n=this.serviceRegistry.getService(i);if(n&&n.computeHoverInfo){var o=this.editor.getEditorContext();t.push(n.computeHoverInfo(o,e))}}.bind(this)),t},renderMarkDown:function(t){return e(t,{sanitize:!0})},clearQuickFixes:function(){this._qfToolbars.forEach(function(e){e.destroy()}),this._qfToolbars=[]},renderQuickFixes:function(e,t){if(e&&t){var i=document.createElement("div");i.className="commandList";var n=[],o=this.inputManager.getFileMetadata();o.annotation=e,this.commandRegistry.renderCommands("orion.edit.quickfix",i,o,this.editor,"quickfix",e,n),delete o.annotation,t.appendChild(i)}}},i.prototype={createHover:function(e){return new t(e,this)},filterHoverPlugins:function(){this._applicableProviders=[];for(var e=this.serviceRegistry.getServiceReferences("orion.edit.hover"),t=0;t<e.length;t++){var i=e[t],n=this.inputManager.getContentType();if(n){var o=i.getProperty("contentType");o&&-1!==o.indexOf(n.id)&&this._applicableProviders.push(i)}}}},{HoverFactory:i}}),define("orion/editor/contentAssist",["i18n!orion/editor/nls/messages","orion/keyBinding","orion/editor/keyModes","orion/editor/eventTarget","orion/Deferred","orion/objects","orion/editor/tooltip","orion/editor/util","orion/util","orion/webui/littlelib","orion/metrics"],function(e,t,i,n,o,r,s,a,l,c,d){function h(i,n){this.textView=i,n&&(this.pageMessage=n.getService("orion.page.message")),this.state=f.INACTIVE,this.clearProviders();var o=this;this._textViewListeners={onModelChanging:function(e){this._latestModelChangingEvent=e,e&&this._updateFilterText(e)}.bind(this),onSelection:function(e){this.isDeactivatingChange(this._latestModelChangingEvent,e)?this.setState(f.INACTIVE):this.isActive()&&(this.state===f.ACTIVE&&this.setState(f.FILTERING),this.filterProposals()),this._latestModelChangingEvent=null}.bind(this),onScroll:function(){this.setState(f.INACTIVE)}.bind(this)},i.setKeyBinding(l.isMac?new t.KeyBinding(" ",!1,!1,!1,!0):new t.KeyBinding(" ",!0),"contentAssist"),i.setKeyBinding(l.isMac?new t.KeyBinding(" ",!1,!1,!0,!0):new t.KeyBinding(" ",!0,!1,!0),"contentAssist"),i.setAction("contentAssist",function(){return i.getOptions("readonly")||o.activate(),!0},{name:e.contentAssist})}function u(e,t){var n=e.textView;i.KeyMode.call(this,n),this.contentAssist=e,this.widget=t,this.proposals=[];var o=this;this.contentAssist.addEventListener("ProposalsComputed",function(e){if(o.proposals=e.data.proposals,0===o.proposals.length)o.selectedIndex=-1,o.cancel();else{for(o.selectedIndex=0;o.proposals[o.selectedIndex]&&o.proposals[o.selectedIndex].unselectable;)o.selectedIndex++;if(o.proposals[o.selectedIndex]){if(o.widget){var t=!0;if(e.autoApply){for(var i=o.selectedIndex+1;o.proposals[i]&&o.proposals[i].unselectable;)i++;o.proposals[i]||(t=!1,o.contentAssist.apply(o.proposals[o.selectedIndex]))}t&&(o.widget.show(),o.widget.selectNode(o.selectedIndex))}}else o.selectedIndex=-1,o.cancel()}}),n.setAction("contentAssistApply",function(){return this.enter()}.bind(this)),n.setAction("contentAssistCancel",function(){return this.cancel()}.bind(this)),n.setAction("contentAssistNextProposal",function(){return this.lineDown()}.bind(this)),n.setAction("contentAssistPreviousProposal",function(){return this.lineUp()}.bind(this)),n.setAction("contentAssistNextPage",function(){return this.pageDown()}.bind(this)),n.setAction("contentAssistPreviousPage",function(){return this.pageUp()}.bind(this)),n.setAction("contentAssistHome",function(){return this.widget&&this.widget.scrollIndex(0,!0),this.lineDown(0)}.bind(this)),n.setAction("contentAssistEnd",function(){return this.lineUp(this.proposals.length-1)}.bind(this)),n.setAction("contentAssistTab",function(){return this.tab()}.bind(this)),this.widget&&(this.widget.setContentAssistMode(this),this.widget.createAccessible())}function p(e,t){this.contentAssist=e,this.textView=this.contentAssist.getTextView(),this.textViewListenerAdded=!1,this.isShowing=!1,this._useResizeTimer=!1;var i=this.textView.getOptions("parent").ownerDocument;if(this.parentNode="string"==typeof t?i.getElementById(t):t,!this.parentNode){this.parentNode=l.createElement(i,"div"),this.parentNode.className="contentassist";var n=i.getElementsByTagName("body")[0];if(!n)throw new Error("parentNode is required");n.appendChild(this.parentNode)}var o=window.MutationObserver||window.MozMutationObserver;o&&l.isFirefox?this._mutationObserver=new o(function(){this._contentAssistMode._showTooltip(!0,!0)}.bind(this)):this._useResizeTimer=!0,a.addEventListener(this.parentNode,"scroll",this.onScroll.bind(this));var r=this;this.textViewListener={onMouseDown:function(e){var t=e.event.target||e.event.srcElement;t.parentElement!==r.parentNode&&r.contentAssist.deactivate()}},this.contentAssist.addEventListener("Deactivating",function(){r.hide()}),this.scrollListener=function(){r.isShowing&&r.position()},a.addEventListener(i,"scroll",this.scrollListener)}var f={INACTIVE:1,ACTIVE:2,FILTERING:3},g={selected:"selected",hr:"proposal-hr",emphasis:"proposal-emphasis",noemphasis:"proposal-noemphasis",noemphasis_keyword:"proposal-noemphasis-keyword",noemphasis_title:"proposal-noemphasis-title",noemphasis_title_keywords:"proposal-noemphasis-title-keywords",dfault:"proposal-default"};return h.prototype={apply:function(e){if(!e)return!1;var t=this.textView,i=t.getSelection(),n=this._initialCaretOffset,o=n,r=Math.max(i.start,i.end),s=r,a=t.getModel();a.getBaseModel&&(o=a.mapOffset(o),s=a.mapOffset(s),a=a.getBaseModel()),e.overwrite&&(n="string"==typeof e.prefix?o-e.prefix.length:this.getPrefixStart(a,o));var l={proposal:e,start:o,end:s};this.setState(f.INACTIVE);var c="string"==typeof e?e:e.proposal;if(t.setText(c,n,r),e.additionalEdits)for(var h,u=0;u<e.additionalEdits.length;u++)h=e.additionalEdits[u],t.setText(h.text,h.offset,h.offset+h.length);return this.dispatchEvent({type:"ProposalApplied",data:l}),d.logEvent("contentAssist","apply"),!0},activate:function(e,t){this.state===f.INACTIVE&&(d.logEvent("contentAssist","activate",void 0,t?0:1),this._autoTriggered=t?!0:!1,this.setState(f.ACTIVE,e))},deactivate:function(){this.setState(f.INACTIVE)},getTextView:function(){return this.textView},isActive:function(){return this.state===f.ACTIVE||this.state===f.FILTERING},isDeactivatingChange:function(e,t){var i=!1,n=Array.isArray(t.newValue)?t.newValue:[t.newValue],o=n[0].start<this._initialCaretOffset;return o||!e?i=!0:e&&(i=e.removedLineCount>0||e.addedLineCount>0),i},setState:function(e,t){var i;e===f.ACTIVE?(i="Activating",this._mode&&this._mode.setActive(!0)):e===f.INACTIVE&&(i="Deactivating",this._mode&&this._mode.setActive(!1)),i&&this.dispatchEvent({type:i,providers:t}),this.state=e,this.onStateChange(e)},setMode:function(e){this._mode=e},onStateChange:function(e){e===f.INACTIVE?(this._removeTextViewListeners(),this._filterText="",this._initialCaretOffset=-1,this._computedProposals=null):e===f.ACTIVE&&(this._filterText="",this._addTextViewListeners(),this.computeProposals())},computeProposals:function(){var e=this.textView.getCaretOffset(),t=this.textView.getSelection(),i=Math.min(t.start,t.end);this._initialCaretOffset=Math.min(e,i),this._computedProposals=null,this._computeProposals(this._initialCaretOffset).then(function(e){if(this.isActive()){var t=this._flatten(e);t&&Array.isArray(t)&&0<t.length&&(this._computedProposals=e),this.dispatchEvent({type:"ProposalsComputed",data:{proposals:t},autoApply:!this._autoTriggered}),this._computedProposals&&this._filterText&&this.filterProposals(!0)}}.bind(this))},getPrefixStart:function(e,t){for(var i=t;i>0&&/[A-Za-z0-9_]/.test(e.getText(i-1,i));)i--;return i},handleError:function(e){"undefined"!=typeof console&&(console.log("Error retrieving content assist proposals"),console.log(e&&e.stack))},initialize:function(){this._providers.forEach(function(e){var t=e.provider;"function"==typeof t.initialize&&t.initialize()})},_computeProposals:function(t){var i=this._providers,n=this.textView,s=n.getSelection(),a=n.getModel(),l=t;a.getBaseModel&&(l=a.mapOffset(l),s.start=a.mapOffset(s.start),s.end=a.mapOffset(s.end),a=a.getBaseModel());for(var c=a.getLine(a.getLineAtOffset(l)),d=0;d<c.length&&/\s/.test(c.charAt(d));)d++;var h=c.substring(0,d),u=n.getOptions("tabSize","expandTab"),p=u.expandTab?new Array(u.tabSize+1).join(" "):"	",f={line:c,offset:l,prefix:a.getText(this.getPrefixStart(a,l),l),selection:s,delimiter:a.getLineDelimiter(),tab:p,indentation:h},g=this,m=i.map(function(e){var t,i=e.provider;try{var n,s;if(n=i.computeContentAssist){var c=g.editorContextProvider,d=c.getEditorContext();f=r.mixin(f,c.getOptions()),s=n.apply(i,[d,f])}else(n=i.getProposals||i.computeProposals)&&(s=n.apply(i,[a.getText(),l,f]));t=g.progress?g.progress.progress(s,"Generating content assist proposal"):s}catch(h){return(new o).reject(h)}return o.when(t)}),v=o.all(m,this.handleError);return this.pageMessage&&(v=o.when(v,function(t){g.pageMessage.close();var i=!1;if(t&&t.length>0)for(var n=0;n<t.length;n++)if(Array.isArray(t[n])&&t[n].length>0){i=!0;break}return i||g.pageMessage.setErrorMessage(e.noProposals),t}),g.pageMessage.showWhile(v,e.computingProposals)),v},filterProposals:function(e){if(this._computedProposals&&(this._latestModelChangingEvent||e)){var t=this.textView.getModel();t.getBaseModel&&(t=t.getBaseModel());var i=this.getPrefixStart(t,this._initialCaretOffset),n=this.textView.getText(i,this._initialCaretOffset),o=n,r=[];this._computedProposals.forEach(function(e){if(e&&Array.isArray(e)){var t=e.filter(function(e){if(!e)return!1;if(o="string"==typeof e.prefix?e.prefix:n,g[e.style]===g.hr||g[e.style]===g.noemphasis_title)return!0;var t="";if(e.overwrite){if(e.name)t=e.name;else{if(!e.proposal)return!1;t=e.proposal}return 0===t.indexOf(o+this._filterText)}if(e.name||e.proposal){var i=!1;return e.name&&(i=0===e.name.indexOf(o+this._filterText)),!i&&e.proposal&&(i=0===e.proposal.indexOf(this._filterText)),i}return"string"==typeof e?0===e.indexOf(this._filterText):!1},this);t.length>0&&r.push(t)}},this);var s=[];r&&(r=this._removeExtraUnselectableElements(r),s=this._flatten(r)),this.dispatchEvent({type:"ProposalsComputed",data:{proposals:s},autoApply:!1})}},_removeExtraUnselectableElements:function(e){var t=e.map(function(e){var t=e.filter(function(t,i){var n=!0;if(g[t.style]===g.hr)0===i||e.length-1===i?n=!1:g.hr===g[e[i-1].style]&&(n=!1);else if(g[t.style]===g.noemphasis_title){var o=e[i+1];o?g[o.style]===g.noemphasis_title&&(n=!1):n=!1}return n});return t});return t},setEditorContextProvider:function(e){this.editorContextProvider=e},_generateProviderId:function(){return this._idcount?this._idcount++:this._idcount=0,"ContentAssistGeneratedID_"+this._idcount},setAutoTriggerEnabled:function(e){this._autoTriggerEnabled=e,this._updateAutoTriggerListenerState()},setProviders:function(e){var t=this;this.setProviderInfoArray(e.map(function(e){return e.id?e:{provider:e,id:t._generateProviderId()}}))},setProviderInfoArray:function(e){this.clearProviders(),this._providers=e,this._charTriggersInstalled=e.some(function(e){return e.charTriggers}),this._updateAutoTriggerListenerState()},getProviders:function(){return this._providers.slice()},clearProviders:function(){this._providers=[],this._charTriggersInstalled=!1,this._updateAutoTriggerListenerState()},setProgress:function(e){this.progress=e},setStyleAccessor:function(e){this._styleAccessor=e},_flatten:function(e){return e.reduce(function(e,t){var i=e,n=null;if(t&&Array.isArray(t)&&(n=t.filter(function(e){return e})),n&&Array.isArray(n)&&n.length>0){var o=n,r=e,s=n[0].style;if(s&&g[s]&&0===g[s].indexOf(g.noemphasis)&&(o=e,r=n),o.length>0){var a=o[o.length-1].style;a&&g.hr!==g[a]&&(o=o.concat({proposal:"",name:"",description:"---------------------------------",style:"hr",unselectable:!0}))}i=o.concat(r)}return i},[])},_triggerListener:function(){var e=this.textView.getCaretOffset(),t=null,i=[];if(this._charTriggersInstalled){var n=this.textView.getText(e-1,e);this._providers.forEach(function(o){var r=o.charTriggers;if(r&&r.test(n)){var s=!1,a=o.excludedStyles;this._styleAccessor&&a&&(t||(t=this._styleAccessor.getStyles(e-1)),s=t.some(function(e){return a.test(e.style)})),s||i.push(o)}},this),i.length>0&&this.activate(i,!0)}},_updateAutoTriggerListenerState:function(){this._boundTriggerListener||(this._boundTriggerListener=this._triggerListener.bind(this)),this._triggerListenerInstalled?this._autoTriggerEnabled&&this._charTriggersInstalled||(this.textView.removeEventListener("Modify",this._boundTriggerListener),this._triggerListenerInstalled=!1):this._autoTriggerEnabled&&this._charTriggersInstalled&&(this.textView.addEventListener("Modify",this._boundTriggerListener),this._triggerListenerInstalled=!0)},_addTextViewListeners:function(){this._textViewListenersAdded||(this.textView.addEventListener("ModelChanging",this._textViewListeners.onModelChanging),this.textView.addEventListener("Scroll",this._textViewListeners.onScroll),this.textView.addEventListener("Selection",this._textViewListeners.onSelection),this._textViewListenersAdded=!0)},_removeTextViewListeners:function(){this._textViewListenersAdded&&(this._latestModelChangingEvent=null,this.textView.removeEventListener("ModelChanging",this._textViewListeners.onModelChanging),this.textView.removeEventListener("Scroll",this._textViewListeners.onScroll),this.textView.removeEventListener("Selection",this._textViewListeners.onSelection),this._textViewListenersAdded=!1)},_updateFilterText:function(e){var t=e.removedCharCount;if(t){var i=this._filterText.length-t;this._filterText=this._filterText.substring(0,i)}var n=e.text;n&&(this._filterText=this._filterText.concat(n))}},n.EventTarget.addMixin(h.prototype),u.prototype=new i.KeyMode,r.mixin(u.prototype,{createKeyBindings:function(){var e=t.KeyBinding,i=[];return i.push({actionID:"contentAssistApply",keyBinding:new e(13)}),i.push({actionID:"contentAssistCancel",keyBinding:new e(27)}),i.push({actionID:"contentAssistNextProposal",keyBinding:new e(40)}),i.push({actionID:"contentAssistPreviousProposal",keyBinding:new e(38)}),i.push({actionID:"contentAssistNextPage",keyBinding:new e(34)}),i.push({actionID:"contentAssistPreviousPage",keyBinding:new e(33)}),i.push({actionID:"contentAssistHome",keyBinding:new e(c.KEY.HOME)}),i.push({actionID:"contentAssistEnd",keyBinding:new e(c.KEY.END)}),i.push({actionID:"contentAssistTab",keyBinding:new e(9)}),i},cancel:function(){this.getContentAssist().deactivate()},getContentAssist:function(){return this.contentAssist},getProposals:function(){return this.proposals},isActive:function(){return this.getContentAssist().isActive()},setActive:function(e){e?this.contentAssist.textView.addKeyMode(this):this.contentAssist.textView.removeKeyMode(this)},lineUp:function(e,t){return this.selectNew(e,t,!1)},lineDown:function(e,t){return this.selectNew(e,t,!0)},selectNew:function(e,t,i){var n=e;if(i){if(void 0===n&&(n=this.selectedIndex+1),n>=this.proposals.length){if(t)return!0;n=0}}else if(void 0===n&&(n=this.selectedIndex-1),0>n){if(t)return!0;n=this.proposals.length-1}for(var o=n;this.proposals[n]&&this.proposals[n].unselectable;){if(i){if(n++,n>=this.proposals.length){if(t)return!0;n=0}}else if(n--,0>n){if(t)return!0;n=this.proposals.length-1}if(n===o){n=-1;break}}return this.selectedIndex=n,this.widget&&this.widget.selectNode(n),this._showTooltip(!0),!0},_showTooltip:function(e,t){var i=s.Tooltip.getTooltip(this.contentAssist.textView),n=this,o={getTooltipInfo:function(){var e=n.widget.parentNode.getBoundingClientRect(),t={width:350,height:e.height,top:e.top};e.left+e.width>=document.documentElement.clientWidth?(t.left=e.left-t.width,t.left-=10):(t.left=e.left+e.width,t.left+=10);var i={context:{proposal:n.proposals[n.selectedIndex]},anchorArea:e,tooltipArea:t};return i}};e?i.update(o,t):i.show(o,!0,!1)},_hideTooltip:function(){var e=s.Tooltip.getTooltip(this.contentAssist.textView);e.hide(!0)},pageUp:function(){if(this.widget){var e=this.widget.getTopIndex();return e===this.selectedIndex&&(this.widget.scrollIndex(e,!1),e=this.widget.getTopIndex()),0===e?this.lineDown(e,!0):this.lineUp(e,!0)}return this.lineUp()},pageDown:function(){if(this.widget){var e=this.widget.getBottomIndex();return e===this.selectedIndex&&(this.widget.scrollIndex(e,!0),e=this.widget.getBottomIndex()),this.lineDown(e,!0)}return this.lineDown()},enter:function(){var e=this.proposals[this.selectedIndex]||null;return this.contentAssist.apply(e)},tab:function(){return this.widget?(this.widget.parentNode.focus(),!0):!1}}),p.prototype={onClick:function(e){e||(e=window.event),this.contentAssist.apply(this.getProposal(e.target||e.srcElement)),this.textView.focus()},onScroll:function(){this.previousCloneNode&&!this.preserveCloneThroughScroll&&(this._removeCloneNode(),this.previousSelectedNode.classList.add(g.selected)),this.preserveCloneThroughScroll=!1},createDiv:function(e,t,i){var n=t.ownerDocument,o=l.createElement(n,"div");o.id="contentoption"+i,o.setAttribute("role","option"),o.className=g[e.style]?g[e.style]:g.dfault;var r;"hr"===e.style?r=l.createElement(n,"hr"):(r=this._createDisplayNode(e,i),o.contentAssistProposalIndex=i),o.appendChild(r),t.appendChild(o)},createAccessible:function(){var e=this._contentAssistMode,t=this;a.addEventListener(this.parentNode,"keydown",function(i){return i||(i=window.event),i.preventDefault&&i.preventDefault(),i.keyCode===c.KEY.ESCAPE?e.cancel():i.keyCode===c.KEY.UP?e.lineUp():i.keyCode===c.KEY.DOWN?e.lineDown():i.keyCode===c.KEY.ENTER?e.enter():i.keyCode===c.KEY.PAGEDOWN?e.pageDown():i.keyCode===c.KEY.PAGEUP?e.pageUp():i.keyCode===c.KEY.HOME?(t.scrollIndex(0,!0),e.lineDown(0)):i.keyCode===c.KEY.END?e.lineUp(e.getProposals().length-1):!1})},_createDisplayNode:function(e,t){var i=document.createElement("span");if(!e)return i;if("string"==typeof e){var n=this._createNameNode(e);return n.contentAssistProposalIndex=t,n}var o,r;if(e.name&&"string"==typeof e.name)o=this._createNameNode(e.name);else if(e.description&&"string"==typeof e.description)o=this._createNameNode(e.description),r=!0;else{if(!e.proposal||"string"!=typeof e.proposal)return i;o=this._createNameNode(e.proposal)}var s,a=this._createTagsNode(e.tags);return!r&&e.description&&"string"==typeof e.description&&(s=document.createTextNode(e.description)),a&&i.appendChild(a),i.appendChild(o),s&&i.appendChild(s),o.contentAssistProposalIndex=t,i.contentAssistProposalIndex=t,i},_stopResizeTimer:function(){this._resizeTimer&&(window.clearInterval(this._resizeTimer),this._resizeTimer=null)},_startResizeTimer:function(){this._stopResizeTimer(),this._cachedResizeBound=this.parentNode.getBoundingClientRect(),this._resizeTimer=window.setInterval(function(){if(this._contentAssistMode){var e=this.parentNode.getBoundingClientRect();if(e.left===this._cachedResizeBound.left&&e.top===this._cachedResizeBound.top&&e.width===this._cachedResizeBound.width&&e.height===this._cachedResizeBound.height)return;this._cachedResizeBound=e,this._contentAssistMode._showTooltip(!0,!0)}}.bind(this),100)},_createNameNode:function(e){var t=document.createElement("span");return t.classList.add("proposal-name"),t.appendChild(document.createTextNode(e)),t},_createTagsNode:function(e){var t=null;if(e&&e.constructor===Array&&e.length>0){t=document.createElement("span");for(var i=0;i<e.length;i++){var n=e[i];if(n.content||n.cssClass){var o=document.createElement("span");o.classList.add(n.cssClass?n.cssClass:"proposalTag"),n.content&&(o.textContent=n.content),t.appendChild(o)}}}return t},getProposal:function(e){var t=null,i=e.contentAssistProposalIndex;return void 0!==i&&(t=this._contentAssistMode.getProposals()[i]||null),t},getTopIndex:function(){for(var e=this.parentNode.childNodes,t=0;t<e.length;t++){var i=e[t];if(i.offsetTop>=this.parentNode.scrollTop)return t}return 0},getBottomIndex:function(){for(var e=this.parentNode.childNodes,t=0;t<e.length;t++){var i=e[t];if(i.offsetTop+i.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight)return Math.max(0,t-1)}return e.length-1},scrollIndex:function(e,t){var i=this.parentNode.childNodes[e];i&&(i.scrollIntoView(t),this.preserveCloneThroughScroll=!0)},selectNode:function(e){var t=null;if(this._hideTimeout&&(window.clearTimeout(this._hideTimeout),this._hideTimeout=null),this._fadeTimer&&(window.clearTimeout(this._fadeTimer),this._fadeTimer=null),this.previousSelectedNode&&(this.previousSelectedNode.classList.remove(g.selected),this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode()),-1!==e&&(t=this.parentNode.childNodes[e])){t.classList.add(g.selected),this.parentNode.setAttribute("aria-activedescendant",t.id),t.focus(),t.offsetTop<this.parentNode.scrollTop?(t.scrollIntoView(!0),this.preserveCloneThroughScroll=!0):t.offsetTop+t.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight&&(t.scrollIntoView(!1),this.preserveCloneThroughScroll=!0);var i=t.firstChild||t,n=i.getBoundingClientRect(),o=this.parentNode.clientWidth?this.parentNode.clientWidth:this.parentNode.getBoundingClientRect(),r=window.getComputedStyle(this.parentNode),s=window.getComputedStyle(t),a=parseInt(r.paddingLeft)+parseInt(r.paddingRight)+parseInt(s.paddingLeft)+parseInt(s.paddingRight);if(n.width>=o-a){var l=parseInt(r.top),c=t.cloneNode(!0);c.classList.add("cloneProposal"),c.style.top=l+t.offsetTop-this.parentNode.scrollTop+"px",c.style.left=r.left,c.setAttribute("id",c.id+"_clone");var d=document.documentElement.clientWidth,h=n.left+n.width-parseInt(d);if(h>0){var u=parseInt(r.left)-h;0>u&&(u=0),c.style.left=u+"px"}var p=document.createElement("div");p.id="clone_contentassist",p.classList.add("contentassist"),p.classList.add("cloneWrapper"),p.appendChild(c),p.onclick=this.parentNode.onclick,this.parentNode.parentNode.insertBefore(p,this.parentNode);var f=function(e){if(e.contentAssistProposalIndex=t.contentAssistProposalIndex,e.hasChildNodes())for(var i=0;i<e.childNodes.length;i++)f(e.childNodes[i])};f(p);var m=this;this._hideTimeout=window.setTimeout(function(){m._hideTimeout=null,t.classList.add(g.selected);var e=1;m._fadeTimer=window.setInterval(function(){!m.previousCloneNode||.01>=e?(m._removeCloneNode(),window.clearInterval(m._fadeTimer),m._fadeTimer=null):(p.style.opacity=e,p.style.filter="alpha(opacity="+100*e+")",e-=.1*e)},50)},1500),t.classList.remove(g.selected),this.previousCloneNode=p}}this.previousSelectedNode=t},setContentAssistMode:function(e){this._contentAssistMode=e},show:function(){var e=this._contentAssistMode.getProposals();if(0===e.length)this.hide();else{this.parentNode.innerHTML="";for(var t=0;t<e.length;t++)this.createDiv(e[t],this.parentNode,t);this.position(),this.parentNode.onclick=this.onClick.bind(this),this.isShowing=!0,this._contentAssistMode._showTooltip(!1),this._useResizeTimer?this._startResizeTimer():this._mutationObserver&&this._mutationObserver.observe(this.parentNode,{attributes:!0}),this.textViewListenerAdded||(this.textView.addEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!0)}},hide:function(){this.parentNode.ownerDocument.activeElement===this.parentNode&&this.textView.focus(),this.parentNode.style.display="none",this.parentNode.onclick=null,this.isShowing=!1,this._useResizeTimer?this._stopResizeTimer():this._mutationObserver&&this._mutationObserver.disconnect(),this._contentAssistMode._hideTooltip(),this.textViewListenerAdded&&(this.textView.removeEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!1),this.previousSelectedNode&&(this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode())},position:function(){var e,t=this.contentAssist,i=this.textView;if(void 0!==t.offset){e=t.offset;var n=i.getModel();n.getBaseModel&&(e=n.mapOffset(e,!0))}else e=this.textView.getCaretOffset();var o=i.getLocationAtOffset(e);o.y+=i.getLineHeight(),this.textView.convert(o,"document","page"),this.parentNode.style.position="fixed",this.parentNode.style.left=o.x+"px",this.parentNode.style.top=o.y+"px",this.parentNode.style.display="block",this.parentNode.scrollTop=0;var r=this.parentNode.ownerDocument,s=r.documentElement.clientWidth,a=r.documentElement.clientHeight,l=a-o.y;if(this.parentNode.offsetHeight>l){var c=o.y-this.textView.getLineHeight();this.parentNode.offsetHeight>c?l>c?this.parentNode.style.maxHeight=l+"px":(this.parentNode.style.maxHeight=c+"px",this.parentNode.style.top="0"):(this.parentNode.style.top=o.y-this.parentNode.offsetHeight-this.textView.getLineHeight()+"px",this.parentNode.style.maxHeight=c+"px")}else this.parentNode.style.maxHeight=l+"px";if(o.x+this.parentNode.offsetWidth>s){var d=s-this.parentNode.offsetWidth;0>d&&(d=0),this.parentNode.style.left=d+"px",this.parentNode.style.maxWidth=s-d}else this.parentNode.style.maxWidth=s+o.x+"px"},_removeCloneNode:function(){this.parentNode.parentNode.contains(this.previousCloneNode)&&this.parentNode.parentNode.removeChild(this.previousCloneNode),this.previousCloneNode=null}},{ContentAssist:h,ContentAssistMode:u,ContentAssistWidget:p}}),define("orion/editor/emacs",["i18n!orion/editor/nls/messages","orion/editor/keyModes","orion/keyBinding","orion/util"],function(e,t,i,n){function o(e){t.KeyMode.call(this,e)}return o.prototype=new t.KeyMode,o.prototype.createKeyBindings=function(){var e=[];e.push({actionID:"emacs-beginning-of-line",keyBinding:this._createStroke("a",!n.isMac,!1,!1,n.isMac)}),e.push({actionID:"emacs-end-of-line",keyBinding:this._createStroke("e",!n.isMac,!1,!1,n.isMac)}),e.push({actionID:"emacs-forward-char",keyBinding:this._createStroke("f",!n.isMac,!1,!1,n.isMac)}),e.push({actionID:"emacs-backward-char",keyBinding:this._createStroke("b",!n.isMac,!1,!1,n.isMac)}),e.push({actionID:"emacs-forward-word",keyBinding:this._createStroke("f",!1,!1,!0)}),e.push({actionID:"emacs-backward-word",keyBinding:this._createStroke("b",!1,!1,!0)}),e.push({actionID:"emacs-next-line",keyBinding:this._createStroke("n",!n.isMac,!1,!1,n.isMac)}),e.push({actionID:"emacs-previous-line",keyBinding:this._createStroke("p",!n.isMac,!1,!1,n.isMac)}),e.push({actionID:"emacs-beginning-of-buffer",keyBinding:this._createStroke(188,!1,!0,!0)}),e.push({actionID:"emacs-end-of-buffer",keyBinding:this._createStroke(190,!1,!0,!0)}),e.push({actionID:"emacs-delete-backward-char",keyBinding:this._createStroke(46,!n.isMac,!1,!1,n.isMac)}),e.push({actionID:"emacs-delete-char",keyBinding:this._createStroke("d",!n.isMac,!1,!1,n.isMac)}),e.push({actionID:"emacs-kill-line",keyBinding:this._createStroke("k",!n.isMac,!1,!1,n.isMac)}),e.push({actionID:"emacs-kill-word",keyBinding:this._createStroke("d",!1,!1,!0)}),e.push({actionID:"emacs-backward-kill-word",keyBinding:this._createStroke(46,!1,!1,!0)}),e.push({actionID:"undo",keyBinding:this._createSequence([this._createStroke("x",!0),this._createStroke("u")])}),e.push({actionID:"redo",keyBinding:this._createSequence([this._createStroke("x",!0),this._createStroke("r")])}),e.push({actionID:"emacs-scroll-up",keyBinding:this._createStroke("v",!n.isMac,!1,!1,n.isMac)}),e.push({actionID:"emacs-scroll-down",keyBinding:this._createStroke("v",!1,!1,!0)}),e.push({actionID:"emacs-set-mark-command",keyBinding:this._createStroke(" ",!n.isMac,!1,!1,n.isMac)}),e.push({actionID:"emacs-reset-mark-command",keyBinding:this._createStroke("g",!n.isMac,!1,!1,n.isMac)}),e.push({actionID:"emacs-exchange-point-and-mark",keyBinding:this._createSequence([this._createStroke("x",!n.isMac,!1,!1,n.isMac),this._createStroke("x",!n.isMac,!1,!1,n.isMac)])});
for(var t=0;9>=t;t++)e.push({actionID:"emacs-digit-argument-"+t,keyBinding:this._createStroke(48+t,!n.isMac,!1,!1,n.isMac)}),e.push({actionID:"emacs-digit-argument-"+t,keyBinding:this._createStroke(48+t,!1,!1,!0)}),e.push({actionID:"emacs-digit-argument-"+t,keyBinding:this._createStroke(48+t,!n.isMac,!1,!0,n.isMac)});return e.push({actionID:"emacs-negative-argument",keyBinding:this._createStroke(189,!n.isMac,!1,!1,n.isMac)}),e.push({actionID:"emacs-negative-argument",keyBinding:this._createStroke(189,!1,!1,!0)}),e.push({actionID:"emacs-negative-argument",keyBinding:this._createStroke(189,!n.isMac,!1,!0,n.isMac)}),e.push({actionID:"emacs-uppercase",keyBinding:this._createStroke("u",!1,!1,!0)}),e.push({actionID:"emacs-lowercase",keyBinding:this._createStroke("l",!1,!1,!0)}),e.push({actionID:"emacs-capitalize",keyBinding:this._createStroke("c",!1,!1,!0)}),e.push({actionID:"contentAssist",keyBinding:this._createStroke(191,!1,!1,!0)}),e.push({actionID:"find",keyBinding:this._createStroke("r",!1,!1,!0)}),e.push({actionID:"incrementalFind",keyBinding:this._createStroke("s",!0)}),e.push({actionID:"incrementalFindReverse",keyBinding:this._createStroke("r",!0)}),e.push({actionID:"save",keyBinding:this._createSequence([this._createStroke("x",!n.isMac,!1,!1,n.isMac),this._createStroke("s",!n.isMac,!1,!1,n.isMac)])}),this._createActions(this.getView()),e},o.prototype._createStroke=function(t,n,o,r,s){var a=new i.KeyStroke(t,n,o,r,s);return a.scopeName=e.emacs,a},o.prototype._createSequence=function(t){var n=new i.KeySequence(t);return n.scopeName=e.emacs,n},o.prototype._getData=function(){var e={count:(this._argument||1)*(this._sign||1)};return this._argument=0,this._sign=1,e},o.prototype._moveCursor=function(e){var t=this._getData();this._marker&&(t.select=!0);var i=this.getView();return i.invokeAction(e,!1,t)},o.prototype._digitArgument=function(e){return this._argument=10*(this._argument||0)+e,!0},o.prototype._negativeArgument=function(){return this._sign=-1*(this._sign||1),!0},o.prototype._createActions=function(t){var i=this;t.setAction("emacs-beginning-of-line",function(){return i._moveCursor("lineStart")},{name:e.lineStart}),t.setAction("emacs-end-of-line",function(){return i._moveCursor("lineEnd")},{name:e.lineEnd}),t.setAction("emacs-forward-char",function(){return i._moveCursor("charNext")},{name:e.charNext}),t.setAction("emacs-backward-char",function(){return i._moveCursor("charPrevious")},{name:e.charPrevious}),t.setAction("emacs-forward-word",function(){return i._moveCursor("wordNext")},{name:e.wordNext}),t.setAction("emacs-backward-word",function(){return i._moveCursor("wordPrevious")},{name:e.wordPrevious}),t.setAction("emacs-next-line",function(){return i._moveCursor("lineDown")},{name:e.lineDown}),t.setAction("emacs-previous-line",function(){return i._moveCursor("lineUp")},{name:e.lineUp}),t.setAction("emacs-beginning-of-buffer",function(){return i._moveCursor("textStart")},{name:e.textStart}),t.setAction("emacs-end-of-buffer",function(){return i._moveCursor("textEnd")},{name:e.textEnd}),t.setAction("emacs-delete-backward-char",function(){return t.invokeAction("deletePrevious")},{name:e.deletePrevious}),t.setAction("emacs-delete-char",function(){return t.invokeAction("deletePrevious")},{name:e.deletePrevious}),t.setAction("emacs-kill-line",function(){return t.invokeAction("deleteLineEnd")},{name:e.deleteLineEnd}),t.setAction("emacs-kill-word",function(){return t.invokeAction("deleteWordNext")},{name:e.deleteWordNext}),t.setAction("emacs-backward-kill-word",function(){return t.invokeAction("deleteWordPrevious")},{name:e.deleteWordPrevious}),t.setAction("emacs-scroll-up",function(){return i._moveCursor("pageDown")},{name:e.pageDown}),t.setAction("emacs-scroll-down",function(){return i._moveCursor("pageUp")},{name:e.pageUp}),t.setAction("emacs-set-mark-command",function(){var e=t.getCaretOffset();return t.setCaretOffset(e),i._marker=e,!0},{name:e.setMarkCommand}),t.setAction("emacs-exchange-point-and-mark",function(){if(void 0!==i._marker){var e=t.getCaretOffset(),n=t.getSelection();if(n.end===e){var o=n.start;n.start=n.end,n.end=o}i._marker=e,t.setSelection(n.start,n.end)}return!0},{name:e.exchangeMarkPoint}),t.setAction("emacs-reset-mark-command",function(){var e=t.getCaretOffset();return t.setCaretOffset(e),i._marker=void 0,!0},{name:e.clearMark}),t.setAction("emacs-digit-argument-0",function(){return i._digitArgument(0)},{name:n.formatMessage(e.digitArgument,"0")}),t.setAction("emacs-digit-argument-1",function(){return i._digitArgument(1)},{name:n.formatMessage(e.digitArgument,"1")}),t.setAction("emacs-digit-argument-2",function(){return i._digitArgument(2)},{name:n.formatMessage(e.digitArgument,"2")}),t.setAction("emacs-digit-argument-3",function(){return i._digitArgument(3)},{name:n.formatMessage(e.digitArgument,"3")}),t.setAction("emacs-digit-argument-4",function(){return i._digitArgument(4)},{name:n.formatMessage(e.digitArgument,"4")}),t.setAction("emacs-digit-argument-5",function(){return i._digitArgument(5)},{name:n.formatMessage(e.digitArgument,"5")}),t.setAction("emacs-digit-argument-6",function(){return i._digitArgument(6)},{name:n.formatMessage(e.digitArgument,"6")}),t.setAction("emacs-digit-argument-7",function(){return i._digitArgument(7)},{name:n.formatMessage(e.digitArgument,"7")}),t.setAction("emacs-digit-argument-8",function(){return i._digitArgument(8)},{name:n.formatMessage(e.digitArgument,"8")}),t.setAction("emacs-digit-argument-9",function(){return i._digitArgument(9)},{name:n.formatMessage(e.digitArgument,"9")}),t.setAction("emacs-negative-argument",function(){return i._negativeArgument()},{name:e.negativeArgument}),t.setAction("emacs-uppercase",function(){var e=i._getData();return e.unit="word",t.invokeAction("uppercase",!1,e)},{name:e.uppercase}),t.setAction("emacs-lowercase",function(){var e=i._getData();return e.unit="word",t.invokeAction("lowercase",!1,e)},{name:e.lowercase}),t.setAction("emacs-capitalize",function(){var e=i._getData();return e.unit="word",t.invokeAction("capitalize",!1,e)},{name:e.capitalize})},{EmacsMode:o}}),define("orion/editor/vi",["i18n!orion/editor/nls/messages","orion/editor/keyModes","orion/keyBinding","orion/util"],function(e,t,i,n){function o(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}function r(t,n,o,r,s,a,l){var c=new i.KeyStroke(t,n,o,r,s,a);return c.scopeName=l||e.vi,c}function s(t,n){var o=new i.KeySequence(t);return o.scopeName=n||e.vi,o}function a(e,i,n){this.key=i,this.msg=n,this.number="",t.KeyMode.call(this,e),e&&this._createActions(e)}function l(e){var i=e.getView();this.viMode=e,t.KeyMode.call(this,i),this._createActions(i)}function c(e,t,i,n){this.viMode=e,this.nextMode=t,a.call(this,e.getView(),i,n)}function d(e){var i=e.getView();t.KeyMode.call(this,i),this.viMode=e,this._createActions(i)}function h(t,i){a.call(this,t,"",e.vimove),this.insertMode=new d(this),this.changeMode=new c(this,this.insertMode,"c",e.vichange),this.deleteMode=new c(this,this,"d",e.videlete),this.yankMode=new c(this,this,"y",e.viyank),this.statusReporter=i}var u,p;return a.prototype=new t.KeyMode,o(a.prototype,{_msg:function(t){return{name:n.formatMessage(e[t],this.msg)}},createKeyBindings:function(){var e=[],t=this.key;t=t?"-"+t+"-":"-";for(var i=0;9>=i;i++)e.push({actionID:"vi"+t+i,keyBinding:r(i+"",!1,!1,!1,!1,"keypress"),predefined:!0});return e.push({actionID:"vi"+t+"Left",keyBinding:r("h",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"Left",keyBinding:r("h",!0,!1,!1,!1)}),e.push({actionID:"vi"+t+"Left",keyBinding:r(8)}),e.push({actionID:"vi"+t+"Left",keyBinding:r(37)}),e.push({actionID:"vi"+t+"Down",keyBinding:r("j",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"Down",keyBinding:r(40)}),e.push({actionID:"vi"+t+"Up",keyBinding:r("k",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"Up",keyBinding:r(38)}),e.push({actionID:"vi"+t+"Right",keyBinding:r("l",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"Right",keyBinding:r(39)}),e.push({actionID:"vi"+t+"Right",keyBinding:r(32)}),e.push({actionID:"vi"+t+"w",keyBinding:r("w",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"b",keyBinding:r("b",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"W",keyBinding:r("W",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"B",keyBinding:r("B",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"e",keyBinding:r("e",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"E",keyBinding:r("E",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"$",keyBinding:r("$",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"^_",keyBinding:r("^",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"^_",keyBinding:r("_",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"+",keyBinding:r("+",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"+",keyBinding:r(13)}),e.push({actionID:"vi"+t+"-",keyBinding:r("-",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"|",keyBinding:r("|",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"H",keyBinding:r("H",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"M",keyBinding:r("M",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"L",keyBinding:r("L",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"/",keyBinding:r("/",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"?",keyBinding:r("?",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"n",keyBinding:r("n",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"N",keyBinding:r("N",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"f",keyBinding:r("f",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"F",keyBinding:r("F",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"t",keyBinding:r("t",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"T",keyBinding:r("T",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+",",keyBinding:r(",",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+";",keyBinding:r(";",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"G",keyBinding:r("G",!1,!1,!1,!1,"keypress")}),e},_createActions:function(e){function t(t){for(var i=e.getModel(),n=i.getLine(t),o=0,r=n.charCodeAt(o);32===r||9===r;)o++,r=n.charCodeAt(o);return o}function i(e,t){e&&o.getView().setCaretOffset(e.start),t.editDone&&t.editDone()}var n=this.key;n=n?"-"+n+"-":"-";var o=this;e.setAction("vi"+n+"0",function(){return o._storeNumber(0)}),e.setAction("vi"+n+"1",function(){return o._storeNumber(1)}),e.setAction("vi"+n+"2",function(){return o._storeNumber(2)}),e.setAction("vi"+n+"3",function(){return o._storeNumber(3)}),e.setAction("vi"+n+"4",function(){return o._storeNumber(4)}),e.setAction("vi"+n+"5",function(){return o._storeNumber(5)}),e.setAction("vi"+n+"6",function(){return o._storeNumber(6)}),e.setAction("vi"+n+"7",function(){return o._storeNumber(7)}),e.setAction("vi"+n+"8",function(){return o._storeNumber(8)}),e.setAction("vi"+n+"9",function(){return o._storeNumber(9)}),e.setAction("vi"+n+"Left",function(){return o._invoke("charPrevious",{unit:"character"})},this._msg("viLeft")),e.setAction("vi"+n+"Right",function(){return o._invoke("charNext",{unit:"character"})},this._msg("viRight")),e.setAction("vi"+n+"Up",function(){return o._invoke("lineUp",{editLine:!0})},this._msg("viUp")),e.setAction("vi"+n+"Down",function(){return o._invoke("lineDown",{editLine:!0})},this._msg("viDown")),e.setAction("vi"+n+"w",function(){return o._invoke("wordNext",{unit:"word"})},this._msg("viw")),e.setAction("vi"+n+"b",function(){return o._invoke("wordPrevious",{unit:"word"})},this._msg("vib")),e.setAction("vi"+n+"W",function(){return o._invoke("wordNext",{unit:"wordWS"})},this._msg("viW")),e.setAction("vi"+n+"B",function(){return o._invoke("wordPrevious",{unit:"wordWS"})},this._msg("viB")),e.setAction("vi"+n+"e",function(){return o._invoke("charNext",{unit:"character"}),o._invoke("wordNext",{unit:"wordend"}),o._invoke("charPrevious",{unit:"character"}),!0},this._msg("vie")),e.setAction("vi"+n+"E",function(){return o._invoke("wordNext",{unit:"wordendWS"})},this._msg("viE")),e.setAction("vi"+n+"$",function(){return o._invoke("lineEnd")},this._msg("vi$")),e.setAction("vi"+n+"^_",function(){return o._invoke(function(){var i=e.getModel(),n=e.getCaretOffset(),o=i.getLineAtOffset(n);e.setCaretOffset(i.getLineStart(o)+t(o))})},this._msg("vi^_")),e.setAction("vi"+n+"+",function(){return o._invoke(function(i){var n=e.getModel(),o=e.getCaretOffset(),r=n.getLineCount()-1,s=Math.min(n.getLineAtOffset(o)+i.count,r);e.setCaretOffset(n.getLineStart(s)+t(s))},{editLine:!0})},this._msg("vi+")),e.setAction("vi"+n+"-",function(){return o._invoke(function(i){var n=e.getModel(),o=e.getCaretOffset(),r=Math.max(n.getLineAtOffset(o)-i.count,0);e.setCaretOffset(n.getLineStart(r)+t(r))},{editLine:!0})},this._msg("vi-")),e.setAction("vi"+n+"|",function(){return o._invoke(function(t){var i=e.getModel(),n=e.getCaretOffset(),o=i.getLineAtOffset(n);e.setCaretOffset(Math.min(i.getLineStart(o)+t.count-1,i.getLineEnd(o)))})},this._msg("vi|")),e.setAction("vi"+n+"H",function(){return o._invoke(function(t){var i=e.getModel().getLineStart(e.getTopIndex(!0)+(t.count-1));e.setCaretOffset(i)},{editLine:!0})},this._msg("viH")),e.setAction("vi"+n+"M",function(){return o._invoke(function(){var t=Math.ceil((e.getBottomIndex(!0)-e.getTopIndex(!0))/2)+e.getTopIndex(!0);e.setCaretOffset(e.getModel().getLineStart(t))},{editLine:!0})},this._msg("viM")),e.setAction("vi"+n+"L",function(){return o._invoke(function(t){e.setCaretOffset(e.getModel().getLineStart(e.getBottomIndex(!0)-(t.count-1)))},{editLine:!0})},this._msg("viL")),e.setAction("vi"+n+"/",function(){var e={hideAfterFind:!0,incremental:!1,reverse:!1,findCallback:function(t){o._searchFwd=!0,i(t,e)}};return o._invoke("find",e)},this._msg("vi/")),e.setAction("vi"+n+"?",function(){var e={hideAfterFind:!0,incremental:!1,reverse:!0,findCallback:function(t){o._searchFwd=!1,i(t,e)}};return o._invoke("find",e)},this._msg("vi?")),e.setAction("vi"+n+"n",function(){var t,n=e.getCaretOffset();o._searchFwd?(t="findNext",n++):t="findPrevious";var r={start:n,findCallback:function(e){i(e,r)}};return o._invoke(t,r)},this._msg("vin")),e.setAction("vi"+n+"N",function(){var t,n=e.getCaretOffset();o._searchFwd?t="findPrevious":(t="findNext",n++);var r={start:n,findCallback:function(e){i(e,r)}};return o._invoke(t,r)},this._msg("viN")),e.setAction("vi"+n+"f",function(){var t=e.getModel(),i=e.getCaretOffset();return o._findChar(i,t.getLineEnd(t.getLineAtOffset(i)),!1,0)},this._msg("vif")),e.setAction("vi"+n+"F",function(){var t=e.getModel(),i=e.getCaretOffset();return o._findChar(t.getLineStart(t.getLineAtOffset(i)),i,!0,0)},this._msg("viF")),e.setAction("vi"+n+"t",function(){var t=e.getModel(),i=e.getCaretOffset();return o._findChar(i,t.getLineEnd(t.getLineAtOffset(i)),!1,-1)},this._msg("vit")),e.setAction("vi"+n+"T",function(){var t=e.getModel(),i=e.getCaretOffset();return o._findChar(t.getLineStart(t.getLineAtOffset(i)),i,!0,1)},this._msg("viT")),e.setAction("vi"+n+",",function(){return o._charTempOptions?o._findNextChar(o._charTempOptions.reverse):void 0},this._msg("vi,")),e.setAction("vi"+n+";",function(){return o._charTempOptions?o._findNextChar(!o._charTempOptions.reverse):void 0},this._msg("vi;")),e.setAction("vi"+n+"G",function(){if(""===o.number){var t=e.getModel();t.getBaseModel&&(t=t.getBaseModel()),o.number=t.getLineCount()}return o._invoke(function(t){t=t||{},t.line=t.count,t.editLine=!0,t.callback=function(){t.editDone&&t.editDone()},e.invokeAction("gotoLine",!1,t)})},this._msg("viG"))},_invoke:function(e,t){var i=this.getView();return t=t||{},t.count=this._getCount(),"function"==typeof e?e(t):i.invokeAction(e,!1,t),!0},_getCount:function(){var e=1;return""!==this.number&&(e=this.number>>0),this.number="",e},_findChar:function(e,t,i,n){this._charTempOptions={},this._charTempOptions.start=e,this._charTempOptions.end=t,this._charTempOptions.hideAfterFind=!0,this._charTempOptions.incremental=!1,this._charTempOptions.reverse=i,this._charTempOptions.offset=n;var o=this._charTempOptions,r=this;return this._charTempOptions.findCallback=function(e){e&&r.getView().setCaretOffset(e.start+n),o.editDone&&o.editDone()},this._invoke("find",this._charTempOptions)},_findNextChar:function(e){if(this._charTempOptions){var t=this.getView(),i={};i.hideAfterFind=this._charTempOptions.hideAfterFind,i.incremental=this._charTempOptions.incremental,i.reverse=this._charTempOptions.reverse,i.wrap=!1;var n=i,o=this;i.findCallback=function(e){e&&o.getView().setCaretOffset(e.start+o._charTempOptions.offset),n.editDone&&n.editDone()};var r=t.getModel();return e?(i.start=t.getCaretOffset()+1-this._charTempOptions.offset,i.end=r.getLineEnd(r.getLineAtOffset(i.start)),i.reverse=!1,this._invoke("findNext",i)):(i.start=t.getCaretOffset()-this._charTempOptions.offset,i.end=r.getLineStart(r.getLineAtOffset(i.start)),i.reverse=!0,this._invoke("findPrevious",i))}return!0},_storeNumber:function(e){var t=this;return 0!==e||this.number?(this.number+=e,!0):this._invoke(function(){t.getView().invokeAction("lineStart",!0)})}}),l.prototype=new t.KeyMode,o(l.prototype,{createKeyBindings:function(){var e=[];return e.push({actionID:"vi-:-ESC",keyBinding:r(27),predefined:!0}),e},_createActions:function(e){var t=this;e.setAction("vi-:-ESC",function(){return e.removeKeyMode(t),e.addKeyMode(t.viMode),!0})},match:function(e){var i=t.KeyMode.prototype.match.call(this,e);return i||(i=this.getView().getKeyModes()[0].match(e)),i},storeNumber:function(e){this.number=e}}),c.prototype=new a,o(c.prototype,{createKeyBindings:function(){var e=a.prototype.createKeyBindings.call(this);return e.push({actionID:"vi-"+this.key+"ESC",keyBinding:r(27),predefined:!0}),e.push({actionID:"vi-"+this.key+"-"+this.key,keyBinding:r(this.key,!1,!1,!1,!1,"keypress")}),e},_invoke:function(e,t){t=t||{};var i=this.getView(),n=i.getCaretOffset(),o=n,r=i.getModel(),s=this;return t.editDone=function(){var e=i.getCaretOffset();if(o>e){var a=o;o=e,e=a}t.editLine&&(o=r.getLineStart(r.getLineAtOffset(o)),e=r.getLineEnd(r.getLineAtOffset(e),"c"===s.key?!1:!0)),"y"===s.key?(u=i.getText(o,e),p=t.editLine,i.setCaretOffset(n)):i.setText("",o,e),i.removeKeyMode(s),i.addKeyMode(s.nextMode)},a.prototype._invoke.call(this,e,t),t.editDone(),!0},_getCount:function(){var e=1;""!==this.firstNumber&&(e=this.firstNumber>>0);var t=1;return""!==this.number&&(t=this.number>>0),e*=t,this.number=this.firstNumber="",e},_createActions:function(e){a.prototype._createActions.call(this,e);var t=this;e.setAction("vi-"+t.key+"ESC",function(){return e.removeKeyMode(t),e.addKeyMode(t.viMode),!0}),e.setAction("vi-"+t.key+"-"+t.key,function(){return t._invoke("lineEnd",{editLine:!0})},this._msg("viycd"))},storeNumber:function(e){this.firstNumber=e},_modeAdded:function(){this.secondNumber=""},_modeRemoved:function(){this.command="",this.firstNumber="",this.number=""}}),d.prototype=new t.KeyMode,o(d.prototype,{createKeyBindings:function(){var e=[];return e.push({actionID:"vi-insert-ESC",keyBinding:r(27),predefined:!0}),e},_createActions:function(e){var t=this;e.setAction("vi-insert-ESC",function(){return e.removeKeyMode(t),e.addKeyMode(t.viMode),!0})},match:function(e){var i=t.KeyMode.prototype.match.call(this,e);return i||(i=this.getView().getKeyModes()[0].match(e)),i},storeNumber:function(){}}),h.prototype=new a,o(h.prototype,{createKeyBindings:function(){var e=a.prototype.createKeyBindings.call(this);return e.push({actionID:"vi-ctrl-f",keyBinding:r("f",!0)}),e.push({actionID:"vi-ctrl-b",keyBinding:r("b",!0)}),e.push({actionID:"vi-ctrl-e",keyBinding:r("e",!0)}),e.push({actionID:"vi-ctrl-y",keyBinding:r("y",!0)}),e.push({actionID:"statusLineMode",keyBinding:r(":",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi-a",keyBinding:r("a",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-A",keyBinding:r("A",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-i",keyBinding:r("i",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-I",keyBinding:r("I",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-o",keyBinding:r("o",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-O",keyBinding:r("O",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-R",keyBinding:r("R",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-s",keyBinding:r("s",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-S",keyBinding:r("S",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-p",keyBinding:r("p",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-P",keyBinding:r("P",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-u",keyBinding:r("u",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-c",keyBinding:r("c",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-d",keyBinding:r("d",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-y",keyBinding:r("y",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-~",keyBinding:r("~",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-x",keyBinding:r("x",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-X",keyBinding:r("X",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-C",keyBinding:r("C",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-D",keyBinding:r("D",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-*",keyBinding:r("*",!1,!1,!1,!1,"keypress"),predefined:!0}),e},getKeyBindings:function(e){var i=t.KeyMode.prototype.getKeyBindings.call(this,e);i=i||[];var n,o=this.changeMode.getKeyBindings(e);if(!this.changeMode.isActive())for(n=0;n<o.length;n++)o[n]=s([r("c",!1,!1,!1,!1,"keypress"),o[n]]);if(i=i.concat(o),o=this.deleteMode.getKeyBindings(e),!this.deleteMode.isActive())for(n=0;n<o.length;n++)o[n]=s([r("d",!1,!1,!1,!1,"keypress"),o[n]]);if(i=i.concat(o),o=this.yankMode.getKeyBindings(e),!this.yankMode.isActive())for(n=0;n<o.length;n++)o[n]=s([r("y",!1,!1,!1,!1,"keypress"),o[n]]);return i=i.concat(o)},match:function(e){var i=t.KeyMode.prototype.match.call(this,e);return i||"keypress"!==e.type||(i="noop"),i},_createActions:function(t){a.prototype._createActions.call(this,t);var i=this;t.setAction("vi-ctrl-f",function(){return i._invoke("pageDown")},{name:e.pageDown}),t.setAction("vi-ctrl-b",function(){return i._invoke("pageUp")},{name:e.pageUp}),t.setAction("vi-ctrl-e",function(){return i._invoke("scrollLineDown")},{name:e.scrollLineDown}),t.setAction("vi-ctrl-y",function(){return i._invoke("scrollLineUp")},{name:e.scrollLineUp}),t.setAction("vi-a",function(){return i._toInsertMode("charNext")},{name:e.via}),t.setAction("vi-A",function(){return i._toInsertMode("lineEnd")},{name:e.viA}),t.setAction("vi-i",function(){return i._toInsertMode("noop")},{name:e.vii}),t.setAction("vi-I",function(){return i._toInsertMode("lineStart")},{name:e.viI}),t.setAction("vi-O",function(){return i._invoke("lineUp"),i._invoke("lineEnd"),i._toInsertMode("enter"),!0},{name:e.viO}),t.setAction("vi-o",function(){return i._invoke("lineEnd"),i._toInsertMode("enter"),!0},{name:e.vio}),t.setAction("vi-R",function(){return i._toInsertMode("toggleOverwriteMode")},{name:e.viR}),t.setAction("vi-s",function(){return i._toInsertMode("deleteNext",{unit:"char"})},{name:e.vis}),t.setAction("vi-S",function(){return i._toInsertMode("deleteLines",{unit:"line"})},{name:e.viS}),t.setAction("vi-p",function(){return i._invoke(function(){var e=i.getView(),t=e.getSelection();if(t.start===t.end){var n=e.getModel(),o=e.getCaretOffset();p?t.start=t.end=n.getLineEnd(n.getLineAtOffset(o),!0):(t.start++,t.end++)}e.setText(u,t.start,t.end)})},{name:e.vip}),t.setAction("vi-P",function(){return i._invoke(function(){var e=i.getView(),t=e.getSelection();if(t.start===t.end){var n=e.getModel(),o=e.getCaretOffset();p&&(t.start=t.end=n.getLineStart(n.getLineAtOffset(o)))}e.setText(u,t.start,t.end)})},{name:e.viP}),t.setAction("vi-u",function(){return i._invoke("undo")},{name:e.Undo}),t.setAction("vi-c",function(){return t.removeKeyMode(i),t.addKeyMode(i.changeMode),i.changeMode.storeNumber(i.number),i.number="",!0}),t.setAction("vi-d",function(){return t.removeKeyMode(i),t.addKeyMode(i.deleteMode),i.deleteMode.storeNumber(i.number),i.number="",!0}),t.setAction("vi-y",function(){return t.removeKeyMode(i),t.addKeyMode(i.yankMode),i.yankMode.storeNumber(i.number),i.number="",!0}),t.setAction("vi-~",function(){return i._invoke("reversecase")},{name:e.reversecase}),t.setAction("vi-x",function(){return i._invoke("deleteNext")},{name:e.deleteNext}),t.setAction("vi-X",function(){return i._invoke("deletePrevious")},{name:e.deletePrevious}),t.setAction("vi-C",function(){return i._toInsertMode("deleteLineEnd")},{name:e.viC}),t.setAction("vi-D",function(){return i._invoke("deleteLineEnd")},{name:e.deleteLineEnd}),t.setAction("vi-*",function(){var e=i.getView(),t=e.getCaretOffset(),n=e.getNextOffset(t+1,{count:-1,unit:"word"}),o=e.getNextOffset(n,{count:1,unit:"wordend"}),r=e.getText(n,o);i._searchFwd=!0;var s={hideAfterFind:!0,incremental:!1,reverse:!1,findString:r};return i._invoke("find",s)},{name:e.viStar})},_reportStatus:function(e){this.statusReporter&&this.statusReporter(e)},_toInsertMode:function(e,t){t=t||{};var i=1;""!==this.number&&(i=this.number>>0),t.count=i;var n=this.getView();return this.insertMode.storeNumber(this.number),n.invokeAction(e,!1,t),n.removeKeyMode(this),n.addKeyMode(this.insertMode),this.number="",!0},_modeAdded:function(){this.getView().setOptions({blockCursorVisible:!0})},_modeRemoved:function(){var e=this.getView();e.setOptions({blockCursorVisible:!1}),e.removeKeyMode(this.insertMode),e.removeKeyMode(this.changeMode),e.removeKeyMode(this.deleteMode)}}),{VIMode:h}}),define("orion/editorPreferences",["orion/EventTarget"],function(e){function t(t,n){this._preferences=t,e.attach(this),t.addEventListener("changed",function(e){e.namespace===i&&this.dispatchEvent({type:"Changed"})}.bind(this)),n&&this.addEventListener("Changed",function(e){n(e.preferences)})}var i="/editor/settings",n="editorSettings",o={autoSave:!0,autoSaveVisible:!0,autoSaveLocalVisible:!0,autoSaveTimeout:250,autoSaveTimeoutVisible:!0,themeVisible:!0,themeLocalVisible:!0,fontSizeVisible:!0,fontSizeLocalVisible:!0,autoLoad:!0,autoLoadVisible:!0,saveDiffs:!0,saveDiffsVisible:!0,contentAssistAutoTrigger:!0,contentAssistAutoTriggerVisible:!0,showOccurrences:!0,showOccurrencesVisible:!0,autoPairParentheses:!0,autoPairParenthesesVisible:!0,autoPairBraces:!0,autoPairBracesVisible:!0,autoPairSquareBrackets:!0,autoPairSquareBracketsVisible:!0,autoPairAngleBrackets:!1,autoPairAngleBracketsVisible:!0,autoPairQuotations:!0,autoPairQuotationsVisible:!0,autoCompleteComments:!0,autoCompleteCommentsVisible:!0,smartIndentation:!0,smartIndentationVisible:!0,trimTrailingWhiteSpace:!1,trimTrailingWhiteSpaceVisible:!0,tabSize:4,tabSizeVisible:!0,expandTab:!1,expandTabVisible:!0,scrollAnimation:!0,scrollAnimationVisible:!0,scrollAnimationTimeout:300,scrollAnimationTimeoutVisible:!0,annotationRuler:!0,annotationRulerVisible:!0,lineNumberRuler:!0,lineNumberRulerVisible:!0,foldingRuler:!0,foldingRulerVisible:!0,overviewRuler:!0,overviewRulerVisible:!0,zoomRuler:!1,zoomRulerVisible:!0,zoomRulerLocalVisible:!0,showWhitespaces:!1,showWhitespacesVisible:!0,wordWrap:!1,wordWrapVisible:!0,showMargin:!1,showMarginVisible:!0,marginOffset:80,marginOffsetVisible:!0,keyBindings:"Default",keyBindingsVisible:!0,keyBindingsLocalVisible:!0,diffService:!1,diffServiceVisible:!1};return t.prototype={_initialize:function(e){var t=e[n]||{};for(var i in o)t.hasOwnProperty(i)||(t[i]=o[i]);return t},getPrefs:function(e){this._preferences.get(i).then(function(t){var i=this._initialize(t);"string"==typeof i&&(i=JSON.parse(i)),e(i)}.bind(this))},setPrefs:function(e,t){var o={};o[n]=e,this._preferences.put(i,o).then(function(){e=this._initialize(o),t&&t(e),this.dispatchEvent({type:"Changed",preferences:e})}.bind(this))}},{EditorPreferences:t}}),define("orion/widgets/themes/editor/ThemeData",["orion/editor/textTheme","orion/widgets/themes/ThemeVersion","orion/objects"],function(e,t){function i(){this.styles=[];var e={className:"prospecto",name:"Prospecto",styles:{annotationLine:{currentLine:{backgroundColor:"#EAF2FE"}},annotationRange:{currentBracket:{backgroundColor:"#00FE00"},matchingBracket:{backgroundColor:"#00FE00"},matchingSearch:{backgroundColor:"#c3e1ff",currentSearch:{backgroundColor:"#53d1ff"}},writeOccurrence:{backgroundColor:"#ffff00"}},backgroundColor:"#ffffff",color:"#151515",comment:{color:"#3C802C"},constant:{color:"#9932CC",numeric:{color:"#9932CC",hex:{color:"#9932CC"}}},entity:{name:{color:"#98937B","function":{color:"#67BBB8",fontWeight:"bold"}},other:{"attribute-name":{color:"#5F9EA0"}}},fontFamily:d,fontSize:h,keyword:{control:{color:"#CC4C07",fontWeight:"bold"},operator:{color:"#9F4177",fontWeight:"bold"},other:{documentation:{color:"#7F9FBF",task:{color:"#5595ff"}}}},markup:{bold:{fontWeight:"bold"},heading:{color:"#0000FF"},italic:{fontStyle:"italic"},list:{color:"#CC4C07"},other:{separator:{color:"#00008F"},strikethrough:{textDecoration:"line-through"},table:{color:"#3C802C"}},quote:{color:"#446FBD"},raw:{fontFamily:"monospace",html:{backgroundColor:"#E4F7EF"}},underline:{link:{textDecoration:"underline"}}},meta:{documentation:{annotation:{color:"#7F9FBF"},tag:{color:"#7F7F9F"}},preprocessor:{color:"#A4A4A4"},tag:{color:"#CC4C07",attribute:{color:"#93a2aa"}}},punctuation:{operator:{color:"#D1416F"}},ruler:{annotations:{backgroundColor:"#ffffff"},backgroundColor:"#ffffff",overview:{backgroundColor:"#ffffff"}},rulerLines:{color:"#CCCCCC"},string:{color:"#446FBD",interpolated:{color:"#151515"}},support:{type:{propertyName:{color:"#9F4177"}}},"textviewContent ::-moz-selection":{backgroundColor:"rgba(180,213,255,0.99)"},"textviewContent ::selection":{backgroundColor:"rgba(180,213,255,0.99)"},textviewLeftRuler:{borderColor:"#ffffff"},textviewRightRuler:{borderColor:"#ffffff"},textviewSelection:{backgroundColor:"rgba(180,213,255,0.99)"},textviewSelectionUnfocused:{backgroundColor:"rgba(180,213,255,0.99)"},variable:{language:{color:"#7F0055",fontWeight:"bold"},other:{color:"#E038AD"},parameter:{color:"#D1416F"}}}};this.styles.push(e);var t={className:"darker",name:"Darker",styles:{annotationLine:{currentLine:{backgroundColor:"#171c20"}},annotationRange:{currentBracket:{backgroundColor:"#006E00"},currentSearch:{backgroundColor:"#5d5d5d"},matchingBracket:{backgroundColor:"#006E00"},matchingSearch:{backgroundColor:"#363636",currentSearch:{backgroundColor:"#465e47"}},writeOccurrence:{backgroundColor:"#093f59"}},backgroundColor:"#1a1d1e",color:"#dadada",comment:{block:{color:"#5e7175"},color:"#5e7175",line:{color:"#5e7175"}},constant:{color:"#c8333a",numeric:{color:"#c8333a",hex:{color:"#cd3f45"}}},entity:{name:{color:"#30a7d3","function":{color:"#30a7d3",fontWeight:"normal"}},other:{"attribute-name":{color:"#5F9EA0"}}},fontFamily:d,fontSize:h,keyword:{control:{color:"#e8d075",fontWeight:"normal"},operator:{color:"#91c23d",fontWeight:"normal"},other:{documentation:{color:"#7F9FBF",task:{color:"#8db6f1"}}}},markup:{bold:{fontWeight:"bold"},heading:{color:"#91c23d"},italic:{fontStyle:"italic"},list:{color:"#CC4C07"},other:{separator:{color:"#e8d075"},strikethrough:{textDecoration:"line-through"},table:{color:"#3C802C"}},quote:{color:"#55b5db"},raw:{fontFamily:"monospace",html:{backgroundColor:"#3B4B53"}},underline:{link:{textDecoration:"underline"}}},meta:{documentation:{annotation:{color:"#7F9FBF"},tag:{color:"#7F7F9F"}},preprocessor:{color:"#A4A4A4"},tag:{color:"#999999",attribute:{color:"#07e2d9"}}},punctuation:{operator:{color:"#FF8C00"}},ruler:{annotations:{backgroundColor:"#0f1113"},backgroundColor:"#0f1113",overview:{backgroundColor:"#0f1113"}},rulerLines:{color:"#3d4750",even:{color:"#3d4750"},odd:{color:"#3d4750"}},string:{color:"#55b5db",interpolated:{color:"#dadada"},quoted:{"double":{color:"#55b5db"},single:{color:"#55b5db"}}},support:{type:{propertyName:{color:"#9fca56"}}},"textviewContent ::-moz-selection":{backgroundColor:"rgba(49,115,112,0.99)"},"textviewContent ::selection":{backgroundColor:"rgba(49,115,112,0.99)"},textviewLeftRuler:{borderColor:"#0e1112"},textviewRightRuler:{borderColor:"#0e1112"},textviewSelection:{backgroundColor:"rgba(49,115,112,0.99)"},textviewSelectionUnfocused:{backgroundColor:"rgba(49,115,112,0.99)"},variable:{language:{color:"#9fca56",fontWeight:"normal"},other:{color:"#E038AD"},parameter:{color:"#FF8C00"}}}};
this.styles.push(t),l={className:"bluemix",name:"Bluemix",styles:{fontFamily:d,fontSize:h,annotationLine:{currentLine:{backgroundColor:"#3B4B53"}},annotationRange:{currentBracket:{backgroundColor:"#006E00"},currentSearch:{backgroundColor:"#5d5d5d"},matchingBracket:{backgroundColor:"#006E00"},matchingSearch:{backgroundColor:"#363636",currentSearch:{backgroundColor:"#465e47"}},writeOccurrence:{backgroundColor:"#093f59"}},backgroundColor:"#1A252D",color:"#07ADCF",comment:{color:"#93A2AA"},constant:{color:"#F47D64"},entity:{name:{color:"#98937B","function":{color:"#67BBB8",fontWeight:"bold"}},other:{"attribute-name":{color:"#01B199"}}},keyword:{control:{color:"#FCD600",fontWeight:"bold"},operator:{color:"#FFFFFF",fontWeight:"bold"},other:{documentation:{color:"#7F9FBF",task:{color:"#8db6f1"}}}},markup:{bold:{fontWeight:"bold"},heading:{color:"#91c23d"},italic:{fontStyle:"italic"},list:{color:"#CC4C07"},other:{separator:{color:"#e8d075"},strikethrough:{textDecoration:"line-through"},table:{color:"#3C802C"}},quote:{color:"#446FBD"},raw:{fontFamily:"monospace",html:{backgroundColor:"#696969",color:"white"}},underline:{link:{textDecoration:"underline"}}},meta:{documentation:{annotation:{color:"#7F9FBF"},tag:{color:"#7F7F9F"}},preprocessor:{color:"#A4A4A4"},tag:{color:"#8781BD"}},punctuation:{operator:{color:"#FF8C00"}},ruler:{backgroundColor:"#1A252D"},rulerLines:{color:"#93A2AA"},string:{color:"#01B199",interpolated:{color:"#dadada"}},support:{type:{propertyName:{color:"#FFFFFF"}}},"textviewContent ::-moz-selection":{backgroundColor:"rgba(16,106,91,0.99)"},"textviewContent ::selection":{backgroundColor:"rgba(16,106,91,0.99)"},textviewLeftRuler:{borderRight:"1px solid #424C53"},textviewRightRuler:{borderLeft:"1px solid #424C53"},textviewSelection:{backgroundColor:"rgba(16,106,91,0.99)"},textviewSelectionUnfocused:{backgroundColor:"rgba(16,106,91,0.99)"},variable:{language:{color:"#8781BD",fontWeight:"bold"},other:{color:"#E038AD"},parameter:{color:"#D1416F"}}}},this.styles.push(l),c={className:"bluemixLight",name:"BluemixLight",styles:{fontFamily:d,fontSize:h,annotationLine:{currentLine:{backgroundColor:"#E4F7EF"}},annotationRange:{currentBracket:{backgroundColor:"#00FE00"},matchingBracket:{backgroundColor:"#00FE00"},matchingSearch:{backgroundColor:"#c3e1ff",currentSearch:{backgroundColor:"#53d1ff"}},writeOccurrence:{backgroundColor:"#ffff00"}},backgroundColor:"#ffffff",color:"#1A252D",comment:{color:"#93A2AA"},constant:{color:"#8781BD"},entity:{name:{color:"#98937B","function":{color:"#67BBB8",fontWeight:"bold"}},other:{"attribute-name":{color:"#01B199"}}},keyword:{control:{color:"#EF4E38",fontWeight:"bold"},operator:{color:"#FF962D",fontWeight:"bold"},other:{documentation:{color:"#7F9FBF",task:{color:"#5595ff"}}}},markup:{bold:{fontWeight:"bold"},heading:{color:"#0000FF"},italic:{fontStyle:"italic"},list:{color:"#CC4C07"},other:{separator:{color:"#00008F"},strikethrough:{textDecoration:"line-through"},table:{color:"#3C802C"}},quote:{color:"#446FBD"},raw:{fontFamily:"monospace",html:{backgroundColor:"#EAF2FE"}},underline:{link:{textDecoration:"underline"}}},meta:{documentation:{annotation:{color:"#7F9FBF"},tag:{color:"#7F7F9F"}},preprocessor:{color:"#A4A4A4"},tag:{color:"#EF4E38"}},punctuation:{operator:{color:"#D1416F"}},ruler:{backgroundColor:"#ffffff"},rulerLines:{color:"#93A2AA"},string:{color:"#02839D",interpolated:{color:"#151515"}},support:{type:{propertyName:{color:"#FF962D"}}},"textviewContent ::-moz-selection":{backgroundColor:"rgba(180,213,255,0.99)"},"textviewContent ::selection":{backgroundColor:"rgba(180,213,255,0.99)"},textviewLeftRuler:{borderRight:"1px solid #EEEEEE"},textviewRightRuler:{borderLeft:"1px solid #EEEEEE"},textviewSelection:{backgroundColor:"rgba(180,213,255,0.99)"},textviewSelectionUnfocused:{backgroundColor:"rgba(180,213,255,0.99)"},variable:{language:{color:"#7F0055",fontWeight:"bold"},other:{color:"#E038AD"},parameter:{color:"#D1416F"}}}},this.styles.push(c)}function n(){return this.styles}function o(e){return JSON.parse(JSON.stringify((e||{}).dark?l:c))}function r(){return["Prospecto","Darker","Bluemix","BluemixLight","Nimbus"]}function s(){return{storage:"/themes",styleset:"editorstyles",defaultTheme:"Bluemix",selectedKey:"editorSelected",version:t}}function a(t){var i="editorTheme",n=e.TextTheme.getTheme();n.setThemeClass(i,n.buildStyleSheet(i,t))}var l,c,d='"Consolas", "Monaco", "Vera Mono", monospace',h="12px";i.prototype.styles=[],i.prototype.getStyles=n,i.prototype.getDefaultTheme=o,i.prototype.getProtectedThemes=r;var u=!0;return i.prototype.fontSettable=u,i.prototype.getThemeStorageInfo=s,i.prototype.processSettings=a,{ThemeData:i,getStyles:n,getDefaultTheme:o}}),define("orion/widgets/input/TextField",["orion/objects","orion/webui/littlelib"],function(e,t){function i(i,n){e.mixin(this,i),this.node=n||document.createElement("div"),this.node.innerHTML=this.templateString,this.textfield=t.$(".setting-control",this.node)}return e.mixin(i.prototype,{templateString:'<input type="text" class="setting-control" name="myname"/>',category:null,item:null,element:null,ui:null,show:function(){this.textfield.addEventListener("change",this.change.bind(this)),this.postCreate()},destroy:function(){this.node&&(t.empty(this.node),this.textfield=this.node=null)},width:function(e){this.textfield.style.width=e},getValue:function(){return"integer"===this.inputType?parseInt(this.textfield.value,10):this.textfield.value},setValue:function(e){this.textfield.value=e},getSelection:function(){return this.getValue()},setSelection:function(e){this.setValue(e)},postCreate:function(){this.inputType&&"password"===this.inputType&&(this.textfield.type="password"),this.editmode&&"readonly"===this.editmode&&this.textfield.setAttribute("readonly","true")},change:function(e){this.postChange&&this.postChange(this.textfield.value,e)}}),i}),define("orion/widgets/input/SettingsTextfield",["orion/objects","orion/webui/littlelib","orion/widgets/input/TextField"],function(e,t,i){function n(e){o(e),i.apply(this,arguments),this.mylabel=t.$(".setting-label",this.node)}function o(t){var o=r();t.local&&(o.templateString='<span class="setting-label"></span><input class="setting-control" type="text" />',e.mixin(n.prototype,i.prototype,o))}function r(){return{templateString:'<div><label><span class="setting-label"></span><input class="setting-control" type="text" /></label></div>',destroy:function(){i.prototype.destroy.call(this),this.mylabel&&(this.mylabel=null)},postCreate:function(){i.prototype.postCreate.call(this),this.mylabel.textContent=this.fieldlabel}}}return e.mixin(n.prototype,i.prototype,r()),n}),define("orion/widgets/input/Checkbox",["orion/objects","orion/webui/littlelib"],function(e,t){function i(i,n){e.mixin(this,i),this.node=n||document.createElement("div"),this.node.innerHTML=this.templateString,this.checkbox=t.$(".setting-control",this.node)}return e.mixin(i.prototype,{templateString:'<label><input class="setting-control settingsCheckbox" type="checkbox"/></label>',show:function(){this.checkbox.addEventListener("change",this.change.bind(this)),this.postCreate()},destroy:function(){this.node&&(t.empty(this.node),this.node=null,this.checkbox=null)},isChecked:function(){return this.checkbox.checked},setChecked:function(e){this.checkbox.checked=e},getSelection:function(){return this.isChecked()},setSelection:function(e){this.setChecked(e)},change:function(){this.postChange&&this.postChange(this.checkbox.value)},postCreate:function(){this.checkbox.style.width="20px",this.editmode&&"readonly"===this.editmode&&this.checkbox.setAttribute("disabled","disabled")}}),i}),define("orion/widgets/input/SettingsCheckbox",["orion/objects","orion/webui/littlelib","orion/widgets/input/Checkbox"],function(e,t,i){function n(e){o(e),i.apply(this,arguments),this.mylabel=t.$(".setting-label",this.node)}function o(t){var o=r();t.local&&(o.templateString='<span class="setting-label"></span><input class="setting-control settingsCheckbox" type="checkbox"/>',e.mixin(n.prototype,i.prototype,o))}function r(){return{templateString:'<label><span class="setting-label"></span><input class="setting-control settingsCheckbox" type="checkbox"/></label>',postCreate:function(){i.prototype.postCreate.call(this),this.mylabel.textContent=this.fieldlabel},destroy:function(){i.prototype.destroy.call(this),this.mylabel&&(this.mylabel=null)}}}return e.mixin(n.prototype,i.prototype,r()),n}),define("orion/widgets/input/Select",["orion/objects","orion/webui/littlelib"],function(e,t){function i(i,n){e.mixin(this,i),this.node=n||document.createElement("div"),this.node.innerHTML=this.templateString,this.select=t.$(".setting-control",this.node)}return e.mixin(i.prototype,{templateString:'<select class="setting-control" id="selection"></select>',addOptions:function(e){var t=document.createElement("option");t.value=e.value,t.appendChild(document.createTextNode("string"==typeof e.label?e.label:e.value)),e.selected&&(t.selected="selected"),this.select.appendChild(t)},show:function(){this.postCreate()},postCreate:function(){this.options.forEach(this.addOptions.bind(this)),this.select.addEventListener("change",this.change.bind(this))},destroy:function(){this.node&&(t.empty(this.node),this.node=this.select=null)},getSelected:function(){return this.select.value},getSelectedIndex:function(){return this.select.selectedIndex},setSelectedIndex:function(e){this.select.selectedIndex=e},getSelection:function(){return this.getSelected()},setSelection:function(e){for(var t=0;t<this.options.length;t++)if(this.options[t].value===e)return void this.setSelectedIndex(t);this.setSelectedIndex(0)},change:function(){this.postChange&&this.postChange(this.select.value)}}),i}),define("orion/widgets/input/SettingsSelect",["orion/objects","orion/webui/littlelib","orion/widgets/input/Select"],function(e,t,i){function n(e){o(e),i.apply(this,arguments),this.mylabel=t.$(".setting-label",this.node)}function o(t){var o=r();t.local&&(o.templateString='<span class="setting-label"></span><select class="setting-control"></select>',e.mixin(n.prototype,i.prototype,o))}function r(){return{templateString:'<div><label><span class="setting-label"></span><select class="setting-control"></select></label></div>',postCreate:function(){i.prototype.postCreate.call(this),this.mylabel.textContent=this.fieldlabel},destroy:function(){i.prototype.destroy.call(this),this.mylabel&&(this.mylabel=null)}}}return e.mixin(n.prototype,i.prototype,r()),n}),define("orion/widgets/settings/Subsection",[],function(){function e(e){var t=e.sectionName;this.parentNode=e.parentNode,this.children=e.children;var i=document.createElement("section");i.classList.add("setting-row"),i.setAttribute("role","region");var n="setting-header-"+t.replace(/\s/g,"");i.setAttribute("aria-labelledby",n);var o=document.createElement("div");o.classList.add("setting-header"),o.id=n,o.textContent=t;var r=document.createElement("div");r.classList.add("setting-content"),i.appendChild(o),i.appendChild(r),this.node=i,this.subsectionContent=r}return e.prototype.show=function(){if(this.parentNode&&this.parentNode.appendChild(this.node),this.children){var e=this;this.children.forEach(function(t){e.subsectionContent.appendChild(t.node),t.show()})}},e}),define("orion/widgets/settings/EditorSettings",["i18n!orion/settings/nls/messages","orion/section","orion/commands","orion/objects","orion/PageLinks","orion/webui/littlelib","orion/widgets/input/SettingsTextfield","orion/widgets/input/SettingsCheckbox","orion/widgets/input/SettingsSelect","orion/widgets/settings/Subsection"],function(e,t,i,n,o,r,s,a,l,c){function d(t,i,n,o,s,a){if(!o.local){var l=document.createElement("span");l.classList.add(v),l.classList.add(s[i+"LocalVisible"]?_:y),l.title=e.localSettingsTooltip,l.addEventListener("click",function(){l.classList.contains(y)?(l.classList.add(_),l.classList.remove(y)):(l.classList.add(y),l.classList.remove(_)),a.update()});var c=r.$("label",t.node);c.parentNode.insertBefore(l,c)}return t}function h(e,t,i,n){return d(new a(t),e,this,t,i,n)}function u(e,t,i,n){return t.inputType="integer",d(new s(t),e,this,t,i,n)}function p(e,t,i,n){var o=this.values;t.options=[];for(var r=0;r<o.length;r++){var s=o[r],a={value:s.value,label:s.label};s.value===i[e]&&(a.selected=!0),t.options.push(a)}return d(new l(t),e,this,t,i,n)}function f(t,i){return this.min<=i[t]&&i[t]<=this.max?"":e[t+"Invalid"]}function g(e,t){n.mixin(this,e),this.node=t}var m=[{value:"",label:e.Default},{value:"Emacs",label:"Emacs"},{value:"vi",label:"vi"}],v="setting-local-indicator",_="on",y="off",C={editorSettings:{keys:{keyBindings:{values:m,create:p}},fileManagement:{autoSave:{create:h},autoSaveTimeout:{min:50,max:1e4,create:u,validate:f},autoLoad:{create:h},saveDiffs:{create:h},trimTrailingWhiteSpace:{create:h}},typing:{autoPairQuotations:{create:h},autoPairParentheses:{create:h},autoPairBraces:{create:h},autoPairSquareBrackets:{create:h},autoPairAngleBrackets:{create:h},autoCompleteComments:{create:h},smartIndentation:{create:h}},tabs:{tabSize:{min:1,max:16,create:u,validate:f},expandTab:{create:h}},whitespaces:{showWhitespaces:{create:h}},wrapping:{wordWrap:{create:h},showMargin:{create:h},marginOffset:{min:10,max:200,create:u,validate:f}},smoothScrolling:{scrollAnimation:{create:h},scrollAnimationTimeout:{min:50,max:1e3,create:u,validate:f}},rulers:{annotationRuler:{create:h},lineNumberRuler:{create:h},foldingRuler:{create:h},overviewRuler:{create:h},zoomRuler:{create:h}},languageTools:{showOccurrences:{create:h},contentAssistAutoTrigger:{create:h}}}};return n.mixin(g.prototype,{templateString:'<div class="sections"></div>',commandTemplate:'<div id="commandButtons"><div id="editorCommands" class="layoutRight sectionActions"></div></div>',createElements:function(){if(this.node.innerHTML=this.templateString,this.sections=r.$(".sections",this.node),this.createSections(),this.local)this.sections.classList.add("local");else{var e=document.getElementById("pageActions");e.innerHTML=this.commandTemplate,this.createToolbar()}},createSections:function(){function i(e){for(var t=8;19>t;t++)a={value:t+e,label:t+e},a.label===A&&(a.selected=!0),s.push(a)}var n,s,a,d,h,u,p=this.oldPrefs,f=[],g=this.themePreferences;for(var m in C)if(C.hasOwnProperty(m)){if(!this.local){h=new t.Section(this.sections,{id:m+"Section",title:e[m],slideout:!0});var w=document.createElement("div");w.classList.add("setting-info"),w.textContent=e.editorSettingsInfo;var b=document.createElement("span");b.classList.add(v),b.classList.add(_);var S=document.createElement("span");S.classList.add(v),S.classList.add(y);var x=document.createElement("span");x.classList.add("core-sprite-wrench"),x.classList.add("icon-inline"),x.classList.add("imageSprite"),r.processDOMNodes(w,[b,S,x]),h.getContentElement().appendChild(w)}for(var L in C[m])if(C[m].hasOwnProperty(L)){for(var T in C[m][L])if(p[T+"Visible"]&&(!this.local||p[T+"LocalVisible"])){var E=C[m][L][T];s={},s.local=this.local,s.fieldlabel=e[T],s.postChange=this.update.bind(this),f.push(E.widget=E.create(T,s,p,this))}!this.local&&f.length>0&&(u=new c({sectionName:e[L],parentNode:h.getContentElement(),children:f}),u.show(),f=[])}}if(this.local){var k=this.oldThemeStyles,N=o.getOrionHome();if(p.fontSizeVisible&&(!this.local||p.fontSizeLocalVisible)){var A=k.style.styles.fontSize;s=[],i("px"),i("pt"),d=this.sizeSelect=new l({fieldlabel:e["Font Size"],options:s,postChange:g.setFontSize.bind(g)}),f.unshift(d)}if(p.themeVisible&&(!this.local||p.themeLocalVisible)){var R=k.styles;s=[];for(var I=0;I<R.length;I++)a={value:R[I].name,label:e[R[I].name+"ThemeName"]||R[I].name},R[I].name===k.style.name&&(a.selected=!0),s.push(a);s.push({value:"customize",label:e.customizeTheme}),d=this.themeSelect=new l({fieldlabel:e["Editor Theme"],options:s,postChange:function(){if("customize"===d.select.value)window.open(N+"/settings/settings.html#,category=themeSettings","_self");else{var e=g.setTheme.bind(g);e(d.select.value)}}}),f.unshift(d)}!this.local&&f.length>0&&(n=new c({sectionName:e["Editor Theme"],parentNode:this.editorThemeSection.getContentElement(),children:f}),n.show(),f=[]),f.forEach(function(e){this.sections.appendChild(e.node),e.show()}.bind(this));var D=document.createElement("div"),P=document.createElement("span");P.classList.add("setting-label"),D.appendChild(P);var M=document.createElement("a");M.classList.add("dropdownMenuItem"),M.href=N+"/settings/settings.html#,category=editorSettings",M.textContent=e.moreEditorSettings,M.style["float"]="right",M.addEventListener("keydown",function(e){(e.keyCode===r.KEY.ENTER||e.keyCode===r.KEY.SPACE)&&M.click()},!1),D.appendChild(M),this.sections.appendChild(D)}},createToolbar:function(){var t=r.node("editorSettingsSectionToolActionsArea"),n=new i.Command({name:e.Restore,tooltip:e["Restore default Editor Settings"],id:"orion.restoreeditorsettings",callback:function(e){this.restore(e.items)}.bind(this)});this.commandService.addCommand(n),this.commandService.registerCommandContribution("restoreEditorSettingCommand","orion.restoreeditorsettings",2),this.commandService.renderCommands("restoreEditorSettingCommand",t,this,this,"button")},valueChanged:function(){var e={};for(var t in this.oldPrefs)this.oldPrefs.hasOwnProperty(t)&&(e[t]=this.oldPrefs[t]);this.getValues(e);for(var i in e)if(e.hasOwnProperty(i)&&e[i]!==this.oldPrefs[i])return e;return void 0},validate:function(e){var t="";return this._forEach(function(i,n){return n.validate&&(t=n.validate(i,e))?!1:!0}),t},_progress:function(e,t){if(this.registry){var i=this.registry.getService("orion.page.message");i.setProgressResult({Message:e,Severity:t})}},update:function(){var t=this.valueChanged();if(t){var i=this.validate(t);if(i)return void this._progress(i,"Error");this.preferences.setPrefs(t,function(){this.setValues(this.oldPrefs=t),this._progress(e["Editor preferences updated"],"Normal")}.bind(this))}else this.setValues(this.oldPrefs);this.editor&&this.editor.focus()},restore:function(){this.preferences.setPrefs({},function(t){this._show(t),this._progress(e["Editor defaults restored"],"Normal")}.bind(this))},show:function(e,t){e&&(this.node=e),this.themePreferences.getTheme(function(e){this.preferences.getPrefs(function(i){this._show(i,e),t&&t()}.bind(this))}.bind(this))},_show:function(e,t){t&&(this.oldThemeStyles=t),this.oldPrefs=e,this.createElements(),this.setValues(e)},_forEach:function(e){for(var t in C)if(C.hasOwnProperty(t))for(var i in C[t])if(C[t].hasOwnProperty(i))for(var n in C[t][i])if(C[t][i].hasOwnProperty(n)){var o=C[t][i][n];if(o.widget&&!e(n,o))return}},getValues:function(e){this._forEach(function(t,i){if(e[t]=i.widget.getSelection(),!this.local){var n=r.$("."+v,i.widget.node);e[t+"LocalVisible"]=n&&n.classList.contains(_)}return!0}.bind(this))},setValues:function(e){this._forEach(function(t,i){if(i.widget.setSelection(e[t]),!this.local){var n=r.$("."+v,i.widget.node);n&&(e[t+"LocalVisible"]?(n.classList.add(_),n.classList.remove(y)):(n.classList.add(y),n.classList.remove(_)))}return!0}.bind(this))},destroy:function(){this.node&&(this.node=null)}}),g}),define("orion/searchAndReplace/textSearcher",["i18n!orion/search/nls/messages","orion/editor/find","orion/commands","orion/objects","orion/inputCompletion/inputCompletion","orion/webui/littlelib"],function(e,t,i,n,o,r){function s(e,i,n,o,r){t.Find.call(this,e,o,r),this._serviceRegistry=i,this._commandService=n}var a=30;return s.prototype=new t.Find,n.mixin(s.prototype,{getFindString:function(){var e=document.getElementById("localSearchFindWith");return e?e.value:t.Find.prototype.getFindString.call(this)},getReplaceString:function(){var e=document.getElementById("localSearchReplaceWith");return e?e.value:t.Find.prototype.getReplaceString(this)},hide:function(){var e=this.isVisible();t.Find.prototype.hide.call(this),e&&this._commandService.closeParameterCollector()},show:function(e){t.Find.prototype.show.call(this,e);var i=e.findString;this._addRecentfind(i);var n=e.replaceString,o=document.getElementById("localSearchFindWith");if(o||(this._createActionTable(),o=document.getElementById("localSearchFindWith")),i&&(o.value=i),n){var r=document.getElementById("localSearchReplaceWith");r.value=n}window.setTimeout(function(){o.select(),o.focus()},10)},_showReplaceInfo:function(){this._regex?(this._replaceInfo.src="data:image/gif;base64,R0lGODlhBwAIAMQAAMzX6cbT5kh4qFiIuKC40FCIuGSXwmWZw2SaxGacxmadxmWcxbPM4GigyJW92JzC26DI0P///////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAABIALAAAAAAHAAgAAAUmoEQUQkFI0PBEz5A2yII0w9AwkUPbRpTsjUNEQUsFIgCXiGSShAAAOw==",this._replaceInfo.title=e.regexOptionOn,this._replaceInfo.style.display=""):(this._replaceInfo.src="data:image/gif;base64,R0lGODlhBwAIAEAAACH5BAEAABIALAAAAAAHAAgAhwAAAAAAMwAAZgAAmQAAzAAA/wArAAArMwArZgArmQArzAAr/wBVAABVMwBVZgBVmQBVzABV/wCAAACAMwCAZgCAmQCAzACA/wCqAACqMwCqZgCqmQCqzACq/wDVAADVMwDVZgDVmQDVzADV/wD/AAD/MwD/ZgD/mQD/zAD//zMAADMAMzMAZjMAmTMAzDMA/zMrADMrMzMrZjMrmTMrzDMr/zNVADNVMzNVZjNVmTNVzDNV/zOAADOAMzOAZjOAmTOAzDOA/zOqADOqMzOqZjOqmTOqzDOq/zPVADPVMzPVZjPVmTPVzDPV/zP/ADP/MzP/ZjP/mTP/zDP//2YAAGYAM2YAZmYAmWYAzGYA/2YrAGYrM2YrZmYrmWYrzGYr/2ZVAGZVM2ZVZmZVmWZVzGZV/2aAAGaAM2aAZmaAmWaAzGaA/2aqAGaqM2aqZmaqmWaqzGaq/2bVAGbVM2bVZmbVmWbVzGbV/2b/AGb/M2b/Zmb/mWb/zGb//5kAAJkAM5kAZpkAmZkAzJkA/5krAJkrM5krZpkrmZkrzJkr/5lVAJlVM5lVZplVmZlVzJlV/5mAAJmAM5mAZpmAmZmAzJmA/5mqAJmqM5mqZpmqmZmqzJmq/5nVAJnVM5nVZpnVmZnVzJnV/5n/AJn/M5n/Zpn/mZn/zJn//8wAAMwAM8wAZswAmcwAzMwA/8wrAMwrM8wrZswrmcwrzMwr/8xVAMxVM8xVZsxVmcxVzMxV/8yAAMyAM8yAZsyAmcyAzMyA/8yqAMyqM8yqZsyqmcyqzMyq/8zVAMzVM8zVZszVmczVzMzV/8z/AMz/M8z/Zsz/mcz/zMz///8AAP8AM/8AZv8Amf8AzP8A//8rAP8rM/8rZv8rmf8rzP8r//9VAP9VM/9VZv9Vmf9VzP9V//+AAP+AM/+AZv+Amf+AzP+A//+qAP+qM/+qZv+qmf+qzP+q///VAP/VM//VZv/Vmf/VzP/V////AP//M///Zv//mf//zP///wAAAAAAAAAAAAAAAAgsAPcpQzMJjbJ9xNAQQ6hwUqaHDws+3PeQoMN9DiUuzFRQ2ZiDyyYdHFhwYUAAOw==",this._replaceInfo.title=e.regexOptionOff,this._replaceInfo.style.display="")},_createActionTable:function(){var t=this;this._commandService.openParameterCollector("pageNavigationActions",function(n){var o=document.createElement("input");o.type="text",o.name=e["Find:"],o.className="parameterInput",o.id="localSearchFindWith",o.placeholder=e["Find With"],o.oninput=function(e){return t._handleInput(e)},o.onkeydown=function(e){return t._handleKeyDown(e)},n.appendChild(o),t._initCompletion(o),t._createButton(e.Next,n,function(e){t._addRecentfind(t.getFindString()),t.find(!e.shiftKey)}),t._createButton(e.Previous,n,function(e){t._addRecentfind(t.getFindString()),t.find(e.shiftKey)});var r=t._editor.getTextView().getOptions("readonly");if(!r){var s=document.createElement("input");s.type="text",s.name=e["ReplaceWith:"],s.className="parameterInput",s.id="localSearchReplaceWith",s.placeholder=e["Replace With"],s.onkeydown=function(e){return t._handleKeyDown(e)},n.appendChild(s),t._replaceInfo=t._createInfoImage(null,n,null),t._showReplaceInfo(),t._createButton(e.Replace,n,function(){t.replace()}),t._createButton(e["Replace All"],n,function(){t.replaceAll()})}var a=document.createElement("div");n.appendChild(a),a.classList.add("findOptionsDiv");var l=i.createDropdownMenu(a,e.Options,null,"dismissButton",null,!0);return l.menuButton.classList.add("parameterInlineButton"),i.createCheckedMenuItem(l.menu,e["Show all"],t._showAll,function(e){var i=e.target.checked;t.setOptions({showAll:i}),l.dropdown.close(!0)}),i.createCheckedMenuItem(l.menu,e["Case sensitive"],!t._caseInsensitive,function(e){t.setOptions({caseInsensitive:!e.target.checked}),l.dropdown.close(!0),t.find(!0)}),i.createCheckedMenuItem(l.menu,e["Wrap search"],t._wrap,function(e){t.setOptions({wrap:e.target.checked}),l.dropdown.close(!0)}),i.createCheckedMenuItem(l.menu,e["Incremental search"],t._incremental,function(e){t.setOptions({incremental:e.target.checked}),l.dropdown.close(!0)}),i.createCheckedMenuItem(l.menu,e["Whole Word"],t._wholeWord,function(e){t.setOptions({wholeWord:e.target.checked}),l.dropdown.close(!0),t.find(!0)}),t._regExBox=i.createCheckedMenuItem(l.menu,e["Regular expression"],t._regex,function(e){t.setOptions({regex:e.target.checked}),l.dropdown.close(!0),t.find(!0),t._showReplaceInfo()}),r||i.createCheckedMenuItem(l.menu,e["Find after replace"],t._findAfterReplace,function(e){t.setOptions({findAfterReplace:e.target.checked}),l.dropdown.close(!0)}),o},function(){t.hide()})},_storeRecentFind:function(e,t,i){this._serviceRegistry.getService("orion.core.preference").put("/window/favorites",{recentFind:e}).then(function(){t&&window.setTimeout(function(){t.dispatchEvent({type:"inputDataListChanged",deleting:i})}.bind(this),20)})},_addRecentfind:function(e){"string"==typeof e&&e&&(this._completion&&this._completion.hasValueOf(e)||this._serviceRegistry.getService("orion.core.preference").get("/window/favorites").then(function(t){var i,n=t.recentFind;if("string"==typeof n&&(n=JSON.parse(n)),n){for(i in n)if(n[i].name===e)return;if(n.length>=a){var o=n.length;n.splice(a-1,o-a+1)}}else n=[];n.splice(0,0,{name:e}),this._storeRecentFind(n,this._completion)}.bind(this)))},_removeRecentSearch:function(e,t){"string"==typeof e&&e&&this._serviceRegistry.getService("orion.core.preference").get("/window/favorites").then(function(i){var n,o=i.recentFind;if("string"==typeof o&&(o=JSON.parse(o)),o)for(n in o)if(o[n].name===e){o.splice(n,1),this._storeRecentFind(o,t,!0);break}}.bind(this))},_initCompletion:function(t){if(this._completion)this._completion.setInputField(t);else{var i=function(e){this._serviceRegistry.getService("orion.core.preference").get("/window/favorites").then(function(t){var i=t.recentFind;if("string"==typeof i&&(i=JSON.parse(i)),i){var n=[];i.forEach(function(e){n.push({type:"proposal",label:e.name,value:e.name})}),e(n)}})}.bind(this);this._completion=new o.InputCompletion(t,i,{serviceRegistry:this._serviceRegistry,group:"localSearch",onDelete:function(e,t){this._removeRecentSearch(e,t)}.bind(this),deleteToolTips:e.DeleteSearchTrmMsg})}},_createButton:function(e,t,i){var n=document.createElement("button");n.addEventListener("click",i.bind(this),!1);var o=this;n.addEventListener("keydown",function(e){e.keyCode===r.KEY.ESCAPE&&o.hide()}),n.appendChild(document.createTextNode(e)),n.className="dismissButton parameterInlineButton",t.appendChild(n)},_createInfoImage:function(e,t){var i=document.createElement("img");return i.classList.add("replaceInfo"),i.addEventListener("click",function(){this._regExBox.checked=!this._regex,this.setOptions({regex:!this._regex}),this.find(!0),this._showReplaceInfo()}.bind(this)),t.appendChild(i),i},_handleInput:function(){return this._incremental&&this.find(!0,null,!0),!0},_handleKeyDown:function(e){var t=(this.isMac?e.metaKey:e.ctrlKey)&&!e.altKey&&!e.shiftKey;return t&&70===e.keyCode?(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,!1):(this.isMac?e.metaKey:e.ctrlKey)&&!e.altKey&&75===e.keyCode||13===e.keyCode?(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,this._addRecentfind(this.getFindString()),this.find(!e.shiftKey),!1):t&&82===e.keyCode?(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,this.replace(),!1):27===e.keyCode?(this.hide(),!1):!0}}),{TextSearcher:s}}),define("orion/edit/dispatcher",["orion/edit/dispatcher"],function(){function e(e,t,i,n){this.serviceRegistry=e,this.editor=i,this.inputManager=n,this.ctRegistry=t,this.serviceReferences={};var o=this;this.inputManager.addEventListener("InputChanged",function(e){o.contentType=e.contentType,o.updateListeners()}.bind(this)),this.listener={onServiceAdded:function(e){o._onServiceAdded(e.serviceReference)},onServiceRemoved:function(e){o._onServiceRemoved(e.serviceReference)}},this.serviceRegistry.addEventListener("registered",this.listener.onServiceAdded),this.serviceRegistry.addEventListener("unregistering",this.listener.onServiceRemoved)}return e.prototype={updateListeners:function(){this._removeAllListeners();for(var e=this.serviceRegistry,t=e.getServiceReferences("orion.edit.model"),i=0;i<t.length;i++)this._wireServiceReference(t[i])},_wireServiceReference:function(e){var t=e.getProperty("contentType");if("undefined"!=typeof t&&null!==t){var i=this,n=this.contentType;this.ctRegistry.isSomeExtensionOf(n,t)&&i._wireService(e,i.serviceRegistry.getService(e))}},_wireService:function(e,t){var i=this.editor.getTextView();if(!i)throw new Error("TextView not installed");for(var n=Object.keys(t),o=0;o<n.length;o++){var r=n[o],s=t[r];if("on"===r.substr(0,2)&&"function"==typeof s){var a=r.substr(2);this._wireServiceMethod(e,t,s,i,a)}}},_wireServiceMethod:function(e,t,i,n,o){var r=this,s=function(e){e.file=r.getServiceFileObject(),i(e).then()},a=e.getProperty("service.id");this.serviceReferences[a]=this.serviceReferences[a]||[],this.serviceReferences[a].push([n,o,s]),n.addEventListener(o,s)},_onServiceRemoved:function(e){var t=e.getProperty("service.id");this._removeListeners(t)},_onServiceAdded:function(e){-1!==e.getProperty("objectClass").indexOf("orion.edit.model")&&this._wireServiceReference(e)},_removeListeners:function(e){var t=this.serviceReferences[e];if(t){for(var i=0;i<t.length;i++){var n=t[i],o=n[0],r=n[1],s=n[2];o.removeEventListener(r,s)}delete this.serviceReferences[e]}},_removeAllListeners:function(){for(var e=Object.keys(this.serviceReferences),t=0;t<e.length;t++)this._removeListeners(e[t])},getServiceFileObject:function(){var t=this.inputManager.getFileMetadata();return t?e.toServiceFileObject(t,this.inputManager.getContentType()):null}},e.toServiceFileObject=function(e,t){var i=Object.create(null);return i.name=e.Name,i.location=e.Location,i.parents=e.Parents,t&&(i.contentType=Object.create(null),i.contentType.id=t.id,i.contentType.name=t.name,i.contentType.imageClass=t.imageClass,i.contentType.extension=t.extension),i},{Dispatcher:e}}),define("orion/edit/typedefs",["orion/objects","orion/serviceTracker","orion/i18nUtil"],function(e,t,i){function n(e,t){throw new Error(i.formatMessage("${0} [service id: ${1}]",e,t.getProperty("service.id")))}function o(e){this.props=Object.create(null),this.defs=Object.create(null),this.registration=null;var i=new t(e,"orion.core.typedef"),o=this;i.onServiceAdded=function(e){var t=e.getProperty("id"),i=e.getProperty("defs");t&&i||n("TypeDef registration missing required 'id' or 'defs'",e);var r={};e.getPropertyKeys().forEach(function(t){"defs"!==t&&"service.id"!==t&&"service.names"!==t&&"objectClass"!==t&&(r[t]=e.getProperty(t))}),o.props[t]=r,o.defs[t]=i,o._updateRegistration()},i.removedService=function(e){var t=e.getProperty("id");delete o.props[t],delete o.defs[t],o._updateRegistration()},i.open(),this.registration=e.registerService("orion.edit.context",{getTypeDef:this.getTypeDef.bind(this)},null),this._updateRegistration()}return e.mixin(o.prototype,{_updateRegistration:function(){this.registration&&this.registration.setProperties({typeDefs:this.getAllProperties()})},getTypeDef:function(e){return this.defs[e]||null},getProperties:function(e){return this.props[e]||null},getAllProperties:function(){return this.props}}),o}),define("orion/markOccurrences",["orion/Deferred"],function(e){function t(e,t,i){this.registry=e,this.inputManager=t,this.editor=i}return t.prototype={setOccurrencesVisible:function(e){this.occurrencesVisible!==e&&(this.occurrencesVisible=e,e||this.editor.showOccurrences([]))},findOccurrences:function(){function t(t,i,n){function o(e,t,i){var n=t.getProperty("contentType");return r.isSomeExtensionOf(i,n).then(function(e){return e?t:null})}for(var r=t.getService("orion.core.contentTypeRegistry"),s=t.getServiceReferences("orion.edit.occurrences"),a=[],l=0;l<s.length;l++){var c=s[l],d=c.getProperty("pattern");if(c.getProperty("contentType"))a.push(o(t,c,i));else if(d&&new RegExp(d).test(n)){var h=new e;h.resolve(c),a.push(h)}}return e.all(a,function(e){return{_error:e}}).then(function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i];n&&!n._error&&t.push(n)}return t})}var i,n=this,o=function(){i&&window.clearTimeout(i),n.occurrencesVisible&&(i=window.setTimeout(function(){i=null;var e=n.editor,t=e.getSelections();if(t.length>1)return void n.editor.showOccurrences([]);var o={selection:t[0],contentType:n.inputManager.getContentType().id};
n.occurrencesService&&n.occurrencesService.computeOccurrences(e.getEditorContext(),o).then(function(e){n.editor.showOccurrences(e)})},500))};n.inputManager.addEventListener("InputChanged",function(e){var r=n.editor.getTextView();r&&(r.removeEventListener("Selection",o),t(n.registry,e.contentType,e.title).then(function(e){e&&0!==e.length?(n.occurrencesService=n.registry.getService(e[0]),r.addEventListener("Selection",o)):i&&window.clearTimeout(i)}))})}},{MarkOccurrences:t}}),define("orion/liveEditSession",["orion/Deferred"],function(e){function t(e){return e instanceof Error?e:new Error(e)}function i(e,t){this.registry=e,this.editor=t}var n,o=[];return i.prototype={start:function(i,r){function s(i,n){function o(e,t){var i=e.getProperty("contentType");return r.isSomeExtensionOf(t,i).then(function(t){return t?e:null})}for(var r=i.getService("orion.core.contentTypeRegistry"),s=i.getServiceReferences("orion.edit.live"),a=[],l=0;l<s.length;l++){var c=s[l];c.getProperty("contentType")&&a.push(o(c,n))}return e.all(a,t).then(function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i];!n||n instanceof Error||t.push(n)}return t})}if(n!==r){if(o&&o.forEach(function(e){e.endEdit(n)}),o=[],n=r,!i)return;var a=this.editor,l=this.registry;s(l,i).then(function(n){var s=n.map(function(e){var t=l.getService(e);if(t.startEdit){var n={contentType:i.id,title:r};o.push(t);var s=a.getEditorContext();return t.startEdit(s,n)}});e.all(s,t)})}}},i}),define("orion/problems",["orion/EventTarget"],function(e){function t(t,i){this._serviceRegistry=t,e.attach(this),this._serviceRegistration=t.registerService(i||"orion.core.marker",this)}return t.prototype={_setProblems:function(e){this.problems=e,this.dispatchEvent({type:"problemsChanged",problems:e})}},t.prototype.constructor=t,{ProblemService:t}}),define("orion/blamer",["orion/extensionCommands","orion/PageLinks","orion/URITemplate"],function(e,t,i){function n(e,t,i){this.serviceRegistry=e,this.inputManager=t,this.editor=i}return n.prototype={getBlamer:function(){for(var t=this.inputManager.getFileMetadata(),i=this.serviceRegistry.getServiceReferences("orion.edit.blamer"),n=0;n<i.length;n++){var o=i[n],r={};r.validationProperties=o.getProperty("validationProperties"),r.forceSingleItem=!0;var s=e._makeValidator(r,this.serviceRegistry);if(s.validationFunction.bind(s)(t))return this.serviceRegistry.getService(o)}return null},isVisible:function(){return!!this.getBlamer()},doBlame:function(){var e=this.getBlamer();if(e){var n=function(e){for(var n=t.getOrionHome(),o=0;o<e.length;o++){var r=e[o],s=new i(r.CommitLink),a={};a.OrionHome=n,r.CommitLink=s.expand(a)}this.editor.showBlame(e)}.bind(this),o=this.inputManager,r={metadata:o.getFileMetadata()};e.computeBlame(this.editor.getEditorContext(),r).then(n)}}},{Blamer:n}}),define("orion/differ",["orion/extensionCommands","orion/compare/diffParser"],function(e,t){function i(e,t,i){this._serviceRegistry=e,this._inputManager=t,this._editor=i,this._enabled=!1,this.init()}return i.prototype={init:function(){var e=this;this._changeListener=function(){e._enabled&&(e.occurrenceTimer&&window.clearTimeout(e.occurrenceTimer),e.occurrenceTimer=window.setTimeout(function(){e.occurrenceTimer=null,e.doDiff()},500))},this._inputManager.addEventListener("InputChanged",function(){var t=e._editor.getTextView();t&&t.removeEventListener("ModelChanged",e._changeListener);var i=e.service=e.getDiffer();i&&t&&t.addEventListener("ModelChanged",e._changeListener)})},isVisible:function(){return!!this.getDiffer()},getDiffer:function(){for(var t=this._inputManager.getFileMetadata(),i=this._serviceRegistry.getServiceReferences("orion.edit.diff"),n=0;n<i.length;n++){var o=i[n],r={};r.validationProperties=o.getProperty("validationProperties"),r.forceSingleItem=!0;var s=e._makeValidator(r,this._serviceRegistry);if(s.validationFunction.bind(s)(t))return this._serviceRegistry.getService(o)}return null},showAnnotations:function(e){var i=this,n=new t.DiffParser,o={metadata:this._inputManager.getFileMetadata()};e.computeDiff(this._editor.getEditorContext(),o).then(function(e){n.setLineDelim("\n"),n.parse("",e);var t=n.getOriginalBlocks(),o=n.getNewBlocks(),r=n.getDiffArray(),s=i.getDiffRanges(t,o,r);i._enabled&&i._editor.showDiffAnnotations(s)})},getDiffRanges:function(e,t){for(var i=[],n=0;n<t.length;n++){var o=t[n][0],r=e[n][1],s=t[n][1];i.push(0===s?{lineStart:o-1,lineEnd:o,type:"deleted"}:0===r?{lineStart:o-1,lineEnd:o+s-1,type:"added"}:{lineStart:o-1,lineEnd:o+s-1,type:"modified"})}return i},toggleEnabled:function(){this.setEnabled(!this.isEnabled())},setEnabled:function(e){this._enabled=e,this.doDiff()},isEnabled:function(){return this._enabled},doDiff:function(){if(this._enabled){if(this.service){var e=this;this._inputManager.save().then(function(){e.showAnnotations(e.service)})}}else this._editor.showDiffAnnotations([])}},i.prototype.constructor=i,{Differ:i}}),define("orion/editorView",["i18n!orion/edit/nls/messages","orion/editor/editor","orion/editor/eventTarget","orion/editor/textView","orion/editor/textModel","orion/editor/projectionTextModel","orion/editor/editorFeatures","orion/hover","orion/editor/contentAssist","orion/editor/emacs","orion/editor/vi","orion/editorPreferences","orion/widgets/themes/ThemePreferences","orion/widgets/themes/editor/ThemeData","orion/widgets/settings/EditorSettings","orion/searchAndReplace/textSearcher","orion/editorCommands","orion/globalCommands","orion/edit/dispatcher","orion/edit/editorContext","orion/edit/typedefs","orion/highlight","orion/markOccurrences","orion/syntaxchecker","orion/liveEditSession","orion/problems","orion/blamer","orion/differ","orion/keyBinding","orion/util","orion/Deferred","orion/webui/contextmenu","orion/metrics","orion/objects"],function(e,t,i,n,o,r,s,a,l,c,d,h,u,p,f,g,m,v,_,y,C,w,b,S,x,L,T,E,k,N,A,R,I,D){function P(e,t){for(var i=0;i<t.length;i++){var n=t[i];e[n]&&(e[n]=parseInt(e[n],10))}}function M(e){this._parent=e.parent,"string"==typeof this._parent&&(this._parent=document.getElementById(e.parent)),this.id=e.id||"",this.activateContext=e.activateContext,this.renderToolbars=e.renderToolbars,this.serviceRegistry=e.serviceRegistry,this.contentTypeRegistry=e.contentTypeRegistry,this.commandRegistry=e.commandRegistry,this.progress=e.progress,this.statusService=e.statusService,this.editorCommands=e.editorCommands,this.fileClient=e.fileService,this.inputManager=e.inputManager,this.preferences=e.preferences,this.readonly=e.readonly,this.searcher=e.searcher,this.statusReporter=e.statusReporter,this.model=e.model,this.undoStack=e.undoStack,this.problemsServiceID=e.problemsServiceID||"orion.core.marker",this.editContextServiceID=e.editContextServiceID||"orion.edit.context",this.syntaxHighlighter=new w.SyntaxHighlighter(this.serviceRegistry),this.typeDefRegistry=new C(this.serviceRegistry);var t=v.getKeyAssist?v.getKeyAssist():null;t&&t.addProvider(this.editorCommands);var i=v.getMainSplitter?v.getMainSplitter():null;i&&i.splitter.addEventListener("resize",function(e){this.editor&&e.node===i.main&&this.editor.resize()}.bind(this)),v.getGlobalEventTarget&&v.getGlobalEventTarget().addEventListener("toggleTrim",function(){this.editor&&this.editor.resize()}.bind(this)),this.settings={},this._init()}var O="/__embed/",B=_.Dispatcher;return M.prototype={updateKeyMode:function(e,t){this.emacs&&t.removeKeyMode(this.emacs),this.vi&&t.removeKeyMode(this.vi),"Emacs"===e.keyBindings?(this.emacs||(this.emacs=new c.EmacsMode(t)),t.addKeyMode(this.emacs)):"vi"===e.keyBindings&&(this.vi||(this.vi=new d.VIMode(t,this.statusReporter)),t.addKeyMode(this.vi))},setContents:function(e,t){var i=this.contentTypeRegistry.getContentType(t),n="txt";i&&i.extension&&i.extension.length>0&&(n=i.extension[0]);var o,r=O+this.id+"/foo."+n,s=r===this.lastFileLocation;return o=s||!this.lastFileLocation?(new A).resolve():this.fileClient.deleteFile(this.lastFileLocation),o.then(function(){return this.fileClient.write(r,e).then(function(){this.lastFileLocation=r,s?this.inputManager.load():this.inputManager.setInput(r)}.bind(this))}.bind(this))},getParent:function(){return this._parent},getSettings:function(){return this.settings},setParent:function(e){this._parent=e},updateSourceCodeActions:function(e,t){t&&(t.setAutoPairParentheses(e.autoPairParentheses),t.setAutoPairBraces(e.autoPairBraces),t.setAutoPairSquareBrackets(e.autoPairSquareBrackets),t.setAutoPairAngleBrackets(e.autoPairAngleBrackets),t.setAutoPairQuotations(e.autoPairQuotations),t.setAutoCompleteComments(e.autoCompleteComments),t.setSmartIndentation(e.smartIndentation))},updateViewOptions:function(e){var t=0;e.showMargin&&(t=e.marginOffset,"number"!=typeof t&&(t=e.marginOffset=parseInt(t,10)));var i=0;return e.wordWrap&&(i=t),{readonly:this.readonly||this.inputManager.getReadOnly(),tabSize:e.tabSize||4,expandTab:e.expandTab,wrapMode:e.wordWrap,wrapOffset:i,marginOffset:t,scrollAnimation:e.scrollAnimation?e.scrollAnimationTimeout:0}},updateSettings:function(e){this.settings=e;var t=this.editor,i=this.inputManager;i.setAutoLoadEnabled(e.autoLoad),i.setAutoSaveTimeout(e.autoSave?e.autoSaveTimeout:-1),i.setSaveDiffsEnabled(e.saveDiffs),this.differ.setEnabled(this.settings.diffService),this.updateStyler(e);var n=t.getTextView();n&&(this.updateKeyMode(e,n),n.setOptions(this.updateViewOptions(e))),this.updateSourceCodeActions(e,t.getSourceCodeActions()),t.setAnnotationRulerVisible(e.annotationRuler),t.setLineNumberRulerVisible(e.lineNumberRuler),t.setFoldingRulerVisible(e.foldingRuler),t.setOverviewRulerVisible(e.overviewRuler),t.setZoomRulerVisible(e.zoomRuler),this.renderToolbars&&this.renderToolbars(i.getFileMetadata()),this.markOccurrences.setOccurrencesVisible(e.showOccurrences),t.getContentAssist()&&t.getContentAssist().setAutoTriggerEnabled(e.contentAssistAutoTrigger),this.dispatchEvent({type:"Settings",newSettings:this.settings})},updateStyler:function(e){var t=this.syntaxHighlighter.getStyler();t&&t.setWhitespacesVisible&&t.setWhitespacesVisible(e.showWhitespaces,!0)},createSession:function(e){var t=this.editor,i=t.getTextView(),n=this.inputManager;if(i&&n){var o=n.getFileMetadata();o&&(e.session={get:function(){return sessionStorage.editorViewSection?JSON.parse(sessionStorage.editorViewSection):{}},apply:function(e){var n=this.get(),r=n[o.Location];r&&r.ETag===o.ETag&&(t.setSelections(r.selections),i.setTopIndex(r.topIndex,e?function(){}:void 0))},save:function(){var e=this.get();e[o.Location]={ETag:o.ETag,topIndex:i.getTopIndex(),selections:t.getSelections().map(function(e){return e.getOrientedSelection()})},sessionStorage.editorViewSection=JSON.stringify(e)}})}},_init:function(){this.preferences&&(this.editorCommands.editorPreferences=this.editorPreferences=this.editorCommands.editorPreferences||new h.EditorPreferences(this.preferences),this.editorPreferences.addEventListener("Changed",function(e){var t=e.preferences;t?this.updateSettings(t):this.editorPreferences.getPrefs(this.updateSettings.bind(this))}.bind(this)),this.editorCommands.themePreferences=this.themePreferences=this.editorCommands.themePreferences||new u.ThemePreferences(this.preferences,new p.ThemeData),this.themePreferences.apply());var i=this,c=this.readonly,d=this.commandRegistry,v=this.serviceRegistry,_=this.activateContext,C=this.inputManager,w=this.progress,N=this.contentTypeRegistry,A=this.editorCommands,R=function(){var e=i.updateViewOptions(i.settings);D.mixin(e,{parent:i._parent,model:new r.ProjectionTextModel(i.model||new o.TextModel),wrappable:!0});var t=new n.TextView(e);return t},I=function(t,n,o,r){var a=i.textSearcher=g.TextSearcher?new g.TextSearcher(t,v,d,o):null,l=(new s.KeyBindingsFactory).createKeyBindings(t,o,r,a);i.updateSourceCodeActions(i.settings,l.sourceCodeActions);var c=t.getTextView();return c.setAction("toggleWrapMode",function(){c.invokeAction("toggleWrapMode",!0);var e=c.getOptions("wrapMode");return i.settings.wordWrap=e,i.editorPreferences&&i.editorPreferences.setPrefs(i.settings),!0}),c.setKeyBinding(new k.KeyStroke("z",!0,!1,!0),"toggleZoomRuler"),c.setAction("toggleZoomRuler",function(){return i.settings.zoomRulerVisible?(i.settings.zoomRuler=!i.settings.zoomRuler,i.editorPreferences&&i.editorPreferences.setPrefs(i.settings),!0):!1},{name:e.toggleZoomRuler}),i.vi=i.emacs=null,i.updateKeyMode(i.settings,c),A.overwriteKeyBindings(t),l},M=function(e,t,n){var o=C.getContentType(),r=e.getTitle(),s=v.getServiceReferences("orion.edit.contentAssist").concat(v.getServiceReferences("orion.edit.contentassist")),a=n&&n.providers;a||(a=s.map(function(e){var t=e.getProperty("contentType"),i=e.getProperty("pattern");if(t&&N.isSomeExtensionOf(o,t)||i&&new RegExp(i).test(r)){var n=v.getService(e),s=e.getProperty("service.id").toString(),a=e.getProperty("charTriggers"),l=e.getProperty("excludedStyles");return a&&(a=new RegExp(a)),l&&(l=new RegExp(l)),{provider:n,id:s,charTriggers:a,excludedStyles:l}}return null}).filter(function(e){return!!e}));var l={};Object.keys(y).forEach(function(e){"function"==typeof y[e]&&(l[e]=y[e].bind(null,v,i.editContextServiceID))}),t.setEditorContextProvider(l),t.setProviders(a),t.setAutoTriggerEnabled(i.settings.contentAssistAutoTrigger),t.setProgress(w),t.setStyleAccessor(i.getStyleAccessor())},O=c?null:{createContentAssistMode:function(e){var t=new l.ContentAssist(e.getTextView(),v);t.addEventListener("Activating",M.bind(null,e,t));var i=new l.ContentAssistWidget(t,"contentassist"),n=new l.ContentAssistMode(t,i);return t.setMode(n),M(e,t),t.initialize(),n}},F=this.editor=new t.Editor({textViewFactory:R,undoStackFactory:i.undoStack?{createUndoStack:function(e){return i.undoStack.setView(e.getTextView()),i.undoStack}}:new s.UndoFactory,textDNDFactory:new s.TextDNDFactory,annotationFactory:new s.AnnotationFactory,foldingRulerFactory:new s.FoldingRulerFactory,zoomRulerFactory:new s.ZoomRulerFactory,lineNumberRulerFactory:new s.LineNumberRulerFactory,hoverFactory:new a.HoverFactory(v,C,d),contentAssistFactory:O,keyBindingFactory:I,statusReporter:this.statusReporter,domNode:this._parent});F.id="orion.editor",F.processParameters=function(e){return P(e,["start","end","line","offset","length"]),this.showSelection(e.start,e.end,e.line,e.offset,e.length)},F.getEditorContext=function(){return y.getEditorContext(v,i.editContextServiceID)},this.dispatcher=new B(this.serviceRegistry,this.contentTypeRegistry,F,C),this.themePreferences&&this.editorPreferences&&(this.localSettings=f?new f({local:!0,editor:F,themePreferences:this.themePreferences,preferences:this.editorPreferences}):null);var j=new x(v,F);C.addEventListener("InputChanging",function(e){i.createSession(e)}),window.addEventListener("beforeunload",function(e){i.createSession(e),e.session&&e.session.save()}),C.addEventListener("InputChanged",function(e){i.createSession(e);var t=F.getTextView();t?(j.start(C.getContentType(),e.title),t.setOptions(this.updateViewOptions(this.settings)),this.markOccurrences.setOccurrencesVisible(this.settings.showOccurrences),this.syntaxHighlighter.setup(e.contentType,F.getTextView(),F.getAnnotationModel(),e.title,!0).then(function(){this.updateStyler(this.settings),F.getContentAssist()&&M(F,F.getContentAssist())}.bind(this)),t.onInputChanged&&t.onInputChanged({type:e.type})):j.start()}.bind(this)),C.addEventListener("Saving",function(e){i.settings.trimTrailingWhiteSpace&&F.getTextView().invokeAction("trimTrailingWhitespaces");var t=F.getTextView();t&&t.onSaving&&t.onSaving({type:e.type})}),this.blamer=new T.Blamer(v,C,F),this.differ=new E.Differ(v,C,F),this.problemService=new L.ProblemService(v,this.problemsServiceID);var V=v.getService(this.problemsServiceID);V&&V.addEventListener("problemsChanged",function(e){F.showProblems(e.problems)});var U=this.markOccurrences=new b.MarkOccurrences(v,C,F);U.setOccurrencesVisible(this.settings.showOccurrences),U.findOccurrences();var W=new S.SyntaxChecker(v,F.getModel());F.addEventListener("InputChanged",function(t){W.setTextModel(F.getModel());var n=C.getInput();W.checkSyntax(C.getContentType(),t.title,t.message,t.contents,F.getEditorContext()).then(function(e){n===C.getInput()&&e&&v.getService(i.problemsServiceID)._setProblems(e)}),C.getReadOnly()&&F.reportStatus(e.readonly,"error")});var z=Object.create(null);["getCaretOffset","setCaretOffset","getSelection","getSelectionText","setSelection","getSelections","setSelections","getText","setText","getLineAtOffset","getLineStart","isDirty","markClean"].forEach(function(e){z[e]=F[e].bind(F)}),z.showMarkers=function(e){v.getService(i.problemsServiceID)._setProblems(e)},z.enterLinkedMode=function(e){F.getLinkedMode().enterLinkedMode(e)},z.exitLinkedMode=function(e){F.getLinkedMode().exitLinkedMode(e)},z.openEditor=function(e,t){_.openEditor(e,t)},z.getFileMetadata=function(){return i.dispatcher.getServiceFileObject()},z.setStatus=m.handleStatusMessage.bind(null,v),v.registerService(this.editContextServiceID,z,null)},create:function(){this.editor.install(),this.editorPreferences&&this.editorPreferences.getPrefs(this.updateSettings.bind(this)),this._createContextMenu()},destroy:function(){this.lastFileLocation&&this.fileClient.deleteFile(this.lastFileLocation),this.editor.uninstall()},getStyleAccessor:function(){var e=null,t=this.syntaxHighlighter.getStyler();return t&&t.getStyleAccessor&&(e=t.getStyleAccessor()),e},_createContextMenu:function(){this._editorContextMenuNode=document.createElement("ul"),this._editorContextMenuNode.className="dropdownMenu",this._editorContextMenuNode.setAttribute("role","menu"),this._parent.parentNode.appendChild(this._editorContextMenuNode);var e=this.editor.getTextView(),t=new R.ContextMenu({dropdown:this._editorContextMenuNode,triggerNode:e._clientDiv}),i=function(e){var t=e.event;t.target&&(this.commandRegistry.destroy(this._editorContextMenuNode),this.commandRegistry.renderCommands("editorContextMenuActions",this._editorContextMenuNode,null,this,"menu"),I.logEvent("contextMenu","opened","editor"))}.bind(this);t.addEventListener("triggered",i)}},i.EventTarget.addMixin(M.prototype),{EditorView:M}}),define("orion/editorPluginView",["orion/editor/editor","orion/commands","orion/objects","orion/webui/littlelib"],function(e,t,i,n){function o(e,t){if(!e)return void window.console.log(t);var i=t.responseText;if(i)try{t=JSON.parse(i)}catch(n){t={Severity:"Error",Message:i}}e.setProgressResult(t)}function r(e){a.apply(this,arguments),this.editorService=e.editorService,this.id=this.editorService.getProperty("id"),this.metadata=e.metadata,this.serviceRegistry=e.serviceRegistry,this.pluginRegistry=e.pluginRegistry,this.statusService=e.statusService,this.inputManager=e.inputManager,this.activate=e.activate,this.editModelContextServiceID=e.editModelContextServiceID}function s(e){this._parent=e.parent,this.serviceRegistry=e.serviceRegistry,this.pluginRegistry=e.pluginRegistry,this.contentTypeRegistry=e.contentTypeRegistry,this.commandRegistry=e.commandRegistry,this.statusService=e.statusService,this.progressService=e.progressService,this.editorService=e.editorService,this.editorCommands=e.editorCommands,this.editModelContextServiceID=e.editModelContextServiceID,this.metadata=e.metadata,this.inputManager=e.inputManager,this.readonly=e.readonly,this.model=e.model,this.undoStack=e.undoStack}var a=e.BaseEditor;return r.prototype=Object.create(a.prototype),i.mixin(r.prototype,{_getPlugin:function(){return this.pluginRegistry.getPlugin(this.editorService._properties.__plugin__)},_load:function(){for(var e=this.serviceRegistry,i=e.getServiceReferences("orion.edit.editor"),n=0;n<i.length;n++)i[n].getProperty("id")===this.id&&(this.editorService=i[n]);var o=e.getService(this.editorService);if(o.setBlob&&o.setBlob(new Blob([this._contents],{type:this.inputManager.getContentType().id})),o.setTextModel){var r=e.getService(e.getServiceReferences(this.editModelContextServiceID)[0]),s=this;s.oldSetText=r.setText,r.setText=function(){s.serviceChangingText=!0;var e=s.oldSetText.apply(r,arguments);return s.serviceChangingText=!1,e},r.processKey=function(e){t.processKey(e)},o.setTextModel(r)}if(o.registerKeys){var a=t.getKeyBindings(),l=[];Object.keys(a).forEach(function(e){var t=a[e].keyBinding;l.push({keyCode:t.keyCode,mod1:t.mod1,mod2:t.mod2,mod3:t.mod3,mod4:t.mod4})}),o.registerKeys(l)}this.activate()},install:function(){var e=n.node(this._domNode),t=this._rootDiv=document.createElement("div");t.style.width="100%",t.style.height="100%",t.style.overflow="hidden";var i=this,r=this._getPlugin();r.setParent(t).then(function(){i._load()},function(e){o(i.statusService,e)}),e.appendChild(t),a.prototype.install.call(this)},onChanged:function(e){a.prototype.onChanged.call(this,e);var t=this.serviceRegistry.getService(this.editorService);t&&t.onChanged&&(e.isService=this.serviceChangingText,t.onChanged(e))},setInput:function(e,t,i,n){"string"!=typeof i&&(this._contents=i),a.prototype.setInput.call(this,e,t,i,n)},uninstall:function(){var e=this._getPlugin();e.setParent(null);var t=this.serviceRegistry;if(this.oldSetText){var i=t.getService(t.getServiceReferences(this.editModelContextServiceID)[0]);i.setText=this.oldSetText}n.empty(this._domNode),a.prototype.uninstall.call(this)}}),s.prototype={create:function(){this.editor=new r({domNode:this._parent,model:this.model,undoStack:this.undoStack,activate:function(){this.editorCommands.updateCommands(this)}.bind(this),serviceRegistry:this.serviceRegistry,pluginRegistry:this.pluginRegistry,editorService:this.editorService,statusService:this.statusService,inputManager:this.inputManager,editModelContextServiceID:this.editModelContextServiceID,metadata:this.metadata}),this.editor.install()},destroy:function(){this.editor&&this.editor.destroy(),this.editor=null}},{PluginEditorView:s,PluginEditor:r}}),define("orion/markdownEditor",["orion/i18nUtil","i18n!orion/nls/messages","marked/marked","orion/commands","orion/keyBinding","orion/editor/annotations","orion/editor/editor","orion/editor/textStyler","orion/editor/util","orion/fileCommands","orion/objects","orion/webui/littlelib","orion/URITemplate","orion/PageUtil","orion/webui/splitter","orion/metrics","orion/URL-shim"],function(e,t,i,n,o,r,s,a,l,c,d,h,u,p,f,g){function m(e,t){var i=[],n=0;T.lastIndex=0;for(var o=T.exec(e);o;){o.index&&(n+=o.index,e=e.substring(o.index));for(var r=0;r<t.length;r++){var s=t[r].exec(e);if(s)break}s&&i.push({match:s,index:n,pattern:t[r]}),T.lastIndex=s?s[0].length:1,o=T.exec(e)}return i}function v(e){e=e.replace(D,function(e,t){return'" '+N+'="'+t});for(var t=m(e,[i.InlineLexer.rules.reflink]),n=t.length-1;n>=0;n--){var o=t[n],r='<a href="'+R+'" '+N+'="'+(o.match[2]||o.match[1])+'">'+o.match[1]+"</a>";e=e.substring(0,o.index)+r+e.substring(o.index+o.match[0].length)}return e}function _(e,t,i){return function(n,o){if(-1===o.href.indexOf(":"))try{var r;if("filesystem:"===e.protocol?r={href:"filesystem:"+new URL(o.href,e.pathname).href}:(r=new URL(o.href,e),i&&(r.protocol="",r.host="")),"!"!==n[0][0]){var s={editor:"orion.editor.markdown"};r.hash&&(s.anchor=r.hash.substring(1),r.hash=""),o.href=x.expand({resource:r.href,params:s})}else{var a=B[r.href];if(a)return"<img id='"+a.id+"' src='"+(a.src?a.src:"")+"'>";if(t.readBlob){var l="_md_img_"+k++;return function(e,i){t.readBlob(i).then(function(t){var n=i.match(L),o=n?"image/"+n[1]:"image/png",r=URL.createObjectURL(new Blob([t],{type:o})),s=document.getElementById(e);s?(s.src=r,B[i]={id:e,src:r}):URL.revokeObjectURL(r)}.bind(this),function(){var t=document.getElementById(e);t&&(t.src="missing")}.bind(this))}.bind(this)(l,r.href),"<img id='"+l+"' src=''>"}o.href=r.href}}catch(c){window.console.log(c)}return E.call(this,n,o)}}function y(n,o,r,s){function a(i){var n=c.getModelEventDispatcher();n&&"function"==typeof n.dispatchEvent&&n.dispatchEvent({type:"create",parent:i.Parents[0]}),o.write(i.Location,u).then(function(){s.setProgressResult({Message:e.formatMessage(t["Wrote: ${0}"],i.Name),Severity:"Normal"})},function(e){e.responseText||(e={Message:t.UnknownError,Severity:"Error"}),s.setProgressResult(e)})}function l(e){412===e.status&&99>g?(g++,d()):(e.responseText||(e={Message:t.UnknownError,Severity:"Error"}),s.setProgressResult(e))}function d(){var e=g?p+"("+g+").html":p+".html";o.createFile(r.Parents[0].Location,e).then(a,l)}var h=i.InlineLexer.prototype.outputLink;i.InlineLexer.prototype.outputLink=E;var u=i.parse(n,M);i.InlineLexer.prototype.outputLink=h;var p=r.Name,f=/(.*)\.[^.]*$/.exec(p);f&&(p=f[1]);var g=0;d()}function C(e){this.id="orion.editor.markdown",this._fileService=e.fileService,this._metadata=e.metadata,this._parent=e.parent,this._model=e.model,this._editorView=e.editorView,this._targetAnchor=e.anchor,this._previewClickListener=function(e){var t=this._findNearestBlockElement(e.target);if(t){for(var i=t.getBoundingClientRect(),n=(e.clientY-i.top)/(i.bottom-i.top),o=this._editorView.editor.getTextView(),r=this._stylerAdapter.getBlockWithId(this._stylerAdapter.getElementIdentifier(t)),s=o.getModel(),a=s.mapOffset(r.start,!0);-1===a;)r=r.parent,a=s.mapOffset(r.start,!0);var l=o.getLocationAtOffset(a),c=s.mapOffset(r.end,!0);if(-1===c)for(var d=this._styler.getBlockAtIndex(r.end-1);-1===c;)d=d.parent,c=s.mapOffset(d.start,!0);var h=o.getLocationAtOffset(c),u=o.getLineAtOffset(c);h.y+=o.getLineHeight(u);var p=l.y+(h.y-l.y)*n,g=this._editorDiv.getBoundingClientRect();if(this._splitter.getOrientation()===f.ORIENTATION_VERTICAL)var m=g.height/2;else m=e.clientY-g.top;this._scrollSourceEditor(p-m)}}.bind(this),this._settingsListener=function(e){this._styler.setWhitespacesVisible(e.newSettings.showWhitespaces,!0)}.bind(this),this._sourceScrollListener=function(e){if(this._ignoreEditorScrollsCounter)return void this._ignoreEditorScrollsCounter--;if(!e.newValue.y)return void this._scrollPreviewDiv(0);var t=this._editorView.editor.getTextView(),i=t.getBottomIndex();if(i===t.getModel().getLineCount()-1)return void this._scrollPreviewDiv(this._previewWrapperDiv.scrollHeight);var n=t.getTopIndex(),o=t.getCaretOffset(),r=t.getLineAtOffset(o);if(r>=n&&i>=r)var s=o;else s=t.getOffsetAtLocation(0,Math.floor(e.newValue.y+this._previewWrapperDiv.clientHeight/2));s=t.getModel().mapOffset(s);for(var a=this._styler.getBlockAtIndex(s),l=this._stylerAdapter.getElementByIdentifier(a.elementId);!l&&a.parent;)a=a.parent,l=this._stylerAdapter.getElementByIdentifier(a.elementId);this._alignPreviewOnSourceBlock(a,s)}.bind(this),this._sourceSelectionListener=function(e){for(var t=this._editorView.editor.getTextView().getModel(),i=Array.isArray(e.newValue)?e.newValue[0]:e.newValue,n=t.mapOffset(i.start),o=this._styler.getBlockAtIndex(n),r=this._stylerAdapter.getElementByIdentifier(o.elementId);!r&&o.parent;)o=o.parent,r=this._stylerAdapter.getElementByIdentifier(o.elementId);this._selectedElement&&this._selectedElement!==r&&this._selectedElement.classList.remove(this._markdownSelected),this._selectedElement=r,this._selectedBlock=o,this._selectedElement&&this._selectedElement.classList.add(this._markdownSelected);var s=this._editorView.editor.getTextView(),a=s.getLineAtOffset(i.start),l=s.getTopIndex(!0),c=s.getBottomIndex(!0);a>=l&&c>=a&&this._alignPreviewOnSourceBlock(o,n)}.bind(this),this._splitterResizeListener=function(){this._editorView.editor.resize()}.bind(this);var t=function(e){var i=p.matchResourceParameters(e.oldURL),n=p.matchResourceParameters(e.newURL);return i.resource!==n.resource||i.editor!==n.editor?void window.removeEventListener("hashchange",t):void(n.anchor&&(this._scrollToAnchor(n.anchor),window.location.hash=x.expand({resource:n.resource,params:{editor:n.editor}})))}.bind(this);window.addEventListener("hashchange",t),F.apply(this,arguments)}function w(e){this._options=e;var i="markdown.generate.html",r=new n.Command({name:t.GenerateHTML,tooltip:t.GenerateHTMLTooltip,id:i,visibleWhen:function(){return!!this._options}.bind(this),callback:function(){var t=e.editorView.editor.getTextView(),i=t.getText();y(i,e.fileService,e.metadata,e.statusService)}});e.commandRegistry.addCommand(r),e.commandRegistry.registerCommandContribution(e.menuBar.toolsActionsScope,i,1,"orion.menuBarToolsGroup",!1,new o.KeyBinding("G",!0,!1,!0)),i="markdown.toggle.orientation",b=new n.Command({id:i,callback:function(){this.editor&&this.editor.togglePaneOrientation()}.bind(this),type:"switch",imageClass:"core-sprite-split-pane-orientation",tooltip:t.TogglePaneOrientationTooltip,visibleWhen:function(){return!!this._options}.bind(this)}),e.commandRegistry.addCommand(b),e.commandRegistry.registerCommandContribution("settingsActions",i,1,null,!1)}var b,S,x=new u("#{,resource,params*}"),L=/\.([0-9a-z]+)(?:[\?#]|$)/i,T=/!?\[/g,E=i.InlineLexer.prototype.outputLink,k=0,N="refId",A="_orionMDBlock",R="about:blank",I="?orionMDRefLinkID:",D=/\?orionMDRefLinkID:([^"]+")/g,P=new i.Renderer;P.listitem=function(e){var t=i.Renderer.prototype.listitem.call(this,e);return v(t)},P.paragraph=function(e){var t=i.Renderer.prototype.paragraph.call(this,e);return v(t)};var M=d.clone(i.parse.defaults);M.sanitize=!0,M.tables=!0,M.renderer=P;var O=function(e,t,n){this.model=e,this._blocksCache={},this._defBlocks={},this._linkDefs={};var o=new URL(t,window.location.href);i.InlineLexer.prototype.outputLink=_(o,n,-1===t.indexOf(":")),this._inlinePatterns=[];var r=0,s=Object.keys(i.InlineLexer.rules.gfm);s.forEach(function(e){if(0!==e.indexOf("_")){var t=i.InlineLexer.rules.gfm[e];if(t.source){var n=t.source.substring(1).replace(/\|\^/g,"|");n=n.replace(/[ ]\{2,\}/g,"(\\t| {2,})"),this._inlinePatterns.push({regex:new RegExp(n,"g"),name:e,index:r++})}}}.bind(this))};O.prototype={blockSpansBeyondEnd:function(){return!1},computeBlocks:function(e,t,n,o){var r,s=[];if(n.typeId){if("markup.quote.markdown"!==n.typeId&&"markup.list.markdown"!==n.typeId&&n.typeId!==this._TYPEID_LISTITEM)return s;r=n.seedTokens,n.seedTokens=null}var a=0;r=r||i.lexer(t,M);for(var l=0;l<r.length;l++){var c=null,d=null,h=null,u=null,p=null,f=null,g=null,m=null,v=null;d=null,this._whitespaceRegex.lastIndex=a;var _=this._whitespaceRegex.exec(t);if(_&&_.index===a&&(a+=_[0].length),"heading"===r[l].type){this._atxDetectRegex.lastIndex=a;var y=this._atxDetectRegex.exec(t),C=y&&y.index===a,w=this._getLineEnd(t,a,e);h=C?w:this._getLineEnd(t,a,e,1),c={start:a,contentStart:a+(C?r[l].depth+1:0),contentEnd:w,end:h},d=this._TYPEID_HEADING,f=r[l],a=h}else if("paragraph"===r[l].type||"text"===r[l].type)h=this._advanceIndex(t,r[l],a),h=this._getLineEnd(t,h,e),this._isTop(n)?f=r[l]:(r[l].type="text",g=[r[l]]),c={start:a,contentStart:a,contentEnd:h,end:h},d=r[l].isHTML?"markup.raw.html.markdown":this._TYPEID_PARAGRAPH,a=h;else if("def"===r[l].type){var b=0;if(r[l].title){var S=t.indexOf(r[l].title,a+1),x=t.substring(a,S);y=x.match(this._newlineRegex),y&&(b=y.length)}h=this._getLineEnd(t,a,e,b),f=r[l],c={start:a,contentStart:a,contentEnd:h,end:h},d=this._TYPEID_DEF,a=h}else if("blockquote_start"===r[l].type||"list_start"===r[l].type){"blockquote_start"===r[l].type?(m="blockquote_end",d="markup.quote.markdown"):(m="list_end",d="markup.list.markdown");for(var L=a,T=l,E=0;;){if(r[T].type===r[l].type)E++;else if(r[T].type===m&&!--E)break;a=this._advanceIndex(t,r[T],a),T++}if(this._newlineRegex.lastIndex=a,y=this._newlineRegex.exec(t),y&&(a=y.index+y[0].length,"markup.list.markdown"===d&&(this._spacesAndTabsRegex.lastIndex=a,y=this._spacesAndTabsRegex.exec(t),y&&y.index===a&&(a+=y[0].length))),"markup.quote.markdown"===d){this._blockquoteStartRegex.lastIndex=L,y=this._blockquoteStartRegex.exec(t);var k=L+y[0].length}else{var N=t.substring(L);y=i.Lexer.rules.normal.bullet.exec(N),L+=y.index,k=L}a=Math.max(a,k),c={start:L,contentStart:k,contentEnd:a,end:a},p=r[l],m=r[T],v=r.slice(l+1,T),l=T}else if(-1!==r[l].type.indexOf("_item_start")){for(L=a,T=l,E=0;;){if("list_item_start"===r[T].type||"loose_item_start"===r[T].type)E++;else if("list_item_end"===r[T].type&&!--E)break;a=this._advanceIndex(t,r[T],a),T++}this._newlineRegex.lastIndex=a,y=this._newlineRegex.exec(t),y&&(a=y.index+y[0].length),N=t.substring(L),y=i.Lexer.rules.normal.bullet.exec(N),k=L+y.index+y[0].length,a=Math.max(a,k),c={start:L,contentStart:k,contentEnd:a,end:a},d=this._TYPEID_LISTITEM,p=r[l],m=r[T],v=r.slice(l+1,T),l=T
}else"code"===r[l].type?(r[l].hasOwnProperty("lang")?(L=a,u=r[l].text.match(this._newlineRegex),h=this._getLineEnd(t,a,e,2+(u?u.length:0)),d="markup.raw.code.fenced.gfm"):(L=this._getLineStart(t,a),u=r[l].text.match(this._newlineRegex),h=this._getLineEnd(t,a,e,u?u.length:0),this._whitespaceRegex.lastIndex=h,y=this._whitespaceRegex.exec(t),y&&y.index===h&&(h+=y[0].length),d="markup.raw.code.markdown"),c={start:L,contentStart:a,contentEnd:h,end:h},f=r[l],a=h):"hr"===r[l].type?(h=this._getLineEnd(t,a,e),c={start:a,contentStart:a,contentEnd:h,end:h},d="markup.other.separator.markdown",f=r[l],a=h):"table"===r[l].type?(h=this._getLineEnd(t,a,e,r[l].cells.length+1),c={start:a,contentStart:a,contentEnd:h,end:h},this._isTop(n)?(d="markup.other.table.gfm",f=r[l]):(d=this._TYPEID_PARAGRAPH,g=[{type:"text",text:t.substring(a,h)}]),a=h):"space"===r[l].type&&(c={start:a,contentStart:a,contentEnd:a,end:a},d=this._TYPEID_PARAGRAPH,g=[r[l]]);if(d){c.start=c.start+o,c.contentStart=c.contentStart+o,c.contentEnd=c.contentEnd+o,c.end=c.end+o;var A=this.createBlock(c,this._styler,e,n,d,function(e){n.name&&(e.name=n.name),e.startToken=p,f&&(e.tokens=[f]),e.endToken=m,e.seedTokens=v,g&&(e.parentTokens=g,e.doNotFold=!0)});s.push(A)}}return s},computeStyle:function(){return null},createBlock:function(e,t,i,n,o,r){var s=new a.Block(e,o,o,t,i,n,r);return s.elementId=A+this._elementCounter++,this._blocksCache[s.elementId]=s,s},getBlockContentStyleName:function(e){return e.name},getBlockEndStyle:function(){return null},getBlockFoldBounds:function(e,t){var i={start:e.start,end:e.end};return t.getText(e.end-1,e.end)===this._NEWLINE&&i.end--,i},getBlockForElement:function(e){if(e===S)return null;var t=this.getElementIdentifier(e);return t?this.getBlockWithId(t):this.getBlockForElement(e.parentElement)},getBlockStartStyle:function(){return null},getBlockWithId:function(e){return this._blocksCache[e]},getBracketMatch:function(){return null},getContentType:function(){return"text/x-markdown"},getElementByIdentifier:function(e,t){return h.$("."+e,t||S)},getElementIdentifier:function(e){for(var t=e.classList,i=0;i<t.length;i++)if(t[i]!==this._markdownSelected)return t[i];return""},initialPopulatePreview:function(){var e=this._styler.getRootBlock();this._onBlocksChanged({oldBlocks:[],newBlocks:e.getBlocks()})},parse:function(e,t,i,n,o){if(n.typeId){for(var r=n;r;){if(r.typeId&&!r.typeId.indexOf("markup.raw.code"))return;r=r.parent}var s=[];this._inlinePatterns.forEach(function(t){t.regex.lastIndex=0;var i=t.regex.exec(e);i&&s.push({result:i,pattern:t})}.bind(this)),s.sort(function(e,t){return e.result.index<t.result.index?-1:e.result.index>t.result.index?1:e.pattern.index<t.pattern.index?-1:1});for(var a=0;s.length>0;){var r=s[0];if(s.splice(0,1),r.result.index<a)this._updateMatch(r,e,s,a);else{var l=r.result.index;a=l+r.result[0].length;var c=null;-1!==r.pattern.name.indexOf("link")?c="markup.underline.link.markdown":"strong"===r.pattern.name?c="markup.bold.markdown":"em"===r.pattern.name?c="markup.italic.markdown":"code"===r.pattern.name?c="markup.raw.code.markdown":"br"===r.pattern.name?c="markup.other.br.markdown":"del"===r.pattern.name&&(c="markup.other.strikethrough.gfm"),c&&o.push({start:t+l,end:t+a,style:c,mergeable:!0}),this._updateMatch(r,e,s,a)}}}},setStyler:function(e){this._styler&&(this._styler.removeEventListener("BlocksChanged",this._onBlocksChanged),this._styler.removeAnnotationProvider(this._annotationProvider)),this._styler=e,e.addEventListener("BlocksChanged",this._onBlocksChanged.bind(this)),e.addAnnotationProvider(this._annotationProvider.bind(this))},setView:function(e){this._view=e},verifyBlock:function(e,t,i,n){for(var o=i;o;){if("markup.list.markdown"===o.typeId||"markup.quote.markdown"===o.typeId)return!1;o=o.parent}var r=this.computeBlocks(e,t,i.parent,i.start);return r.length&&r[0].start===i.start&&r[0].end===i.end+n&&r[0].typeId===i.typeId&&r[0].getBlocks().length===i.getBlocks().length},_adoptTokens:function(e,t){e.tokens=t.tokens;for(var i=e.getBlocks(),n=t.getBlocks(),o=0;o<Math.min(i.length,n.length);o++)this._adoptTokens(i[o],n[o])},_advanceIndex:function(e,t,n){if(t.text){this._whitespaceRegex.lastIndex=0;var o=t.text.split(this._whitespaceRegex);o.forEach(function(t){t.length&&(n=e.indexOf(t,n)+t.length)})}else if("blockquote_start"===t.type){this._blockquoteStartRegex.lastIndex=n;var r=this._blockquoteStartRegex.exec(e);n=r.index+r[0].length}else"hr"===t.type?(this._hrRegex.lastIndex=n,r=this._hrRegex.exec(e),n=r.index+r[0].length):"space"===t.type?(this._newlineRegex.lastIndex=n,r=this._newlineRegex.exec(e),n=r.index+r[0].length):"table"===t.type?(o=t.header.slice(),t.cells.forEach(function(e){o=o.concat(e)}),o.forEach(function(t){t.length&&(n=e.indexOf(t,n)+t.length)})):-1!==t.type.indexOf("_item_start")&&(e=e.substring(n),r=i.Lexer.rules.normal.bullet.exec(e),r?n+=r.index+r[0].length:g.logEvent("status","error","MD2 "+t.type+": "+e.substring(0,40)));return n},_annotationProvider:function(e,t,i,n,o,s,a){for(var l=e.getAnnotations(i.start,i.end);l.hasNext();){var c=l.next();c.type===r.AnnotationType.ANNOTATION_WARNING&&c.start<=o&&n<=c.end&&s.push(c)}this._computeAnnotations(e,t,i,n,o,a)},_computeAnnotations:function(n,o,s,a,l,c){if(s.start<=l&&a<=s.end)if(s.typeId===this._TYPEID_HEADING){if(6===s.tokens[0].depth){var d=o.getText(s.start,s.contentStart),h=this._leadingHashesRegex.exec(d);h&&h[0].length>6&&c.push(r.AnnotationType.createAnnotation(r.AnnotationType.ANNOTATION_WARNING,s.start,s.start+h[0].length,t.WarningHeaderTooDeep))}}else if(s.typeId===this._TYPEID_LISTITEM){d=o.getText(s.start,s.contentStart+1),this._orderedListRegex.lastIndex=0;var u=this._orderedListRegex.test(d),p=s.parent.startToken.ordered;u!==p?c.push(r.AnnotationType.createAnnotation(r.AnnotationType.ANNOTATION_WARNING,s.start,s.contentStart,u?t.WarningOrderedListItem:t.WarningUnorderedListItem)):p&&s.parent.getBlocks()[0]===s&&d.indexOf("1.")&&c.push(r.AnnotationType.createAnnotation(r.AnnotationType.ANNOTATION_WARNING,s.start,s.contentStart,t.WarningOrderedListShouldStartAt1))}else if(s.typeId===this._TYPEID_DEF){var f=this._linkDefs[s.tokens[0].id];f.block.start!==s.start&&c.push(r.AnnotationType.createAnnotation(r.AnnotationType.ANNOTATION_WARNING,s.start,s.end,e.formatMessage(t.WarningDuplicateLinkId,s.tokens[0].id)))}else if(s.typeId===this._TYPEID_PARAGRAPH){d=o.getText(s.start,s.end);var g=m(d,[i.InlineLexer.rules.link,i.InlineLexer.rules.reflink]);g.forEach(function(n){var o=s.start+n.index;if(n.match[1])if(n.pattern===i.InlineLexer.rules.link)n.match[2]||c.push(r.AnnotationType.createAnnotation(r.AnnotationType.ANNOTATION_WARNING,o,o+n.match[0].length,t.WarningLinkHasNoURL));else{var a=(n.match[2]||n.match[1]).toLowerCase();this._linkDefs[a]||c.push(r.AnnotationType.createAnnotation(r.AnnotationType.ANNOTATION_WARNING,o,o+n.match[0].length,e.formatMessage(t.WarningUndefinedLinkId,a)))}else c.push(r.AnnotationType.createAnnotation(r.AnnotationType.ANNOTATION_WARNING,o,o+n.match[0].length,t.WarningLinkHasNoText))}.bind(this))}s.getBlocks().forEach(function(e){this._computeAnnotations(n,o,e,a,l,c)}.bind(this))},_generateHTML:function(e,t){if(t.startToken||t.tokens){if(t.tokens){var n=t.tokens.slice();return n.links=this._linkDefs,void(e.innerHTML=i.Parser.parse(n,M))}if(t.startToken){n=[t.startToken,t.endToken],n.links=this._linkDefs,e.innerHTML=i.Parser.parse(n,M);var o=function(o){n=[t.startToken].concat(o).concat(t.endToken),n.links=this._linkDefs;var r=document.createElement("div");r.innerHTML=i.Parser.parse(n,M);for(var s=r.children[0].childNodes;s.length;)e.children[0].appendChild(s[0])}.bind(this),r=[];t.getBlocks().forEach(function(t){if(t.parentTokens)r=r.concat(t.parentTokens);else{r.length&&(o(r),r=[]);var i=document.createElement("div");this._generateHTML(i,t),i=i.children[0]||i,this._setElementIdentifier(i,t.elementId),e.children[0].appendChild(i)}}.bind(this)),r.length&&o(r)}}},_getLineStart:function(e,t){for(;0<=--t;){var i=e.charAt(t);if(i===this._NEWLINE||i===this._CR)return t+1}return 0},_getLineEnd:function(e,t,i,n){for(n=n||0;;){this._newlineRegex.lastIndex=t;var o=this._newlineRegex.exec(e);if(!o)return e.length;if(t=o.index+o[0].length,!n--)return t}},_isTop:function(e){return e.typeId?"markup.quote.markdown"===e.typeId?this._isTop(e.parent):!1:!0},_onBlocksChanged:function(e){if(1===e.oldBlocks.length&&1===e.newBlocks.length&&e.oldBlocks[0].elementId===e.newBlocks[0].elementId){if(!e.newBlocks[0].parent)return;var t=this.computeBlocks(this.model,this.model.getText(e.oldBlocks[0].start,e.oldBlocks[0].end),e.oldBlocks[0].parent,e.oldBlocks[0].start);if(e.newBlocks[0].tokens&&"def"===e.newBlocks[0].tokens[0].type){e.newBlocks[0]=t[0];var i=e.oldBlocks[0].elementId;e.newBlocks[0].elementId=i;for(var n=e.newBlocks[0].parent,o=n.getBlocks(),r=0;r<o.length;r++)if(o[r].elementId===i){o[r]=e.newBlocks[0];break}this._blocksCache[i]=e.newBlocks[0]}else this._adoptTokens(e.newBlocks[0],t[0])}var s={};e.oldBlocks.forEach(function(e){var t=e.tokens?e.tokens[0]:null;t&&"def"===t.type&&(delete this._defBlocks[e.elementId],s[t.id]||(s[t.id]=e))}.bind(this));var a={};e.newBlocks.forEach(function(e){var t=e.tokens?e.tokens[0]:null;t&&"def"===t.type&&(this._defBlocks[e.elementId]=e,t.block=e,t.href+=I+t.id,a[t.id]=a[t.id]||[s[t.id],e],delete s[t.id])}.bind(this));for(var l in s){var c=s[l];a[c.tokens[0].id]=[c,null]}for(l in a)if(c=a[l],c[1])c[0]?c[0].start===this._linkDefs[l].block.start&&(this._linkDefs[l]=c[1].tokens[0]):(!this._linkDefs[l]||c[1].start<this._linkDefs[l].block.start)&&(this._linkDefs[l]=c[1].tokens[0]);else if(c[0].start===this._linkDefs[l].block.start){delete this._linkDefs[l];var d=this._styler.getRootBlock(),h=d.getBlocks();for(r=0;r<h.length;r++){var u=h[r];if(u.typeId===this._TYPEID_DEF&&u.tokens[0].id===l&&u.start!==c[0].start){this._linkDefs[l]=u.tokens[0];break}}}if(Object.keys(a).length){var p=[],f=[],g=this._styler.getAnnotationModel(),m=this._styler.getTextModel(),v=[],_=S.getElementsByTagName("a");for(r=0;r<_.length;r++){var y=_[r].getAttribute(N);y&&a[y]&&v.push(this.getBlockForElement(_[r]))}var C=S.getElementsByTagName("img");for(r=0;r<C.length;r++)y=C[r].getAttribute(N),y&&a[y]&&v.push(this.getBlockForElement(C[r]));v.forEach(function(e){var t=document.createElement("div");this._generateHTML(t,e);var i=this.getElementByIdentifier(e.elementId);t.children[0].className=i.className,i.parentElement.replaceChild(t.children[0],i),g&&this._annotationProvider(g,m,e,e.start,e.end,f,p)}.bind(this));for(l in this._defBlocks)c=this._defBlocks[l],a[c.tokens[0].id]&&this._annotationProvider(g,m,c,c.start,c.end,f,p);(f.length||p.length)&&g.replaceAnnotations(f,p)}var w=0,b=[];if(e.oldBlocks.length)var x=this.getElementByIdentifier(e.oldBlocks[0].elementId),L=x.parentElement;else e.newBlocks.length&&(L=this.getElementByIdentifier(e.newBlocks[0].parent.elementId)),L||(L=S);for(r=0;r<L.children.length;r++)if(!x||this.getElementIdentifier(L.children[r])===e.oldBlocks[0].elementId){for(var T=r;T<r+e.oldBlocks.length;T++)b.push(L.children[T]);break}for(e.newBlocks.forEach(function(t){var i=document.createElement("div");for(this._generateHTML(i,t),r=w;r<e.oldBlocks.length;r++)if(e.oldBlocks[r].elementId===t.elementId){var n=b[r];for(T=r-1;T>=w;T--)L.removeChild(b[T]);w=r+1,this._updateNode(n,i.children[0]||i);break}r===e.oldBlocks.length&&(n=document.createElement("div"),this._updateNode(n,i),n=n.children[0]||n,b.length?L.insertBefore(n,b[w]):L.appendChild(n),this._setElementIdentifier(n,t.elementId))}.bind(this)),r=e.oldBlocks.length-1;r>=w;r--)L.removeChild(b[r])},_setElementIdentifier:function(e,t){for(var i=-1!==e.className.indexOf(this._markdownSelected),n=e.className.split(" "),o=n.length-1;o>=0;o--)n[o].length&&n[o].indexOf(A)||n.splice(o,1);n.push(t),i&&n.push(this._markdownSelected),e.className=n.join(" ")},_updateMatch:function(e,t,i,n){e.pattern.regex.lastIndex=n;var o=e.pattern.regex.exec(t);if(o){e.result=o;for(var r=0;r<i.length;r++)if(o.index<i[r].result.index||o.index===i[r].result.index&&e.pattern.index<i[r].pattern.index)return void i.splice(r,0,e);i.push(e)}},_updateNode:function(e,t){if(e.nodeName!==t.nodeName)return e.parentElement.replaceChild(t,e),void this._setElementIdentifier(t,this.getElementIdentifier(e));if("#text"===t.nodeName)return void(e.textContent=t.textContent);if("IMG"===t.nodeName){if(e.src!==t.src)return void e.parentElement.replaceChild(t,e)}else"TH"===t.nodeName||"TD"===t.nodeName?e.style.textAlign=t.style.textAlign:"A"===t.nodeName&&(e.href=t.href,e.title=t.title,t.attributes.refid&&(e.attributes.refid.value=t.attributes.refid.value));for(var i=0,n=[],o=[],r=e.childNodes,s=0;s<r.length;s++)n.push(r[s]);for(r=t.childNodes,s=0;s<r.length;s++)o.push(r[s]);for(o.forEach(function(t){var o=null;for(s=i;s<n.length;s++)if(n[s].nodeName===t.nodeName){o=n[s];for(var r=s-1;r>=i;r--)e.removeChild(n[r]);i=s+1;break}o?this._updateNode(o,t):n.length?e.insertBefore(t,n[i]):e.appendChild(t)}.bind(this)),s=n.length-1;s>=i;s--)e.removeChild(n[s])},_CR:"\r",_NEWLINE:"\n",_TYPEID_HEADING:"markup.heading.markdown",_TYPEID_LISTITEM:"markup.list.item.markdown",_TYPEID_PARAGRAPH:"markup.other.paragraph.markdown",_TYPEID_DEF:"meta.link.reference.def.markdown",_atxDetectRegex:/[>\s]*#/g,_blockquoteRemoveMarkersRegex:/^[ \t]*>[ \t]?/gm,_blockquoteStartRegex:/[ \t]*>[ \t]?/g,_elementCounter:0,_hrRegex:/([ \t]*[-*_]){3,}/g,_htmlNewlineRegex:/\n\s*\S[\s\S]*$/g,_leadingHashesRegex:/^#*/,_newlineRegex:/\n/g,_orderedListRegex:/\d+\.[ \t]/g,_spacesAndTabsRegex:/[ \t]*/g,_whitespaceRegex:/\s+/g};var B={},F=s.BaseEditor;return C.prototype=Object.create(F.prototype),d.mixin(C.prototype,{getPaneOrientation:function(){return this._splitter.getOrientation()},initSourceEditor:function(){var e=this._editorView.editor,t=e.getTextView(),i=e.getAnnotationModel();this._stylerAdapter=new O(this._model,this._metadata.Location,this._fileService),this._styler=new a.TextStyler(t,i,this._stylerAdapter),this._editorView.editor.getTextView().addEventListener("Scroll",this._sourceScrollListener),this._editorView.editor.getTextView().addEventListener("Selection",this._sourceSelectionListener),this._splitter.addEventListener("resize",this._splitterResizeListener),S.addEventListener("click",this._previewClickListener),this._model.getCharCount()&&this._stylerAdapter.initialPopulatePreview();var n=this._editorView.getSettings();this._styler.setWhitespacesVisible(n.showWhitespaces,!0);var o=function(){this._styler.removeEventListener("BlocksChanged",o),this._scrollToAnchor(this._targetAnchor);var e=p.matchResourceParameters(window.location.hash);window.location.hash=x.expand({resource:e.resource,params:{editor:e.editor}})}.bind(this);this._targetAnchor&&this._styler.addEventListener("BlocksChanged",o)},install:function(){this._rootDiv=document.createElement("div"),this._rootDiv.style.position="absolute",this._rootDiv.style.width="100%",this._rootDiv.style.height="100%",this._parent.appendChild(this._rootDiv),this._editorDiv=document.createElement("div"),this._rootDiv.appendChild(this._editorDiv),this._editorView.setParent(this._editorDiv),this._splitterDiv=document.createElement("div"),this._splitterDiv.id="orion.markdown.editor.splitter",this._rootDiv.appendChild(this._splitterDiv),this._previewWrapperDiv=document.createElement("div"),this._previewWrapperDiv.style.overflowX="hidden",this._previewWrapperDiv.style.overflowY="auto",this._rootDiv.appendChild(this._previewWrapperDiv),S=document.createElement("div"),S.classList.add("orionMarkdown"),this._previewWrapperDiv.appendChild(S),this._editorView.addEventListener("Settings",this._settingsListener),this._splitter=new f.Splitter({node:this._splitterDiv,sidePanel:this._editorDiv,mainPanel:this._previewWrapperDiv,toggle:!0,closeReversely:!0}),b.checked=this._splitter.getOrientation()===f.ORIENTATION_HORIZONTAL,F.prototype.install.call(this)},togglePaneOrientation:function(){var e=this._splitter.getOrientation()===f.ORIENTATION_VERTICAL?f.ORIENTATION_HORIZONTAL:f.ORIENTATION_VERTICAL;this._splitter.setOrientation(e)},uninstall:function(){this._styler.destroy(),this._editorView.removeEventListener("Settings",this._settingsListener);var e=this._editorView.editor.getTextView();e.removeEventListener("Scroll",this._sourceScrollListener),e.removeEventListener("Selection",this._sourceSelectionListener),this._splitter.removeEventListener("resize",this._splitterResizeListener),S.removeEventListener("click",this._previewClickListener),h.empty(this._parent),F.prototype.uninstall.call(this)},_alignPreviewOnSourceBlock:function(e,t){var i=this._editorView.editor.getTextView(),n=i.getModel(),o=this._stylerAdapter.getElementByIdentifier(e.elementId);if(o){var r=n.mapOffset(e.start,!0),s=n.mapOffset(e.end,!0);if(-1===s)for(var a=this._styler.getBlockAtIndex(e.end-1);-1===s;)a=a.parent,s=n.mapOffset(a.start,!0);var l=i.getLocationAtOffset(r),c=i.getLocationAtOffset(s),d=i.getLineAtOffset(s),h=i.getLineHeight(d);c.y+=h}else{var u=e.getBlockAtIndex(t),p=e.getBlocks(),g=u?p[u-1].end:0;if(u<p.length)var m=p[u].start;else m=this._model.getCharCount();l=i.getLocationAtOffset(n.mapOffset(g,!0));var v=n.mapOffset(m,!0);c=i.getLocationAtOffset(v),d=i.getLineAtOffset(v),h=i.getLineHeight(d),c.y+=h}var _=c.y-l.y,y=i.getLocationAtOffset(n.mapOffset(t,!0));y.y+=c.y-l.y===h?i.getLineHeight()/2:i.getLineHeight();var C=(y.y-l.y)/_,w=this._previewWrapperDiv.getBoundingClientRect();if(this._splitter.getOrientation()===f.ORIENTATION_VERTICAL)var b=(w.bottom-w.top)/2;else b=y.y-i.getTopPixel();if(o)var S=o.getBoundingClientRect(),x=S.top-w.top+this._previewWrapperDiv.scrollTop,L=x+o.offsetHeight*C;else{if(u<p.length)var T=this._stylerAdapter.getElementByIdentifier(p[u].elementId),E=T.getBoundingClientRect().top;else E=w.bottom;if(u)var k=this._stylerAdapter.getElementByIdentifier(p[u-1].elementId),N=k.getBoundingClientRect().bottom;else N=0;var A=N-w.top+this._previewWrapperDiv.scrollTop;L=A+(E-N)*C}this._scrollPreviewDiv(L-b)},_findNearestBlockElement:function(e){if(e===S)return null;for(var t=e,i=e,n=!0;n;){if(n=!1,t){if(!this._stylerAdapter.getElementIdentifier(t).indexOf(A))return t;t=t.nextElementSibling,n=!0}if(i){if(!this._stylerAdapter.getElementIdentifier(i).indexOf(A))return i;i=i.previousElementSibling,n=!0}}return this._findNearestBlockElement(e.parentElement)},_scrollPreviewDiv:function(e){this._scrollPreviewAnimation&&(this._scrollPreviewAnimation.stop(),this._scrollPreviewAnimation=null);var t=e-this._previewWrapperDiv.scrollTop;if(t){var i=this._editorView.getSettings();this._scrollPreviewAnimation=new l.Animation({window:window,curve:[t,0],duration:i.scrollAnimation?i.scrollAnimationTimeout:0,onAnimate:function(e){var i=t-Math.floor(e);this._previewWrapperDiv.scrollTop+=i,t-=i}.bind(this),onEnd:function(){this._scrollPreviewAnimation=null,this._previewWrapperDiv.scrollTop+=t}.bind(this)}),this._scrollPreviewAnimation.play()}},_scrollSourceEditor:function(e){this._scrollSourceAnimation&&(this._scrollSourceAnimation.stop(),this._scrollSourceAnimation=null);var t=this._editorView.editor.getTextView(),i=e-t.getTopPixel();if(i){var n=this._editorView.getSettings();this._scrollSourceAnimation=new l.Animation({window:window,curve:[i,0],duration:n.scrollAnimation?n.scrollAnimationTimeout:0,onAnimate:function(e){var n=i-Math.floor(e);t.setTopPixel(t.getTopPixel()+n),i-=n}.bind(this),onEnd:function(){this._scrollSourceAnimation=null;var e=Math.floor(t.getTopPixel()+i);this._ignoreEditorScrollsCounter=1,t.setTopPixel(e)}.bind(this)}),this._ignoreEditorScrollsCounter=1/0,this._scrollSourceAnimation.play()}},_scrollToAnchor:function(e){var t=document.getElementById(e);if(t){for(var i=this._editorView.editor.getTextView(),n=i.getModel(),o=this._stylerAdapter.getBlockWithId(this._stylerAdapter.getElementIdentifier(t)),r=n.mapOffset(o.start,!0);-1===r;)o=o.parent,r=n.mapOffset(o.start,!0);var s=i.getLineAtOffset(r),a=s?i.getLineHeight(s-1):0,l=i.getLocationAtOffset(r);this._scrollSourceEditor(l.y-a);var c=t.getBoundingClientRect(),d=c.top+window.scrollY+this._previewWrapperDiv.scrollTop,h=d-this._previewWrapperDiv.getBoundingClientRect().top;this._scrollPreviewDiv(h-a)}},_markdownSelected:"markdownSelected",_selectedBlock:null}),w.prototype={create:function(){this.editor=new C(this._options),this.editor.install(),this._options.editorView.create(),this.editor.initSourceEditor()},destroy:function(){this.editor.destroy(),this.editor=null,this._options.editorView.destroy(),this._options.editorView=null;var e=Object.keys(B);e.forEach(function(e){var t=B[e];URL.revokeObjectURL(t.src)}),B={},this._options=null}},{MarkdownEditorView:w}}),define("orion/status",["i18n!orion/nls/messages","orion/i18nUtil","orion/webui/littlelib","orion/globalCommands","marked/marked"],function(e,t,i,n,o){function r(e,t,i,n,o){this._serviceRegistry=e,this._serviceRegistration=e.registerService("orion.page.message",this),this._operationsClient=t,this.notificationContainerDomId=o,this.domId=i,this.progressDomId=n||i,this._hookedClose=!1,this._timer=null,this._clickToDisMiss=!0,this._cancelMsg=null,this.statusMessage=this.progressMessage=null}function s(i,n,o,r){if(this.statusService=i,this.progressId=n,o){this.deferred=o,this.begin(r);var s=this;o.then(function(){s.done.bind(s)()},function(){s.done.bind(s)()},function(i){if(i.message){var n=i.message;"number"==typeof i.loaded&&"number"==typeof i.total&&(n=t.formatMessage(e.workedProgress,n,i.loaded,i.total)),s.worked(n)}})}}var a="Error",l="Warning",c="Info",d="Ok",h="closeNotifications";return r.prototype={_init:function(){var e=i.node(h);if(e&&!this._hookedClose){e.style.cursor="pointer",this._hookedClose=!0;var t=i.node(this.notificationContainerDomId);i.addAutoDismiss([t],function(){this._clickToDisMiss&&this.close()}.bind(this)),e.addEventListener("click",function(){this.close()}.bind(this)),t.addEventListener("click",function(e){if(e&&e.target&&"a"===e.target.nodeName.toLowerCase()){var n=i.$$("a",t);n&&n.length&&1===n.length&&this.close()}}.bind(this))}},_takeDownSplash:function(){var e=require.specified("orion/splash")&&require("orion/splash");e&&e.takeDown()},close:function(){window.clearTimeout(this._timer);var e=i.node(h);this._cancelMsg&&this._cancelFunc&&e?(e.innerHTML="",e.classList.remove("cancelButton"),e.classList.add("dismissButton"),e.classList.add("core-sprite-close"),e.classList.add("imageSprite"),this._cancelFunc(),this._cancelMsg=null):this.setProgressMessage("")},_getNotifierElements:function(){return this._notifierElements||(this._notifierElements=n.getToolbarElements(this.notificationContainerDomId)),this._notifierElements},setMessage:function(e,t,n){this._init(),this.statusMessage=e;var o=i.node(this.domId);if("boolean"==typeof n){var r=o.getAttribute("aria-live");o.setAttribute("aria-live",n?"polite":"off"),window.setTimeout(function(){e===this.statusMessage&&(i.empty(o),o.appendChild(document.createTextNode(e)),window.setTimeout(function(){o.setAttribute("aria-live",r)},100))}.bind(this),100)}else i.empty(o),o.appendChild(document.createTextNode(e));"number"==typeof t&&window.setTimeout(function(){e===this.statusMessage&&(i.empty(o),o.appendChild(document.createTextNode("")))}.bind(this),t)},setErrorMessage:function(e){this._clickToDisMiss=!0,this.statusMessage=e,this._init();var t=e.responseText||e.message||e;if("string"==typeof t)try{t=JSON.parse(t)}catch(n){}var o=t.Message||t,r="red";if(t.Severity)switch(t.Severity){case l:r="#FFCC00";break;case a:r="red";break;case c:case d:r="green"}var s=document.createElement("span");s.style.color=r,s.appendChild(document.createTextNode(o));var h=i.node(this.domId);i.empty(h),h.appendChild(s),this._takeDownSplash()},setProgressMessage:function(e){this._clickToDisMiss=!1,this._init(),this.progressMessage=e;var t=i.node(this.progressDomId);i.empty(t),t.appendChild(document.createTextNode(e));var n=i.node(this.notificationContainerDomId);if(n.classList.remove("notificationHide"),e&&e.length>0)n.classList.add("progressNormal"),n.classList.add("notificationShow");else{if(this._progressMonitors&&this._progressMonitors.length>0)return this._renderOngoingMonitors();n.classList.remove("notificationShow"),n.classList.add("notificationHide")}},setCancelFunction:function(e){this._cancelFunc=e},setProgressResult:function(t,n){this._clickToDisMiss=!1,this._cancelMsg=n,this.progressMessage=t;var o=t.responseText||t;if(o instanceof Error)o.Severity=a;else if("string"==typeof o)try{o=JSON.parse(o)}catch(r){}this._init();var s=o.Message||o.toString();s===Object.prototype.toString()&&(s=e.UnknownError);var c=i.node(this.progressDomId);i.empty(c),c.appendChild(this.createMessage(o,s));var d="progressNormal",u=[];if(o.Severity)switch(o.Severity){case l:d="progressWarning",u.push("progressInfo"),u.push("progressError"),u.push("progressNormal"),this._clickToDisMiss=!0;break;case a:d="progressError",u.push("progressWarning"),u.push("progressInfo"),u.push("progressNormal"),this._clickToDisMiss=!0;break;default:d="progressNormal",u.push("progressWarning"),u.push("progressError"),u.push("progressNormal")}u.push("notificationHide");var p=i.node(this.notificationContainerDomId);if(d&&this.progressDomId!==this.domId){p.classList.add(d);for(var f=0;f<u.length;f++)p.classList.remove(u[f])}p.classList.add("notificationShow");var g=i.node(h);g&&(this._cancelMsg?(g.classList.add("cancelButton"),g.classList.remove("dismissButton"),g.classList.remove("core-sprite-close"),g.classList.remove("imageSprite"),g.textContent=this._cancelMsg):(g.innerHTML="",g.classList.remove("cancelButton"),g.classList.add("dismissButton"),g.classList.add("core-sprite-close"),g.classList.add("imageSprite"))),this._clickToDisMiss&&this._takeDownSplash()},createMessage:function(e,t){if(e.HTML){var n=document.createElement("span");return n.innerHTML=t,n}var r;r="markdown"===e.type?e.content||t:t;var s=null;try{s=o(r,{sanitize:!0})}catch(c){}var d,h=[];return s?(d=document.createElement("div"),d.innerHTML=s,h=i.$$("a",d),Array.prototype.forEach.call(h,function(e){e.target="_blank"})):d=document.createTextNode(t),h.length||e.Severity===l||e.Severity===a||this._cancelMsg||(this._timer&&window.clearTimeout(this._timer),this._timer=window.setTimeout(function(){this.setProgressMessage(""),this._timer=null}.bind(this),5e3)),d},showWhile:function(e,t){var i=this;if(t){i.setProgressMessage(t);var n=function(){t===i.progressMessage&&i.setProgressMessage("")};e.then(n,n)}return e},_lastProgressId:0,_progressMonitors:{length:0},createProgressMonitor:function(e,t){return new s(this,++this._lastProgressId,e,t)},_renderOngoingMonitors:function(){if(this._progressMonitors.length>0){var e="",t=!0;for(var i in this._progressMonitors)this._progressMonitors[i].status&&(t||(e+=", "),e+=this._progressMonitors[i].status,t=!1);this.setProgressMessage(e)}else this.setProgressMessage("")},_beginProgressMonitor:function(e){this._progressMonitors[e.progressId]=e,this._progressMonitors.length++,this._renderOngoingMonitors()},_workedProgressMonitor:function(e){this._progressMonitors[e.progressId]=e,this._renderOngoingMonitors()},_doneProgressMonitor:function(e){delete this._progressMonitors[e.progressId],this._progressMonitors.length--,e.status?this.setProgressResult(e.status):this._renderOngoingMonitors()}},r.prototype.constructor=r,s.prototype.begin=function(e){this.status=e,this.statusService._beginProgressMonitor(this)},s.prototype.done=function(e){this.status=e,this.statusService._doneProgressMonitor(this)},s.prototype.worked=function(e){this.status=e,this.statusService._workedProgressMonitor(this)},s.prototype.constructor=s,{StatusReportingService:r,ProgressMonitor:s}}),define("orion/operations/nls/messages",{root:!0,de:!0,es:!0,fr:!0,it:!0,ja:!0,ko:!0,"pt-br":!0,zh:!0,"zh-hk":!0,"zh-tw":!0}),define("orion/operations/nls/root/messages",{More:"More",NoMatchingOpSrvLocation:"No Matching OperationService for location:","could not find toolbar ":"could not find toolbar ","Remove Completed":"Remove Completed",rmCompleted:"Remove all completed operations",Remove:"Remove",rmFromOpList:"Remove operations from the operations list.",Cancel:"Cancel",CancelOp:"Cancel operations from the operations list.",OpWarning:"Operation resulted in a warning.",OpErr:"Operation resulted in an error.",OpRunning:"Operation is running.",OpCancelled:"Operation is canceled.","Operation failed.":"Operation failed.",Name:"Name",Actions:"Actions",Status:"Status",Scheduled:"Scheduled","Recent operations":"Recent operations","All Operations":"All Operations",NoPageOps:"No operations running on this page.",NoOperations:"No operations running."}),define("orion/operationsCommands",["i18n!orion/operations/nls/messages","orion/webui/littlelib","orion/commands"],function(e,t,i){var n={};return function(){var o=!1;n.updateNavTools=function(i,n,r,s,a,l){var c=n,d=t.node(s);if(!d)throw e["could not find toolbar "]+s;if(c.destroy(d),c.renderCommands(s,d,l,r,"button"),a){var h=t.node(a);h&&(c.destroy(h),c.renderCommands(a,h,null,r,"button"))}o||(o=!0,i.getService("orion.page.selection").addEventListener("selectionChanged",function(e){var i=t.node(a);i&&(c.destroy(i),c.renderCommands(a,i,e.selections,r,"button"))}))},n.createOperationsCommands=function(t,n,o){function r(e){return e.operation&&e.operation.type?"loadstart"===e.operation.type||"progress"===e.operation.type:!1}function s(e){return e.operation&&e.operation.cancelable?!0:!1}var a=new i.Command({name:e["Remove Completed"],tooltip:e.rmCompleted,id:"eclipse.removeCompletedOperations",callback:function(){o.removeCompletedOperations().then(function(){n.loadOperations.bind(n)()})},visibleWhen:function(){return!0}});t.addCommand(a);var l=new i.Command({name:e.Remove,tooltip:e.rmFromOpList,imageClass:"core-sprite-delete",id:"eclipse.removeOperation",callback:function(e){for(var t=Array.isArray(e.items)?e.items:[e.items],i=0;i<t.length;i++){var r=t[i];o.removeOperation.bind(o)(r.Location).then(function(){n.loadOperations.bind(n)()},function(){n.loadOperations.bind(n)()})}},visibleWhen:function(e){if(!Array.isArray(e)||0===e.length)return!r(e);for(var t in e)if(r(e[t]))return!1;return!0}});t.addCommand(l);var c=new i.Command({name:e.Cancel,tooltip:e.CancelOp,imageClass:"core-sprite-stop",id:"eclipse.cancelOperation",callback:function(e){for(var t=Array.isArray(e.items)?e.items:[e.items],i=0;i<t.length;i++){var n=t[i];n.deferred&&n.deferred.cancel()}},visibleWhen:function(e){if(!Array.isArray(e)||0===e.length)return r(e)&&s(e);for(var t in e)if(!r(e[t])||!s(e[t]))return!1;return!0}});t.addCommand(c)}}(),n}),define("orion/webui/dialogs/OperationsDialog",["i18n!orion/operations/nls/messages","require","orion/webui/littlelib","orion/webui/popupdialog","orion/operationsCommands"],function(e,t,i,n,o){function r(e){this._options=e}return r.prototype=new n.PopupDialog,r.prototype.messages=e,r.prototype.TEMPLATE='<table style="width: 360px;"><tr><td><h2>${Recent operations}</h2></td><td style="text-align: right;"><a id="allOperationsLink" class="navlinkonpage">${All Operations}</a></td></tr></table><div id="operationsExist"><div style="padding-left: 7px" id="myOperationsListEmpty">${NoPageOps}</div><table id="myOperationsList" style="display: none;"></table></div><div style="padding-left: 7px" id="operationsDontExist">${NoOperations}</div>',r.prototype._init=function(e){this._myOperations=[],this._operationsDeferreds=[],this._commandService=e.commandRegistry,o.createOperationsCommands(this._commandService),this._commandService.registerCommandContribution("operationsDialogItems","eclipse.cancelOperation",1),this._initialize(e.triggerNode)},r.prototype._bindToDom=function(){this.$allOperationsLink.href=t.toUrl("operations/list.html"),this._setOperationsVisibility()},r.prototype.setOperations=function(e,t){if(this._myOperations||this._init(this._options),this._myOperations=[],this._operationsDeferreds=[],e)for(var i in e)this._myOperations.push(e[i]),this._operationsDeferreds.push(t[i]);this._renderOperations()},r.prototype.parseProgressResult=function(e){if(!e)return{};var t=e.responseText||e;
try{t=JSON.parse(t)}catch(i){}var n={Message:t.Message||t,Severity:t.Severity};return t.DetailedMessage&&t.DetailedMessage!==n.Message&&(n.DetailedMessage=t.DetailedMessage),n},r.prototype._renderOperations=function(){this._renderOperationsTable(this.$myOperationsList,this._myOperations,this._operationsDeferreds)},r.prototype._renderOperationsTable=function(t,n,o){i.empty(t);for(var r=0;r<n.length;r++){var s=n[r],a=document.createElement("tr"),l=document.createElement("td");l.style.paddingLeft="5px",l.style.paddingRight="5px",l.textContent=s.Name,a.appendChild(l);var c=document.createElement("div");l.appendChild(c);var d=document.createElement("span");switch(d.style.paddingRight="5px",d.classList.add("imageSprite"),s.type){case"Warning":d.classList.add("core-sprite-warning"),d.setAttribute("aria-label",e.OpWarning);break;case"error":d.classList.add("core-sprite-error"),d.setAttribute("aria-label",e.OpErr);break;case"loadstart":case"progress":d.classList.add("core-sprite-start"),d.setAttribute("aria-label",e.OpRunning);break;case"abort":d.classList.add("core-sprite-stop"),d.setAttribute("aria-label",e.OpCancelled);break;case"load":case"loadend":d.classList.add("core-sprite-ok"),d.setAttribute("aria-label","Operation ok.")}c.appendChild(d);var h=document.createElement("span");if(h.classList.add("operationStatus"),h.textContent=s.Name,c.appendChild(h),s.error){var u=s.error.Message||s.error;s.error.DetailedMessage&&""!==s.error.DetailedMessage&&(u+=": "+s.error.DetailedMessage),h.textContent=u,h.classList.remove("operationStatus"),h.classList.add("operationError")}this._commandService.renderCommands("operationsDialogItems",c,{operation:s,deferred:o[r]},this,"tool"),t.appendChild(a)}this._setOperationsVisibility()},r.prototype._setOperationsVisibility=function(){this.$myOperationsList.style.display=this._myOperations.length>0?"":"none",this.$myOperationsListEmpty.style.display=this._myOperations.length>0?"none":"",this.$operationsDontExist.style.display=this._myOperations.length>0?"none":"",this.$operationsExist.style.display=this._myOperations.length>0?"":"none"},r.prototype.constructor=r,{OperationsDialog:r}}),define("orion/progress",["i18n!orion/nls/messages","orion/webui/littlelib","orion/webui/dialogs/OperationsDialog"],function(e,t,i){function n(e,n){if(!this._progressPane){this._progressPane=t.node(e),this._operationsDialog=new i.OperationsDialog({triggerNode:this._progressPane,commandRegistry:n});var o=this;this._progressPane.addEventListener("keydown",function(e){(" "===e.charOrCode||e.keyCode===t.KEY.ENTER)&&o._operationsDialog.show()}),this._progressPane.addEventListener("click",function(){o._operationsDialog.isShowing()?o._operationsDialog.hide():o._operationsDialog.show()}),this._operationsDialog.setOperations(null,null)}}function o(e,t,i,n){this._serviceRegistry=e,this._serviceRegistration=e.registerService("orion.page.progress",this),this._commandRegistry=i,this._operationsClient=t,this._operations={},this._operationDeferrds={},this._operationsIndex=0,this._lastOperation=null,this._lastIconClass=null,this._progressMonitorClass=n}return n.prototype={_switchIconTo:function(e){this._lastIconClass&&this._progressPane.classList.remove(this._lastIconClass),this._lastIconClass=e,this._progressPane.classList.add(this._lastIconClass)},generateOperationsInfo:function(t,i){var n={};for(var o in t)t[o].progressMonitor||(n[o]=t[o]);if(this._isEmpty(n))return this._switchIconTo("progressPane_empty"),this._progressPane.title=e.Operations,this._progressPane.alt=e.Operations,this._progressPane.hasAttribute("aria-valuetext")&&this._progressPane.removeAttribute("aria-valuetext"),void this._operationsDialog.setOperations(n,i);var r="";for(var s in n){var a=n[s];if(a.type&&("loadstart"===a.type||"progress"===a.type)){r="running";break}}switch(""===r&&null!=this._lastOperation&&this._lastOperation.type&&"error"===this._lastOperation.type,r){case"running":this._progressPane.title=e["Operations running"],this._progressPane.alt=e["Operations running"],this._progressPane.setAttribute("aria-valuetext",e["Operations running"]),this._switchIconTo("running");break;case"warning":this._progressPane.title=e.SomeOpWarning,this._progressPane.alt=e.SomeOpWarning,this._progressPane.setAttribute("aria-valuetext",e.SomeOpWarning),this._switchIconTo("warning");break;case"error":this._progressPane.title=e.SomeOpErr,this._progressPane.alt=e.SomeOpErr,this._progressPane.setAttribute("aria-valuetext",e.SomeOpErr),this._switchIconTo("error");break;default:this._progressPane.title=e.Operations,this._progressPane.alt=e.Operations,this._progressPane.hasAttribute("aria-valuetext")&&this._progressPane.removeAttribute("aria-valuetext"),this._switchIconTo("progressPane_empty")}this._operationsDialog.setOperations(n,i)},_isEmpty:function(e){for(var t in e)return!1;return!0}},n.prototype.constructor=n,o.prototype={init:function(e){this._progressMonitorClass||(this._progressMonitorTool=new n(e,this._commandRegistry))},progress:function(e,t,i){var n=this,o=this._operationsIndex++;return!i&&this._progressMonitorClass&&(i=new this._progressMonitorClass,i.begin(t)),e.then(function(){if(n._operations[o]){var r=n._operations[o];t&&(r.Name=t),n._lastOperation=r,r.type="loadend",i&&(r.progressMonitor=i),n.writeOperation.bind(n)(o,r,e),r.Location||n._removeOperationFromTheList.bind(n)(o)}},function(r){if(n._operations[o]){var s=n._operations[o];t&&(s.Name=t),i&&(s.progressMonitor=i),n._lastOperation=s,s.type=r.canceled?"abort":"error",s.error=r,n.writeOperation.bind(n)(o,s,e),s.Location||n._removeOperationFromTheList.bind(n)(o)}},function(r){t&&(r.Name=t),i&&(r.progressMonitor=i),n.writeOperation.bind(n)(o,r,e)}),e},removeOperation:function(e){var t=this;for(var i in this._operations)if(this._operations[i].Location&&this._operations[i].Location===e){this._removeOperationFromTheList(i);break}t._operationsClient.removeOperation.bind(t._operationsClient)(e)},_removeOperationFromTheList:function(e){var t=this._operations[e].progressMonitor;delete this._operations[e],delete this._operationDeferrds[e],t?t.done():this._progressMonitorTool.generateOperationsInfo(this._operations,this._operationDeferrds)},removeCompletedOperations:function(){for(var e in this._operations){var t=this._operations[e];if(t.type&&"loadstart"!==t.type&&"progress"!==t.type){var i=this._operations[e].progressMonitor;i&&i.done(),delete this._operations[e],delete this._operationDeferrds[e]}}this._progressMonitorTool.generateOperationsInfo(this._operations,this._operationDeferrds)},setProgressResult:function(e){this._serviceRegistry.getService("orion.page.message").setProgressResult(e)},showWhile:function(e,t,i){this._serviceRegistry.getService("orion.page.message").showWhile(e,t);var n=this;return e.then(null,function(e){i||n.setProgressResult(e)}),this.progress(e,t)},writeOperation:function(e,t,i){if(this._operations[e]=t,this._operationDeferrds[e]=i,t.Location){var n={};n[t.Location]={Name:t.Name,expires:t.expires},this._serviceRegistry.getService("orion.core.preference").put("/operations",n)}t.progressMonitor?t.progressMonitor.progress(t.Name):this._progressMonitorTool.generateOperationsInfo(this._operations,this._operationDeferrds)}},o.prototype.constructor=o,{ProgressService:o}}),define("orion/operationsClient",["i18n!orion/operations/nls/messages","orion/Deferred"],function(e,t){function i(e,t,i){return e[t].apply(e,i)}function n(e){this._location=e}function o(){var i=new t;return i.reject(e.NoMatchingOpSrvLocation+this._location),i}function r(e){this._services=[],this._patterns=[],this._operationListeners=[],this._currentLongpollingIds=[],this._preferenceService=e.getService("orion.core.preference");for(var t=e.getServiceReferences("orion.core.operation"),i=0;i<t.length;i++){var o=t[i],r=e.getService(o);this._services[i]=r;var a=t[i].getProperty("pattern")||".*";"^"!==a[0]&&(a="^"+a),this._patterns[i]=new RegExp(a)}this._getService=function(e){if(!e)return this._services[0];for(var t=0;t<this._patterns.length;++t)if(this._patterns[t].test(e))return this._services[t];return this._preferenceService.remove(s,e),new n(e)}}var s="/operations";return n.prototype={getOperation:o,getOperations:o,removeCompletedOperations:o,removeOperation:o,cancelOperation:o},n.prototype.constructor=n,r.prototype={getOperations:function(){return this._preferenceService.get(s)},getOperation:function(e){return i(this._getService(e),"getOperation",arguments)},removeCompletedOperations:function(){for(var e=[],n=this,o=0;o<this._services.length;o++){var r=this._patterns[o],a=new t;e[o]=a.promise,i(this._services[o],"removeCompletedOperations").then(function(e){return function(t){Array.isArray(t)&&n._preferenceService.get(s).then(function(i){for(var o=Object.keys(i),a=0;a<o.length;a++){var l=o[a];r.test(l)&&t.indexOf(l)<0&&delete i[l]}n._preferenceService.put(s,i).then(e.resolve,e.reject)})}}(a),function(e){return function(t){e.reject(t)}}(a))}return t.all(e)},removeOperation:function(e){var t=this;return i(this._getService(e),"removeOperation",arguments).then(function(){return t._preferenceService.remove(s,e)},function(e){return e},function(e){return e})}},r.prototype.constructor=r,{OperationsClient:r}}),define("orion/dialogs",[],function(){function e(e){this._serviceRegistry=e,this._serviceRegistration=e.registerService("orion.page.dialog",this)}return e.prototype={confirm:function(e,t){t(window.confirm(e))},openFiles:function(){}},e.prototype.constructor=e,{DialogService:e}}),define("orion/projectClient",["orion/Deferred","orion/objects","orion/extensionCommands","orion/i18nUtil"],function(e,t,i){function n(e){try{return e?JSON.parse(e):{}}catch(t){return{__TEXT__:String(e)}}}function o(e,t){t.getPropertyKeys().forEach(function(i){e[i]=t.getProperty(i)})}function r(e,t){this.serviceRegistry=e,this.fileClient=t,this.allProjectHandlersReferences=e.getServiceReferences("orion.project.handler"),this.allProjectDeployReferences=e.getServiceReferences("orion.project.deploy"),this._serviceRegistration=e.registerService("orion.project.client",this),this._launchConfigurationsDir="launchConfigurations"}return r.prototype={_getProjectJsonData:function(i,o,r){var s=new e,a={};a.Name=i.Name,a.ContentLocation=i.Location,a.WorkspaceLocation=r.Location;var l;r.Children.some(function(e){return e.Location===i.Location?(l=e.Id,!0):!1}),r.Projects&&r.Projects.some(function(e){return e.Id===l?(a.ProjectLocation=e.Location,!0):!1});for(var c=null,d=0;d<o.length;d++)if("project.json"===o[d].Name){c=o[d].Location;break}return c?this.fileClient.read(c).then(function(e){t.mixin(a,n(e)),a.ProjectJsonLocation=c,s.resolve(a)},function(){s.resolve(a)},s.progress):s.resolve(a),s},getProject:function(t){if(!t||t.Projects)return(new e).resolve(null);for(;t.parent&&t.parent.parent&&"ProjectRoot"!==t.parent.parent.type;)t=t.parent;if(t.Parents&&t.Parents.length>0){var i=t.Parents[t.Parents.length-1];return i.Children?(i.ContentLocation=i.Location,(new e).resolve(i)):this.fileClient.read(i.Location,!0).then(function(e){return e.ContentLocation=e.Location,e})}return t.ContentLocation=t.Location,(new e).resolve(t)},readAllProjects:function(t){var i=new e;if(!t.Children)return i.resolve([]),i;for(var n=[],o=[],r=0;r<t.Children.length;r++){var s=new e;this.readProject(t.Children[r],t).then(s.resolve,function(){this.resolve(null)}.bind(s)),o.push(s),s.then(function(e){e&&n.push(e)})}return e.all(o).then(function(){i.resolve(n)}),i},readProject:function(t,i){function n(e,t,i){if(e.Parents&&e.Parents.length>0){var n=e.Parents[e.Parents.length-1];return n.Children?o._getProjectJsonData.bind(o)(n,n.Children,t).then(i.resolve,i.reject,i.progress):n.ChildrenLocation?this.fileClient.fetchChildren(n.ChildrenLocation).then(function(e){o._getProjectJsonData.bind(o)(n,e,t).then(i.resolve,i.reject,i.progress)},i.reject,i.progress):i.resolve(null),i}return e.Children?(o._getProjectJsonData.bind(o)(e,e.Children,t).then(i.resolve,i.reject,i.progress),i):e.ChildrenLocation?(this.fileClient.fetchChildren(e.ChildrenLocation).then(function(n){o._getProjectJsonData.bind(o)(e,n,t).then(i.resolve,i.reject,i.progress)},i.reject,i.progress),i):(i.resolve(null),i)}var o=this,r=new e;return i?n.call(o,t,i,r):this.fileClient.loadWorkspace().then(function(e){n.call(o,t,e,r)}),r},initProject:function(t,i){return(new e).resolve({ContentLocation:t,projectMetadata:i})},createProject:function(t,i){var n=new e;return this.fileClient.createProject(t,i.Name,i.ContentLocation,!0).then(function(e){delete i.Name,n.resolve(this.initProject(e.ContentLocation,i))}.bind(this),function(e){n.reject(e)},function(e){n.progress(e)}),n},getDependencyFileMetadata:function(t,n){function o(e,i){this.fileClient.fetchChildren(e).then(function(e){for(var n=0;n<e.length;n++)if(e[n].Name===i[0])return void(1===i.length?r.resolve(e[n]):o.bind(s)(e[n].ChildrenLocation,i.splice(1,i.length-1)));r.reject(t.Location+" could not be found in your workspace")},function(e){r.reject(e)})}var r=new e,s=this;if("file"===t.Type){var a=t.Location.split("/");return this.fileClient.loadWorkspace(n).then(function(e){for(var i=0;i<e.Children.length;i++)if(e.Children[i].Name===a[0])return void(1===a.length?r.resolve(e.Children[i]):o.bind(s)(e.Children[i].ChildrenLocation,a.splice(1,a.length-1)));r.reject(t.Location+" could not be found in your workspace")},function(e){r.reject(e)}),r}return this.getProjectHandler(t.Type).then(function(o){if(null===o)return r.reject(t.Type+" is not supported."),r;var s;return o.validationProperties&&(s=i._makeValidator(o,this.serviceRegistry,[])),this.fileClient.loadWorkspace(n).then(function(i){for(var n=[],a=!1,l=0;l<i.Children.length&&a!==!0;l++)if(s&&s.validationFunction(i.Children[l])){var c=o.getDependencyDescription(i.Children[l]);n.push(c),function(e,n){n.then(function(n){n&&n.Location===t.Location&&(a=!0,r.resolve(i.Children[e]))})}(l,c)}e.all(n).then(function(){a||r.reject(t.Name+" could not be found in your workspace")})},r.reject),r}.bind(this))},addProjectDependency:function(t,i){var o=new e;return this.fileClient.fetchChildren(t.ContentLocation).then(function(e){for(var r=function(e,r){var s=n(r);try{s.Dependencies||(s.Dependencies=[]);for(var a=0;a<s.Dependencies.length;a++)if(s.Dependencies[a].Location===i.Location)return void o.resolve(s);s.Dependencies.push(i);var l=JSON.stringify(s);this.fileClient.write(e,l).then(function(){s.ContentLocation=t.ContentLocation,s.Name=t.Name,o.resolve(s)},o.reject),o.resolve(s)}catch(c){o.reject(c)}}.bind(this),s=null,a=0;a<e.length;a++)if("project.json"===e[a].Name){s=e[a].Location;break}s?this.fileClient.read(s).then(function(e){r(s,e)}.bind(this),o.reject,o.progress):this.fileClient.createFile(t.ContentLocation,"project.json").then(function(e){r(e.Location,"{}")}.bind(this),o.reject,o.progress)}.bind(this),o.reject,o.progress),o},removeProjectDependency:function(t,i){var o=new e;return this.fileClient.fetchChildren(t.ContentLocation).then(function(e){for(var r=0;r<e.length;r++)if("project.json"===e[r].Name)return void this.fileClient.read(e[r].Location).then(function(s){try{var a=n(s);a.Dependencies||(a.Dependencies=[]);for(var l=a.Dependencies.length-1;l>=0;l--)a.Dependencies[l].Location===i.Location&&a.Dependencies[l].Type===i.Type&&a.Dependencies.splice(l,1);this.fileClient.write(e[r].Location,JSON.stringify(a)).then(function(){a.ContentLocation=t.ContentLocation,a.Name=t.Name,o.resolve(a)},o.reject)}catch(c){o.reject(c)}}.bind(this),o.reject,o.progress)}.bind(this),o.reject),o},changeProjectProperties:function(t,i){function o(e){this.fileClient.read(e).then(function(o){try{var s=n(o);for(var a in i)s[a]=i[a];this.fileClient.write(e,JSON.stringify(s)).then(function(){s.ContentLocation=t.ContentLocation,s.ProjectJsonLocation=e,s.Name=t.Name,r.resolve(s)},r.reject)}catch(l){r.reject(l)}}.bind(this),r.reject)}if(i){var r=new e;return t.ProjectJsonLocation&&o.bind(this)(t.ProjectJsonLocation),r}},getProjectHandlerTypes:function(){for(var e=[],t=0;t<this.allProjectHandlersReferences.length;t++)e.push(this.allProjectHandlersReferences[t].getProperty("type"));return e},_getProjectDeployService:function(e){var t=this.serviceRegistry.getService(e);return o(t,e),t.id=e.getProperty("id"),t.name=e.getProperty("name"),t.tooltip=e.getProperty("tooltip"),t.parameters=e.getProperty("parameters"),t.optionalParameters=e.getProperty("optionalParameters"),t.validationProperties=e.getProperty("validationProperties"),t.logLocationTemplate=e.getProperty("logLocationTemplate"),t},matchesDeployService:function(e,t){var n=i._makeValidator(t,this.serviceRegistry,[]);return n.validationFunction(e)},getProjectDeployTypes:function(){function e(e,t){var i=e.getProperty("priorityForDefault")||0,n=t.getProperty("priorityForDefault")||0;return i>n?-1:n>i?1:0}for(var t=this.allProjectDeployReferences.sort(e),i=[],n=0;n<t.length;n++)i.push(t[n].getProperty("id"));return i},getProjectDeployService:function(e,t){var i;return this.allProjectDeployReferences.some(function(t){return t.getProperty("id")===e?i=t:!1}),t&&this.allProjectDeployReferences.some(function(e){return-1!==(e.getProperty("deployTypes")||[]).indexOf(t)?i=e:!1}),this._getProjectDeployService(i)},_getProjectHandlerService:function(e){var t=this.serviceRegistry.getService(e);return o(t,e),t.addParameters=t.addParameters||t.addParamethers,t.optionalParameters=t.optionalParameters||t.optionalParamethers,delete t.addParamethers,delete t.optionalParamethers,t},getProjectHandler:function(t){for(var i=0;i<this.allProjectHandlersReferences.length;i++)if(this.allProjectHandlersReferences[i].getProperty("type")===t){var n=this._getProjectHandlerService(this.allProjectHandlersReferences[i]);return(new e).resolve(n)}return(new e).reject()},getMatchingProjectHandlers:function(e){for(var t=[],n=0;n<this.allProjectHandlersReferences.length;n++){var o=this.allProjectHandlersReferences[n]._properties,r=i._makeValidator(o,this.serviceRegistry,[]);r.validationFunction(e)&&t.push(this._getProjectHandlerService(this.allProjectHandlersReferences[n]))}return t},getLaunchConfigurationsDir:function(t,i){var n=new e,o=t.ContentLocation;return o?(-1===o.indexOf("?depth=")&&(o+="?depth=1"),this.fileClient.read(o,!0).then(function(e){for(var o=e.Children,r=0;r<o.length;r++)if(o[r].Name&&o[r].Name===this._launchConfigurationsDir)return n.resolve(o[r]),n;i?this.fileClient.createFolder(t.ContentLocation,this._launchConfigurationsDir).then(function(t){t.parent=e,n.resolve(t)},n.reject):n.resolve(null)}.bind(this),n.reject)):n.reject(),n},getProjectLaunchConfigurations:function(t){var i=new e;return this.getLaunchConfigurationsDir(t).then(function(n){if(!n)return i.resolve([]),i;if(n.Children){for(var o=[],r=0;r<n.Children.length;r++){var s=n.Children[r].Name;if(-1!==s.indexOf(".launch",s.length-".launch".length)){var a=new e,l=n.Children[r];o.push(a),function(e,i){this.fileClient.read(i.Location).then(function(o){try{o=JSON.parse(o),o.Name=i.Name.replace(".launch",""),o.project=t,o.File=i,o.File.parent=n,o.Params||(o.Params={}),o.Params.DevMode=void 0;var r=this.getProjectDeployService(o.ServiceId,o.Type);r.logLocationTemplate&&(o.Params.LogLocationTemplate=r.logLocationTemplate),r&&r.getDevMode?r.getDevMode(t.ContentLocation+o.Path).then(function(t){t&&(o.Params.DevMode=t),e.resolve(o)},function(){e.resolve(o)}):e.resolve(o)}catch(s){console.error(s),e.resolve()}}.bind(this),function(t){console.error(t),e.resolve()})}.bind(this)(a,l)}}e.all(o).then(function(e){if(!e||!e.length)return void i.resolve([]);for(var t=e.length-1;t>=0;t--)e[t]||e.splice(t,1);i.resolve(e)},i.reject)}else{var c=arguments.callee.bind(this);this.fileClient.fetchChildren(n.ChildrenLocation).then(function(e){n.Children=e,c(n)}.bind(this),i.reject)}}.bind(this),i.reject),i},formLaunchConfiguration:function(e,t,i,n,o,r,s,a){var l={Name:e,ServiceId:t,Params:i,Url:n,ManageUrl:o,Path:r,File:a};return s&&(l.Type=s),l},formPluginLaunchConfiguration:function(e){return{ConfigurationName:e.Name,Parameters:e.Params,Type:e.Type,Path:e.Path,File:e.File,ServiceId:e.ServiceId}},_updateOrCreate:function(t,i,n){for(var o=this,r=new e,s=0;s<t.Children.length;++s)if(t.Children[s].Name===i)return o.fileClient.write(t.Children[s].Location,n).then(function(){r.resolve(t.Children[s])},r.reject),r;return o.fileClient.createFile(t.Location,i).then(function(e){o.fileClient.write(e.Location,n).then(function(){r.resolve(e)},r.reject)}),r},normalizeFileName:function(e,t){var i=e;return i=i.replace(/\ /g," "),i=i.replace(/[^\w\d\s-]/g,""),i.indexOf(t)<0&&(i+=t),i},_ensureLaunchConfigurationDir:function(t,i){var n=new e;return i?(n.resolve(i),n):(this.getLaunchConfigurationsDir(t,!0).then(function(e){if(e.Children)n.resolve(e);else{var t=arguments.callee.bind(this);this.fileClient.fetchChildren(e.ChildrenLocation).then(function(i){e.Children=i,t(e)}.bind(this),n.reject)}}.bind(this)),n)},saveProjectLaunchConfiguration:function(i,n,o,r,s,a,l,c){var d=new e,h=this.normalizeFileName(n,".launch"),u=this.formLaunchConfiguration(n,o,r,s,a,l,c);return this._ensureLaunchConfigurationDir(i).then(function(e){var n=t.clone(u);n.Name=void 0;var o=JSON.stringify(n,null,2);this._updateOrCreate(e,h,o).then(function(t){u.File=t,u.File.parent=e;var n=this.getProjectDeployService(u.ServiceId,u.Type);n.logLocationTemplate&&(u.Params.LogLocationTemplate=n.logLocationTemplate),n&&n.getDevMode?n.getDevMode(i.ContentLocation+u.Path).then(function(e){e&&(u.Params.DevMode=e),d.resolve(u)},function(){d.resolve(u)}):d.resolve(u)}.bind(this),d.reject)}.bind(this),d.reject),d},deleteProjectLaunchConfiguration:function(t){var i=new e;return t.File&&t.File.Location?(this.fileClient.deleteFile(t.File.Location).then(i.resolve,i.reject),i):(i.resolve(),i)}},r.prototype.constructor=r,{ProjectClient:r}}),define("edit/setup",["i18n!orion/edit/nls/messages","orion/sidebar","orion/inputManager","orion/commands","orion/globalCommands","orion/editor/textModel","orion/editor/undoStack","orion/folderView","orion/editorView","orion/editorPluginView","orion/markdownView","orion/markdownEditor","orion/commandRegistry","orion/contentTypes","orion/fileClient","orion/fileCommands","orion/editorCommands","orion/selection","orion/status","orion/progress","orion/operationsClient","orion/outliner","orion/dialogs","orion/extensionCommands","orion/projectCommands","orion/searchClient","orion/EventTarget","orion/URITemplate","orion/i18nUtil","orion/PageUtil","orion/objects","orion/webui/littlelib","orion/Deferred","orion/projectClient","orion/webui/splitter","orion/webui/tooltip","orion/bidiUtils","orion/customGlobalCommands"],function(e,t,i,n,o,r,s,a,l,c,d,h,u,p,f,g,m,v,_,y,C,w,b,S,x,L,T,E,k,N,A,R,I,D,P,M,O,B){function F(e){this.parentNode=e.parentNode,this.commandRegistry=e.commandRegistry,this.serviceRegistry=e.serviceRegistry,this.fileClient=e.fileClient,this.editorCommands=e.editorCommands,this.parentNode=e.parentNode,this.fileActionsScope="fileActions",this.editActionsScope="editActions",this.viewActionsScope="viewActions",this.toolsActionsScope="toolsActions",this.additionalActionsScope="extraActions",this.createActionSections(),this.runBarNode=R.$(".runBar",this.parentNode)}function j(e){this.serviceRegistry=e.serviceRegistry,this.all=[]}function V(e){A.mixin(this,e),this.id=this.id||"",this.selection=this.id?new v.Selection(this.serviceRegistry,"orion.page.selection"+this.id):this.selection,this.problemsServiceID="orion.core.marker"+this.id,this.editContextServiceID="orion.edit.context"+this.id,this.editModelContextServiceID="orion.edit.model.context"+this.id;var t=this.domNode=document.createElement("div");t.className="editorViewerFrame",this.parent.appendChild(t);var i=this.headerNode=document.createElement("div");i.className="editorViewerHeader",this.curFileNode=document.createElement("span"),this.curFileNode.className="editorViewerHeaderTitle",i.appendChild(this.curFileNode),this.fileNodeTooltip=new M.Tooltip({node:this.curFileNode,position:["below","above","right","left"]}),this.localBreadcrumbNode=document.createElement("div");var n=this.fileNodeTooltip.contentContainer();n.appendChild(this.localBreadcrumbNode),t.appendChild(i);var o=this.contentNode=document.createElement("div");o.className="editorViewerContent",t.appendChild(o),z||(i.style.display="none",o.style.top="0"),t.addEventListener("mousedown",function(){this.activateContext.setActiveEditorViewer(this)}.bind(this),!0),t.addEventListener("keyup",function(){this.activateContext.setActiveEditorViewer(this)}.bind(this),!0)}function U(e,t,i,n){this.serviceRegistry=e,this.pluginRegistry=t,this.preferences=i,this.readonly=n,this.initializeServices(),this.modelPool=new j({serviceRegistry:this.serviceRegistry}),this.editorDomNode=R.node("editor"),this.sidebarDomNode=R.node("sidebar"),this.sidebarToolbar=R.node("sidebarToolbar"),this.pageToolbar=R.node("pageToolbar"),this.editorViewers=[]}var W={},z=!0,H=0,G=1,$=2,K=3,Y=new E("#{,resource,params*}");F.prototype={},A.mixin(F.prototype,{createActionSections:function(){var t=this;[this.fileActionsScope,this.editActionsScope,this.viewActionsScope,this.toolsActionsScope,this.additionalActionsScope].reverse().forEach(function(e){if(!t[e]){var i=document.createElement("ul");i.id=e,i.classList.add("commandList"),i.classList.add("layoutLeft"),i.classList.add("pageActions"),e===t.additionalActionsScope&&i.classList.add("extraActions"),t.parentNode.insertBefore(i,t.parentNode.firstChild),t[e]=i}});var i=this.commandRegistry,n=this.fileActionsScope,o=this.editActionsScope,r=this.viewActionsScope,s=this.toolsActionsScope;i.addCommandGroup(n,"orion.menuBarFileGroup",1e3,e.File,null,e.noActions,null,null,"dropdownSelection"),i.addCommandGroup(o,"orion.menuBarEditGroup",100,e.Edit,null,e.noActions,null,null,"dropdownSelection"),i.addCommandGroup(r,"orion.menuBarViewGroup",100,e.View,null,e.noActions,null,null,"dropdownSelection"),i.addCommandGroup(s,"orion.menuBarToolsGroup",100,e.Tools,null,null,null,null,"dropdownSelection"),i.addCommandGroup(n,"orion.newContentGroup",0,e.New,"orion.menuBarFileGroup",null,null,null,"dropdownSelection"),i.addCommandGroup(n,"orion.importGroup",100,e.Import,"orion.menuBarFileGroup",null,null,null,"dropdownSelection"),i.addCommandGroup(n,"orion.exportGroup",1001,e.Export,"orion.menuBarFileGroup",null,null,null,"dropdownSelection")},createCommands:function(){var e=this.serviceRegistry,t=this.commandRegistry,i=this.fileClient,n=this.editorCommands;return n.createCommands().then(function(){return n.registerCommands(),n.registerContextMenuCommands(),g.createFileCommands(e,t,i).then(function(){return S.createFileCommands(e,null,"all",!0,t).then(function(){var n=e.getService("orion.project.client");return n.getProjectHandlerTypes().then(function(o){return n.getProjectDeployTypes().then(function(r){return x.createProjectCommands(e,t,i,n,o,r)},function(){return x.createProjectCommands(e,t,i,n,o)})})})})})},setActiveExplorer:function(e){this.explorer=e},setActiveEditorViewer:function(e){this.editorViewer=e},updateCommands:function(){var e,t,i,n,o=this.explorer;o&&(e=o.isCommandsVisible(),t=o.selection,i=o.getTreeRoot());var r=this.editorViewer;r&&(n=r.inputManager.getFileMetadata(),this.editorCommands.updateCommands(r.getCurrentEditorView()));var s=this.commandRegistry,a=this.serviceRegistry;s.registerSelectionService(this.fileActionsScope,e?t:null),s.registerSelectionService(this.editActionsScope,e?t:null),s.registerSelectionService(this.viewActionsScope,e?t:null),g.setExplorer(o),x.setExplorer(o),g.updateNavTools(a,s,o,null,[this.fileActionsScope,this.editActionsScope,this.viewActionsScope],i,!0),s.destroy(this.toolsActionsScope),s.renderCommands(this.toolsActionsScope,this.toolsActionsScope,n,o,"tool"),s.destroy(this.additionalActionsScope),s.renderCommands(this.additionalActionsScope,this.additionalActionsScope,i,o,"button")}}),j.prototype={},A.mixin(j.prototype,{create:function(e){var t=new r.TextModel,i=new s.UndoStack(t,500),n={};["getText","setText"].forEach(function(e){n[e]=t[e].bind(t)}),this.serviceRegistry.registerService(e,n,null);var o={useCount:1,model:t,undoStack:i,serviceID:e};return this.all.push(o),o},search:function(e){for(var t=0;t<this.all.length;t++){var i=this.all[t];if(i.useCount>0&&i.metadata&&i.metadata.Location===e)return i}return null},release:function(e){return e.useCount--,e},retain:function(e){return e.useCount++,e},get:function(){for(var e=0;e<this.all.length;e++){var t=this.all[e];if(0===t.useCount)return this.retain(t)}return null}}),V.prototype={},A.mixin(V.prototype,{create:function(){this.createTextModel(),this.createInputManager(),this.createEditorView()},createTextModel:function(){this.pool=this.modelPool.create(this.editModelContextServiceID)},createEditorView:function(){this.editorView=new l.EditorView(this.defaultOptions())},createInputManager:function(){var e=this.inputManager=new i.InputManager({serviceRegistry:this.serviceRegistry,fileClient:this.fileClient,progressService:this.progressService,statusReporter:this.statusReporter.bind(this),selection:this.selection,contentTypeRegistry:this.contentTypeRegistry});e.addEventListener("InputChanged",function(e){var t=e.metadata;t?sessionStorage.lastFile=N.hash():delete sessionStorage.lastFile;var i=this.getEditorView(e.input,t);this.setEditor(i?i.editor:null),e.editor=this.editor,this.pool.metadata=t;var n=window.location.href;if(this.activateContext.setActiveEditorViewer(this),this.commandRegistry.processURL(n),this.curFileNode){var o=e.name||"";O.isBidiEnabled&&(o=O.enforceTextDirWithUcc(o)),this.curFileNode.textContent=o}}.bind(this)),e.addEventListener("InputChanging",function(e){var t=this.pool,i=this.modelPool,n=i.search(e.input.resource);if(n?(i.release(this.pool),this.pool=i.retain(n)):this.pool.useCount>1&&(i.release(this.pool),this.pool=i.get()),this.pool.useCount>1&&(e.metadata=n.metadata),t!==this.pool){var o=this.editorView;o.model=this.pool.model,o.undoStack=this.pool.undoStack,o.editModelContextServiceID=this.pool.serviceID;var r=o.editor;r.installed&&(this._recreate=!0)}}.bind(this)),this.selection.addEventListener("selectionChanged",function(t){e.setInput(t.selection)})},defaultOptions:function(){var e=Object.create(null);return e.openEditor=this.activateContext.openEditor.bind(this.activateContext),{activateContext:e,parent:this.contentNode,model:this.pool.model,undoStack:this.pool.undoStack,editModelContextServiceID:this.pool.serviceID,menuBar:this.menuBar,serviceRegistry:this.serviceRegistry,pluginRegistry:this.pluginRegistry,commandRegistry:this.commandRegistry,contentTypeRegistry:this.contentTypeRegistry,editorCommands:this.editorCommands,renderToolbars:this.renderToolbars,inputManager:this.inputManager,readonly:this.readonly,preferences:this.preferences,searcher:this.searcher,selection:this.selection,problemsServiceID:this.problemsServiceID,editContextServiceID:this.editContextServiceID,fileService:this.fileClient,statusReporter:this.statusReporter.bind(this),statusService:this.statusService,progressService:this.progressService}},statusReporter:function(e,t,i){var n=this.statusService;"progress"===t?n.setProgressMessage(e):"error"===t?n.setErrorMessage({Message:e,Severity:"Error"}):n.setMessage(e,null,i)},getCurrentEditorView:function(){return this.currentEditorView&&"orion.editor.markdown"===this.currentEditorView.editorID?this.editorView:this.currentEditorView},getEditorView:function(e,t){var i=null;if(t&&e){var n=A.mixin({input:e,metadata:t},this.defaultOptions());if(t.Directory)i=new a.FolderView(n);else{var o=e.editor;if(this.editorView.setParent(this.contentNode),o&&"orion.editor"!==o){if("orion.viewer.markdown"===o)i=new d.MarkdownEditorView(n);else if("orion.editor.markdown"===o)n.editorView=this.editorView,n.anchor=e.anchor,i=new h.MarkdownEditorView(n);else for(var r=this.serviceRegistry.getServiceReferences("orion.edit.editor"),s=0;s<r.length;s++)if(r[s].getProperty("id")===o){n.editorService=r[s],i=new c.PluginEditorView(n);break}}else i=this.editorView}i.editorID=o}return(this.currentEditorView!==i||this._recreate)&&(this._recreate=!1,this.commandRegistry.closeParameterCollector(),this.currentEditorView&&this.currentEditorView.destroy(),this.pool.lastMetadata&&t&&this.pool.lastMetadata.Location!==t.Location&&this.pool.model.setText(""),this.currentEditorView=i,this.currentEditorView&&this.currentEditorView.create()),this.pool.lastMetadata=t,this.currentEditorView
},setEditor:function(e){this.editor!==e&&(this.editor&&this.editor.removeEventListener("DirtyChanged",this.editorDirtyListener),this.editor=e,this.editor&&this.editor.addEventListener("DirtyChanged",this.editorDirtyListener=function(){o.setDirtyIndicator(this.editor.isDirty()),this.curFileNode&&(this.dirtyIndicator||(this.dirtyIndicator=document.createElement("span"),this.dirtyIndicator.classList.add("editorViewerHeaderDirtyIndicator"),this.dirtyIndicator.textContent="*",this.curFileNode.parentNode.insertBefore(this.dirtyIndicator,this.curFileNode)),this.dirtyIndicator.style.display=this.editor.isDirty()?"block":"none")}.bind(this)))},setInput:function(e){this.inputManager.setInput(e)}}),U.prototype={},A.mixin(U.prototype,{initializeServices:function(){var e=this.serviceRegistry;this.selection=new v.Selection(e),this.operationsClient=new C.OperationsClient(e),this.statusService=new _.StatusReportingService(e,this.operationsClient,"statusPane","notifications","notificationArea"),this.dialogService=new b.DialogService(e),this.commandRegistry=new u.CommandRegistry({selection:this.selection}),this.progressService=new y.ProgressService(e,this.operationsClient,this.commandRegistry),this.outlineService=new w.OutlineService({serviceRegistry:e,preferences:this.preferences}),this.contentTypeRegistry=new p.ContentTypeRegistry(e),this.fileClient=new f.FileClient(e),this.projectClient=new D.ProjectClient(e,this.fileClient),this.searcher=new L.Searcher({serviceRegistry:e,commandService:this.commandRegistry,fileService:this.fileClient}),this.editorCommands=new m.EditorCommandFactory({serviceRegistry:e,commandRegistry:this.commandRegistry,fileClient:this.fileClient,renderToolbars:this.renderToolbars.bind(this),searcher:this.searcher,readonly:this.readonly,toolbarId:"toolsActions",saveToolbarId:"fileActions",editToolbarId:"editActions",navToolbarId:"pageNavigationActions",editorContextMenuId:"editorContextMenuActions"})},createBanner:function(){var e=!1;return o.generateBanner("orion-editor",this.serviceRegistry,this.commandRegistry,this.preferences,this.searcher,null,null,e,this.fileClient)},createMenuBar:function(){var e=this.menuBar=new F({parentNode:this.pageToolbar,fileClient:this.fileClient,editorCommands:this.editorCommands,commandRegistry:this.commandRegistry,serviceRegistry:this.serviceRegistry});return e.createCommands()},createRunBar:function(){var e=this.menuBar,t=e.runBarNode;return B.createRunBar({parentNode:t,serviceRegistry:this.serviceRegistry,commandRegistry:this.commandRegistry,fileClient:this.fileClient,projectCommands:x,projectClient:this.serviceRegistry.getService("orion.project.client"),progressService:this.progressService,preferences:this.preferences,editorInputManager:this.editorInputManager}).then(function(e){e&&(this.runBar=e)}.bind(this))},createSideBar:function(){function e(){T.attach(this)}function i(){T.attach(this)}this.commandRegistry;A.mixin(e.prototype,{getFileMetadata:function(){return this.inputManager.getFileMetadata()},getContentType:function(){return this.inputManager.getContentType()},getEditor:function(){return this.inputManager.getEditor()},getInput:function(){return this.inputManager.getInput()},getTitle:function(){return this.inputManager.getTitle()},getReadOnly:function(){return this.inputManager.getReadOnly()},setInputManager:function(e){this.inputManager=e,this.selection=e.selection,this.editor=e.editor}}),this.editorInputManager=new e,this.sidebarNavInputManager=new i;var n=this.sidebar=new t({commandRegistry:this.commandRegistry,contentTypeRegistry:this.contentTypeRegistry,editorInputManager:this.editorInputManager,preferences:this.preferences,fileClient:this.fileClient,outlineService:this.outlineService,parent:this.sidebarDomNode,progressService:this.progressService,selection:this.selection,serviceRegistry:this.serviceRegistry,sidebarNavInputManager:this.sidebarNavInputManager,switcherScope:"viewActions",editScope:"editActions",menuBar:this.menuBar,toolbar:this.sidebarToolbar});i.prototype.processHash=function(){var e=N.matchResourceParameters().navigate;"string"==typeof e&&this.setInput&&"nav"===n.getActiveViewModeId()&&this.setInput(e)},n.create(),this.editorCommands.setSideBar(n),this.sidebarNavInputManager.addEventListener("rootChanged",function(e){this.lastRoot=e.root}.bind(this));var o=function(e){var t=e.newInput||e.parent||"";window.location=Y.expand({resource:t})};this.sidebarNavInputManager.addEventListener("filesystemChanged",o),this.sidebarNavInputManager.addEventListener("editorInputMoved",o),this.sidebarNavInputManager.addEventListener("create",function(e){e.newValue&&!e.ignoreRedirect&&(window.location=this.computeNavigationHref(e.newValue))}.bind(this))},computeNavigationHref:function(e,t){var i=S.getOpenWithCommand(this.commandRegistry,e);return i&&"function"==typeof i.hrefCallback?i.hrefCallback({items:A.mixin({},e,{params:t})}):Y.expand(t?{resource:e.Location,params:t}:{resource:e.Location})},openEditor:function(e,t){var i=this.computeNavigationHref({Location:e},{start:t.start,end:t.end});if(i){var n="string"==typeof t.mode?t.mode:"replace";switch(n){case"replace":var o=this.activeEditorViewer.getCurrentEditorView();if(o&&o.editor){var r=o.editor.getSelection(),s=this.computeNavigationHref({Location:this.activeEditorViewer.inputManager.getInput()},{start:r.start,end:r.end});history.pushState({},"",s),this.lastHash=N.hash()}var a=i.split("#")[1];a===window.location.hash.substring(1)?this.activeEditorViewer.inputManager.setInput(a):window.location=i;break;case"tab":window.open(i);break;case"split":var l=i.split("#")[1];if(this.splitterMode&&this.splitterMode!==H)this.editorViewers[1].inputManager.setInput(l);else{var c="string"==typeof t.splitHint?t.splitHint:"vertical";"horizontal"===c?this.setSplitterMode($,l):"vertical"===c?this.setSplitterMode(G,l):"picInPic"===c&&this.setSplitterMode(K,l)}}}},createEditorViewer:function(e){var t=new V({id:e,parent:this.editorDomNode,activateContext:this,modelPool:this.modelPool,menuBar:this.menuBar,serviceRegistry:this.serviceRegistry,pluginRegistry:this.pluginRegistry,commandRegistry:this.commandRegistry,contentTypeRegistry:this.contentTypeRegistry,editorCommands:this.editorCommands,renderToolbars:this.renderToolbars.bind(this),readonly:this.readonly,preferences:this.preferences,searcher:this.searcher,selection:this.selection,fileClient:this.fileClient,statusService:this.statusService,progressService:this.progressService});return t.create(),t},createSplitters:function(e){if(!this.editorSplitter&&e!==H){var t=document.createElement("div");t.id="editorSplitter",this.editorDomNode.appendChild(t);var i=this.editorSplitter=new P.Splitter({node:t,sidePanel:this.editorViewers[0].domNode,mainPanel:this.editorViewers[1].domNode,toggle:!1,proportional:!0,vertical:!0,closeByDefault:!1});i.addEventListener("resize",function(e){this.editorViewers.forEach(function(t){t.domNode===e.node&&t.editorView.editor.resize()})}.bind(this))}},setInput:function(e){this.lastHash!==e&&(this.lastHash=e,this.activeEditorViewer.setInput(e),this.sidebarNavInputManager.processHash(e))},load:function(){var t=sessionStorage.lastFile,i=N.hash();t&&0===t.lastIndexOf(i,0)&&t!==i&&(window.location.hash=i=t),this.setInput(i),window.addEventListener("hashchange",function(){this.setInput(N.hash())}.bind(this)),window.onbeforeunload=function(){var t,i;return this.editorViewers.forEach(function(e){var n=e.editor;n&&n.isDirty()&&(t=!0,e.inputManager.getAutoSaveEnabled()&&(e.inputManager.save(),i=!0))}),t?i?e.unsavedAutoSaveChanges:e.unsavedChanges:void 0}.bind(this)},renderToolbars:function(e){e=e||this.activeEditorViewer.inputManager.getFileMetadata();var t=this.menuBar,i=this.commandRegistry,n=this.activeEditorViewer.editor;t.updateCommands(),["pageActions","pageNavigationActions","settingsActions"].forEach(function(t){var o=R.node(t);o&&(i.destroy(o),e&&i.renderCommands(o.id,o,e,n,"button"))})},setActiveEditorViewer:function(e){var t=this.activeEditorViewer;this.activeEditorViewer=e,this.menuBar.setActiveEditorViewer(e);var i=e.inputManager.getFileMetadata();(t!==e||this.lastTarget!==i)&&this.renderToolbars(i),this.setPageTarget(i)},setPageTarget:function(t){if(!this.lastTarget||!t||this.lastTarget.Location!==t.Location){this.lastTarget=t;var i,n=this.activeEditorViewer,r=t;r?i=r&&!r.Parents?this.fileClient.fileServiceName(r.Location):r.Name:(i=this.lastRoot?this.lastRoot.Name:"",r=this.lastRoot),o.setPageCommandExclusions(["orion.editFromMetadata"]),o.setPageTarget({viewer:z?n:null,task:e.Editor,name:i,target:r,makeAlternate:function(){return t&&t.parent?t.parent:t&&t.Parents&&t.Parents.length>0?t.Parents[0].Children?t.Parents[0]:this.progressService.progress(this.fileClient.read(t.Parents[0].Location,!0),k.formatMessage(e.ReadingMetadata,t.Parents[0].Location)):void 0}.bind(this),makeBreadcrumbLink:function(e,t,i){var n=i?i.Location:this.fileClient.fileServiceRootURL(t);if(e.href=Y.expand({resource:n}),i){var o=this.activeEditorViewer.inputManager.getFileMetadata();o&&o.Location===i.Location&&e.addEventListener("click",function(){this.sidebarNavInputManager.reveal(i)}.bind(this))}}.bind(this),makeBreadcrumFinalLink:!0,serviceRegistry:this.serviceRegistry,commandService:this.commandRegistry,searchService:this.searcher,fileService:this.fileClient});var s=n.editor;if(s&&o.setDirtyIndicator(s.isDirty()),t){var a=N.matchResourceParameters(n.inputManager.getLocation());delete a.resource,window.location=Y.expand({resource:r.Location,params:a}),this.lastHash=N.hash(),this.editorInputManager.setInputManager(n.inputManager),this.editorInputManager.dispatchEvent({type:"InputChanged",contentType:this.editorInputManager.getContentType(),metadata:t,editor:s,location:window.location})}}},setSplitterMode:function(e,t){var i=this.splitterMode;if(this.splitterMode!==e){this.splitterMode=e,e!==H&&this.editorViewers.length<2&&this.editorViewers.push(this.createEditorViewer(this.editorViewers.length+"")),this.createSplitters(e);var n=this.editorViewers[0].domNode;n.style.width=n.style.height="100%";var o,r;switch(this.editorViewers.length>1&&(o=this.editorViewers[1].domNode,r=this.editorSplitter.$splitter,o.classList.remove("editorViewerPicInPic"),o.style.display="block",o.style.width=o.style.height="100%",["top","left","right","bottom","width","height"].forEach(function(e){o.style[e]=""}),r.style.display="block"),e){case K:r.style.display="none",o.classList.add("editorViewerPicInPic");break;case H:r&&(r.style.display="none"),o&&(o.style.display="none"),this.setActiveEditorViewer(this.editorViewers[0]);break;case $:this.editorSplitter.setOrientation(P.ORIENTATION_VERTICAL,!0);break;case G:this.editorSplitter.setOrientation(P.ORIENTATION_HORIZONTAL,!0)}this.editorViewers.forEach(function(e){e.editorView.editor.resize()}),i===H&&e!==H&&(this.lastTarget=null,this.editorViewers[1].inputManager.setInput(t?t:N.hash()))}},createSplitMenu:function(){function t(){this.checked=!0,i.checked=!1,i=this,o.imageClass=this.imageClass,o.name=this.name,r.setSplitterMode(this.mode),r.commandRegistry.destroy(s),r.commandRegistry.renderCommands(s,s,r,r,"button")}var i,o,r=this,s="settingsActions",a=[{name:e.SplitSinglePage,mode:H,imageClass:"core-sprite-page",checked:!0,callback:t},{name:e.SplitVertical,mode:G,imageClass:"core-sprite-vertical",callback:t},{name:e.SplitHorizontal,mode:$,imageClass:"core-sprite-horizontal",callback:t},{name:e.SplitPipInPip,mode:K,imageClass:"core-sprite-pip",callback:t}];i=a[0],o=new n.Command({imageClass:i.imageClass,selectionClass:"dropdownSelection",name:i.name,tooltip:e.SplitModeTooltip,id:"orion.edit.splitmode",visibleWhen:function(){return!0},choiceCallback:function(){return a}}),this.commandRegistry.addCommand(o),this.commandRegistry.registerCommandContribution(s,"orion.edit.splitmode",0)}});var q;return W.getEditorViewers=function(){return q?q.editorViewers:[]},W.setUpEditor=function(e,t,i,n){z="false"!==localStorage.enableSplitEditor,q=new U(e,t,i,n),I.when(q.createBanner(),function(){q.createMenuBar().then(function(){q.createSideBar(),q.createRunBar().then(function(){q.editorViewers.push(q.createEditorViewer()),q.setActiveEditorViewer(q.editorViewers[0]),z&&(q.createSplitMenu(),q.setSplitterMode(H)),q.load()})})})},W}),define("edit/edit",["orion/browserCompatibility","orion/bootstrap","edit/setup"],function(e,t,i){t.startup().then(function(e){var t=e.serviceRegistry,n=e.pluginRegistry,o=e.preferences;i.setUpEditor(t,n,o,!1)})});
//# sourceMappingURL=edit.js
//# sourceMappingURL=edit.js.map